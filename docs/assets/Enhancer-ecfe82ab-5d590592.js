var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});var __publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value),__accessCheck=(obj,member,msg)=>{if(!member.has(obj))throw TypeError("Cannot "+msg)};var __privateGet=(obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),__privateAdd=(obj,member,value)=>{if(member.has(obj))throw TypeError("Cannot add the same private member more than once");member instanceof WeakSet?member.add(obj):member.set(obj,value)},__privateSet=(obj,member,value,setter)=>(__accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),__privateWrapper=(obj,member,setter,getter)=>({set _(value){__privateSet(obj,member,value,setter)},get _(){return __privateGet(obj,member,getter)}}),__privateMethod=(obj,member,method)=>(__accessCheck(obj,member,"access private method"),method);import{v as commonjsGlobal,E as getAugmentedNamespace,G as browserExports,H as rdfDataFactory,J as eventsExports,K as browserExports$1,O as rdfLiteral,u as browserExports$2,Q as grapoi,o as rdf,d as sh$1,a as rdfs,D as parsePath,f as defaultEnv}from"./index-e7c84aa2.js";import{s as sparql$1,d as inherits_browserExports,a as sparqljsonParse,r as require$$0$3,l as lib$2C,i as isStream_1,e as saxes,c as streamToString$1,j as jsonparse,b as sparqlxmlParse}from"./index-ccc0cdd1.js";import{y as yallist}from"./yallist-b7363eba.js";import"./___vite-browser-external_commonjs-proxy-32c16fb2.js";var indexBrowser$1={},QueryEngine$1={},indexBrowser={},ActorInitQueryBase$1={},lib$2B={},ActorInit$1={},lib$2A={},lib$2z={},Bindings$3={};Object.defineProperty(Bindings$3,"__esModule",{value:!0});var IActionContext={};Object.defineProperty(IActionContext,"__esModule",{value:!0});var IAggregatedStore={};Object.defineProperty(IAggregatedStore,"__esModule",{value:!0});var ICliArgsHandler={};Object.defineProperty(ICliArgsHandler,"__esModule",{value:!0});var IDataDestination={};Object.defineProperty(IDataDestination,"__esModule",{value:!0});var IDataSource={};Object.defineProperty(IDataSource,"__esModule",{value:!0});var IJoinEntry={};Object.defineProperty(IJoinEntry,"__esModule",{value:!0});var IMetadata={};Object.defineProperty(IMetadata,"__esModule",{value:!0});var IPhysicalQueryPlanLogger={};Object.defineProperty(IPhysicalQueryPlanLogger,"__esModule",{value:!0});var IProxyHandler={};Object.defineProperty(IProxyHandler,"__esModule",{value:!0});var IQueryContext={};Object.defineProperty(IQueryContext,"__esModule",{value:!0});var IQueryEngine={};Object.defineProperty(IQueryEngine,"__esModule",{value:!0});var IQueryOperationResult={};Object.defineProperty(IQueryOperationResult,"__esModule",{value:!0});var Logger$1={};Object.defineProperty(Logger$1,"__esModule",{value:!0});Logger$1.Logger=void 0;class Logger{static getLevelOrdinal(level){return Logger.LEVELS[level]}}__name(Logger,"Logger");Logger$1.Logger=Logger;Logger.LEVELS={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(Bindings$3,exports),__exportStar(IActionContext,exports),__exportStar(IAggregatedStore,exports),__exportStar(ICliArgsHandler,exports),__exportStar(IDataDestination,exports),__exportStar(IDataSource,exports),__exportStar(IJoinEntry,exports),__exportStar(IMetadata,exports),__exportStar(IPhysicalQueryPlanLogger,exports),__exportStar(IProxyHandler,exports),__exportStar(IQueryContext,exports),__exportStar(IQueryEngine,exports),__exportStar(IQueryOperationResult,exports),__exportStar(Logger$1,exports)})(lib$2z);var ActionContext$1={},DELETE="delete",SHIFT=5,SIZE=1<<SHIFT,MASK=SIZE-1,NOT_SET={};function MakeRef(){return{value:!1}}__name(MakeRef,"MakeRef");function SetRef(ref){ref&&(ref.value=!0)}__name(SetRef,"SetRef");function OwnerID(){}__name(OwnerID,"OwnerID");function ensureSize(iter){return iter.size===void 0&&(iter.size=iter.__iterate(returnTrue)),iter.size}__name(ensureSize,"ensureSize");function wrapIndex(iter,index){if(typeof index!="number"){var uint32Index=index>>>0;if(""+uint32Index!==index||uint32Index===4294967295)return NaN;index=uint32Index}return index<0?ensureSize(iter)+index:index}__name(wrapIndex,"wrapIndex");function returnTrue(){return!0}__name(returnTrue,"returnTrue");function wholeSlice(begin,end,size){return(begin===0&&!isNeg(begin)||size!==void 0&&begin<=-size)&&(end===void 0||size!==void 0&&end>=size)}__name(wholeSlice,"wholeSlice");function resolveBegin(begin,size){return resolveIndex(begin,size,0)}__name(resolveBegin,"resolveBegin");function resolveEnd(end,size){return resolveIndex(end,size,size)}__name(resolveEnd,"resolveEnd");function resolveIndex(index,size,defaultIndex){return index===void 0?defaultIndex:isNeg(index)?size===1/0?size:Math.max(0,size+index)|0:size===void 0||size===index?index:Math.min(size,index)|0}__name(resolveIndex,"resolveIndex");function isNeg(value){return value<0||value===0&&1/value===-1/0}__name(isNeg,"isNeg");var IS_COLLECTION_SYMBOL="@@__IMMUTABLE_ITERABLE__@@";function isCollection(maybeCollection){return!!(maybeCollection&&maybeCollection[IS_COLLECTION_SYMBOL])}__name(isCollection,"isCollection");var IS_KEYED_SYMBOL="@@__IMMUTABLE_KEYED__@@";function isKeyed(maybeKeyed){return!!(maybeKeyed&&maybeKeyed[IS_KEYED_SYMBOL])}__name(isKeyed,"isKeyed");var IS_INDEXED_SYMBOL="@@__IMMUTABLE_INDEXED__@@";function isIndexed(maybeIndexed){return!!(maybeIndexed&&maybeIndexed[IS_INDEXED_SYMBOL])}__name(isIndexed,"isIndexed");function isAssociative(maybeAssociative){return isKeyed(maybeAssociative)||isIndexed(maybeAssociative)}__name(isAssociative,"isAssociative");var Collection=__name(function(value){return isCollection(value)?value:Seq(value)},"Collection"),KeyedCollection=function(Collection3){function KeyedCollection2(value){return isKeyed(value)?value:KeyedSeq(value)}return __name(KeyedCollection2,"KeyedCollection"),Collection3&&(KeyedCollection2.__proto__=Collection3),KeyedCollection2.prototype=Object.create(Collection3&&Collection3.prototype),KeyedCollection2.prototype.constructor=KeyedCollection2,KeyedCollection2}(Collection),IndexedCollection=function(Collection3){function IndexedCollection2(value){return isIndexed(value)?value:IndexedSeq(value)}return __name(IndexedCollection2,"IndexedCollection"),Collection3&&(IndexedCollection2.__proto__=Collection3),IndexedCollection2.prototype=Object.create(Collection3&&Collection3.prototype),IndexedCollection2.prototype.constructor=IndexedCollection2,IndexedCollection2}(Collection),SetCollection=function(Collection3){function SetCollection2(value){return isCollection(value)&&!isAssociative(value)?value:SetSeq(value)}return __name(SetCollection2,"SetCollection"),Collection3&&(SetCollection2.__proto__=Collection3),SetCollection2.prototype=Object.create(Collection3&&Collection3.prototype),SetCollection2.prototype.constructor=SetCollection2,SetCollection2}(Collection);Collection.Keyed=KeyedCollection;Collection.Indexed=IndexedCollection;Collection.Set=SetCollection;var IS_SEQ_SYMBOL="@@__IMMUTABLE_SEQ__@@";function isSeq(maybeSeq){return!!(maybeSeq&&maybeSeq[IS_SEQ_SYMBOL])}__name(isSeq,"isSeq");var IS_RECORD_SYMBOL="@@__IMMUTABLE_RECORD__@@";function isRecord(maybeRecord){return!!(maybeRecord&&maybeRecord[IS_RECORD_SYMBOL])}__name(isRecord,"isRecord");function isImmutable(maybeImmutable){return isCollection(maybeImmutable)||isRecord(maybeImmutable)}__name(isImmutable,"isImmutable");var IS_ORDERED_SYMBOL="@@__IMMUTABLE_ORDERED__@@";function isOrdered(maybeOrdered){return!!(maybeOrdered&&maybeOrdered[IS_ORDERED_SYMBOL])}__name(isOrdered,"isOrdered");var ITERATE_KEYS=0,ITERATE_VALUES=1,ITERATE_ENTRIES=2,REAL_ITERATOR_SYMBOL=typeof Symbol=="function"&&Symbol.iterator,FAUX_ITERATOR_SYMBOL="@@iterator",ITERATOR_SYMBOL=REAL_ITERATOR_SYMBOL||FAUX_ITERATOR_SYMBOL,Iterator=__name(function(next){this.next=next},"Iterator");Iterator.prototype.toString=__name(function(){return"[Iterator]"},"toString");Iterator.KEYS=ITERATE_KEYS;Iterator.VALUES=ITERATE_VALUES;Iterator.ENTRIES=ITERATE_ENTRIES;Iterator.prototype.inspect=Iterator.prototype.toSource=function(){return this.toString()};Iterator.prototype[ITERATOR_SYMBOL]=function(){return this};function iteratorValue(type,k,v,iteratorResult){var value=type===0?k:type===1?v:[k,v];return iteratorResult?iteratorResult.value=value:iteratorResult={value,done:!1},iteratorResult}__name(iteratorValue,"iteratorValue");function iteratorDone(){return{value:void 0,done:!0}}__name(iteratorDone,"iteratorDone");function hasIterator(maybeIterable){return Array.isArray(maybeIterable)?!0:!!getIteratorFn(maybeIterable)}__name(hasIterator,"hasIterator");function isIterator(maybeIterator){return maybeIterator&&typeof maybeIterator.next=="function"}__name(isIterator,"isIterator");function getIterator(iterable){var iteratorFn=getIteratorFn(iterable);return iteratorFn&&iteratorFn.call(iterable)}__name(getIterator,"getIterator");function getIteratorFn(iterable){var iteratorFn=iterable&&(REAL_ITERATOR_SYMBOL&&iterable[REAL_ITERATOR_SYMBOL]||iterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn=="function")return iteratorFn}__name(getIteratorFn,"getIteratorFn");function isEntriesIterable(maybeIterable){var iteratorFn=getIteratorFn(maybeIterable);return iteratorFn&&iteratorFn===maybeIterable.entries}__name(isEntriesIterable,"isEntriesIterable");function isKeysIterable(maybeIterable){var iteratorFn=getIteratorFn(maybeIterable);return iteratorFn&&iteratorFn===maybeIterable.keys}__name(isKeysIterable,"isKeysIterable");var hasOwnProperty=Object.prototype.hasOwnProperty;function isArrayLike(value){return Array.isArray(value)||typeof value=="string"?!0:value&&typeof value=="object"&&Number.isInteger(value.length)&&value.length>=0&&(value.length===0?Object.keys(value).length===1:value.hasOwnProperty(value.length-1))}__name(isArrayLike,"isArrayLike");var Seq=function(Collection3){function Seq2(value){return value==null?emptySequence():isImmutable(value)?value.toSeq():seqFromValue(value)}return __name(Seq2,"Seq"),Collection3&&(Seq2.__proto__=Collection3),Seq2.prototype=Object.create(Collection3&&Collection3.prototype),Seq2.prototype.constructor=Seq2,Seq2.prototype.toSeq=__name(function(){return this},"toSeq"),Seq2.prototype.toString=__name(function(){return this.__toString("Seq {","}")},"toString"),Seq2.prototype.cacheResult=__name(function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},"cacheResult"),Seq2.prototype.__iterate=__name(function(fn,reverse3){var cache=this._cache;if(cache){for(var size=cache.length,i=0;i!==size;){var entry=cache[reverse3?size-++i:i++];if(fn(entry[1],entry[0],this)===!1)break}return i}return this.__iterateUncached(fn,reverse3)},"__iterate"),Seq2.prototype.__iterator=__name(function(type,reverse3){var cache=this._cache;if(cache){var size=cache.length,i=0;return new Iterator(function(){if(i===size)return iteratorDone();var entry=cache[reverse3?size-++i:i++];return iteratorValue(type,entry[0],entry[1])})}return this.__iteratorUncached(type,reverse3)},"__iterator"),Seq2}(Collection),KeyedSeq=function(Seq2){function KeyedSeq2(value){return value==null?emptySequence().toKeyedSeq():isCollection(value)?isKeyed(value)?value.toSeq():value.fromEntrySeq():isRecord(value)?value.toSeq():keyedSeqFromValue(value)}return __name(KeyedSeq2,"KeyedSeq"),Seq2&&(KeyedSeq2.__proto__=Seq2),KeyedSeq2.prototype=Object.create(Seq2&&Seq2.prototype),KeyedSeq2.prototype.constructor=KeyedSeq2,KeyedSeq2.prototype.toKeyedSeq=__name(function(){return this},"toKeyedSeq"),KeyedSeq2}(Seq),IndexedSeq=function(Seq2){function IndexedSeq2(value){return value==null?emptySequence():isCollection(value)?isKeyed(value)?value.entrySeq():value.toIndexedSeq():isRecord(value)?value.toSeq().entrySeq():indexedSeqFromValue(value)}return __name(IndexedSeq2,"IndexedSeq"),Seq2&&(IndexedSeq2.__proto__=Seq2),IndexedSeq2.prototype=Object.create(Seq2&&Seq2.prototype),IndexedSeq2.prototype.constructor=IndexedSeq2,IndexedSeq2.of=__name(function(){return IndexedSeq2(arguments)},"of"),IndexedSeq2.prototype.toIndexedSeq=__name(function(){return this},"toIndexedSeq"),IndexedSeq2.prototype.toString=__name(function(){return this.__toString("Seq [","]")},"toString"),IndexedSeq2}(Seq),SetSeq=function(Seq2){function SetSeq2(value){return(isCollection(value)&&!isAssociative(value)?value:IndexedSeq(value)).toSetSeq()}return __name(SetSeq2,"SetSeq"),Seq2&&(SetSeq2.__proto__=Seq2),SetSeq2.prototype=Object.create(Seq2&&Seq2.prototype),SetSeq2.prototype.constructor=SetSeq2,SetSeq2.of=__name(function(){return SetSeq2(arguments)},"of"),SetSeq2.prototype.toSetSeq=__name(function(){return this},"toSetSeq"),SetSeq2}(Seq);Seq.isSeq=isSeq;Seq.Keyed=KeyedSeq;Seq.Set=SetSeq;Seq.Indexed=IndexedSeq;Seq.prototype[IS_SEQ_SYMBOL]=!0;var ArraySeq=function(IndexedSeq2){function ArraySeq2(array){this._array=array,this.size=array.length}return __name(ArraySeq2,"ArraySeq"),IndexedSeq2&&(ArraySeq2.__proto__=IndexedSeq2),ArraySeq2.prototype=Object.create(IndexedSeq2&&IndexedSeq2.prototype),ArraySeq2.prototype.constructor=ArraySeq2,ArraySeq2.prototype.get=__name(function(index,notSetValue){return this.has(index)?this._array[wrapIndex(this,index)]:notSetValue},"get"),ArraySeq2.prototype.__iterate=__name(function(fn,reverse3){for(var array=this._array,size=array.length,i=0;i!==size;){var ii=reverse3?size-++i:i++;if(fn(array[ii],ii,this)===!1)break}return i},"__iterate"),ArraySeq2.prototype.__iterator=__name(function(type,reverse3){var array=this._array,size=array.length,i=0;return new Iterator(function(){if(i===size)return iteratorDone();var ii=reverse3?size-++i:i++;return iteratorValue(type,ii,array[ii])})},"__iterator"),ArraySeq2}(IndexedSeq),ObjectSeq=function(KeyedSeq2){function ObjectSeq2(object2){var keys2=Object.keys(object2).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(object2):[]);this._object=object2,this._keys=keys2,this.size=keys2.length}return __name(ObjectSeq2,"ObjectSeq"),KeyedSeq2&&(ObjectSeq2.__proto__=KeyedSeq2),ObjectSeq2.prototype=Object.create(KeyedSeq2&&KeyedSeq2.prototype),ObjectSeq2.prototype.constructor=ObjectSeq2,ObjectSeq2.prototype.get=__name(function(key,notSetValue){return notSetValue!==void 0&&!this.has(key)?notSetValue:this._object[key]},"get"),ObjectSeq2.prototype.has=__name(function(key){return hasOwnProperty.call(this._object,key)},"has"),ObjectSeq2.prototype.__iterate=__name(function(fn,reverse3){for(var object2=this._object,keys2=this._keys,size=keys2.length,i=0;i!==size;){var key=keys2[reverse3?size-++i:i++];if(fn(object2[key],key,this)===!1)break}return i},"__iterate"),ObjectSeq2.prototype.__iterator=__name(function(type,reverse3){var object2=this._object,keys2=this._keys,size=keys2.length,i=0;return new Iterator(function(){if(i===size)return iteratorDone();var key=keys2[reverse3?size-++i:i++];return iteratorValue(type,key,object2[key])})},"__iterator"),ObjectSeq2}(KeyedSeq);ObjectSeq.prototype[IS_ORDERED_SYMBOL]=!0;var CollectionSeq=function(IndexedSeq2){function CollectionSeq2(collection){this._collection=collection,this.size=collection.length||collection.size}return __name(CollectionSeq2,"CollectionSeq"),IndexedSeq2&&(CollectionSeq2.__proto__=IndexedSeq2),CollectionSeq2.prototype=Object.create(IndexedSeq2&&IndexedSeq2.prototype),CollectionSeq2.prototype.constructor=CollectionSeq2,CollectionSeq2.prototype.__iterateUncached=__name(function(fn,reverse3){if(reverse3)return this.cacheResult().__iterate(fn,reverse3);var collection=this._collection,iterator=getIterator(collection),iterations=0;if(isIterator(iterator))for(var step;!(step=iterator.next()).done&&fn(step.value,iterations++,this)!==!1;);return iterations},"__iterateUncached"),CollectionSeq2.prototype.__iteratorUncached=__name(function(type,reverse3){if(reverse3)return this.cacheResult().__iterator(type,reverse3);var collection=this._collection,iterator=getIterator(collection);if(!isIterator(iterator))return new Iterator(iteratorDone);var iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value)})},"__iteratorUncached"),CollectionSeq2}(IndexedSeq),EMPTY_SEQ;function emptySequence(){return EMPTY_SEQ||(EMPTY_SEQ=new ArraySeq([]))}__name(emptySequence,"emptySequence");function keyedSeqFromValue(value){var seq=maybeIndexedSeqFromValue(value);if(seq)return seq.fromEntrySeq();if(typeof value=="object")return new ObjectSeq(value);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+value)}__name(keyedSeqFromValue,"keyedSeqFromValue");function indexedSeqFromValue(value){var seq=maybeIndexedSeqFromValue(value);if(seq)return seq;throw new TypeError("Expected Array or collection object of values: "+value)}__name(indexedSeqFromValue,"indexedSeqFromValue");function seqFromValue(value){var seq=maybeIndexedSeqFromValue(value);if(seq)return isEntriesIterable(value)?seq.fromEntrySeq():isKeysIterable(value)?seq.toSetSeq():seq;if(typeof value=="object")return new ObjectSeq(value);throw new TypeError("Expected Array or collection object of values, or keyed object: "+value)}__name(seqFromValue,"seqFromValue");function maybeIndexedSeqFromValue(value){return isArrayLike(value)?new ArraySeq(value):hasIterator(value)?new CollectionSeq(value):void 0}__name(maybeIndexedSeqFromValue,"maybeIndexedSeqFromValue");var IS_MAP_SYMBOL="@@__IMMUTABLE_MAP__@@";function isMap(maybeMap){return!!(maybeMap&&maybeMap[IS_MAP_SYMBOL])}__name(isMap,"isMap");function isOrderedMap(maybeOrderedMap){return isMap(maybeOrderedMap)&&isOrdered(maybeOrderedMap)}__name(isOrderedMap,"isOrderedMap");function isValueObject(maybeValue){return!!(maybeValue&&typeof maybeValue.equals=="function"&&typeof maybeValue.hashCode=="function")}__name(isValueObject,"isValueObject");function is(valueA,valueB){if(valueA===valueB||valueA!==valueA&&valueB!==valueB)return!0;if(!valueA||!valueB)return!1;if(typeof valueA.valueOf=="function"&&typeof valueB.valueOf=="function"){if(valueA=valueA.valueOf(),valueB=valueB.valueOf(),valueA===valueB||valueA!==valueA&&valueB!==valueB)return!0;if(!valueA||!valueB)return!1}return!!(isValueObject(valueA)&&isValueObject(valueB)&&valueA.equals(valueB))}__name(is,"is");var imul=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:__name(function(a,b){a|=0,b|=0;var c=a&65535,d=b&65535;return c*d+((a>>>16)*d+c*(b>>>16)<<16>>>0)|0},"imul");function smi(i32){return i32>>>1&1073741824|i32&3221225471}__name(smi,"smi");var defaultValueOf=Object.prototype.valueOf;function hash$1(o){if(o==null)return hashNullish(o);if(typeof o.hashCode=="function")return smi(o.hashCode(o));var v=valueOf(o);if(v==null)return hashNullish(v);switch(typeof v){case"boolean":return v?1108378657:1108378656;case"number":return hashNumber(v);case"string":return v.length>STRING_HASH_CACHE_MIN_STRLEN?cachedHashString(v):hashString(v);case"object":case"function":return hashJSObj(v);case"symbol":return hashSymbol(v);default:if(typeof v.toString=="function")return hashString(v.toString());throw new Error("Value type "+typeof v+" cannot be hashed.")}}__name(hash$1,"hash$1");function hashNullish(nullish){return nullish===null?1108378658:1108378659}__name(hashNullish,"hashNullish");function hashNumber(n){if(n!==n||n===1/0)return 0;var hash2=n|0;for(hash2!==n&&(hash2^=n*4294967295);n>4294967295;)n/=4294967295,hash2^=n;return smi(hash2)}__name(hashNumber,"hashNumber");function cachedHashString(string){var hashed=stringHashCache[string];return hashed===void 0&&(hashed=hashString(string),STRING_HASH_CACHE_SIZE===STRING_HASH_CACHE_MAX_SIZE&&(STRING_HASH_CACHE_SIZE=0,stringHashCache={}),STRING_HASH_CACHE_SIZE++,stringHashCache[string]=hashed),hashed}__name(cachedHashString,"cachedHashString");function hashString(string){for(var hashed=0,ii=0;ii<string.length;ii++)hashed=31*hashed+string.charCodeAt(ii)|0;return smi(hashed)}__name(hashString,"hashString");function hashSymbol(sym){var hashed=symbolMap[sym];return hashed!==void 0||(hashed=nextHash(),symbolMap[sym]=hashed),hashed}__name(hashSymbol,"hashSymbol");function hashJSObj(obj){var hashed;if(usingWeakMap&&(hashed=weakMap.get(obj),hashed!==void 0)||(hashed=obj[UID_HASH_KEY],hashed!==void 0)||!canDefineProperty&&(hashed=obj.propertyIsEnumerable&&obj.propertyIsEnumerable[UID_HASH_KEY],hashed!==void 0||(hashed=getIENodeHash(obj),hashed!==void 0)))return hashed;if(hashed=nextHash(),usingWeakMap)weakMap.set(obj,hashed);else{if(isExtensible!==void 0&&isExtensible(obj)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(canDefineProperty)Object.defineProperty(obj,UID_HASH_KEY,{enumerable:!1,configurable:!1,writable:!1,value:hashed});else if(obj.propertyIsEnumerable!==void 0&&obj.propertyIsEnumerable===obj.constructor.prototype.propertyIsEnumerable)obj.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},obj.propertyIsEnumerable[UID_HASH_KEY]=hashed;else if(obj.nodeType!==void 0)obj[UID_HASH_KEY]=hashed;else throw new Error("Unable to set a non-enumerable property on object.")}return hashed}__name(hashJSObj,"hashJSObj");var isExtensible=Object.isExtensible,canDefineProperty=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function getIENodeHash(node2){if(node2&&node2.nodeType>0)switch(node2.nodeType){case 1:return node2.uniqueID;case 9:return node2.documentElement&&node2.documentElement.uniqueID}}__name(getIENodeHash,"getIENodeHash");function valueOf(obj){return obj.valueOf!==defaultValueOf&&typeof obj.valueOf=="function"?obj.valueOf(obj):obj}__name(valueOf,"valueOf");function nextHash(){var nextHash2=++_objHashUID;return _objHashUID&1073741824&&(_objHashUID=0),nextHash2}__name(nextHash,"nextHash");var usingWeakMap=typeof WeakMap=="function",weakMap;usingWeakMap&&(weakMap=new WeakMap);var symbolMap=Object.create(null),_objHashUID=0,UID_HASH_KEY="__immutablehash__";typeof Symbol=="function"&&(UID_HASH_KEY=Symbol(UID_HASH_KEY));var STRING_HASH_CACHE_MIN_STRLEN=16,STRING_HASH_CACHE_MAX_SIZE=255,STRING_HASH_CACHE_SIZE=0,stringHashCache={},ToKeyedSequence=function(KeyedSeq2){function ToKeyedSequence2(indexed,useKeys){this._iter=indexed,this._useKeys=useKeys,this.size=indexed.size}return __name(ToKeyedSequence2,"ToKeyedSequence"),KeyedSeq2&&(ToKeyedSequence2.__proto__=KeyedSeq2),ToKeyedSequence2.prototype=Object.create(KeyedSeq2&&KeyedSeq2.prototype),ToKeyedSequence2.prototype.constructor=ToKeyedSequence2,ToKeyedSequence2.prototype.get=__name(function(key,notSetValue){return this._iter.get(key,notSetValue)},"get"),ToKeyedSequence2.prototype.has=__name(function(key){return this._iter.has(key)},"has"),ToKeyedSequence2.prototype.valueSeq=__name(function(){return this._iter.valueSeq()},"valueSeq"),ToKeyedSequence2.prototype.reverse=__name(function(){var this$1$1=this,reversedSequence=reverseFactory(this,!0);return this._useKeys||(reversedSequence.valueSeq=function(){return this$1$1._iter.toSeq().reverse()}),reversedSequence},"reverse"),ToKeyedSequence2.prototype.map=__name(function(mapper,context2){var this$1$1=this,mappedSequence=mapFactory(this,mapper,context2);return this._useKeys||(mappedSequence.valueSeq=function(){return this$1$1._iter.toSeq().map(mapper,context2)}),mappedSequence},"map"),ToKeyedSequence2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this;return this._iter.__iterate(function(v,k){return fn(v,k,this$1$1)},reverse3)},"__iterate"),ToKeyedSequence2.prototype.__iterator=__name(function(type,reverse3){return this._iter.__iterator(type,reverse3)},"__iterator"),ToKeyedSequence2}(KeyedSeq);ToKeyedSequence.prototype[IS_ORDERED_SYMBOL]=!0;var ToIndexedSequence=function(IndexedSeq2){function ToIndexedSequence2(iter){this._iter=iter,this.size=iter.size}return __name(ToIndexedSequence2,"ToIndexedSequence"),IndexedSeq2&&(ToIndexedSequence2.__proto__=IndexedSeq2),ToIndexedSequence2.prototype=Object.create(IndexedSeq2&&IndexedSeq2.prototype),ToIndexedSequence2.prototype.constructor=ToIndexedSequence2,ToIndexedSequence2.prototype.includes=__name(function(value){return this._iter.includes(value)},"includes"),ToIndexedSequence2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this,i=0;return reverse3&&ensureSize(this),this._iter.__iterate(function(v){return fn(v,reverse3?this$1$1.size-++i:i++,this$1$1)},reverse3)},"__iterate"),ToIndexedSequence2.prototype.__iterator=__name(function(type,reverse3){var this$1$1=this,iterator=this._iter.__iterator(ITERATE_VALUES,reverse3),i=0;return reverse3&&ensureSize(this),new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,reverse3?this$1$1.size-++i:i++,step.value,step)})},"__iterator"),ToIndexedSequence2}(IndexedSeq),ToSetSequence=function(SetSeq2){function ToSetSequence2(iter){this._iter=iter,this.size=iter.size}return __name(ToSetSequence2,"ToSetSequence"),SetSeq2&&(ToSetSequence2.__proto__=SetSeq2),ToSetSequence2.prototype=Object.create(SetSeq2&&SetSeq2.prototype),ToSetSequence2.prototype.constructor=ToSetSequence2,ToSetSequence2.prototype.has=__name(function(key){return this._iter.includes(key)},"has"),ToSetSequence2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this;return this._iter.__iterate(function(v){return fn(v,v,this$1$1)},reverse3)},"__iterate"),ToSetSequence2.prototype.__iterator=__name(function(type,reverse3){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse3);return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,step.value,step.value,step)})},"__iterator"),ToSetSequence2}(SetSeq),FromEntriesSequence=function(KeyedSeq2){function FromEntriesSequence2(entries3){this._iter=entries3,this.size=entries3.size}return __name(FromEntriesSequence2,"FromEntriesSequence"),KeyedSeq2&&(FromEntriesSequence2.__proto__=KeyedSeq2),FromEntriesSequence2.prototype=Object.create(KeyedSeq2&&KeyedSeq2.prototype),FromEntriesSequence2.prototype.constructor=FromEntriesSequence2,FromEntriesSequence2.prototype.entrySeq=__name(function(){return this._iter.toSeq()},"entrySeq"),FromEntriesSequence2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this;return this._iter.__iterate(function(entry){if(entry){validateEntry(entry);var indexedCollection=isCollection(entry);return fn(indexedCollection?entry.get(1):entry[1],indexedCollection?entry.get(0):entry[0],this$1$1)}},reverse3)},"__iterate"),FromEntriesSequence2.prototype.__iterator=__name(function(type,reverse3){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse3);return new Iterator(function(){for(;;){var step=iterator.next();if(step.done)return step;var entry=step.value;if(entry){validateEntry(entry);var indexedCollection=isCollection(entry);return iteratorValue(type,indexedCollection?entry.get(0):entry[0],indexedCollection?entry.get(1):entry[1],step)}}})},"__iterator"),FromEntriesSequence2}(KeyedSeq);ToIndexedSequence.prototype.cacheResult=ToKeyedSequence.prototype.cacheResult=ToSetSequence.prototype.cacheResult=FromEntriesSequence.prototype.cacheResult=cacheResultThrough;function flipFactory(collection){var flipSequence=makeSequence(collection);return flipSequence._iter=collection,flipSequence.size=collection.size,flipSequence.flip=function(){return collection},flipSequence.reverse=function(){var reversedSequence=collection.reverse.apply(this);return reversedSequence.flip=function(){return collection.reverse()},reversedSequence},flipSequence.has=function(key){return collection.includes(key)},flipSequence.includes=function(key){return collection.has(key)},flipSequence.cacheResult=cacheResultThrough,flipSequence.__iterateUncached=function(fn,reverse3){var this$1$1=this;return collection.__iterate(function(v,k){return fn(k,v,this$1$1)!==!1},reverse3)},flipSequence.__iteratorUncached=function(type,reverse3){if(type===ITERATE_ENTRIES){var iterator=collection.__iterator(type,reverse3);return new Iterator(function(){var step=iterator.next();if(!step.done){var k=step.value[0];step.value[0]=step.value[1],step.value[1]=k}return step})}return collection.__iterator(type===ITERATE_VALUES?ITERATE_KEYS:ITERATE_VALUES,reverse3)},flipSequence}__name(flipFactory,"flipFactory");function mapFactory(collection,mapper,context2){var mappedSequence=makeSequence(collection);return mappedSequence.size=collection.size,mappedSequence.has=function(key){return collection.has(key)},mappedSequence.get=function(key,notSetValue){var v=collection.get(key,NOT_SET);return v===NOT_SET?notSetValue:mapper.call(context2,v,key,collection)},mappedSequence.__iterateUncached=function(fn,reverse3){var this$1$1=this;return collection.__iterate(function(v,k,c){return fn(mapper.call(context2,v,k,c),k,this$1$1)!==!1},reverse3)},mappedSequence.__iteratorUncached=function(type,reverse3){var iterator=collection.__iterator(ITERATE_ENTRIES,reverse3);return new Iterator(function(){var step=iterator.next();if(step.done)return step;var entry=step.value,key=entry[0];return iteratorValue(type,key,mapper.call(context2,entry[1],key,collection),step)})},mappedSequence}__name(mapFactory,"mapFactory");function reverseFactory(collection,useKeys){var this$1$1=this,reversedSequence=makeSequence(collection);return reversedSequence._iter=collection,reversedSequence.size=collection.size,reversedSequence.reverse=function(){return collection},collection.flip&&(reversedSequence.flip=function(){var flipSequence=flipFactory(collection);return flipSequence.reverse=function(){return collection.flip()},flipSequence}),reversedSequence.get=function(key,notSetValue){return collection.get(useKeys?key:-1-key,notSetValue)},reversedSequence.has=function(key){return collection.has(useKeys?key:-1-key)},reversedSequence.includes=function(value){return collection.includes(value)},reversedSequence.cacheResult=cacheResultThrough,reversedSequence.__iterate=function(fn,reverse3){var this$1$12=this,i=0;return reverse3&&ensureSize(collection),collection.__iterate(function(v,k){return fn(v,useKeys?k:reverse3?this$1$12.size-++i:i++,this$1$12)},!reverse3)},reversedSequence.__iterator=function(type,reverse3){var i=0;reverse3&&ensureSize(collection);var iterator=collection.__iterator(ITERATE_ENTRIES,!reverse3);return new Iterator(function(){var step=iterator.next();if(step.done)return step;var entry=step.value;return iteratorValue(type,useKeys?entry[0]:reverse3?this$1$1.size-++i:i++,entry[1],step)})},reversedSequence}__name(reverseFactory,"reverseFactory");function filterFactory(collection,predicate2,context2,useKeys){var filterSequence=makeSequence(collection);return useKeys&&(filterSequence.has=function(key){var v=collection.get(key,NOT_SET);return v!==NOT_SET&&!!predicate2.call(context2,v,key,collection)},filterSequence.get=function(key,notSetValue){var v=collection.get(key,NOT_SET);return v!==NOT_SET&&predicate2.call(context2,v,key,collection)?v:notSetValue}),filterSequence.__iterateUncached=function(fn,reverse3){var this$1$1=this,iterations=0;return collection.__iterate(function(v,k,c){if(predicate2.call(context2,v,k,c))return iterations++,fn(v,useKeys?k:iterations-1,this$1$1)},reverse3),iterations},filterSequence.__iteratorUncached=function(type,reverse3){var iterator=collection.__iterator(ITERATE_ENTRIES,reverse3),iterations=0;return new Iterator(function(){for(;;){var step=iterator.next();if(step.done)return step;var entry=step.value,key=entry[0],value=entry[1];if(predicate2.call(context2,value,key,collection))return iteratorValue(type,useKeys?key:iterations++,value,step)}})},filterSequence}__name(filterFactory,"filterFactory");function countByFactory(collection,grouper,context2){var groups=Map$1().asMutable();return collection.__iterate(function(v,k){groups.update(grouper.call(context2,v,k,collection),0,function(a){return a+1})}),groups.asImmutable()}__name(countByFactory,"countByFactory");function groupByFactory(collection,grouper,context2){var isKeyedIter=isKeyed(collection),groups=(isOrdered(collection)?OrderedMap():Map$1()).asMutable();collection.__iterate(function(v,k){groups.update(grouper.call(context2,v,k,collection),function(a){return a=a||[],a.push(isKeyedIter?[k,v]:v),a})});var coerce=collectionClass(collection);return groups.map(function(arr){return reify(collection,coerce(arr))}).asImmutable()}__name(groupByFactory,"groupByFactory");function partitionFactory(collection,predicate2,context2){var isKeyedIter=isKeyed(collection),groups=[[],[]];collection.__iterate(function(v,k){groups[predicate2.call(context2,v,k,collection)?1:0].push(isKeyedIter?[k,v]:v)});var coerce=collectionClass(collection);return groups.map(function(arr){return reify(collection,coerce(arr))})}__name(partitionFactory,"partitionFactory");function sliceFactory(collection,begin,end,useKeys){var originalSize=collection.size;if(wholeSlice(begin,end,originalSize))return collection;var resolvedBegin=resolveBegin(begin,originalSize),resolvedEnd=resolveEnd(end,originalSize);if(resolvedBegin!==resolvedBegin||resolvedEnd!==resolvedEnd)return sliceFactory(collection.toSeq().cacheResult(),begin,end,useKeys);var resolvedSize=resolvedEnd-resolvedBegin,sliceSize;resolvedSize===resolvedSize&&(sliceSize=resolvedSize<0?0:resolvedSize);var sliceSeq=makeSequence(collection);return sliceSeq.size=sliceSize===0?sliceSize:collection.size&&sliceSize||void 0,!useKeys&&isSeq(collection)&&sliceSize>=0&&(sliceSeq.get=function(index,notSetValue){return index=wrapIndex(this,index),index>=0&&index<sliceSize?collection.get(index+resolvedBegin,notSetValue):notSetValue}),sliceSeq.__iterateUncached=function(fn,reverse3){var this$1$1=this;if(sliceSize===0)return 0;if(reverse3)return this.cacheResult().__iterate(fn,reverse3);var skipped=0,isSkipping=!0,iterations=0;return collection.__iterate(function(v,k){if(!(isSkipping&&(isSkipping=skipped++<resolvedBegin)))return iterations++,fn(v,useKeys?k:iterations-1,this$1$1)!==!1&&iterations!==sliceSize}),iterations},sliceSeq.__iteratorUncached=function(type,reverse3){if(sliceSize!==0&&reverse3)return this.cacheResult().__iterator(type,reverse3);if(sliceSize===0)return new Iterator(iteratorDone);var iterator=collection.__iterator(type,reverse3),skipped=0,iterations=0;return new Iterator(function(){for(;skipped++<resolvedBegin;)iterator.next();if(++iterations>sliceSize)return iteratorDone();var step=iterator.next();return useKeys||type===ITERATE_VALUES||step.done?step:type===ITERATE_KEYS?iteratorValue(type,iterations-1,void 0,step):iteratorValue(type,iterations-1,step.value[1],step)})},sliceSeq}__name(sliceFactory,"sliceFactory");function takeWhileFactory(collection,predicate2,context2){var takeSequence=makeSequence(collection);return takeSequence.__iterateUncached=function(fn,reverse3){var this$1$1=this;if(reverse3)return this.cacheResult().__iterate(fn,reverse3);var iterations=0;return collection.__iterate(function(v,k,c){return predicate2.call(context2,v,k,c)&&++iterations&&fn(v,k,this$1$1)}),iterations},takeSequence.__iteratorUncached=function(type,reverse3){var this$1$1=this;if(reverse3)return this.cacheResult().__iterator(type,reverse3);var iterator=collection.__iterator(ITERATE_ENTRIES,reverse3),iterating=!0;return new Iterator(function(){if(!iterating)return iteratorDone();var step=iterator.next();if(step.done)return step;var entry=step.value,k=entry[0],v=entry[1];return predicate2.call(context2,v,k,this$1$1)?type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step):(iterating=!1,iteratorDone())})},takeSequence}__name(takeWhileFactory,"takeWhileFactory");function skipWhileFactory(collection,predicate2,context2,useKeys){var skipSequence=makeSequence(collection);return skipSequence.__iterateUncached=function(fn,reverse3){var this$1$1=this;if(reverse3)return this.cacheResult().__iterate(fn,reverse3);var isSkipping=!0,iterations=0;return collection.__iterate(function(v,k,c){if(!(isSkipping&&(isSkipping=predicate2.call(context2,v,k,c))))return iterations++,fn(v,useKeys?k:iterations-1,this$1$1)}),iterations},skipSequence.__iteratorUncached=function(type,reverse3){var this$1$1=this;if(reverse3)return this.cacheResult().__iterator(type,reverse3);var iterator=collection.__iterator(ITERATE_ENTRIES,reverse3),skipping=!0,iterations=0;return new Iterator(function(){var step,k,v;do{if(step=iterator.next(),step.done)return useKeys||type===ITERATE_VALUES?step:type===ITERATE_KEYS?iteratorValue(type,iterations++,void 0,step):iteratorValue(type,iterations++,step.value[1],step);var entry=step.value;k=entry[0],v=entry[1],skipping&&(skipping=predicate2.call(context2,v,k,this$1$1))}while(skipping);return type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step)})},skipSequence}__name(skipWhileFactory,"skipWhileFactory");function concatFactory(collection,values2){var isKeyedCollection=isKeyed(collection),iters=[collection].concat(values2).map(function(v){return isCollection(v)?isKeyedCollection&&(v=KeyedCollection(v)):v=isKeyedCollection?keyedSeqFromValue(v):indexedSeqFromValue(Array.isArray(v)?v:[v]),v}).filter(function(v){return v.size!==0});if(iters.length===0)return collection;if(iters.length===1){var singleton=iters[0];if(singleton===collection||isKeyedCollection&&isKeyed(singleton)||isIndexed(collection)&&isIndexed(singleton))return singleton}var concatSeq=new ArraySeq(iters);return isKeyedCollection?concatSeq=concatSeq.toKeyedSeq():isIndexed(collection)||(concatSeq=concatSeq.toSetSeq()),concatSeq=concatSeq.flatten(!0),concatSeq.size=iters.reduce(function(sum,seq){if(sum!==void 0){var size=seq.size;if(size!==void 0)return sum+size}},0),concatSeq}__name(concatFactory,"concatFactory");function flattenFactory(collection,depth,useKeys){var flatSequence=makeSequence(collection);return flatSequence.__iterateUncached=function(fn,reverse3){if(reverse3)return this.cacheResult().__iterate(fn,reverse3);var iterations=0,stopped=!1;function flatDeep(iter,currentDepth){iter.__iterate(function(v,k){return(!depth||currentDepth<depth)&&isCollection(v)?flatDeep(v,currentDepth+1):(iterations++,fn(v,useKeys?k:iterations-1,flatSequence)===!1&&(stopped=!0)),!stopped},reverse3)}return __name(flatDeep,"flatDeep"),flatDeep(collection,0),iterations},flatSequence.__iteratorUncached=function(type,reverse3){if(reverse3)return this.cacheResult().__iterator(type,reverse3);var iterator=collection.__iterator(type,reverse3),stack=[],iterations=0;return new Iterator(function(){for(;iterator;){var step=iterator.next();if(step.done!==!1){iterator=stack.pop();continue}var v=step.value;if(type===ITERATE_ENTRIES&&(v=v[1]),(!depth||stack.length<depth)&&isCollection(v))stack.push(iterator),iterator=v.__iterator(type,reverse3);else return useKeys?step:iteratorValue(type,iterations++,v,step)}return iteratorDone()})},flatSequence}__name(flattenFactory,"flattenFactory");function flatMapFactory(collection,mapper,context2){var coerce=collectionClass(collection);return collection.toSeq().map(function(v,k){return coerce(mapper.call(context2,v,k,collection))}).flatten(!0)}__name(flatMapFactory,"flatMapFactory");function interposeFactory(collection,separator){var interposedSequence=makeSequence(collection);return interposedSequence.size=collection.size&&collection.size*2-1,interposedSequence.__iterateUncached=function(fn,reverse3){var this$1$1=this,iterations=0;return collection.__iterate(function(v){return(!iterations||fn(separator,iterations++,this$1$1)!==!1)&&fn(v,iterations++,this$1$1)!==!1},reverse3),iterations},interposedSequence.__iteratorUncached=function(type,reverse3){var iterator=collection.__iterator(ITERATE_VALUES,reverse3),iterations=0,step;return new Iterator(function(){return(!step||iterations%2)&&(step=iterator.next(),step.done)?step:iterations%2?iteratorValue(type,iterations++,separator):iteratorValue(type,iterations++,step.value,step)})},interposedSequence}__name(interposeFactory,"interposeFactory");function sortFactory(collection,comparator,mapper){comparator||(comparator=defaultComparator);var isKeyedCollection=isKeyed(collection),index=0,entries3=collection.toSeq().map(function(v,k){return[k,v,index++,mapper?mapper(v,k,collection):v]}).valueSeq().toArray();return entries3.sort(function(a,b){return comparator(a[3],b[3])||a[2]-b[2]}).forEach(isKeyedCollection?function(v,i){entries3[i].length=2}:function(v,i){entries3[i]=v[1]}),isKeyedCollection?KeyedSeq(entries3):isIndexed(collection)?IndexedSeq(entries3):SetSeq(entries3)}__name(sortFactory,"sortFactory");function maxFactory(collection,comparator,mapper){if(comparator||(comparator=defaultComparator),mapper){var entry=collection.toSeq().map(function(v,k){return[v,mapper(v,k,collection)]}).reduce(function(a,b){return maxCompare(comparator,a[1],b[1])?b:a});return entry&&entry[0]}return collection.reduce(function(a,b){return maxCompare(comparator,a,b)?b:a})}__name(maxFactory,"maxFactory");function maxCompare(comparator,a,b){var comp=comparator(b,a);return comp===0&&b!==a&&(b==null||b!==b)||comp>0}__name(maxCompare,"maxCompare");function zipWithFactory(keyIter,zipper,iters,zipAll2){var zipSequence=makeSequence(keyIter),sizes=new ArraySeq(iters).map(function(i){return i.size});return zipSequence.size=zipAll2?sizes.max():sizes.min(),zipSequence.__iterate=function(fn,reverse3){for(var iterator=this.__iterator(ITERATE_VALUES,reverse3),step,iterations=0;!(step=iterator.next()).done&&fn(step.value,iterations++,this)!==!1;);return iterations},zipSequence.__iteratorUncached=function(type,reverse3){var iterators=iters.map(function(i){return i=Collection(i),getIterator(reverse3?i.reverse():i)}),iterations=0,isDone=!1;return new Iterator(function(){var steps;return isDone||(steps=iterators.map(function(i){return i.next()}),isDone=zipAll2?steps.every(function(s2){return s2.done}):steps.some(function(s2){return s2.done})),isDone?iteratorDone():iteratorValue(type,iterations++,zipper.apply(null,steps.map(function(s2){return s2.value})))})},zipSequence}__name(zipWithFactory,"zipWithFactory");function reify(iter,seq){return iter===seq?iter:isSeq(iter)?seq:iter.constructor(seq)}__name(reify,"reify");function validateEntry(entry){if(entry!==Object(entry))throw new TypeError("Expected [K, V] tuple: "+entry)}__name(validateEntry,"validateEntry");function collectionClass(collection){return isKeyed(collection)?KeyedCollection:isIndexed(collection)?IndexedCollection:SetCollection}__name(collectionClass,"collectionClass");function makeSequence(collection){return Object.create((isKeyed(collection)?KeyedSeq:isIndexed(collection)?IndexedSeq:SetSeq).prototype)}__name(makeSequence,"makeSequence");function cacheResultThrough(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Seq.prototype.cacheResult.call(this)}__name(cacheResultThrough,"cacheResultThrough");function defaultComparator(a,b){return a===void 0&&b===void 0?0:a===void 0?1:b===void 0?-1:a>b?1:a<b?-1:0}__name(defaultComparator,"defaultComparator");function arrCopy(arr,offset){offset=offset||0;for(var len=Math.max(0,arr.length-offset),newArr=new Array(len),ii=0;ii<len;ii++)newArr[ii]=arr[ii+offset];return newArr}__name(arrCopy,"arrCopy");function invariant$1(condition,error){if(!condition)throw new Error(error)}__name(invariant$1,"invariant$1");function assertNotInfinite(size){invariant$1(size!==1/0,"Cannot perform this action with an infinite size.")}__name(assertNotInfinite,"assertNotInfinite");function coerceKeyPath(keyPath){if(isArrayLike(keyPath)&&typeof keyPath!="string")return keyPath;if(isOrdered(keyPath))return keyPath.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+keyPath)}__name(coerceKeyPath,"coerceKeyPath");var toString2=Object.prototype.toString;function isPlainObject(value){if(!value||typeof value!="object"||toString2.call(value)!=="[object Object]")return!1;var proto=Object.getPrototypeOf(value);if(proto===null)return!0;for(var parentProto=proto,nextProto=Object.getPrototypeOf(proto);nextProto!==null;)parentProto=nextProto,nextProto=Object.getPrototypeOf(parentProto);return parentProto===proto}__name(isPlainObject,"isPlainObject");function isDataStructure(value){return typeof value=="object"&&(isImmutable(value)||Array.isArray(value)||isPlainObject(value))}__name(isDataStructure,"isDataStructure");function quoteString(value){try{return typeof value=="string"?JSON.stringify(value):String(value)}catch{return JSON.stringify(value)}}__name(quoteString,"quoteString");function has(collection,key){return isImmutable(collection)?collection.has(key):isDataStructure(collection)&&hasOwnProperty.call(collection,key)}__name(has,"has");function get$1(collection,key,notSetValue){return isImmutable(collection)?collection.get(key,notSetValue):has(collection,key)?typeof collection.get=="function"?collection.get(key):collection[key]:notSetValue}__name(get$1,"get$1");function shallowCopy(from){if(Array.isArray(from))return arrCopy(from);var to={};for(var key in from)hasOwnProperty.call(from,key)&&(to[key]=from[key]);return to}__name(shallowCopy,"shallowCopy");function remove(collection,key){if(!isDataStructure(collection))throw new TypeError("Cannot update non-data-structure value: "+collection);if(isImmutable(collection)){if(!collection.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+collection);return collection.remove(key)}if(!hasOwnProperty.call(collection,key))return collection;var collectionCopy=shallowCopy(collection);return Array.isArray(collectionCopy)?collectionCopy.splice(key,1):delete collectionCopy[key],collectionCopy}__name(remove,"remove");function set(collection,key,value){if(!isDataStructure(collection))throw new TypeError("Cannot update non-data-structure value: "+collection);if(isImmutable(collection)){if(!collection.set)throw new TypeError("Cannot update immutable value without .set() method: "+collection);return collection.set(key,value)}if(hasOwnProperty.call(collection,key)&&value===collection[key])return collection;var collectionCopy=shallowCopy(collection);return collectionCopy[key]=value,collectionCopy}__name(set,"set");function updateIn$1(collection,keyPath,notSetValue,updater){updater||(updater=notSetValue,notSetValue=void 0);var updatedValue=updateInDeeply(isImmutable(collection),collection,coerceKeyPath(keyPath),0,notSetValue,updater);return updatedValue===NOT_SET?notSetValue:updatedValue}__name(updateIn$1,"updateIn$1");function updateInDeeply(inImmutable,existing,keyPath,i,notSetValue,updater){var wasNotSet=existing===NOT_SET;if(i===keyPath.length){var existingValue=wasNotSet?notSetValue:existing,newValue=updater(existingValue);return newValue===existingValue?existing:newValue}if(!wasNotSet&&!isDataStructure(existing))throw new TypeError("Cannot update within non-data-structure value in path ["+keyPath.slice(0,i).map(quoteString)+"]: "+existing);var key=keyPath[i],nextExisting=wasNotSet?NOT_SET:get$1(existing,key,NOT_SET),nextUpdated=updateInDeeply(nextExisting===NOT_SET?inImmutable:isImmutable(nextExisting),nextExisting,keyPath,i+1,notSetValue,updater);return nextUpdated===nextExisting?existing:nextUpdated===NOT_SET?remove(existing,key):set(wasNotSet?inImmutable?emptyMap():{}:existing,key,nextUpdated)}__name(updateInDeeply,"updateInDeeply");function setIn$1(collection,keyPath,value){return updateIn$1(collection,keyPath,NOT_SET,function(){return value})}__name(setIn$1,"setIn$1");function setIn(keyPath,v){return setIn$1(this,keyPath,v)}__name(setIn,"setIn");function removeIn(collection,keyPath){return updateIn$1(collection,keyPath,function(){return NOT_SET})}__name(removeIn,"removeIn");function deleteIn(keyPath){return removeIn(this,keyPath)}__name(deleteIn,"deleteIn");function update$1(collection,key,notSetValue,updater){return updateIn$1(collection,[key],notSetValue,updater)}__name(update$1,"update$1");function update(key,notSetValue,updater){return arguments.length===1?key(this):update$1(this,key,notSetValue,updater)}__name(update,"update");function updateIn(keyPath,notSetValue,updater){return updateIn$1(this,keyPath,notSetValue,updater)}__name(updateIn,"updateIn");function merge$1(){for(var iters=[],len=arguments.length;len--;)iters[len]=arguments[len];return mergeIntoKeyedWith(this,iters)}__name(merge$1,"merge$1");function mergeWith$1(merger){for(var iters=[],len=arguments.length-1;len-- >0;)iters[len]=arguments[len+1];if(typeof merger!="function")throw new TypeError("Invalid merger function: "+merger);return mergeIntoKeyedWith(this,iters,merger)}__name(mergeWith$1,"mergeWith$1");function mergeIntoKeyedWith(collection,collections,merger){for(var iters=[],ii=0;ii<collections.length;ii++){var collection$1=KeyedCollection(collections[ii]);collection$1.size!==0&&iters.push(collection$1)}return iters.length===0?collection:collection.toSeq().size===0&&!collection.__ownerID&&iters.length===1?collection.constructor(iters[0]):collection.withMutations(function(collection2){for(var mergeIntoCollection=merger?function(value,key){update$1(collection2,key,NOT_SET,function(oldVal){return oldVal===NOT_SET?value:merger(oldVal,value,key)})}:function(value,key){collection2.set(key,value)},ii2=0;ii2<iters.length;ii2++)iters[ii2].forEach(mergeIntoCollection)})}__name(mergeIntoKeyedWith,"mergeIntoKeyedWith");function merge(collection){for(var sources=[],len=arguments.length-1;len-- >0;)sources[len]=arguments[len+1];return mergeWithSources(collection,sources)}__name(merge,"merge");function mergeWith(merger,collection){for(var sources=[],len=arguments.length-2;len-- >0;)sources[len]=arguments[len+2];return mergeWithSources(collection,sources,merger)}__name(mergeWith,"mergeWith");function mergeDeep$1(collection){for(var sources=[],len=arguments.length-1;len-- >0;)sources[len]=arguments[len+1];return mergeDeepWithSources(collection,sources)}__name(mergeDeep$1,"mergeDeep$1");function mergeDeepWith$1(merger,collection){for(var sources=[],len=arguments.length-2;len-- >0;)sources[len]=arguments[len+2];return mergeDeepWithSources(collection,sources,merger)}__name(mergeDeepWith$1,"mergeDeepWith$1");function mergeDeepWithSources(collection,sources,merger){return mergeWithSources(collection,sources,deepMergerWith(merger))}__name(mergeDeepWithSources,"mergeDeepWithSources");function mergeWithSources(collection,sources,merger){if(!isDataStructure(collection))throw new TypeError("Cannot merge into non-data-structure value: "+collection);if(isImmutable(collection))return typeof merger=="function"&&collection.mergeWith?collection.mergeWith.apply(collection,[merger].concat(sources)):collection.merge?collection.merge.apply(collection,sources):collection.concat.apply(collection,sources);for(var isArray=Array.isArray(collection),merged=collection,Collection3=isArray?IndexedCollection:KeyedCollection,mergeItem=isArray?function(value){merged===collection&&(merged=shallowCopy(merged)),merged.push(value)}:function(value,key){var hasVal=hasOwnProperty.call(merged,key),nextVal=hasVal&&merger?merger(merged[key],value,key):value;(!hasVal||nextVal!==merged[key])&&(merged===collection&&(merged=shallowCopy(merged)),merged[key]=nextVal)},i=0;i<sources.length;i++)Collection3(sources[i]).forEach(mergeItem);return merged}__name(mergeWithSources,"mergeWithSources");function deepMergerWith(merger){function deepMerger(oldValue,newValue,key){return isDataStructure(oldValue)&&isDataStructure(newValue)&&areMergeable(oldValue,newValue)?mergeWithSources(oldValue,[newValue],deepMerger):merger?merger(oldValue,newValue,key):newValue}return __name(deepMerger,"deepMerger"),deepMerger}__name(deepMergerWith,"deepMergerWith");function areMergeable(oldDataStructure,newDataStructure){var oldSeq=Seq(oldDataStructure),newSeq=Seq(newDataStructure);return isIndexed(oldSeq)===isIndexed(newSeq)&&isKeyed(oldSeq)===isKeyed(newSeq)}__name(areMergeable,"areMergeable");function mergeDeep(){for(var iters=[],len=arguments.length;len--;)iters[len]=arguments[len];return mergeDeepWithSources(this,iters)}__name(mergeDeep,"mergeDeep");function mergeDeepWith(merger){for(var iters=[],len=arguments.length-1;len-- >0;)iters[len]=arguments[len+1];return mergeDeepWithSources(this,iters,merger)}__name(mergeDeepWith,"mergeDeepWith");function mergeIn(keyPath){for(var iters=[],len=arguments.length-1;len-- >0;)iters[len]=arguments[len+1];return updateIn$1(this,keyPath,emptyMap(),function(m){return mergeWithSources(m,iters)})}__name(mergeIn,"mergeIn");function mergeDeepIn(keyPath){for(var iters=[],len=arguments.length-1;len-- >0;)iters[len]=arguments[len+1];return updateIn$1(this,keyPath,emptyMap(),function(m){return mergeDeepWithSources(m,iters)})}__name(mergeDeepIn,"mergeDeepIn");function withMutations(fn){var mutable=this.asMutable();return fn(mutable),mutable.wasAltered()?mutable.__ensureOwner(this.__ownerID):this}__name(withMutations,"withMutations");function asMutable(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)}__name(asMutable,"asMutable");function asImmutable(){return this.__ensureOwner()}__name(asImmutable,"asImmutable");function wasAltered(){return this.__altered}__name(wasAltered,"wasAltered");var Map$1=function(KeyedCollection2){function Map2(value){return value==null?emptyMap():isMap(value)&&!isOrdered(value)?value:emptyMap().withMutations(function(map2){var iter=KeyedCollection2(value);assertNotInfinite(iter.size),iter.forEach(function(v,k){return map2.set(k,v)})})}return __name(Map2,"Map"),KeyedCollection2&&(Map2.__proto__=KeyedCollection2),Map2.prototype=Object.create(KeyedCollection2&&KeyedCollection2.prototype),Map2.prototype.constructor=Map2,Map2.of=__name(function(){for(var keyValues=[],len=arguments.length;len--;)keyValues[len]=arguments[len];return emptyMap().withMutations(function(map2){for(var i=0;i<keyValues.length;i+=2){if(i+1>=keyValues.length)throw new Error("Missing value for key: "+keyValues[i]);map2.set(keyValues[i],keyValues[i+1])}})},"of"),Map2.prototype.toString=__name(function(){return this.__toString("Map {","}")},"toString"),Map2.prototype.get=__name(function(k,notSetValue){return this._root?this._root.get(0,void 0,k,notSetValue):notSetValue},"get"),Map2.prototype.set=__name(function(k,v){return updateMap(this,k,v)},"set"),Map2.prototype.remove=__name(function(k){return updateMap(this,k,NOT_SET)},"remove"),Map2.prototype.deleteAll=__name(function(keys2){var collection=Collection(keys2);return collection.size===0?this:this.withMutations(function(map2){collection.forEach(function(key){return map2.remove(key)})})},"deleteAll"),Map2.prototype.clear=__name(function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):emptyMap()},"clear"),Map2.prototype.sort=__name(function(comparator){return OrderedMap(sortFactory(this,comparator))},"sort"),Map2.prototype.sortBy=__name(function(mapper,comparator){return OrderedMap(sortFactory(this,comparator,mapper))},"sortBy"),Map2.prototype.map=__name(function(mapper,context2){var this$1$1=this;return this.withMutations(function(map3){map3.forEach(function(value,key){map3.set(key,mapper.call(context2,value,key,this$1$1))})})},"map"),Map2.prototype.__iterator=__name(function(type,reverse3){return new MapIterator(this,type,reverse3)},"__iterator"),Map2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this,iterations=0;return this._root&&this._root.iterate(function(entry){return iterations++,fn(entry[1],entry[0],this$1$1)},reverse3),iterations},"__iterate"),Map2.prototype.__ensureOwner=__name(function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeMap(this.size,this._root,ownerID,this.__hash):this.size===0?emptyMap():(this.__ownerID=ownerID,this.__altered=!1,this)},"__ensureOwner"),Map2}(KeyedCollection);Map$1.isMap=isMap;var MapPrototype=Map$1.prototype;MapPrototype[IS_MAP_SYMBOL]=!0;MapPrototype[DELETE]=MapPrototype.remove;MapPrototype.removeAll=MapPrototype.deleteAll;MapPrototype.setIn=setIn;MapPrototype.removeIn=MapPrototype.deleteIn=deleteIn;MapPrototype.update=update;MapPrototype.updateIn=updateIn;MapPrototype.merge=MapPrototype.concat=merge$1;MapPrototype.mergeWith=mergeWith$1;MapPrototype.mergeDeep=mergeDeep;MapPrototype.mergeDeepWith=mergeDeepWith;MapPrototype.mergeIn=mergeIn;MapPrototype.mergeDeepIn=mergeDeepIn;MapPrototype.withMutations=withMutations;MapPrototype.wasAltered=wasAltered;MapPrototype.asImmutable=asImmutable;MapPrototype["@@transducer/init"]=MapPrototype.asMutable=asMutable;MapPrototype["@@transducer/step"]=function(result,arr){return result.set(arr[0],arr[1])};MapPrototype["@@transducer/result"]=function(obj){return obj.asImmutable()};var ArrayMapNode=__name(function(ownerID,entries3){this.ownerID=ownerID,this.entries=entries3},"ArrayMapNode");ArrayMapNode.prototype.get=__name(function(shift,keyHash,key,notSetValue){for(var entries3=this.entries,ii=0,len=entries3.length;ii<len;ii++)if(is(key,entries3[ii][0]))return entries3[ii][1];return notSetValue},"get");ArrayMapNode.prototype.update=__name(function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){for(var removed=value===NOT_SET,entries3=this.entries,idx=0,len=entries3.length;idx<len&&!is(key,entries3[idx][0]);idx++);var exists=idx<len;if(exists?entries3[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),!(removed&&entries3.length===1)){if(!exists&&!removed&&entries3.length>=MAX_ARRAY_MAP_SIZE)return createNodes(ownerID,entries3,key,value);var isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries3:arrCopy(entries3);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new ArrayMapNode(ownerID,newEntries)}},"update");var BitmapIndexedNode=__name(function(ownerID,bitmap,nodes){this.ownerID=ownerID,this.bitmap=bitmap,this.nodes=nodes},"BitmapIndexedNode");BitmapIndexedNode.prototype.get=__name(function(shift,keyHash,key,notSetValue){keyHash===void 0&&(keyHash=hash$1(key));var bit=1<<((shift===0?keyHash:keyHash>>>shift)&MASK),bitmap=this.bitmap;return bitmap&bit?this.nodes[popCount(bitmap&bit-1)].get(shift+SHIFT,keyHash,key,notSetValue):notSetValue},"get");BitmapIndexedNode.prototype.update=__name(function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){keyHash===void 0&&(keyHash=hash$1(key));var keyHashFrag=(shift===0?keyHash:keyHash>>>shift)&MASK,bit=1<<keyHashFrag,bitmap=this.bitmap,exists=(bitmap&bit)!==0;if(!exists&&value===NOT_SET)return this;var idx=popCount(bitmap&bit-1),nodes=this.nodes,node2=exists?nodes[idx]:void 0,newNode=updateNode(node2,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node2)return this;if(!exists&&newNode&&nodes.length>=MAX_BITMAP_INDEXED_SIZE)return expandNodes(ownerID,nodes,bitmap,keyHashFrag,newNode);if(exists&&!newNode&&nodes.length===2&&isLeafNode(nodes[idx^1]))return nodes[idx^1];if(exists&&newNode&&nodes.length===1&&isLeafNode(newNode))return newNode;var isEditable=ownerID&&ownerID===this.ownerID,newBitmap=exists?newNode?bitmap:bitmap^bit:bitmap|bit,newNodes=exists?newNode?setAt(nodes,idx,newNode,isEditable):spliceOut(nodes,idx,isEditable):spliceIn(nodes,idx,newNode,isEditable);return isEditable?(this.bitmap=newBitmap,this.nodes=newNodes,this):new BitmapIndexedNode(ownerID,newBitmap,newNodes)},"update");var HashArrayMapNode=__name(function(ownerID,count2,nodes){this.ownerID=ownerID,this.count=count2,this.nodes=nodes},"HashArrayMapNode");HashArrayMapNode.prototype.get=__name(function(shift,keyHash,key,notSetValue){keyHash===void 0&&(keyHash=hash$1(key));var idx=(shift===0?keyHash:keyHash>>>shift)&MASK,node2=this.nodes[idx];return node2?node2.get(shift+SHIFT,keyHash,key,notSetValue):notSetValue},"get");HashArrayMapNode.prototype.update=__name(function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){keyHash===void 0&&(keyHash=hash$1(key));var idx=(shift===0?keyHash:keyHash>>>shift)&MASK,removed=value===NOT_SET,nodes=this.nodes,node2=nodes[idx];if(removed&&!node2)return this;var newNode=updateNode(node2,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node2)return this;var newCount=this.count;if(!node2)newCount++;else if(!newNode&&(newCount--,newCount<MIN_HASH_ARRAY_MAP_SIZE))return packNodes(ownerID,nodes,newCount,idx);var isEditable=ownerID&&ownerID===this.ownerID,newNodes=setAt(nodes,idx,newNode,isEditable);return isEditable?(this.count=newCount,this.nodes=newNodes,this):new HashArrayMapNode(ownerID,newCount,newNodes)},"update");var HashCollisionNode=__name(function(ownerID,keyHash,entries3){this.ownerID=ownerID,this.keyHash=keyHash,this.entries=entries3},"HashCollisionNode");HashCollisionNode.prototype.get=__name(function(shift,keyHash,key,notSetValue){for(var entries3=this.entries,ii=0,len=entries3.length;ii<len;ii++)if(is(key,entries3[ii][0]))return entries3[ii][1];return notSetValue},"get");HashCollisionNode.prototype.update=__name(function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){keyHash===void 0&&(keyHash=hash$1(key));var removed=value===NOT_SET;if(keyHash!==this.keyHash)return removed?this:(SetRef(didAlter),SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,keyHash,[key,value]));for(var entries3=this.entries,idx=0,len=entries3.length;idx<len&&!is(key,entries3[idx][0]);idx++);var exists=idx<len;if(exists?entries3[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),removed&&len===2)return new ValueNode(ownerID,this.keyHash,entries3[idx^1]);var isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries3:arrCopy(entries3);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new HashCollisionNode(ownerID,this.keyHash,newEntries)},"update");var ValueNode=__name(function(ownerID,keyHash,entry){this.ownerID=ownerID,this.keyHash=keyHash,this.entry=entry},"ValueNode");ValueNode.prototype.get=__name(function(shift,keyHash,key,notSetValue){return is(key,this.entry[0])?this.entry[1]:notSetValue},"get");ValueNode.prototype.update=__name(function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){var removed=value===NOT_SET,keyMatch=is(key,this.entry[0]);if(keyMatch?value===this.entry[1]:removed)return this;if(SetRef(didAlter),removed){SetRef(didChangeSize);return}return keyMatch?ownerID&&ownerID===this.ownerID?(this.entry[1]=value,this):new ValueNode(ownerID,this.keyHash,[key,value]):(SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,hash$1(key),[key,value]))},"update");ArrayMapNode.prototype.iterate=HashCollisionNode.prototype.iterate=function(fn,reverse3){for(var entries3=this.entries,ii=0,maxIndex=entries3.length-1;ii<=maxIndex;ii++)if(fn(entries3[reverse3?maxIndex-ii:ii])===!1)return!1};BitmapIndexedNode.prototype.iterate=HashArrayMapNode.prototype.iterate=function(fn,reverse3){for(var nodes=this.nodes,ii=0,maxIndex=nodes.length-1;ii<=maxIndex;ii++){var node2=nodes[reverse3?maxIndex-ii:ii];if(node2&&node2.iterate(fn,reverse3)===!1)return!1}};ValueNode.prototype.iterate=function(fn,reverse3){return fn(this.entry)};var MapIterator=function(Iterator3){function MapIterator2(map2,type,reverse3){this._type=type,this._reverse=reverse3,this._stack=map2._root&&mapIteratorFrame(map2._root)}return __name(MapIterator2,"MapIterator"),Iterator3&&(MapIterator2.__proto__=Iterator3),MapIterator2.prototype=Object.create(Iterator3&&Iterator3.prototype),MapIterator2.prototype.constructor=MapIterator2,MapIterator2.prototype.next=__name(function(){for(var type=this._type,stack=this._stack;stack;){var node2=stack.node,index=stack.index++,maxIndex=void 0;if(node2.entry){if(index===0)return mapIteratorValue(type,node2.entry)}else if(node2.entries){if(maxIndex=node2.entries.length-1,index<=maxIndex)return mapIteratorValue(type,node2.entries[this._reverse?maxIndex-index:index])}else if(maxIndex=node2.nodes.length-1,index<=maxIndex){var subNode=node2.nodes[this._reverse?maxIndex-index:index];if(subNode){if(subNode.entry)return mapIteratorValue(type,subNode.entry);stack=this._stack=mapIteratorFrame(subNode,stack)}continue}stack=this._stack=this._stack.__prev}return iteratorDone()},"next"),MapIterator2}(Iterator);function mapIteratorValue(type,entry){return iteratorValue(type,entry[0],entry[1])}__name(mapIteratorValue,"mapIteratorValue");function mapIteratorFrame(node2,prev){return{node:node2,index:0,__prev:prev}}__name(mapIteratorFrame,"mapIteratorFrame");function makeMap(size,root,ownerID,hash2){var map2=Object.create(MapPrototype);return map2.size=size,map2._root=root,map2.__ownerID=ownerID,map2.__hash=hash2,map2.__altered=!1,map2}__name(makeMap,"makeMap");var EMPTY_MAP;function emptyMap(){return EMPTY_MAP||(EMPTY_MAP=makeMap(0))}__name(emptyMap,"emptyMap");function updateMap(map2,k,v){var newRoot,newSize;if(map2._root){var didChangeSize=MakeRef(),didAlter=MakeRef();if(newRoot=updateNode(map2._root,map2.__ownerID,0,void 0,k,v,didChangeSize,didAlter),!didAlter.value)return map2;newSize=map2.size+(didChangeSize.value?v===NOT_SET?-1:1:0)}else{if(v===NOT_SET)return map2;newSize=1,newRoot=new ArrayMapNode(map2.__ownerID,[[k,v]])}return map2.__ownerID?(map2.size=newSize,map2._root=newRoot,map2.__hash=void 0,map2.__altered=!0,map2):newRoot?makeMap(newSize,newRoot):emptyMap()}__name(updateMap,"updateMap");function updateNode(node2,ownerID,shift,keyHash,key,value,didChangeSize,didAlter){return node2?node2.update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter):value===NOT_SET?node2:(SetRef(didAlter),SetRef(didChangeSize),new ValueNode(ownerID,keyHash,[key,value]))}__name(updateNode,"updateNode");function isLeafNode(node2){return node2.constructor===ValueNode||node2.constructor===HashCollisionNode}__name(isLeafNode,"isLeafNode");function mergeIntoNode(node2,ownerID,shift,keyHash,entry){if(node2.keyHash===keyHash)return new HashCollisionNode(ownerID,keyHash,[node2.entry,entry]);var idx1=(shift===0?node2.keyHash:node2.keyHash>>>shift)&MASK,idx2=(shift===0?keyHash:keyHash>>>shift)&MASK,newNode,nodes=idx1===idx2?[mergeIntoNode(node2,ownerID,shift+SHIFT,keyHash,entry)]:(newNode=new ValueNode(ownerID,keyHash,entry),idx1<idx2?[node2,newNode]:[newNode,node2]);return new BitmapIndexedNode(ownerID,1<<idx1|1<<idx2,nodes)}__name(mergeIntoNode,"mergeIntoNode");function createNodes(ownerID,entries3,key,value){ownerID||(ownerID=new OwnerID);for(var node2=new ValueNode(ownerID,hash$1(key),[key,value]),ii=0;ii<entries3.length;ii++){var entry=entries3[ii];node2=node2.update(ownerID,0,void 0,entry[0],entry[1])}return node2}__name(createNodes,"createNodes");function packNodes(ownerID,nodes,count2,excluding){for(var bitmap=0,packedII=0,packedNodes=new Array(count2),ii=0,bit=1,len=nodes.length;ii<len;ii++,bit<<=1){var node2=nodes[ii];node2!==void 0&&ii!==excluding&&(bitmap|=bit,packedNodes[packedII++]=node2)}return new BitmapIndexedNode(ownerID,bitmap,packedNodes)}__name(packNodes,"packNodes");function expandNodes(ownerID,nodes,bitmap,including,node2){for(var count2=0,expandedNodes=new Array(SIZE),ii=0;bitmap!==0;ii++,bitmap>>>=1)expandedNodes[ii]=bitmap&1?nodes[count2++]:void 0;return expandedNodes[including]=node2,new HashArrayMapNode(ownerID,count2+1,expandedNodes)}__name(expandNodes,"expandNodes");function popCount(x){return x-=x>>1&1431655765,x=(x&858993459)+(x>>2&858993459),x=x+(x>>4)&252645135,x+=x>>8,x+=x>>16,x&127}__name(popCount,"popCount");function setAt(array,idx,val,canEdit){var newArray=canEdit?array:arrCopy(array);return newArray[idx]=val,newArray}__name(setAt,"setAt");function spliceIn(array,idx,val,canEdit){var newLen=array.length+1;if(canEdit&&idx+1===newLen)return array[idx]=val,array;for(var newArray=new Array(newLen),after=0,ii=0;ii<newLen;ii++)ii===idx?(newArray[ii]=val,after=-1):newArray[ii]=array[ii+after];return newArray}__name(spliceIn,"spliceIn");function spliceOut(array,idx,canEdit){var newLen=array.length-1;if(canEdit&&idx===newLen)return array.pop(),array;for(var newArray=new Array(newLen),after=0,ii=0;ii<newLen;ii++)ii===idx&&(after=1),newArray[ii]=array[ii+after];return newArray}__name(spliceOut,"spliceOut");var MAX_ARRAY_MAP_SIZE=SIZE/4,MAX_BITMAP_INDEXED_SIZE=SIZE/2,MIN_HASH_ARRAY_MAP_SIZE=SIZE/4,IS_LIST_SYMBOL="@@__IMMUTABLE_LIST__@@";function isList(maybeList){return!!(maybeList&&maybeList[IS_LIST_SYMBOL])}__name(isList,"isList");var List=function(IndexedCollection2){function List2(value){var empty=emptyList();if(value==null)return empty;if(isList(value))return value;var iter=IndexedCollection2(value),size=iter.size;return size===0?empty:(assertNotInfinite(size),size>0&&size<SIZE?makeList(0,size,SHIFT,null,new VNode(iter.toArray())):empty.withMutations(function(list){list.setSize(size),iter.forEach(function(v,i){return list.set(i,v)})}))}return __name(List2,"List"),IndexedCollection2&&(List2.__proto__=IndexedCollection2),List2.prototype=Object.create(IndexedCollection2&&IndexedCollection2.prototype),List2.prototype.constructor=List2,List2.of=__name(function(){return this(arguments)},"of"),List2.prototype.toString=__name(function(){return this.__toString("List [","]")},"toString"),List2.prototype.get=__name(function(index,notSetValue){if(index=wrapIndex(this,index),index>=0&&index<this.size){index+=this._origin;var node2=listNodeFor(this,index);return node2&&node2.array[index&MASK]}return notSetValue},"get"),List2.prototype.set=__name(function(index,value){return updateList(this,index,value)},"set"),List2.prototype.remove=__name(function(index){return this.has(index)?index===0?this.shift():index===this.size-1?this.pop():this.splice(index,1):this},"remove"),List2.prototype.insert=__name(function(index,value){return this.splice(index,0,value)},"insert"),List2.prototype.clear=__name(function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=SHIFT,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):emptyList()},"clear"),List2.prototype.push=__name(function(){var values2=arguments,oldSize=this.size;return this.withMutations(function(list){setListBounds(list,0,oldSize+values2.length);for(var ii=0;ii<values2.length;ii++)list.set(oldSize+ii,values2[ii])})},"push"),List2.prototype.pop=__name(function(){return setListBounds(this,0,-1)},"pop"),List2.prototype.unshift=__name(function(){var values2=arguments;return this.withMutations(function(list){setListBounds(list,-values2.length);for(var ii=0;ii<values2.length;ii++)list.set(ii,values2[ii])})},"unshift"),List2.prototype.shift=__name(function(){return setListBounds(this,1)},"shift"),List2.prototype.concat=__name(function(){for(var arguments$1=arguments,seqs=[],i=0;i<arguments.length;i++){var argument=arguments$1[i],seq=IndexedCollection2(typeof argument!="string"&&hasIterator(argument)?argument:[argument]);seq.size!==0&&seqs.push(seq)}return seqs.length===0?this:this.size===0&&!this.__ownerID&&seqs.length===1?this.constructor(seqs[0]):this.withMutations(function(list){seqs.forEach(function(seq2){return seq2.forEach(function(value){return list.push(value)})})})},"concat"),List2.prototype.setSize=__name(function(size){return setListBounds(this,0,size)},"setSize"),List2.prototype.map=__name(function(mapper,context2){var this$1$1=this;return this.withMutations(function(list){for(var i=0;i<this$1$1.size;i++)list.set(i,mapper.call(context2,list.get(i),i,this$1$1))})},"map"),List2.prototype.slice=__name(function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:setListBounds(this,resolveBegin(begin,size),resolveEnd(end,size))},"slice"),List2.prototype.__iterator=__name(function(type,reverse3){var index=reverse3?this.size:0,values2=iterateList(this,reverse3);return new Iterator(function(){var value=values2();return value===DONE?iteratorDone():iteratorValue(type,reverse3?--index:index++,value)})},"__iterator"),List2.prototype.__iterate=__name(function(fn,reverse3){for(var index=reverse3?this.size:0,values2=iterateList(this,reverse3),value;(value=values2())!==DONE&&fn(value,reverse3?--index:index++,this)!==!1;);return index},"__iterate"),List2.prototype.__ensureOwner=__name(function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeList(this._origin,this._capacity,this._level,this._root,this._tail,ownerID,this.__hash):this.size===0?emptyList():(this.__ownerID=ownerID,this.__altered=!1,this)},"__ensureOwner"),List2}(IndexedCollection);List.isList=isList;var ListPrototype=List.prototype;ListPrototype[IS_LIST_SYMBOL]=!0;ListPrototype[DELETE]=ListPrototype.remove;ListPrototype.merge=ListPrototype.concat;ListPrototype.setIn=setIn;ListPrototype.deleteIn=ListPrototype.removeIn=deleteIn;ListPrototype.update=update;ListPrototype.updateIn=updateIn;ListPrototype.mergeIn=mergeIn;ListPrototype.mergeDeepIn=mergeDeepIn;ListPrototype.withMutations=withMutations;ListPrototype.wasAltered=wasAltered;ListPrototype.asImmutable=asImmutable;ListPrototype["@@transducer/init"]=ListPrototype.asMutable=asMutable;ListPrototype["@@transducer/step"]=function(result,arr){return result.push(arr)};ListPrototype["@@transducer/result"]=function(obj){return obj.asImmutable()};var VNode=__name(function(array,ownerID){this.array=array,this.ownerID=ownerID},"VNode");VNode.prototype.removeBefore=__name(function(ownerID,level,index){if(index===level?1<<level:this.array.length===0)return this;var originIndex=index>>>level&MASK;if(originIndex>=this.array.length)return new VNode([],ownerID);var removingFirst=originIndex===0,newChild;if(level>0){var oldChild=this.array[originIndex];if(newChild=oldChild&&oldChild.removeBefore(ownerID,level-SHIFT,index),newChild===oldChild&&removingFirst)return this}if(removingFirst&&!newChild)return this;var editable=editableVNode(this,ownerID);if(!removingFirst)for(var ii=0;ii<originIndex;ii++)editable.array[ii]=void 0;return newChild&&(editable.array[originIndex]=newChild),editable},"removeBefore");VNode.prototype.removeAfter=__name(function(ownerID,level,index){if(index===(level?1<<level:0)||this.array.length===0)return this;var sizeIndex=index-1>>>level&MASK;if(sizeIndex>=this.array.length)return this;var newChild;if(level>0){var oldChild=this.array[sizeIndex];if(newChild=oldChild&&oldChild.removeAfter(ownerID,level-SHIFT,index),newChild===oldChild&&sizeIndex===this.array.length-1)return this}var editable=editableVNode(this,ownerID);return editable.array.splice(sizeIndex+1),newChild&&(editable.array[sizeIndex]=newChild),editable},"removeAfter");var DONE={};function iterateList(list,reverse3){var left=list._origin,right=list._capacity,tailPos=getTailOffset(right),tail=list._tail;return iterateNodeOrLeaf(list._root,list._level,0);function iterateNodeOrLeaf(node2,level,offset){return level===0?iterateLeaf(node2,offset):iterateNode(node2,level,offset)}function iterateLeaf(node2,offset){var array=offset===tailPos?tail&&tail.array:node2&&node2.array,from=offset>left?0:left-offset,to=right-offset;return to>SIZE&&(to=SIZE),function(){if(from===to)return DONE;var idx=reverse3?--to:from++;return array&&array[idx]}}function iterateNode(node2,level,offset){var values2,array=node2&&node2.array,from=offset>left?0:left-offset>>level,to=(right-offset>>level)+1;return to>SIZE&&(to=SIZE),function(){for(;;){if(values2){var value=values2();if(value!==DONE)return value;values2=null}if(from===to)return DONE;var idx=reverse3?--to:from++;values2=iterateNodeOrLeaf(array&&array[idx],level-SHIFT,offset+(idx<<level))}}}}__name(iterateList,"iterateList");function makeList(origin,capacity,level,root,tail,ownerID,hash2){var list=Object.create(ListPrototype);return list.size=capacity-origin,list._origin=origin,list._capacity=capacity,list._level=level,list._root=root,list._tail=tail,list.__ownerID=ownerID,list.__hash=hash2,list.__altered=!1,list}__name(makeList,"makeList");var EMPTY_LIST;function emptyList(){return EMPTY_LIST||(EMPTY_LIST=makeList(0,0,SHIFT))}__name(emptyList,"emptyList");function updateList(list,index,value){if(index=wrapIndex(list,index),index!==index)return list;if(index>=list.size||index<0)return list.withMutations(function(list2){index<0?setListBounds(list2,index).set(0,value):setListBounds(list2,0,index+1).set(index,value)});index+=list._origin;var newTail=list._tail,newRoot=list._root,didAlter=MakeRef();return index>=getTailOffset(list._capacity)?newTail=updateVNode(newTail,list.__ownerID,0,index,value,didAlter):newRoot=updateVNode(newRoot,list.__ownerID,list._level,index,value,didAlter),didAlter.value?list.__ownerID?(list._root=newRoot,list._tail=newTail,list.__hash=void 0,list.__altered=!0,list):makeList(list._origin,list._capacity,list._level,newRoot,newTail):list}__name(updateList,"updateList");function updateVNode(node2,ownerID,level,index,value,didAlter){var idx=index>>>level&MASK,nodeHas=node2&&idx<node2.array.length;if(!nodeHas&&value===void 0)return node2;var newNode;if(level>0){var lowerNode=node2&&node2.array[idx],newLowerNode=updateVNode(lowerNode,ownerID,level-SHIFT,index,value,didAlter);return newLowerNode===lowerNode?node2:(newNode=editableVNode(node2,ownerID),newNode.array[idx]=newLowerNode,newNode)}return nodeHas&&node2.array[idx]===value?node2:(didAlter&&SetRef(didAlter),newNode=editableVNode(node2,ownerID),value===void 0&&idx===newNode.array.length-1?newNode.array.pop():newNode.array[idx]=value,newNode)}__name(updateVNode,"updateVNode");function editableVNode(node2,ownerID){return ownerID&&node2&&ownerID===node2.ownerID?node2:new VNode(node2?node2.array.slice():[],ownerID)}__name(editableVNode,"editableVNode");function listNodeFor(list,rawIndex){if(rawIndex>=getTailOffset(list._capacity))return list._tail;if(rawIndex<1<<list._level+SHIFT){for(var node2=list._root,level=list._level;node2&&level>0;)node2=node2.array[rawIndex>>>level&MASK],level-=SHIFT;return node2}}__name(listNodeFor,"listNodeFor");function setListBounds(list,begin,end){begin!==void 0&&(begin|=0),end!==void 0&&(end|=0);var owner=list.__ownerID||new OwnerID,oldOrigin=list._origin,oldCapacity=list._capacity,newOrigin=oldOrigin+begin,newCapacity=end===void 0?oldCapacity:end<0?oldCapacity+end:oldOrigin+end;if(newOrigin===oldOrigin&&newCapacity===oldCapacity)return list;if(newOrigin>=newCapacity)return list.clear();for(var newLevel=list._level,newRoot=list._root,offsetShift=0;newOrigin+offsetShift<0;)newRoot=new VNode(newRoot&&newRoot.array.length?[void 0,newRoot]:[],owner),newLevel+=SHIFT,offsetShift+=1<<newLevel;offsetShift&&(newOrigin+=offsetShift,oldOrigin+=offsetShift,newCapacity+=offsetShift,oldCapacity+=offsetShift);for(var oldTailOffset=getTailOffset(oldCapacity),newTailOffset=getTailOffset(newCapacity);newTailOffset>=1<<newLevel+SHIFT;)newRoot=new VNode(newRoot&&newRoot.array.length?[newRoot]:[],owner),newLevel+=SHIFT;var oldTail=list._tail,newTail=newTailOffset<oldTailOffset?listNodeFor(list,newCapacity-1):newTailOffset>oldTailOffset?new VNode([],owner):oldTail;if(oldTail&&newTailOffset>oldTailOffset&&newOrigin<oldCapacity&&oldTail.array.length){newRoot=editableVNode(newRoot,owner);for(var node2=newRoot,level=newLevel;level>SHIFT;level-=SHIFT){var idx=oldTailOffset>>>level&MASK;node2=node2.array[idx]=editableVNode(node2.array[idx],owner)}node2.array[oldTailOffset>>>SHIFT&MASK]=oldTail}if(newCapacity<oldCapacity&&(newTail=newTail&&newTail.removeAfter(owner,0,newCapacity)),newOrigin>=newTailOffset)newOrigin-=newTailOffset,newCapacity-=newTailOffset,newLevel=SHIFT,newRoot=null,newTail=newTail&&newTail.removeBefore(owner,0,newOrigin);else if(newOrigin>oldOrigin||newTailOffset<oldTailOffset){for(offsetShift=0;newRoot;){var beginIndex=newOrigin>>>newLevel&MASK;if(beginIndex!==newTailOffset>>>newLevel&MASK)break;beginIndex&&(offsetShift+=(1<<newLevel)*beginIndex),newLevel-=SHIFT,newRoot=newRoot.array[beginIndex]}newRoot&&newOrigin>oldOrigin&&(newRoot=newRoot.removeBefore(owner,newLevel,newOrigin-offsetShift)),newRoot&&newTailOffset<oldTailOffset&&(newRoot=newRoot.removeAfter(owner,newLevel,newTailOffset-offsetShift)),offsetShift&&(newOrigin-=offsetShift,newCapacity-=offsetShift)}return list.__ownerID?(list.size=newCapacity-newOrigin,list._origin=newOrigin,list._capacity=newCapacity,list._level=newLevel,list._root=newRoot,list._tail=newTail,list.__hash=void 0,list.__altered=!0,list):makeList(newOrigin,newCapacity,newLevel,newRoot,newTail)}__name(setListBounds,"setListBounds");function getTailOffset(size){return size<SIZE?0:size-1>>>SHIFT<<SHIFT}__name(getTailOffset,"getTailOffset");var OrderedMap=function(Map2){function OrderedMap2(value){return value==null?emptyOrderedMap():isOrderedMap(value)?value:emptyOrderedMap().withMutations(function(map2){var iter=KeyedCollection(value);assertNotInfinite(iter.size),iter.forEach(function(v,k){return map2.set(k,v)})})}return __name(OrderedMap2,"OrderedMap"),Map2&&(OrderedMap2.__proto__=Map2),OrderedMap2.prototype=Object.create(Map2&&Map2.prototype),OrderedMap2.prototype.constructor=OrderedMap2,OrderedMap2.of=__name(function(){return this(arguments)},"of"),OrderedMap2.prototype.toString=__name(function(){return this.__toString("OrderedMap {","}")},"toString"),OrderedMap2.prototype.get=__name(function(k,notSetValue){var index=this._map.get(k);return index!==void 0?this._list.get(index)[1]:notSetValue},"get"),OrderedMap2.prototype.clear=__name(function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):emptyOrderedMap()},"clear"),OrderedMap2.prototype.set=__name(function(k,v){return updateOrderedMap(this,k,v)},"set"),OrderedMap2.prototype.remove=__name(function(k){return updateOrderedMap(this,k,NOT_SET)},"remove"),OrderedMap2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this;return this._list.__iterate(function(entry){return entry&&fn(entry[1],entry[0],this$1$1)},reverse3)},"__iterate"),OrderedMap2.prototype.__iterator=__name(function(type,reverse3){return this._list.fromEntrySeq().__iterator(type,reverse3)},"__iterator"),OrderedMap2.prototype.__ensureOwner=__name(function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map.__ensureOwner(ownerID),newList=this._list.__ensureOwner(ownerID);return ownerID?makeOrderedMap(newMap,newList,ownerID,this.__hash):this.size===0?emptyOrderedMap():(this.__ownerID=ownerID,this.__altered=!1,this._map=newMap,this._list=newList,this)},"__ensureOwner"),OrderedMap2}(Map$1);OrderedMap.isOrderedMap=isOrderedMap;OrderedMap.prototype[IS_ORDERED_SYMBOL]=!0;OrderedMap.prototype[DELETE]=OrderedMap.prototype.remove;function makeOrderedMap(map2,list,ownerID,hash2){var omap=Object.create(OrderedMap.prototype);return omap.size=map2?map2.size:0,omap._map=map2,omap._list=list,omap.__ownerID=ownerID,omap.__hash=hash2,omap.__altered=!1,omap}__name(makeOrderedMap,"makeOrderedMap");var EMPTY_ORDERED_MAP;function emptyOrderedMap(){return EMPTY_ORDERED_MAP||(EMPTY_ORDERED_MAP=makeOrderedMap(emptyMap(),emptyList()))}__name(emptyOrderedMap,"emptyOrderedMap");function updateOrderedMap(omap,k,v){var map2=omap._map,list=omap._list,i=map2.get(k),has5=i!==void 0,newMap,newList;if(v===NOT_SET){if(!has5)return omap;list.size>=SIZE&&list.size>=map2.size*2?(newList=list.filter(function(entry,idx){return entry!==void 0&&i!==idx}),newMap=newList.toKeyedSeq().map(function(entry){return entry[0]}).flip().toMap(),omap.__ownerID&&(newMap.__ownerID=newList.__ownerID=omap.__ownerID)):(newMap=map2.remove(k),newList=i===list.size-1?list.pop():list.set(i,void 0))}else if(has5){if(v===list.get(i)[1])return omap;newMap=map2,newList=list.set(i,[k,v])}else newMap=map2.set(k,list.size),newList=list.set(list.size,[k,v]);return omap.__ownerID?(omap.size=newMap.size,omap._map=newMap,omap._list=newList,omap.__hash=void 0,omap.__altered=!0,omap):makeOrderedMap(newMap,newList)}__name(updateOrderedMap,"updateOrderedMap");var IS_STACK_SYMBOL="@@__IMMUTABLE_STACK__@@";function isStack(maybeStack){return!!(maybeStack&&maybeStack[IS_STACK_SYMBOL])}__name(isStack,"isStack");var Stack$1=function(IndexedCollection2){function Stack2(value){return value==null?emptyStack():isStack(value)?value:emptyStack().pushAll(value)}return __name(Stack2,"Stack"),IndexedCollection2&&(Stack2.__proto__=IndexedCollection2),Stack2.prototype=Object.create(IndexedCollection2&&IndexedCollection2.prototype),Stack2.prototype.constructor=Stack2,Stack2.of=__name(function(){return this(arguments)},"of"),Stack2.prototype.toString=__name(function(){return this.__toString("Stack [","]")},"toString"),Stack2.prototype.get=__name(function(index,notSetValue){var head2=this._head;for(index=wrapIndex(this,index);head2&&index--;)head2=head2.next;return head2?head2.value:notSetValue},"get"),Stack2.prototype.peek=__name(function(){return this._head&&this._head.value},"peek"),Stack2.prototype.push=__name(function(){var arguments$1=arguments;if(arguments.length===0)return this;for(var newSize=this.size+arguments.length,head2=this._head,ii=arguments.length-1;ii>=0;ii--)head2={value:arguments$1[ii],next:head2};return this.__ownerID?(this.size=newSize,this._head=head2,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head2)},"push"),Stack2.prototype.pushAll=__name(function(iter){if(iter=IndexedCollection2(iter),iter.size===0)return this;if(this.size===0&&isStack(iter))return iter;assertNotInfinite(iter.size);var newSize=this.size,head2=this._head;return iter.__iterate(function(value){newSize++,head2={value,next:head2}},!0),this.__ownerID?(this.size=newSize,this._head=head2,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head2)},"pushAll"),Stack2.prototype.pop=__name(function(){return this.slice(1)},"pop"),Stack2.prototype.clear=__name(function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):emptyStack()},"clear"),Stack2.prototype.slice=__name(function(begin,end){if(wholeSlice(begin,end,this.size))return this;var resolvedBegin=resolveBegin(begin,this.size),resolvedEnd=resolveEnd(end,this.size);if(resolvedEnd!==this.size)return IndexedCollection2.prototype.slice.call(this,begin,end);for(var newSize=this.size-resolvedBegin,head2=this._head;resolvedBegin--;)head2=head2.next;return this.__ownerID?(this.size=newSize,this._head=head2,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head2)},"slice"),Stack2.prototype.__ensureOwner=__name(function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeStack(this.size,this._head,ownerID,this.__hash):this.size===0?emptyStack():(this.__ownerID=ownerID,this.__altered=!1,this)},"__ensureOwner"),Stack2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this;if(reverse3)return new ArraySeq(this.toArray()).__iterate(function(v,k){return fn(v,k,this$1$1)},reverse3);for(var iterations=0,node2=this._head;node2&&fn(node2.value,iterations++,this)!==!1;)node2=node2.next;return iterations},"__iterate"),Stack2.prototype.__iterator=__name(function(type,reverse3){if(reverse3)return new ArraySeq(this.toArray()).__iterator(type,reverse3);var iterations=0,node2=this._head;return new Iterator(function(){if(node2){var value=node2.value;return node2=node2.next,iteratorValue(type,iterations++,value)}return iteratorDone()})},"__iterator"),Stack2}(IndexedCollection);Stack$1.isStack=isStack;var StackPrototype=Stack$1.prototype;StackPrototype[IS_STACK_SYMBOL]=!0;StackPrototype.shift=StackPrototype.pop;StackPrototype.unshift=StackPrototype.push;StackPrototype.unshiftAll=StackPrototype.pushAll;StackPrototype.withMutations=withMutations;StackPrototype.wasAltered=wasAltered;StackPrototype.asImmutable=asImmutable;StackPrototype["@@transducer/init"]=StackPrototype.asMutable=asMutable;StackPrototype["@@transducer/step"]=function(result,arr){return result.unshift(arr)};StackPrototype["@@transducer/result"]=function(obj){return obj.asImmutable()};function makeStack(size,head2,ownerID,hash2){var map2=Object.create(StackPrototype);return map2.size=size,map2._head=head2,map2.__ownerID=ownerID,map2.__hash=hash2,map2.__altered=!1,map2}__name(makeStack,"makeStack");var EMPTY_STACK;function emptyStack(){return EMPTY_STACK||(EMPTY_STACK=makeStack(0))}__name(emptyStack,"emptyStack");var IS_SET_SYMBOL="@@__IMMUTABLE_SET__@@";function isSet(maybeSet){return!!(maybeSet&&maybeSet[IS_SET_SYMBOL])}__name(isSet,"isSet");function isOrderedSet(maybeOrderedSet){return isSet(maybeOrderedSet)&&isOrdered(maybeOrderedSet)}__name(isOrderedSet,"isOrderedSet");function deepEqual(a,b){if(a===b)return!0;if(!isCollection(b)||a.size!==void 0&&b.size!==void 0&&a.size!==b.size||a.__hash!==void 0&&b.__hash!==void 0&&a.__hash!==b.__hash||isKeyed(a)!==isKeyed(b)||isIndexed(a)!==isIndexed(b)||isOrdered(a)!==isOrdered(b))return!1;if(a.size===0&&b.size===0)return!0;var notAssociative=!isAssociative(a);if(isOrdered(a)){var entries3=a.entries();return b.every(function(v,k){var entry=entries3.next().value;return entry&&is(entry[1],v)&&(notAssociative||is(entry[0],k))})&&entries3.next().done}var flipped=!1;if(a.size===void 0)if(b.size===void 0)typeof a.cacheResult=="function"&&a.cacheResult();else{flipped=!0;var _=a;a=b,b=_}var allEqual=!0,bSize=b.__iterate(function(v,k){if(notAssociative?!a.has(v):flipped?!is(v,a.get(k,NOT_SET)):!is(a.get(k,NOT_SET),v))return allEqual=!1,!1});return allEqual&&a.size===bSize}__name(deepEqual,"deepEqual");function mixin(ctor,methods){var keyCopier=__name(function(key){ctor.prototype[key]=methods[key]},"keyCopier");return Object.keys(methods).forEach(keyCopier),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(methods).forEach(keyCopier),ctor}__name(mixin,"mixin");function toJS(value){if(!value||typeof value!="object")return value;if(!isCollection(value)){if(!isDataStructure(value))return value;value=Seq(value)}if(isKeyed(value)){var result$1={};return value.__iterate(function(v,k){result$1[k]=toJS(v)}),result$1}var result=[];return value.__iterate(function(v){result.push(toJS(v))}),result}__name(toJS,"toJS");var Set$1=function(SetCollection2){function Set2(value){return value==null?emptySet():isSet(value)&&!isOrdered(value)?value:emptySet().withMutations(function(set3){var iter=SetCollection2(value);assertNotInfinite(iter.size),iter.forEach(function(v){return set3.add(v)})})}return __name(Set2,"Set"),SetCollection2&&(Set2.__proto__=SetCollection2),Set2.prototype=Object.create(SetCollection2&&SetCollection2.prototype),Set2.prototype.constructor=Set2,Set2.of=__name(function(){return this(arguments)},"of"),Set2.fromKeys=__name(function(value){return this(KeyedCollection(value).keySeq())},"fromKeys"),Set2.intersect=__name(function(sets){return sets=Collection(sets).toArray(),sets.length?SetPrototype.intersect.apply(Set2(sets.pop()),sets):emptySet()},"intersect"),Set2.union=__name(function(sets){return sets=Collection(sets).toArray(),sets.length?SetPrototype.union.apply(Set2(sets.pop()),sets):emptySet()},"union"),Set2.prototype.toString=__name(function(){return this.__toString("Set {","}")},"toString"),Set2.prototype.has=__name(function(value){return this._map.has(value)},"has"),Set2.prototype.add=__name(function(value){return updateSet(this,this._map.set(value,value))},"add"),Set2.prototype.remove=__name(function(value){return updateSet(this,this._map.remove(value))},"remove"),Set2.prototype.clear=__name(function(){return updateSet(this,this._map.clear())},"clear"),Set2.prototype.map=__name(function(mapper,context2){var this$1$1=this,didChanges=!1,newMap=updateSet(this,this._map.mapEntries(function(ref){var v=ref[1],mapped=mapper.call(context2,v,v,this$1$1);return mapped!==v&&(didChanges=!0),[mapped,mapped]},context2));return didChanges?newMap:this},"map"),Set2.prototype.union=__name(function(){for(var iters=[],len=arguments.length;len--;)iters[len]=arguments[len];return iters=iters.filter(function(x){return x.size!==0}),iters.length===0?this:this.size===0&&!this.__ownerID&&iters.length===1?this.constructor(iters[0]):this.withMutations(function(set3){for(var ii=0;ii<iters.length;ii++)typeof iters[ii]=="string"?set3.add(iters[ii]):SetCollection2(iters[ii]).forEach(function(value){return set3.add(value)})})},"union"),Set2.prototype.intersect=__name(function(){for(var iters=[],len=arguments.length;len--;)iters[len]=arguments[len];if(iters.length===0)return this;iters=iters.map(function(iter){return SetCollection2(iter)});var toRemove=[];return this.forEach(function(value){iters.every(function(iter){return iter.includes(value)})||toRemove.push(value)}),this.withMutations(function(set3){toRemove.forEach(function(value){set3.remove(value)})})},"intersect"),Set2.prototype.subtract=__name(function(){for(var iters=[],len=arguments.length;len--;)iters[len]=arguments[len];if(iters.length===0)return this;iters=iters.map(function(iter){return SetCollection2(iter)});var toRemove=[];return this.forEach(function(value){iters.some(function(iter){return iter.includes(value)})&&toRemove.push(value)}),this.withMutations(function(set3){toRemove.forEach(function(value){set3.remove(value)})})},"subtract"),Set2.prototype.sort=__name(function(comparator){return OrderedSet(sortFactory(this,comparator))},"sort"),Set2.prototype.sortBy=__name(function(mapper,comparator){return OrderedSet(sortFactory(this,comparator,mapper))},"sortBy"),Set2.prototype.wasAltered=__name(function(){return this._map.wasAltered()},"wasAltered"),Set2.prototype.__iterate=__name(function(fn,reverse3){var this$1$1=this;return this._map.__iterate(function(k){return fn(k,k,this$1$1)},reverse3)},"__iterate"),Set2.prototype.__iterator=__name(function(type,reverse3){return this._map.__iterator(type,reverse3)},"__iterator"),Set2.prototype.__ensureOwner=__name(function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map.__ensureOwner(ownerID);return ownerID?this.__make(newMap,ownerID):this.size===0?this.__empty():(this.__ownerID=ownerID,this._map=newMap,this)},"__ensureOwner"),Set2}(SetCollection);Set$1.isSet=isSet;var SetPrototype=Set$1.prototype;SetPrototype[IS_SET_SYMBOL]=!0;SetPrototype[DELETE]=SetPrototype.remove;SetPrototype.merge=SetPrototype.concat=SetPrototype.union;SetPrototype.withMutations=withMutations;SetPrototype.asImmutable=asImmutable;SetPrototype["@@transducer/init"]=SetPrototype.asMutable=asMutable;SetPrototype["@@transducer/step"]=function(result,arr){return result.add(arr)};SetPrototype["@@transducer/result"]=function(obj){return obj.asImmutable()};SetPrototype.__empty=emptySet;SetPrototype.__make=makeSet;function updateSet(set3,newMap){return set3.__ownerID?(set3.size=newMap.size,set3._map=newMap,set3):newMap===set3._map?set3:newMap.size===0?set3.__empty():set3.__make(newMap)}__name(updateSet,"updateSet");function makeSet(map2,ownerID){var set3=Object.create(SetPrototype);return set3.size=map2?map2.size:0,set3._map=map2,set3.__ownerID=ownerID,set3}__name(makeSet,"makeSet");var EMPTY_SET;function emptySet(){return EMPTY_SET||(EMPTY_SET=makeSet(emptyMap()))}__name(emptySet,"emptySet");var Range=function(IndexedSeq2){function Range2(start,end,step){if(!(this instanceof Range2))return new Range2(start,end,step);if(invariant$1(step!==0,"Cannot step a Range by 0"),start=start||0,end===void 0&&(end=1/0),step=step===void 0?1:Math.abs(step),end<start&&(step=-step),this._start=start,this._end=end,this._step=step,this.size=Math.max(0,Math.ceil((end-start)/step-1)+1),this.size===0){if(EMPTY_RANGE)return EMPTY_RANGE;EMPTY_RANGE=this}}return __name(Range2,"Range"),IndexedSeq2&&(Range2.__proto__=IndexedSeq2),Range2.prototype=Object.create(IndexedSeq2&&IndexedSeq2.prototype),Range2.prototype.constructor=Range2,Range2.prototype.toString=__name(function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},"toString"),Range2.prototype.get=__name(function(index,notSetValue){return this.has(index)?this._start+wrapIndex(this,index)*this._step:notSetValue},"get"),Range2.prototype.includes=__name(function(searchValue){var possibleIndex=(searchValue-this._start)/this._step;return possibleIndex>=0&&possibleIndex<this.size&&possibleIndex===Math.floor(possibleIndex)},"includes"),Range2.prototype.slice=__name(function(begin,end){return wholeSlice(begin,end,this.size)?this:(begin=resolveBegin(begin,this.size),end=resolveEnd(end,this.size),end<=begin?new Range2(0,0):new Range2(this.get(begin,this._end),this.get(end,this._end),this._step))},"slice"),Range2.prototype.indexOf=__name(function(searchValue){var offsetValue=searchValue-this._start;if(offsetValue%this._step===0){var index=offsetValue/this._step;if(index>=0&&index<this.size)return index}return-1},"indexOf"),Range2.prototype.lastIndexOf=__name(function(searchValue){return this.indexOf(searchValue)},"lastIndexOf"),Range2.prototype.__iterate=__name(function(fn,reverse3){for(var size=this.size,step=this._step,value=reverse3?this._start+(size-1)*step:this._start,i=0;i!==size&&fn(value,reverse3?size-++i:i++,this)!==!1;)value+=reverse3?-step:step;return i},"__iterate"),Range2.prototype.__iterator=__name(function(type,reverse3){var size=this.size,step=this._step,value=reverse3?this._start+(size-1)*step:this._start,i=0;return new Iterator(function(){if(i===size)return iteratorDone();var v=value;return value+=reverse3?-step:step,iteratorValue(type,reverse3?size-++i:i++,v)})},"__iterator"),Range2.prototype.equals=__name(function(other){return other instanceof Range2?this._start===other._start&&this._end===other._end&&this._step===other._step:deepEqual(this,other)},"equals"),Range2}(IndexedSeq),EMPTY_RANGE;function getIn$1(collection,searchKeyPath,notSetValue){for(var keyPath=coerceKeyPath(searchKeyPath),i=0;i!==keyPath.length;)if(collection=get$1(collection,keyPath[i++],NOT_SET),collection===NOT_SET)return notSetValue;return collection}__name(getIn$1,"getIn$1");function getIn(searchKeyPath,notSetValue){return getIn$1(this,searchKeyPath,notSetValue)}__name(getIn,"getIn");function hasIn$1(collection,keyPath){return getIn$1(collection,keyPath,NOT_SET)!==NOT_SET}__name(hasIn$1,"hasIn$1");function hasIn(searchKeyPath){return hasIn$1(this,searchKeyPath)}__name(hasIn,"hasIn");function toObject(){assertNotInfinite(this.size);var object2={};return this.__iterate(function(v,k){object2[k]=v}),object2}__name(toObject,"toObject");Collection.isIterable=isCollection;Collection.isKeyed=isKeyed;Collection.isIndexed=isIndexed;Collection.isAssociative=isAssociative;Collection.isOrdered=isOrdered;Collection.Iterator=Iterator;mixin(Collection,{toArray:__name(function(){assertNotInfinite(this.size);var array=new Array(this.size||0),useTuples=isKeyed(this),i=0;return this.__iterate(function(v,k){array[i++]=useTuples?[k,v]:v}),array},"toArray"),toIndexedSeq:__name(function(){return new ToIndexedSequence(this)},"toIndexedSeq"),toJS:__name(function(){return toJS(this)},"toJS$1"),toKeyedSeq:__name(function(){return new ToKeyedSequence(this,!0)},"toKeyedSeq"),toMap:__name(function(){return Map$1(this.toKeyedSeq())},"toMap"),toObject,toOrderedMap:__name(function(){return OrderedMap(this.toKeyedSeq())},"toOrderedMap"),toOrderedSet:__name(function(){return OrderedSet(isKeyed(this)?this.valueSeq():this)},"toOrderedSet"),toSet:__name(function(){return Set$1(isKeyed(this)?this.valueSeq():this)},"toSet"),toSetSeq:__name(function(){return new ToSetSequence(this)},"toSetSeq"),toSeq:__name(function(){return isIndexed(this)?this.toIndexedSeq():isKeyed(this)?this.toKeyedSeq():this.toSetSeq()},"toSeq"),toStack:__name(function(){return Stack$1(isKeyed(this)?this.valueSeq():this)},"toStack"),toList:__name(function(){return List(isKeyed(this)?this.valueSeq():this)},"toList"),toString:__name(function(){return"[Collection]"},"toString"),__toString:__name(function(head2,tail){return this.size===0?head2+tail:head2+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+tail},"__toString"),concat:__name(function(){for(var values2=[],len=arguments.length;len--;)values2[len]=arguments[len];return reify(this,concatFactory(this,values2))},"concat"),includes:__name(function(searchValue){return this.some(function(value){return is(value,searchValue)})},"includes"),entries:__name(function(){return this.__iterator(ITERATE_ENTRIES)},"entries"),every:__name(function(predicate2,context2){assertNotInfinite(this.size);var returnValue=!0;return this.__iterate(function(v,k,c){if(!predicate2.call(context2,v,k,c))return returnValue=!1,!1}),returnValue},"every"),filter:__name(function(predicate2,context2){return reify(this,filterFactory(this,predicate2,context2,!0))},"filter"),partition:__name(function(predicate2,context2){return partitionFactory(this,predicate2,context2)},"partition"),find:__name(function(predicate2,context2,notSetValue){var entry=this.findEntry(predicate2,context2);return entry?entry[1]:notSetValue},"find"),forEach:__name(function(sideEffect,context2){return assertNotInfinite(this.size),this.__iterate(context2?sideEffect.bind(context2):sideEffect)},"forEach"),join:__name(function(separator){assertNotInfinite(this.size),separator=separator!==void 0?""+separator:",";var joined="",isFirst=!0;return this.__iterate(function(v){isFirst?isFirst=!1:joined+=separator,joined+=v!=null?v.toString():""}),joined},"join"),keys:__name(function(){return this.__iterator(ITERATE_KEYS)},"keys"),map:__name(function(mapper,context2){return reify(this,mapFactory(this,mapper,context2))},"map"),reduce:__name(function(reducer,initialReduction,context2){return reduce(this,reducer,initialReduction,context2,arguments.length<2,!1)},"reduce$1"),reduceRight:__name(function(reducer,initialReduction,context2){return reduce(this,reducer,initialReduction,context2,arguments.length<2,!0)},"reduceRight"),reverse:__name(function(){return reify(this,reverseFactory(this,!0))},"reverse"),slice:__name(function(begin,end){return reify(this,sliceFactory(this,begin,end,!0))},"slice"),some:__name(function(predicate2,context2){return!this.every(not$1(predicate2),context2)},"some"),sort:__name(function(comparator){return reify(this,sortFactory(this,comparator))},"sort"),values:__name(function(){return this.__iterator(ITERATE_VALUES)},"values"),butLast:__name(function(){return this.slice(0,-1)},"butLast"),isEmpty:__name(function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},"isEmpty"),count:__name(function(predicate2,context2){return ensureSize(predicate2?this.toSeq().filter(predicate2,context2):this)},"count"),countBy:__name(function(grouper,context2){return countByFactory(this,grouper,context2)},"countBy"),equals:__name(function(other){return deepEqual(this,other)},"equals"),entrySeq:__name(function(){var collection=this;if(collection._cache)return new ArraySeq(collection._cache);var entriesSequence=collection.toSeq().map(entryMapper).toIndexedSeq();return entriesSequence.fromEntrySeq=function(){return collection.toSeq()},entriesSequence},"entrySeq"),filterNot:__name(function(predicate2,context2){return this.filter(not$1(predicate2),context2)},"filterNot"),findEntry:__name(function(predicate2,context2,notSetValue){var found=notSetValue;return this.__iterate(function(v,k,c){if(predicate2.call(context2,v,k,c))return found=[k,v],!1}),found},"findEntry"),findKey:__name(function(predicate2,context2){var entry=this.findEntry(predicate2,context2);return entry&&entry[0]},"findKey"),findLast:__name(function(predicate2,context2,notSetValue){return this.toKeyedSeq().reverse().find(predicate2,context2,notSetValue)},"findLast"),findLastEntry:__name(function(predicate2,context2,notSetValue){return this.toKeyedSeq().reverse().findEntry(predicate2,context2,notSetValue)},"findLastEntry"),findLastKey:__name(function(predicate2,context2){return this.toKeyedSeq().reverse().findKey(predicate2,context2)},"findLastKey"),first:__name(function(notSetValue){return this.find(returnTrue,null,notSetValue)},"first"),flatMap:__name(function(mapper,context2){return reify(this,flatMapFactory(this,mapper,context2))},"flatMap"),flatten:__name(function(depth){return reify(this,flattenFactory(this,depth,!0))},"flatten"),fromEntrySeq:__name(function(){return new FromEntriesSequence(this)},"fromEntrySeq"),get:__name(function(searchKey,notSetValue){return this.find(function(_,key){return is(key,searchKey)},void 0,notSetValue)},"get"),getIn,groupBy:__name(function(grouper,context2){return groupByFactory(this,grouper,context2)},"groupBy"),has:__name(function(searchKey){return this.get(searchKey,NOT_SET)!==NOT_SET},"has"),hasIn,isSubset:__name(function(iter){return iter=typeof iter.includes=="function"?iter:Collection(iter),this.every(function(value){return iter.includes(value)})},"isSubset"),isSuperset:__name(function(iter){return iter=typeof iter.isSubset=="function"?iter:Collection(iter),iter.isSubset(this)},"isSuperset"),keyOf:__name(function(searchValue){return this.findKey(function(value){return is(value,searchValue)})},"keyOf"),keySeq:__name(function(){return this.toSeq().map(keyMapper).toIndexedSeq()},"keySeq"),last:__name(function(notSetValue){return this.toSeq().reverse().first(notSetValue)},"last"),lastKeyOf:__name(function(searchValue){return this.toKeyedSeq().reverse().keyOf(searchValue)},"lastKeyOf"),max:__name(function(comparator){return maxFactory(this,comparator)},"max"),maxBy:__name(function(mapper,comparator){return maxFactory(this,comparator,mapper)},"maxBy"),min:__name(function(comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator)},"min"),minBy:__name(function(mapper,comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator,mapper)},"minBy"),rest:__name(function(){return this.slice(1)},"rest"),skip:__name(function(amount){return amount===0?this:this.slice(Math.max(0,amount))},"skip"),skipLast:__name(function(amount){return amount===0?this:this.slice(0,-Math.max(0,amount))},"skipLast"),skipWhile:__name(function(predicate2,context2){return reify(this,skipWhileFactory(this,predicate2,context2,!0))},"skipWhile"),skipUntil:__name(function(predicate2,context2){return this.skipWhile(not$1(predicate2),context2)},"skipUntil"),sortBy:__name(function(mapper,comparator){return reify(this,sortFactory(this,comparator,mapper))},"sortBy"),take:__name(function(amount){return this.slice(0,Math.max(0,amount))},"take"),takeLast:__name(function(amount){return this.slice(-Math.max(0,amount))},"takeLast"),takeWhile:__name(function(predicate2,context2){return reify(this,takeWhileFactory(this,predicate2,context2))},"takeWhile"),takeUntil:__name(function(predicate2,context2){return this.takeWhile(not$1(predicate2),context2)},"takeUntil"),update:__name(function(fn){return fn(this)},"update"),valueSeq:__name(function(){return this.toIndexedSeq()},"valueSeq"),hashCode:__name(function(){return this.__hash||(this.__hash=hashCollection(this))},"hashCode")});var CollectionPrototype=Collection.prototype;CollectionPrototype[IS_COLLECTION_SYMBOL]=!0;CollectionPrototype[ITERATOR_SYMBOL]=CollectionPrototype.values;CollectionPrototype.toJSON=CollectionPrototype.toArray;CollectionPrototype.__toStringMapper=quoteString;CollectionPrototype.inspect=CollectionPrototype.toSource=function(){return this.toString()};CollectionPrototype.chain=CollectionPrototype.flatMap;CollectionPrototype.contains=CollectionPrototype.includes;mixin(KeyedCollection,{flip:__name(function(){return reify(this,flipFactory(this))},"flip"),mapEntries:__name(function(mapper,context2){var this$1$1=this,iterations=0;return reify(this,this.toSeq().map(function(v,k){return mapper.call(context2,[k,v],iterations++,this$1$1)}).fromEntrySeq())},"mapEntries"),mapKeys:__name(function(mapper,context2){var this$1$1=this;return reify(this,this.toSeq().flip().map(function(k,v){return mapper.call(context2,k,v,this$1$1)}).flip())},"mapKeys")});var KeyedCollectionPrototype=KeyedCollection.prototype;KeyedCollectionPrototype[IS_KEYED_SYMBOL]=!0;KeyedCollectionPrototype[ITERATOR_SYMBOL]=CollectionPrototype.entries;KeyedCollectionPrototype.toJSON=toObject;KeyedCollectionPrototype.__toStringMapper=function(v,k){return quoteString(k)+": "+quoteString(v)};mixin(IndexedCollection,{toKeyedSeq:__name(function(){return new ToKeyedSequence(this,!1)},"toKeyedSeq"),filter:__name(function(predicate2,context2){return reify(this,filterFactory(this,predicate2,context2,!1))},"filter"),findIndex:__name(function(predicate2,context2){var entry=this.findEntry(predicate2,context2);return entry?entry[0]:-1},"findIndex"),indexOf:__name(function(searchValue){var key=this.keyOf(searchValue);return key===void 0?-1:key},"indexOf"),lastIndexOf:__name(function(searchValue){var key=this.lastKeyOf(searchValue);return key===void 0?-1:key},"lastIndexOf"),reverse:__name(function(){return reify(this,reverseFactory(this,!1))},"reverse"),slice:__name(function(begin,end){return reify(this,sliceFactory(this,begin,end,!1))},"slice"),splice:__name(function(index,removeNum){var numArgs=arguments.length;if(removeNum=Math.max(removeNum||0,0),numArgs===0||numArgs===2&&!removeNum)return this;index=resolveBegin(index,index<0?this.count():this.size);var spliced=this.slice(0,index);return reify(this,numArgs===1?spliced:spliced.concat(arrCopy(arguments,2),this.slice(index+removeNum)))},"splice"),findLastIndex:__name(function(predicate2,context2){var entry=this.findLastEntry(predicate2,context2);return entry?entry[0]:-1},"findLastIndex"),first:__name(function(notSetValue){return this.get(0,notSetValue)},"first"),flatten:__name(function(depth){return reify(this,flattenFactory(this,depth,!1))},"flatten"),get:__name(function(index,notSetValue){return index=wrapIndex(this,index),index<0||this.size===1/0||this.size!==void 0&&index>this.size?notSetValue:this.find(function(_,key){return key===index},void 0,notSetValue)},"get"),has:__name(function(index){return index=wrapIndex(this,index),index>=0&&(this.size!==void 0?this.size===1/0||index<this.size:this.indexOf(index)!==-1)},"has"),interpose:__name(function(separator){return reify(this,interposeFactory(this,separator))},"interpose"),interleave:__name(function(){var collections=[this].concat(arrCopy(arguments)),zipped=zipWithFactory(this.toSeq(),IndexedSeq.of,collections),interleaved=zipped.flatten(!0);return zipped.size&&(interleaved.size=zipped.size*collections.length),reify(this,interleaved)},"interleave"),keySeq:__name(function(){return Range(0,this.size)},"keySeq"),last:__name(function(notSetValue){return this.get(-1,notSetValue)},"last"),skipWhile:__name(function(predicate2,context2){return reify(this,skipWhileFactory(this,predicate2,context2,!1))},"skipWhile"),zip:__name(function(){var collections=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,collections))},"zip"),zipAll:__name(function(){var collections=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,collections,!0))},"zipAll"),zipWith:__name(function(zipper){var collections=arrCopy(arguments);return collections[0]=this,reify(this,zipWithFactory(this,zipper,collections))},"zipWith")});var IndexedCollectionPrototype=IndexedCollection.prototype;IndexedCollectionPrototype[IS_INDEXED_SYMBOL]=!0;IndexedCollectionPrototype[IS_ORDERED_SYMBOL]=!0;mixin(SetCollection,{get:__name(function(value,notSetValue){return this.has(value)?value:notSetValue},"get"),includes:__name(function(value){return this.has(value)},"includes"),keySeq:__name(function(){return this.valueSeq()},"keySeq")});var SetCollectionPrototype=SetCollection.prototype;SetCollectionPrototype.has=CollectionPrototype.includes;SetCollectionPrototype.contains=SetCollectionPrototype.includes;SetCollectionPrototype.keys=SetCollectionPrototype.values;mixin(KeyedSeq,KeyedCollectionPrototype);mixin(IndexedSeq,IndexedCollectionPrototype);mixin(SetSeq,SetCollectionPrototype);function reduce(collection,reducer,reduction,context2,useFirst,reverse3){return assertNotInfinite(collection.size),collection.__iterate(function(v,k,c){useFirst?(useFirst=!1,reduction=v):reduction=reducer.call(context2,reduction,v,k,c)},reverse3),reduction}__name(reduce,"reduce");function keyMapper(v,k){return k}__name(keyMapper,"keyMapper");function entryMapper(v,k){return[k,v]}__name(entryMapper,"entryMapper");function not$1(predicate2){return function(){return!predicate2.apply(this,arguments)}}__name(not$1,"not$1");function neg(predicate2){return function(){return-predicate2.apply(this,arguments)}}__name(neg,"neg");function defaultZipper(){return arrCopy(arguments)}__name(defaultZipper,"defaultZipper");function defaultNegComparator(a,b){return a<b?1:a>b?-1:0}__name(defaultNegComparator,"defaultNegComparator");function hashCollection(collection){if(collection.size===1/0)return 0;var ordered=isOrdered(collection),keyed=isKeyed(collection),h=ordered?1:0,size=collection.__iterate(keyed?ordered?function(v,k){h=31*h+hashMerge(hash$1(v),hash$1(k))|0}:function(v,k){h=h+hashMerge(hash$1(v),hash$1(k))|0}:ordered?function(v){h=31*h+hash$1(v)|0}:function(v){h=h+hash$1(v)|0});return murmurHashOfSize(size,h)}__name(hashCollection,"hashCollection");function murmurHashOfSize(size,h){return h=imul(h,3432918353),h=imul(h<<15|h>>>-15,461845907),h=imul(h<<13|h>>>-13,5),h=(h+3864292196|0)^size,h=imul(h^h>>>16,2246822507),h=imul(h^h>>>13,3266489909),h=smi(h^h>>>16),h}__name(murmurHashOfSize,"murmurHashOfSize");function hashMerge(a,b){return a^b+2654435769+(a<<6)+(a>>2)|0}__name(hashMerge,"hashMerge");var OrderedSet=function(Set2){function OrderedSet2(value){return value==null?emptyOrderedSet():isOrderedSet(value)?value:emptyOrderedSet().withMutations(function(set3){var iter=SetCollection(value);assertNotInfinite(iter.size),iter.forEach(function(v){return set3.add(v)})})}return __name(OrderedSet2,"OrderedSet"),Set2&&(OrderedSet2.__proto__=Set2),OrderedSet2.prototype=Object.create(Set2&&Set2.prototype),OrderedSet2.prototype.constructor=OrderedSet2,OrderedSet2.of=__name(function(){return this(arguments)},"of"),OrderedSet2.fromKeys=__name(function(value){return this(KeyedCollection(value).keySeq())},"fromKeys"),OrderedSet2.prototype.toString=__name(function(){return this.__toString("OrderedSet {","}")},"toString"),OrderedSet2}(Set$1);OrderedSet.isOrderedSet=isOrderedSet;var OrderedSetPrototype=OrderedSet.prototype;OrderedSetPrototype[IS_ORDERED_SYMBOL]=!0;OrderedSetPrototype.zip=IndexedCollectionPrototype.zip;OrderedSetPrototype.zipWith=IndexedCollectionPrototype.zipWith;OrderedSetPrototype.zipAll=IndexedCollectionPrototype.zipAll;OrderedSetPrototype.__empty=emptyOrderedSet;OrderedSetPrototype.__make=makeOrderedSet;function makeOrderedSet(map2,ownerID){var set3=Object.create(OrderedSetPrototype);return set3.size=map2?map2.size:0,set3._map=map2,set3.__ownerID=ownerID,set3}__name(makeOrderedSet,"makeOrderedSet");var EMPTY_ORDERED_SET;function emptyOrderedSet(){return EMPTY_ORDERED_SET||(EMPTY_ORDERED_SET=makeOrderedSet(emptyOrderedMap()))}__name(emptyOrderedSet,"emptyOrderedSet");var PairSorting={LeftThenRight:-1,RightThenLeft:1};function throwOnInvalidDefaultValues(defaultValues){if(isRecord(defaultValues))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(isImmutable(defaultValues))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(defaultValues===null||typeof defaultValues!="object")throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}__name(throwOnInvalidDefaultValues,"throwOnInvalidDefaultValues");var Record=__name(function(defaultValues,name){var hasInitialized;throwOnInvalidDefaultValues(defaultValues);var RecordType=__name(function(values2){var this$1$1=this;if(values2 instanceof RecordType)return values2;if(!(this instanceof RecordType))return new RecordType(values2);if(!hasInitialized){hasInitialized=!0;var keys2=Object.keys(defaultValues),indices=RecordTypePrototype._indices={};RecordTypePrototype._name=name,RecordTypePrototype._keys=keys2,RecordTypePrototype._defaultValues=defaultValues;for(var i=0;i<keys2.length;i++){var propName=keys2[i];indices[propName]=i,RecordTypePrototype[propName]?typeof console=="object"&&console.warn&&console.warn("Cannot define "+recordName(this)+' with property "'+propName+'" since that property name is part of the Record API.'):setProp(RecordTypePrototype,propName)}}return this.__ownerID=void 0,this._values=List().withMutations(function(l){l.setSize(this$1$1._keys.length),KeyedCollection(values2).forEach(function(v,k){l.set(this$1$1._indices[k],v===this$1$1._defaultValues[k]?void 0:v)})}),this},"Record"),RecordTypePrototype=RecordType.prototype=Object.create(RecordPrototype);return RecordTypePrototype.constructor=RecordType,name&&(RecordType.displayName=name),RecordType},"Record");Record.prototype.toString=__name(function(){for(var str=recordName(this)+" { ",keys2=this._keys,k,i=0,l=keys2.length;i!==l;i++)k=keys2[i],str+=(i?", ":"")+k+": "+quoteString(this.get(k));return str+" }"},"toString");Record.prototype.equals=__name(function(other){return this===other||isRecord(other)&&recordSeq(this).equals(recordSeq(other))},"equals");Record.prototype.hashCode=__name(function(){return recordSeq(this).hashCode()},"hashCode");Record.prototype.has=__name(function(k){return this._indices.hasOwnProperty(k)},"has");Record.prototype.get=__name(function(k,notSetValue){if(!this.has(k))return notSetValue;var index=this._indices[k],value=this._values.get(index);return value===void 0?this._defaultValues[k]:value},"get");Record.prototype.set=__name(function(k,v){if(this.has(k)){var newValues=this._values.set(this._indices[k],v===this._defaultValues[k]?void 0:v);if(newValues!==this._values&&!this.__ownerID)return makeRecord(this,newValues)}return this},"set");Record.prototype.remove=__name(function(k){return this.set(k)},"remove");Record.prototype.clear=__name(function(){var newValues=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:makeRecord(this,newValues)},"clear");Record.prototype.wasAltered=__name(function(){return this._values.wasAltered()},"wasAltered");Record.prototype.toSeq=__name(function(){return recordSeq(this)},"toSeq");Record.prototype.toJS=__name(function(){return toJS(this)},"toJS$1");Record.prototype.entries=__name(function(){return this.__iterator(ITERATE_ENTRIES)},"entries");Record.prototype.__iterator=__name(function(type,reverse3){return recordSeq(this).__iterator(type,reverse3)},"__iterator");Record.prototype.__iterate=__name(function(fn,reverse3){return recordSeq(this).__iterate(fn,reverse3)},"__iterate");Record.prototype.__ensureOwner=__name(function(ownerID){if(ownerID===this.__ownerID)return this;var newValues=this._values.__ensureOwner(ownerID);return ownerID?makeRecord(this,newValues,ownerID):(this.__ownerID=ownerID,this._values=newValues,this)},"__ensureOwner");Record.isRecord=isRecord;Record.getDescriptiveName=recordName;var RecordPrototype=Record.prototype;RecordPrototype[IS_RECORD_SYMBOL]=!0;RecordPrototype[DELETE]=RecordPrototype.remove;RecordPrototype.deleteIn=RecordPrototype.removeIn=deleteIn;RecordPrototype.getIn=getIn;RecordPrototype.hasIn=CollectionPrototype.hasIn;RecordPrototype.merge=merge$1;RecordPrototype.mergeWith=mergeWith$1;RecordPrototype.mergeIn=mergeIn;RecordPrototype.mergeDeep=mergeDeep;RecordPrototype.mergeDeepWith=mergeDeepWith;RecordPrototype.mergeDeepIn=mergeDeepIn;RecordPrototype.setIn=setIn;RecordPrototype.update=update;RecordPrototype.updateIn=updateIn;RecordPrototype.withMutations=withMutations;RecordPrototype.asMutable=asMutable;RecordPrototype.asImmutable=asImmutable;RecordPrototype[ITERATOR_SYMBOL]=RecordPrototype.entries;RecordPrototype.toJSON=RecordPrototype.toObject=CollectionPrototype.toObject;RecordPrototype.inspect=RecordPrototype.toSource=function(){return this.toString()};function makeRecord(likeRecord,values2,ownerID){var record=Object.create(Object.getPrototypeOf(likeRecord));return record._values=values2,record.__ownerID=ownerID,record}__name(makeRecord,"makeRecord");function recordName(record){return record.constructor.displayName||record.constructor.name||"Record"}__name(recordName,"recordName");function recordSeq(record){return keyedSeqFromValue(record._keys.map(function(k){return[k,record.get(k)]}))}__name(recordSeq,"recordSeq");function setProp(prototype,name){try{Object.defineProperty(prototype,name,{get:function(){return this.get(name)},set:function(value){invariant$1(this.__ownerID,"Cannot set on an immutable record."),this.set(name,value)}})}catch{}}__name(setProp,"setProp");var Repeat=function(IndexedSeq2){function Repeat2(value,times){if(!(this instanceof Repeat2))return new Repeat2(value,times);if(this._value=value,this.size=times===void 0?1/0:Math.max(0,times),this.size===0){if(EMPTY_REPEAT)return EMPTY_REPEAT;EMPTY_REPEAT=this}}return __name(Repeat2,"Repeat"),IndexedSeq2&&(Repeat2.__proto__=IndexedSeq2),Repeat2.prototype=Object.create(IndexedSeq2&&IndexedSeq2.prototype),Repeat2.prototype.constructor=Repeat2,Repeat2.prototype.toString=__name(function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},"toString"),Repeat2.prototype.get=__name(function(index,notSetValue){return this.has(index)?this._value:notSetValue},"get"),Repeat2.prototype.includes=__name(function(searchValue){return is(this._value,searchValue)},"includes"),Repeat2.prototype.slice=__name(function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:new Repeat2(this._value,resolveEnd(end,size)-resolveBegin(begin,size))},"slice"),Repeat2.prototype.reverse=__name(function(){return this},"reverse"),Repeat2.prototype.indexOf=__name(function(searchValue){return is(this._value,searchValue)?0:-1},"indexOf"),Repeat2.prototype.lastIndexOf=__name(function(searchValue){return is(this._value,searchValue)?this.size:-1},"lastIndexOf"),Repeat2.prototype.__iterate=__name(function(fn,reverse3){for(var size=this.size,i=0;i!==size&&fn(this._value,reverse3?size-++i:i++,this)!==!1;);return i},"__iterate"),Repeat2.prototype.__iterator=__name(function(type,reverse3){var this$1$1=this,size=this.size,i=0;return new Iterator(function(){return i===size?iteratorDone():iteratorValue(type,reverse3?size-++i:i++,this$1$1._value)})},"__iterator"),Repeat2.prototype.equals=__name(function(other){return other instanceof Repeat2?is(this._value,other._value):deepEqual(other)},"equals"),Repeat2}(IndexedSeq),EMPTY_REPEAT;function fromJS(value,converter){return fromJSWith([],converter||defaultConverter,value,"",converter&&converter.length>2?[]:void 0,{"":value})}__name(fromJS,"fromJS");function fromJSWith(stack,converter,value,key,keyPath,parentValue){if(typeof value!="string"&&!isImmutable(value)&&(isArrayLike(value)||hasIterator(value)||isPlainObject(value))){if(~stack.indexOf(value))throw new TypeError("Cannot convert circular structure to Immutable");stack.push(value),keyPath&&key!==""&&keyPath.push(key);var converted=converter.call(parentValue,key,Seq(value).map(function(v,k){return fromJSWith(stack,converter,v,k,keyPath,value)}),keyPath&&keyPath.slice());return stack.pop(),keyPath&&keyPath.pop(),converted}return value}__name(fromJSWith,"fromJSWith");function defaultConverter(k,v){return isIndexed(v)?v.toList():isKeyed(v)?v.toMap():v.toSet()}__name(defaultConverter,"defaultConverter");var version$1="4.3.0",Immutable={version:version$1,Collection,Iterable:Collection,Seq,Map:Map$1,OrderedMap,List,Stack:Stack$1,Set:Set$1,OrderedSet,PairSorting,Record,Range,Repeat,is,fromJS,hash:hash$1,isImmutable,isCollection,isKeyed,isIndexed,isAssociative,isOrdered,isValueObject,isPlainObject,isSeq,isList,isMap,isOrderedMap,isStack,isSet,isOrderedSet,isRecord,get:get$1,getIn:getIn$1,has,hasIn:hasIn$1,merge,mergeDeep:mergeDeep$1,mergeWith,mergeDeepWith:mergeDeepWith$1,remove,removeIn,set,setIn:setIn$1,update:update$1,updateIn:updateIn$1},Iterable=Collection;const immutable_es=Object.freeze(Object.defineProperty({__proto__:null,Collection,Iterable,List,Map:Map$1,OrderedMap,OrderedSet,PairSorting,Range,Record,Repeat,Seq,Set:Set$1,Stack:Stack$1,default:Immutable,fromJS,get:get$1,getIn:getIn$1,has,hasIn:hasIn$1,hash:hash$1,is,isAssociative,isCollection,isImmutable,isIndexed,isKeyed,isList,isMap,isOrdered,isOrderedMap,isOrderedSet,isPlainObject,isRecord,isSeq,isSet,isStack,isValueObject,merge,mergeDeep:mergeDeep$1,mergeDeepWith:mergeDeepWith$1,mergeWith,remove,removeIn,set,setIn:setIn$1,update:update$1,updateIn:updateIn$1,version:version$1},Symbol.toStringTag,{value:"Module"})),require$$0$2=getAugmentedNamespace(immutable_es);Object.defineProperty(ActionContext$1,"__esModule",{value:!0});ActionContext$1.ActionContextKey=ActionContext$1.ActionContext=void 0;const immutable_1$2=require$$0$2;class ActionContext{constructor(data={}){this.map=(0,immutable_1$2.Map)(data)}setDefault(key,value){return this.has(key)?this:this.set(key,value)}set(key,value){return this.setRaw(key.name,value)}setRaw(key,value){return new ActionContext(this.map.set(key,value))}delete(key){return new ActionContext(this.map.delete(key.name))}get(key){return this.getRaw(key.name)}getRaw(key){return this.map.get(key)}getSafe(key){if(!this.has(key))throw new Error(`Context entry ${key.name} is required but not available`);return this.get(key)}has(key){return this.hasRaw(key.name)}hasRaw(key){return this.map.has(key)}merge(...contexts){let context2=this;for(const source of contexts)for(const key of source.keys())context2=context2.set(key,source.get(key));return context2}keys(){return[...this.map.keys()].map(keyName=>new ActionContextKey(keyName))}toJS(){return this.map.toJS()}toString(){return`ActionContext(${JSON.stringify(this.map.toJS())})`}[Symbol.for("nodejs.util.inspect.custom")](){return`ActionContext(${JSON.stringify(this.map.toJS(),null,"  ")})`}static ensureActionContext(maybeActionContext){return maybeActionContext instanceof ActionContext?maybeActionContext:new ActionContext((0,immutable_1$2.Map)(maybeActionContext||{}))}}__name(ActionContext,"ActionContext");ActionContext$1.ActionContext=ActionContext;class ActionContextKey{constructor(name){this.name=name}}__name(ActionContextKey,"ActionContextKey");ActionContext$1.ActionContextKey=ActionContextKey;var Bus$1={};Object.defineProperty(Bus$1,"__esModule",{value:!0});Bus$1.Bus=void 0;class Bus{constructor(args){this.actors=[],this.observers=[],this.dependencyLinks=new Map,Object.assign(this,args)}subscribe(actor){this.actors.push(actor),this.reorderForDependencies()}subscribeObserver(observer){this.observers.push(observer)}unsubscribe(actor){const index=this.actors.indexOf(actor);return index>=0?(this.actors.splice(index,1),!0):!1}unsubscribeObserver(observer){const index=this.observers.indexOf(observer);return index>=0?(this.observers.splice(index,1),!0):!1}publish(action){return this.actors.map(actor=>({actor,reply:actor.test(action)}))}onRun(actor,action,output){for(const observer of this.observers)observer.onRun(actor,action,output)}addDependencies(dependent,dependencies){for(const dependency of dependencies){let existingDependencies=this.dependencyLinks.get(dependency);existingDependencies||(existingDependencies=[],this.dependencyLinks.set(dependency,existingDependencies)),existingDependencies.push(dependent)}this.reorderForDependencies()}reorderForDependencies(){if(this.dependencyLinks.size>0){const actorsAfter=[];for(const actorAfter of this.dependencyLinks.keys()){const dependentPos=this.actors.indexOf(actorAfter);dependentPos>=0&&(this.actors.splice(dependentPos,1),actorsAfter.push(actorAfter))}for(;actorsAfter.length>0;){let activeActorAfterId=-1;for(let i=0;i<actorsAfter.length;i++){let validLink=!0;for(const dependency of this.dependencyLinks.get(actorsAfter[i]))if(!this.actors.includes(dependency)&&actorsAfter.includes(dependency)){validLink=!1;break}if(validLink){activeActorAfterId=i;break}}if(activeActorAfterId<0)throw new Error(`Cyclic dependency links detected in bus ${this.name}`);const activeActorAfter=actorsAfter.splice(activeActorAfterId,1)[0];this.actors.push(activeActorAfter)}}}}__name(Bus,"Bus");Bus$1.Bus=Bus;var BusIndexed$1={};Object.defineProperty(BusIndexed$1,"__esModule",{value:!0});BusIndexed$1.BusIndexed=void 0;const Bus_1=Bus$1;class BusIndexed extends Bus_1.Bus{constructor(args){super(args),this.actorsIndex={}}subscribe(actor){const actorId=this.getActorIdentifier(actor)||"_undefined_";let actors=this.actorsIndex[actorId];actors||(actors=this.actorsIndex[actorId]=[]),actors.push(actor),super.subscribe(actor)}unsubscribe(actor){const actorId=this.getActorIdentifier(actor)||"_undefined_",actors=this.actorsIndex[actorId];if(actors){const i=actors.indexOf(actor);i>=0&&actors.splice(i,1),actors.length===0&&delete this.actorsIndex[actorId]}return super.unsubscribe(actor)}publish(action){const actionId=this.getActionIdentifier(action);return actionId?[...this.actorsIndex[actionId]||[],...this.actorsIndex._undefined_||[]].map(actor=>({actor,reply:actor.test(action)})):super.publish(action)}getActorIdentifier(actor){return this.actorIdentifierFields.reduce((object2,field)=>object2[field],actor)}getActionIdentifier(action){return this.actionIdentifierFields.reduce((object2,field)=>object2[field],action)}}__name(BusIndexed,"BusIndexed");BusIndexed$1.BusIndexed=BusIndexed;var ContextEntries={};Object.defineProperty(ContextEntries,"__esModule",{value:!0});ContextEntries.CONTEXT_KEY_LOGGER=void 0;const ActionContext_1=ActionContext$1;ContextEntries.CONTEXT_KEY_LOGGER=new ActionContext_1.ActionContextKey("@comunica/core:log");var ActionObserver$1={};Object.defineProperty(ActionObserver$1,"__esModule",{value:!0});ActionObserver$1.ActionObserver=void 0;class ActionObserver{constructor(args){Object.assign(this,args)}}__name(ActionObserver,"ActionObserver");ActionObserver$1.ActionObserver=ActionObserver;var Actor$1={};Object.defineProperty(Actor$1,"__esModule",{value:!0});Actor$1.Actor=void 0;const ContextEntries_1=ContextEntries;class Actor{constructor(args){this.beforeActors=[],Object.assign(this,args),this.bus.subscribe(this),this.beforeActors.length>0&&this.bus.addDependencies(this,this.beforeActors)}static getContextLogger(context2){return context2.get(ContextEntries_1.CONTEXT_KEY_LOGGER)}runObservable(action){const output=this.run(action);return this.bus.onRun(this,action,output),output}async initialize(){return!0}async deinitialize(){return!0}getDefaultLogData(context2,data){const dataActual=data?data():{};return dataActual.actor=this.name,dataActual}logTrace(context2,message,data){const logger=Actor.getContextLogger(context2);logger&&logger.trace(message,this.getDefaultLogData(context2,data))}logDebug(context2,message,data){const logger=Actor.getContextLogger(context2);logger&&logger.debug(message,this.getDefaultLogData(context2,data))}logInfo(context2,message,data){const logger=Actor.getContextLogger(context2);logger&&logger.info(message,this.getDefaultLogData(context2,data))}logWarn(context2,message,data){const logger=Actor.getContextLogger(context2);logger&&logger.warn(message,this.getDefaultLogData(context2,data))}logError(context2,message,data){const logger=Actor.getContextLogger(context2);logger&&logger.error(message,this.getDefaultLogData(context2,data))}logFatal(context2,message,data){const logger=Actor.getContextLogger(context2);logger&&logger.fatal(message,this.getDefaultLogData(context2,data))}}__name(Actor,"Actor");Actor$1.Actor=Actor;var Mediator$1={};Object.defineProperty(Mediator$1,"__esModule",{value:!0});Mediator$1.Mediator=void 0;class Mediator{constructor(args){Object.assign(this,args)}publish(action){const actors=this.bus.publish(action);if(actors.length===0)throw new Error(`No actors are able to reply to a message in the bus ${this.bus.name}`);return actors}async mediateActor(action){return await this.mediateWith(action,this.publish(action))}async mediate(action){return(await this.mediateActor(action)).runObservable(action)}}__name(Mediator,"Mediator");Mediator$1.Mediator=Mediator;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;const Logger2=lib$2z.Logger;exports.Logger=Logger2,__exportStar(ActionContext$1,exports),__exportStar(Bus$1,exports),__exportStar(BusIndexed$1,exports),__exportStar(ContextEntries,exports),__exportStar(ActionObserver$1,exports),__exportStar(Actor$1,exports),__exportStar(Mediator$1,exports)})(lib$2A);Object.defineProperty(ActorInit$1,"__esModule",{value:!0});ActorInit$1.ActorInit=void 0;const core_1$y=lib$2A;class ActorInit extends core_1$y.Actor{constructor(args){super(args)}}__name(ActorInit,"ActorInit");ActorInit$1.ActorInit=ActorInit;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorInit$1,exports)})(lib$2B);Object.defineProperty(ActorInitQueryBase$1,"__esModule",{value:!0});ActorInitQueryBase$1.ActorInitQueryBase=void 0;const bus_init_1=lib$2B;class ActorInitQueryBase extends bus_init_1.ActorInit{constructor(args){var _a2;(_a2=args.contextKeyShortcutsExtensions)==null||_a2.forEach(extensionShortcuts=>{if(Object.keys(args.contextKeyShortcuts).some(key=>Object.keys(extensionShortcuts).includes(key)))throw new Error("Duplicate keys found while adding `contextKeyShortcutsExtensions`.");args.contextKeyShortcuts={...args.contextKeyShortcuts,...extensionShortcuts}}),super(args)}async test(action){return!0}async run(action){throw new Error("ActorInitSparql#run is not supported in the browser.")}}__name(ActorInitQueryBase,"ActorInitQueryBase");ActorInitQueryBase$1.ActorInitQueryBase=ActorInitQueryBase;var ActorInitQueryBrowser={};Object.defineProperty(ActorInitQueryBrowser,"__esModule",{value:!0});ActorInitQueryBrowser.ActorInitQuery=void 0;const ActorInitQueryBase_1=ActorInitQueryBase$1;typeof process>"u"&&(globalThis.process=browserExports);class ActorInitQuery extends ActorInitQueryBase_1.ActorInitQueryBase{}__name(ActorInitQuery,"ActorInitQuery");ActorInitQueryBrowser.ActorInitQuery=ActorInitQuery;var QueryEngineBase$1={},lib$2y={},ActorQueryOperation$1={},lib$2x={},Keys={};Object.defineProperty(Keys,"__esModule",{value:!0});Keys.KeysRdfUpdateQuads=Keys.KeysRdfResolveQuadPattern=Keys.KeysRdfParseHtmlScript=Keys.KeysRdfParseJsonLd=Keys.KeysQueryOperation=Keys.KeysInitQuery=Keys.KeysHttpProxy=Keys.KeysHttpMemento=Keys.KeysHttpWayback=Keys.KeysHttp=Keys.KeysCore=void 0;const core_1$x=lib$2A;Keys.KeysCore={log:core_1$x.CONTEXT_KEY_LOGGER};Keys.KeysHttp={includeCredentials:new core_1$x.ActionContextKey("@comunica/bus-http:include-credentials"),auth:new core_1$x.ActionContextKey("@comunica/bus-http:auth"),fetch:new core_1$x.ActionContextKey("@comunica/bus-http:fetch"),httpTimeout:new core_1$x.ActionContextKey("@comunica/bus-http:http-timeout"),httpBodyTimeout:new core_1$x.ActionContextKey("@comunica/bus-http:http-body-timeout"),httpRetryCount:new core_1$x.ActionContextKey("@comunica/bus-http:http-retry-count"),httpRetryDelay:new core_1$x.ActionContextKey("@comunica/bus-http:http-retry-delay"),httpRetryOnServerError:new core_1$x.ActionContextKey("@comunica/bus-http:http-retry-on-server-error")};Keys.KeysHttpWayback={recoverBrokenLinks:new core_1$x.ActionContextKey("@comunica/bus-http:recover-broken-links")};Keys.KeysHttpMemento={datetime:new core_1$x.ActionContextKey("@comunica/actor-http-memento:datetime")};Keys.KeysHttpProxy={httpProxyHandler:new core_1$x.ActionContextKey("@comunica/actor-http-proxy:httpProxyHandler")};Keys.KeysInitQuery={initialBindings:new core_1$x.ActionContextKey("@comunica/actor-init-query:initialBindings"),queryFormat:new core_1$x.ActionContextKey("@comunica/actor-init-query:queryFormat"),graphqlSingularizeVariables:new core_1$x.ActionContextKey("@comunica/actor-init-query:singularizeVariables"),lenient:new core_1$x.ActionContextKey("@comunica/actor-init-query:lenient"),queryString:new core_1$x.ActionContextKey("@comunica/actor-init-query:queryString"),query:new core_1$x.ActionContextKey("@comunica/actor-init-query:query"),baseIRI:new core_1$x.ActionContextKey("@comunica/actor-init-query:baseIRI"),functionArgumentsCache:new core_1$x.ActionContextKey("@comunica/actor-init-query:functionArgumentsCache"),queryTimestamp:new core_1$x.ActionContextKey("@comunica/actor-init-query:queryTimestamp"),extensionFunctionCreator:new core_1$x.ActionContextKey("@comunica/actor-init-query:extensionFunctionCreator"),extensionFunctions:new core_1$x.ActionContextKey("@comunica/actor-init-query:extensionFunctions"),cliArgsHandlers:new core_1$x.ActionContextKey("@comunica/actor-init-query:cliArgsHandlers"),explain:new core_1$x.ActionContextKey("@comunica/actor-init-query:explain"),physicalQueryPlanLogger:new core_1$x.ActionContextKey("@comunica/actor-init-query:physicalQueryPlanLogger"),physicalQueryPlanNode:new core_1$x.ActionContextKey("@comunica/actor-init-query:physicalQueryPlanNode"),jsonLdContext:new core_1$x.ActionContextKey("@context")};Keys.KeysQueryOperation={operation:new core_1$x.ActionContextKey("@comunica/bus-query-operation:operation"),joinLeftMetadata:new core_1$x.ActionContextKey("@comunica/bus-query-operation:joinLeftMetadata"),joinRightMetadatas:new core_1$x.ActionContextKey("@comunica/bus-query-operation:joinRightMetadatas"),joinBindings:new core_1$x.ActionContextKey("@comunica/bus-query-operation:joinBindings"),readOnly:new core_1$x.ActionContextKey("@comunica/bus-query-operation:readOnly"),isPathArbitraryLengthDistinctKey:new core_1$x.ActionContextKey("@comunica/bus-query-operation:isPathArbitraryLengthDistinct"),limitIndicator:new core_1$x.ActionContextKey("@comunica/bus-query-operation:limitIndicator"),unionDefaultGraph:new core_1$x.ActionContextKey("@comunica/bus-query-operation:unionDefaultGraph")};Keys.KeysRdfParseJsonLd={documentLoader:new core_1$x.ActionContextKey("@comunica/actor-rdf-parse-jsonld:documentLoader"),strictValues:new core_1$x.ActionContextKey("@comunica/actor-rdf-parse-jsonld:strictValues"),parserOptions:new core_1$x.ActionContextKey("@comunica/actor-rdf-parse-jsonld:parserOptions")};Keys.KeysRdfParseHtmlScript={processingHtmlScript:new core_1$x.ActionContextKey("@comunica/actor-rdf-parse-html-script:processingHtmlScript"),extractAllScripts:new core_1$x.ActionContextKey("extractAllScripts")};Keys.KeysRdfResolveQuadPattern={sources:new core_1$x.ActionContextKey("@comunica/bus-rdf-resolve-quad-pattern:sources"),source:new core_1$x.ActionContextKey("@comunica/bus-rdf-resolve-quad-pattern:source"),sourceIds:new core_1$x.ActionContextKey("@comunica/bus-rdf-resolve-quad-pattern:sourceIds"),hypermediaSourcesAggregatedStores:new core_1$x.ActionContextKey("@comunica/bus-rdf-resolve-quad-pattern:hypermediaSourcesAggregatedStores")};Keys.KeysRdfUpdateQuads={destination:new core_1$x.ActionContextKey("@comunica/bus-rdf-update-quads:destination")};(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(Keys,exports)})(lib$2x);var lib$2w={},BlankNodeScoped$1={};Object.defineProperty(BlankNodeScoped$1,"__esModule",{value:!0});BlankNodeScoped$1.BlankNodeScoped=void 0;class BlankNodeScoped{constructor(value,skolemized){this.termType="BlankNode",this.value=value,this.skolemized=skolemized}equals(other){return!!other&&other.termType==="BlankNode"&&other.value===this.value}}__name(BlankNodeScoped,"BlankNodeScoped");BlankNodeScoped$1.BlankNodeScoped=BlankNodeScoped;var BlankNodeBindingsScoped$1={};Object.defineProperty(BlankNodeBindingsScoped$1,"__esModule",{value:!0});BlankNodeBindingsScoped$1.BlankNodeBindingsScoped=void 0;class BlankNodeBindingsScoped{constructor(value){this.termType="BlankNode",this.singleBindingsScope=!0,this.value=value}equals(other){return!!other&&other.termType==="BlankNode"&&other.value===this.value}}__name(BlankNodeBindingsScoped,"BlankNodeBindingsScoped");BlankNodeBindingsScoped$1.BlankNodeBindingsScoped=BlankNodeBindingsScoped;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(BlankNodeScoped$1,exports),__exportStar(BlankNodeBindingsScoped$1,exports)})(lib$2w);var Bindings$2={},lib$2v={},Bindings$1={},bindingsToString$1={},rdfString={},TermUtil$2={};Object.defineProperty(TermUtil$2,"__esModule",{value:!0});TermUtil$2.stringQuadToQuad=TermUtil$2.quadToStringQuad=TermUtil$2.stringToTerm=TermUtil$2.getLiteralLanguage=TermUtil$2.getLiteralType=TermUtil$2.getLiteralValue=TermUtil$2.termToString=void 0;const rdf_data_factory_1$A=rdfDataFactory,FACTORY$2=new rdf_data_factory_1$A.DataFactory;function termToString$1(term){if(term)switch(term.termType){case"NamedNode":return term.value;case"BlankNode":return"_:"+term.value;case"Literal":const literalValue=term;return'"'+literalValue.value+'"'+(literalValue.datatype&&literalValue.datatype.value!=="http://www.w3.org/2001/XMLSchema#string"&&literalValue.datatype.value!=="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"?"^^"+literalValue.datatype.value:"")+(literalValue.language?"@"+literalValue.language:"");case"Quad":return`<<${termToString$1(term.subject)} ${termToString$1(term.predicate)} ${termToString$1(term.object)}${term.graph.termType==="DefaultGraph"?"":" "+termToString$1(term.graph)}>>`;case"Variable":return"?"+term.value;case"DefaultGraph":return term.value}}__name(termToString$1,"termToString$1");TermUtil$2.termToString=termToString$1;function getLiteralValue$1(literalValue){const match=/^"([^]*)"/.exec(literalValue);if(!match)throw new Error(literalValue+" is not a literal");return match[1]}__name(getLiteralValue$1,"getLiteralValue$1");TermUtil$2.getLiteralValue=getLiteralValue$1;function getLiteralType$1(literalValue){const match=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(literalValue);if(!match)throw new Error(literalValue+" is not a literal");return match[1]||(match[2]?"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString":"http://www.w3.org/2001/XMLSchema#string")}__name(getLiteralType$1,"getLiteralType$1");TermUtil$2.getLiteralType=getLiteralType$1;function getLiteralLanguage$1(literalValue){const match=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(literalValue);if(!match)throw new Error(literalValue+" is not a literal");return match[1]?match[1].toLowerCase():""}__name(getLiteralLanguage$1,"getLiteralLanguage$1");TermUtil$2.getLiteralLanguage=getLiteralLanguage$1;function stringToTerm$1(value,dataFactory){if(dataFactory=dataFactory||FACTORY$2,!value||!value.length)return dataFactory.defaultGraph();switch(value[0]){case"_":return dataFactory.blankNode(value.substr(2));case"?":if(!dataFactory.variable)throw new Error("Missing 'variable()' method on the given DataFactory");return dataFactory.variable(value.substr(1));case'"':const language2=getLiteralLanguage$1(value),type=dataFactory.namedNode(getLiteralType$1(value));return dataFactory.literal(getLiteralValue$1(value),language2||type);case"<":default:if(value[0]==="<"&&value.length>4&&value[1]==="<"&&value[value.length-1]===">"&&value[value.length-2]===">"){const terms=value.slice(2,-2).trim();let stringTerms=[],ignoreTags=0,lastIndex=0,inQuote=!1;for(let i=0;i<terms.length;i++){const char=terms[i];if(char==="<"&&ignoreTags++,char===">"){if(ignoreTags===0)throw new Error("Found closing tag without opening tag in "+value);ignoreTags--}if(char==='"'){let escaped=!1,j=i;for(;j-- >0&&terms[j]==="\\";)escaped=!escaped;escaped||(inQuote=!inQuote)}if(char===" "&&!inQuote&&ignoreTags===0){for(stringTerms.push(terms.slice(lastIndex,i));terms[i+1]===" ";)i+=1;lastIndex=i+1}}if(ignoreTags!==0)throw new Error("Found opening tag without closing tag in "+value);if(stringTerms.push(terms.slice(lastIndex,terms.length)),stringTerms.length!==3&&stringTerms.length!==4)throw new Error("Nested quad syntax error "+value);return stringTerms=stringTerms.map(term=>term.startsWith("<")&&!term.includes(" ")?term.slice(1,-1):term),dataFactory.quad(stringToTerm$1(stringTerms[0]),stringToTerm$1(stringTerms[1]),stringToTerm$1(stringTerms[2]),stringTerms[3]?stringToTerm$1(stringTerms[3]):void 0)}return dataFactory.namedNode(value)}}__name(stringToTerm$1,"stringToTerm$1");TermUtil$2.stringToTerm=stringToTerm$1;function quadToStringQuad$1(q){return{subject:termToString$1(q.subject),predicate:termToString$1(q.predicate),object:termToString$1(q.object),graph:termToString$1(q.graph)}}__name(quadToStringQuad$1,"quadToStringQuad$1");TermUtil$2.quadToStringQuad=quadToStringQuad$1;function stringQuadToQuad$1(stringQuad,dataFactory){return dataFactory=dataFactory||FACTORY$2,dataFactory.quad(stringToTerm$1(stringQuad.subject,dataFactory),stringToTerm$1(stringQuad.predicate,dataFactory),stringToTerm$1(stringQuad.object,dataFactory),stringToTerm$1(stringQuad.graph,dataFactory))}__name(stringQuadToQuad$1,"stringQuadToQuad$1");TermUtil$2.stringQuadToQuad=stringQuadToQuad$1;(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.termToString=exports.stringToTerm=exports.stringQuadToQuad=exports.quadToStringQuad=exports.getLiteralValue=exports.getLiteralType=exports.getLiteralLanguage=void 0;const TermUtil_1=TermUtil$2;Object.defineProperty(exports,"getLiteralLanguage",{enumerable:!0,get:function(){return TermUtil_1.getLiteralLanguage}}),Object.defineProperty(exports,"getLiteralType",{enumerable:!0,get:function(){return TermUtil_1.getLiteralType}}),Object.defineProperty(exports,"getLiteralValue",{enumerable:!0,get:function(){return TermUtil_1.getLiteralValue}}),Object.defineProperty(exports,"quadToStringQuad",{enumerable:!0,get:function(){return TermUtil_1.quadToStringQuad}}),Object.defineProperty(exports,"stringQuadToQuad",{enumerable:!0,get:function(){return TermUtil_1.stringQuadToQuad}}),Object.defineProperty(exports,"stringToTerm",{enumerable:!0,get:function(){return TermUtil_1.stringToTerm}}),Object.defineProperty(exports,"termToString",{enumerable:!0,get:function(){return TermUtil_1.termToString}})})(rdfString);Object.defineProperty(bindingsToString$1,"__esModule",{value:!0});bindingsToString$1.bindingsToString=void 0;const rdf_string_1$n=rdfString;function bindingsToString(bindings){const raw={};for(const key of bindings.keys())raw[key.value]=(0,rdf_string_1$n.termToString)(bindings.get(key));return JSON.stringify(raw,null,"  ")}__name(bindingsToString,"bindingsToString");bindingsToString$1.bindingsToString=bindingsToString;Object.defineProperty(Bindings$1,"__esModule",{value:!0});Bindings$1.Bindings=void 0;const immutable_1$1=require$$0$2,bindingsToString_1=bindingsToString$1;class Bindings{constructor(dataFactory,entries3){this.type="bindings",this.dataFactory=dataFactory,this.entries=entries3}has(key){return this.entries.has(typeof key=="string"?key:key.value)}get(key){return this.entries.get(typeof key=="string"?key:key.value)}set(key,value){return new Bindings(this.dataFactory,this.entries.set(typeof key=="string"?key:key.value,value))}delete(key){return new Bindings(this.dataFactory,this.entries.delete(typeof key=="string"?key:key.value))}keys(){return this.mapIterable(this.iteratorToIterable(this.entries.keys()),key=>this.dataFactory.variable(key))}values(){return this.iteratorToIterable(this.entries.values())}forEach(fn){this.entries.forEach((value,key)=>fn(value,this.dataFactory.variable(key)))}get size(){return this.entries.size}[Symbol.iterator](){return this.mapIterable(this.iteratorToIterable(this.entries.entries()),([key,value])=>[this.dataFactory.variable(key),value])[Symbol.iterator]()}equals(other){var _a2;if(!other)return!1;if(this===other)return!0;if(this.size!==other.size)return!1;for(const key of this.keys())if(!((_a2=this.get(key))!=null&&_a2.equals(other.get(key))))return!1;return!0}filter(fn){return new Bindings(this.dataFactory,(0,immutable_1$1.Map)(this.entries.filter((value,key)=>fn(value,this.dataFactory.variable(key)))))}map(fn){return new Bindings(this.dataFactory,(0,immutable_1$1.Map)(this.entries.map((value,key)=>fn(value,this.dataFactory.variable(key)))))}merge(other){const keys2=new Set([...this.iteratorToIterable(this.entries.keys()),...[...other.keys()].map(key=>key.value)]),entries3=[];for(const key of keys2){const left=this.entries.get(key),right=other.get(this.dataFactory.variable(key));if(left&&right&&!left.equals(right))return;const value=left||right;entries3.push([key,value])}return new Bindings(this.dataFactory,(0,immutable_1$1.Map)(entries3))}mergeWith(merger,other){const keys2=new Set([...this.iteratorToIterable(this.entries.keys()),...[...other.keys()].map(key=>key.value)]),entries3=[];for(const key of keys2){const variable=this.dataFactory.variable(key),left=this.entries.get(key),right=other.get(variable);let value;left&&right&&!left.equals(right)?value=merger(left,right,variable):value=left||right,entries3.push([key,value])}return new Bindings(this.dataFactory,(0,immutable_1$1.Map)(entries3))}toString(){return(0,bindingsToString_1.bindingsToString)(this)}*mapIterable(iterable,callback){for(const x of iterable)yield callback(x)}iteratorToIterable(iterator){return{[Symbol.iterator]:()=>iterator}}}__name(Bindings,"Bindings");Bindings$1.Bindings=Bindings;var BindingsFactory$1={};Object.defineProperty(BindingsFactory$1,"__esModule",{value:!0});BindingsFactory$1.BindingsFactory=void 0;const immutable_1=require$$0$2,rdf_data_factory_1$z=rdfDataFactory,Bindings_1$1=Bindings$1;class BindingsFactory{constructor(dataFactory=new rdf_data_factory_1$z.DataFactory){this.dataFactory=dataFactory}bindings(entries3=[]){return new Bindings_1$1.Bindings(this.dataFactory,(0,immutable_1.Map)(entries3.map(([key,value])=>[key.value,value])))}fromBindings(bindings){return this.bindings([...bindings])}fromRecord(record){return this.bindings(Object.entries(record).map(([key,value])=>[this.dataFactory.variable(key),value]))}}__name(BindingsFactory,"BindingsFactory");BindingsFactory$1.BindingsFactory=BindingsFactory;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(Bindings$1,exports),__exportStar(BindingsFactory$1,exports),__exportStar(bindingsToString$1,exports)})(lib$2v);var rdfTerms={},QuadTermUtil={};Object.defineProperty(QuadTermUtil,"__esModule",{value:!0});QuadTermUtil.matchPatternMappings=QuadTermUtil.matchPatternComplete=QuadTermUtil.matchPattern=QuadTermUtil.matchTerm=QuadTermUtil.getValueNestedPath=QuadTermUtil.someTermsNested=QuadTermUtil.someTerms=QuadTermUtil.everyTermsNested=QuadTermUtil.everyTerms=QuadTermUtil.reduceTermsNested=QuadTermUtil.reduceTerms=QuadTermUtil.mapTermsNested=QuadTermUtil.mapTerms=QuadTermUtil.filterQuadTermNamesNested=QuadTermUtil.filterQuadTermNames=QuadTermUtil.filterTermsNested=QuadTermUtil.filterTerms=QuadTermUtil.forEachTermsNested=QuadTermUtil.forEachTerms=QuadTermUtil.collectNamedTerms=QuadTermUtil.getNamedTerms=QuadTermUtil.getTermsNested=QuadTermUtil.getTerms=QuadTermUtil.TRIPLE_TERM_NAMES=QuadTermUtil.QUAD_TERM_NAMES=void 0;const rdf_data_factory_1$y=rdfDataFactory,DF$l=new rdf_data_factory_1$y.DataFactory;QuadTermUtil.QUAD_TERM_NAMES=["subject","predicate","object","graph"];QuadTermUtil.TRIPLE_TERM_NAMES=["subject","predicate","object"];function getTerms(quad,ignoreDefaultGraph){return ignoreDefaultGraph&&quad.graph.termType==="DefaultGraph"?[quad.subject,quad.predicate,quad.object]:[quad.subject,quad.predicate,quad.object,quad.graph]}__name(getTerms,"getTerms");QuadTermUtil.getTerms=getTerms;function getTermsNested(quad,ignoreDefaultGraph){const terms=[];for(const term of getTerms(quad,ignoreDefaultGraph))term.termType==="Quad"?getTermsNested(term,ignoreDefaultGraph).forEach(subTerm=>terms.push(subTerm)):terms.push(term);return terms}__name(getTermsNested,"getTermsNested");QuadTermUtil.getTermsNested=getTermsNested;function getNamedTerms(quad){return[{key:"subject",value:quad.subject},{key:"predicate",value:quad.predicate},{key:"object",value:quad.object},{key:"graph",value:quad.graph}]}__name(getNamedTerms,"getNamedTerms");QuadTermUtil.getNamedTerms=getNamedTerms;function collectNamedTerms(namedTerms,defaultCb,dataFactory){const elements={};return namedTerms.forEach(namedTerm=>elements[namedTerm.key]=namedTerm.value),defaultCb&&(elements.subject=elements.subject||defaultCb("subject"),elements.predicate=elements.predicate||defaultCb("predicate"),elements.object=elements.object||defaultCb("object"),elements.graph=elements.graph||defaultCb("graph")),(dataFactory||DF$l).quad(elements.subject,elements.predicate,elements.object,elements.graph)}__name(collectNamedTerms,"collectNamedTerms");QuadTermUtil.collectNamedTerms=collectNamedTerms;function forEachTerms(quad,cb){cb(quad.subject,"subject"),cb(quad.predicate,"predicate"),cb(quad.object,"object"),cb(quad.graph,"graph")}__name(forEachTerms,"forEachTerms");QuadTermUtil.forEachTerms=forEachTerms;function forEachTermsNested(quad,cb,keys2=[]){quad.subject.termType==="Quad"?forEachTermsNested(quad.subject,cb,[...keys2,"subject"]):cb(quad.subject,[...keys2,"subject"]),quad.predicate.termType==="Quad"?forEachTermsNested(quad.predicate,cb,[...keys2,"predicate"]):cb(quad.predicate,[...keys2,"predicate"]),quad.object.termType==="Quad"?forEachTermsNested(quad.object,cb,[...keys2,"object"]):cb(quad.object,[...keys2,"object"]),quad.graph.termType==="Quad"?forEachTermsNested(quad.graph,cb,[...keys2,"graph"]):cb(quad.graph,[...keys2,"graph"])}__name(forEachTermsNested,"forEachTermsNested");QuadTermUtil.forEachTermsNested=forEachTermsNested;function filterTerms(quad,filter4){const terms=[];return filter4(quad.subject,"subject")&&terms.push(quad.subject),filter4(quad.predicate,"predicate")&&terms.push(quad.predicate),filter4(quad.object,"object")&&terms.push(quad.object),filter4(quad.graph,"graph")&&terms.push(quad.graph),terms}__name(filterTerms,"filterTerms");QuadTermUtil.filterTerms=filterTerms;function filterTermsNested(quad,filter4,keys2=[]){let terms=[];return quad.subject.termType==="Quad"?terms=[...terms,...filterTermsNested(quad.subject,filter4,[...keys2,"subject"])]:filter4(quad.subject,[...keys2,"subject"])&&terms.push(quad.subject),quad.predicate.termType==="Quad"?terms=[...terms,...filterTermsNested(quad.predicate,filter4,[...keys2,"predicate"])]:filter4(quad.predicate,[...keys2,"predicate"])&&terms.push(quad.predicate),quad.object.termType==="Quad"?terms=[...terms,...filterTermsNested(quad.object,filter4,[...keys2,"object"])]:filter4(quad.object,[...keys2,"object"])&&terms.push(quad.object),quad.graph.termType==="Quad"?terms=[...terms,...filterTermsNested(quad.graph,filter4,[...keys2,"graph"])]:filter4(quad.graph,[...keys2,"graph"])&&terms.push(quad.graph),terms}__name(filterTermsNested,"filterTermsNested");QuadTermUtil.filterTermsNested=filterTermsNested;function filterQuadTermNames(quad,filter4){const names=[];return filter4(quad.subject,"subject")&&names.push("subject"),filter4(quad.predicate,"predicate")&&names.push("predicate"),filter4(quad.object,"object")&&names.push("object"),filter4(quad.graph,"graph")&&names.push("graph"),names}__name(filterQuadTermNames,"filterQuadTermNames");QuadTermUtil.filterQuadTermNames=filterQuadTermNames;function filterQuadTermNamesNested(quad,filter4,keys2=[]){let names=[];const keysS=[...keys2,"subject"];quad.subject.termType==="Quad"?names=[...names,...filterQuadTermNamesNested(quad.subject,filter4,keysS)]:filter4(quad.subject,keysS)&&names.push(keysS);const keysP=[...keys2,"predicate"];quad.predicate.termType==="Quad"?names=[...names,...filterQuadTermNamesNested(quad.predicate,filter4,keysP)]:filter4(quad.predicate,keysP)&&names.push(keysP);const keysO=[...keys2,"object"];quad.object.termType==="Quad"?names=[...names,...filterQuadTermNamesNested(quad.object,filter4,keysO)]:filter4(quad.object,keysO)&&names.push(keysO);const keysG=[...keys2,"graph"];return quad.graph.termType==="Quad"?names=[...names,...filterQuadTermNamesNested(quad.graph,filter4,keysG)]:filter4(quad.graph,keysG)&&names.push(keysG),names}__name(filterQuadTermNamesNested,"filterQuadTermNamesNested");QuadTermUtil.filterQuadTermNamesNested=filterQuadTermNamesNested;function mapTerms(quad,mapper,dataFactory){return(dataFactory||DF$l).quad(mapper(quad.subject,"subject"),mapper(quad.predicate,"predicate"),mapper(quad.object,"object"),mapper(quad.graph,"graph"))}__name(mapTerms,"mapTerms");QuadTermUtil.mapTerms=mapTerms;function mapTermsNested(quad,mapper,dataFactory,keys2=[]){return(dataFactory||DF$l).quad(quad.subject.termType==="Quad"?mapTermsNested(quad.subject,mapper,dataFactory,[...keys2,"subject"]):mapper(quad.subject,[...keys2,"subject"]),quad.predicate.termType==="Quad"?mapTermsNested(quad.predicate,mapper,dataFactory,[...keys2,"predicate"]):mapper(quad.predicate,[...keys2,"predicate"]),quad.object.termType==="Quad"?mapTermsNested(quad.object,mapper,dataFactory,[...keys2,"object"]):mapper(quad.object,[...keys2,"object"]),quad.graph.termType==="Quad"?mapTermsNested(quad.graph,mapper,dataFactory,[...keys2,"graph"]):mapper(quad.graph,[...keys2,"graph"]))}__name(mapTermsNested,"mapTermsNested");QuadTermUtil.mapTermsNested=mapTermsNested;function reduceTerms(quad,reducer,initialValue){let value=initialValue;return value=reducer(value,quad.subject,"subject"),value=reducer(value,quad.predicate,"predicate"),value=reducer(value,quad.object,"object"),reducer(value,quad.graph,"graph")}__name(reduceTerms,"reduceTerms");QuadTermUtil.reduceTerms=reduceTerms;function reduceTermsNested(quad,reducer,initialValue,keys2=[]){let value=initialValue;return quad.subject.termType==="Quad"?value=reduceTermsNested(quad.subject,reducer,value,[...keys2,"subject"]):value=reducer(value,quad.subject,[...keys2,"subject"]),quad.predicate.termType==="Quad"?value=reduceTermsNested(quad.predicate,reducer,value,[...keys2,"predicate"]):value=reducer(value,quad.predicate,[...keys2,"predicate"]),quad.object.termType==="Quad"?value=reduceTermsNested(quad.object,reducer,value,[...keys2,"object"]):value=reducer(value,quad.object,[...keys2,"object"]),quad.graph.termType==="Quad"?value=reduceTermsNested(quad.graph,reducer,value,[...keys2,"graph"]):value=reducer(value,quad.graph,[...keys2,"graph"]),value}__name(reduceTermsNested,"reduceTermsNested");QuadTermUtil.reduceTermsNested=reduceTermsNested;function everyTerms(quad,checker){return checker(quad.subject,"subject")&&checker(quad.predicate,"predicate")&&checker(quad.object,"object")&&checker(quad.graph,"graph")}__name(everyTerms,"everyTerms");QuadTermUtil.everyTerms=everyTerms;function everyTermsNested(quad,checker,keys2=[]){return(quad.subject.termType==="Quad"?everyTermsNested(quad.subject,checker,[...keys2,"subject"]):checker(quad.subject,[...keys2,"subject"]))&&(quad.predicate.termType==="Quad"?everyTermsNested(quad.predicate,checker,[...keys2,"predicate"]):checker(quad.predicate,[...keys2,"predicate"]))&&(quad.object.termType==="Quad"?everyTermsNested(quad.object,checker,[...keys2,"object"]):checker(quad.object,[...keys2,"object"]))&&(quad.graph.termType==="Quad"?everyTermsNested(quad.graph,checker,[...keys2,"graph"]):checker(quad.graph,[...keys2,"graph"]))}__name(everyTermsNested,"everyTermsNested");QuadTermUtil.everyTermsNested=everyTermsNested;function someTerms(quad,checker){return checker(quad.subject,"subject")||checker(quad.predicate,"predicate")||checker(quad.object,"object")||checker(quad.graph,"graph")}__name(someTerms,"someTerms");QuadTermUtil.someTerms=someTerms;function someTermsNested(quad,checker,keys2=[]){return(quad.subject.termType==="Quad"?someTermsNested(quad.subject,checker,[...keys2,"subject"]):checker(quad.subject,[...keys2,"subject"]))||(quad.predicate.termType==="Quad"?someTermsNested(quad.predicate,checker,[...keys2,"predicate"]):checker(quad.predicate,[...keys2,"predicate"]))||(quad.object.termType==="Quad"?someTermsNested(quad.object,checker,[...keys2,"object"]):checker(quad.object,[...keys2,"object"]))||(quad.graph.termType==="Quad"?someTermsNested(quad.graph,checker,[...keys2,"graph"]):checker(quad.graph,[...keys2,"graph"]))}__name(someTermsNested,"someTermsNested");QuadTermUtil.someTermsNested=someTermsNested;function getValueNestedPath(term,keys2){if(keys2.length===0)return term;if(term.termType==="Quad")return getValueNestedPath(term[keys2[0]],keys2.slice(1));throw new Error(`Tried to get ${keys2[0]} from term of type ${term.termType}`)}__name(getValueNestedPath,"getValueNestedPath");QuadTermUtil.getValueNestedPath=getValueNestedPath;function matchTerm(termA,termB){return!termB||termB.termType==="Variable"||termB.termType==="Quad"&&termA.termType==="Quad"&&matchPatternComplete(termA,termB)||termB.equals(termA)}__name(matchTerm,"matchTerm");QuadTermUtil.matchTerm=matchTerm;function matchPattern(quad,subject2,predicate2,object2,graph){return matchTerm(quad.subject,subject2)&&matchTerm(quad.predicate,predicate2)&&matchTerm(quad.object,object2)&&matchTerm(quad.graph,graph)}__name(matchPattern,"matchPattern");QuadTermUtil.matchPattern=matchPattern;function matchPatternComplete(quad,pattern){return matchPattern(quad,pattern.subject,pattern.predicate,pattern.object,pattern.graph)}__name(matchPatternComplete,"matchPatternComplete");QuadTermUtil.matchPatternComplete=matchPatternComplete;function matchPatternMappings(quad,pattern,opt={}){const map2={};function match(_pattern,_quad){return everyTerms(_pattern,(t1,key)=>{var _a2,_b;const t2=_quad[key];switch(t1.termType){case"Variable":return opt.skipVarMapping&&t2.termType==="Variable"||((_b=(_a2=map2[t1.value])===null||_a2===void 0?void 0:_a2.equals(t2))!==null&&_b!==void 0?_b:(map2[t1.value]=t2,!0));case"Quad":return t2.termType==="Quad"&&match(t1,t2);default:return t1.equals(t2)}})}return __name(match,"match"),match(pattern,quad)&&(opt.returnMappings?map2:!0)}__name(matchPatternMappings,"matchPatternMappings");QuadTermUtil.matchPatternMappings=matchPatternMappings;var TermUtil$1={};Object.defineProperty(TermUtil$1,"__esModule",{value:!0});TermUtil$1.getQuads=TermUtil$1.getDefaultGraphs=TermUtil$1.getVariables=TermUtil$1.getLiterals=TermUtil$1.getBlankNodes=TermUtil$1.getNamedNodes=TermUtil$1.getTermsOfType=TermUtil$1.uniqTerms=TermUtil$1.TERM_TYPES=void 0;const rdf_string_1$m=rdfString;TermUtil$1.TERM_TYPES=["NamedNode","BlankNode","Literal","Variable","DefaultGraph","Quad"];function uniqTerms(terms){const hash2={};return terms.filter(term=>{const termString=(0,rdf_string_1$m.termToString)(term);return!(termString in hash2)&&(hash2[termString]=!0)})}__name(uniqTerms,"uniqTerms");TermUtil$1.uniqTerms=uniqTerms;function getTermsOfType(terms,termType){return terms.filter(term=>term.termType===termType)}__name(getTermsOfType,"getTermsOfType");TermUtil$1.getTermsOfType=getTermsOfType;function getNamedNodes(terms){return getTermsOfType(terms,"NamedNode")}__name(getNamedNodes,"getNamedNodes");TermUtil$1.getNamedNodes=getNamedNodes;function getBlankNodes(terms){return getTermsOfType(terms,"BlankNode")}__name(getBlankNodes,"getBlankNodes");TermUtil$1.getBlankNodes=getBlankNodes;function getLiterals(terms){return getTermsOfType(terms,"Literal")}__name(getLiterals,"getLiterals");TermUtil$1.getLiterals=getLiterals;function getVariables(terms){return getTermsOfType(terms,"Variable")}__name(getVariables,"getVariables");TermUtil$1.getVariables=getVariables;function getDefaultGraphs(terms){return getTermsOfType(terms,"DefaultGraph")}__name(getDefaultGraphs,"getDefaultGraphs");TermUtil$1.getDefaultGraphs=getDefaultGraphs;function getQuads(terms){return getTermsOfType(terms,"Quad")}__name(getQuads,"getQuads");TermUtil$1.getQuads=getQuads;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(QuadTermUtil,exports),__exportStar(TermUtil$1,exports)})(rdfTerms);var sparqlalgebrajs={},sparqlAlgebra={},es6=__name(function equal(a,b){if(a===b)return!0;if(a&&b&&typeof a=="object"&&typeof b=="object"){if(a.constructor!==b.constructor)return!1;var length,i,keys2;if(Array.isArray(a)){if(length=a.length,length!=b.length)return!1;for(i=length;i--!==0;)if(!equal(a[i],b[i]))return!1;return!0}if(a instanceof Map&&b instanceof Map){if(a.size!==b.size)return!1;for(i of a.entries())if(!b.has(i[0]))return!1;for(i of a.entries())if(!equal(i[1],b.get(i[0])))return!1;return!0}if(a instanceof Set&&b instanceof Set){if(a.size!==b.size)return!1;for(i of a.entries())if(!b.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(a)&&ArrayBuffer.isView(b)){if(length=a.length,length!=b.length)return!1;for(i=length;i--!==0;)if(a[i]!==b[i])return!1;return!0}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();if(keys2=Object.keys(a),length=keys2.length,length!==Object.keys(b).length)return!1;for(i=length;i--!==0;)if(!Object.prototype.hasOwnProperty.call(b,keys2[i]))return!1;for(i=length;i--!==0;){var key=keys2[i];if(!equal(a[key],b[key]))return!1}return!0}return a!==a&&b!==b},"equal"),algebra={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.expressionTypes=exports.types=void 0,function(types2){types2.ALT="alt",types2.ASK="ask",types2.BGP="bgp",types2.CONSTRUCT="construct",types2.DESCRIBE="describe",types2.DISTINCT="distinct",types2.EXPRESSION="expression",types2.EXTEND="extend",types2.FILTER="filter",types2.FROM="from",types2.GRAPH="graph",types2.GROUP="group",types2.INV="inv",types2.JOIN="join",types2.LEFT_JOIN="leftjoin",types2.LINK="link",types2.MINUS="minus",types2.NOP="nop",types2.NPS="nps",types2.ONE_OR_MORE_PATH="OneOrMorePath",types2.ORDER_BY="orderby",types2.PATH="path",types2.PATTERN="pattern",types2.PROJECT="project",types2.REDUCED="reduced",types2.SEQ="seq",types2.SERVICE="service",types2.SLICE="slice",types2.UNION="union",types2.VALUES="values",types2.ZERO_OR_MORE_PATH="ZeroOrMorePath",types2.ZERO_OR_ONE_PATH="ZeroOrOnePath",types2.COMPOSITE_UPDATE="compositeupdate",types2.DELETE_INSERT="deleteinsert",types2.LOAD="load",types2.CLEAR="clear",types2.CREATE="create",types2.DROP="drop",types2.ADD="add",types2.MOVE="move",types2.COPY="copy"}(exports.types||(exports.types={})),function(expressionTypes){expressionTypes.AGGREGATE="aggregate",expressionTypes.EXISTENCE="existence",expressionTypes.NAMED="named",expressionTypes.OPERATOR="operator",expressionTypes.TERM="term",expressionTypes.WILDCARD="wildcard"}(exports.expressionTypes||(exports.expressionTypes={}))})(algebra);var factory$2={},__createBinding$6=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault$6=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar$6=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding$6(result,mod,k);return __setModuleDefault$6(result,mod),result};Object.defineProperty(factory$2,"__esModule",{value:!0});const A=__importStar$6(algebra),rdf_data_factory_1$x=rdfDataFactory,rdf_string_1$l=rdfString,sparqljs_1$5=sparql$1;class Factory{constructor(dataFactory){this.dataFactory=dataFactory||new rdf_data_factory_1$x.DataFactory,this.stringType=this.createTerm("http://www.w3.org/2001/XMLSchema#string")}createAlt(input,flatten3=!0){return this.flattenMulti({type:A.types.ALT,input},flatten3)}createAsk(input){return{type:A.types.ASK,input}}createBoundAggregate(variable,aggregate,expression,distinct,separator){const result=this.createAggregateExpression(aggregate,expression,distinct,separator);return result.variable=variable,result}createBgp(patterns){return{type:A.types.BGP,patterns}}createConstruct(input,template){return{type:A.types.CONSTRUCT,input,template}}createDescribe(input,terms){return{type:A.types.DESCRIBE,input,terms}}createDistinct(input){return{type:A.types.DISTINCT,input}}createExtend(input,variable,expression){return{type:A.types.EXTEND,input,variable,expression}}createFrom(input,def,named){return{type:A.types.FROM,input,default:def,named}}createFilter(input,expression){return{type:A.types.FILTER,input,expression}}createGraph(input,name){return{type:A.types.GRAPH,input,name}}createGroup(input,variables2,aggregates){return{type:A.types.GROUP,input,variables:variables2,aggregates}}createInv(path){return{type:A.types.INV,path}}createJoin(input,flatten3=!0){return this.flattenMulti({type:A.types.JOIN,input},flatten3)}createLeftJoin(left,right,expression){return expression?{type:A.types.LEFT_JOIN,input:[left,right],expression}:{type:A.types.LEFT_JOIN,input:[left,right]}}createLink(iri){return{type:A.types.LINK,iri}}createMinus(left,right){return{type:A.types.MINUS,input:[left,right]}}createNop(){return{type:A.types.NOP}}createNps(iris){return{type:A.types.NPS,iris}}createOneOrMorePath(path){return{type:A.types.ONE_OR_MORE_PATH,path}}createOrderBy(input,expressions2){return{type:A.types.ORDER_BY,input,expressions:expressions2}}createPath(subject2,predicate2,object2,graph){return graph?{type:A.types.PATH,subject:subject2,predicate:predicate2,object:object2,graph}:{type:A.types.PATH,subject:subject2,predicate:predicate2,object:object2,graph:this.dataFactory.defaultGraph()}}createPattern(subject2,predicate2,object2,graph){const pattern=this.dataFactory.quad(subject2,predicate2,object2,graph);return pattern.type=A.types.PATTERN,pattern}createProject(input,variables2){return{type:A.types.PROJECT,input,variables:variables2}}createReduced(input){return{type:A.types.REDUCED,input}}createSeq(input,flatten3=!0){return this.flattenMulti({type:A.types.SEQ,input},flatten3)}createService(input,name,silent){return{type:A.types.SERVICE,input,name,silent:!!silent}}createSlice(input,start,length){return start=start||0,length!==void 0?{type:A.types.SLICE,input,start,length}:{type:A.types.SLICE,input,start}}createUnion(input,flatten3=!0){return this.flattenMulti({type:A.types.UNION,input},flatten3)}createValues(variables2,bindings){return{type:A.types.VALUES,variables:variables2,bindings}}createZeroOrMorePath(path){return{type:A.types.ZERO_OR_MORE_PATH,path}}createZeroOrOnePath(path){return{type:A.types.ZERO_OR_ONE_PATH,path}}createAggregateExpression(aggregator,expression,distinct,separator){return separator?{type:A.types.EXPRESSION,expressionType:A.expressionTypes.AGGREGATE,aggregator,expression,separator,distinct}:{type:A.types.EXPRESSION,expressionType:A.expressionTypes.AGGREGATE,aggregator,expression,distinct}}createExistenceExpression(not2,input){return{type:A.types.EXPRESSION,expressionType:A.expressionTypes.EXISTENCE,not:not2,input}}createNamedExpression(name,args){return{type:A.types.EXPRESSION,expressionType:A.expressionTypes.NAMED,name,args}}createOperatorExpression(operator,args){return{type:A.types.EXPRESSION,expressionType:A.expressionTypes.OPERATOR,operator,args}}createTermExpression(term){return{type:A.types.EXPRESSION,expressionType:A.expressionTypes.TERM,term}}createWildcardExpression(){return{type:A.types.EXPRESSION,expressionType:A.expressionTypes.WILDCARD,wildcard:new sparqljs_1$5.Wildcard}}createTerm(str){return(0,rdf_string_1$l.stringToTerm)(str,this.dataFactory)}createCompositeUpdate(updates){return{type:A.types.COMPOSITE_UPDATE,updates}}createDeleteInsert(deleteQuads,insertQuads,where){const result={type:A.types.DELETE_INSERT};return deleteQuads&&(result.delete=deleteQuads),insertQuads&&(result.insert=insertQuads),where&&(result.where=where),result}createLoad(source,destination,silent){const result={type:A.types.LOAD,source};return destination&&(result.destination=destination),this.addSilent(result,!!silent)}createClear(source,silent){return this.addSilent({type:A.types.CLEAR,source},!!silent)}createCreate(source,silent){return this.addSilent({type:A.types.CREATE,source},!!silent)}createDrop(source,silent){return this.addSilent({type:A.types.DROP,source},!!silent)}createAdd(source,destination,silent){return this.addSilent({type:A.types.ADD,source,destination},!!silent)}createMove(source,destination,silent){return this.addSilent({type:A.types.MOVE,source,destination},!!silent)}createCopy(source,destination,silent){return this.addSilent({type:A.types.COPY,source,destination},!!silent)}addSilent(input,silent){return silent&&(input.silent=silent),input}flattenMulti(input,flatten3){if(!flatten3)return input;const type=input.type,children=input.input;let newChildren=[];for(const child of children)child.type===type?newChildren.push(...child.input):newChildren.push(child);return input.input=newChildren,input}}__name(Factory,"Factory");factory$2.default=Factory;var util={},__importDefault$6=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(util,"__esModule",{value:!0});const algebra_1=algebra,factory_1$2=__importDefault$6(factory$2),rdf_terms_1$e=rdfTerms;let Util$b=__name(class Util{static flatten(arr){return Array.prototype.concat(...arr).filter(x=>x)}static objectify(algebra2){if(algebra2.termType){if(algebra2.termType==="Quad")return{type:"pattern",termType:"Quad",subject:Util.objectify(algebra2.subject),predicate:Util.objectify(algebra2.predicate),object:Util.objectify(algebra2.object),graph:Util.objectify(algebra2.graph)};{let result={termType:algebra2.termType,value:algebra2.value};return algebra2.language&&(result.language=algebra2.language),algebra2.datatype&&(result.datatype=Util.objectify(algebra2.datatype)),result}}if(Array.isArray(algebra2))return algebra2.map(e=>Util.objectify(e));if(algebra2===Object(algebra2)){let result={};for(let key of Object.keys(algebra2))result[key]=Util.objectify(algebra2[key]);return result}return algebra2}static inScopeVariables(op){const variables2=[];function addVariable(v){variables2.find(v2=>v.value===v2.value)||variables2.push(v)}__name(addVariable,"addVariable");function recurseTerm(quad){quad.subject.termType==="Variable"&&addVariable(quad.subject),quad.predicate.termType==="Variable"&&addVariable(quad.predicate),quad.object.termType==="Variable"&&addVariable(quad.object),quad.graph.termType==="Variable"&&addVariable(quad.graph),quad.subject.termType==="Quad"&&recurseTerm(quad.subject),quad.predicate.termType==="Quad"&&recurseTerm(quad.predicate),quad.object.termType==="Quad"&&recurseTerm(quad.object),quad.graph.termType==="Quad"&&recurseTerm(quad.graph)}return __name(recurseTerm,"recurseTerm"),Util.recurseOperation(op,{[algebra_1.types.EXPRESSION]:op2=>(op2.expressionType===algebra_1.expressionTypes.AGGREGATE&&op2.variable&&addVariable(op2.variable),!0),[algebra_1.types.EXTEND]:op2=>(addVariable(op2.variable),!0),[algebra_1.types.GRAPH]:op2=>(op2.name.termType==="Variable"&&addVariable(op2.name),!0),[algebra_1.types.GROUP]:op2=>(op2.variables.forEach(addVariable),!0),[algebra_1.types.PATH]:op2=>(op2.subject.termType==="Variable"&&addVariable(op2.subject),op2.object.termType==="Variable"&&addVariable(op2.object),op2.graph.termType==="Variable"&&addVariable(op2.graph),op2.subject.termType==="Quad"&&recurseTerm(op2.subject),op2.object.termType==="Quad"&&recurseTerm(op2.object),op2.graph.termType==="Quad"&&recurseTerm(op2.graph),!0),[algebra_1.types.PATTERN]:op2=>(recurseTerm(op2),!0),[algebra_1.types.PROJECT]:op2=>(op2.variables.forEach(addVariable),!1),[algebra_1.types.SERVICE]:op2=>(op2.name.termType==="Variable"&&addVariable(op2.name),!0),[algebra_1.types.VALUES]:op2=>(op2.variables.forEach(addVariable),!0)}),variables2}static recurseOperation(op,callbacks){let result=op,doRecursion=!0;const callback=callbacks[op.type];if(callback&&(doRecursion=callback(op)),!doRecursion)return;let recurseOp=__name(op2=>Util.recurseOperation(op2,callbacks),"recurseOp");switch(result.type){case algebra_1.types.ALT:result.input.map(recurseOp);break;case algebra_1.types.ASK:recurseOp(result.input);break;case algebra_1.types.BGP:result.patterns.forEach(recurseOp);break;case algebra_1.types.CONSTRUCT:recurseOp(result.input),result.template.map(recurseOp);break;case algebra_1.types.DESCRIBE:recurseOp(result.input);break;case algebra_1.types.DISTINCT:recurseOp(result.input);break;case algebra_1.types.EXPRESSION:result.expressionType===algebra_1.expressionTypes.EXISTENCE&&recurseOp(result.input);break;case algebra_1.types.EXTEND:recurseOp(result.input),recurseOp(result.expression);break;case algebra_1.types.FILTER:recurseOp(result.input),recurseOp(result.expression);break;case algebra_1.types.FROM:recurseOp(result.input);break;case algebra_1.types.GRAPH:recurseOp(result.input);break;case algebra_1.types.GROUP:recurseOp(result.input),result.aggregates.forEach(recurseOp);break;case algebra_1.types.INV:recurseOp(result.path);break;case algebra_1.types.JOIN:result.input.map(recurseOp);break;case algebra_1.types.LEFT_JOIN:result.input.map(recurseOp),result.expression&&recurseOp(result.expression);break;case algebra_1.types.LINK:break;case algebra_1.types.MINUS:result.input.map(recurseOp);break;case algebra_1.types.NOP:break;case algebra_1.types.NPS:break;case algebra_1.types.ONE_OR_MORE_PATH:recurseOp(result.path);break;case algebra_1.types.ORDER_BY:recurseOp(result.input),result.expressions.forEach(recurseOp);break;case algebra_1.types.PATH:recurseOp(result.predicate);break;case algebra_1.types.PATTERN:break;case algebra_1.types.PROJECT:recurseOp(result.input);break;case algebra_1.types.REDUCED:recurseOp(result.input);break;case algebra_1.types.SEQ:result.input.map(recurseOp);break;case algebra_1.types.SERVICE:recurseOp(result.input);break;case algebra_1.types.SLICE:recurseOp(result.input);break;case algebra_1.types.UNION:result.input.map(recurseOp);break;case algebra_1.types.VALUES:break;case algebra_1.types.ZERO_OR_MORE_PATH:recurseOp(result.path);break;case algebra_1.types.ZERO_OR_ONE_PATH:recurseOp(result.path);break;case algebra_1.types.COMPOSITE_UPDATE:result.updates.forEach(update11=>recurseOp(update11));break;case algebra_1.types.DELETE_INSERT:result.delete&&result.delete.forEach(pattern=>recurseOp(pattern)),result.insert&&result.insert.forEach(pattern=>recurseOp(pattern)),result.where&&recurseOp(result.where);break;case algebra_1.types.LOAD:break;case algebra_1.types.CLEAR:break;case algebra_1.types.CREATE:break;case algebra_1.types.DROP:break;case algebra_1.types.ADD:break;case algebra_1.types.MOVE:break;case algebra_1.types.COPY:break;default:throw new Error(`Unknown Operation type ${result.type}`)}}static mapOperation(op,callbacks,factory2){let result=op,doRecursion=!0;factory2=factory2||new factory_1$2.default;const callback=callbacks[op.type];if(callback&&({result,recurse:doRecursion}=callback(op,factory2)),!doRecursion)return result;let mapOp=__name(op2=>Util.mapOperation(op2,callbacks,factory2),"mapOp");switch(result.type){case algebra_1.types.ALT:return factory2.createAlt(result.input.map(mapOp));case algebra_1.types.ASK:return factory2.createAsk(mapOp(result.input));case algebra_1.types.BGP:return factory2.createBgp(result.patterns.map(mapOp));case algebra_1.types.CONSTRUCT:return factory2.createConstruct(mapOp(result.input),result.template.map(mapOp));case algebra_1.types.DESCRIBE:return factory2.createDescribe(mapOp(result.input),result.terms);case algebra_1.types.DISTINCT:return factory2.createDistinct(mapOp(result.input));case algebra_1.types.EXPRESSION:return Util.mapExpression(result,callbacks,factory2);case algebra_1.types.EXTEND:return factory2.createExtend(mapOp(result.input),result.variable,mapOp(result.expression));case algebra_1.types.FILTER:return factory2.createFilter(mapOp(result.input),mapOp(result.expression));case algebra_1.types.FROM:return factory2.createFrom(mapOp(result.input),[...result.default],[...result.named]);case algebra_1.types.GRAPH:return factory2.createGraph(mapOp(result.input),result.name);case algebra_1.types.GROUP:return factory2.createGroup(mapOp(result.input),[].concat(result.variables),result.aggregates.map(mapOp));case algebra_1.types.INV:return factory2.createInv(mapOp(result.path));case algebra_1.types.JOIN:return factory2.createJoin(result.input.map(mapOp));case algebra_1.types.LEFT_JOIN:return factory2.createLeftJoin(mapOp(result.input[0]),mapOp(result.input[1]),result.expression?mapOp(result.expression):void 0);case algebra_1.types.LINK:return factory2.createLink(result.iri);case algebra_1.types.MINUS:return factory2.createMinus(mapOp(result.input[0]),mapOp(result.input[1]));case algebra_1.types.NOP:return factory2.createNop();case algebra_1.types.NPS:return factory2.createNps([].concat(result.iris));case algebra_1.types.ONE_OR_MORE_PATH:return factory2.createOneOrMorePath(mapOp(result.path));case algebra_1.types.ORDER_BY:return factory2.createOrderBy(mapOp(result.input),result.expressions.map(mapOp));case algebra_1.types.PATH:return factory2.createPath(result.subject,mapOp(result.predicate),result.object,result.graph);case algebra_1.types.PATTERN:return factory2.createPattern(result.subject,result.predicate,result.object,result.graph);case algebra_1.types.PROJECT:return factory2.createProject(mapOp(result.input),[...result.variables]);case algebra_1.types.REDUCED:return factory2.createReduced(mapOp(result.input));case algebra_1.types.SEQ:return factory2.createSeq(result.input.map(mapOp));case algebra_1.types.SERVICE:return factory2.createService(mapOp(result.input),result.name,result.silent);case algebra_1.types.SLICE:return factory2.createSlice(mapOp(result.input),result.start,result.length);case algebra_1.types.UNION:return factory2.createUnion(result.input.map(mapOp));case algebra_1.types.VALUES:return factory2.createValues([].concat(result.variables),result.bindings.map(b=>Object.assign({},b)));case algebra_1.types.ZERO_OR_MORE_PATH:return factory2.createZeroOrMorePath(mapOp(result.path));case algebra_1.types.ZERO_OR_ONE_PATH:return factory2.createZeroOrOnePath(mapOp(result.path));case algebra_1.types.COMPOSITE_UPDATE:return factory2.createCompositeUpdate(result.updates.map(mapOp));case algebra_1.types.DELETE_INSERT:return factory2.createDeleteInsert(result.delete?result.delete.map(mapOp):void 0,result.insert?result.insert.map(mapOp):void 0,result.where?mapOp(result.where):void 0);case algebra_1.types.LOAD:return factory2.createLoad(result.source,result.destination,result.silent);case algebra_1.types.CLEAR:return factory2.createClear(result.source,result.silent);case algebra_1.types.CREATE:return factory2.createCreate(result.source,result.silent);case algebra_1.types.DROP:return factory2.createDrop(result.source,result.silent);case algebra_1.types.ADD:return factory2.createAdd(result.source,result.destination);case algebra_1.types.MOVE:return factory2.createMove(result.source,result.destination);case algebra_1.types.COPY:return factory2.createCopy(result.source,result.destination);default:throw new Error(`Unknown Operation type ${result.type}`)}}static mapExpression(expr,callbacks,factory2){let result=expr,doRecursion=!0;factory2=factory2||new factory_1$2.default;const callback=callbacks[expr.expressionType];if(callback&&({result,recurse:doRecursion}=callback(expr,factory2)),!doRecursion)return result;let mapOp=__name(op=>Util.mapOperation(op,callbacks,factory2),"mapOp");switch(expr.expressionType){case algebra_1.expressionTypes.AGGREGATE:return expr.variable?factory2.createBoundAggregate(expr.variable,expr.aggregator,mapOp(expr.expression),expr.distinct,expr.separator):factory2.createAggregateExpression(expr.aggregator,mapOp(expr.expression),expr.distinct,expr.separator);case algebra_1.expressionTypes.EXISTENCE:return factory2.createExistenceExpression(expr.not,mapOp(expr.input));case algebra_1.expressionTypes.NAMED:return factory2.createNamedExpression(expr.name,expr.args.map(mapOp));case algebra_1.expressionTypes.OPERATOR:return factory2.createOperatorExpression(expr.operator,expr.args.map(mapOp));case algebra_1.expressionTypes.TERM:return factory2.createTermExpression(expr.term);case algebra_1.expressionTypes.WILDCARD:return factory2.createWildcardExpression();default:throw new Error(`Unknown Expression type ${expr.expressionType}`)}}static cloneOperation(op){return Util.mapOperation(op,{})}static cloneExpression(expr){return Util.mapExpression(expr,{})}static createUniqueVariable(label,variables2,dataFactory){let counter=0,labelLoop=label;for(;variables2[labelLoop];)labelLoop=`${label}${counter++}`;return dataFactory.variable(labelLoop)}static isSimpleTerm(term){return term.termType!==void 0&&term.termType!=="Quad"&&term.termType!=="Wildcard"}static isQuad(term){return term.termType==="Quad"}static hasQuadVariables(quad){return(0,rdf_terms_1$e.someTermsNested)(quad,term=>term.termType==="Variable")}static isWildcard(term){return term.termType==="Wildcard"}},"Util");util.default=Util$b;var __createBinding$5=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault$5=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar$5=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding$5(result,mod,k);return __setModuleDefault$5(result,mod),result},__importDefault$5=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(sparqlAlgebra,"__esModule",{value:!0});const equal2=es6,rdf_string_1$k=rdfString,Algebra$1=__importStar$5(algebra),factory_1$1=__importDefault$5(factory$2),util_1$1=__importDefault$5(util),Parser$8=sparql$1.Parser,types$1=Algebra$1.types;let variables=new Set,varCount=0,useQuads=!1,factory$1;function translate(sparql2,options){options=options||{},factory$1=new factory_1$1.default(options.dataFactory);let query;if(isString(sparql2)){let parser=new Parser$8(options);parser._resetBlanks(),query=parser.parse(sparql2)}else query=sparql2;return translateQuery(query,options.quads,options.blankToVariable)}__name(translate,"translate");sparqlAlgebra.default=translate;function translateQuery(sparql2,quads,blankToVariable){if(variables=new Set,varCount=0,useQuads=!!quads,!sparql2.type)return factory$1.createNop();if(sparql2.type!=="query"&&sparql2.type!=="update")throw new Error("Translate only works on complete query or update objects.");let res;if(findAllVariables(sparql2),sparql2.type==="query"){const group={type:"group",patterns:sparql2.where||[]};res=translateGroupGraphPattern(group),res=translateAggregates(sparql2,res)}else sparql2.type==="update"&&(res=translateUpdate(sparql2));return blankToVariable&&(res=translateBlankNodesToVariables(res)),res}__name(translateQuery,"translateQuery");function isString(str){return typeof str=="string"}__name(isString,"isString");function isTerm(term){return!!(term!=null&&term.termType)}__name(isTerm,"isTerm");function isTriple(triple2){return triple2.subject&&triple2.predicate&&triple2.object}__name(isTriple,"isTriple");function isVariable(term){return(term==null?void 0:term.termType)==="Variable"}__name(isVariable,"isVariable");function findAllVariables(thingy){if(isTerm(thingy))isVariable(thingy)&&variables.add(`?${thingy.value}`);else if(Array.isArray(thingy))for(const entry of thingy)findAllVariables(entry);else if(thingy&&typeof thingy=="object")for(let key of Object.keys(thingy))key.startsWith("?")&&variables.add(key),findAllVariables(thingy[key])}__name(findAllVariables,"findAllVariables");function inScopeVariables(thingy){let inScope={};if(isTriple(thingy)){const result=[inScopeVariables(thingy.subject),inScopeVariables(thingy.predicate),inScopeVariables(thingy.object),thingy.graph?inScopeVariables(thingy.graph):{}];Object.assign(inScope,...result)}else if(isTerm(thingy))isVariable(thingy)&&(inScope[thingy.value]=thingy);else if(thingy.type==="bgp"){const quads=thingy.triples;Object.assign(inScope,...quads.map(inScopeVariables))}else if(thingy.type==="path")Object.assign(inScope,...thingy.items.map(inScopeVariables));else if(thingy.type==="group"||thingy.type==="union"||thingy.type==="optional")Object.assign(inScope,...thingy.patterns.map(inScopeVariables));else if(thingy.type==="service"||thingy.type==="graph")Object.assign(inScope,inScopeVariables(thingy.name)),Object.assign(inScope,...thingy.patterns.map(inScopeVariables));else if(thingy.type==="bind")Object.assign(inScope,inScopeVariables(thingy.variable));else if(thingy.type==="values"){if(thingy.values.length>0){const vars=Object.keys(thingy.values[0]).map(v=>factory$1.createTerm(v));Object.assign(inScope,...vars.map(inScopeVariables))}}else if(thingy.type==="query"&&(thingy.queryType==="SELECT"||thingy.queryType==="DESCRIBE")){thingy.where&&thingy.variables.some(util_1$1.default.isWildcard)&&Object.assign(inScope,...thingy.where.map(inScopeVariables));for(const v of thingy.variables)isVariable(v)?Object.assign(inScope,inScopeVariables(v)):v.variable&&Object.assign(inScope,inScopeVariables(v.variable));if(thingy.queryType==="SELECT"){if(thingy.group)for(const g of thingy.group)g.variable&&Object.assign(inScope,inScopeVariables(g.variable));if(thingy.values){const values2={type:"values",values:thingy.values};Object.assign(inScope,inScopeVariables(values2))}}}return inScope}__name(inScopeVariables,"inScopeVariables");function translateGroupGraphPattern(thingy){let filters=[],nonfilters=[];if("patterns"in thingy)for(let pattern of thingy.patterns)(pattern.type==="filter"?filters:nonfilters).push(pattern);if(thingy.type==="bgp")return translateBgp$1(thingy);let result;if(thingy.type==="union")result=factory$1.createUnion(nonfilters.map(p=>(p.type!=="group"&&(p={type:"group",patterns:[p]}),translateGroupGraphPattern(p))));else{if(thingy.type==="graph")return translateGraph$1(thingy);if(thingy.type==="group")result=nonfilters.reduce(accumulateGroupGraphPattern,factory$1.createBgp([]));else if(thingy.type==="values")result=translateInlineData(thingy);else if(thingy.type==="query")result=translateQuery(thingy,useQuads,!1);else throw new Error(`Unexpected type: ${thingy.type}`)}if(filters.length>0){let expressions2=filters.map(filter4=>translateExpression$1(filter4.expression));expressions2.length>0&&(result=factory$1.createFilter(result,expressions2.reduce((acc,exp)=>factory$1.createOperatorExpression("&&",[acc,exp]))))}return result}__name(translateGroupGraphPattern,"translateGroupGraphPattern");function translateExpression$1(exp){if(util_1$1.default.isSimpleTerm(exp))return factory$1.createTermExpression(exp);if(util_1$1.default.isQuad(exp))return util_1$1.default.hasQuadVariables(exp)?factory$1.createOperatorExpression("triple",[translateExpression$1(exp.subject),translateExpression$1(exp.predicate),translateExpression$1(exp.object)]):factory$1.createTermExpression(exp);if(util_1$1.default.isWildcard(exp))return factory$1.createWildcardExpression();if("aggregation"in exp)return factory$1.createAggregateExpression(exp.aggregation,translateExpression$1(exp.expression),!!exp.distinct,exp.separator);if("function"in exp)return factory$1.createNamedExpression(exp.function,exp.args.map(translateExpression$1));if("operator"in exp)return exp.operator==="exists"||exp.operator==="notexists"?factory$1.createExistenceExpression(exp.operator==="notexists",translateGroupGraphPattern(exp.args[0])):((exp.operator==="in"||exp.operator==="notin")&&(exp.args=[exp.args[0]].concat(exp.args[1])),factory$1.createOperatorExpression(exp.operator,exp.args.map(translateExpression$1)));throw new Error(`Unknown expression: ${JSON.stringify(exp)}`)}__name(translateExpression$1,"translateExpression$1");function translateBgp$1(thingy){let patterns=[],joins=[];for(let t of thingy.triples)if("pathType"in t.predicate){let path=translatePath$1(t);for(let p of path)p.type===types$1.PATH?(patterns.length>0&&joins.push(factory$1.createBgp(patterns)),patterns=[],joins.push(p)):patterns.push(p)}else patterns.push(translateQuad(t));return patterns.length>0&&joins.push(factory$1.createBgp(patterns)),joins.length===1?joins[0]:factory$1.createJoin(joins)}__name(translateBgp$1,"translateBgp$1");function translatePath$1(triple2){let sub=triple2.subject,pred=translatePathPredicate(triple2.predicate),obj=triple2.object;return simplifyPath(sub,pred,obj)}__name(translatePath$1,"translatePath$1");function translatePathPredicate(predicate2){if(util_1$1.default.isSimpleTerm(predicate2)){if(predicate2.termType==="NamedNode")return factory$1.createLink(predicate2);throw new Error(`Path predicate should be a NamedNode, got ${JSON.stringify(predicate2)}`)}if(predicate2.pathType==="^")return factory$1.createInv(translatePathPredicate(predicate2.items[0]));if(predicate2.pathType==="!"){let normals=[],inverted=[],items;"pathType"in predicate2.items[0]&&predicate2.items[0].pathType==="|"?items=predicate2.items[0].items:items=predicate2.items;for(let item of items)if(util_1$1.default.isSimpleTerm(item))normals.push(item);else if(item.pathType==="^")inverted.push(item.items[0]);else throw new Error(`Unexpected item: ${JSON.stringify(item)}`);let normalElement=factory$1.createNps(normals),invertedElement=factory$1.createInv(factory$1.createNps(inverted));return inverted.length===0?normalElement:normals.length===0?invertedElement:factory$1.createAlt([normalElement,invertedElement])}if(predicate2.pathType==="/")return factory$1.createSeq(predicate2.items.map(translatePathPredicate));if(predicate2.pathType==="|")return factory$1.createAlt(predicate2.items.map(translatePathPredicate));if(predicate2.pathType==="*")return factory$1.createZeroOrMorePath(translatePathPredicate(predicate2.items[0]));if(predicate2.pathType==="+")return factory$1.createOneOrMorePath(translatePathPredicate(predicate2.items[0]));if(predicate2.pathType==="?")return factory$1.createZeroOrOnePath(translatePathPredicate(predicate2.items[0]));throw new Error(`Unable to translate path expression ${JSON.stringify(predicate2)}`)}__name(translatePathPredicate,"translatePathPredicate");function simplifyPath(subject2,predicate2,object2){if(predicate2.type===types$1.LINK)return[factory$1.createPattern(subject2,predicate2.iri,object2)];if(predicate2.type===types$1.INV)return simplifyPath(object2,predicate2.path,subject2);if(predicate2.type===types$1.SEQ){let joiner=subject2;return util_1$1.default.flatten(predicate2.input.map((subOp,i)=>{const nextJoiner=i===predicate2.input.length-1?object2:generateFreshVar(),simplifiedPath=simplifyPath(joiner,subOp,nextJoiner);return nextJoiner.termType==="Variable"&&(joiner=nextJoiner),simplifiedPath}))}return[factory$1.createPath(subject2,predicate2,object2)]}__name(simplifyPath,"simplifyPath");function generateFreshVar(){let v=`?var${varCount++}`;return variables.has(v)?generateFreshVar():(variables.add(v),factory$1.createTerm(v))}__name(generateFreshVar,"generateFreshVar");function translateQuad(quad){if("pathType"in quad.predicate)throw new Error("Trying to translate property path to quad.");return factory$1.createPattern(quad.subject,quad.predicate,quad.object,quad.graph)}__name(translateQuad,"translateQuad");function translateGraph$1(graph){const group={type:"group",patterns:graph.patterns};let result=translateGroupGraphPattern(group);return useQuads?result=recurseGraph(result,graph.name):result=factory$1.createGraph(result,graph.name),result}__name(translateGraph$1,"translateGraph$1");let typeVals=Object.values(types$1);function recurseGraph(thingy,graph,replacement){if(thingy.type===types$1.GRAPH){if(replacement)throw new Error("Recursing through nested GRAPH statements with a replacement is impossible.");thingy=recurseGraph(thingy.input,thingy.name)}else if(thingy.type===types$1.BGP)thingy.patterns=thingy.patterns.map(quad=>(replacement&&(quad.subject.equals(graph)&&(quad.subject=replacement),quad.predicate.equals(graph)&&(quad.predicate=replacement),quad.object.equals(graph)&&(quad.object=replacement)),quad.graph.termType==="DefaultGraph"&&(quad.graph=graph),quad));else if(thingy.type===types$1.PATH)replacement&&(thingy.subject.equals(graph)&&(thingy.subject=replacement),thingy.object.equals(graph)&&(thingy.object=replacement)),thingy.graph.termType==="DefaultGraph"&&(thingy.graph=graph);else if(thingy.type===types$1.PROJECT&&!replacement)thingy.variables.some(v=>v.equals(graph))||(replacement=generateFreshVar()),thingy.input=recurseGraph(thingy.input,graph,replacement);else if(thingy.type===types$1.EXTEND&&!replacement)thingy.variable.equals(graph)&&(replacement=generateFreshVar()),thingy.input=recurseGraph(thingy.input,graph,replacement);else for(let key of Object.keys(thingy))Array.isArray(thingy[key])?thingy[key]=thingy[key].map(x=>recurseGraph(x,graph,replacement)):typeVals.indexOf(thingy[key].type)>=0?thingy[key]=recurseGraph(thingy[key],graph,replacement):replacement&&isVariable(thingy[key])&&thingy[key].equals(graph)&&(thingy[key]=replacement);return thingy}__name(recurseGraph,"recurseGraph");function accumulateGroupGraphPattern(G,E2){if(E2.type==="optional"){const A2=translateGroupGraphPattern({type:"group",patterns:E2.patterns});A2.type===types$1.FILTER?G=factory$1.createLeftJoin(G,A2.input,A2.expression):G=factory$1.createLeftJoin(G,A2)}else if(E2.type==="minus"){const A2=translateGroupGraphPattern({type:"group",patterns:E2.patterns});G=factory$1.createMinus(G,A2)}else if(E2.type==="bind")G=factory$1.createExtend(G,E2.variable,translateExpression$1(E2.expression));else if(E2.type==="service"){const group={type:"group",patterns:E2.patterns},A2=factory$1.createService(translateGroupGraphPattern(group),E2.name,E2.silent);G=simplifiedJoin(G,A2)}else{const A2=translateGroupGraphPattern(E2);G=simplifiedJoin(G,A2)}return G}__name(accumulateGroupGraphPattern,"accumulateGroupGraphPattern");function simplifiedJoin(G,A2){return G.type===types$1.BGP&&A2.type===types$1.BGP?G=factory$1.createBgp([...G.patterns,...A2.patterns]):G.type===types$1.BGP&&G.patterns.length===0?G=A2:A2.type===types$1.BGP&&A2.patterns.length===0||(G=factory$1.createJoin([G,A2])),G}__name(simplifiedJoin,"simplifiedJoin");function translateInlineData(values2){let variables2=(values2.values.length===0?[]:Object.keys(values2.values[0])).map(factory$1.createTerm.bind(factory$1)),bindings=values2.values.map(binding=>{let keys2=Object.keys(binding);keys2=keys2.filter(k=>binding[k]!==void 0);let map2={};for(let key of keys2)map2[key]=binding[key];return map2});return factory$1.createValues(variables2,bindings)}__name(translateInlineData,"translateInlineData");function translateAggregates(query,res){const select=query,E2=[],A2={};if(select.variables=select.variables&&select.variables.map(val=>mapAggregate(val,A2)),select.having=select.having&&select.having.map(val=>mapAggregate(val,A2)),select.order=select.order&&select.order.map(val=>mapAggregate(val,A2)),select.group||Object.keys(A2).length>0){const aggregates=Object.keys(A2).map(v=>translateBoundAggregate$1(A2[v],factory$1.createTerm(v))),vars=[];if(select.group)for(const e of select.group)if(util_1$1.default.isSimpleTerm(e.expression))vars.push(e.expression);else{const v="variable"in e?e.variable:generateFreshVar();res=factory$1.createExtend(res,v,translateExpression$1(e.expression)),vars.push(v)}res=factory$1.createGroup(res,vars,aggregates)}if(select.having)for(let filter4 of select.having)res=factory$1.createFilter(res,translateExpression$1(filter4));query.values&&(res=factory$1.createJoin([res,translateInlineData(query)]));let PV=[];if(query.queryType==="SELECT"||query.queryType==="DESCRIBE")if(query.variables.some(e=>e&&util_1$1.default.isWildcard(e)))PV=Object.values(inScopeVariables(query)).sort((left,right)=>left.value.localeCompare(right.value));else for(let v of query.variables)isVariable(v)||!("variable"in v)?PV.push(v):v.variable&&(PV.push(v.variable),E2.push(v));for(let v of E2)res=factory$1.createExtend(res,v.variable,translateExpression$1(v.expression));return select.order&&(res=factory$1.createOrderBy(res,select.order.map(exp=>{let result=translateExpression$1(exp.expression);return exp.descending&&(result=factory$1.createOperatorExpression("desc",[result])),result}))),query.queryType==="SELECT"&&(res=factory$1.createProject(res,PV)),select.distinct&&(res=factory$1.createDistinct(res)),select.reduced&&(res=factory$1.createReduced(res)),query.queryType==="CONSTRUCT"?res=factory$1.createConstruct(res,(query.template||[]).map(translateQuad)):query.queryType==="ASK"?res=factory$1.createAsk(res):query.queryType==="DESCRIBE"&&(res=factory$1.createDescribe(res,PV)),(select.offset||select.limit)&&(res=factory$1.createSlice(res,select.offset||0,select.limit)),select.from&&(res=factory$1.createFrom(res,select.from.default,select.from.named)),res}__name(translateAggregates,"translateAggregates");function mapAggregate(thingy,aggregates){if("type"in thingy&&thingy.type==="aggregate"){let found=!1,v;for(let key of Object.keys(aggregates))if(equal2(aggregates[key],thingy)){v=factory$1.createTerm(key),found=!0;break}return found||(v=generateFreshVar(),aggregates[(0,rdf_string_1$k.termToString)(v)]=thingy),v}return"expression"in thingy&&thingy.expression?{...thingy,expression:mapAggregate(thingy.expression,aggregates)}:"args"in thingy&&thingy.args?{...thingy,args:thingy.args.map(subthingy=>mapAggregate(subthingy,aggregates))}:thingy}__name(mapAggregate,"mapAggregate");function translateBoundAggregate$1(thingy,v){if(thingy.type!=="aggregate"||!thingy.aggregation)throw new Error(`Unexpected input: ${JSON.stringify(thingy)}`);const A2=translateExpression$1(thingy);return A2.variable=v,A2}__name(translateBoundAggregate$1,"translateBoundAggregate$1");function translateUpdate(thingy){return thingy.updates.length===1?translateSingleUpdate(thingy.updates[0]):factory$1.createCompositeUpdate(thingy.updates.map(translateSingleUpdate))}__name(translateUpdate,"translateUpdate");function translateSingleUpdate(thingy){if("type"in thingy){if(thingy.type==="load")return translateUpdateGraphLoad(thingy);if(thingy.type==="clear"||thingy.type==="create"||thingy.type==="drop")return translateUpdateGraph(thingy);if(thingy.type==="add"||thingy.type==="copy"||thingy.type==="move")return translateUpdateGraphShortcut$1(thingy)}else if(thingy.updateType==="insertdelete"||thingy.updateType==="deletewhere"||thingy.updateType==="delete"||thingy.updateType==="insert")return translateInsertDelete(thingy);throw new Error(`Unknown update type ${JSON.stringify(thingy)}`)}__name(translateSingleUpdate,"translateSingleUpdate");function translateInsertDelete(thingy){if(!useQuads)throw new Error("INSERT/DELETE operations are only supported with quads option enabled");let deleteTriples=[],insertTriples=[],where;if(thingy.delete&&(deleteTriples=util_1$1.default.flatten(thingy.delete.map(input=>translateUpdateTriplesBlock(input,thingy.graph)))),thingy.insert&&(insertTriples=util_1$1.default.flatten(thingy.insert.map(input=>translateUpdateTriplesBlock(input,thingy.graph)))),thingy.where&&thingy.where.length>0){where=translateGroupGraphPattern({type:"group",patterns:thingy.where});const using=thingy.using;using?where=factory$1.createFrom(where,using.default,using.named):thingy.graph&&(where=recurseGraph(where,thingy.graph))}else thingy.updateType==="deletewhere"&&deleteTriples.length>0&&(where=factory$1.createBgp(deleteTriples));return factory$1.createDeleteInsert(deleteTriples.length>0?deleteTriples:void 0,insertTriples.length>0?insertTriples:void 0,where)}__name(translateInsertDelete,"translateInsertDelete");function translateUpdateTriplesBlock(thingy,graph){let currentGraph=graph;thingy.type==="graph"&&(currentGraph=thingy.name);let currentTriples=thingy.triples;return currentGraph&&(currentTriples=currentTriples.map(triple2=>Object.assign(triple2,{graph:currentGraph}))),currentTriples.map(translateQuad)}__name(translateUpdateTriplesBlock,"translateUpdateTriplesBlock");function translateUpdateGraph(thingy){let source;switch(util_1$1.default.isSimpleTerm(thingy.graph)?source=thingy.graph:thingy.graph.all?source="ALL":thingy.graph.default?source="DEFAULT":thingy.graph.named?source="NAMED":source=thingy.graph.name,thingy.type){case"clear":return factory$1.createClear(source,thingy.silent);case"create":return factory$1.createCreate(source,thingy.silent);case"drop":return factory$1.createDrop(source,thingy.silent)}}__name(translateUpdateGraph,"translateUpdateGraph");function translateUpdateGraphLoad(thingy){return factory$1.createLoad(thingy.source,thingy.destination,thingy.silent)}__name(translateUpdateGraphLoad,"translateUpdateGraphLoad");function translateUpdateGraphShortcut$1(thingy){const source=thingy.source.default?"DEFAULT":thingy.source.name,destination=thingy.destination.default?"DEFAULT":thingy.destination.name;switch(thingy.type){case"copy":return factory$1.createCopy(source,destination,thingy.silent);case"move":return factory$1.createMove(source,destination,thingy.silent);case"add":return factory$1.createAdd(source,destination,thingy.silent)}}__name(translateUpdateGraphShortcut$1,"translateUpdateGraphShortcut$1");function translateBlankNodesToVariables(res){const blankToVariableMapping={},variablesRaw=Array.from(variables).reduce((acc,variable)=>(acc[variable]=!0,acc),{});return util_1$1.default.mapOperation(res,{[Algebra$1.types.DELETE_INSERT]:op=>({result:op,recurse:!1}),[Algebra$1.types.PATH]:(op,factory2)=>({result:factory2.createPath(blankToVariable(op.subject),op.predicate,blankToVariable(op.object),blankToVariable(op.graph)),recurse:!1}),[Algebra$1.types.PATTERN]:(op,factory2)=>({result:factory2.createPattern(blankToVariable(op.subject),blankToVariable(op.predicate),blankToVariable(op.object),blankToVariable(op.graph)),recurse:!1}),[Algebra$1.types.CONSTRUCT]:op=>({result:factory$1.createConstruct(translateBlankNodesToVariables(op.input),op.template),recurse:!1})});function blankToVariable(term){if(term.termType==="BlankNode"){let variable=blankToVariableMapping[term.value];return variable||(variable=util_1$1.default.createUniqueVariable(term.value,variablesRaw,factory$1.dataFactory),variablesRaw[variable.value]=!0,blankToVariableMapping[term.value]=variable),variable}return term}}__name(translateBlankNodesToVariables,"translateBlankNodesToVariables");var sparql={},rdfIsomorphic={},RdfIsomorphic={},hash={},utils$c={},minimalisticAssert=assert$5;function assert$5(val,msg){if(!val)throw new Error(msg||"Assertion failed")}__name(assert$5,"assert$5");assert$5.equal=__name(function(l,r2,msg){if(l!=r2)throw new Error(msg||"Assertion failed: "+l+" != "+r2)},"assertEqual");var assert$4=minimalisticAssert,inherits=inherits_browserExports;utils$c.inherits=inherits;function isSurrogatePair(msg,i){return(msg.charCodeAt(i)&64512)!==55296||i<0||i+1>=msg.length?!1:(msg.charCodeAt(i+1)&64512)===56320}__name(isSurrogatePair,"isSurrogatePair");function toArray2(msg,enc){if(Array.isArray(msg))return msg.slice();if(!msg)return[];var res=[];if(typeof msg=="string")if(enc){if(enc==="hex")for(msg=msg.replace(/[^a-z0-9]+/ig,""),msg.length%2!==0&&(msg="0"+msg),i=0;i<msg.length;i+=2)res.push(parseInt(msg[i]+msg[i+1],16))}else for(var p=0,i=0;i<msg.length;i++){var c=msg.charCodeAt(i);c<128?res[p++]=c:c<2048?(res[p++]=c>>6|192,res[p++]=c&63|128):isSurrogatePair(msg,i)?(c=65536+((c&1023)<<10)+(msg.charCodeAt(++i)&1023),res[p++]=c>>18|240,res[p++]=c>>12&63|128,res[p++]=c>>6&63|128,res[p++]=c&63|128):(res[p++]=c>>12|224,res[p++]=c>>6&63|128,res[p++]=c&63|128)}else for(i=0;i<msg.length;i++)res[i]=msg[i]|0;return res}__name(toArray2,"toArray");utils$c.toArray=toArray2;function toHex(msg){for(var res="",i=0;i<msg.length;i++)res+=zero2(msg[i].toString(16));return res}__name(toHex,"toHex");utils$c.toHex=toHex;function htonl(w){var res=w>>>24|w>>>8&65280|w<<8&16711680|(w&255)<<24;return res>>>0}__name(htonl,"htonl");utils$c.htonl=htonl;function toHex32(msg,endian){for(var res="",i=0;i<msg.length;i++){var w=msg[i];endian==="little"&&(w=htonl(w)),res+=zero8(w.toString(16))}return res}__name(toHex32,"toHex32");utils$c.toHex32=toHex32;function zero2(word){return word.length===1?"0"+word:word}__name(zero2,"zero2");utils$c.zero2=zero2;function zero8(word){return word.length===7?"0"+word:word.length===6?"00"+word:word.length===5?"000"+word:word.length===4?"0000"+word:word.length===3?"00000"+word:word.length===2?"000000"+word:word.length===1?"0000000"+word:word}__name(zero8,"zero8");utils$c.zero8=zero8;function join32(msg,start,end,endian){var len=end-start;assert$4(len%4===0);for(var res=new Array(len/4),i=0,k=start;i<res.length;i++,k+=4){var w;endian==="big"?w=msg[k]<<24|msg[k+1]<<16|msg[k+2]<<8|msg[k+3]:w=msg[k+3]<<24|msg[k+2]<<16|msg[k+1]<<8|msg[k],res[i]=w>>>0}return res}__name(join32,"join32");utils$c.join32=join32;function split32(msg,endian){for(var res=new Array(msg.length*4),i=0,k=0;i<msg.length;i++,k+=4){var m=msg[i];endian==="big"?(res[k]=m>>>24,res[k+1]=m>>>16&255,res[k+2]=m>>>8&255,res[k+3]=m&255):(res[k+3]=m>>>24,res[k+2]=m>>>16&255,res[k+1]=m>>>8&255,res[k]=m&255)}return res}__name(split32,"split32");utils$c.split32=split32;function rotr32$1(w,b){return w>>>b|w<<32-b}__name(rotr32$1,"rotr32$1");utils$c.rotr32=rotr32$1;function rotl32$2(w,b){return w<<b|w>>>32-b}__name(rotl32$2,"rotl32$2");utils$c.rotl32=rotl32$2;function sum32$3(a,b){return a+b>>>0}__name(sum32$3,"sum32$3");utils$c.sum32=sum32$3;function sum32_3$1(a,b,c){return a+b+c>>>0}__name(sum32_3$1,"sum32_3$1");utils$c.sum32_3=sum32_3$1;function sum32_4$2(a,b,c,d){return a+b+c+d>>>0}__name(sum32_4$2,"sum32_4$2");utils$c.sum32_4=sum32_4$2;function sum32_5$2(a,b,c,d,e){return a+b+c+d+e>>>0}__name(sum32_5$2,"sum32_5$2");utils$c.sum32_5=sum32_5$2;function sum64$1(buf,pos,ah,al){var bh=buf[pos],bl=buf[pos+1],lo=al+bl>>>0,hi=(lo<al?1:0)+ah+bh;buf[pos]=hi>>>0,buf[pos+1]=lo}__name(sum64$1,"sum64$1");utils$c.sum64=sum64$1;function sum64_hi$1(ah,al,bh,bl){var lo=al+bl>>>0,hi=(lo<al?1:0)+ah+bh;return hi>>>0}__name(sum64_hi$1,"sum64_hi$1");utils$c.sum64_hi=sum64_hi$1;function sum64_lo$1(ah,al,bh,bl){var lo=al+bl;return lo>>>0}__name(sum64_lo$1,"sum64_lo$1");utils$c.sum64_lo=sum64_lo$1;function sum64_4_hi$1(ah,al,bh,bl,ch,cl,dh,dl){var carry=0,lo=al;lo=lo+bl>>>0,carry+=lo<al?1:0,lo=lo+cl>>>0,carry+=lo<cl?1:0,lo=lo+dl>>>0,carry+=lo<dl?1:0;var hi=ah+bh+ch+dh+carry;return hi>>>0}__name(sum64_4_hi$1,"sum64_4_hi$1");utils$c.sum64_4_hi=sum64_4_hi$1;function sum64_4_lo$1(ah,al,bh,bl,ch,cl,dh,dl){var lo=al+bl+cl+dl;return lo>>>0}__name(sum64_4_lo$1,"sum64_4_lo$1");utils$c.sum64_4_lo=sum64_4_lo$1;function sum64_5_hi$1(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var carry=0,lo=al;lo=lo+bl>>>0,carry+=lo<al?1:0,lo=lo+cl>>>0,carry+=lo<cl?1:0,lo=lo+dl>>>0,carry+=lo<dl?1:0,lo=lo+el>>>0,carry+=lo<el?1:0;var hi=ah+bh+ch+dh+eh+carry;return hi>>>0}__name(sum64_5_hi$1,"sum64_5_hi$1");utils$c.sum64_5_hi=sum64_5_hi$1;function sum64_5_lo$1(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var lo=al+bl+cl+dl+el;return lo>>>0}__name(sum64_5_lo$1,"sum64_5_lo$1");utils$c.sum64_5_lo=sum64_5_lo$1;function rotr64_hi$1(ah,al,num){var r2=al<<32-num|ah>>>num;return r2>>>0}__name(rotr64_hi$1,"rotr64_hi$1");utils$c.rotr64_hi=rotr64_hi$1;function rotr64_lo$1(ah,al,num){var r2=ah<<32-num|al>>>num;return r2>>>0}__name(rotr64_lo$1,"rotr64_lo$1");utils$c.rotr64_lo=rotr64_lo$1;function shr64_hi$1(ah,al,num){return ah>>>num}__name(shr64_hi$1,"shr64_hi$1");utils$c.shr64_hi=shr64_hi$1;function shr64_lo$1(ah,al,num){var r2=ah<<32-num|al>>>num;return r2>>>0}__name(shr64_lo$1,"shr64_lo$1");utils$c.shr64_lo=shr64_lo$1;var common$5={},utils$b=utils$c,assert$3=minimalisticAssert;function BlockHash$4(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}__name(BlockHash$4,"BlockHash$4");common$5.BlockHash=BlockHash$4;BlockHash$4.prototype.update=__name(function(msg,enc){if(msg=utils$b.toArray(msg,enc),this.pending?this.pending=this.pending.concat(msg):this.pending=msg,this.pendingTotal+=msg.length,this.pending.length>=this._delta8){msg=this.pending;var r2=msg.length%this._delta8;this.pending=msg.slice(msg.length-r2,msg.length),this.pending.length===0&&(this.pending=null),msg=utils$b.join32(msg,0,msg.length-r2,this.endian);for(var i=0;i<msg.length;i+=this._delta32)this._update(msg,i,i+this._delta32)}return this},"update");BlockHash$4.prototype.digest=__name(function(enc){return this.update(this._pad()),assert$3(this.pending===null),this._digest(enc)},"digest");BlockHash$4.prototype._pad=__name(function(){var len=this.pendingTotal,bytes=this._delta8,k=bytes-(len+this.padLength)%bytes,res=new Array(k+this.padLength);res[0]=128;for(var i=1;i<k;i++)res[i]=0;if(len<<=3,this.endian==="big"){for(var t=8;t<this.padLength;t++)res[i++]=0;res[i++]=0,res[i++]=0,res[i++]=0,res[i++]=0,res[i++]=len>>>24&255,res[i++]=len>>>16&255,res[i++]=len>>>8&255,res[i++]=len&255}else for(res[i++]=len&255,res[i++]=len>>>8&255,res[i++]=len>>>16&255,res[i++]=len>>>24&255,res[i++]=0,res[i++]=0,res[i++]=0,res[i++]=0,t=8;t<this.padLength;t++)res[i++]=0;return res},"pad");var sha={},common$4={},utils$a=utils$c,rotr32=utils$a.rotr32;function ft_1$1(s2,x,y,z){if(s2===0)return ch32$1(x,y,z);if(s2===1||s2===3)return p32(x,y,z);if(s2===2)return maj32$1(x,y,z)}__name(ft_1$1,"ft_1$1");common$4.ft_1=ft_1$1;function ch32$1(x,y,z){return x&y^~x&z}__name(ch32$1,"ch32$1");common$4.ch32=ch32$1;function maj32$1(x,y,z){return x&y^x&z^y&z}__name(maj32$1,"maj32$1");common$4.maj32=maj32$1;function p32(x,y,z){return x^y^z}__name(p32,"p32");common$4.p32=p32;function s0_256$1(x){return rotr32(x,2)^rotr32(x,13)^rotr32(x,22)}__name(s0_256$1,"s0_256$1");common$4.s0_256=s0_256$1;function s1_256$1(x){return rotr32(x,6)^rotr32(x,11)^rotr32(x,25)}__name(s1_256$1,"s1_256$1");common$4.s1_256=s1_256$1;function g0_256$1(x){return rotr32(x,7)^rotr32(x,18)^x>>>3}__name(g0_256$1,"g0_256$1");common$4.g0_256=g0_256$1;function g1_256$1(x){return rotr32(x,17)^rotr32(x,19)^x>>>10}__name(g1_256$1,"g1_256$1");common$4.g1_256=g1_256$1;var utils$9=utils$c,common$3=common$5,shaCommon$1=common$4,rotl32$1=utils$9.rotl32,sum32$2=utils$9.sum32,sum32_5$1=utils$9.sum32_5,ft_1=shaCommon$1.ft_1,BlockHash$3=common$3.BlockHash,sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA1$1(){if(!(this instanceof SHA1$1))return new SHA1$1;BlockHash$3.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}__name(SHA1$1,"SHA1$1");utils$9.inherits(SHA1$1,BlockHash$3);var _1=SHA1$1;SHA1$1.blockSize=512;SHA1$1.outSize=160;SHA1$1.hmacStrength=80;SHA1$1.padLength=64;SHA1$1.prototype._update=__name(function(msg,start){for(var W=this.W,i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=rotl32$1(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);var a=this.h[0],b=this.h[1],c=this.h[2],d=this.h[3],e=this.h[4];for(i=0;i<W.length;i++){var s2=~~(i/20),t=sum32_5$1(rotl32$1(a,5),ft_1(s2,b,c,d),e,W[i],sha1_K[s2]);e=d,d=c,c=rotl32$1(b,30),b=a,a=t}this.h[0]=sum32$2(this.h[0],a),this.h[1]=sum32$2(this.h[1],b),this.h[2]=sum32$2(this.h[2],c),this.h[3]=sum32$2(this.h[3],d),this.h[4]=sum32$2(this.h[4],e)},"_update");SHA1$1.prototype._digest=__name(function(enc){return enc==="hex"?utils$9.toHex32(this.h,"big"):utils$9.split32(this.h,"big")},"digest");var utils$8=utils$c,common$2=common$5,shaCommon=common$4,assert$2=minimalisticAssert,sum32$1=utils$8.sum32,sum32_4$1=utils$8.sum32_4,sum32_5=utils$8.sum32_5,ch32=shaCommon.ch32,maj32=shaCommon.maj32,s0_256=shaCommon.s0_256,s1_256=shaCommon.s1_256,g0_256=shaCommon.g0_256,g1_256=shaCommon.g1_256,BlockHash$2=common$2.BlockHash,sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function SHA256$2(){if(!(this instanceof SHA256$2))return new SHA256$2;BlockHash$2.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=sha256_K,this.W=new Array(64)}__name(SHA256$2,"SHA256$2");utils$8.inherits(SHA256$2,BlockHash$2);var _256=SHA256$2;SHA256$2.blockSize=512;SHA256$2.outSize=256;SHA256$2.hmacStrength=192;SHA256$2.padLength=64;SHA256$2.prototype._update=__name(function(msg,start){for(var W=this.W,i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=sum32_4$1(g1_256(W[i-2]),W[i-7],g0_256(W[i-15]),W[i-16]);var a=this.h[0],b=this.h[1],c=this.h[2],d=this.h[3],e=this.h[4],f2=this.h[5],g=this.h[6],h=this.h[7];for(assert$2(this.k.length===W.length),i=0;i<W.length;i++){var T1=sum32_5(h,s1_256(e),ch32(e,f2,g),this.k[i],W[i]),T2=sum32$1(s0_256(a),maj32(a,b,c));h=g,g=f2,f2=e,e=sum32$1(d,T1),d=c,c=b,b=a,a=sum32$1(T1,T2)}this.h[0]=sum32$1(this.h[0],a),this.h[1]=sum32$1(this.h[1],b),this.h[2]=sum32$1(this.h[2],c),this.h[3]=sum32$1(this.h[3],d),this.h[4]=sum32$1(this.h[4],e),this.h[5]=sum32$1(this.h[5],f2),this.h[6]=sum32$1(this.h[6],g),this.h[7]=sum32$1(this.h[7],h)},"_update");SHA256$2.prototype._digest=__name(function(enc){return enc==="hex"?utils$8.toHex32(this.h,"big"):utils$8.split32(this.h,"big")},"digest");var utils$7=utils$c,SHA256$1=_256;function SHA224(){if(!(this instanceof SHA224))return new SHA224;SHA256$1.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}__name(SHA224,"SHA224");utils$7.inherits(SHA224,SHA256$1);var _224=SHA224;SHA224.blockSize=512;SHA224.outSize=224;SHA224.hmacStrength=192;SHA224.padLength=64;SHA224.prototype._digest=__name(function(enc){return enc==="hex"?utils$7.toHex32(this.h.slice(0,7),"big"):utils$7.split32(this.h.slice(0,7),"big")},"digest");var utils$6=utils$c,common$1=common$5,assert$1=minimalisticAssert,rotr64_hi=utils$6.rotr64_hi,rotr64_lo=utils$6.rotr64_lo,shr64_hi=utils$6.shr64_hi,shr64_lo=utils$6.shr64_lo,sum64=utils$6.sum64,sum64_hi=utils$6.sum64_hi,sum64_lo=utils$6.sum64_lo,sum64_4_hi=utils$6.sum64_4_hi,sum64_4_lo=utils$6.sum64_4_lo,sum64_5_hi=utils$6.sum64_5_hi,sum64_5_lo=utils$6.sum64_5_lo,BlockHash$1=common$1.BlockHash,sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function SHA512$2(){if(!(this instanceof SHA512$2))return new SHA512$2;BlockHash$1.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=sha512_K,this.W=new Array(160)}__name(SHA512$2,"SHA512$2");utils$6.inherits(SHA512$2,BlockHash$1);var _512=SHA512$2;SHA512$2.blockSize=1024;SHA512$2.outSize=512;SHA512$2.hmacStrength=192;SHA512$2.padLength=128;SHA512$2.prototype._prepareBlock=__name(function(msg,start){for(var W=this.W,i=0;i<32;i++)W[i]=msg[start+i];for(;i<W.length;i+=2){var c0_hi=g1_512_hi(W[i-4],W[i-3]),c0_lo=g1_512_lo(W[i-4],W[i-3]),c1_hi=W[i-14],c1_lo=W[i-13],c2_hi=g0_512_hi(W[i-30],W[i-29]),c2_lo=g0_512_lo(W[i-30],W[i-29]),c3_hi=W[i-32],c3_lo=W[i-31];W[i]=sum64_4_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo),W[i+1]=sum64_4_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo)}},"_prepareBlock");SHA512$2.prototype._update=__name(function(msg,start){this._prepareBlock(msg,start);var W=this.W,ah=this.h[0],al=this.h[1],bh=this.h[2],bl=this.h[3],ch=this.h[4],cl=this.h[5],dh=this.h[6],dl=this.h[7],eh=this.h[8],el=this.h[9],fh=this.h[10],fl=this.h[11],gh=this.h[12],gl=this.h[13],hh=this.h[14],hl=this.h[15];assert$1(this.k.length===W.length);for(var i=0;i<W.length;i+=2){var c0_hi=hh,c0_lo=hl,c1_hi=s1_512_hi(eh,el),c1_lo=s1_512_lo(eh,el),c2_hi=ch64_hi(eh,el,fh,fl,gh),c2_lo=ch64_lo(eh,el,fh,fl,gh,gl),c3_hi=this.k[i],c3_lo=this.k[i+1],c4_hi=W[i],c4_lo=W[i+1],T1_hi=sum64_5_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo),T1_lo=sum64_5_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);c0_hi=s0_512_hi(ah,al),c0_lo=s0_512_lo(ah,al),c1_hi=maj64_hi(ah,al,bh,bl,ch),c1_lo=maj64_lo(ah,al,bh,bl,ch,cl);var T2_hi=sum64_hi(c0_hi,c0_lo,c1_hi,c1_lo),T2_lo=sum64_lo(c0_hi,c0_lo,c1_hi,c1_lo);hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,eh=sum64_hi(dh,dl,T1_hi,T1_lo),el=sum64_lo(dl,dl,T1_hi,T1_lo),dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,ah=sum64_hi(T1_hi,T1_lo,T2_hi,T2_lo),al=sum64_lo(T1_hi,T1_lo,T2_hi,T2_lo)}sum64(this.h,0,ah,al),sum64(this.h,2,bh,bl),sum64(this.h,4,ch,cl),sum64(this.h,6,dh,dl),sum64(this.h,8,eh,el),sum64(this.h,10,fh,fl),sum64(this.h,12,gh,gl),sum64(this.h,14,hh,hl)},"_update");SHA512$2.prototype._digest=__name(function(enc){return enc==="hex"?utils$6.toHex32(this.h,"big"):utils$6.split32(this.h,"big")},"digest");function ch64_hi(xh,xl,yh,yl,zh){var r2=xh&yh^~xh&zh;return r2<0&&(r2+=4294967296),r2}__name(ch64_hi,"ch64_hi");function ch64_lo(xh,xl,yh,yl,zh,zl){var r2=xl&yl^~xl&zl;return r2<0&&(r2+=4294967296),r2}__name(ch64_lo,"ch64_lo");function maj64_hi(xh,xl,yh,yl,zh){var r2=xh&yh^xh&zh^yh&zh;return r2<0&&(r2+=4294967296),r2}__name(maj64_hi,"maj64_hi");function maj64_lo(xh,xl,yh,yl,zh,zl){var r2=xl&yl^xl&zl^yl&zl;return r2<0&&(r2+=4294967296),r2}__name(maj64_lo,"maj64_lo");function s0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,28),c1_hi=rotr64_hi(xl,xh,2),c2_hi=rotr64_hi(xl,xh,7),r2=c0_hi^c1_hi^c2_hi;return r2<0&&(r2+=4294967296),r2}__name(s0_512_hi,"s0_512_hi");function s0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,28),c1_lo=rotr64_lo(xl,xh,2),c2_lo=rotr64_lo(xl,xh,7),r2=c0_lo^c1_lo^c2_lo;return r2<0&&(r2+=4294967296),r2}__name(s0_512_lo,"s0_512_lo");function s1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,14),c1_hi=rotr64_hi(xh,xl,18),c2_hi=rotr64_hi(xl,xh,9),r2=c0_hi^c1_hi^c2_hi;return r2<0&&(r2+=4294967296),r2}__name(s1_512_hi,"s1_512_hi");function s1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,14),c1_lo=rotr64_lo(xh,xl,18),c2_lo=rotr64_lo(xl,xh,9),r2=c0_lo^c1_lo^c2_lo;return r2<0&&(r2+=4294967296),r2}__name(s1_512_lo,"s1_512_lo");function g0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,1),c1_hi=rotr64_hi(xh,xl,8),c2_hi=shr64_hi(xh,xl,7),r2=c0_hi^c1_hi^c2_hi;return r2<0&&(r2+=4294967296),r2}__name(g0_512_hi,"g0_512_hi");function g0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,1),c1_lo=rotr64_lo(xh,xl,8),c2_lo=shr64_lo(xh,xl,7),r2=c0_lo^c1_lo^c2_lo;return r2<0&&(r2+=4294967296),r2}__name(g0_512_lo,"g0_512_lo");function g1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,19),c1_hi=rotr64_hi(xl,xh,29),c2_hi=shr64_hi(xh,xl,6),r2=c0_hi^c1_hi^c2_hi;return r2<0&&(r2+=4294967296),r2}__name(g1_512_hi,"g1_512_hi");function g1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,19),c1_lo=rotr64_lo(xl,xh,29),c2_lo=shr64_lo(xh,xl,6),r2=c0_lo^c1_lo^c2_lo;return r2<0&&(r2+=4294967296),r2}__name(g1_512_lo,"g1_512_lo");var utils$5=utils$c,SHA512$1=_512;function SHA384$1(){if(!(this instanceof SHA384$1))return new SHA384$1;SHA512$1.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}__name(SHA384$1,"SHA384$1");utils$5.inherits(SHA384$1,SHA512$1);var _384=SHA384$1;SHA384$1.blockSize=1024;SHA384$1.outSize=384;SHA384$1.hmacStrength=192;SHA384$1.padLength=128;SHA384$1.prototype._digest=__name(function(enc){return enc==="hex"?utils$5.toHex32(this.h.slice(0,12),"big"):utils$5.split32(this.h.slice(0,12),"big")},"digest");sha.sha1=_1;sha.sha224=_224;sha.sha256=_256;sha.sha384=_384;sha.sha512=_512;var ripemd={},utils$4=utils$c,common=common$5,rotl32=utils$4.rotl32,sum32=utils$4.sum32,sum32_3=utils$4.sum32_3,sum32_4=utils$4.sum32_4,BlockHash=common.BlockHash;function RIPEMD160(){if(!(this instanceof RIPEMD160))return new RIPEMD160;BlockHash.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}__name(RIPEMD160,"RIPEMD160");utils$4.inherits(RIPEMD160,BlockHash);ripemd.ripemd160=RIPEMD160;RIPEMD160.blockSize=512;RIPEMD160.outSize=160;RIPEMD160.hmacStrength=192;RIPEMD160.padLength=64;RIPEMD160.prototype._update=__name(function(msg,start){for(var A2=this.h[0],B=this.h[1],C2=this.h[2],D=this.h[3],E2=this.h[4],Ah=A2,Bh=B,Ch=C2,Dh=D,Eh=E2,j=0;j<80;j++){var T=sum32(rotl32(sum32_4(A2,f$1(j,B,C2,D),msg[r[j]+start],K(j)),s[j]),E2);A2=E2,E2=D,D=rotl32(C2,10),C2=B,B=T,T=sum32(rotl32(sum32_4(Ah,f$1(79-j,Bh,Ch,Dh),msg[rh[j]+start],Kh(j)),sh[j]),Eh),Ah=Eh,Eh=Dh,Dh=rotl32(Ch,10),Ch=Bh,Bh=T}T=sum32_3(this.h[1],C2,Dh),this.h[1]=sum32_3(this.h[2],D,Eh),this.h[2]=sum32_3(this.h[3],E2,Ah),this.h[3]=sum32_3(this.h[4],A2,Bh),this.h[4]=sum32_3(this.h[0],B,Ch),this.h[0]=T},"update");RIPEMD160.prototype._digest=__name(function(enc){return enc==="hex"?utils$4.toHex32(this.h,"little"):utils$4.split32(this.h,"little")},"digest");function f$1(j,x,y,z){return j<=15?x^y^z:j<=31?x&y|~x&z:j<=47?(x|~y)^z:j<=63?x&z|y&~z:x^(y|~z)}__name(f$1,"f$1");function K(j){return j<=15?0:j<=31?1518500249:j<=47?1859775393:j<=63?2400959708:2840853838}__name(K,"K");function Kh(j){return j<=15?1352829926:j<=31?1548603684:j<=47?1836072691:j<=63?2053994217:0}__name(Kh,"Kh");var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],utils$3=utils$c,assert=minimalisticAssert;function Hmac(hash2,key,enc){if(!(this instanceof Hmac))return new Hmac(hash2,key,enc);this.Hash=hash2,this.blockSize=hash2.blockSize/8,this.outSize=hash2.outSize/8,this.inner=null,this.outer=null,this._init(utils$3.toArray(key,enc))}__name(Hmac,"Hmac");var hmac=Hmac;Hmac.prototype._init=__name(function(key){key.length>this.blockSize&&(key=new this.Hash().update(key).digest()),assert(key.length<=this.blockSize);for(var i=key.length;i<this.blockSize;i++)key.push(0);for(i=0;i<key.length;i++)key[i]^=54;for(this.inner=new this.Hash().update(key),i=0;i<key.length;i++)key[i]^=106;this.outer=new this.Hash().update(key)},"init");Hmac.prototype.update=__name(function(msg,enc){return this.inner.update(msg,enc),this},"update");Hmac.prototype.digest=__name(function(enc){return this.outer.update(this.inner.digest()),this.outer.digest(enc)},"digest");(function(exports){var hash2=exports;hash2.utils=utils$c,hash2.common=common$5,hash2.sha=sha,hash2.ripemd=ripemd,hash2.hmac=hmac,hash2.sha1=hash2.sha.sha1,hash2.sha256=hash2.sha.sha256,hash2.sha224=hash2.sha.sha224,hash2.sha384=hash2.sha.sha384,hash2.sha512=hash2.sha.sha512,hash2.ripemd160=hash2.ripemd.ripemd160})(hash);Object.defineProperty(RdfIsomorphic,"__esModule",{value:!0});RdfIsomorphic.isTermGrounded=RdfIsomorphic.termToSignature=RdfIsomorphic.quadToSignature=RdfIsomorphic.sha1hex=RdfIsomorphic.hashTerm=RdfIsomorphic.hashTerms=RdfIsomorphic.getGraphBlankNodes=RdfIsomorphic.uniqGraph=RdfIsomorphic.deindexGraph=RdfIsomorphic.indexGraph=RdfIsomorphic.getQuadsWithoutBlankNodes=RdfIsomorphic.getQuadsWithBlankNodes=RdfIsomorphic.hasValue=RdfIsomorphic.hashValues=RdfIsomorphic.getBijectionInner=RdfIsomorphic.getBijection=RdfIsomorphic.isomorphic=void 0;const hash_js_1$2=hash,rdf_string_1$j=rdfString,rdf_terms_1$d=rdfTerms;function isomorphic(graphA,graphB){return!!getBijection(graphA,graphB)}__name(isomorphic,"isomorphic");RdfIsomorphic.isomorphic=isomorphic;function getBijection(graphA,graphB){const nonBlankIndexA=indexGraph(getQuadsWithoutBlankNodes(graphA)),nonBlankIndexB=indexGraph(getQuadsWithoutBlankNodes(graphB));if(Object.keys(nonBlankIndexA).length!==Object.keys(nonBlankIndexB).length)return null;for(const key in nonBlankIndexA)if(nonBlankIndexA[key]!==nonBlankIndexB[key])return null;const blankQuadsA=uniqGraph(getQuadsWithBlankNodes(graphA)),blankQuadsB=uniqGraph(getQuadsWithBlankNodes(graphB)),blankNodesA=getGraphBlankNodes(graphA),blankNodesB=getGraphBlankNodes(graphB);return getBijectionInner(blankQuadsA,blankQuadsB,blankNodesA,blankNodesB)}__name(getBijection,"getBijection");RdfIsomorphic.getBijection=getBijection;function getBijectionInner(blankQuadsA,blankQuadsB,blankNodesA,blankNodesB,groundedHashesA,groundedHashesB){groundedHashesA||(groundedHashesA={}),groundedHashesB||(groundedHashesB={});const[hashesA,ungroundedHashesA]=hashTerms(blankQuadsA,blankNodesA,groundedHashesA),[hashesB,ungroundedHashesB]=hashTerms(blankQuadsB,blankNodesB,groundedHashesB);if(Object.keys(hashesA).length!==Object.keys(hashesB).length)return null;for(const hashKeyA in hashesA)if(!hasValue(hashesB,hashesA[hashKeyA]))return null;let bijection={};for(const blankNodeA of blankNodesA){const blankNodeAString=rdf_string_1$j.termToString(blankNodeA),blankNodeAHash=ungroundedHashesA[blankNodeAString];for(const blankNodeBString in ungroundedHashesB)if(ungroundedHashesB[blankNodeBString]===blankNodeAHash){bijection[blankNodeAString]=blankNodeBString,delete ungroundedHashesB[blankNodeBString];break}}if(!arraysEqual(Object.keys(bijection).sort(),blankNodesA.map(rdf_string_1$j.termToString).sort())||!arraysEqual(hashValues(bijection).sort(),blankNodesB.map(rdf_string_1$j.termToString).sort())){bijection=null;for(const blankNodeA of blankNodesA){const blankNodeAString=rdf_string_1$j.termToString(blankNodeA);if(!hashesA[blankNodeAString])for(const blankNodeB of blankNodesB){const blankNodeBString=rdf_string_1$j.termToString(blankNodeB);if(!hashesB[blankNodeBString]&&ungroundedHashesA[blankNodeAString]===ungroundedHashesB[blankNodeBString]){const hash2=sha1hex(blankNodeAString);bijection=getBijectionInner(blankQuadsA,blankQuadsB,blankNodesA,blankNodesB,Object.assign(Object.assign({},hashesA),{[blankNodeAString]:hash2}),Object.assign(Object.assign({},hashesB),{[blankNodeBString]:hash2}))}}}}return bijection}__name(getBijectionInner,"getBijectionInner");RdfIsomorphic.getBijectionInner=getBijectionInner;function arraysEqual(array1,array2){if(array1.length!==array2.length)return!1;for(let i=array1.length;i--;)if(array1[i]!==array2[i])return!1;return!0}__name(arraysEqual,"arraysEqual");function hashValues(hash2){const arr=[];for(const e in hash2)arr.push(hash2[e]);return arr}__name(hashValues,"hashValues");RdfIsomorphic.hashValues=hashValues;function hasValue(hash2,value){for(const hashValue in hash2)if(hash2[hashValue]===value)return!0;return!1}__name(hasValue,"hasValue");RdfIsomorphic.hasValue=hasValue;function getQuadsWithBlankNodes(graph){return graph.filter(quad=>rdf_terms_1$d.someTerms(quad,value=>value.termType==="BlankNode"||value.termType==="Quad"&&rdf_terms_1$d.getTermsNested(value).some(term=>term.termType==="BlankNode")))}__name(getQuadsWithBlankNodes,"getQuadsWithBlankNodes");RdfIsomorphic.getQuadsWithBlankNodes=getQuadsWithBlankNodes;function getQuadsWithoutBlankNodes(graph){return graph.filter(quad=>rdf_terms_1$d.everyTerms(quad,value=>value.termType!=="BlankNode"&&!(value.termType==="Quad"&&rdf_terms_1$d.getTermsNested(value).some(term=>term.termType==="BlankNode"))))}__name(getQuadsWithoutBlankNodes,"getQuadsWithoutBlankNodes");RdfIsomorphic.getQuadsWithoutBlankNodes=getQuadsWithoutBlankNodes;function indexGraph(graph){const index={};for(const quad of graph)index[JSON.stringify(rdf_string_1$j.quadToStringQuad(quad))]=!0;return index}__name(indexGraph,"indexGraph");RdfIsomorphic.indexGraph=indexGraph;function deindexGraph(indexedGraph){return Object.keys(indexedGraph).map(str=>rdf_string_1$j.stringQuadToQuad(JSON.parse(str)))}__name(deindexGraph,"deindexGraph");RdfIsomorphic.deindexGraph=deindexGraph;function uniqGraph(graph){return deindexGraph(indexGraph(graph))}__name(uniqGraph,"uniqGraph");RdfIsomorphic.uniqGraph=uniqGraph;function getGraphBlankNodes(graph){return rdf_terms_1$d.uniqTerms(graph.map(quad=>rdf_terms_1$d.getBlankNodes(rdf_terms_1$d.getTermsNested(quad))).reduce((acc,val)=>acc.concat(val),[]))}__name(getGraphBlankNodes,"getGraphBlankNodes");RdfIsomorphic.getGraphBlankNodes=getGraphBlankNodes;function hashTerms(quads,terms,groundedHashes){const hashes=Object.assign({},groundedHashes),ungroundedHashes={};let hashNeeded=!0;for(;hashNeeded;){const initialGroundedNodesCount=Object.keys(hashes).length;for(const term of terms){const termString=rdf_string_1$j.termToString(term);if(!hashes[termString]){const[grounded,hash2]=hashTerm(term,quads,hashes);grounded&&(hashes[termString]=hash2),ungroundedHashes[termString]=hash2}}const uniques={};for(const termKey in ungroundedHashes){const hash2=ungroundedHashes[termKey];uniques[hash2]===void 0?uniques[hash2]=termKey:uniques[hash2]=!1}for(const hash2 in uniques){const value=uniques[hash2];value&&(hashes[value]=hash2)}hashNeeded=initialGroundedNodesCount!==Object.keys(hashes).length}return[hashes,ungroundedHashes]}__name(hashTerms,"hashTerms");RdfIsomorphic.hashTerms=hashTerms;function hashTerm(term,quads,hashes){const quadSignatures=[];let grounded=!0;for(const quad of quads){const terms=rdf_terms_1$d.getTermsNested(quad);if(terms.some(quadTerm=>quadTerm.equals(term))){quadSignatures.push(quadToSignature(quad,hashes,term));for(const quadTerm of terms)!isTermGrounded(quadTerm,hashes)&&!quadTerm.equals(term)&&(grounded=!1)}}const hash2=sha1hex(quadSignatures.sort().join(""));return[grounded,hash2]}__name(hashTerm,"hashTerm");RdfIsomorphic.hashTerm=hashTerm;function sha1hex(data){return hash_js_1$2.sha1().update(data).digest("hex")}__name(sha1hex,"sha1hex");RdfIsomorphic.sha1hex=sha1hex;function quadToSignature(quad,hashes,term){return rdf_terms_1$d.getTerms(quad).map(quadTerm=>termToSignature(quadTerm,hashes,term)).join("|")}__name(quadToSignature,"quadToSignature");RdfIsomorphic.quadToSignature=quadToSignature;function termToSignature(term,hashes,target){return term.equals(target)?"@self":term.termType==="BlankNode"?hashes[rdf_string_1$j.termToString(term)]||"@blank":term.termType==="Quad"?`<${quadToSignature(term,hashes,target)}>`:rdf_string_1$j.termToString(term)}__name(termToSignature,"termToSignature");RdfIsomorphic.termToSignature=termToSignature;function isTermGrounded(term,hashes){return term.termType!=="BlankNode"&&!(term.termType==="Quad"&&rdf_terms_1$d.getTermsNested(term).some(subTerm=>!isTermGrounded(subTerm,hashes)))||!!hashes[rdf_string_1$j.termToString(term)]}__name(isTermGrounded,"isTermGrounded");RdfIsomorphic.isTermGrounded=isTermGrounded;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(RdfIsomorphic,exports)})(rdfIsomorphic);var __createBinding$4=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault$4=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar$4=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding$4(result,mod,k);return __setModuleDefault$4(result,mod),result},__importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(sparql,"__esModule",{value:!0});sparql.toSparqlJs=sparql.toSparql=void 0;const rdf_isomorphic_1=rdfIsomorphic,rdf_string_1$i=rdfString,sparqljs_1$4=sparql$1,Algebra=__importStar$4(algebra),factory_1=__importDefault$4(factory$2),util_1=__importDefault$4(util),types=Algebra.types,eTypes=Algebra.expressionTypes;let context;const factory=new factory_1.default;function toSparql(op,options={}){return new sparqljs_1$4.Generator(options).stringify(toSparqlJs(op))}__name(toSparql,"toSparql");sparql.toSparql=toSparql;function toSparqlJs(op){resetContext(),op=removeQuads(op);let result=translateOperation(op);return result.type==="group"?result.patterns[0]:result}__name(toSparqlJs,"toSparqlJs");sparql.toSparqlJs=toSparqlJs;function resetContext(){context={project:!1,extend:[],group:[],aggregates:[],order:[]}}__name(resetContext,"resetContext");function translateOperation(op){switch(op.type!==types.EXTEND&&op.type!==types.ORDER_BY&&op.type!==types.GRAPH&&(context.project=!1),op.type){case types.EXPRESSION:return translateExpression(op);case types.ASK:return translateProject(op,types.ASK);case types.BGP:return translateBgp(op);case types.CONSTRUCT:return translateConstruct(op);case types.DESCRIBE:return translateProject(op,types.DESCRIBE);case types.DISTINCT:return translateDistinct(op);case types.EXTEND:return translateExtend(op);case types.FROM:return translateFrom(op);case types.FILTER:return translateFilter(op);case types.GRAPH:return translateGraph(op);case types.GROUP:return translateGroup(op);case types.JOIN:return translateJoin(op);case types.LEFT_JOIN:return translateLeftJoin(op);case types.MINUS:return translateMinus(op);case types.NOP:return{};case types.ORDER_BY:return translateOrderBy(op);case types.PATH:return translatePath(op);case types.PATTERN:return translatePattern(op);case types.PROJECT:return translateProject(op,types.PROJECT);case types.REDUCED:return translateReduced(op);case types.SERVICE:return translateService(op);case types.SLICE:return translateSlice(op);case types.UNION:return translateUnion(op);case types.VALUES:return translateValues(op);case types.COMPOSITE_UPDATE:return translateCompositeUpdate(op);case types.DELETE_INSERT:return translateDeleteInsert(op);case types.LOAD:return translateLoad(op);case types.CLEAR:return translateClear(op);case types.CREATE:return translateCreate(op);case types.DROP:return translateDrop(op);case types.ADD:return translateAdd(op);case types.MOVE:return translateMove(op);case types.COPY:return translateCopy(op)}throw new Error(`Unknown Operation type ${op.type}`)}__name(translateOperation,"translateOperation");function translateExpression(expr){switch(expr.expressionType){case eTypes.AGGREGATE:return translateAggregateExpression(expr);case eTypes.EXISTENCE:return translateExistenceExpression(expr);case eTypes.NAMED:return translateNamedExpression(expr);case eTypes.OPERATOR:return translateOperatorExpression(expr);case eTypes.TERM:return translateTermExpression(expr);case eTypes.WILDCARD:return translateWildcardExpression(expr)}throw new Error(`Unknown Expression Operation type ${expr.expressionType}`)}__name(translateExpression,"translateExpression");function translatePathComponent(path){switch(path.type){case types.ALT:return translateAlt(path);case types.INV:return translateInv(path);case types.LINK:return translateLink(path);case types.NPS:return translateNps(path);case types.ONE_OR_MORE_PATH:return translateOneOrMorePath(path);case types.SEQ:return translateSeq(path);case types.ZERO_OR_MORE_PATH:return translateZeroOrMorePath(path);case types.ZERO_OR_ONE_PATH:return translateZeroOrOnePath(path)}throw new Error(`Unknown Path type ${path.type}`)}__name(translatePathComponent,"translatePathComponent");function translateTerm(term){return(0,rdf_string_1$i.termToString)(term)}__name(translateTerm,"translateTerm");function translateAggregateExpression(expr){const result={expression:translateExpression(expr.expression),type:"aggregate",aggregation:expr.aggregator,distinct:expr.distinct};return expr.separator&&(result.separator=expr.separator),result}__name(translateAggregateExpression,"translateAggregateExpression");function translateExistenceExpression(expr){return{type:"operation",operator:expr.not?"notexists":"exists",args:util_1.default.flatten([translateOperation(expr.input)])}}__name(translateExistenceExpression,"translateExistenceExpression");function translateNamedExpression(expr){return{type:"functionCall",function:expr.name,args:expr.args.map(translateExpression)}}__name(translateNamedExpression,"translateNamedExpression");function translateOperatorExpression(expr){if(expr.operator==="desc"){const result2={expression:translateExpression(expr.args[0])};return result2.descending=!0,result2}const result={type:"operation",operator:expr.operator,args:expr.args.map(translateExpression)};return(result.operator==="in"||result.operator==="notin")&&(result.args=[result.args[0]].concat([result.args.slice(1)])),result}__name(translateOperatorExpression,"translateOperatorExpression");function translateTermExpression(expr){return expr.term}__name(translateTermExpression,"translateTermExpression");function translateWildcardExpression(expr){return expr.wildcard}__name(translateWildcardExpression,"translateWildcardExpression");function translateBoundAggregate(op){return op}__name(translateBoundAggregate,"translateBoundAggregate");function translateBgp(op){let patterns=op.patterns.map(translatePattern);return patterns.length===0?null:{type:"bgp",triples:patterns}}__name(translateBgp,"translateBgp");function translateConstruct(op){return{type:"query",prefixes:{},queryType:"CONSTRUCT",template:op.template.map(translatePattern),where:util_1.default.flatten([translateOperation(op.input)])}}__name(translateConstruct,"translateConstruct");function translateDistinct(op){let result=translateOperation(op.input);return result.patterns[0].distinct=!0,result}__name(translateDistinct,"translateDistinct");function translateExtend(op){return context.project?(context.extend.push(op),translateOperation(op.input)):util_1.default.flatten([translateOperation(op.input),{type:"bind",variable:op.variable,expression:translateExpression(op.expression)}])}__name(translateExtend,"translateExtend");function translateFrom(op){const result=translateOperation(op.input),obj=result.patterns[0];return obj.from={default:op.default,named:op.named},result}__name(translateFrom,"translateFrom");function translateFilter(op){return{type:"group",patterns:util_1.default.flatten([translateOperation(op.input),{type:"filter",expression:translateExpression(op.expression)}])}}__name(translateFilter,"translateFilter");function translateGraph(op){return{type:"graph",patterns:util_1.default.flatten([translateOperation(op.input)]),name:op.name}}__name(translateGraph,"translateGraph");function translateGroup(op){const input=translateOperation(op.input),aggs=op.aggregates.map(translateBoundAggregate);return context.aggregates.push(...aggs),context.group.push(...op.variables),input}__name(translateGroup,"translateGroup");function translateJoin(op){return util_1.default.flatten(op.input.map(translateOperation)).reduce((result,val)=>(val.type!=="bgp"||result.length==0||result[result.length-1].type!=="bgp"?result.push(val):result[result.length-1].triples.push(...val.triples),result),[])}__name(translateJoin,"translateJoin");function translateLeftJoin(op){const leftjoin={type:"optional",patterns:[translateOperation(op.input[1])]};return op.expression&&leftjoin.patterns.push({type:"filter",expression:translateExpression(op.expression)}),leftjoin.patterns=util_1.default.flatten(leftjoin.patterns),util_1.default.flatten([translateOperation(op.input[0]),leftjoin])}__name(translateLeftJoin,"translateLeftJoin");function translateMinus(op){let patterns=translateOperation(op.input[1]);return patterns.type==="group"&&(patterns=patterns.patterns),Array.isArray(patterns)||(patterns=[patterns]),util_1.default.flatten([translateOperation(op.input[0]),{type:"minus",patterns}])}__name(translateMinus,"translateMinus");function translateOrderBy(op){return context.order.push(...op.expressions),translateOperation(op.input)}__name(translateOrderBy,"translateOrderBy");function translatePath(op){return{type:"bgp",triples:[{subject:op.subject,predicate:translatePathComponent(op.predicate),object:op.object}]}}__name(translatePath,"translatePath");function translatePattern(op){return{subject:op.subject,predicate:op.predicate,object:op.object}}__name(translatePattern,"translatePattern");function replaceAggregatorVariables(s2,map2){let st=util_1.default.isSimpleTerm(s2)?translateTerm(s2):s2;if(typeof st=="string"){if(map2[st])return map2[st]}else if(Array.isArray(s2))s2=s2.map(e=>replaceAggregatorVariables(e,map2));else for(let key of Object.keys(s2))s2[key]=replaceAggregatorVariables(s2[key],map2);return s2}__name(replaceAggregatorVariables,"replaceAggregatorVariables");function translateProject(op,type){const result={type:"query",prefixes:{}},select=result;let variables2;type===types.PROJECT?(result.queryType="SELECT",variables2=op.variables):type===types.ASK?result.queryType="ASK":type===types.DESCRIBE&&(result.queryType="DESCRIBE",variables2=op.terms);const extend=context.extend,group=context.group,aggregates=context.aggregates,order=context.order;resetContext(),context.project=!0;let input=util_1.default.flatten([translateOperation(op.input)]);input.length===1&&input[0].type==="group"&&(input=input[0].patterns),result.where=input;let aggregators2={};for(let agg of context.aggregates)aggregators2[translateTerm(agg.variable)]=translateExpression(agg);let extensions={};for(let i=context.extend.length-1;i>=0;--i){let e=context.extend[i];extensions[translateTerm(e.variable)]=replaceAggregatorVariables(translateExpression(e.expression),aggregators2)}if(context.group.length>0&&(select.group=context.group.map(variable=>{let v=translateTerm(variable);if(extensions[v]){let result2=extensions[v];return delete extensions[v],{variable,expression:result2}}return{expression:variable}})),context.order.length>0&&(select.order=context.order.map(translateOperation).map(o=>o.descending?o:{expression:o})),variables2&&(select.variables=variables2.map(term=>{let v=translateTerm(term);return extensions[v]?{variable:term,expression:extensions[v]}:term}),select.variables.length===0&&(select.variables=[new sparqljs_1$4.Wildcard])),result.where.length>0&&result.where[result.where.length-1].type==="filter"){const filter4=result.where[result.where.length-1];objectContainsValues(filter4,Object.keys(aggregators2))&&(select.having=util_1.default.flatten([replaceAggregatorVariables(filter4.expression,aggregators2)]),result.where.splice(-1))}return context.extend=extend,context.group=group,context.aggregates=aggregates,context.order=order,{type:"group",patterns:[select]}}__name(translateProject,"translateProject");function objectContainsValues(o,vals){return util_1.default.isSimpleTerm(o)?vals.indexOf(translateTerm(o))>=0:Array.isArray(o)?o.some(e=>objectContainsValues(e,vals)):o===Object(o)?Object.keys(o).some(key=>objectContainsValues(o[key],vals)):vals.indexOf(o)>=0}__name(objectContainsValues,"objectContainsValues");function translateReduced(op){let result=translateOperation(op.input);return result.patterns[0].reduced=!0,result}__name(translateReduced,"translateReduced");function translateService(op){let patterns=translateOperation(op.input);return patterns.type==="group"&&(patterns=patterns.patterns),Array.isArray(patterns)||(patterns=[patterns]),{type:"service",name:op.name,silent:op.silent,patterns}}__name(translateService,"translateService");function translateSlice(op){let result=translateOperation(op.input),obj=result;return result.type&&result.type==="group"&&(obj=result.patterns[0]),op.start!==0&&(obj.offset=op.start),op.length!==void 0&&(obj.limit=op.length),result}__name(translateSlice,"translateSlice");function translateUnion(op){return{type:"union",patterns:util_1.default.flatten(op.input.map(translateOperation))}}__name(translateUnion,"translateUnion");function translateValues(op){return{type:"values",values:op.bindings.map(binding=>{let result={};for(let v of op.variables){let s2=`?${v.value}`;binding[s2]?result[s2]=binding[s2]:result[s2]=void 0}return result})}}__name(translateValues,"translateValues");function translateAlt(path){const mapped=path.input.map(translatePathComponent);return mapped.every(entry=>"pathType"in entry&&entry.pathType==="!")?{type:"path",pathType:"!",items:[{type:"path",pathType:"|",items:util_1.default.flatten(mapped.map(entry=>entry.items))}]}:{type:"path",pathType:"|",items:mapped}}__name(translateAlt,"translateAlt");function translateInv(path){if(path.path.type===types.NPS){const inv=path.path.iris.map(iri=>({type:"path",pathType:"^",items:[iri]}));return inv.length<=1?{type:"path",pathType:"!",items:inv}:{type:"path",pathType:"!",items:[{type:"path",pathType:"|",items:inv}]}}return{type:"path",pathType:"^",items:[translatePathComponent(path.path)]}}__name(translateInv,"translateInv");function translateLink(path){return path.iri}__name(translateLink,"translateLink");function translateNps(path){return path.iris.length<=1?{type:"path",pathType:"!",items:path.iris}:{type:"path",pathType:"!",items:[{type:"path",pathType:"|",items:path.iris}]}}__name(translateNps,"translateNps");function translateOneOrMorePath(path){return{type:"path",pathType:"+",items:[translatePathComponent(path.path)]}}__name(translateOneOrMorePath,"translateOneOrMorePath");function translateSeq(path){return{type:"path",pathType:"/",items:path.input.map(translatePathComponent)}}__name(translateSeq,"translateSeq");function translateZeroOrMorePath(path){return{type:"path",pathType:"*",items:[translatePathComponent(path.path)]}}__name(translateZeroOrMorePath,"translateZeroOrMorePath");function translateZeroOrOnePath(path){return{type:"path",pathType:"?",items:[translatePathComponent(path.path)]}}__name(translateZeroOrOnePath,"translateZeroOrOnePath");function translateCompositeUpdate(op){const updates=op.updates.map(update11=>translateOperation(update11).updates[0]);return{prefixes:{},type:"update",updates}}__name(translateCompositeUpdate,"translateCompositeUpdate");function translateDeleteInsert(op){var _a2;let where=op.where,using;if(where&&where.type===types.FROM){let from=where;where=from.input,using={default:from.default,named:from.named}}const updates=[{updateType:"insertdelete",delete:convertUpdatePatterns(op.delete||[]),insert:convertUpdatePatterns(op.insert||[])}];if(using&&(updates[0].using=using),!where||where.type===types.BGP&&where.patterns.length===0)updates[0].where=[];else{const graphs={};let result=translateOperation(removeQuadsRecursive(where,graphs));result.type==="group"?updates[0].where=result.patterns:updates[0].where=[result];const graphNames=Object.keys(graphs);if(graphNames.length>0){if(graphNames.length!==1)throw new Error("This is unexpected and might indicate an error in graph handling for updates.");const graphName=(_a2=graphs[graphNames[0]])===null||_a2===void 0?void 0:_a2.graph;graphName&&graphName.value!==""&&(updates[0].where=[{type:"graph",patterns:updates[0].where,name:graphName}])}}return!op.delete&&!op.where?(updates[0].updateType="insert",delete updates[0].delete,delete updates[0].where):!op.insert&&!op.where?(delete updates[0].insert,delete updates[0].where,op.delete.some(pattern=>pattern.subject.termType==="Variable"||pattern.predicate.termType==="Variable"||pattern.object.termType==="Variable")?updates[0].updateType="deletewhere":updates[0].updateType="delete"):!op.insert&&op.where&&op.where.type==="bgp"&&(0,rdf_isomorphic_1.isomorphic)(op.delete,op.where.patterns)&&(delete updates[0].where,updates[0].updateType="deletewhere"),{prefixes:{},type:"update",updates}}__name(translateDeleteInsert,"translateDeleteInsert");function translateLoad(op){const updates=[{type:"load",silent:!!op.silent,source:op.source}];return op.destination&&(updates[0].destination=op.destination),{prefixes:{},type:"update",updates}}__name(translateLoad,"translateLoad");function translateClear(op){return translateClearCreateDrop(op,"clear")}__name(translateClear,"translateClear");function translateCreate(op){return translateClearCreateDrop(op,"create")}__name(translateCreate,"translateCreate");function translateDrop(op){return translateClearCreateDrop(op,"drop")}__name(translateDrop,"translateDrop");function translateClearCreateDrop(op,type){const updates=[{type,silent:!!op.silent}];return op.source==="DEFAULT"?updates[0].graph={default:!0}:op.source==="NAMED"?updates[0].graph={named:!0}:op.source==="ALL"?updates[0].graph={all:!0}:updates[0].graph={type:"graph",name:op.source},{prefixes:{},type:"update",updates}}__name(translateClearCreateDrop,"translateClearCreateDrop");function translateAdd(op){return translateUpdateGraphShortcut(op,"add")}__name(translateAdd,"translateAdd");function translateMove(op){return translateUpdateGraphShortcut(op,"move")}__name(translateMove,"translateMove");function translateCopy(op){return translateUpdateGraphShortcut(op,"copy")}__name(translateCopy,"translateCopy");function translateUpdateGraphShortcut(op,type){const updates=[{type,silent:!!op.silent}];return updates[0].source=op.source==="DEFAULT"?{type:"graph",default:!0}:{type:"graph",name:op.source},updates[0].destination=op.destination==="DEFAULT"?{type:"graph",default:!0}:{type:"graph",name:op.destination},{prefixes:{},type:"update",updates}}__name(translateUpdateGraphShortcut,"translateUpdateGraphShortcut");function convertUpdatePatterns(patterns){if(!patterns)return[];const graphs={};return patterns.forEach(pattern=>{const graph=pattern.graph.value;graphs[graph]||(graphs[graph]=[]),graphs[graph].push(pattern)}),Object.keys(graphs).map(graph=>graph===""?{type:"bgp",triples:graphs[graph].map(translatePattern)}:{type:"graph",triples:graphs[graph].map(translatePattern),name:graphs[graph][0].graph})}__name(convertUpdatePatterns,"convertUpdatePatterns");function removeQuads(op){return removeQuadsRecursive(op,{})}__name(removeQuads,"removeQuads");function removeQuadsRecursive(op,graphs){if(Array.isArray(op))return op.map(sub=>removeQuadsRecursive(sub,graphs));if(!op.type||op.type===types.DELETE_INSERT)return op;if((op.type===types.PATTERN||op.type===types.PATH)&&op.graph)return graphs[op.graph.value]||(graphs[op.graph.value]={graph:op.graph,values:[]}),graphs[op.graph.value].values.push(op),op;const result={},keyGraphs={},globalNames={};for(let key of Object.keys(op)){const newGraphs={};result[key]=removeQuadsRecursive(op[key],newGraphs);const graphNames=Object.keys(newGraphs);if(graphNames.length>1){let left=potentialGraphFromPatterns(newGraphs[graphNames[0]].values);for(let i=1;i<graphNames.length;++i){const right=potentialGraphFromPatterns(newGraphs[graphNames[i]].values);left=factory.createJoin([left,right])}return graphNames.map(name=>delete newGraphs[name]),left}else if(graphNames.length===1){const graph=newGraphs[graphNames[0]].graph;keyGraphs[key]=graph,globalNames[graph.value]=graph}}const graphNameSet=Object.keys(globalNames);if(graphNameSet.length>0)if(graphNameSet.length===1&&op.type!==types.PROJECT)graphs[graphNameSet[0]]={graph:globalNames[graphNameSet[0]],values:[result]};else for(let key of Object.keys(keyGraphs))keyGraphs[key].value.length>0&&(result[key]=factory.createGraph(result[key],keyGraphs[key]));return result}__name(removeQuadsRecursive,"removeQuadsRecursive");function potentialGraphFromPatterns(patterns){const bgp=factory.createBgp(patterns),name=patterns[0].graph;return name.value.length===0?bgp:factory.createGraph(bgp,name)}__name(potentialGraphFromPatterns,"potentialGraphFromPatterns");(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar2=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding2(result,mod,k);return __setModuleDefault2(result,mod),result},__importDefault2=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Util=exports.toSparqlJs=exports.toSparql=exports.Factory=exports.Algebra=exports.translate=void 0;const sparqlAlgebra_1=__importDefault2(sparqlAlgebra);exports.translate=sparqlAlgebra_1.default;const Algebra2=__importStar2(algebra);exports.Algebra=Algebra2;const factory_12=__importDefault2(factory$2);exports.Factory=factory_12.default;const sparql_1=sparql;Object.defineProperty(exports,"toSparql",{enumerable:!0,get:function(){return sparql_1.toSparql}}),Object.defineProperty(exports,"toSparqlJs",{enumerable:!0,get:function(){return sparql_1.toSparqlJs}});const util_12=__importDefault2(util);exports.Util=util_12.default})(sparqlalgebrajs);Object.defineProperty(Bindings$2,"__esModule",{value:!0});Bindings$2.materializeOperation=Bindings$2.materializeTerm=void 0;const bindings_factory_1$f=lib$2v,rdf_string_1$h=rdfString,rdf_terms_1$c=rdfTerms,sparqlalgebrajs_1$A=sparqlalgebrajs,BF$d=new bindings_factory_1$f.BindingsFactory;function materializeTerm(term,bindings){if(term.termType==="Variable"){const value=bindings.get(term);if(value)return value}return term.termType==="Quad"&&(0,rdf_terms_1$c.someTermsNested)(term,value=>value.termType==="Variable")?(0,rdf_terms_1$c.mapTermsNested)(term,subTerm=>materializeTerm(subTerm,bindings)):term}__name(materializeTerm,"materializeTerm");Bindings$2.materializeTerm=materializeTerm;function materializeOperation(operation,bindings,options={}){return options={strictTargetVariables:"strictTargetVariables"in options?options.strictTargetVariables:!1,bindFilter:"bindFilter"in options?options.bindFilter:!0},sparqlalgebrajs_1$A.Util.mapOperation(operation,{path(op,factory2){return{recurse:!1,result:factory2.createPath(materializeTerm(op.subject,bindings),op.predicate,materializeTerm(op.object,bindings),materializeTerm(op.graph,bindings))}},pattern(op,factory2){return{recurse:!1,result:factory2.createPattern(materializeTerm(op.subject,bindings),materializeTerm(op.predicate,bindings),materializeTerm(op.object,bindings),materializeTerm(op.graph,bindings))}},extend(op){if(bindings.has(op.variable)){if(options.strictTargetVariables)throw new Error(`Tried to bind variable ${(0,rdf_string_1$h.termToString)(op.variable)} in a BIND operator.`);return{recurse:!0,result:materializeOperation(op.input,bindings,options)}}return{recurse:!0,result:op}},group(op,factory2){if(options.strictTargetVariables){for(const variable of op.variables)if(bindings.has(variable))throw new Error(`Tried to bind variable ${(0,rdf_string_1$h.termToString)(variable)} in a GROUP BY operator.`);return{recurse:!0,result:op}}const variables2=op.variables.filter(variable=>!bindings.has(variable));return{recurse:!0,result:factory2.createGroup(op.input,variables2,op.aggregates)}},project(op,factory2){if(options.strictTargetVariables){for(const variable of op.variables)if(bindings.has(variable))throw new Error(`Tried to bind variable ${(0,rdf_string_1$h.termToString)(variable)} in a SELECT operator.`);return{recurse:!0,result:op}}const variables2=op.variables.filter(variable=>!bindings.has(variable)),subBindings=BF$d.bindings(op.variables.map(variable=>{const binding=bindings.get(variable);if(binding)return[variable,binding]}).filter(entry=>!!entry));return{recurse:!1,result:factory2.createProject(materializeOperation(op.input,subBindings,options),variables2)}},values(op,factory2){if(options.strictTargetVariables){for(const variable of op.variables)if(bindings.has(variable))throw new Error(`Tried to bind variable ${(0,rdf_string_1$h.termToString)(variable)} in a VALUES operator.`)}else{const variables2=op.variables.filter(variable=>!bindings.has(variable)),valueBindings=op.bindings.map(binding=>{const newBinding={...binding};let valid=!0;return bindings.forEach((value,key)=>{const keyString=(0,rdf_string_1$h.termToString)(key);keyString in newBinding&&(value.equals(newBinding[keyString])||(valid=!1),delete newBinding[keyString])}),valid?newBinding:void 0}).filter(Boolean);return{recurse:!0,result:factory2.createValues(variables2,valueBindings)}}return{recurse:!1,result:op}},expression(op,factory2){if(!options.bindFilter)return{recurse:!1,result:op};if(op.expressionType==="term")return{recurse:!1,result:factory2.createTermExpression(materializeTerm(op.term,bindings))};if(op.expressionType==="aggregate"&&"variable"in op&&bindings.has(op.variable)){if(options.strictTargetVariables)throw new Error(`Tried to bind ${(0,rdf_string_1$h.termToString)(op.variable)} in a ${op.aggregator} aggregate.`);return{recurse:!0,result:op}}return{recurse:!0,result:op}}})}__name(materializeOperation,"materializeOperation");Bindings$2.materializeOperation=materializeOperation;Object.defineProperty(ActorQueryOperation$1,"__esModule",{value:!0});ActorQueryOperation$1.ActorQueryOperation=void 0;const context_entries_1$r=lib$2x,core_1$w=lib$2A,data_factory_1$2=lib$2w,Bindings_1=Bindings$2;let bnodeCounter=0;class ActorQueryOperation extends core_1$w.Actor{constructor(args){super(args)}static getSafeBindings(output){return ActorQueryOperation.validateQueryOutput(output,"bindings"),output}static getSafeQuads(output){return ActorQueryOperation.validateQueryOutput(output,"quads"),output}static getSafeBoolean(output){return ActorQueryOperation.validateQueryOutput(output,"boolean"),output}static getSafeVoid(output){return ActorQueryOperation.validateQueryOutput(output,"void"),output}static cachifyMetadata(metadata){let lastReturn;return()=>(lastReturn||(lastReturn=metadata(),lastReturn.then(lastReturnValue=>lastReturnValue.state.addInvalidateListener(()=>{lastReturn=void 0})).catch(()=>{})),lastReturn)}static validateQueryOutput(output,expectedType){if(output.type!==expectedType)throw new Error(`Invalid query output type: Expected '${expectedType}' but got '${output.type}'`)}static getBaseExpressionContext(context2){const now2=context2.get(context_entries_1$r.KeysInitQuery.queryTimestamp),baseIRI=context2.get(context_entries_1$r.KeysInitQuery.baseIRI),functionArgumentsCache=context2.get(context_entries_1$r.KeysInitQuery.functionArgumentsCache)||{};if(context2.has(context_entries_1$r.KeysInitQuery.extensionFunctionCreator)&&context2.has(context_entries_1$r.KeysInitQuery.extensionFunctions))throw new Error("Illegal simultaneous usage of extensionFunctionCreator and extensionFunctions in context");let extensionFunctionCreator=context2.get(context_entries_1$r.KeysInitQuery.extensionFunctionCreator);const extensionFunctions=context2.get(context_entries_1$r.KeysInitQuery.extensionFunctions);return extensionFunctions&&(extensionFunctionCreator=__name(functionNamedNode=>extensionFunctions[functionNamedNode.value],"extensionFunctionCreator")),{now:now2,baseIRI,extensionFunctionCreator,functionArgumentsCache}}static getExpressionContext(context2,mediatorQueryOperation){return{...this.getBaseExpressionContext(context2),bnode:input=>new data_factory_1$2.BlankNodeBindingsScoped(input||`BNODE_${bnodeCounter++}`)}}static getAsyncExpressionContext(context2,mediatorQueryOperation){return{...this.getBaseExpressionContext(context2),bnode:input=>Promise.resolve(new data_factory_1$2.BlankNodeBindingsScoped(input||`BNODE_${bnodeCounter++}`)),exists:ActorQueryOperation.createExistenceResolver(context2,mediatorQueryOperation)}}static createExistenceResolver(context2,mediatorQueryOperation){return async(expr,bindings)=>{const operation=(0,Bindings_1.materializeOperation)(expr.input,bindings),outputRaw=await mediatorQueryOperation.mediate({operation,context:context2}),output=ActorQueryOperation.getSafeBindings(outputRaw);return new Promise((resolve2,reject)=>{output.bindingsStream.on("end",()=>{resolve2(!1)}),output.bindingsStream.on("error",reject),output.bindingsStream.on("data",()=>{output.bindingsStream.close(),resolve2(!0)})}).then(exists=>expr.not?!exists:exists)}}static throwOnReadOnly(context2){if(context2.get(context_entries_1$r.KeysQueryOperation.readOnly))throw new Error("Attempted a write operation in read-only mode")}}__name(ActorQueryOperation,"ActorQueryOperation");ActorQueryOperation$1.ActorQueryOperation=ActorQueryOperation;var ActorQueryOperationTyped$1={};Object.defineProperty(ActorQueryOperationTyped$1,"__esModule",{value:!0});ActorQueryOperationTyped$1.ActorQueryOperationTyped=void 0;const context_entries_1$q=lib$2x,ActorQueryOperation_1=ActorQueryOperation$1;class ActorQueryOperationTyped extends ActorQueryOperation_1.ActorQueryOperation{constructor(args,operationName){if(super({...args,operationName}),!this.operationName)throw new Error('A valid "operationName" argument must be provided.')}async test(action){if(!action.operation)throw new Error("Missing field 'operation' in a query operation action.");if(action.operation.type!==this.operationName)throw new Error(`Actor ${this.name} only supports ${this.operationName} operations, but got ${action.operation.type}`);const operation=action.operation;return this.testOperation(operation,action.context)}async run(action){const physicalQueryPlanLogger=action.context.get(context_entries_1$q.KeysInitQuery.physicalQueryPlanLogger);physicalQueryPlanLogger&&(physicalQueryPlanLogger.logOperation(action.operation.type,void 0,action.operation,action.context.get(context_entries_1$q.KeysInitQuery.physicalQueryPlanNode),this.name,{}),action.context=action.context.set(context_entries_1$q.KeysInitQuery.physicalQueryPlanNode,action.operation));const operation=action.operation,subContext=action.context.set(context_entries_1$q.KeysQueryOperation.operation,operation),output=await this.runOperation(operation,subContext);return"metadata"in output&&(output.metadata=ActorQueryOperation_1.ActorQueryOperation.cachifyMetadata(output.metadata)),output}}__name(ActorQueryOperationTyped,"ActorQueryOperationTyped");ActorQueryOperationTyped$1.ActorQueryOperationTyped=ActorQueryOperationTyped;var ActorQueryOperationTypedMediated$1={};Object.defineProperty(ActorQueryOperationTypedMediated$1,"__esModule",{value:!0});ActorQueryOperationTypedMediated$1.ActorQueryOperationTypedMediated=void 0;const ActorQueryOperationTyped_1=ActorQueryOperationTyped$1;class ActorQueryOperationTypedMediated extends ActorQueryOperationTyped_1.ActorQueryOperationTyped{constructor(args,operationName){super(args,operationName)}}__name(ActorQueryOperationTypedMediated,"ActorQueryOperationTypedMediated");ActorQueryOperationTypedMediated$1.ActorQueryOperationTypedMediated=ActorQueryOperationTypedMediated;var BusQueryOperation$1={};Object.defineProperty(BusQueryOperation$1,"__esModule",{value:!0});BusQueryOperation$1.BusQueryOperation=void 0;const core_1$v=lib$2A;class BusQueryOperation extends core_1$v.BusIndexed{constructor(args){super({...args,actorIdentifierFields:["operationName"],actionIdentifierFields:["operation","type"]})}}__name(BusQueryOperation,"BusQueryOperation");BusQueryOperation$1.BusQueryOperation=BusQueryOperation;var ClosableTransformIterator$1={},asynciterator={},linkedlist={};Object.defineProperty(linkedlist,"__esModule",{value:!0});linkedlist.LinkedList=void 0;class LinkedList{constructor(){this._length=0,this._head=null,this._tail=null}get length(){return this._length}get first(){var _a2;return(_a2=this._head)===null||_a2===void 0?void 0:_a2.value}get last(){var _a2;return(_a2=this._tail)===null||_a2===void 0?void 0:_a2.value}get empty(){return this._head===null}push(value){const node2={value,next:null};this._tail===null?this._head=this._tail=node2:this._tail.next=this._tail=node2,this._length++}shift(){if(this._head===null)return;const{value,next}=this._head;return this._head=next,next===null&&(this._tail=null),this._length--,value}clear(){this._length=0,this._head=this._tail=null}}__name(LinkedList,"LinkedList");linkedlist.LinkedList=LinkedList;var taskscheduler={};Object.defineProperty(taskscheduler,"__esModule",{value:!0});taskscheduler.createTaskScheduler=void 0;const resolved=Promise.resolve(void 0);function createTaskScheduler(){const scheduleMicrotask=typeof queueMicrotask=="function"?queueMicrotask:task=>resolved.then(task),scheduleMacrotask=typeof setImmediate=="function"?setImmediate:task=>setTimeout(task,0);let i=0,queue=null;return task=>{queue!==null?queue.push(task):++i<100?scheduleMicrotask(task):(queue=[task],scheduleMacrotask(()=>{for(const queued of queue)scheduleMicrotask(queued);queue=null,i=0}))}}__name(createTaskScheduler,"createTaskScheduler");taskscheduler.createTaskScheduler=createTaskScheduler;(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.isIterator=exports.isIterable=exports.isSourceExpression=exports.isPromise=exports.isEventEmitter=exports.isFunction=exports.range=exports.union=exports.fromIterable=exports.fromIterator=exports.fromArray=exports.single=exports.empty=exports.wrap=exports.WrappingIterator=exports.ClonedIterator=exports.UnionIterator=exports.MultiTransformIterator=exports.SimpleTransformIterator=exports.TransformIterator=exports.BufferedIterator=exports.MappingIterator=exports.DESTINATION=exports.identity=exports.IntegerIterator=exports.ArrayIterator=exports.SingletonIterator=exports.EmptyIterator=exports.AsyncIterator=exports.DESTROYED=exports.ENDED=exports.CLOSED=exports.CLOSING=exports.OPEN=exports.INIT=exports.setTaskScheduler=exports.getTaskScheduler=exports.scheduleTask=exports.LinkedList=void 0;const events_1=eventsExports,linkedlist_1=linkedlist;Object.defineProperty(exports,"LinkedList",{enumerable:!0,get:function(){return linkedlist_1.LinkedList}});let taskScheduler=taskscheduler.createTaskScheduler();function scheduleTask2(task){taskScheduler(task)}__name(scheduleTask2,"scheduleTask"),exports.scheduleTask=scheduleTask2;function getTaskScheduler(){return taskScheduler}__name(getTaskScheduler,"getTaskScheduler"),exports.getTaskScheduler=getTaskScheduler;function setTaskScheduler(scheduler){taskScheduler=scheduler}__name(setTaskScheduler,"setTaskScheduler"),exports.setTaskScheduler=setTaskScheduler,exports.INIT=1,exports.OPEN=2,exports.CLOSING=4,exports.CLOSED=8,exports.ENDED=16,exports.DESTROYED=32;class AsyncIterator2 extends events_1.EventEmitter{constructor(initialState=exports.OPEN){super(),this._readable=!1,this._state=initialState,this.on("newListener",waitForDataListener)}_changeState(newState,eventAsync=!1){const valid=newState>this._state&&this._state<exports.ENDED;return valid&&(this._state=newState,newState===exports.ENDED&&(eventAsync?taskScheduler(()=>this.emit("end")):this.emit("end"))),valid}read(){return null}forEach(callback,self2){this.on("data",bind(callback,self2))}close(){this._changeState(exports.CLOSED)&&this._endAsync()}destroy(cause){this.done||this._destroy(cause,error=>{cause=cause||error,cause&&this.emit("error",cause),this._end(!0)})}_destroy(cause,callback){callback()}_end(destroy=!1){this._changeState(destroy?exports.DESTROYED:exports.ENDED)&&(this._readable=!1,this.removeAllListeners("readable"),this.removeAllListeners("data"),this.removeAllListeners("end"))}_endAsync(){taskScheduler(()=>this._end())}get readable(){return this._readable}set readable(readable){readable=!!readable&&!this.done,this._readable!==readable&&(this._readable=readable,readable&&taskScheduler(()=>this.emit("readable")))}get closed(){return this._state>=exports.CLOSING}get ended(){return this._state===exports.ENDED}get destroyed(){return this._state===exports.DESTROYED}get done(){return this._state>=exports.ENDED}toString(){const details=this._toStringDetails();return`[${this.constructor.name}${details?` ${details}`:""}]`}_toStringDetails(){return""}toArray(options){const items=[],limit=typeof(options==null?void 0:options.limit)=="number"?options.limit:1/0;return this.ended||limit<=0?Promise.resolve(items):new Promise((resolve2,reject)=>{const resolveItems=__name(()=>resolve2(items),"resolveItems"),pushItem=__name(item=>{items.push(item),items.length>=limit&&(this.removeListener("error",reject),this.removeListener("data",pushItem),this.removeListener("end",resolveItems),resolve2(items))},"pushItem");this.on("error",reject),this.on("data",pushItem),this.on("end",resolveItems)})}getProperty(propertyName,callback){const properties=this._properties;if(!callback)return properties&&properties[propertyName];if(properties&&propertyName in properties)taskScheduler(()=>callback(properties[propertyName]));else{let propertyCallbacks;(propertyCallbacks=this._propertyCallbacks)||(this._propertyCallbacks=propertyCallbacks=Object.create(null)),propertyName in propertyCallbacks?propertyCallbacks[propertyName].push(callback):propertyCallbacks[propertyName]=[callback]}}setProperty(propertyName,value){const properties=this._properties||(this._properties=Object.create(null));properties[propertyName]=value;const propertyCallbacks=this._propertyCallbacks||{},callbacks=propertyCallbacks[propertyName];if(callbacks){delete propertyCallbacks[propertyName],taskScheduler(()=>{for(const callback of callbacks)callback(value)});for(propertyName in propertyCallbacks)return;delete this._propertyCallbacks}}getProperties(){const properties=this._properties,copy={};for(const name in properties)copy[name]=properties[name];return copy}setProperties(properties){for(const propertyName in properties)this.setProperty(propertyName,properties[propertyName])}copyProperties(source,propertyNames){for(const propertyName of propertyNames)source.getProperty(propertyName,value=>this.setProperty(propertyName,value))}transform(options){return new SimpleTransformIterator2(this,options)}map(map2,self2){return new MappingIterator(this,bind(map2,self2))}filter(filter4,self2){return this.map(function(item){return filter4.call(self2||this,item)?item:null})}uniq(by=identity){const uniques=new Set;return this.filter(function(item){const hashed=by.call(this,item);return uniques.has(hashed)?!1:(uniques.add(hashed),!0)})}prepend(items){return this.transform({prepend:items})}append(items){return this.transform({append:items})}surround(prepend2,append2){return this.transform({prepend:prepend2,append:append2})}skip(offset){return this.map(item=>offset-- >0?null:item)}take(limit){return this.transform({limit})}range(start,end){return this.transform({offset:start,limit:Math.max(end-start+1,0)})}clone(){return new ClonedIterator(this)}}__name(AsyncIterator2,"AsyncIterator"),exports.AsyncIterator=AsyncIterator2;function waitForDataListener(eventName){eventName==="data"&&(this.removeListener("newListener",waitForDataListener),addSingleListener(this,"readable",emitData),this.readable&&taskScheduler(()=>emitData.call(this)))}__name(waitForDataListener,"waitForDataListener");function emitData(){let item;for(;this.listenerCount("data")!==0&&(item=this.read())!==null;)this.emit("data",item);this.listenerCount("data")===0&&!this.done&&(this.removeListener("readable",emitData),addSingleListener(this,"newListener",waitForDataListener))}__name(emitData,"emitData");function addSingleListener(source,eventName,listener){source.listeners(eventName).includes(listener)||source.on(eventName,listener)}__name(addSingleListener,"addSingleListener");class EmptyIterator extends AsyncIterator2{constructor(){super(),this._changeState(exports.ENDED,!0)}}__name(EmptyIterator,"EmptyIterator"),exports.EmptyIterator=EmptyIterator;class SingletonIterator extends AsyncIterator2{constructor(item){super(),this._item=item,item===null?this.close():this.readable=!0}read(){const item=this._item;return this._item=null,this.close(),item}_toStringDetails(){return this._item===null?"":`(${this._item})`}}__name(SingletonIterator,"SingletonIterator"),exports.SingletonIterator=SingletonIterator;class ArrayIterator extends AsyncIterator2{constructor(items=[],{autoStart=!0,preserve=!0}={}){super();const buffer=preserve||!Array.isArray(items)?[...items]:items;this._index=0,this._sourceStarted=autoStart!==!1,this._truncateThreshold=preserve?-1:64,this._sourceStarted&&buffer.length===0?this.close():this._buffer=buffer,this.readable=!0}read(){this._sourceStarted||(this._sourceStarted=!0);let item=null;return this._buffer&&(this._index<this._buffer.length&&(item=this._buffer[this._index++]),this._index===this._buffer.length?(delete this._buffer,this.close()):this._index===this._truncateThreshold&&(this._buffer.splice(0,this._truncateThreshold),this._index=0)),item}_toStringDetails(){return`(${this._buffer?this._buffer.length-this._index:0})`}_destroy(cause,callback){delete this._buffer,callback()}toArray(options={}){if(!this._buffer)return Promise.resolve([]);const{length}=this._buffer,start=this._index,end=typeof options.limit!="number"?length:start+options.limit,items=this._buffer.slice(start,end);return this._index=end,end>=length&&this.close(),Promise.resolve(items)}}__name(ArrayIterator,"ArrayIterator"),exports.ArrayIterator=ArrayIterator;class IntegerIterator extends AsyncIterator2{constructor({start=0,step=1,end}={}){super(),Number.isFinite(start)&&(start=Math.trunc(start)),this._next=start,Number.isFinite(step)&&(step=Math.trunc(step)),this._step=step;const ascending=step>=0,direction=ascending?1/0:-1/0;Number.isFinite(end)?end=Math.trunc(end):end!==-direction&&(end=direction),this._last=end,!Number.isFinite(start)||(ascending?start>end:start<end)?this.close():this.readable=!0}read(){if(this.closed)return null;const current=this._next,step=this._step,last3=this._last,next=this._next+=step;return(step>=0?next>last3:next<last3)&&this.close(),current}_toStringDetails(){return`(${this._next}...${this._last})`}}__name(IntegerIterator,"IntegerIterator"),exports.IntegerIterator=IntegerIterator;function identity(item){return item}__name(identity,"identity"),exports.identity=identity,exports.DESTINATION=Symbol("destination");class MappingIterator extends AsyncIterator2{constructor(source,map2=identity,options={}){super(),this._map=map2,this._source=ensureSourceAvailable(source),this._destroySource=options.destroySource!==!1,source.done?this.close():(this._source[exports.DESTINATION]=this,this._source.on("end",destinationClose),this._source.on("error",destinationEmitError2),this._source.on("readable",destinationSetReadable2),this.readable=this._source.readable)}read(){if(!this.done){if(this._source.readable){let item,mapped;for(;(item=this._source.read())!==null;)if((mapped=this._map(item))!==null)return mapped}this.readable=!1,this._source.done&&this.close()}return null}_end(destroy){this._source.removeListener("end",destinationClose),this._source.removeListener("error",destinationEmitError2),this._source.removeListener("readable",destinationSetReadable2),delete this._source[exports.DESTINATION],this._destroySource&&this._source.destroy(),super._end(destroy)}}__name(MappingIterator,"MappingIterator"),exports.MappingIterator=MappingIterator;function ensureSourceAvailable(source,allowDestination=!1){if(!source||!isFunction(source.read)||!isFunction(source.on))throw new TypeError(`Invalid source: ${source}`);if(!allowDestination&&source[exports.DESTINATION])throw new Error("The source already has a destination");return source}__name(ensureSourceAvailable,"ensureSourceAvailable");class BufferedIterator extends AsyncIterator2{constructor({maxBufferSize=4,autoStart=!0}={}){super(exports.INIT),this._buffer=new linkedlist_1.LinkedList,this._maxBufferSize=4,this._reading=!0,this._pushedCount=0,this.maxBufferSize=maxBufferSize,taskScheduler(()=>this._init(autoStart)),this._sourceStarted=autoStart!==!1}get maxBufferSize(){return this._maxBufferSize}set maxBufferSize(maxBufferSize){maxBufferSize!==1/0&&(maxBufferSize=Number.isFinite(maxBufferSize)?Math.max(Math.trunc(maxBufferSize),1):4),this._maxBufferSize!==maxBufferSize&&(this._maxBufferSize=maxBufferSize,this._state===exports.OPEN&&this._fillBuffer())}_init(autoStart){let doneCalled=!1;this._reading=!0,this._begin(()=>{if(doneCalled)throw new Error("done callback called multiple times");doneCalled=!0,this._reading=!1,this._changeState(exports.OPEN),autoStart?this._fillBufferAsync():this.readable=!0})}_begin(done){done()}read(){if(this.done)return null;this._sourceStarted||(this._sourceStarted=!0);const buffer=this._buffer;let item;return buffer.empty?(item=null,this.readable=!1):item=buffer.shift(),!this._reading&&buffer.length<this._maxBufferSize&&(this.closed?buffer.empty&&this._endAsync():this._fillBufferAsync()),item}_read(count2,done){done()}_push(item){this.done||(this._pushedCount++,this._buffer.push(item),this.readable=!0)}_fillBuffer(){let neededItems;this._reading||(this.closed?this._completeClose():(neededItems=Math.min(this._maxBufferSize-this._buffer.length,128))>0&&(this._pushedCount=0,this._reading=!0,this._read(neededItems,()=>{if(!neededItems)throw new Error("done callback called multiple times");neededItems=0,this._reading=!1,this.closed?this._completeClose():this._pushedCount&&(this.readable=!0,this._buffer.length<this._maxBufferSize/2&&this._fillBufferAsync())})))}_fillBufferAsync(){this._reading||(this._reading=!0,taskScheduler(()=>{this._reading=!1,this._fillBuffer()}))}close(){this._reading?this._changeState(exports.CLOSING):this._completeClose()}_completeClose(){this._changeState(exports.CLOSED)&&(this._reading=!0,this._flush(()=>{if(!this._reading)throw new Error("done callback called multiple times");this._reading=!1,this._buffer.empty&&this._endAsync()}))}_destroy(cause,callback){this._buffer.clear(),callback()}_flush(done){done()}_toStringDetails(){const buffer=this._buffer;return`{${buffer.empty?"":`next: ${buffer.first}, `}buffer: ${buffer.length}}`}}__name(BufferedIterator,"BufferedIterator"),exports.BufferedIterator=BufferedIterator;class TransformIterator extends BufferedIterator{constructor(source,options=source||{}){super(options),this._boundPush=item=>this._push(item),isSourceExpression(source)||(source=options.source),isEventEmitter(source)?this.source=source:source&&(this._createSource=isPromise(source)?()=>source:source,this._sourceStarted&&this._loadSourceAsync()),this._optional=!!options.optional,this._destroySource=options.destroySource!==!1}get source(){return isFunction(this._createSource)&&this._loadSourceAsync(),this._source}set source(value){const source=this._source=this._validateSource(value);source[exports.DESTINATION]=this,this.done?this._destroySource&&source.destroy():source.done?this.close():(source.on("end",destinationCloseWhenDone),source.on("readable",destinationFillBuffer),source.on("error",destinationEmitError2))}_loadSourceAsync(){isFunction(this._createSource)&&(Promise.resolve(this._createSource()).then(source=>{delete this._createSource,this.source=source,this._fillBuffer()},error=>this.emit("error",error)),this._createSource=null)}_validateSource(source,allowDestination=!1){if(this._source||typeof this._createSource<"u")throw new Error("The source cannot be changed after it has been set");return ensureSourceAvailable(source,allowDestination)}_read(count2,done){const next=__name(()=>{this._pushedCount<count2&&!this.closed?taskScheduler(()=>this._readAndTransform(next,done)):done()},"next");this._readAndTransform(next,done)}_readAndTransform(next,done){let item;const source=this.source;!source||source.done||(item=source.read())===null?done():this._optional?this._optionalTransform(item,next):this._transform(item,next,this._boundPush)}_optionalTransform(item,done){const pushedCount=this._pushedCount;this._transform(item,()=>{pushedCount===this._pushedCount&&this._push(item),done()},this._boundPush)}_transform(item,done,push){push(item),done()}_closeWhenDone(){this.close()}_end(destroy){const source=this._source;source&&(source.removeListener("end",destinationCloseWhenDone),source.removeListener("error",destinationEmitError2),source.removeListener("readable",destinationFillBuffer),delete source[exports.DESTINATION],this._destroySource&&source.destroy()),super._end(destroy)}}__name(TransformIterator,"TransformIterator"),exports.TransformIterator=TransformIterator;function destinationSetReadable2(){this[exports.DESTINATION].readable=!0}__name(destinationSetReadable2,"destinationSetReadable");function destinationEmitError2(error){this[exports.DESTINATION].emit("error",error)}__name(destinationEmitError2,"destinationEmitError");function destinationClose(){this[exports.DESTINATION].close()}__name(destinationClose,"destinationClose");function destinationCloseWhenDone(){this[exports.DESTINATION]._closeWhenDone()}__name(destinationCloseWhenDone,"destinationCloseWhenDone");function destinationFillBuffer(){this[exports.DESTINATION]._sourceStarted!==!1&&this[exports.DESTINATION]._fillBuffer()}__name(destinationFillBuffer,"destinationFillBuffer");class SimpleTransformIterator2 extends TransformIterator{constructor(source,options){if(super(source,options),this._offset=0,this._limit=1/0,this._filter=item=>!0,options=options||(isSourceExpression(source)?null:source),options){const transform=isFunction(options)?options:options.transform,{limit,offset,filter:filter4,map:map2,prepend:prepend2,append:append2}=options;offset===1/0||limit===-1/0?this._limit=0:(Number.isFinite(offset)&&(this._offset=Math.max(Math.trunc(offset),0)),Number.isFinite(limit)&&(this._limit=Math.max(Math.trunc(limit),0)),isFunction(filter4)&&(this._filter=filter4),isFunction(map2)&&(this._map=map2),this._transform=isFunction(transform)?transform:null),prepend2&&(this._prepender=isEventEmitter(prepend2)?prepend2:fromArray(prepend2)),append2&&(this._appender=isEventEmitter(append2)?append2:fromArray(append2))}}_read(count2,done){const next=__name(()=>this._readAndTransformSimple(count2,nextAsync,done),"next");this._readAndTransformSimple(count2,nextAsync,done);function nextAsync(){taskScheduler(next)}__name(nextAsync,"nextAsync")}_readAndTransformSimple(count2,next,done){let item;const{source}=this;if(!source||source.done){done();return}for(this._limit===0&&this.close();!this.closed&&this._pushedCount<count2&&(item=source.read())!==null;){if(!this._filter(item)||this._offset!==0&&this._offset--)continue;const mappedItem=typeof this._map>"u"?item:this._map(item);if(mappedItem===null)this._optional&&this._push(item);else if(!isFunction(this._transform))this._push(mappedItem);else{this._optional?this._optionalTransform(mappedItem,next):this._transform(mappedItem,next,this._boundPush);return}--this._limit===0&&this.close()}done()}_begin(done){this._insert(this._prepender,done),delete this._prepender}_flush(done){this._insert(this._appender,done),delete this._appender}_insert(inserter,done){const push=__name(item=>this._push(item),"push");!inserter||inserter.done?done():(inserter.on("data",push),inserter.on("end",end));function end(){inserter.removeListener("data",push),inserter.removeListener("end",end),done()}__name(end,"end")}}__name(SimpleTransformIterator2,"SimpleTransformIterator"),exports.SimpleTransformIterator=SimpleTransformIterator2;class MultiTransformIterator2 extends TransformIterator{constructor(source,options){if(super(source,options),this._transformerQueue=[],options){const multiTransform=isFunction(options)?options:options.multiTransform;multiTransform&&(this._createTransformer=multiTransform)}}_read(count2,done){const transformerQueue=this._transformerQueue,optional=this._optional;let head2,item;for(;(head2=transformerQueue[0])&&head2.transformer.done;){optional&&head2.item!==null&&(count2--,this._push(head2.item)),transformerQueue.shift();const{transformer}=head2;transformer.removeListener("end",destinationFillBuffer),transformer.removeListener("readable",destinationFillBuffer),transformer.removeListener("error",destinationEmitError2)}const{source}=this;for(;source&&!source.done&&transformerQueue.length<this.maxBufferSize&&(item=source.read(),item!==null);){const transformer=this._createTransformer(item)||new EmptyIterator;transformer[exports.DESTINATION]=this,transformer.on("end",destinationFillBuffer),transformer.on("readable",destinationFillBuffer),transformer.on("error",destinationEmitError2),transformerQueue.push({transformer,item})}if(head2=transformerQueue[0],head2){const{transformer}=head2;for(;count2-- >0&&(item=transformer.read())!==null;)this._push(item),optional&&(head2.item=null)}else source&&source.done&&this.close();done()}_createTransformer(item){return new SingletonIterator(item)}_closeWhenDone(){this._transformerQueue.length||this.close()}_end(destroy){if(super._end(destroy),this._destroySource)for(const item of this._transformerQueue)item.transformer.destroy()}}__name(MultiTransformIterator2,"MultiTransformIterator"),exports.MultiTransformIterator=MultiTransformIterator2;class UnionIterator extends BufferedIterator{constructor(sources,options={}){super(options),this._sources=[],this._currentSource=-1;const autoStart=options.autoStart!==!1;if(isEventEmitter(sources))sources.on("error",error=>this.emit("error",error)),this._pending={loading:!1,sources},autoStart&&this._loadSources();else if(Array.isArray(sources)&&sources.length>0)for(const source of sources)this._addSource(source);else autoStart&&this.close();this._destroySources=options.destroySources!==!1}_loadSources(){const sources=this._pending.sources;this._pending.loading=!0,sources.done?(delete this._pending,this.close()):(sources.on("data",source=>{this._addSource(source),this._fillBufferAsync()}),sources.on("end",()=>{delete this._pending,this._fillBuffer()}))}_addSource(source){isPromise(source)&&(source=wrap2(source)),source.done||(this._sources.push(source),source[exports.DESTINATION]=this,source.on("error",destinationEmitError2),source.on("readable",destinationFillBuffer),source.on("end",destinationRemoveEmptySources))}_removeEmptySources(){this._sources=this._sources.filter((source,index)=>(source.done&&index<=this._currentSource&&this._currentSource--,!source.done)),this._fillBuffer()}_read(count2,done){var _a2;((_a2=this._pending)===null||_a2===void 0?void 0:_a2.loading)===!1&&this._loadSources();let lastCount=0,item;for(;lastCount!==(lastCount=count2);)for(let i=0;i<this._sources.length&&count2>0;i++)this._currentSource=(this._currentSource+1)%this._sources.length,(item=this._sources[this._currentSource].read())!==null&&(count2--,this._push(item));!this._pending&&this._sources.length===0&&this.close(),done()}_end(destroy=!1){if(super._end(destroy),this._destroySources){for(const source of this._sources)source.destroy();this._pending&&(this._pending.sources.destroy(),delete this._pending)}}}__name(UnionIterator,"UnionIterator"),exports.UnionIterator=UnionIterator;function destinationRemoveEmptySources(){this[exports.DESTINATION]._removeEmptySources()}__name(destinationRemoveEmptySources,"destinationRemoveEmptySources");class ClonedIterator extends TransformIterator{constructor(source){super(source,{autoStart:!1}),this._readPosition=0,this._reading=!1,source&&(this.readable=!0)}_init(){}close(){AsyncIterator2.prototype.close.call(this)}get source(){return super.source}set source(value){const source=this._source=this._validateSource(value),history=source&&source[exports.DESTINATION]||(source[exports.DESTINATION]=new HistoryReader(source));this.done?this._destroySource&&source.destroy():history.endsAt(0)?this.close():(history.register(this),(source._sourceStarted===!1||history.readAt(0)!==null)&&(this.readable=!0));const propertyCallbacks=this._propertyCallbacks;for(const propertyName in propertyCallbacks){const callbacks=propertyCallbacks[propertyName];for(const callback of callbacks)this._getSourceProperty(propertyName,callback)}}_validateSource(source,allowDestination=!1){const history=source&&source[exports.DESTINATION];return super._validateSource(source,!history||history instanceof HistoryReader)}getProperty(propertyName,callback){const{source}=this,properties=this._properties,hasProperty=properties&&propertyName in properties;if(!callback)return hasProperty?properties&&properties[propertyName]:source&&source.getProperty(propertyName);super.getProperty(propertyName,callback),source&&!hasProperty&&this._getSourceProperty(propertyName,callback)}_getSourceProperty(propertyName,callback){this.source.getProperty(propertyName,value=>{(!this._properties||!(propertyName in this._properties))&&callback(value)})}getProperties(){const base=this.source?this.source.getProperties():{},properties=this._properties;for(const name in properties)base[name]=properties[name];return base}_toStringDetails(){return`{source: ${this.source?this.source.toString():"none"}}`}read(){this._sourceStarted||(this._sourceStarted=!0);const source=this.source;let item=null;if(!this.done&&source){const history=source[exports.DESTINATION];(item=history.readAt(this._readPosition))!==null?this._readPosition++:this.readable=!1,history.endsAt(this._readPosition)&&this.close()}return item}_end(destroy){const source=this.source,history=source==null?void 0:source[exports.DESTINATION];history&&history.unregister(this),BufferedIterator.prototype._end.call(this,destroy)}}__name(ClonedIterator,"ClonedIterator"),exports.ClonedIterator=ClonedIterator;class HistoryReader{constructor(source){if(this._history=[],this._trackers=new Set,this._source=source,!source.done){const setReadable=__name(()=>{for(const tracker of this._trackers)tracker.readable=!0},"setReadable"),emitError=__name(error=>{for(const tracker of this._trackers)tracker.emit("error",error)},"emitError"),end=__name(()=>{for(const tracker of this._trackers)tracker._sourceStarted!==!1&&tracker._readPosition===this._history.length&&tracker.close();this._trackers.clear(),source.removeListener("end",end),source.removeListener("error",emitError),source.removeListener("readable",setReadable)},"end");source.on("end",end),source.on("error",emitError),source.on("readable",setReadable)}}register(clone){this._source.done||this._trackers.add(clone)}unregister(clone){this._trackers.delete(clone)}readAt(pos){let item=null;return pos<this._history.length?item=this._history[pos]:!this._source.done&&(item=this._source.read())!==null&&(this._history[pos]=item),item}endsAt(pos){return this._source.done&&this._history.length===pos}}__name(HistoryReader,"HistoryReader");class WrappingIterator extends AsyncIterator2{constructor(source,opts){super(),this._source=null,this._destroySource=(opts==null?void 0:opts.destroySource)!==!1,isPromise(source)?(this._source=new AsyncIterator2,source.then(value=>{this._source=null,this.source=value}).catch(error=>this.emit("error",error))):source&&(this.source=source)}set source(value){let source=value;if(this._source!==null)throw new Error("The source cannot be changed after it has been set");if(isIterable(source)&&(source=source[Symbol.iterator]()),isIterator2(source)){let iterator=source;source=new events_1.EventEmitter,source.read=()=>{if(iterator!==null){let next;for(;!(next=iterator.next()).done;)if(next.value!==null)return next.value;iterator=null,this.close()}return null}}else source=ensureSourceAvailable(source);if(this.done){this._destroySource&&isFunction(source.destroy)&&source.destroy();return}source[exports.DESTINATION]=this,source.on("end",destinationClose),source.on("error",destinationEmitError2),source.on("readable",destinationSetReadable2),this._source=source,this.readable=source.readable!==!1}read(){if(this._source!==null&&this._source.readable!==!1){const item=this._source.read();if(item!==null)return item;this.readable=!1}return null}_end(destroy=!1){this._source!==null&&(this._source.removeListener("end",destinationClose),this._source.removeListener("error",destinationEmitError2),this._source.removeListener("readable",destinationSetReadable2),delete this._source[exports.DESTINATION],this._destroySource&&isFunction(this._source.destroy)&&this._source.destroy(),this._source=null),super._end(destroy)}}__name(WrappingIterator,"WrappingIterator"),exports.WrappingIterator=WrappingIterator;function wrap2(source,options){if(options&&("autoStart"in options||"optional"in options||"source"in options||"maxBufferSize"in options))return source&&!isEventEmitter(source)&&(source=new WrappingIterator(source)),new TransformIterator(source,options);if(!source)return empty();if(isPromise(source))return new WrappingIterator(source,options);if(source instanceof AsyncIterator2)return source;if(Array.isArray(source))return fromArray(source);if(isIterable(source)||isIterator2(source)||isEventEmitter(source))return new WrappingIterator(source,options);throw new TypeError(`Invalid source: ${source}`)}__name(wrap2,"wrap"),exports.wrap=wrap2;function empty(){return new EmptyIterator}__name(empty,"empty"),exports.empty=empty;function single(item){return new SingletonIterator(item)}__name(single,"single"),exports.single=single;function fromArray(items){return new ArrayIterator(items)}__name(fromArray,"fromArray"),exports.fromArray=fromArray;function fromIterator(source){return new WrappingIterator(source)}__name(fromIterator,"fromIterator"),exports.fromIterator=fromIterator;function fromIterable(source){return new WrappingIterator(source)}__name(fromIterable,"fromIterable"),exports.fromIterable=fromIterable;function union(sources){return new UnionIterator(sources)}__name(union,"union"),exports.union=union;function range(start,end,step){return new IntegerIterator({start,end,step})}__name(range,"range"),exports.range=range;function bind(fn,self2){return self2?fn.bind(self2):fn}__name(bind,"bind");function isFunction(object2){return typeof object2=="function"}__name(isFunction,"isFunction"),exports.isFunction=isFunction;function isEventEmitter(object2){return isFunction(object2==null?void 0:object2.on)}__name(isEventEmitter,"isEventEmitter"),exports.isEventEmitter=isEventEmitter;function isPromise(object2){return isFunction(object2==null?void 0:object2.then)}__name(isPromise,"isPromise"),exports.isPromise=isPromise;function isSourceExpression(object2){return object2&&(isEventEmitter(object2)||isPromise(object2)||isFunction(object2))}__name(isSourceExpression,"isSourceExpression"),exports.isSourceExpression=isSourceExpression;function isIterable(object2){return object2&&Symbol.iterator in object2}__name(isIterable,"isIterable"),exports.isIterable=isIterable;function isIterator2(object2){return isFunction(object2==null?void 0:object2.next)}__name(isIterator2,"isIterator"),exports.isIterator=isIterator2})(asynciterator);Object.defineProperty(ClosableTransformIterator$1,"__esModule",{value:!0});ClosableTransformIterator$1.ClosableTransformIterator=void 0;const asynciterator_1$q=asynciterator;class ClosableTransformIterator extends asynciterator_1$q.TransformIterator{constructor(source,options){super(source,options),this.onClose=options.onClose}_end(destroy){this.onClose(),super._end(destroy)}}__name(ClosableTransformIterator,"ClosableTransformIterator");ClosableTransformIterator$1.ClosableTransformIterator=ClosableTransformIterator;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperation$1,exports),__exportStar(ActorQueryOperationTyped$1,exports),__exportStar(ActorQueryOperationTypedMediated$1,exports),__exportStar(Bindings$2,exports),__exportStar(BusQueryOperation$1,exports),__exportStar(ClosableTransformIterator$1,exports)})(lib$2y);var MemoryPhysicalQueryPlanLogger$1={};Object.defineProperty(MemoryPhysicalQueryPlanLogger$1,"__esModule",{value:!0});MemoryPhysicalQueryPlanLogger$1.MemoryPhysicalQueryPlanLogger=void 0;const rdf_string_1$g=rdfString;class MemoryPhysicalQueryPlanLogger{constructor(){this.children=new Map}logOperation(logicalOperator,physicalOperator,node2,parentNode,actor,metadata){const planNode={actor,logicalOperator,physicalOperator,rawNode:node2,children:[],metadata};if(this.children.set(node2,planNode.children),this.rootNode){if(!parentNode)throw new Error("Detected more than one parent-less node");const children=this.children.get(parentNode);if(!children)throw new Error("Could not find parent node");children.push(planNode)}else{if(parentNode)throw new Error("No root node has been set yet, while a parent is being referenced");this.rootNode=planNode}}toJson(){return this.rootNode?this.planNodeToJson(this.rootNode):{}}planNodeToJson(node2){return{logical:node2.logicalOperator,physical:node2.physicalOperator,...this.getLogicalMetadata(node2.rawNode),...node2.metadata,...node2.children.length>0?{children:node2.children.map(child=>this.planNodeToJson(child))}:{}}}getLogicalMetadata(rawNode){if("type"in rawNode){const operation=rawNode;switch(operation.type){case"pattern":return{pattern:this.quadToString(operation)};case"project":return{variables:operation.variables.map(variable=>variable.value)}}}return{}}quadToString(quad){return`${(0,rdf_string_1$g.termToString)(quad.subject)} ${(0,rdf_string_1$g.termToString)(quad.predicate)} ${(0,rdf_string_1$g.termToString)(quad.object)}${quad.graph.termType==="DefaultGraph"?"":` ${(0,rdf_string_1$g.termToString)(quad.graph)}`}`}}__name(MemoryPhysicalQueryPlanLogger,"MemoryPhysicalQueryPlanLogger");MemoryPhysicalQueryPlanLogger$1.MemoryPhysicalQueryPlanLogger=MemoryPhysicalQueryPlanLogger;Object.defineProperty(QueryEngineBase$1,"__esModule",{value:!0});QueryEngineBase$1.QueryEngineBase=void 0;const bus_query_operation_1$L=lib$2y,context_entries_1$p=lib$2x,core_1$u=lib$2A,MemoryPhysicalQueryPlanLogger_1=MemoryPhysicalQueryPlanLogger$1;class QueryEngineBase{constructor(actorInitQuery){this.actorInitQuery=actorInitQuery,this.defaultFunctionArgumentsCache={}}async queryBindings(query,context2){return this.queryOfType(query,context2,"bindings")}async queryQuads(query,context2){return this.queryOfType(query,context2,"quads")}async queryBoolean(query,context2){return this.queryOfType(query,context2,"boolean")}async queryVoid(query,context2){return this.queryOfType(query,context2,"void")}async queryOfType(query,context2,expectedType){const result=await this.query(query,context2);if(result.resultType===expectedType)return await result.execute();throw new Error(`Query result type '${expectedType}' was expected, while '${result.resultType}' was found.`)}async query(query,context2){const output=await this.queryOrExplain(query,context2);if("explain"in output)throw new Error("Tried to explain a query when in query-only mode");return output}async explain(query,context2,explainMode){return context2.explain=explainMode,await this.queryOrExplain(query,context2)}async queryOrExplain(query,context2){context2=context2||{};for(const key in context2)this.actorInitQuery.contextKeyShortcuts[key]&&(context2[this.actorInitQuery.contextKeyShortcuts[key]]=context2[key],delete context2[key]);let actionContext=new core_1$u.ActionContext(context2),queryFormat={language:"sparql",version:"1.1"};actionContext.has(context_entries_1$p.KeysInitQuery.queryFormat)&&(queryFormat=actionContext.get(context_entries_1$p.KeysInitQuery.queryFormat),actionContext=actionContext.delete(context_entries_1$p.KeysInitQuery.queryFormat),queryFormat.language==="graphql"&&(actionContext=actionContext.setDefault(context_entries_1$p.KeysInitQuery.graphqlSingularizeVariables,{})));const baseIRI=actionContext.get(context_entries_1$p.KeysInitQuery.baseIRI);actionContext=actionContext.setDefault(context_entries_1$p.KeysInitQuery.queryTimestamp,new Date).setDefault(context_entries_1$p.KeysRdfResolveQuadPattern.sourceIds,new Map).setDefault(context_entries_1$p.KeysCore.log,this.actorInitQuery.logger).setDefault(context_entries_1$p.KeysInitQuery.functionArgumentsCache,this.defaultFunctionArgumentsCache).setDefault(context_entries_1$p.KeysRdfResolveQuadPattern.hypermediaSourcesAggregatedStores,new Map),actionContext=(await this.actorInitQuery.mediatorContextPreprocess.mediate({context:actionContext})).context;const explainMode=actionContext.get(context_entries_1$p.KeysInitQuery.explain);let operation;if(typeof query=="string"){actionContext=actionContext.set(context_entries_1$p.KeysInitQuery.queryString,query);const queryParseOutput=await this.actorInitQuery.mediatorQueryParse.mediate({context:actionContext,query,queryFormat,baseIRI});operation=queryParseOutput.operation,queryParseOutput.baseIRI&&(actionContext=actionContext.set(context_entries_1$p.KeysInitQuery.baseIRI,queryParseOutput.baseIRI))}else operation=query;if(explainMode==="parsed")return{explain:!0,type:explainMode,data:operation};actionContext.has(context_entries_1$p.KeysInitQuery.initialBindings)&&(operation=(0,bus_query_operation_1$L.materializeOperation)(operation,actionContext.get(context_entries_1$p.KeysInitQuery.initialBindings)),actionContext=actionContext.delete(context_entries_1$p.KeysInitQuery.queryString));const mediatorResult=await this.actorInitQuery.mediatorOptimizeQueryOperation.mediate({context:actionContext,operation});if(operation=mediatorResult.operation,actionContext=mediatorResult.context||actionContext,explainMode==="logical")return{explain:!0,type:explainMode,data:operation};actionContext=actionContext.set(context_entries_1$p.KeysInitQuery.query,operation);let physicalQueryPlanLogger;explainMode==="physical"&&(physicalQueryPlanLogger=new MemoryPhysicalQueryPlanLogger_1.MemoryPhysicalQueryPlanLogger,actionContext=actionContext.set(context_entries_1$p.KeysInitQuery.physicalQueryPlanLogger,physicalQueryPlanLogger));const output=await this.actorInitQuery.mediatorQueryOperation.mediate({context:actionContext,operation});output.context=actionContext;const finalOutput=QueryEngineBase.internalToFinalResult(output);if(physicalQueryPlanLogger){switch(finalOutput.resultType){case"bindings":await(await finalOutput.execute()).toArray();break;case"quads":await(await finalOutput.execute()).toArray();break;case"boolean":await finalOutput.execute();break;case"void":await finalOutput.execute();break}return{explain:!0,type:explainMode,data:physicalQueryPlanLogger.toJson()}}return finalOutput}async getResultMediaTypes(context2){return context2=core_1$u.ActionContext.ensureActionContext(context2),(await this.actorInitQuery.mediatorQueryResultSerializeMediaTypeCombiner.mediate({context:context2,mediaTypes:!0})).mediaTypes}async getResultMediaTypeFormats(context2){return context2=core_1$u.ActionContext.ensureActionContext(context2),(await this.actorInitQuery.mediatorQueryResultSerializeMediaTypeFormatCombiner.mediate({context:context2,mediaTypeFormats:!0})).mediaTypeFormats}async resultToString(queryResult,mediaType,context2){if(context2=core_1$u.ActionContext.ensureActionContext(context2),!mediaType)switch(queryResult.resultType){case"bindings":mediaType="application/json";break;case"quads":mediaType="application/trig";break;default:mediaType="simple";break}const handle={...await QueryEngineBase.finalToInternalResult(queryResult),context:context2};return(await this.actorInitQuery.mediatorQueryResultSerialize.mediate({context:context2,handle,handleMediaType:mediaType})).handle}invalidateHttpCache(url,context2){return context2=core_1$u.ActionContext.ensureActionContext(context2),this.actorInitQuery.mediatorHttpInvalidate.mediate({url,context:context2})}static internalToFinalResult(internalResult){switch(internalResult.type){case"bindings":return{resultType:"bindings",execute:async()=>internalResult.bindingsStream,metadata:async()=>await internalResult.metadata(),context:internalResult.context};case"quads":return{resultType:"quads",execute:async()=>internalResult.quadStream,metadata:async()=>await internalResult.metadata(),context:internalResult.context};case"boolean":return{resultType:"boolean",execute:async()=>internalResult.execute(),context:internalResult.context};case"void":return{resultType:"void",execute:async()=>internalResult.execute(),context:internalResult.context}}}static async finalToInternalResult(finalResult){switch(finalResult.resultType){case"bindings":return{type:"bindings",bindingsStream:await finalResult.execute(),metadata:async()=>await finalResult.metadata()};case"quads":return{type:"quads",quadStream:await finalResult.execute(),metadata:async()=>await finalResult.metadata()};case"boolean":return{type:"boolean",execute:()=>finalResult.execute()};case"void":return{type:"void",execute:()=>finalResult.execute()}}}}__name(QueryEngineBase,"QueryEngineBase");QueryEngineBase$1.QueryEngineBase=QueryEngineBase;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.QueryEngineBase=void 0,__exportStar(ActorInitQueryBase$1,exports),__exportStar(ActorInitQueryBrowser,exports);var QueryEngineBase_1=QueryEngineBase$1;Object.defineProperty(exports,"QueryEngineBase",{enumerable:!0,get:function(){return QueryEngineBase_1.QueryEngineBase}})})(indexBrowser);var lib$2u={},LoggerVoid$1={};Object.defineProperty(LoggerVoid$1,"__esModule",{value:!0});LoggerVoid$1.LoggerVoid=void 0;const types_1=lib$2z;class LoggerVoid extends types_1.Logger{debug(){}error(){}fatal(){}info(){}trace(){}warn(){}}__name(LoggerVoid,"LoggerVoid");LoggerVoid$1.LoggerVoid=LoggerVoid;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(LoggerVoid$1,exports)})(lib$2u);var lib$2t={},ActorContextPreprocessSourceToDestination$1={},lib$2s={},ActorContextPreprocess$1={};Object.defineProperty(ActorContextPreprocess$1,"__esModule",{value:!0});ActorContextPreprocess$1.ActorContextPreprocess=void 0;const core_1$t=lib$2A;class ActorContextPreprocess extends core_1$t.Actor{constructor(args){super(args)}}__name(ActorContextPreprocess,"ActorContextPreprocess");ActorContextPreprocess$1.ActorContextPreprocess=ActorContextPreprocess;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorContextPreprocess$1,exports)})(lib$2s);Object.defineProperty(ActorContextPreprocessSourceToDestination$1,"__esModule",{value:!0});ActorContextPreprocessSourceToDestination$1.ActorContextPreprocessSourceToDestination=void 0;const bus_context_preprocess_1=lib$2s,context_entries_1$o=lib$2x;class ActorContextPreprocessSourceToDestination extends bus_context_preprocess_1.ActorContextPreprocess{constructor(args){super(args)}async test(action){return!0}async run(action){if(action.context.get(context_entries_1$o.KeysRdfResolveQuadPattern.sources)&&!action.context.get(context_entries_1$o.KeysRdfUpdateQuads.destination)){const sources=action.context.get(context_entries_1$o.KeysRdfResolveQuadPattern.sources);if(sources.length===1)return{context:action.context.set(context_entries_1$o.KeysRdfUpdateQuads.destination,sources[0])}}return action}}__name(ActorContextPreprocessSourceToDestination,"ActorContextPreprocessSourceToDestination");ActorContextPreprocessSourceToDestination$1.ActorContextPreprocessSourceToDestination=ActorContextPreprocessSourceToDestination;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorContextPreprocessSourceToDestination$1,exports)})(lib$2t);var lib$2r={},MediatorCombinePipeline$1={};Object.defineProperty(MediatorCombinePipeline$1,"__esModule",{value:!0});MediatorCombinePipeline$1.MediatorCombinePipeline=void 0;const core_1$s=lib$2A;class MediatorCombinePipeline extends core_1$s.Mediator{constructor(args){super(args)}async mediate(action){let testResults;try{testResults=this.publish(action)}catch{return action}if(this.filterErrors){const _testResults=[];for(const result of testResults)try{await result.reply,_testResults.push(result)}catch{}testResults=_testResults}if(testResults=await Promise.all(testResults.map(async({actor,reply})=>({actor,reply:await reply}))),this.order){const getOrder=__name(elem=>{const value=this.field?elem[this.field]:elem;if(typeof value!="number")throw new Error("Cannot order elements that are not numbers.");return value},"getOrder");testResults=testResults.sort((actor1,actor2)=>(this.order==="increasing"?1:-1)*(getOrder(actor1.reply)-getOrder(actor2.reply)))}let handle=action;for(const{actor}of testResults)handle={...handle,...await actor.runObservable(handle)};return handle}mediateWith(){throw new Error("Method not supported.")}}__name(MediatorCombinePipeline,"MediatorCombinePipeline");MediatorCombinePipeline$1.MediatorCombinePipeline=MediatorCombinePipeline;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(MediatorCombinePipeline$1,exports)})(lib$2r);var lib$2q={},ActorHashBindingsSha1$1={},lib$2p={},ActorHashBindings$1={};Object.defineProperty(ActorHashBindings$1,"__esModule",{value:!0});ActorHashBindings$1.ActorHashBindings=void 0;const core_1$r=lib$2A;class ActorHashBindings extends core_1$r.Actor{constructor(args){super(args)}}__name(ActorHashBindings,"ActorHashBindings");ActorHashBindings$1.ActorHashBindings=ActorHashBindings;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorHashBindings$1,exports)})(lib$2p);var canonicalize$3=__name(function serialize(object2){if(typeof object2=="number"&&isNaN(object2))throw new Error("NaN is not allowed");if(typeof object2=="number"&&!isFinite(object2))throw new Error("Infinity is not allowed");return object2===null||typeof object2!="object"?JSON.stringify(object2):object2.toJSON instanceof Function?serialize(object2.toJSON()):Array.isArray(object2)?`[${object2.reduce((t,cv,ci)=>`${t}${ci===0?"":","}${serialize(cv===void 0||typeof cv=="symbol"?null:cv)}`,"")}]`:`{${Object.keys(object2).sort().reduce((t,cv)=>{if(object2[cv]===void 0||typeof object2[cv]=="symbol")return t;const comma=t.length===0?"":",";return`${t}${comma}${serialize(cv)}:${serialize(object2[cv])}`},"")}}`},"serialize");Object.defineProperty(ActorHashBindingsSha1$1,"__esModule",{value:!0});ActorHashBindingsSha1$1.ActorHashBindingsSha1=void 0;const bus_hash_bindings_1=lib$2p,hash_js_1$1=hash,rdf_string_1$f=rdfString,canonicalize$2=canonicalize$3;class ActorHashBindingsSha1 extends bus_hash_bindings_1.ActorHashBindings{async test(action){if(!action.allowHashCollisions)throw new Error(`Actor ${this.name} can not provide hash functions without hash collisions`);return!0}async run(action){return{hashFunction:bindings=>(0,hash_js_1$1.sha1)().update(canonicalize$2(Object.fromEntries([...bindings].map(([key,value])=>[(0,rdf_string_1$f.termToString)(key),(0,rdf_string_1$f.termToString)(value)])))).digest("hex"),hashCollisions:!0}}}__name(ActorHashBindingsSha1,"ActorHashBindingsSha1");ActorHashBindingsSha1$1.ActorHashBindingsSha1=ActorHashBindingsSha1;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorHashBindingsSha1$1,exports)})(lib$2q);var lib$2o={},MediatorRace$1={};Object.defineProperty(MediatorRace$1,"__esModule",{value:!0});MediatorRace$1.MediatorRace=void 0;const core_1$q=lib$2A;class MediatorRace extends core_1$q.Mediator{constructor(args){super(args)}mediateWith(action,testResults){return new Promise((resolve2,reject)=>{const errors=[];for(const testResult of testResults)testResult.reply.then(()=>{resolve2(testResult.actor)}).catch(error=>{errors.push(error),errors.length===testResults.length&&reject(new Error(`${this.name} mediated over all rejecting actors:
${errors.map(subError=>subError.message).join(`
`)}`))})})}}__name(MediatorRace,"MediatorRace");MediatorRace$1.MediatorRace=MediatorRace;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(MediatorRace$1,exports)})(lib$2o);var lib$2n={},ActorOptimizeQueryOperationJoinBgp$1={},lib$2m={},ActorOptimizeQueryOperation$1={};Object.defineProperty(ActorOptimizeQueryOperation$1,"__esModule",{value:!0});ActorOptimizeQueryOperation$1.ActorOptimizeQueryOperation=void 0;const core_1$p=lib$2A;class ActorOptimizeQueryOperation extends core_1$p.Actor{constructor(args){super(args)}}__name(ActorOptimizeQueryOperation,"ActorOptimizeQueryOperation");ActorOptimizeQueryOperation$1.ActorOptimizeQueryOperation=ActorOptimizeQueryOperation;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorOptimizeQueryOperation$1,exports)})(lib$2m);Object.defineProperty(ActorOptimizeQueryOperationJoinBgp$1,"__esModule",{value:!0});ActorOptimizeQueryOperationJoinBgp$1.ActorOptimizeQueryOperationJoinBgp=void 0;const bus_optimize_query_operation_1$2=lib$2m,sparqlalgebrajs_1$z=sparqlalgebrajs;class ActorOptimizeQueryOperationJoinBgp extends bus_optimize_query_operation_1$2.ActorOptimizeQueryOperation{async test(action){return!0}async run(action){return{operation:sparqlalgebrajs_1$z.Util.mapOperation(action.operation,{join(op,factory2){return op.input.every(subInput=>subInput.type==="bgp")?{recurse:!1,result:factory2.createBgp(op.input.flatMap(subInput=>subInput.patterns))}:{recurse:!1,result:op}}}),context:action.context}}}__name(ActorOptimizeQueryOperationJoinBgp,"ActorOptimizeQueryOperationJoinBgp");ActorOptimizeQueryOperationJoinBgp$1.ActorOptimizeQueryOperationJoinBgp=ActorOptimizeQueryOperationJoinBgp;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorOptimizeQueryOperationJoinBgp$1,exports)})(lib$2n);var lib$2l={},ActorOptimizeQueryOperationBgpToJoin$1={};Object.defineProperty(ActorOptimizeQueryOperationBgpToJoin$1,"__esModule",{value:!0});ActorOptimizeQueryOperationBgpToJoin$1.ActorOptimizeQueryOperationBgpToJoin=void 0;const bus_optimize_query_operation_1$1=lib$2m,sparqlalgebrajs_1$y=sparqlalgebrajs;class ActorOptimizeQueryOperationBgpToJoin extends bus_optimize_query_operation_1$1.ActorOptimizeQueryOperation{async test(action){return!0}async run(action){return{operation:sparqlalgebrajs_1$y.Util.mapOperation(action.operation,{bgp(op,factory2){return{recurse:!1,result:factory2.createJoin(op.patterns)}}}),context:action.context}}}__name(ActorOptimizeQueryOperationBgpToJoin,"ActorOptimizeQueryOperationBgpToJoin");ActorOptimizeQueryOperationBgpToJoin$1.ActorOptimizeQueryOperationBgpToJoin=ActorOptimizeQueryOperationBgpToJoin;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorOptimizeQueryOperationBgpToJoin$1,exports)})(lib$2l);var lib$2k={},ActorOptimizeQueryOperationJoinConnected$1={};Object.defineProperty(ActorOptimizeQueryOperationJoinConnected$1,"__esModule",{value:!0});ActorOptimizeQueryOperationJoinConnected$1.ActorOptimizeQueryOperationJoinConnected=void 0;const bus_optimize_query_operation_1=lib$2m,sparqlalgebrajs_1$x=sparqlalgebrajs;class ActorOptimizeQueryOperationJoinConnected extends bus_optimize_query_operation_1.ActorOptimizeQueryOperation{async test(action){return!0}async run(action){return{operation:sparqlalgebrajs_1$x.Util.mapOperation(action.operation,{join(op,factory2){return{recurse:!1,result:ActorOptimizeQueryOperationJoinConnected.cluster(op,factory2)}}}),context:action.context}}static cluster(op,factory2){const initialClusters=op.input.map(subOp=>({inScopeVariables:Object.fromEntries(sparqlalgebrajs_1$x.Util.inScopeVariables(subOp).map(variable=>[variable.value,!0])),entries:[subOp]}));let oldClusters,newClusters=initialClusters;do oldClusters=newClusters,newClusters=ActorOptimizeQueryOperationJoinConnected.clusterIteration(oldClusters);while(oldClusters.length!==newClusters.length);const subJoins=newClusters.map(cluster=>factory2.createJoin(cluster.entries));return subJoins.length===1?subJoins[0]:factory2.createJoin(subJoins,!1)}static clusterIteration(oldCluster){const newClusters=[];for(const entry of oldCluster){let joined=!1;for(const newEntry of newClusters)if(ActorOptimizeQueryOperationJoinConnected.haveOverlappingVariables(entry.inScopeVariables,newEntry.inScopeVariables)){newEntry.entries=[...newEntry.entries,...entry.entries],newEntry.inScopeVariables={...newEntry.inScopeVariables,...entry.inScopeVariables},joined=!0;break}joined||newClusters.push({inScopeVariables:entry.inScopeVariables,entries:entry.entries})}return newClusters}static haveOverlappingVariables(variablesA,variablesB){for(const variableA of Object.keys(variablesA))if(variablesB[variableA])return!0;return!1}}__name(ActorOptimizeQueryOperationJoinConnected,"ActorOptimizeQueryOperationJoinConnected");ActorOptimizeQueryOperationJoinConnected$1.ActorOptimizeQueryOperationJoinConnected=ActorOptimizeQueryOperationJoinConnected;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorOptimizeQueryOperationJoinConnected$1,exports)})(lib$2k);var lib$2j={},MediatorNumber$1={};Object.defineProperty(MediatorNumber$1,"__esModule",{value:!0});MediatorNumber$1.MediatorNumber=void 0;const core_1$o=lib$2A;class MediatorNumber extends core_1$o.Mediator{constructor(args){super(args),this.indexPicker=this.createIndexPicker()}createIndexPicker(){switch(this.type){case"min":return tests=>tests.reduce((prev,curr,i)=>{const val=this.getOrDefault(curr[this.field],Number.POSITIVE_INFINITY);return val!==null&&(Number.isNaN(prev[0])||prev[0]>val)?[val,i]:prev},[Number.NaN,-1])[1];case"max":return tests=>tests.reduce((prev,curr,i)=>{const val=this.getOrDefault(curr[this.field],Number.NEGATIVE_INFINITY);return val!==null&&(Number.isNaN(prev[0])||prev[0]<val)?[val,i]:prev},[Number.NaN,-1])[1];default:throw new Error(`No valid "type" value was given, must be either 'min' or 'max', but got: ${this.type}`)}}getOrDefault(value,defaultValue){return value===void 0?defaultValue:value}async mediateWith(action,testResults){let promises=testResults.map(({reply})=>reply);const errors=[];if(this.ignoreErrors){const dummy={};dummy[this.field]=null,promises=promises.map(promise=>promise.catch(error=>(errors.push(error),dummy)))}const results=await Promise.all(promises),index=this.indexPicker(results);if(index<0)throw new Error(`All actors rejected their test in ${this.name}
${errors.map(error=>error.message).join(`
`)}`);return testResults[index].actor}}__name(MediatorNumber,"MediatorNumber");MediatorNumber$1.MediatorNumber=MediatorNumber;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(MediatorNumber$1,exports)})(lib$2j);var lib$2i={},ActorQueryOperationValues$1={},lib$2h={},MetadataValidationState$1={};Object.defineProperty(MetadataValidationState$1,"__esModule",{value:!0});MetadataValidationState$1.MetadataValidationState=void 0;class MetadataValidationState{constructor(){this.invalidateListeners=[],this.valid=!0}addInvalidateListener(listener){this.invalidateListeners.push(listener)}invalidate(){if(this.valid){this.valid=!1;for(const invalidateListener of this.invalidateListeners)invalidateListener()}}}__name(MetadataValidationState,"MetadataValidationState");MetadataValidationState$1.MetadataValidationState=MetadataValidationState;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(MetadataValidationState$1,exports)})(lib$2h);Object.defineProperty(ActorQueryOperationValues$1,"__esModule",{value:!0});ActorQueryOperationValues$1.ActorQueryOperationValues=void 0;const bindings_factory_1$e=lib$2v,bus_query_operation_1$K=lib$2y,metadata_1$c=lib$2h,asynciterator_1$p=asynciterator,rdf_data_factory_1$w=rdfDataFactory,BF$c=new bindings_factory_1$e.BindingsFactory,DF$k=new rdf_data_factory_1$w.DataFactory;class ActorQueryOperationValues extends bus_query_operation_1$K.ActorQueryOperationTyped{constructor(args){super(args,"values")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){const bindingsStream=new asynciterator_1$p.ArrayIterator(operation.bindings.map(x=>BF$c.bindings(Object.entries(x).map(([key,value])=>[DF$k.variable(key.slice(1)),value])))),variables2=operation.variables;return{type:"bindings",bindingsStream,metadata:__name(()=>Promise.resolve({state:new metadata_1$c.MetadataValidationState,cardinality:{type:"exact",value:operation.bindings.length},canContainUndefs:operation.bindings.some(bindings=>variables2.some(variable=>!(`?${variable.value}`in bindings))),variables:variables2}),"metadata")}}}__name(ActorQueryOperationValues,"ActorQueryOperationValues");ActorQueryOperationValues$1.ActorQueryOperationValues=ActorQueryOperationValues;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationValues$1,exports)})(lib$2i);var lib$2g={},ActorQueryParseSparql$1={},lib$2f={},ActorQueryParse$1={};Object.defineProperty(ActorQueryParse$1,"__esModule",{value:!0});ActorQueryParse$1.ActorQueryParse=void 0;const core_1$n=lib$2A;class ActorQueryParse extends core_1$n.Actor{constructor(args){super(args)}}__name(ActorQueryParse,"ActorQueryParse");ActorQueryParse$1.ActorQueryParse=ActorQueryParse;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryParse$1,exports)})(lib$2f);Object.defineProperty(ActorQueryParseSparql$1,"__esModule",{value:!0});ActorQueryParseSparql$1.ActorQueryParseSparql=void 0;const bus_query_parse_1$1=lib$2f,sparqlalgebrajs_1$w=sparqlalgebrajs,sparqljs_1$3=sparql$1;class ActorQueryParseSparql extends bus_query_parse_1$1.ActorQueryParse{constructor(args){super(args),this.prefixes=Object.freeze(this.prefixes)}async test(action){if(action.queryFormat&&action.queryFormat.language!=="sparql")throw new Error("This actor can only parse SPARQL queries");return!0}async run(action){const parsedSyntax=new sparqljs_1$3.Parser({prefixes:this.prefixes,baseIRI:action.baseIRI,sparqlStar:!0}).parse(action.query);return{baseIRI:parsedSyntax.type==="query"?parsedSyntax.base:void 0,operation:(0,sparqlalgebrajs_1$w.translate)(parsedSyntax,{quads:!0,prefixes:this.prefixes,blankToVariable:!0,baseIRI:action.baseIRI})}}}__name(ActorQueryParseSparql,"ActorQueryParseSparql");ActorQueryParseSparql$1.ActorQueryParseSparql=ActorQueryParseSparql;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryParseSparql$1,exports)})(lib$2g);var lib$2e={},ActorQueryParseGraphql$1={},graphqlToSparql={},handler={},directivenode={},DirectiveNodeHandlerAdapter$1={};Object.defineProperty(DirectiveNodeHandlerAdapter$1,"__esModule",{value:!0});DirectiveNodeHandlerAdapter$1.DirectiveNodeHandlerAdapter=void 0;class DirectiveNodeHandlerAdapter{constructor(targetKind,util2,settings){this.targetKind=targetKind,this.util=util2,this.settings=settings}getDirectiveConditionalValue(directive,convertContext){const arg=this.util.getArgument(directive.arguments,"if");if(!arg)throw new Error(`The directive ${directive.name.value} is missing an if-argument.`);const subValue=this.util.handleNodeValue(arg.value,arg.name.value,convertContext);if(subValue.terms.length!==1)throw new Error(`Can not apply the directive ${directive.name.value} with a list.`);return subValue.terms[0]}isDirectiveScopeAll(directive){const scopeArg=this.util.getArgument(directive.arguments,"scope");return scopeArg&&scopeArg.value.kind==="EnumValue"&&scopeArg.value.value==="all"}}__name(DirectiveNodeHandlerAdapter,"DirectiveNodeHandlerAdapter");DirectiveNodeHandlerAdapter$1.DirectiveNodeHandlerAdapter=DirectiveNodeHandlerAdapter;var DirectiveNodeHandlerInclude$1={};Object.defineProperty(DirectiveNodeHandlerInclude$1,"__esModule",{value:!0});DirectiveNodeHandlerInclude$1.DirectiveNodeHandlerInclude=void 0;const DirectiveNodeHandlerAdapter_1$4=DirectiveNodeHandlerAdapter$1;class DirectiveNodeHandlerInclude extends DirectiveNodeHandlerAdapter_1$4.DirectiveNodeHandlerAdapter{constructor(util2,settings){super("include",util2,settings)}handle(directiveContext,convertContext){const val=this.getDirectiveConditionalValue(directiveContext.directive,convertContext);return val.termType==="Literal"&&val.value==="false"?{ignore:!0}:{}}}__name(DirectiveNodeHandlerInclude,"DirectiveNodeHandlerInclude");DirectiveNodeHandlerInclude$1.DirectiveNodeHandlerInclude=DirectiveNodeHandlerInclude;var DirectiveNodeHandlerOptional$1={};Object.defineProperty(DirectiveNodeHandlerOptional$1,"__esModule",{value:!0});DirectiveNodeHandlerOptional$1.DirectiveNodeHandlerOptional=void 0;const DirectiveNodeHandlerAdapter_1$3=DirectiveNodeHandlerAdapter$1;class DirectiveNodeHandlerOptional extends DirectiveNodeHandlerAdapter_1$3.DirectiveNodeHandlerAdapter{constructor(util2,settings){super("optional",util2,settings)}handle(directiveContext,convertContext){return{operationOverrider:operation=>this.util.operationFactory.createLeftJoin(this.util.operationFactory.createBgp([]),operation)}}}__name(DirectiveNodeHandlerOptional,"DirectiveNodeHandlerOptional");DirectiveNodeHandlerOptional$1.DirectiveNodeHandlerOptional=DirectiveNodeHandlerOptional;var DirectiveNodeHandlerPlural$1={},IConvertContext={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.SingularizeState=void 0,function(SingularizeState){SingularizeState[SingularizeState.SINGLE=0]="SINGLE",SingularizeState[SingularizeState.PLURAL=1]="PLURAL"}(exports.SingularizeState||(exports.SingularizeState={}))})(IConvertContext);Object.defineProperty(DirectiveNodeHandlerPlural$1,"__esModule",{value:!0});DirectiveNodeHandlerPlural$1.DirectiveNodeHandlerPlural=void 0;const IConvertContext_1$3=IConvertContext,DirectiveNodeHandlerAdapter_1$2=DirectiveNodeHandlerAdapter$1;class DirectiveNodeHandlerPlural extends DirectiveNodeHandlerAdapter_1$2.DirectiveNodeHandlerAdapter{constructor(util2,settings){super("plural",util2,settings)}handle(directiveContext,convertContext){return this.isDirectiveScopeAll(directiveContext.directive)&&(convertContext.singularizeState=IConvertContext_1$3.SingularizeState.PLURAL),delete convertContext.singularizeVariables[this.util.nameToVariable(directiveContext.fieldLabel,convertContext).value],{}}}__name(DirectiveNodeHandlerPlural,"DirectiveNodeHandlerPlural");DirectiveNodeHandlerPlural$1.DirectiveNodeHandlerPlural=DirectiveNodeHandlerPlural;var DirectiveNodeHandlerSingle$1={};Object.defineProperty(DirectiveNodeHandlerSingle$1,"__esModule",{value:!0});DirectiveNodeHandlerSingle$1.DirectiveNodeHandlerSingle=void 0;const IConvertContext_1$2=IConvertContext,DirectiveNodeHandlerAdapter_1$1=DirectiveNodeHandlerAdapter$1;class DirectiveNodeHandlerSingle extends DirectiveNodeHandlerAdapter_1$1.DirectiveNodeHandlerAdapter{constructor(util2,settings){super("single",util2,settings)}handle(directiveContext,convertContext){return this.isDirectiveScopeAll(directiveContext.directive)&&(convertContext.singularizeState=IConvertContext_1$2.SingularizeState.SINGLE),convertContext.singularizeVariables[this.util.nameToVariable(directiveContext.fieldLabel,convertContext).value]=!0,{}}}__name(DirectiveNodeHandlerSingle,"DirectiveNodeHandlerSingle");DirectiveNodeHandlerSingle$1.DirectiveNodeHandlerSingle=DirectiveNodeHandlerSingle;var DirectiveNodeHandlerSkip$1={};Object.defineProperty(DirectiveNodeHandlerSkip$1,"__esModule",{value:!0});DirectiveNodeHandlerSkip$1.DirectiveNodeHandlerSkip=void 0;const DirectiveNodeHandlerAdapter_1=DirectiveNodeHandlerAdapter$1;class DirectiveNodeHandlerSkip extends DirectiveNodeHandlerAdapter_1.DirectiveNodeHandlerAdapter{constructor(util2,settings){super("skip",util2,settings)}handle(directiveContext,convertContext){const val=this.getDirectiveConditionalValue(directiveContext.directive,convertContext);return val.termType==="Literal"&&val.value==="true"?{ignore:!0}:{}}}__name(DirectiveNodeHandlerSkip,"DirectiveNodeHandlerSkip");DirectiveNodeHandlerSkip$1.DirectiveNodeHandlerSkip=DirectiveNodeHandlerSkip;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(DirectiveNodeHandlerAdapter$1,exports),__exportStar(DirectiveNodeHandlerInclude$1,exports),__exportStar(DirectiveNodeHandlerOptional$1,exports),__exportStar(DirectiveNodeHandlerPlural$1,exports),__exportStar(DirectiveNodeHandlerSingle$1,exports),__exportStar(DirectiveNodeHandlerSkip$1,exports)})(directivenode);var valuenode={},NodeValueHandlerAdapter$1={};Object.defineProperty(NodeValueHandlerAdapter$1,"__esModule",{value:!0});NodeValueHandlerAdapter$1.NodeValueHandlerAdapter=void 0;class NodeValueHandlerAdapter{constructor(targetKind,util2,settings){this.targetKind=targetKind,this.util=util2,this.settings=settings}}__name(NodeValueHandlerAdapter,"NodeValueHandlerAdapter");NodeValueHandlerAdapter$1.NodeValueHandlerAdapter=NodeValueHandlerAdapter;var NodeValueHandlerBoolean$1={};Object.defineProperty(NodeValueHandlerBoolean$1,"__esModule",{value:!0});NodeValueHandlerBoolean$1.NodeValueHandlerBoolean=void 0;const NodeValueHandlerAdapter_1$8=NodeValueHandlerAdapter$1;class NodeValueHandlerBoolean extends NodeValueHandlerAdapter_1$8.NodeValueHandlerAdapter{constructor(util2,settings){super("BooleanValue",util2,settings),this.datatype=this.util.dataFactory.namedNode("http://www.w3.org/2001/XMLSchema#boolean")}handle(valueNode,fieldName,convertContext){return{terms:[this.util.dataFactory.literal(valueNode.value?"true":"false",this.datatype)]}}}__name(NodeValueHandlerBoolean,"NodeValueHandlerBoolean");NodeValueHandlerBoolean$1.NodeValueHandlerBoolean=NodeValueHandlerBoolean;var NodeValueHandlerEnum$1={};Object.defineProperty(NodeValueHandlerEnum$1,"__esModule",{value:!0});NodeValueHandlerEnum$1.NodeValueHandlerEnum=void 0;const NodeValueHandlerAdapter_1$7=NodeValueHandlerAdapter$1;class NodeValueHandlerEnum extends NodeValueHandlerAdapter_1$7.NodeValueHandlerAdapter{constructor(util2,settings){super("EnumValue",util2,settings)}handle(valueNode,fieldName,convertContext){return{terms:[this.util.valueToNamedNode(valueNode.value,convertContext.context)]}}}__name(NodeValueHandlerEnum,"NodeValueHandlerEnum");NodeValueHandlerEnum$1.NodeValueHandlerEnum=NodeValueHandlerEnum;var NodeValueHandlerFloat$1={};Object.defineProperty(NodeValueHandlerFloat$1,"__esModule",{value:!0});NodeValueHandlerFloat$1.NodeValueHandlerFloat=void 0;const NodeValueHandlerAdapter_1$6=NodeValueHandlerAdapter$1;class NodeValueHandlerFloat extends NodeValueHandlerAdapter_1$6.NodeValueHandlerAdapter{constructor(util2,settings){super("FloatValue",util2,settings),this.datatype=this.util.dataFactory.namedNode("http://www.w3.org/2001/XMLSchema#float")}handle(valueNode,fieldName,convertContext){return{terms:[this.util.dataFactory.literal(valueNode.value,this.datatype)]}}}__name(NodeValueHandlerFloat,"NodeValueHandlerFloat");NodeValueHandlerFloat$1.NodeValueHandlerFloat=NodeValueHandlerFloat;var NodeValueHandlerInt$1={};Object.defineProperty(NodeValueHandlerInt$1,"__esModule",{value:!0});NodeValueHandlerInt$1.NodeValueHandlerInt=void 0;const NodeValueHandlerAdapter_1$5=NodeValueHandlerAdapter$1;class NodeValueHandlerInt extends NodeValueHandlerAdapter_1$5.NodeValueHandlerAdapter{constructor(util2,settings){super("IntValue",util2,settings),this.datatype=this.util.dataFactory.namedNode("http://www.w3.org/2001/XMLSchema#integer")}handle(valueNode,fieldName,convertContext){return{terms:[this.util.dataFactory.literal(valueNode.value,this.datatype)]}}}__name(NodeValueHandlerInt,"NodeValueHandlerInt");NodeValueHandlerInt$1.NodeValueHandlerInt=NodeValueHandlerInt;var NodeValueHandlerList$1={};Object.defineProperty(NodeValueHandlerList$1,"__esModule",{value:!0});NodeValueHandlerList$1.NodeValueHandlerList=void 0;const NodeValueHandlerAdapter_1$4=NodeValueHandlerAdapter$1;class NodeValueHandlerList extends NodeValueHandlerAdapter_1$4.NodeValueHandlerAdapter{constructor(util2,settings){super("ListValue",util2,settings),this.nodeFirst=this.util.dataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#first"),this.nodeRest=this.util.dataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"),this.nodeNil=this.util.dataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#nil")}handle(valueNode,fieldName,convertContext){const listTerms=[];let auxiliaryPatterns=[];for(const v of valueNode.values){const subValue=this.util.handleNodeValue(v,fieldName,convertContext);for(const term of subValue.terms)listTerms.push(term);subValue.auxiliaryPatterns&&(auxiliaryPatterns=auxiliaryPatterns.concat(subValue.auxiliaryPatterns))}if(this.settings.arraysToRdfLists){const firstListNode=this.util.dataFactory.blankNode();let listNode=firstListNode,remaining=listTerms.length;for(const term of listTerms){auxiliaryPatterns.push(this.util.operationFactory.createPattern(listNode,this.nodeFirst,term,convertContext.graph));const nextListNode=--remaining===0?this.nodeNil:this.util.dataFactory.blankNode();auxiliaryPatterns.push(this.util.operationFactory.createPattern(listNode,this.nodeRest,nextListNode,convertContext.graph)),listNode=nextListNode}return{terms:[firstListNode],auxiliaryPatterns}}else return{terms:listTerms,auxiliaryPatterns}}}__name(NodeValueHandlerList,"NodeValueHandlerList");NodeValueHandlerList$1.NodeValueHandlerList=NodeValueHandlerList;var NodeValueHandlerNull$1={};Object.defineProperty(NodeValueHandlerNull$1,"__esModule",{value:!0});NodeValueHandlerNull$1.NodeValueHandlerNull=void 0;const NodeValueHandlerAdapter_1$3=NodeValueHandlerAdapter$1;class NodeValueHandlerNull extends NodeValueHandlerAdapter_1$3.NodeValueHandlerAdapter{constructor(util2,settings){super("NullValue",util2,settings),this.nil=this.util.dataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#nil")}handle(valueNode,fieldName,convertContext){return{terms:[this.nil]}}}__name(NodeValueHandlerNull,"NodeValueHandlerNull");NodeValueHandlerNull$1.NodeValueHandlerNull=NodeValueHandlerNull;var NodeValueHandlerObject$1={};Object.defineProperty(NodeValueHandlerObject$1,"__esModule",{value:!0});NodeValueHandlerObject$1.NodeValueHandlerObject=void 0;const NodeValueHandlerAdapter_1$2=NodeValueHandlerAdapter$1;class NodeValueHandlerObject extends NodeValueHandlerAdapter_1$2.NodeValueHandlerAdapter{constructor(util2,settings){super("ObjectValue",util2,settings)}handle(valueNode,fieldName,convertContext){const subject2=this.util.dataFactory.blankNode();let auxiliaryObjectPatterns=[];for(const field of valueNode.fields){const subValue=this.util.handleNodeValue(field.value,fieldName,convertContext);for(const term of subValue.terms)auxiliaryObjectPatterns.push(this.util.createQuadPattern(subject2,field.name,term,convertContext.graph,convertContext.context));subValue.auxiliaryPatterns&&(auxiliaryObjectPatterns=auxiliaryObjectPatterns.concat(subValue.auxiliaryPatterns))}return{terms:[subject2],auxiliaryPatterns:auxiliaryObjectPatterns}}}__name(NodeValueHandlerObject,"NodeValueHandlerObject");NodeValueHandlerObject$1.NodeValueHandlerObject=NodeValueHandlerObject;var NodeValueHandlerString$1={};Object.defineProperty(NodeValueHandlerString$1,"__esModule",{value:!0});NodeValueHandlerString$1.NodeValueHandlerString=void 0;const NodeValueHandlerAdapter_1$1=NodeValueHandlerAdapter$1;class NodeValueHandlerString extends NodeValueHandlerAdapter_1$1.NodeValueHandlerAdapter{constructor(util2,settings){super("StringValue",util2,settings)}handle(valueNode,fieldName,convertContext){const contextEntry=convertContext.context.getContextRaw()[fieldName];let language2,datatype2;return contextEntry&&typeof contextEntry!="string"&&(contextEntry["@language"]?language2=contextEntry["@language"]:contextEntry["@type"]&&(datatype2=this.util.dataFactory.namedNode(contextEntry["@type"]))),{terms:[this.util.dataFactory.literal(valueNode.value,language2||datatype2)]}}}__name(NodeValueHandlerString,"NodeValueHandlerString");NodeValueHandlerString$1.NodeValueHandlerString=NodeValueHandlerString;var NodeValueHandlerVariable$1={};Object.defineProperty(NodeValueHandlerVariable$1,"__esModule",{value:!0});NodeValueHandlerVariable$1.NodeValueHandlerVariable=void 0;const NodeValueHandlerAdapter_1=NodeValueHandlerAdapter$1;class NodeValueHandlerVariable extends NodeValueHandlerAdapter_1.NodeValueHandlerAdapter{constructor(util2,settings){super("Variable",util2,settings)}handle(valueNode,fieldName,convertContext){const id=valueNode.name.value,value=convertContext.variablesDict[id],meta=convertContext.variablesMetaDict[id];if(!value){if(!convertContext.ignoreUnknownVariables&&(!meta||meta.mandatory))throw new Error(`Undefined variable: ${id}`);{const variable=this.util.dataFactory.variable(id);return convertContext.terminalVariables.map(v=>v.value).indexOf(id)<0&&convertContext.terminalVariables.push(variable),{terms:[variable]}}}if(value.kind==="Variable")throw new Error(`Variable refers to another variable: ${id}`);if(meta)if(meta.list){if(value.kind!=="ListValue")throw new Error(`Expected a list, but got ${value.kind} for ${id}`);if(meta.type){const listValue=value;for(const v of listValue.values)if(v.kind!==meta.type)throw new Error(`Expected ${meta.type}, but got ${v.kind} for ${id}`)}}else meta.type;return this.util.handleNodeValue(value,fieldName,convertContext)}}__name(NodeValueHandlerVariable,"NodeValueHandlerVariable");NodeValueHandlerVariable$1.NodeValueHandlerVariable=NodeValueHandlerVariable;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(NodeValueHandlerAdapter$1,exports),__exportStar(NodeValueHandlerBoolean$1,exports),__exportStar(NodeValueHandlerEnum$1,exports),__exportStar(NodeValueHandlerFloat$1,exports),__exportStar(NodeValueHandlerInt$1,exports),__exportStar(NodeValueHandlerList$1,exports),__exportStar(NodeValueHandlerNull$1,exports),__exportStar(NodeValueHandlerObject$1,exports),__exportStar(NodeValueHandlerString$1,exports),__exportStar(NodeValueHandlerVariable$1,exports)})(valuenode);var NodeHandlerAdapter$1={};Object.defineProperty(NodeHandlerAdapter$1,"__esModule",{value:!0});NodeHandlerAdapter$1.NodeHandlerAdapter=void 0;class NodeHandlerAdapter{constructor(targetKind,util2,settings){this.targetKind=targetKind,this.util=util2,this.settings=settings}getNodeQuadContextSelectionSet(selectionSet,fieldLabel,convertContext){const nodeQuadContext={};if(selectionSet){for(const selectionNode of selectionSet.selections)if(selectionNode.kind==="Field"){const fieldNode=selectionNode;this.handleNodeQuadContextField(fieldNode,convertContext,nodeQuadContext,"id","subject"),this.handleNodeQuadContextField(fieldNode,convertContext,nodeQuadContext,"graph","graph")}}return nodeQuadContext}handleNodeQuadContextField(fieldNode,convertContext,nodeQuadContext,fieldName,nodeQuadContextKey){if(!nodeQuadContext[nodeQuadContextKey]&&fieldNode.name.value===fieldName){if(!nodeQuadContext[nodeQuadContextKey]){const argument=this.util.getArgument(fieldNode.arguments,"_");if(argument){const valueOutput=this.util.handleNodeValue(argument.value,fieldNode.name.value,convertContext);if(valueOutput.terms.length!==1)throw new Error(`Only single values can be set as ${fieldName}, but got ${valueOutput.terms.length} at ${fieldNode.name.value}`);nodeQuadContext[nodeQuadContextKey]=valueOutput.terms[0],valueOutput.auxiliaryPatterns&&(nodeQuadContext.auxiliaryPatterns||(nodeQuadContext.auxiliaryPatterns=[]),nodeQuadContext.auxiliaryPatterns.concat(valueOutput.auxiliaryPatterns))}}if(!nodeQuadContext[nodeQuadContextKey]){const term=this.util.nameToVariable(this.util.getFieldLabel(fieldNode),convertContext);convertContext.terminalVariables.push(term),nodeQuadContext[nodeQuadContextKey]=term}}}getDirectiveOutputs(directives,fieldLabel,convertContext){const outputs=[];if(directives)for(const directive of directives){const output=this.util.handleDirectiveNode({directive,fieldLabel},convertContext);if(output){if(output.ignore)return null;outputs.push(output)}}return outputs}handleDirectiveOutputs(directiveOutputs,operation){for(const directiveOutput of directiveOutputs){if(directiveOutput.ignore)return this.util.operationFactory.createBgp([]);directiveOutput.operationOverrider&&(operation=directiveOutput.operationOverrider(operation))}return operation}}__name(NodeHandlerAdapter,"NodeHandlerAdapter");NodeHandlerAdapter$1.NodeHandlerAdapter=NodeHandlerAdapter;var NodeHandlerDefinitionAdapter$1={};Object.defineProperty(NodeHandlerDefinitionAdapter$1,"__esModule",{value:!0});NodeHandlerDefinitionAdapter$1.NodeHandlerDefinitionAdapter=void 0;const NodeHandlerAdapter_1$2=NodeHandlerAdapter$1;class NodeHandlerDefinitionAdapter extends NodeHandlerAdapter_1$2.NodeHandlerAdapter{constructor(targetKind,util2,settings){super(targetKind,util2,settings)}}__name(NodeHandlerDefinitionAdapter,"NodeHandlerDefinitionAdapter");NodeHandlerDefinitionAdapter$1.NodeHandlerDefinitionAdapter=NodeHandlerDefinitionAdapter;var NodeHandlerDefinitionFragment$1={};Object.defineProperty(NodeHandlerDefinitionFragment$1,"__esModule",{value:!0});NodeHandlerDefinitionFragment$1.NodeHandlerDefinitionFragment=void 0;const NodeHandlerDefinitionAdapter_1$1=NodeHandlerDefinitionAdapter$1;class NodeHandlerDefinitionFragment extends NodeHandlerDefinitionAdapter_1$1.NodeHandlerDefinitionAdapter{constructor(util2,settings){super("FragmentDefinition",util2,settings)}handle(operationDefinition,convertContext){throw new Error("Illegal state: fragment definitions must be indexed and removed before processing")}}__name(NodeHandlerDefinitionFragment,"NodeHandlerDefinitionFragment");NodeHandlerDefinitionFragment$1.NodeHandlerDefinitionFragment=NodeHandlerDefinitionFragment;var NodeHandlerDefinitionOperation$1={};Object.defineProperty(NodeHandlerDefinitionOperation$1,"__esModule",{value:!0});NodeHandlerDefinitionOperation$1.NodeHandlerDefinitionOperation=void 0;const NodeHandlerDefinitionAdapter_1=NodeHandlerDefinitionAdapter$1;class NodeHandlerDefinitionOperation extends NodeHandlerDefinitionAdapter_1.NodeHandlerDefinitionAdapter{constructor(util2,settings){super("OperationDefinition",util2,settings)}handle(operationDefinition,convertContext){if(operationDefinition.operation!=="query")throw new Error("Unsupported definition operation: "+operationDefinition.operation);if(operationDefinition.variableDefinitions)for(const variableDefinition of operationDefinition.variableDefinitions){const name=variableDefinition.variable.name.value;variableDefinition.defaultValue&&(convertContext.variablesDict[name]||(convertContext.variablesDict[name]=variableDefinition.defaultValue));let typeNode=variableDefinition.type;const mandatory=typeNode.kind==="NonNullType";mandatory&&(typeNode=typeNode.type);const list=typeNode.kind==="ListType";list&&(typeNode=typeNode.type);const type=typeNode.name.value;convertContext.variablesMetaDict[name]={mandatory,list,type}}const directiveOutputs=this.getDirectiveOutputs(operationDefinition.directives,operationDefinition.name?operationDefinition.name.value:"",convertContext);if(!directiveOutputs)return this.util.operationFactory.createBgp([]);const operation=this.util.joinOperations(operationDefinition.selectionSet.selections.map(selectionNode=>this.util.handleNode(selectionNode,convertContext)));return this.handleDirectiveOutputs(directiveOutputs,operation)}}__name(NodeHandlerDefinitionOperation,"NodeHandlerDefinitionOperation");NodeHandlerDefinitionOperation$1.NodeHandlerDefinitionOperation=NodeHandlerDefinitionOperation;var NodeHandlerDocument$1={};Object.defineProperty(NodeHandlerDocument$1,"__esModule",{value:!0});NodeHandlerDocument$1.NodeHandlerDocument=void 0;const sparqlalgebrajs_1$v=sparqlalgebrajs,NodeHandlerAdapter_1$1=NodeHandlerAdapter$1;class NodeHandlerDocument extends NodeHandlerAdapter_1$1.NodeHandlerAdapter{constructor(util2,settings){super("Document",util2,settings)}handle(document2,convertContext){const definitionOperations=document2.definitions.map(definition=>{const subjectOutput=this.getNodeQuadContextDefinitionNode(definition,Object.assign(Object.assign({},convertContext),{ignoreUnknownVariables:!0})),queryParseContext=Object.assign(Object.assign({},convertContext),{graph:subjectOutput.graph||convertContext.graph,subject:subjectOutput.subject||this.util.dataFactory.blankNode()});let definitionOperation=this.util.handleNode(definition,queryParseContext);return subjectOutput&&subjectOutput.auxiliaryPatterns&&(definitionOperation=this.util.joinOperations([definitionOperation,this.util.operationFactory.createBgp(subjectOutput.auxiliaryPatterns)])),definitionOperation}),operation=this.util.operationFactory.createProject(definitionOperations.length===1?definitionOperations[0]:this.util.operationFactory.createUnion(definitionOperations),convertContext.terminalVariables);return this.translateBlankNodesToVariables(operation)}getNodeQuadContextDefinitionNode(definition,convertContext){if(definition.kind==="OperationDefinition")return this.getNodeQuadContextSelectionSet(definition.selectionSet,definition.name?definition.name.value:"",convertContext);throw new Error(`Unsupported definition: ${definition.kind}`)}translateBlankNodesToVariables(operation){const self2=this,blankToVariableMapping={},variablesRaw=Array.from(operation.variables).reduce((acc,variable)=>(acc[variable.value]=!0,acc),{});return sparqlalgebrajs_1$v.Util.mapOperation(operation,{path:(op,factory2)=>({recurse:!1,result:factory2.createPath(blankToVariable(op.subject),op.predicate,blankToVariable(op.object),blankToVariable(op.graph))}),pattern:(op,factory2)=>({recurse:!1,result:factory2.createPattern(blankToVariable(op.subject),blankToVariable(op.predicate),blankToVariable(op.object),blankToVariable(op.graph))})});function blankToVariable(term){if(term.termType==="BlankNode"){let variable=blankToVariableMapping[term.value];return variable||(variable=sparqlalgebrajs_1$v.Util.createUniqueVariable(term.value,variablesRaw,self2.util.dataFactory),variablesRaw[variable.value]=!0,blankToVariableMapping[term.value]=variable),variable}return term}}}__name(NodeHandlerDocument,"NodeHandlerDocument");NodeHandlerDocument$1.NodeHandlerDocument=NodeHandlerDocument;var NodeHandlerSelectionAdapter$1={};Object.defineProperty(NodeHandlerSelectionAdapter$1,"__esModule",{value:!0});NodeHandlerSelectionAdapter$1.NodeHandlerSelectionAdapter=void 0;const sparqlalgebrajs_1$u=sparqlalgebrajs,IConvertContext_1$1=IConvertContext,NodeHandlerAdapter_1=NodeHandlerAdapter$1;class NodeHandlerSelectionAdapter extends NodeHandlerAdapter_1.NodeHandlerAdapter{constructor(targetKind,util2,settings){super(targetKind,util2,settings)}getNodeQuadContextFieldNode(field,fieldLabel,convertContext){return this.getNodeQuadContextSelectionSet(field.selectionSet,fieldLabel,Object.assign(Object.assign({},convertContext),{path:this.util.appendFieldToPath(convertContext.path,fieldLabel)}))}fieldToOperation(convertContext,fieldNode,pushTerminalVariables,auxiliaryPatterns){const nesting=pushTerminalVariables;let offset=0,limit;if((fieldNode.name.value==="id"||fieldNode.name.value==="graph")&&(pushTerminalVariables=!1,fieldNode.arguments))for(const argument of fieldNode.arguments)argument.name.value==="_"&&this.util.handleNodeValue(argument.value,fieldNode.name.value,convertContext);const fieldLabel=this.util.getFieldLabel(fieldNode);if(convertContext.singularizeState===IConvertContext_1$1.SingularizeState.SINGLE&&(convertContext.singularizeVariables[this.util.nameToVariable(fieldLabel,convertContext).value]=!0),pushTerminalVariables){const operationOverride=this.handleMetaField(convertContext,fieldLabel,auxiliaryPatterns);if(operationOverride)return operationOverride}const operations=auxiliaryPatterns?[this.util.operationFactory.createBgp(auxiliaryPatterns)]:[],subjectOutput=this.getNodeQuadContextFieldNode(fieldNode,fieldLabel,convertContext);let object2=subjectOutput.subject||this.util.nameToVariable(fieldLabel,convertContext),graph=subjectOutput.graph||convertContext.graph;subjectOutput.auxiliaryPatterns&&operations.push(this.util.operationFactory.createBgp(subjectOutput.auxiliaryPatterns));let createQuadPattern=!0,overrideObjectTerms=null;if(pushTerminalVariables&&fieldNode.arguments&&fieldNode.arguments.length){for(const argument of fieldNode.arguments)if(argument.name.value==="_"){const valueOutput=this.util.handleNodeValue(argument.value,fieldNode.name.value,convertContext);overrideObjectTerms=valueOutput.terms,operations.push(this.util.operationFactory.createBgp(valueOutput.terms.map(term=>this.util.createQuadPattern(convertContext.subject,fieldNode.name,term,convertContext.graph,convertContext.context)))),valueOutput.auxiliaryPatterns&&operations.push(this.util.operationFactory.createBgp(valueOutput.auxiliaryPatterns)),pushTerminalVariables=!1;break}else if(argument.name.value==="graph"){const valueOutput=this.util.handleNodeValue(argument.value,fieldNode.name.value,convertContext);if(valueOutput.terms.length!==1)throw new Error(`Only single values can be set as graph, but got ${valueOutput.terms.length} at ${fieldNode.name.value}`);graph=valueOutput.terms[0],convertContext=Object.assign(Object.assign({},convertContext),{graph}),valueOutput.auxiliaryPatterns&&operations.push(this.util.operationFactory.createBgp(valueOutput.auxiliaryPatterns));break}else if(argument.name.value==="alt"){let pathValue=argument.value;pathValue.kind!=="ListValue"&&(pathValue={kind:"ListValue",values:[pathValue]}),operations.push(this.util.createQuadPath(convertContext.subject,fieldNode.name,pathValue,object2,convertContext.graph,convertContext.context)),createQuadPattern=!1;break}}if(pushTerminalVariables&&createQuadPattern&&operations.push(this.util.operationFactory.createBgp([this.util.createQuadPattern(convertContext.subject,fieldNode.name,object2,convertContext.graph,convertContext.context)])),fieldNode.arguments&&fieldNode.arguments.length){for(const argument of fieldNode.arguments)if(!(argument.name.value==="_"||argument.name.value==="graph"||argument.name.value==="alt"))if(argument.name.value==="first"){if(argument.value.kind!=="IntValue")throw new Error("Invalid value type for 'first' argument: "+argument.value.kind);limit=parseInt(argument.value.value,10)}else if(argument.name.value==="offset"){if(argument.value.kind!=="IntValue")throw new Error("Invalid value type for 'offset' argument: "+argument.value.kind);offset=parseInt(argument.value.value,10)}else{const valueOutput=this.util.handleNodeValue(argument.value,argument.name.value,convertContext);operations.push(this.util.operationFactory.createBgp(valueOutput.terms.map(term=>this.util.createQuadPattern(object2,argument.name,term,convertContext.graph,convertContext.context)))),valueOutput.auxiliaryPatterns&&operations.push(this.util.operationFactory.createBgp(valueOutput.auxiliaryPatterns))}}const directiveOutputs=this.getDirectiveOutputs(fieldNode.directives,fieldLabel,convertContext);if(!directiveOutputs)return this.util.operationFactory.createBgp([]);let operation=this.util.joinOperations(operations);if(fieldNode.selectionSet&&fieldNode.selectionSet.selections.length){if(overrideObjectTerms){if(overrideObjectTerms.length!==1)throw new Error(`Only single values can be set as id, but got ${overrideObjectTerms.length} at ${fieldNode.name.value}`);object2=overrideObjectTerms[0]}const subConvertContext=Object.assign(Object.assign(Object.assign({},convertContext),nesting?{path:this.util.appendFieldToPath(convertContext.path,fieldLabel)}:{}),{graph,subject:nesting?object2:convertContext.subject});let totalCount=!1;const selections=fieldNode.selectionSet.selections.filter(selection=>selection.kind==="Field"&&selection.name.value==="totalCount"?(totalCount=!0,!1):!0);let joinedOperation=this.util.joinOperations(operations.concat(selections.map(selectionNode=>this.util.handleNode(selectionNode,subConvertContext))));if(totalCount){const expressionVariable=this.util.dataFactory.variable("var"+this.settings.expressionVariableCounter++),countOverVariable=this.util.dataFactory.variable(object2.value+this.settings.variableDelimiter+"totalCount"),aggregator=this.util.operationFactory.createBoundAggregate(expressionVariable,"count",this.util.operationFactory.createTermExpression(object2),!1),countProject=this.util.operationFactory.createProject(this.util.operationFactory.createExtend(this.util.operationFactory.createGroup(operation,[],[aggregator]),countOverVariable,this.util.operationFactory.createTermExpression(expressionVariable)),[countOverVariable]);convertContext.terminalVariables.push(countOverVariable),selections.length?joinedOperation=this.util.operationFactory.createJoin([this.util.operationFactory.createProject(joinedOperation,[]),countProject]):joinedOperation=countProject}operation=joinedOperation}else pushTerminalVariables&&object2.termType==="Variable"&&convertContext.terminalVariables.push(object2);return(offset||limit)&&(operation=this.util.operationFactory.createSlice(this.util.operationFactory.createProject(operation,sparqlalgebrajs_1$u.Util.inScopeVariables(operation)),offset,limit)),this.handleDirectiveOutputs(directiveOutputs,operation)}handleMetaField(convertContext,fieldLabel,auxiliaryPatterns){if(fieldLabel==="__typename"){const object2=this.util.nameToVariable(fieldLabel,convertContext);return convertContext.terminalVariables.push(object2),this.util.operationFactory.createBgp([this.util.operationFactory.createPattern(convertContext.subject,this.util.dataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.util.nameToVariable(fieldLabel,convertContext),convertContext.graph)].concat(auxiliaryPatterns||[]))}}}__name(NodeHandlerSelectionAdapter,"NodeHandlerSelectionAdapter");NodeHandlerSelectionAdapter$1.NodeHandlerSelectionAdapter=NodeHandlerSelectionAdapter;var NodeHandlerSelectionField$1={};Object.defineProperty(NodeHandlerSelectionField$1,"__esModule",{value:!0});NodeHandlerSelectionField$1.NodeHandlerSelectionField=void 0;const NodeHandlerSelectionAdapter_1$2=NodeHandlerSelectionAdapter$1;class NodeHandlerSelectionField extends NodeHandlerSelectionAdapter_1$2.NodeHandlerSelectionAdapter{constructor(util2,settings){super("Field",util2,settings)}handle(fieldNode,convertContext){return this.fieldToOperation(convertContext,fieldNode,!0)}}__name(NodeHandlerSelectionField,"NodeHandlerSelectionField");NodeHandlerSelectionField$1.NodeHandlerSelectionField=NodeHandlerSelectionField;var NodeHandlerSelectionFragmentSpread$1={};Object.defineProperty(NodeHandlerSelectionFragmentSpread$1,"__esModule",{value:!0});NodeHandlerSelectionFragmentSpread$1.NodeHandlerSelectionFragmentSpread=void 0;const NodeHandlerSelectionAdapter_1$1=NodeHandlerSelectionAdapter$1;class NodeHandlerSelectionFragmentSpread extends NodeHandlerSelectionAdapter_1$1.NodeHandlerSelectionAdapter{constructor(util2,settings){super("FragmentSpread",util2,settings)}handle(fragmentSpreadNode,convertContext){const fragmentDefinitionNode=convertContext.fragmentDefinitions[fragmentSpreadNode.name.value];if(!fragmentDefinitionNode)throw new Error("Undefined fragment definition: "+fragmentSpreadNode.name.value);const fieldNode={alias:void 0,arguments:void 0,directives:fragmentDefinitionNode.directives,kind:"Field",name:fragmentSpreadNode.name,selectionSet:fragmentDefinitionNode.selectionSet},auxiliaryPatterns=[this.util.newTypePattern(convertContext.subject,fragmentDefinitionNode.typeCondition,convertContext)];return this.util.operationFactory.createLeftJoin(this.util.operationFactory.createBgp([]),this.fieldToOperation(convertContext,fieldNode,!1,auxiliaryPatterns))}}__name(NodeHandlerSelectionFragmentSpread,"NodeHandlerSelectionFragmentSpread");NodeHandlerSelectionFragmentSpread$1.NodeHandlerSelectionFragmentSpread=NodeHandlerSelectionFragmentSpread;var NodeHandlerSelectionInlineFragment$1={};Object.defineProperty(NodeHandlerSelectionInlineFragment$1,"__esModule",{value:!0});NodeHandlerSelectionInlineFragment$1.NodeHandlerSelectionInlineFragment=void 0;const NodeHandlerSelectionAdapter_1=NodeHandlerSelectionAdapter$1;class NodeHandlerSelectionInlineFragment extends NodeHandlerSelectionAdapter_1.NodeHandlerSelectionAdapter{constructor(util2,settings){super("InlineFragment",util2,settings)}handle(inlineFragmentNode,convertContext){const fieldNode={alias:void 0,arguments:void 0,directives:inlineFragmentNode.directives,kind:"Field",name:{kind:"Name",value:convertContext.subject.value},selectionSet:inlineFragmentNode.selectionSet},auxiliaryPatterns=inlineFragmentNode.typeCondition?[this.util.newTypePattern(convertContext.subject,inlineFragmentNode.typeCondition,convertContext)]:[];return this.util.operationFactory.createLeftJoin(this.util.operationFactory.createBgp([]),this.fieldToOperation(convertContext,fieldNode,!1,auxiliaryPatterns))}}__name(NodeHandlerSelectionInlineFragment,"NodeHandlerSelectionInlineFragment");NodeHandlerSelectionInlineFragment$1.NodeHandlerSelectionInlineFragment=NodeHandlerSelectionInlineFragment;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(directivenode,exports),__exportStar(valuenode,exports),__exportStar(NodeHandlerAdapter$1,exports),__exportStar(NodeHandlerDefinitionAdapter$1,exports),__exportStar(NodeHandlerDefinitionFragment$1,exports),__exportStar(NodeHandlerDefinitionOperation$1,exports),__exportStar(NodeHandlerDocument$1,exports),__exportStar(NodeHandlerSelectionAdapter$1,exports),__exportStar(NodeHandlerSelectionField$1,exports),__exportStar(NodeHandlerSelectionFragmentSpread$1,exports),__exportStar(NodeHandlerSelectionInlineFragment$1,exports)})(handler);var Converter$3={},SYMBOL_TO_STRING_TAG=typeof Symbol=="function"&&Symbol.toStringTag!=null?Symbol.toStringTag:"@@toStringTag",nodejsCustomInspectSymbol=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):void 0;const nodejsCustomInspectSymbol$1=nodejsCustomInspectSymbol;function _typeof$2(obj){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$2=__name(function(obj2){return typeof obj2},"_typeof"):_typeof$2=__name(function(obj2){return obj2&&typeof Symbol=="function"&&obj2.constructor===Symbol&&obj2!==Symbol.prototype?"symbol":typeof obj2},"_typeof"),_typeof$2(obj)}__name(_typeof$2,"_typeof$2");var MAX_ARRAY_LENGTH=10,MAX_RECURSIVE_DEPTH=2;function inspect(value){return formatValue(value,[])}__name(inspect,"inspect");function formatValue(value,seenValues){switch(_typeof$2(value)){case"string":return JSON.stringify(value);case"function":return value.name?"[function ".concat(value.name,"]"):"[function]";case"object":return value===null?"null":formatObjectValue(value,seenValues);default:return String(value)}}__name(formatValue,"formatValue");function formatObjectValue(value,previouslySeenValues){if(previouslySeenValues.indexOf(value)!==-1)return"[Circular]";var seenValues=[].concat(previouslySeenValues,[value]),customInspectFn=getCustomFn(value);if(customInspectFn!==void 0){var customValue=customInspectFn.call(value);if(customValue!==value)return typeof customValue=="string"?customValue:formatValue(customValue,seenValues)}else if(Array.isArray(value))return formatArray(value,seenValues);return formatObject(value,seenValues)}__name(formatObjectValue,"formatObjectValue");function formatObject(object2,seenValues){var keys2=Object.keys(object2);if(keys2.length===0)return"{}";if(seenValues.length>MAX_RECURSIVE_DEPTH)return"["+getObjectTag(object2)+"]";var properties=keys2.map(function(key){var value=formatValue(object2[key],seenValues);return key+": "+value});return"{ "+properties.join(", ")+" }"}__name(formatObject,"formatObject");function formatArray(array,seenValues){if(array.length===0)return"[]";if(seenValues.length>MAX_RECURSIVE_DEPTH)return"[Array]";for(var len=Math.min(MAX_ARRAY_LENGTH,array.length),remaining=array.length-len,items=[],i=0;i<len;++i)items.push(formatValue(array[i],seenValues));return remaining===1?items.push("... 1 more item"):remaining>1&&items.push("... ".concat(remaining," more items")),"["+items.join(", ")+"]"}__name(formatArray,"formatArray");function getCustomFn(object2){var customInspectFn=object2[String(nodejsCustomInspectSymbol$1)];if(typeof customInspectFn=="function")return customInspectFn;if(typeof object2.inspect=="function")return object2.inspect}__name(getCustomFn,"getCustomFn");function getObjectTag(object2){var tag=Object.prototype.toString.call(object2).replace(/^\[object /,"").replace(/]$/,"");if(tag==="Object"&&typeof object2.constructor=="function"){var name=object2.constructor.name;if(typeof name=="string"&&name!=="")return name}return tag}__name(getObjectTag,"getObjectTag");function devAssert(condition,message){var booleanCondition=!!condition;if(!booleanCondition)throw new Error(message)}__name(devAssert,"devAssert");const instanceOf=__name(function(value,constructor){return value instanceof constructor},"instanceOf");function _defineProperties$1(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__name(_defineProperties$1,"_defineProperties$1");function _createClass$1(Constructor,protoProps,staticProps){return protoProps&&_defineProperties$1(Constructor.prototype,protoProps),staticProps&&_defineProperties$1(Constructor,staticProps),Constructor}__name(_createClass$1,"_createClass$1");var Source=function(){function Source2(body){var name=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"GraphQL request",locationOffset=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{line:1,column:1};typeof body=="string"||devAssert(0,"Body must be a string. Received: ".concat(inspect(body),".")),this.body=body,this.name=name,this.locationOffset=locationOffset,this.locationOffset.line>0||devAssert(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||devAssert(0,"column in locationOffset is 1-indexed and must be positive.")}return __name(Source2,"Source"),_createClass$1(Source2,[{key:SYMBOL_TO_STRING_TAG,get:__name(function(){return"Source"},"get")}]),Source2}();function isSource(source){return instanceOf(source,Source)}__name(isSource,"isSource");function getLocation(source,position){for(var lineRegexp=/\r\n|[\n\r]/g,line=1,column=position+1,match;(match=lineRegexp.exec(source.body))&&match.index<position;)line+=1,column=position+1-(match.index+match[0].length);return{line,column}}__name(getLocation,"getLocation");function printLocation(location){return printSourceLocation(location.source,getLocation(location.source,location.start))}__name(printLocation,"printLocation");function printSourceLocation(source,sourceLocation){var firstLineColumnOffset=source.locationOffset.column-1,body=whitespace(firstLineColumnOffset)+source.body,lineIndex=sourceLocation.line-1,lineOffset=source.locationOffset.line-1,lineNum=sourceLocation.line+lineOffset,columnOffset=sourceLocation.line===1?firstLineColumnOffset:0,columnNum=sourceLocation.column+columnOffset,locationStr="".concat(source.name,":").concat(lineNum,":").concat(columnNum,`
`),lines=body.split(/\r\n|[\n\r]/g),locationLine=lines[lineIndex];if(locationLine.length>120){for(var subLineIndex=Math.floor(columnNum/80),subLineColumnNum=columnNum%80,subLines=[],i=0;i<locationLine.length;i+=80)subLines.push(locationLine.slice(i,i+80));return locationStr+printPrefixedLines([["".concat(lineNum),subLines[0]]].concat(subLines.slice(1,subLineIndex+1).map(function(subLine){return["",subLine]}),[[" ",whitespace(subLineColumnNum-1)+"^"],["",subLines[subLineIndex+1]]]))}return locationStr+printPrefixedLines([["".concat(lineNum-1),lines[lineIndex-1]],["".concat(lineNum),locationLine],["",whitespace(columnNum-1)+"^"],["".concat(lineNum+1),lines[lineIndex+1]]])}__name(printSourceLocation,"printSourceLocation");function printPrefixedLines(lines){var existingLines=lines.filter(function(_ref){_ref[0];var line=_ref[1];return line!==void 0}),padLen=Math.max.apply(Math,existingLines.map(function(_ref2){var prefix=_ref2[0];return prefix.length}));return existingLines.map(function(_ref3){var prefix=_ref3[0],line=_ref3[1];return leftPad(padLen,prefix)+(line?" | "+line:" |")}).join(`
`)}__name(printPrefixedLines,"printPrefixedLines");function whitespace(len){return Array(len+1).join(" ")}__name(whitespace,"whitespace");function leftPad(len,str){return whitespace(len-str.length)+str}__name(leftPad,"leftPad");var Kind=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"}),TokenKind=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"});function _typeof$1(obj){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$1=__name(function(obj2){return typeof obj2},"_typeof"):_typeof$1=__name(function(obj2){return obj2&&typeof Symbol=="function"&&obj2.constructor===Symbol&&obj2!==Symbol.prototype?"symbol":typeof obj2},"_typeof"),_typeof$1(obj)}__name(_typeof$1,"_typeof$1");function isObjectLike(value){return _typeof$1(value)=="object"&&value!==null}__name(isObjectLike,"isObjectLike");function _typeof(obj){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=__name(function(obj2){return typeof obj2},"_typeof"):_typeof=__name(function(obj2){return obj2&&typeof Symbol=="function"&&obj2.constructor===Symbol&&obj2!==Symbol.prototype?"symbol":typeof obj2},"_typeof"),_typeof(obj)}__name(_typeof,"_typeof");function ownKeys(object2,enumerableOnly){var keys2=Object.keys(object2);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object2);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object2,sym).enumerable})),keys2.push.apply(keys2,symbols)}return keys2}__name(ownKeys,"ownKeys");function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}__name(_objectSpread,"_objectSpread");function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__name(_defineProperty,"_defineProperty");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}__name(_classCallCheck,"_classCallCheck");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__name(_defineProperties,"_defineProperties");function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}__name(_createClass,"_createClass");function _inherits(subClass,superClass){if(typeof superClass!="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}__name(_inherits,"_inherits");function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return __name(function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)},"_createSuperInternal")}__name(_createSuper,"_createSuper");function _possibleConstructorReturn(self2,call){return call&&(_typeof(call)==="object"||typeof call=="function")?call:_assertThisInitialized(self2)}__name(_possibleConstructorReturn,"_possibleConstructorReturn");function _assertThisInitialized(self2){if(self2===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self2}__name(_assertThisInitialized,"_assertThisInitialized");function _wrapNativeSuper(Class){var _cache=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=__name(function(Class2){if(Class2===null||!_isNativeFunction(Class2))return Class2;if(typeof Class2!="function")throw new TypeError("Super expression must either be null or a function");if(typeof _cache<"u"){if(_cache.has(Class2))return _cache.get(Class2);_cache.set(Class2,Wrapper)}function Wrapper(){return _construct(Class2,arguments,_getPrototypeOf(this).constructor)}return __name(Wrapper,"Wrapper"),Wrapper.prototype=Object.create(Class2.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class2)},"_wrapNativeSuper"),_wrapNativeSuper(Class)}__name(_wrapNativeSuper,"_wrapNativeSuper");function _construct(Parent,args,Class){return _isNativeReflectConstruct()?_construct=Reflect.construct:_construct=__name(function(Parent2,args2,Class2){var a=[null];a.push.apply(a,args2);var Constructor=Function.bind.apply(Parent2,a),instance=new Constructor;return Class2&&_setPrototypeOf(instance,Class2.prototype),instance},"_construct"),_construct.apply(null,arguments)}__name(_construct,"_construct");function _isNativeReflectConstruct(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}__name(_isNativeReflectConstruct,"_isNativeReflectConstruct");function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}__name(_isNativeFunction,"_isNativeFunction");function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||__name(function(o2,p2){return o2.__proto__=p2,o2},"_setPrototypeOf"),_setPrototypeOf(o,p)}__name(_setPrototypeOf,"_setPrototypeOf");function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:__name(function(o2){return o2.__proto__||Object.getPrototypeOf(o2)},"_getPrototypeOf"),_getPrototypeOf(o)}__name(_getPrototypeOf,"_getPrototypeOf");var GraphQLError=function(_Error){_inherits(GraphQLError2,_Error);var _super=_createSuper(GraphQLError2);function GraphQLError2(message,nodes,source,positions,path,originalError,extensions){var _nodeLocations,_nodeLocations2,_nodeLocations3,_this;_classCallCheck(this,GraphQLError2),_this=_super.call(this,message),_this.name="GraphQLError",_this.originalError=originalError??void 0,_this.nodes=undefinedIfEmpty(Array.isArray(nodes)?nodes:nodes?[nodes]:void 0);for(var nodeLocations=[],_i2=0,_ref3=(_this$nodes=_this.nodes)!==null&&_this$nodes!==void 0?_this$nodes:[];_i2<_ref3.length;_i2++){var _this$nodes,_ref4=_ref3[_i2],loc=_ref4.loc;loc!=null&&nodeLocations.push(loc)}nodeLocations=undefinedIfEmpty(nodeLocations),_this.source=source??((_nodeLocations=nodeLocations)===null||_nodeLocations===void 0?void 0:_nodeLocations[0].source),_this.positions=positions??((_nodeLocations2=nodeLocations)===null||_nodeLocations2===void 0?void 0:_nodeLocations2.map(function(loc2){return loc2.start})),_this.locations=positions&&source?positions.map(function(pos){return getLocation(source,pos)}):(_nodeLocations3=nodeLocations)===null||_nodeLocations3===void 0?void 0:_nodeLocations3.map(function(loc2){return getLocation(loc2.source,loc2.start)}),_this.path=path??void 0;var originalExtensions=originalError==null?void 0:originalError.extensions;return extensions==null&&isObjectLike(originalExtensions)?_this.extensions=_objectSpread({},originalExtensions):_this.extensions=extensions??{},Object.defineProperties(_assertThisInitialized(_this),{message:{enumerable:!0},locations:{enumerable:_this.locations!=null},path:{enumerable:_this.path!=null},extensions:{enumerable:_this.extensions!=null&&Object.keys(_this.extensions).length>0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),originalError!=null&&originalError.stack?(Object.defineProperty(_assertThisInitialized(_this),"stack",{value:originalError.stack,writable:!0,configurable:!0}),_possibleConstructorReturn(_this)):(Error.captureStackTrace?Error.captureStackTrace(_assertThisInitialized(_this),GraphQLError2):Object.defineProperty(_assertThisInitialized(_this),"stack",{value:Error().stack,writable:!0,configurable:!0}),_this)}return __name(GraphQLError2,"GraphQLError"),_createClass(GraphQLError2,[{key:"toString",value:__name(function(){return printError(this)},"toString")},{key:SYMBOL_TO_STRING_TAG,get:__name(function(){return"Object"},"get")}]),GraphQLError2}(_wrapNativeSuper(Error));function undefinedIfEmpty(array){return array===void 0||array.length===0?void 0:array}__name(undefinedIfEmpty,"undefinedIfEmpty");function printError(error){var output=error.message;if(error.nodes)for(var _i4=0,_error$nodes2=error.nodes;_i4<_error$nodes2.length;_i4++){var node2=_error$nodes2[_i4];node2.loc&&(output+=`

`+printLocation(node2.loc))}else if(error.source&&error.locations)for(var _i6=0,_error$locations2=error.locations;_i6<_error$locations2.length;_i6++){var location=_error$locations2[_i6];output+=`

`+printSourceLocation(error.source,location)}return output}__name(printError,"printError");function syntaxError(source,position,description){return new GraphQLError("Syntax Error: ".concat(description),void 0,source,[position])}__name(syntaxError,"syntaxError");function invariant(condition,message){var booleanCondition=!!condition;if(!booleanCondition)throw new Error(message??"Unexpected invariant triggered.")}__name(invariant,"invariant");function defineInspect(classObject){var fn=classObject.prototype.toJSON;typeof fn=="function"||invariant(0),classObject.prototype.inspect=fn,nodejsCustomInspectSymbol$1&&(classObject.prototype[nodejsCustomInspectSymbol$1]=fn)}__name(defineInspect,"defineInspect");var Location=function(){function Location2(startToken,endToken,source){this.start=startToken.start,this.end=endToken.end,this.startToken=startToken,this.endToken=endToken,this.source=source}__name(Location2,"Location");var _proto=Location2.prototype;return _proto.toJSON=__name(function(){return{start:this.start,end:this.end}},"toJSON"),Location2}();defineInspect(Location);var Token=function(){function Token2(kind,start,end,line,column,prev,value){this.kind=kind,this.start=start,this.end=end,this.line=line,this.column=column,this.value=value,this.prev=prev,this.next=null}__name(Token2,"Token");var _proto2=Token2.prototype;return _proto2.toJSON=__name(function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},"toJSON"),Token2}();defineInspect(Token);function isNode(maybeNode){return maybeNode!=null&&typeof maybeNode.kind=="string"}__name(isNode,"isNode");function dedentBlockStringValue(rawString){var lines=rawString.split(/\r\n|[\n\r]/g),commonIndent=getBlockStringIndentation(rawString);if(commonIndent!==0)for(var i=1;i<lines.length;i++)lines[i]=lines[i].slice(commonIndent);for(var startLine=0;startLine<lines.length&&isBlank$1(lines[startLine]);)++startLine;for(var endLine=lines.length;endLine>startLine&&isBlank$1(lines[endLine-1]);)--endLine;return lines.slice(startLine,endLine).join(`
`)}__name(dedentBlockStringValue,"dedentBlockStringValue");function isBlank$1(str){for(var i=0;i<str.length;++i)if(str[i]!==" "&&str[i]!=="	")return!1;return!0}__name(isBlank$1,"isBlank$1");function getBlockStringIndentation(value){for(var _commonIndent,isFirstLine=!0,isEmptyLine=!0,indent2=0,commonIndent=null,i=0;i<value.length;++i)switch(value.charCodeAt(i)){case 13:value.charCodeAt(i+1)===10&&++i;case 10:isFirstLine=!1,isEmptyLine=!0,indent2=0;break;case 9:case 32:++indent2;break;default:isEmptyLine&&!isFirstLine&&(commonIndent===null||indent2<commonIndent)&&(commonIndent=indent2),isEmptyLine=!1}return(_commonIndent=commonIndent)!==null&&_commonIndent!==void 0?_commonIndent:0}__name(getBlockStringIndentation,"getBlockStringIndentation");function printBlockString(value){var indentation=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",preferMultipleLines=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,isSingleLine=value.indexOf(`
`)===-1,hasLeadingSpace=value[0]===" "||value[0]==="	",hasTrailingQuote=value[value.length-1]==='"',hasTrailingSlash=value[value.length-1]==="\\",printAsMultipleLines=!isSingleLine||hasTrailingQuote||hasTrailingSlash||preferMultipleLines,result="";return printAsMultipleLines&&!(isSingleLine&&hasLeadingSpace)&&(result+=`
`+indentation),result+=indentation?value.replace(/\n/g,`
`+indentation):value,printAsMultipleLines&&(result+=`
`),'"""'+result.replace(/"""/g,'\\"""')+'"""'}__name(printBlockString,"printBlockString");var Lexer=function(){function Lexer2(source){var startOfFileToken=new Token(TokenKind.SOF,0,0,0,0,null);this.source=source,this.lastToken=startOfFileToken,this.token=startOfFileToken,this.line=1,this.lineStart=0}__name(Lexer2,"Lexer");var _proto=Lexer2.prototype;return _proto.advance=__name(function(){this.lastToken=this.token;var token=this.token=this.lookahead();return token},"advance"),_proto.lookahead=__name(function(){var token=this.token;if(token.kind!==TokenKind.EOF)do{var _token$next;token=(_token$next=token.next)!==null&&_token$next!==void 0?_token$next:token.next=readToken(this,token)}while(token.kind===TokenKind.COMMENT);return token},"lookahead"),Lexer2}();function isPunctuatorTokenKind(kind){return kind===TokenKind.BANG||kind===TokenKind.DOLLAR||kind===TokenKind.AMP||kind===TokenKind.PAREN_L||kind===TokenKind.PAREN_R||kind===TokenKind.SPREAD||kind===TokenKind.COLON||kind===TokenKind.EQUALS||kind===TokenKind.AT||kind===TokenKind.BRACKET_L||kind===TokenKind.BRACKET_R||kind===TokenKind.BRACE_L||kind===TokenKind.PIPE||kind===TokenKind.BRACE_R}__name(isPunctuatorTokenKind,"isPunctuatorTokenKind");function printCharCode(code){return isNaN(code)?TokenKind.EOF:code<127?JSON.stringify(String.fromCharCode(code)):'"\\u'.concat(("00"+code.toString(16).toUpperCase()).slice(-4),'"')}__name(printCharCode,"printCharCode");function readToken(lexer,prev){for(var source=lexer.source,body=source.body,bodyLength=body.length,pos=prev.end;pos<bodyLength;){var code=body.charCodeAt(pos),_line=lexer.line,_col=1+pos-lexer.lineStart;switch(code){case 65279:case 9:case 32:case 44:++pos;continue;case 10:++pos,++lexer.line,lexer.lineStart=pos;continue;case 13:body.charCodeAt(pos+1)===10?pos+=2:++pos,++lexer.line,lexer.lineStart=pos;continue;case 33:return new Token(TokenKind.BANG,pos,pos+1,_line,_col,prev);case 35:return readComment(source,pos,_line,_col,prev);case 36:return new Token(TokenKind.DOLLAR,pos,pos+1,_line,_col,prev);case 38:return new Token(TokenKind.AMP,pos,pos+1,_line,_col,prev);case 40:return new Token(TokenKind.PAREN_L,pos,pos+1,_line,_col,prev);case 41:return new Token(TokenKind.PAREN_R,pos,pos+1,_line,_col,prev);case 46:if(body.charCodeAt(pos+1)===46&&body.charCodeAt(pos+2)===46)return new Token(TokenKind.SPREAD,pos,pos+3,_line,_col,prev);break;case 58:return new Token(TokenKind.COLON,pos,pos+1,_line,_col,prev);case 61:return new Token(TokenKind.EQUALS,pos,pos+1,_line,_col,prev);case 64:return new Token(TokenKind.AT,pos,pos+1,_line,_col,prev);case 91:return new Token(TokenKind.BRACKET_L,pos,pos+1,_line,_col,prev);case 93:return new Token(TokenKind.BRACKET_R,pos,pos+1,_line,_col,prev);case 123:return new Token(TokenKind.BRACE_L,pos,pos+1,_line,_col,prev);case 124:return new Token(TokenKind.PIPE,pos,pos+1,_line,_col,prev);case 125:return new Token(TokenKind.BRACE_R,pos,pos+1,_line,_col,prev);case 34:return body.charCodeAt(pos+1)===34&&body.charCodeAt(pos+2)===34?readBlockString(source,pos,_line,_col,prev,lexer):readString(source,pos,_line,_col,prev);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return readNumber(source,pos,code,_line,_col,prev);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return readName(source,pos,_line,_col,prev)}throw syntaxError(source,pos,unexpectedCharacterMessage(code))}var line=lexer.line,col=1+pos-lexer.lineStart;return new Token(TokenKind.EOF,bodyLength,bodyLength,line,col,prev)}__name(readToken,"readToken");function unexpectedCharacterMessage(code){return code<32&&code!==9&&code!==10&&code!==13?"Cannot contain the invalid character ".concat(printCharCode(code),"."):code===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:"Cannot parse the unexpected character ".concat(printCharCode(code),".")}__name(unexpectedCharacterMessage,"unexpectedCharacterMessage");function readComment(source,start,line,col,prev){var body=source.body,code,position=start;do code=body.charCodeAt(++position);while(!isNaN(code)&&(code>31||code===9));return new Token(TokenKind.COMMENT,start,position,line,col,prev,body.slice(start+1,position))}__name(readComment,"readComment");function readNumber(source,start,firstCode,line,col,prev){var body=source.body,code=firstCode,position=start,isFloat=!1;if(code===45&&(code=body.charCodeAt(++position)),code===48){if(code=body.charCodeAt(++position),code>=48&&code<=57)throw syntaxError(source,position,"Invalid number, unexpected digit after 0: ".concat(printCharCode(code),"."))}else position=readDigits(source,position,code),code=body.charCodeAt(position);if(code===46&&(isFloat=!0,code=body.charCodeAt(++position),position=readDigits(source,position,code),code=body.charCodeAt(position)),(code===69||code===101)&&(isFloat=!0,code=body.charCodeAt(++position),(code===43||code===45)&&(code=body.charCodeAt(++position)),position=readDigits(source,position,code),code=body.charCodeAt(position)),code===46||isNameStart(code))throw syntaxError(source,position,"Invalid number, expected digit but got: ".concat(printCharCode(code),"."));return new Token(isFloat?TokenKind.FLOAT:TokenKind.INT,start,position,line,col,prev,body.slice(start,position))}__name(readNumber,"readNumber");function readDigits(source,start,firstCode){var body=source.body,position=start,code=firstCode;if(code>=48&&code<=57){do code=body.charCodeAt(++position);while(code>=48&&code<=57);return position}throw syntaxError(source,position,"Invalid number, expected digit but got: ".concat(printCharCode(code),"."))}__name(readDigits,"readDigits");function readString(source,start,line,col,prev){for(var body=source.body,position=start+1,chunkStart=position,code=0,value="";position<body.length&&!isNaN(code=body.charCodeAt(position))&&code!==10&&code!==13;){if(code===34)return value+=body.slice(chunkStart,position),new Token(TokenKind.STRING,start,position+1,line,col,prev,value);if(code<32&&code!==9)throw syntaxError(source,position,"Invalid character within String: ".concat(printCharCode(code),"."));if(++position,code===92){switch(value+=body.slice(chunkStart,position-1),code=body.charCodeAt(position),code){case 34:value+='"';break;case 47:value+="/";break;case 92:value+="\\";break;case 98:value+="\b";break;case 102:value+="\f";break;case 110:value+=`
`;break;case 114:value+="\r";break;case 116:value+="	";break;case 117:{var charCode=uniCharCode(body.charCodeAt(position+1),body.charCodeAt(position+2),body.charCodeAt(position+3),body.charCodeAt(position+4));if(charCode<0){var invalidSequence=body.slice(position+1,position+5);throw syntaxError(source,position,"Invalid character escape sequence: \\u".concat(invalidSequence,"."))}value+=String.fromCharCode(charCode),position+=4;break}default:throw syntaxError(source,position,"Invalid character escape sequence: \\".concat(String.fromCharCode(code),"."))}++position,chunkStart=position}}throw syntaxError(source,position,"Unterminated string.")}__name(readString,"readString");function readBlockString(source,start,line,col,prev,lexer){for(var body=source.body,position=start+3,chunkStart=position,code=0,rawValue="";position<body.length&&!isNaN(code=body.charCodeAt(position));){if(code===34&&body.charCodeAt(position+1)===34&&body.charCodeAt(position+2)===34)return rawValue+=body.slice(chunkStart,position),new Token(TokenKind.BLOCK_STRING,start,position+3,line,col,prev,dedentBlockStringValue(rawValue));if(code<32&&code!==9&&code!==10&&code!==13)throw syntaxError(source,position,"Invalid character within String: ".concat(printCharCode(code),"."));code===10?(++position,++lexer.line,lexer.lineStart=position):code===13?(body.charCodeAt(position+1)===10?position+=2:++position,++lexer.line,lexer.lineStart=position):code===92&&body.charCodeAt(position+1)===34&&body.charCodeAt(position+2)===34&&body.charCodeAt(position+3)===34?(rawValue+=body.slice(chunkStart,position)+'"""',position+=4,chunkStart=position):++position}throw syntaxError(source,position,"Unterminated string.")}__name(readBlockString,"readBlockString");function uniCharCode(a,b,c,d){return char2hex(a)<<12|char2hex(b)<<8|char2hex(c)<<4|char2hex(d)}__name(uniCharCode,"uniCharCode");function char2hex(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:-1}__name(char2hex,"char2hex");function readName(source,start,line,col,prev){for(var body=source.body,bodyLength=body.length,position=start+1,code=0;position!==bodyLength&&!isNaN(code=body.charCodeAt(position))&&(code===95||code>=48&&code<=57||code>=65&&code<=90||code>=97&&code<=122);)++position;return new Token(TokenKind.NAME,start,position,line,col,prev,body.slice(start,position))}__name(readName,"readName");function isNameStart(code){return code===95||code>=65&&code<=90||code>=97&&code<=122}__name(isNameStart,"isNameStart");var DirectiveLocation=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"});function parse$1(source,options){var parser=new Parser$7(source,options);return parser.parseDocument()}__name(parse$1,"parse$1");function parseValue(source,options){var parser=new Parser$7(source,options);parser.expectToken(TokenKind.SOF);var value=parser.parseValueLiteral(!1);return parser.expectToken(TokenKind.EOF),value}__name(parseValue,"parseValue");function parseType(source,options){var parser=new Parser$7(source,options);parser.expectToken(TokenKind.SOF);var type=parser.parseTypeReference();return parser.expectToken(TokenKind.EOF),type}__name(parseType,"parseType");var Parser$7=function(){function Parser3(source,options){var sourceObj=isSource(source)?source:new Source(source);this._lexer=new Lexer(sourceObj),this._options=options}__name(Parser3,"Parser");var _proto=Parser3.prototype;return _proto.parseName=__name(function(){var token=this.expectToken(TokenKind.NAME);return{kind:Kind.NAME,value:token.value,loc:this.loc(token)}},"parseName"),_proto.parseDocument=__name(function(){var start=this._lexer.token;return{kind:Kind.DOCUMENT,definitions:this.many(TokenKind.SOF,this.parseDefinition,TokenKind.EOF),loc:this.loc(start)}},"parseDocument"),_proto.parseDefinition=__name(function(){if(this.peek(TokenKind.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(TokenKind.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},"parseDefinition"),_proto.parseOperationDefinition=__name(function(){var start=this._lexer.token;if(this.peek(TokenKind.BRACE_L))return{kind:Kind.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(start)};var operation=this.parseOperationType(),name;return this.peek(TokenKind.NAME)&&(name=this.parseName()),{kind:Kind.OPERATION_DEFINITION,operation,name,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(start)}},"parseOperationDefinition"),_proto.parseOperationType=__name(function(){var operationToken=this.expectToken(TokenKind.NAME);switch(operationToken.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(operationToken)},"parseOperationType"),_proto.parseVariableDefinitions=__name(function(){return this.optionalMany(TokenKind.PAREN_L,this.parseVariableDefinition,TokenKind.PAREN_R)},"parseVariableDefinitions"),_proto.parseVariableDefinition=__name(function(){var start=this._lexer.token;return{kind:Kind.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(TokenKind.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(TokenKind.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(start)}},"parseVariableDefinition"),_proto.parseVariable=__name(function(){var start=this._lexer.token;return this.expectToken(TokenKind.DOLLAR),{kind:Kind.VARIABLE,name:this.parseName(),loc:this.loc(start)}},"parseVariable"),_proto.parseSelectionSet=__name(function(){var start=this._lexer.token;return{kind:Kind.SELECTION_SET,selections:this.many(TokenKind.BRACE_L,this.parseSelection,TokenKind.BRACE_R),loc:this.loc(start)}},"parseSelectionSet"),_proto.parseSelection=__name(function(){return this.peek(TokenKind.SPREAD)?this.parseFragment():this.parseField()},"parseSelection"),_proto.parseField=__name(function(){var start=this._lexer.token,nameOrAlias=this.parseName(),alias,name;return this.expectOptionalToken(TokenKind.COLON)?(alias=nameOrAlias,name=this.parseName()):name=nameOrAlias,{kind:Kind.FIELD,alias,name,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(TokenKind.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(start)}},"parseField"),_proto.parseArguments=__name(function(isConst){var item=isConst?this.parseConstArgument:this.parseArgument;return this.optionalMany(TokenKind.PAREN_L,item,TokenKind.PAREN_R)},"parseArguments"),_proto.parseArgument=__name(function(){var start=this._lexer.token,name=this.parseName();return this.expectToken(TokenKind.COLON),{kind:Kind.ARGUMENT,name,value:this.parseValueLiteral(!1),loc:this.loc(start)}},"parseArgument"),_proto.parseConstArgument=__name(function(){var start=this._lexer.token;return{kind:Kind.ARGUMENT,name:this.parseName(),value:(this.expectToken(TokenKind.COLON),this.parseValueLiteral(!0)),loc:this.loc(start)}},"parseConstArgument"),_proto.parseFragment=__name(function(){var start=this._lexer.token;this.expectToken(TokenKind.SPREAD);var hasTypeCondition=this.expectOptionalKeyword("on");return!hasTypeCondition&&this.peek(TokenKind.NAME)?{kind:Kind.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(start)}:{kind:Kind.INLINE_FRAGMENT,typeCondition:hasTypeCondition?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(start)}},"parseFragment"),_proto.parseFragmentDefinition=__name(function(){var _this$_options,start=this._lexer.token;return this.expectKeyword("fragment"),((_this$_options=this._options)===null||_this$_options===void 0?void 0:_this$_options.experimentalFragmentVariables)===!0?{kind:Kind.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(start)}:{kind:Kind.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(start)}},"parseFragmentDefinition"),_proto.parseFragmentName=__name(function(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()},"parseFragmentName"),_proto.parseValueLiteral=__name(function(isConst){var token=this._lexer.token;switch(token.kind){case TokenKind.BRACKET_L:return this.parseList(isConst);case TokenKind.BRACE_L:return this.parseObject(isConst);case TokenKind.INT:return this._lexer.advance(),{kind:Kind.INT,value:token.value,loc:this.loc(token)};case TokenKind.FLOAT:return this._lexer.advance(),{kind:Kind.FLOAT,value:token.value,loc:this.loc(token)};case TokenKind.STRING:case TokenKind.BLOCK_STRING:return this.parseStringLiteral();case TokenKind.NAME:switch(this._lexer.advance(),token.value){case"true":return{kind:Kind.BOOLEAN,value:!0,loc:this.loc(token)};case"false":return{kind:Kind.BOOLEAN,value:!1,loc:this.loc(token)};case"null":return{kind:Kind.NULL,loc:this.loc(token)};default:return{kind:Kind.ENUM,value:token.value,loc:this.loc(token)}}case TokenKind.DOLLAR:if(!isConst)return this.parseVariable();break}throw this.unexpected()},"parseValueLiteral"),_proto.parseStringLiteral=__name(function(){var token=this._lexer.token;return this._lexer.advance(),{kind:Kind.STRING,value:token.value,block:token.kind===TokenKind.BLOCK_STRING,loc:this.loc(token)}},"parseStringLiteral"),_proto.parseList=__name(function(isConst){var _this=this,start=this._lexer.token,item=__name(function(){return _this.parseValueLiteral(isConst)},"item");return{kind:Kind.LIST,values:this.any(TokenKind.BRACKET_L,item,TokenKind.BRACKET_R),loc:this.loc(start)}},"parseList"),_proto.parseObject=__name(function(isConst){var _this2=this,start=this._lexer.token,item=__name(function(){return _this2.parseObjectField(isConst)},"item");return{kind:Kind.OBJECT,fields:this.any(TokenKind.BRACE_L,item,TokenKind.BRACE_R),loc:this.loc(start)}},"parseObject"),_proto.parseObjectField=__name(function(isConst){var start=this._lexer.token,name=this.parseName();return this.expectToken(TokenKind.COLON),{kind:Kind.OBJECT_FIELD,name,value:this.parseValueLiteral(isConst),loc:this.loc(start)}},"parseObjectField"),_proto.parseDirectives=__name(function(isConst){for(var directives=[];this.peek(TokenKind.AT);)directives.push(this.parseDirective(isConst));return directives},"parseDirectives"),_proto.parseDirective=__name(function(isConst){var start=this._lexer.token;return this.expectToken(TokenKind.AT),{kind:Kind.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(isConst),loc:this.loc(start)}},"parseDirective"),_proto.parseTypeReference=__name(function(){var start=this._lexer.token,type;return this.expectOptionalToken(TokenKind.BRACKET_L)?(type=this.parseTypeReference(),this.expectToken(TokenKind.BRACKET_R),type={kind:Kind.LIST_TYPE,type,loc:this.loc(start)}):type=this.parseNamedType(),this.expectOptionalToken(TokenKind.BANG)?{kind:Kind.NON_NULL_TYPE,type,loc:this.loc(start)}:type},"parseTypeReference"),_proto.parseNamedType=__name(function(){var start=this._lexer.token;return{kind:Kind.NAMED_TYPE,name:this.parseName(),loc:this.loc(start)}},"parseNamedType"),_proto.parseTypeSystemDefinition=__name(function(){var keywordToken=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(keywordToken.kind===TokenKind.NAME)switch(keywordToken.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(keywordToken)},"parseTypeSystemDefinition"),_proto.peekDescription=__name(function(){return this.peek(TokenKind.STRING)||this.peek(TokenKind.BLOCK_STRING)},"peekDescription"),_proto.parseDescription=__name(function(){if(this.peekDescription())return this.parseStringLiteral()},"parseDescription"),_proto.parseSchemaDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("schema");var directives=this.parseDirectives(!0),operationTypes=this.many(TokenKind.BRACE_L,this.parseOperationTypeDefinition,TokenKind.BRACE_R);return{kind:Kind.SCHEMA_DEFINITION,description,directives,operationTypes,loc:this.loc(start)}},"parseSchemaDefinition"),_proto.parseOperationTypeDefinition=__name(function(){var start=this._lexer.token,operation=this.parseOperationType();this.expectToken(TokenKind.COLON);var type=this.parseNamedType();return{kind:Kind.OPERATION_TYPE_DEFINITION,operation,type,loc:this.loc(start)}},"parseOperationTypeDefinition"),_proto.parseScalarTypeDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("scalar");var name=this.parseName(),directives=this.parseDirectives(!0);return{kind:Kind.SCALAR_TYPE_DEFINITION,description,name,directives,loc:this.loc(start)}},"parseScalarTypeDefinition"),_proto.parseObjectTypeDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("type");var name=this.parseName(),interfaces=this.parseImplementsInterfaces(),directives=this.parseDirectives(!0),fields=this.parseFieldsDefinition();return{kind:Kind.OBJECT_TYPE_DEFINITION,description,name,interfaces,directives,fields,loc:this.loc(start)}},"parseObjectTypeDefinition"),_proto.parseImplementsInterfaces=__name(function(){var _this$_options2;if(!this.expectOptionalKeyword("implements"))return[];if(((_this$_options2=this._options)===null||_this$_options2===void 0?void 0:_this$_options2.allowLegacySDLImplementsInterfaces)===!0){var types2=[];this.expectOptionalToken(TokenKind.AMP);do types2.push(this.parseNamedType());while(this.expectOptionalToken(TokenKind.AMP)||this.peek(TokenKind.NAME));return types2}return this.delimitedMany(TokenKind.AMP,this.parseNamedType)},"parseImplementsInterfaces"),_proto.parseFieldsDefinition=__name(function(){var _this$_options3;return((_this$_options3=this._options)===null||_this$_options3===void 0?void 0:_this$_options3.allowLegacySDLEmptyFields)===!0&&this.peek(TokenKind.BRACE_L)&&this._lexer.lookahead().kind===TokenKind.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(TokenKind.BRACE_L,this.parseFieldDefinition,TokenKind.BRACE_R)},"parseFieldsDefinition"),_proto.parseFieldDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription(),name=this.parseName(),args=this.parseArgumentDefs();this.expectToken(TokenKind.COLON);var type=this.parseTypeReference(),directives=this.parseDirectives(!0);return{kind:Kind.FIELD_DEFINITION,description,name,arguments:args,type,directives,loc:this.loc(start)}},"parseFieldDefinition"),_proto.parseArgumentDefs=__name(function(){return this.optionalMany(TokenKind.PAREN_L,this.parseInputValueDef,TokenKind.PAREN_R)},"parseArgumentDefs"),_proto.parseInputValueDef=__name(function(){var start=this._lexer.token,description=this.parseDescription(),name=this.parseName();this.expectToken(TokenKind.COLON);var type=this.parseTypeReference(),defaultValue;this.expectOptionalToken(TokenKind.EQUALS)&&(defaultValue=this.parseValueLiteral(!0));var directives=this.parseDirectives(!0);return{kind:Kind.INPUT_VALUE_DEFINITION,description,name,type,defaultValue,directives,loc:this.loc(start)}},"parseInputValueDef"),_proto.parseInterfaceTypeDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("interface");var name=this.parseName(),interfaces=this.parseImplementsInterfaces(),directives=this.parseDirectives(!0),fields=this.parseFieldsDefinition();return{kind:Kind.INTERFACE_TYPE_DEFINITION,description,name,interfaces,directives,fields,loc:this.loc(start)}},"parseInterfaceTypeDefinition"),_proto.parseUnionTypeDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("union");var name=this.parseName(),directives=this.parseDirectives(!0),types2=this.parseUnionMemberTypes();return{kind:Kind.UNION_TYPE_DEFINITION,description,name,directives,types:types2,loc:this.loc(start)}},"parseUnionTypeDefinition"),_proto.parseUnionMemberTypes=__name(function(){return this.expectOptionalToken(TokenKind.EQUALS)?this.delimitedMany(TokenKind.PIPE,this.parseNamedType):[]},"parseUnionMemberTypes"),_proto.parseEnumTypeDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("enum");var name=this.parseName(),directives=this.parseDirectives(!0),values2=this.parseEnumValuesDefinition();return{kind:Kind.ENUM_TYPE_DEFINITION,description,name,directives,values:values2,loc:this.loc(start)}},"parseEnumTypeDefinition"),_proto.parseEnumValuesDefinition=__name(function(){return this.optionalMany(TokenKind.BRACE_L,this.parseEnumValueDefinition,TokenKind.BRACE_R)},"parseEnumValuesDefinition"),_proto.parseEnumValueDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription(),name=this.parseName(),directives=this.parseDirectives(!0);return{kind:Kind.ENUM_VALUE_DEFINITION,description,name,directives,loc:this.loc(start)}},"parseEnumValueDefinition"),_proto.parseInputObjectTypeDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("input");var name=this.parseName(),directives=this.parseDirectives(!0),fields=this.parseInputFieldsDefinition();return{kind:Kind.INPUT_OBJECT_TYPE_DEFINITION,description,name,directives,fields,loc:this.loc(start)}},"parseInputObjectTypeDefinition"),_proto.parseInputFieldsDefinition=__name(function(){return this.optionalMany(TokenKind.BRACE_L,this.parseInputValueDef,TokenKind.BRACE_R)},"parseInputFieldsDefinition"),_proto.parseTypeSystemExtension=__name(function(){var keywordToken=this._lexer.lookahead();if(keywordToken.kind===TokenKind.NAME)switch(keywordToken.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(keywordToken)},"parseTypeSystemExtension"),_proto.parseSchemaExtension=__name(function(){var start=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var directives=this.parseDirectives(!0),operationTypes=this.optionalMany(TokenKind.BRACE_L,this.parseOperationTypeDefinition,TokenKind.BRACE_R);if(directives.length===0&&operationTypes.length===0)throw this.unexpected();return{kind:Kind.SCHEMA_EXTENSION,directives,operationTypes,loc:this.loc(start)}},"parseSchemaExtension"),_proto.parseScalarTypeExtension=__name(function(){var start=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var name=this.parseName(),directives=this.parseDirectives(!0);if(directives.length===0)throw this.unexpected();return{kind:Kind.SCALAR_TYPE_EXTENSION,name,directives,loc:this.loc(start)}},"parseScalarTypeExtension"),_proto.parseObjectTypeExtension=__name(function(){var start=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var name=this.parseName(),interfaces=this.parseImplementsInterfaces(),directives=this.parseDirectives(!0),fields=this.parseFieldsDefinition();if(interfaces.length===0&&directives.length===0&&fields.length===0)throw this.unexpected();return{kind:Kind.OBJECT_TYPE_EXTENSION,name,interfaces,directives,fields,loc:this.loc(start)}},"parseObjectTypeExtension"),_proto.parseInterfaceTypeExtension=__name(function(){var start=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var name=this.parseName(),interfaces=this.parseImplementsInterfaces(),directives=this.parseDirectives(!0),fields=this.parseFieldsDefinition();if(interfaces.length===0&&directives.length===0&&fields.length===0)throw this.unexpected();return{kind:Kind.INTERFACE_TYPE_EXTENSION,name,interfaces,directives,fields,loc:this.loc(start)}},"parseInterfaceTypeExtension"),_proto.parseUnionTypeExtension=__name(function(){var start=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var name=this.parseName(),directives=this.parseDirectives(!0),types2=this.parseUnionMemberTypes();if(directives.length===0&&types2.length===0)throw this.unexpected();return{kind:Kind.UNION_TYPE_EXTENSION,name,directives,types:types2,loc:this.loc(start)}},"parseUnionTypeExtension"),_proto.parseEnumTypeExtension=__name(function(){var start=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var name=this.parseName(),directives=this.parseDirectives(!0),values2=this.parseEnumValuesDefinition();if(directives.length===0&&values2.length===0)throw this.unexpected();return{kind:Kind.ENUM_TYPE_EXTENSION,name,directives,values:values2,loc:this.loc(start)}},"parseEnumTypeExtension"),_proto.parseInputObjectTypeExtension=__name(function(){var start=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var name=this.parseName(),directives=this.parseDirectives(!0),fields=this.parseInputFieldsDefinition();if(directives.length===0&&fields.length===0)throw this.unexpected();return{kind:Kind.INPUT_OBJECT_TYPE_EXTENSION,name,directives,fields,loc:this.loc(start)}},"parseInputObjectTypeExtension"),_proto.parseDirectiveDefinition=__name(function(){var start=this._lexer.token,description=this.parseDescription();this.expectKeyword("directive"),this.expectToken(TokenKind.AT);var name=this.parseName(),args=this.parseArgumentDefs(),repeatable=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var locations=this.parseDirectiveLocations();return{kind:Kind.DIRECTIVE_DEFINITION,description,name,arguments:args,repeatable,locations,loc:this.loc(start)}},"parseDirectiveDefinition"),_proto.parseDirectiveLocations=__name(function(){return this.delimitedMany(TokenKind.PIPE,this.parseDirectiveLocation)},"parseDirectiveLocations"),_proto.parseDirectiveLocation=__name(function(){var start=this._lexer.token,name=this.parseName();if(DirectiveLocation[name.value]!==void 0)return name;throw this.unexpected(start)},"parseDirectiveLocation"),_proto.loc=__name(function(startToken){var _this$_options4;if(((_this$_options4=this._options)===null||_this$_options4===void 0?void 0:_this$_options4.noLocation)!==!0)return new Location(startToken,this._lexer.lastToken,this._lexer.source)},"loc"),_proto.peek=__name(function(kind){return this._lexer.token.kind===kind},"peek"),_proto.expectToken=__name(function(kind){var token=this._lexer.token;if(token.kind===kind)return this._lexer.advance(),token;throw syntaxError(this._lexer.source,token.start,"Expected ".concat(getTokenKindDesc(kind),", found ").concat(getTokenDesc(token),"."))},"expectToken"),_proto.expectOptionalToken=__name(function(kind){var token=this._lexer.token;if(token.kind===kind)return this._lexer.advance(),token},"expectOptionalToken"),_proto.expectKeyword=__name(function(value){var token=this._lexer.token;if(token.kind===TokenKind.NAME&&token.value===value)this._lexer.advance();else throw syntaxError(this._lexer.source,token.start,'Expected "'.concat(value,'", found ').concat(getTokenDesc(token),"."))},"expectKeyword"),_proto.expectOptionalKeyword=__name(function(value){var token=this._lexer.token;return token.kind===TokenKind.NAME&&token.value===value?(this._lexer.advance(),!0):!1},"expectOptionalKeyword"),_proto.unexpected=__name(function(atToken){var token=atToken??this._lexer.token;return syntaxError(this._lexer.source,token.start,"Unexpected ".concat(getTokenDesc(token),"."))},"unexpected"),_proto.any=__name(function(openKind,parseFn,closeKind){this.expectToken(openKind);for(var nodes=[];!this.expectOptionalToken(closeKind);)nodes.push(parseFn.call(this));return nodes},"any"),_proto.optionalMany=__name(function(openKind,parseFn,closeKind){if(this.expectOptionalToken(openKind)){var nodes=[];do nodes.push(parseFn.call(this));while(!this.expectOptionalToken(closeKind));return nodes}return[]},"optionalMany"),_proto.many=__name(function(openKind,parseFn,closeKind){this.expectToken(openKind);var nodes=[];do nodes.push(parseFn.call(this));while(!this.expectOptionalToken(closeKind));return nodes},"many"),_proto.delimitedMany=__name(function(delimiterKind,parseFn){this.expectOptionalToken(delimiterKind);var nodes=[];do nodes.push(parseFn.call(this));while(this.expectOptionalToken(delimiterKind));return nodes},"delimitedMany"),Parser3}();function getTokenDesc(token){var value=token.value;return getTokenKindDesc(token.kind)+(value!=null?' "'.concat(value,'"'):"")}__name(getTokenDesc,"getTokenDesc");function getTokenKindDesc(kind){return isPunctuatorTokenKind(kind)?'"'.concat(kind,'"'):kind}__name(getTokenKindDesc,"getTokenKindDesc");var QueryDocumentKeys={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},BREAK=Object.freeze({});function visit(root,visitor){var visitorKeys=arguments.length>2&&arguments[2]!==void 0?arguments[2]:QueryDocumentKeys,stack=void 0,inArray=Array.isArray(root),keys2=[root],index=-1,edits=[],node2=void 0,key=void 0,parent=void 0,path=[],ancestors=[],newRoot=root;do{index++;var isLeaving=index===keys2.length,isEdited=isLeaving&&edits.length!==0;if(isLeaving){if(key=ancestors.length===0?void 0:path[path.length-1],node2=parent,parent=ancestors.pop(),isEdited){if(inArray)node2=node2.slice();else{for(var clone={},_i2=0,_Object$keys2=Object.keys(node2);_i2<_Object$keys2.length;_i2++){var k=_Object$keys2[_i2];clone[k]=node2[k]}node2=clone}for(var editOffset=0,ii=0;ii<edits.length;ii++){var editKey=edits[ii][0],editValue=edits[ii][1];inArray&&(editKey-=editOffset),inArray&&editValue===null?(node2.splice(editKey,1),editOffset++):node2[editKey]=editValue}}index=stack.index,keys2=stack.keys,edits=stack.edits,inArray=stack.inArray,stack=stack.prev}else{if(key=parent?inArray?index:keys2[index]:void 0,node2=parent?parent[key]:newRoot,node2==null)continue;parent&&path.push(key)}var result=void 0;if(!Array.isArray(node2)){if(!isNode(node2))throw new Error("Invalid AST Node: ".concat(inspect(node2),"."));var visitFn=getVisitFn(visitor,node2.kind,isLeaving);if(visitFn){if(result=visitFn.call(visitor,node2,key,parent,path,ancestors),result===BREAK)break;if(result===!1){if(!isLeaving){path.pop();continue}}else if(result!==void 0&&(edits.push([key,result]),!isLeaving))if(isNode(result))node2=result;else{path.pop();continue}}}if(result===void 0&&isEdited&&edits.push([key,node2]),isLeaving)path.pop();else{var _visitorKeys$node$kin;stack={inArray,index,keys:keys2,edits,prev:stack},inArray=Array.isArray(node2),keys2=inArray?node2:(_visitorKeys$node$kin=visitorKeys[node2.kind])!==null&&_visitorKeys$node$kin!==void 0?_visitorKeys$node$kin:[],index=-1,edits=[],parent&&ancestors.push(parent),parent=node2}}while(stack!==void 0);return edits.length!==0&&(newRoot=edits[edits.length-1][1]),newRoot}__name(visit,"visit");function visitInParallel(visitors){var skipping=new Array(visitors.length);return{enter:__name(function(node2){for(var i=0;i<visitors.length;i++)if(skipping[i]==null){var fn=getVisitFn(visitors[i],node2.kind,!1);if(fn){var result=fn.apply(visitors[i],arguments);if(result===!1)skipping[i]=node2;else if(result===BREAK)skipping[i]=BREAK;else if(result!==void 0)return result}}},"enter"),leave:__name(function(node2){for(var i=0;i<visitors.length;i++)if(skipping[i]==null){var fn=getVisitFn(visitors[i],node2.kind,!0);if(fn){var result=fn.apply(visitors[i],arguments);if(result===BREAK)skipping[i]=BREAK;else if(result!==void 0&&result!==!1)return result}}else skipping[i]===node2&&(skipping[i]=null)},"leave")}}__name(visitInParallel,"visitInParallel");function getVisitFn(visitor,kind,isLeaving){var kindVisitor=visitor[kind];if(kindVisitor){if(!isLeaving&&typeof kindVisitor=="function")return kindVisitor;var kindSpecificVisitor=isLeaving?kindVisitor.leave:kindVisitor.enter;if(typeof kindSpecificVisitor=="function")return kindSpecificVisitor}else{var specificVisitor=isLeaving?visitor.leave:visitor.enter;if(specificVisitor){if(typeof specificVisitor=="function")return specificVisitor;var specificKindVisitor=specificVisitor[kind];if(typeof specificKindVisitor=="function")return specificKindVisitor}}}__name(getVisitFn,"getVisitFn");function print(ast){return visit(ast,{leave:printDocASTReducer})}__name(print,"print");var MAX_LINE_LENGTH=80,printDocASTReducer={Name:__name(function(node2){return node2.value},"Name"),Variable:__name(function(node2){return"$"+node2.name},"Variable"),Document:__name(function(node2){return join2(node2.definitions,`

`)+`
`},"Document"),OperationDefinition:__name(function(node2){var op=node2.operation,name=node2.name,varDefs=wrap("(",join2(node2.variableDefinitions,", "),")"),directives=join2(node2.directives," "),selectionSet=node2.selectionSet;return!name&&!directives&&!varDefs&&op==="query"?selectionSet:join2([op,join2([name,varDefs]),directives,selectionSet]," ")},"OperationDefinition"),VariableDefinition:__name(function(_ref){var variable=_ref.variable,type=_ref.type,defaultValue=_ref.defaultValue,directives=_ref.directives;return variable+": "+type+wrap(" = ",defaultValue)+wrap(" ",join2(directives," "))},"VariableDefinition"),SelectionSet:__name(function(_ref2){var selections=_ref2.selections;return block(selections)},"SelectionSet"),Field:__name(function(_ref3){var alias=_ref3.alias,name=_ref3.name,args=_ref3.arguments,directives=_ref3.directives,selectionSet=_ref3.selectionSet,prefix=wrap("",alias,": ")+name,argsLine=prefix+wrap("(",join2(args,", "),")");return argsLine.length>MAX_LINE_LENGTH&&(argsLine=prefix+wrap(`(
`,indent(join2(args,`
`)),`
)`)),join2([argsLine,join2(directives," "),selectionSet]," ")},"Field"),Argument:__name(function(_ref4){var name=_ref4.name,value=_ref4.value;return name+": "+value},"Argument"),FragmentSpread:__name(function(_ref5){var name=_ref5.name,directives=_ref5.directives;return"..."+name+wrap(" ",join2(directives," "))},"FragmentSpread"),InlineFragment:__name(function(_ref6){var typeCondition=_ref6.typeCondition,directives=_ref6.directives,selectionSet=_ref6.selectionSet;return join2(["...",wrap("on ",typeCondition),join2(directives," "),selectionSet]," ")},"InlineFragment"),FragmentDefinition:__name(function(_ref7){var name=_ref7.name,typeCondition=_ref7.typeCondition,variableDefinitions=_ref7.variableDefinitions,directives=_ref7.directives,selectionSet=_ref7.selectionSet;return"fragment ".concat(name).concat(wrap("(",join2(variableDefinitions,", "),")")," ")+"on ".concat(typeCondition," ").concat(wrap("",join2(directives," ")," "))+selectionSet},"FragmentDefinition"),IntValue:__name(function(_ref8){var value=_ref8.value;return value},"IntValue"),FloatValue:__name(function(_ref9){var value=_ref9.value;return value},"FloatValue"),StringValue:__name(function(_ref10,key){var value=_ref10.value,isBlockString=_ref10.block;return isBlockString?printBlockString(value,key==="description"?"":"  "):JSON.stringify(value)},"StringValue"),BooleanValue:__name(function(_ref11){var value=_ref11.value;return value?"true":"false"},"BooleanValue"),NullValue:__name(function(){return"null"},"NullValue"),EnumValue:__name(function(_ref12){var value=_ref12.value;return value},"EnumValue"),ListValue:__name(function(_ref13){var values2=_ref13.values;return"["+join2(values2,", ")+"]"},"ListValue"),ObjectValue:__name(function(_ref14){var fields=_ref14.fields;return"{"+join2(fields,", ")+"}"},"ObjectValue"),ObjectField:__name(function(_ref15){var name=_ref15.name,value=_ref15.value;return name+": "+value},"ObjectField"),Directive:__name(function(_ref16){var name=_ref16.name,args=_ref16.arguments;return"@"+name+wrap("(",join2(args,", "),")")},"Directive"),NamedType:__name(function(_ref17){var name=_ref17.name;return name},"NamedType"),ListType:__name(function(_ref18){var type=_ref18.type;return"["+type+"]"},"ListType"),NonNullType:__name(function(_ref19){var type=_ref19.type;return type+"!"},"NonNullType"),SchemaDefinition:addDescription(function(_ref20){var directives=_ref20.directives,operationTypes=_ref20.operationTypes;return join2(["schema",join2(directives," "),block(operationTypes)]," ")}),OperationTypeDefinition:__name(function(_ref21){var operation=_ref21.operation,type=_ref21.type;return operation+": "+type},"OperationTypeDefinition"),ScalarTypeDefinition:addDescription(function(_ref22){var name=_ref22.name,directives=_ref22.directives;return join2(["scalar",name,join2(directives," ")]," ")}),ObjectTypeDefinition:addDescription(function(_ref23){var name=_ref23.name,interfaces=_ref23.interfaces,directives=_ref23.directives,fields=_ref23.fields;return join2(["type",name,wrap("implements ",join2(interfaces," & ")),join2(directives," "),block(fields)]," ")}),FieldDefinition:addDescription(function(_ref24){var name=_ref24.name,args=_ref24.arguments,type=_ref24.type,directives=_ref24.directives;return name+(hasMultilineItems(args)?wrap(`(
`,indent(join2(args,`
`)),`
)`):wrap("(",join2(args,", "),")"))+": "+type+wrap(" ",join2(directives," "))}),InputValueDefinition:addDescription(function(_ref25){var name=_ref25.name,type=_ref25.type,defaultValue=_ref25.defaultValue,directives=_ref25.directives;return join2([name+": "+type,wrap("= ",defaultValue),join2(directives," ")]," ")}),InterfaceTypeDefinition:addDescription(function(_ref26){var name=_ref26.name,interfaces=_ref26.interfaces,directives=_ref26.directives,fields=_ref26.fields;return join2(["interface",name,wrap("implements ",join2(interfaces," & ")),join2(directives," "),block(fields)]," ")}),UnionTypeDefinition:addDescription(function(_ref27){var name=_ref27.name,directives=_ref27.directives,types2=_ref27.types;return join2(["union",name,join2(directives," "),types2&&types2.length!==0?"= "+join2(types2," | "):""]," ")}),EnumTypeDefinition:addDescription(function(_ref28){var name=_ref28.name,directives=_ref28.directives,values2=_ref28.values;return join2(["enum",name,join2(directives," "),block(values2)]," ")}),EnumValueDefinition:addDescription(function(_ref29){var name=_ref29.name,directives=_ref29.directives;return join2([name,join2(directives," ")]," ")}),InputObjectTypeDefinition:addDescription(function(_ref30){var name=_ref30.name,directives=_ref30.directives,fields=_ref30.fields;return join2(["input",name,join2(directives," "),block(fields)]," ")}),DirectiveDefinition:addDescription(function(_ref31){var name=_ref31.name,args=_ref31.arguments,repeatable=_ref31.repeatable,locations=_ref31.locations;return"directive @"+name+(hasMultilineItems(args)?wrap(`(
`,indent(join2(args,`
`)),`
)`):wrap("(",join2(args,", "),")"))+(repeatable?" repeatable":"")+" on "+join2(locations," | ")}),SchemaExtension:__name(function(_ref32){var directives=_ref32.directives,operationTypes=_ref32.operationTypes;return join2(["extend schema",join2(directives," "),block(operationTypes)]," ")},"SchemaExtension"),ScalarTypeExtension:__name(function(_ref33){var name=_ref33.name,directives=_ref33.directives;return join2(["extend scalar",name,join2(directives," ")]," ")},"ScalarTypeExtension"),ObjectTypeExtension:__name(function(_ref34){var name=_ref34.name,interfaces=_ref34.interfaces,directives=_ref34.directives,fields=_ref34.fields;return join2(["extend type",name,wrap("implements ",join2(interfaces," & ")),join2(directives," "),block(fields)]," ")},"ObjectTypeExtension"),InterfaceTypeExtension:__name(function(_ref35){var name=_ref35.name,interfaces=_ref35.interfaces,directives=_ref35.directives,fields=_ref35.fields;return join2(["extend interface",name,wrap("implements ",join2(interfaces," & ")),join2(directives," "),block(fields)]," ")},"InterfaceTypeExtension"),UnionTypeExtension:__name(function(_ref36){var name=_ref36.name,directives=_ref36.directives,types2=_ref36.types;return join2(["extend union",name,join2(directives," "),types2&&types2.length!==0?"= "+join2(types2," | "):""]," ")},"UnionTypeExtension"),EnumTypeExtension:__name(function(_ref37){var name=_ref37.name,directives=_ref37.directives,values2=_ref37.values;return join2(["extend enum",name,join2(directives," "),block(values2)]," ")},"EnumTypeExtension"),InputObjectTypeExtension:__name(function(_ref38){var name=_ref38.name,directives=_ref38.directives,fields=_ref38.fields;return join2(["extend input",name,join2(directives," "),block(fields)]," ")},"InputObjectTypeExtension")};function addDescription(cb){return function(node2){return join2([node2.description,cb(node2)],`
`)}}__name(addDescription,"addDescription");function join2(maybeArray){var _maybeArray$filter$jo,separator=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return(_maybeArray$filter$jo=maybeArray==null?void 0:maybeArray.filter(function(x){return x}).join(separator))!==null&&_maybeArray$filter$jo!==void 0?_maybeArray$filter$jo:""}__name(join2,"join");function block(array){return wrap(`{
`,indent(join2(array,`
`)),`
}`)}__name(block,"block");function wrap(start,maybeString){var end=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return maybeString!=null&&maybeString!==""?start+maybeString+end:""}__name(wrap,"wrap");function indent(str){return wrap("  ",str.replace(/\n/g,`
  `))}__name(indent,"indent");function isMultiline(str){return str.indexOf(`
`)!==-1}__name(isMultiline,"isMultiline");function hasMultilineItems(maybeArray){return maybeArray!=null&&maybeArray.some(isMultiline)}__name(hasMultilineItems,"hasMultilineItems");function isDefinitionNode(node2){return isExecutableDefinitionNode(node2)||isTypeSystemDefinitionNode(node2)||isTypeSystemExtensionNode(node2)}__name(isDefinitionNode,"isDefinitionNode");function isExecutableDefinitionNode(node2){return node2.kind===Kind.OPERATION_DEFINITION||node2.kind===Kind.FRAGMENT_DEFINITION}__name(isExecutableDefinitionNode,"isExecutableDefinitionNode");function isSelectionNode(node2){return node2.kind===Kind.FIELD||node2.kind===Kind.FRAGMENT_SPREAD||node2.kind===Kind.INLINE_FRAGMENT}__name(isSelectionNode,"isSelectionNode");function isValueNode(node2){return node2.kind===Kind.VARIABLE||node2.kind===Kind.INT||node2.kind===Kind.FLOAT||node2.kind===Kind.STRING||node2.kind===Kind.BOOLEAN||node2.kind===Kind.NULL||node2.kind===Kind.ENUM||node2.kind===Kind.LIST||node2.kind===Kind.OBJECT}__name(isValueNode,"isValueNode");function isTypeNode(node2){return node2.kind===Kind.NAMED_TYPE||node2.kind===Kind.LIST_TYPE||node2.kind===Kind.NON_NULL_TYPE}__name(isTypeNode,"isTypeNode");function isTypeSystemDefinitionNode(node2){return node2.kind===Kind.SCHEMA_DEFINITION||isTypeDefinitionNode(node2)||node2.kind===Kind.DIRECTIVE_DEFINITION}__name(isTypeSystemDefinitionNode,"isTypeSystemDefinitionNode");function isTypeDefinitionNode(node2){return node2.kind===Kind.SCALAR_TYPE_DEFINITION||node2.kind===Kind.OBJECT_TYPE_DEFINITION||node2.kind===Kind.INTERFACE_TYPE_DEFINITION||node2.kind===Kind.UNION_TYPE_DEFINITION||node2.kind===Kind.ENUM_TYPE_DEFINITION||node2.kind===Kind.INPUT_OBJECT_TYPE_DEFINITION}__name(isTypeDefinitionNode,"isTypeDefinitionNode");function isTypeSystemExtensionNode(node2){return node2.kind===Kind.SCHEMA_EXTENSION||isTypeExtensionNode(node2)}__name(isTypeSystemExtensionNode,"isTypeSystemExtensionNode");function isTypeExtensionNode(node2){return node2.kind===Kind.SCALAR_TYPE_EXTENSION||node2.kind===Kind.OBJECT_TYPE_EXTENSION||node2.kind===Kind.INTERFACE_TYPE_EXTENSION||node2.kind===Kind.UNION_TYPE_EXTENSION||node2.kind===Kind.ENUM_TYPE_EXTENSION||node2.kind===Kind.INPUT_OBJECT_TYPE_EXTENSION}__name(isTypeExtensionNode,"isTypeExtensionNode");const language=Object.freeze(Object.defineProperty({__proto__:null,BREAK,DirectiveLocation,Kind,Lexer,Location,Source,Token,TokenKind,getLocation,getVisitFn,isDefinitionNode,isExecutableDefinitionNode,isSelectionNode,isTypeDefinitionNode,isTypeExtensionNode,isTypeNode,isTypeSystemDefinitionNode,isTypeSystemExtensionNode,isValueNode,parse:parse$1,parseType,parseValue,print,printLocation,printSourceLocation,visit,visitInParallel},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(language);var Util$a={},jsonldContextParser={},ContextParser={},relativeToAbsoluteIri={},Resolve={};Object.defineProperty(Resolve,"__esModule",{value:!0});Resolve.removeDotSegmentsOfPath=Resolve.removeDotSegments=Resolve.resolve=void 0;function resolve(relativeIRI,baseIRI){baseIRI=baseIRI||"";const baseFragmentPos=baseIRI.indexOf("#");if(baseFragmentPos>0&&(baseIRI=baseIRI.substr(0,baseFragmentPos)),!relativeIRI.length){if(baseIRI.indexOf(":")<0)throw new Error(`Found invalid baseIRI '${baseIRI}' for value '${relativeIRI}'`);return baseIRI}if(relativeIRI.startsWith("?")){const baseQueryPos=baseIRI.indexOf("?");return baseQueryPos>0&&(baseIRI=baseIRI.substr(0,baseQueryPos)),baseIRI+relativeIRI}if(relativeIRI.startsWith("#"))return baseIRI+relativeIRI;if(!baseIRI.length){const relativeColonPos=relativeIRI.indexOf(":");if(relativeColonPos<0)throw new Error(`Found invalid relative IRI '${relativeIRI}' for a missing baseIRI`);return removeDotSegmentsOfPath(relativeIRI,relativeColonPos)}const valueColonPos=relativeIRI.indexOf(":");if(valueColonPos>=0)return removeDotSegmentsOfPath(relativeIRI,valueColonPos);const baseColonPos=baseIRI.indexOf(":");if(baseColonPos<0)throw new Error(`Found invalid baseIRI '${baseIRI}' for value '${relativeIRI}'`);const baseIRIScheme=baseIRI.substr(0,baseColonPos+1);if(relativeIRI.indexOf("//")===0)return baseIRIScheme+removeDotSegmentsOfPath(relativeIRI,valueColonPos);let baseSlashAfterColonPos;if(baseIRI.indexOf("//",baseColonPos)===baseColonPos+1){if(baseSlashAfterColonPos=baseIRI.indexOf("/",baseColonPos+3),baseSlashAfterColonPos<0)return baseIRI.length>baseColonPos+3?baseIRI+"/"+removeDotSegmentsOfPath(relativeIRI,valueColonPos):baseIRIScheme+removeDotSegmentsOfPath(relativeIRI,valueColonPos)}else if(baseSlashAfterColonPos=baseIRI.indexOf("/",baseColonPos+1),baseSlashAfterColonPos<0)return baseIRIScheme+removeDotSegmentsOfPath(relativeIRI,valueColonPos);if(relativeIRI.indexOf("/")===0)return baseIRI.substr(0,baseSlashAfterColonPos)+removeDotSegments(relativeIRI);let baseIRIPath=baseIRI.substr(baseSlashAfterColonPos);const baseIRILastSlashPos=baseIRIPath.lastIndexOf("/");return baseIRILastSlashPos>=0&&baseIRILastSlashPos<baseIRIPath.length-1&&(baseIRIPath=baseIRIPath.substr(0,baseIRILastSlashPos+1),relativeIRI[0]==="."&&relativeIRI[1]!=="."&&relativeIRI[1]!=="/"&&relativeIRI[2]&&(relativeIRI=relativeIRI.substr(1))),relativeIRI=baseIRIPath+relativeIRI,relativeIRI=removeDotSegments(relativeIRI),baseIRI.substr(0,baseSlashAfterColonPos)+relativeIRI}__name(resolve,"resolve");Resolve.resolve=resolve;function removeDotSegments(path){const segmentBuffers=[];let i=0;for(;i<path.length;)switch(path[i]){case"/":if(path[i+1]===".")if(path[i+2]==="."){if(!isCharacterAllowedAfterRelativePathSegment(path[i+3])){segmentBuffers.push([]),i++;break}segmentBuffers.pop(),path[i+3]||segmentBuffers.push([]),i+=3}else{if(!isCharacterAllowedAfterRelativePathSegment(path[i+2])){segmentBuffers.push([]),i++;break}path[i+2]||segmentBuffers.push([]),i+=2}else segmentBuffers.push([]),i++;break;case"#":case"?":segmentBuffers.length||segmentBuffers.push([]),segmentBuffers[segmentBuffers.length-1].push(path.substr(i)),i=path.length;break;default:segmentBuffers.length||segmentBuffers.push([]),segmentBuffers[segmentBuffers.length-1].push(path[i]),i++;break}return"/"+segmentBuffers.map(buffer=>buffer.join("")).join("/")}__name(removeDotSegments,"removeDotSegments");Resolve.removeDotSegments=removeDotSegments;function removeDotSegmentsOfPath(iri,colonPosition){let searchOffset=colonPosition+1;colonPosition>=0?iri[colonPosition+1]==="/"&&iri[colonPosition+2]==="/"&&(searchOffset=colonPosition+3):iri[0]==="/"&&iri[1]==="/"&&(searchOffset=2);const pathSeparator=iri.indexOf("/",searchOffset);if(pathSeparator<0)return iri;const base=iri.substr(0,pathSeparator),path=iri.substr(pathSeparator);return base+removeDotSegments(path)}__name(removeDotSegmentsOfPath,"removeDotSegmentsOfPath");Resolve.removeDotSegmentsOfPath=removeDotSegmentsOfPath;function isCharacterAllowedAfterRelativePathSegment(character){return!character||character==="#"||character==="?"||character==="/"}__name(isCharacterAllowedAfterRelativePathSegment,"isCharacterAllowedAfterRelativePathSegment");(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(Resolve,exports)})(relativeToAbsoluteIri);var ErrorCoded={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ERROR_CODES=exports.ErrorCoded=void 0;class ErrorCoded2 extends Error{constructor(message,code){super(message),this.code=code}}__name(ErrorCoded2,"ErrorCoded"),exports.ErrorCoded=ErrorCoded2,function(ERROR_CODES){ERROR_CODES.COLLIDING_KEYWORDS="colliding keywords",ERROR_CODES.CONFLICTING_INDEXES="conflicting indexes",ERROR_CODES.CYCLIC_IRI_MAPPING="cyclic IRI mapping",ERROR_CODES.INVALID_ID_VALUE="invalid @id value",ERROR_CODES.INVALID_INDEX_VALUE="invalid @index value",ERROR_CODES.INVALID_NEST_VALUE="invalid @nest value",ERROR_CODES.INVALID_PREFIX_VALUE="invalid @prefix value",ERROR_CODES.INVALID_PROPAGATE_VALUE="invalid @propagate value",ERROR_CODES.INVALID_REVERSE_VALUE="invalid @reverse value",ERROR_CODES.INVALID_IMPORT_VALUE="invalid @import value",ERROR_CODES.INVALID_VERSION_VALUE="invalid @version value",ERROR_CODES.INVALID_BASE_IRI="invalid base IRI",ERROR_CODES.INVALID_CONTAINER_MAPPING="invalid container mapping",ERROR_CODES.INVALID_CONTEXT_ENTRY="invalid context entry",ERROR_CODES.INVALID_CONTEXT_NULLIFICATION="invalid context nullification",ERROR_CODES.INVALID_DEFAULT_LANGUAGE="invalid default language",ERROR_CODES.INVALID_INCLUDED_VALUE="invalid @included value",ERROR_CODES.INVALID_IRI_MAPPING="invalid IRI mapping",ERROR_CODES.INVALID_JSON_LITERAL="invalid JSON literal",ERROR_CODES.INVALID_KEYWORD_ALIAS="invalid keyword alias",ERROR_CODES.INVALID_LANGUAGE_MAP_VALUE="invalid language map value",ERROR_CODES.INVALID_LANGUAGE_MAPPING="invalid language mapping",ERROR_CODES.INVALID_LANGUAGE_TAGGED_STRING="invalid language-tagged string",ERROR_CODES.INVALID_LANGUAGE_TAGGED_VALUE="invalid language-tagged value",ERROR_CODES.INVALID_LOCAL_CONTEXT="invalid local context",ERROR_CODES.INVALID_REMOTE_CONTEXT="invalid remote context",ERROR_CODES.INVALID_REVERSE_PROPERTY="invalid reverse property",ERROR_CODES.INVALID_REVERSE_PROPERTY_MAP="invalid reverse property map",ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE="invalid reverse property value",ERROR_CODES.INVALID_SCOPED_CONTEXT="invalid scoped context",ERROR_CODES.INVALID_SCRIPT_ELEMENT="invalid script element",ERROR_CODES.INVALID_SET_OR_LIST_OBJECT="invalid set or list object",ERROR_CODES.INVALID_TERM_DEFINITION="invalid term definition",ERROR_CODES.INVALID_TYPE_MAPPING="invalid type mapping",ERROR_CODES.INVALID_TYPE_VALUE="invalid type value",ERROR_CODES.INVALID_TYPED_VALUE="invalid typed value",ERROR_CODES.INVALID_VALUE_OBJECT="invalid value object",ERROR_CODES.INVALID_VALUE_OBJECT_VALUE="invalid value object value",ERROR_CODES.INVALID_VOCAB_MAPPING="invalid vocab mapping",ERROR_CODES.IRI_CONFUSED_WITH_PREFIX="IRI confused with prefix",ERROR_CODES.KEYWORD_REDEFINITION="keyword redefinition",ERROR_CODES.LOADING_DOCUMENT_FAILED="loading document failed",ERROR_CODES.LOADING_REMOTE_CONTEXT_FAILED="loading remote context failed",ERROR_CODES.MULTIPLE_CONTEXT_LINK_HEADERS="multiple context link headers",ERROR_CODES.PROCESSING_MODE_CONFLICT="processing mode conflict",ERROR_CODES.PROTECTED_TERM_REDEFINITION="protected term redefinition",ERROR_CODES.CONTEXT_OVERFLOW="context overflow",ERROR_CODES.INVALID_BASE_DIRECTION="invalid base direction",ERROR_CODES.RECURSIVE_CONTEXT_INCLUSION="recursive context inclusion",ERROR_CODES.INVALID_STREAMING_KEY_ORDER="invalid streaming key order",ERROR_CODES.INVALID_EMBEDDED_NODE="invalid embedded node",ERROR_CODES.INVALID_ANNOTATION="invalid annotation"}(exports.ERROR_CODES||(exports.ERROR_CODES={}))})(ErrorCoded);var FetchDocumentLoader$1={},COMPATIBLE_ENCODING_PATTERN=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,WS_TRIM_PATTERN=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,WS_CHAR_PATTERN=/\s|\uFEFF|\xA0/,WS_FOLD_PATTERN=/\r?\n[\x20\x09]+/g,DELIMITER_PATTERN=/[;,"]/,WS_DELIMITER_PATTERN=/[;,"]|\s/,TOKEN_PATTERN=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,STATE={IDLE:1,URI:2,ATTR:4};function trim$1(value){return value.replace(WS_TRIM_PATTERN,"")}__name(trim$1,"trim$1");function hasWhitespace(value){return WS_CHAR_PATTERN.test(value)}__name(hasWhitespace,"hasWhitespace");function skipWhitespace(value,offset){for(;hasWhitespace(value[offset]);)offset++;return offset}__name(skipWhitespace,"skipWhitespace");function needsQuotes(value){return WS_DELIMITER_PATTERN.test(value)||!TOKEN_PATTERN.test(value)}__name(needsQuotes,"needsQuotes");function shallowCompareObjects(object1,object2){return Object.keys(object1).length===Object.keys(object2).length&&Object.keys(object1).every(key=>key in object2&&object1[key]===object2[key])}__name(shallowCompareObjects,"shallowCompareObjects");class Link{constructor(value){this.refs=[],value&&this.parse(value)}rel(value){for(var links=[],type=value.toLowerCase(),i=0;i<this.refs.length;i++)this.refs[i].rel.toLowerCase()===type&&links.push(this.refs[i]);return links}get(attr,value){attr=attr.toLowerCase();for(var links=[],i=0;i<this.refs.length;i++)this.refs[i][attr]===value&&links.push(this.refs[i]);return links}set(link2){return this.refs.push(link2),this}setUnique(link2){return this.refs.some(ref=>shallowCompareObjects(ref,link2))||this.refs.push(link2),this}has(attr,value){attr=attr.toLowerCase();for(var i=0;i<this.refs.length;i++)if(this.refs[i][attr]===value)return!0;return!1}parse(value,offset){offset=offset||0,value=offset?value.slice(offset):value,value=trim$1(value).replace(WS_FOLD_PATTERN,"");for(var state=STATE.IDLE,length=value.length,offset=0,ref=null;offset<length;)if(state===STATE.IDLE){if(hasWhitespace(value[offset])){offset++;continue}else if(value[offset]==="<"){ref!=null&&(ref.rel!=null?this.refs.push(...Link.expandRelations(ref)):this.refs.push(ref));var end=value.indexOf(">",offset);if(end===-1)throw new Error("Expected end of URI delimiter at offset "+offset);ref={uri:value.slice(offset+1,end)},offset=end,state=STATE.URI}else throw new Error('Unexpected character "'+value[offset]+'" at offset '+offset);offset++}else if(state===STATE.URI)if(hasWhitespace(value[offset])){offset++;continue}else if(value[offset]===";")state=STATE.ATTR,offset++;else if(value[offset]===",")state=STATE.IDLE,offset++;else throw new Error('Unexpected character "'+value[offset]+'" at offset '+offset);else if(state===STATE.ATTR){if(value[offset]===";"||hasWhitespace(value[offset])){offset++;continue}var end=value.indexOf("=",offset);end===-1&&(end=value.indexOf(";",offset)),end===-1&&(end=value.length);var attr=trim$1(value.slice(offset,end)).toLowerCase(),attrValue="";if(offset=end+1,offset=skipWhitespace(value,offset),value[offset]==='"')for(offset++;offset<length;){if(value[offset]==='"'){offset++;break}value[offset]==="\\"&&offset++,attrValue+=value[offset],offset++}else{for(var end=offset+1;!DELIMITER_PATTERN.test(value[end])&&end<length;)end++;attrValue=value.slice(offset,end),offset=end}switch(ref[attr]&&Link.isSingleOccurenceAttr(attr)||(attr[attr.length-1]==="*"?ref[attr]=Link.parseExtendedValue(attrValue):(attrValue=attr==="type"?attrValue.toLowerCase():attrValue,ref[attr]!=null?Array.isArray(ref[attr])?ref[attr].push(attrValue):ref[attr]=[ref[attr],attrValue]:ref[attr]=attrValue)),value[offset]){case",":state=STATE.IDLE;break;case";":state=STATE.ATTR;break}offset++}else throw new Error('Unknown parser state "'+state+'"');return ref!=null&&(ref.rel!=null?this.refs.push(...Link.expandRelations(ref)):this.refs.push(ref)),ref=null,this}toString(){for(var refs=[],link2="",ref=null,i=0;i<this.refs.length;i++)ref=this.refs[i],link2=Object.keys(this.refs[i]).reduce(function(link3,attr){return attr==="uri"?link3:link3+"; "+Link.formatAttribute(attr,ref[attr])},"<"+ref.uri+">"),refs.push(link2);return refs.join(", ")}}__name(Link,"Link");Link.isCompatibleEncoding=function(value){return COMPATIBLE_ENCODING_PATTERN.test(value)};Link.parse=function(value,offset){return new Link().parse(value,offset)};Link.isSingleOccurenceAttr=function(attr){return attr==="rel"||attr==="type"||attr==="media"||attr==="title"||attr==="title*"};Link.isTokenAttr=function(attr){return attr==="rel"||attr==="type"||attr==="anchor"};Link.escapeQuotes=function(value){return value.replace(/"/g,'\\"')};Link.expandRelations=function(ref){var rels=ref.rel.split(" ");return rels.map(function(rel){var value=Object.assign({},ref);return value.rel=rel,value})};Link.parseExtendedValue=function(value){var parts=/([^']+)?(?:'([^']*)')?(.+)/.exec(value);return{language:parts[2].toLowerCase(),encoding:Link.isCompatibleEncoding(parts[1])?null:parts[1].toLowerCase(),value:Link.isCompatibleEncoding(parts[1])?decodeURIComponent(parts[3]):parts[3]}};Link.formatExtendedAttribute=function(attr,data){var encoding=(data.encoding||"utf-8").toUpperCase(),language2=data.language||"en",encodedValue="";return Buffer.isBuffer(data.value)&&Link.isCompatibleEncoding(encoding)?encodedValue=data.value.toString(encoding):Buffer.isBuffer(data.value)?encodedValue=data.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):encodedValue=encodeURIComponent(data.value),attr+"="+encoding+"'"+language2+"'"+encodedValue};Link.formatAttribute=function(attr,value){return Array.isArray(value)?value.map(item=>Link.formatAttribute(attr,item)).join("; "):attr[attr.length-1]==="*"||typeof value!="string"?Link.formatExtendedAttribute(attr,value):(Link.isTokenAttr(attr)?value=needsQuotes(value)?'"'+Link.escapeQuotes(value)+'"':Link.escapeQuotes(value):needsQuotes(value)&&(value=encodeURIComponent(value),value=value.replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"),value='"'+value+'"'),attr+"="+value)};var link=Link;Object.defineProperty(FetchDocumentLoader$1,"__esModule",{value:!0});FetchDocumentLoader$1.FetchDocumentLoader=void 0;const ErrorCoded_1=ErrorCoded,http_link_header_1=link,relative_to_absolute_iri_1$8=relativeToAbsoluteIri;class FetchDocumentLoader{constructor(fetcher){this.fetcher=fetcher}async load(url){const response=await(this.fetcher||fetch)(url,{headers:new Headers({accept:"application/ld+json"})});if(response.ok&&response.headers){let mediaType=response.headers.get("Content-Type");if(mediaType){const colonPos=mediaType.indexOf(";");colonPos>0&&(mediaType=mediaType.substr(0,colonPos))}if(mediaType==="application/ld+json")return await response.json();if(response.headers.has("Link")){let alternateUrl;if(response.headers.forEach((value,key)=>{if(key==="link"){const linkHeader=(0,http_link_header_1.parse)(value);for(const link2 of linkHeader.get("type","application/ld+json"))if(link2.rel==="alternate"){if(alternateUrl)throw new Error("Multiple JSON-LD alternate links were found on "+url);alternateUrl=(0,relative_to_absolute_iri_1$8.resolve)(link2.uri,url)}}}),alternateUrl)return this.load(alternateUrl)}throw new ErrorCoded_1.ErrorCoded(`Unsupported JSON-LD media type ${mediaType}`,ErrorCoded_1.ERROR_CODES.LOADING_DOCUMENT_FAILED)}else throw new Error(response.statusText||`Status code: ${response.status}`)}}__name(FetchDocumentLoader,"FetchDocumentLoader");FetchDocumentLoader$1.FetchDocumentLoader=FetchDocumentLoader;var JsonLdContextNormalized={},Util$9={};Object.defineProperty(Util$9,"__esModule",{value:!0});Util$9.Util=void 0;let Util$8=__name(class Util2{static isCompactIri(term){return term.indexOf(":")>0&&!(term&&term[0]==="#")}static getPrefix(term,context2){if(term&&term[0]==="#")return null;const separatorPos=term.indexOf(":");if(separatorPos>=0){if(term.length>separatorPos+1&&term.charAt(separatorPos+1)==="/"&&term.charAt(separatorPos+2)==="/")return null;const prefix=term.substr(0,separatorPos);if(prefix==="_")return null;if(context2[prefix])return prefix}return null}static getContextValueId(contextValue){if(contextValue===null||typeof contextValue=="string")return contextValue;const id=contextValue["@id"];return id||null}static isSimpleTermDefinitionPrefix(value,options){return!Util2.isPotentialKeyword(value)&&(value[0]==="_"||options.allowPrefixNonGenDelims||Util2.isPrefixIriEndingWithGenDelim(value))}static isPotentialKeyword(keyword){return typeof keyword=="string"&&Util2.KEYWORD_REGEX.test(keyword)}static isPrefixIriEndingWithGenDelim(prefixIri){return Util2.ENDS_WITH_GEN_DELIM.test(prefixIri)}static isPrefixValue(value){return value&&(typeof value=="string"||value&&typeof value=="object")}static isValidIri(iri){return!!(iri&&Util2.IRI_REGEX.test(iri))}static isValidIriWeak(iri){return!!iri&&iri[0]!==":"&&Util2.IRI_REGEX_WEAK.test(iri)}static isValidKeyword(keyword){return Util2.VALID_KEYWORDS[keyword]}static isTermProtected(context2,key){const value=context2[key];return typeof value!="string"&&value&&value["@protected"]}static hasProtectedTerms(context2){for(const key of Object.keys(context2))if(Util2.isTermProtected(context2,key))return!0;return!1}static isReservedInternalKeyword(key){return key.startsWith("@__")}},"Util");Util$9.Util=Util$8;Util$8.IRI_REGEX=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^ "<>{}|\\\[\]`#]*(#[^#]*)?$/;Util$8.IRI_REGEX_WEAK=/(?::[^:])|\//;Util$8.KEYWORD_REGEX=/^@[a-z]+$/i;Util$8.ENDS_WITH_GEN_DELIM=/[:/?#\[\]@]$/;Util$8.REGEX_LANGUAGE_TAG=/^[a-zA-Z]+(-[a-zA-Z0-9]+)*$/;Util$8.REGEX_DIRECTION_TAG=/^(ltr)|(rtl)$/;Util$8.VALID_KEYWORDS={"@annotation":!0,"@base":!0,"@container":!0,"@context":!0,"@direction":!0,"@graph":!0,"@id":!0,"@import":!0,"@included":!0,"@index":!0,"@json":!0,"@language":!0,"@list":!0,"@nest":!0,"@none":!0,"@prefix":!0,"@propagate":!0,"@protected":!0,"@reverse":!0,"@set":!0,"@type":!0,"@value":!0,"@version":!0,"@vocab":!0};Util$8.EXPAND_KEYS_BLACKLIST=["@base","@vocab","@language","@version","@direction"];Util$8.ALIAS_DOMAIN_BLACKLIST=["@container","@graph","@id","@index","@list","@nest","@none","@prefix","@reverse","@set","@type","@value","@version"];Util$8.ALIAS_RANGE_BLACKLIST=["@context","@preserve"];Util$8.CONTAINERS=["@list","@set","@index","@language","@graph","@id","@type"];Util$8.CONTAINERS_1_0=["@list","@set","@index"];var hasRequiredJsonLdContextNormalized;function requireJsonLdContextNormalized(){if(hasRequiredJsonLdContextNormalized)return JsonLdContextNormalized;hasRequiredJsonLdContextNormalized=1,Object.defineProperty(JsonLdContextNormalized,"__esModule",{value:!0}),JsonLdContextNormalized.JsonLdContextNormalized=void 0;const relative_to_absolute_iri_12=relativeToAbsoluteIri,ContextParser_1=requireContextParser(),ErrorCoded_12=ErrorCoded,Util_12=Util$9;let JsonLdContextNormalized$1=__name(class{constructor(contextRaw){this.contextRaw=contextRaw}getContextRaw(){return this.contextRaw}expandTerm(term,expandVocab,options=ContextParser_1.defaultExpandOptions){const contextValue=this.contextRaw[term];if(contextValue===null||contextValue&&contextValue["@id"]===null)return null;let validIriMapping=!0;if(contextValue&&expandVocab){const value=Util_12.Util.getContextValueId(contextValue);if(value&&value!==term)if(typeof value!="string"||!Util_12.Util.isValidIri(value)&&!Util_12.Util.isValidKeyword(value))Util_12.Util.isPotentialKeyword(value)||(validIriMapping=!1);else return value}const prefix=Util_12.Util.getPrefix(term,this.contextRaw),vocab=this.contextRaw["@vocab"],vocabRelative=(!!vocab||vocab==="")&&vocab.indexOf(":")<0,base=this.contextRaw["@base"],potentialKeyword=Util_12.Util.isPotentialKeyword(term);if(prefix){const contextPrefixValue=this.contextRaw[prefix],value=Util_12.Util.getContextValueId(contextPrefixValue);if(value){if(typeof contextPrefixValue=="string"||!options.allowPrefixForcing){if(!Util_12.Util.isSimpleTermDefinitionPrefix(value,options))return term}else if(value[0]!=="_"&&!potentialKeyword&&!contextPrefixValue["@prefix"]&&!(term in this.contextRaw))return term;return value+term.substr(prefix.length+1)}}else if(expandVocab&&(vocab||vocab===""||options.allowVocabRelativeToBase&&base&&vocabRelative)&&!potentialKeyword&&!Util_12.Util.isCompactIri(term))if(vocabRelative){if(options.allowVocabRelativeToBase)return(vocab||base?(0,relative_to_absolute_iri_12.resolve)(vocab,base):"")+term;throw new ErrorCoded_12.ErrorCoded(`Relative vocab expansion for term '${term}' with vocab '${vocab}' is not allowed.`,ErrorCoded_12.ERROR_CODES.INVALID_VOCAB_MAPPING)}else return vocab+term;else if(!expandVocab&&base&&!potentialKeyword&&!Util_12.Util.isCompactIri(term))return(0,relative_to_absolute_iri_12.resolve)(term,base);if(validIriMapping)return term;throw new ErrorCoded_12.ErrorCoded(`Invalid IRI mapping found for context entry '${term}': '${JSON.stringify(contextValue)}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING)}compactIri(iri,vocab){if(vocab&&this.contextRaw["@vocab"]&&iri.startsWith(this.contextRaw["@vocab"]))return iri.substr(this.contextRaw["@vocab"].length);if(!vocab&&this.contextRaw["@base"]&&iri.startsWith(this.contextRaw["@base"]))return iri.substr(this.contextRaw["@base"].length);const shortestPrefixing={prefix:"",suffix:iri};for(const key in this.contextRaw){const value=this.contextRaw[key];if(value&&!Util_12.Util.isPotentialKeyword(key)){const contextIri=Util_12.Util.getContextValueId(value);if(iri.startsWith(contextIri)){const suffix=iri.substr(contextIri.length);if(suffix)suffix.length<shortestPrefixing.suffix.length&&(shortestPrefixing.prefix=key,shortestPrefixing.suffix=suffix);else if(vocab)return key}}}return shortestPrefixing.prefix?shortestPrefixing.prefix+":"+shortestPrefixing.suffix:iri}},"JsonLdContextNormalized");return JsonLdContextNormalized.JsonLdContextNormalized=JsonLdContextNormalized$1,JsonLdContextNormalized}__name(requireJsonLdContextNormalized,"requireJsonLdContextNormalized");var canonicalize$1=__name(function serialize2(object2){return object2===null||typeof object2!="object"||object2.toJSON!=null?JSON.stringify(object2):Array.isArray(object2)?"["+object2.reduce((t,cv,ci)=>{const comma=ci===0?"":",",value=cv===void 0||typeof cv=="symbol"?null:cv;return t+comma+serialize2(value)},"")+"]":"{"+Object.keys(object2).sort().reduce((t,cv,ci)=>{if(object2[cv]===void 0||typeof object2[cv]=="symbol")return t;const comma=t.length===0?"":",";return t+comma+serialize2(cv)+":"+serialize2(object2[cv])},"")+"}"},"serialize"),hasRequiredContextParser;function requireContextParser(){return hasRequiredContextParser||(hasRequiredContextParser=1,function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultExpandOptions=exports.ContextParser=void 0;const relative_to_absolute_iri_12=relativeToAbsoluteIri,ErrorCoded_12=ErrorCoded,FetchDocumentLoader_1=FetchDocumentLoader$1,JsonLdContextNormalized_1=requireJsonLdContextNormalized(),Util_12=Util$9,canonicalizeJson=canonicalize$1;class ContextParser2{constructor(options){options=options||{},this.documentLoader=options.documentLoader||new FetchDocumentLoader_1.FetchDocumentLoader,this.documentCache={},this.validateContext=!options.skipValidation,this.expandContentTypeToBase=!!options.expandContentTypeToBase,this.remoteContextsDepthLimit=options.remoteContextsDepthLimit||32,this.redirectSchemaOrgHttps="redirectSchemaOrgHttps"in options?!!options.redirectSchemaOrgHttps:!0}static validateLanguage(value,strictRange,errorCode){if(typeof value!="string")throw new ErrorCoded_12.ErrorCoded(`The value of an '@language' must be a string, got '${JSON.stringify(value)}'`,errorCode);if(!Util_12.Util.REGEX_LANGUAGE_TAG.test(value)){if(strictRange)throw new ErrorCoded_12.ErrorCoded(`The value of an '@language' must be a valid language tag, got '${JSON.stringify(value)}'`,errorCode);return!1}return!0}static validateDirection(value,strictValues){if(typeof value!="string")throw new ErrorCoded_12.ErrorCoded(`The value of an '@direction' must be a string, got '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_BASE_DIRECTION);if(!Util_12.Util.REGEX_DIRECTION_TAG.test(value)){if(strictValues)throw new ErrorCoded_12.ErrorCoded(`The value of an '@direction' must be 'ltr' or 'rtl', got '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_BASE_DIRECTION);return!1}return!0}idifyReverseTerms(context2){for(const key of Object.keys(context2)){const value=context2[key];if(value&&typeof value=="object"&&value["@reverse"]&&!value["@id"]){if(typeof value["@reverse"]!="string"||Util_12.Util.isValidKeyword(value["@reverse"]))throw new ErrorCoded_12.ErrorCoded(`Invalid @reverse value, must be absolute IRI or blank node: '${value["@reverse"]}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING);value["@id"]=value["@reverse"],Util_12.Util.isPotentialKeyword(value["@reverse"])?delete value["@reverse"]:value["@reverse"]=!0}}return context2}expandPrefixedTerms(context2,expandContentTypeToBase){const contextRaw=context2.getContextRaw();for(const key of Object.keys(contextRaw))if(Util_12.Util.EXPAND_KEYS_BLACKLIST.indexOf(key)<0&&!Util_12.Util.isReservedInternalKeyword(key)){const keyValue=contextRaw[key];if(Util_12.Util.isPotentialKeyword(key)&&Util_12.Util.ALIAS_DOMAIN_BLACKLIST.indexOf(key)>=0&&(key!=="@type"||typeof contextRaw[key]=="object"&&!(contextRaw[key]["@protected"]||contextRaw[key]["@container"]==="@set")))throw new ErrorCoded_12.ErrorCoded(`Keywords can not be aliased to something else.
Tried mapping ${key} to ${JSON.stringify(keyValue)}`,ErrorCoded_12.ERROR_CODES.KEYWORD_REDEFINITION);if(Util_12.Util.ALIAS_RANGE_BLACKLIST.indexOf(Util_12.Util.getContextValueId(keyValue))>=0)throw new ErrorCoded_12.ErrorCoded(`Aliasing to certain keywords is not allowed.
Tried mapping ${key} to ${JSON.stringify(keyValue)}`,ErrorCoded_12.ERROR_CODES.INVALID_KEYWORD_ALIAS);if(keyValue&&Util_12.Util.isPotentialKeyword(Util_12.Util.getContextValueId(keyValue))&&keyValue["@prefix"]===!0)throw new ErrorCoded_12.ErrorCoded(`Tried to use keyword aliases as prefix: '${key}': '${JSON.stringify(keyValue)}'`,ErrorCoded_12.ERROR_CODES.INVALID_TERM_DEFINITION);for(;Util_12.Util.isPrefixValue(contextRaw[key]);){const value=contextRaw[key];let changed=!1;if(typeof value=="string")contextRaw[key]=context2.expandTerm(value,!0),changed=changed||value!==contextRaw[key];else{const id=value["@id"],type=value["@type"],canAddIdEntry=!("@prefix"in value)||Util_12.Util.isValidIri(key);if("@id"in value)id!=null&&typeof id=="string"&&(contextRaw[key]["@id"]=context2.expandTerm(id,!0),changed=changed||id!==contextRaw[key]["@id"]);else if(!Util_12.Util.isPotentialKeyword(key)&&canAddIdEntry){const newId=context2.expandTerm(key,!0);newId!==key&&(contextRaw[key]["@id"]=newId,changed=!0)}type&&typeof type=="string"&&type!=="@vocab"&&(!value["@container"]||!value["@container"]["@type"])&&canAddIdEntry&&(contextRaw[key]["@type"]=context2.expandTerm(type,!0),expandContentTypeToBase&&type===contextRaw[key]["@type"]&&(contextRaw[key]["@type"]=context2.expandTerm(type,!1)),changed=changed||type!==contextRaw[key]["@type"])}if(!changed)break}}}normalize(context2,{processingMode,normalizeLanguageTags}){if(normalizeLanguageTags||processingMode===1)for(const key of Object.keys(context2))if(key==="@language"&&typeof context2[key]=="string")context2[key]=context2[key].toLowerCase();else{const value=context2[key];value&&typeof value=="object"&&typeof value["@language"]=="string"&&(value["@language"]=value["@language"].toLowerCase())}}containersToHash(context2){for(const key of Object.keys(context2)){const value=context2[key];if(value&&typeof value=="object"){if(typeof value["@container"]=="string")value["@container"]={[value["@container"]]:!0};else if(Array.isArray(value["@container"])){const newValue={};for(const containerValue of value["@container"])newValue[containerValue]=!0;value["@container"]=newValue}}}}applyScopedProtected(context2,{processingMode}){if(processingMode&&processingMode>=1.1&&context2["@protected"]){for(const key of Object.keys(context2))if(!Util_12.Util.isReservedInternalKeyword(key)&&!Util_12.Util.isPotentialKeyword(key)&&!Util_12.Util.isTermProtected(context2,key)){const value=context2[key];value&&typeof value=="object"?"@protected"in context2[key]||(context2[key]["@protected"]=!0):context2[key]={"@id":value,"@protected":!0}}delete context2["@protected"]}}validateKeywordRedefinitions(contextBefore,contextAfter,expandOptions){for(const key of Object.keys(contextAfter))if(Util_12.Util.isTermProtected(contextBefore,key)){if(typeof contextAfter[key]=="string"){const isPrefix=Util_12.Util.isSimpleTermDefinitionPrefix(contextAfter[key],expandOptions);contextAfter[key]={"@id":contextAfter[key]},isPrefix&&(contextAfter[key]["@prefix"]=!0,contextBefore[key]["@prefix"]=!0)}const valueBefore=canonicalizeJson(contextBefore[key]);contextAfter[key]["@protected"]=!0;const valueAfter=canonicalizeJson(contextAfter[key]);if(valueBefore!==valueAfter)throw new ErrorCoded_12.ErrorCoded(`Attempted to override the protected keyword ${key} from ${JSON.stringify(Util_12.Util.getContextValueId(contextBefore[key]))} to ${JSON.stringify(Util_12.Util.getContextValueId(contextAfter[key]))}`,ErrorCoded_12.ERROR_CODES.PROTECTED_TERM_REDEFINITION)}}validate(context2,{processingMode}){for(const key of Object.keys(context2)){if(Util_12.Util.isReservedInternalKeyword(key))continue;if(key==="")throw new ErrorCoded_12.ErrorCoded(`The empty term is not allowed, got: '${key}': '${JSON.stringify(context2[key])}'`,ErrorCoded_12.ERROR_CODES.INVALID_TERM_DEFINITION);const value=context2[key],valueType=typeof value;if(Util_12.Util.isPotentialKeyword(key)){switch(key.substr(1)){case"vocab":if(value!==null&&valueType!=="string")throw new ErrorCoded_12.ErrorCoded(`Found an invalid @vocab IRI: ${value}`,ErrorCoded_12.ERROR_CODES.INVALID_VOCAB_MAPPING);break;case"base":if(value!==null&&valueType!=="string")throw new ErrorCoded_12.ErrorCoded(`Found an invalid @base IRI: ${context2[key]}`,ErrorCoded_12.ERROR_CODES.INVALID_BASE_IRI);break;case"language":value!==null&&ContextParser2.validateLanguage(value,!0,ErrorCoded_12.ERROR_CODES.INVALID_DEFAULT_LANGUAGE);break;case"version":if(value!==null&&valueType!=="number")throw new ErrorCoded_12.ErrorCoded(`Found an invalid @version number: ${value}`,ErrorCoded_12.ERROR_CODES.INVALID_VERSION_VALUE);break;case"direction":value!==null&&ContextParser2.validateDirection(value,!0);break;case"propagate":if(processingMode===1)throw new ErrorCoded_12.ErrorCoded(`Found an illegal @propagate keyword: ${value}`,ErrorCoded_12.ERROR_CODES.INVALID_CONTEXT_ENTRY);if(value!==null&&valueType!=="boolean")throw new ErrorCoded_12.ErrorCoded(`Found an invalid @propagate value: ${value}`,ErrorCoded_12.ERROR_CODES.INVALID_PROPAGATE_VALUE);break}if(Util_12.Util.isValidKeyword(key)&&Util_12.Util.isValidKeyword(Util_12.Util.getContextValueId(value)))throw new ErrorCoded_12.ErrorCoded(`Illegal keyword alias in term value, found: '${key}': '${Util_12.Util.getContextValueId(value)}'`,ErrorCoded_12.ERROR_CODES.KEYWORD_REDEFINITION);continue}if(value!==null)switch(valueType){case"string":if(Util_12.Util.getPrefix(value,context2)===key)throw new ErrorCoded_12.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.CYCLIC_IRI_MAPPING);if(Util_12.Util.isValidIriWeak(key)){if(value==="@type")throw new ErrorCoded_12.ErrorCoded(`IRIs can not be mapped to @type, found: '${key}': '${value}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING);if(Util_12.Util.isValidIri(value)&&value!==new JsonLdContextNormalized_1.JsonLdContextNormalized(context2).expandTerm(key))throw new ErrorCoded_12.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${key}': '${value}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING)}break;case"object":if(!Util_12.Util.isCompactIri(key)&&!("@id"in value)&&(value["@type"]==="@id"?!context2["@base"]:!context2["@vocab"]))throw new ErrorCoded_12.ErrorCoded(`Missing @id in context entry: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING);for(const objectKey of Object.keys(value)){const objectValue=value[objectKey];if(objectValue)switch(objectKey){case"@id":if(Util_12.Util.isValidKeyword(objectValue)&&objectValue!=="@type"&&objectValue!=="@id"&&objectValue!=="@graph"&&objectValue!=="@nest")throw new ErrorCoded_12.ErrorCoded(`Illegal keyword alias in term value, found: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING);if(Util_12.Util.isValidIriWeak(key)){if(objectValue==="@type")throw new ErrorCoded_12.ErrorCoded(`IRIs can not be mapped to @type, found: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING);if(Util_12.Util.isValidIri(objectValue)&&objectValue!==new JsonLdContextNormalized_1.JsonLdContextNormalized(context2).expandTerm(key))throw new ErrorCoded_12.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING)}if(typeof objectValue!="string")throw new ErrorCoded_12.ErrorCoded(`Detected non-string @id in context entry: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_IRI_MAPPING);if(Util_12.Util.getPrefix(objectValue,context2)===key)throw new ErrorCoded_12.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.CYCLIC_IRI_MAPPING);break;case"@type":if(value["@container"]==="@type"&&objectValue!=="@id"&&objectValue!=="@vocab")throw new ErrorCoded_12.ErrorCoded(`@container: @type only allows @type: @id or @vocab, but got: '${key}': '${objectValue}'`,ErrorCoded_12.ERROR_CODES.INVALID_TYPE_MAPPING);if(typeof objectValue!="string")throw new ErrorCoded_12.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(valueType)}'`,ErrorCoded_12.ERROR_CODES.INVALID_TYPE_MAPPING);if(objectValue!=="@id"&&objectValue!=="@vocab"&&(processingMode===1||objectValue!=="@json")&&(processingMode===1||objectValue!=="@none")&&(objectValue[0]==="_"||!Util_12.Util.isValidIri(objectValue)))throw new ErrorCoded_12.ErrorCoded(`A context @type must be an absolute IRI, found: '${key}': '${objectValue}'`,ErrorCoded_12.ERROR_CODES.INVALID_TYPE_MAPPING);break;case"@reverse":if(typeof objectValue=="string"&&value["@id"]&&value["@id"]!==objectValue)throw new ErrorCoded_12.ErrorCoded(`Found non-matching @id and @reverse term values in '${key}':'${objectValue}' and '${value["@id"]}'`,ErrorCoded_12.ERROR_CODES.INVALID_REVERSE_PROPERTY);if("@nest"in value)throw new ErrorCoded_12.ErrorCoded(`@nest is not allowed in the reverse property '${key}'`,ErrorCoded_12.ERROR_CODES.INVALID_REVERSE_PROPERTY);break;case"@container":if(processingMode===1&&(Object.keys(objectValue).length>1||Util_12.Util.CONTAINERS_1_0.indexOf(Object.keys(objectValue)[0])<0))throw new ErrorCoded_12.ErrorCoded(`Invalid term @container for '${key}' ('${Object.keys(objectValue)}') in 1.0, must be only one of ${Util_12.Util.CONTAINERS_1_0.join(", ")}`,ErrorCoded_12.ERROR_CODES.INVALID_CONTAINER_MAPPING);for(const containerValue of Object.keys(objectValue)){if(containerValue==="@list"&&value["@reverse"])throw new ErrorCoded_12.ErrorCoded(`Term value can not be @container: @list and @reverse at the same time on '${key}'`,ErrorCoded_12.ERROR_CODES.INVALID_REVERSE_PROPERTY);if(Util_12.Util.CONTAINERS.indexOf(containerValue)<0)throw new ErrorCoded_12.ErrorCoded(`Invalid term @container for '${key}' ('${containerValue}'), must be one of ${Util_12.Util.CONTAINERS.join(", ")}`,ErrorCoded_12.ERROR_CODES.INVALID_CONTAINER_MAPPING)}break;case"@language":ContextParser2.validateLanguage(objectValue,!0,ErrorCoded_12.ERROR_CODES.INVALID_LANGUAGE_MAPPING);break;case"@direction":ContextParser2.validateDirection(objectValue,!0);break;case"@prefix":if(objectValue!==null&&typeof objectValue!="boolean")throw new ErrorCoded_12.ErrorCoded(`Found an invalid term @prefix boolean in: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_PREFIX_VALUE);if(!("@id"in value)&&!Util_12.Util.isValidIri(key))throw new ErrorCoded_12.ErrorCoded(`Invalid @prefix definition for '${key}' ('${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@index":if(processingMode===1||!value["@container"]||!value["@container"]["@index"])throw new ErrorCoded_12.ErrorCoded(`Attempt to add illegal key to value object: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@nest":if(Util_12.Util.isPotentialKeyword(objectValue)&&objectValue!=="@nest")throw new ErrorCoded_12.ErrorCoded(`Found an invalid term @nest value in: '${key}': '${JSON.stringify(value)}'`,ErrorCoded_12.ERROR_CODES.INVALID_NEST_VALUE)}}break;default:throw new ErrorCoded_12.ErrorCoded(`Found an invalid term value: '${key}': '${value}'`,ErrorCoded_12.ERROR_CODES.INVALID_TERM_DEFINITION)}}}applyBaseEntry(context2,options,inheritFromParent){return typeof context2=="string"||(inheritFromParent&&!("@base"in context2)&&options.parentContext&&typeof options.parentContext=="object"&&"@base"in options.parentContext&&(context2["@base"]=options.parentContext["@base"],options.parentContext["@__baseDocument"]&&(context2["@__baseDocument"]=!0)),options.baseIRI&&!options.external&&("@base"in context2?context2["@base"]!==null&&typeof context2["@base"]=="string"&&!Util_12.Util.isValidIri(context2["@base"])&&(context2["@base"]=(0,relative_to_absolute_iri_12.resolve)(context2["@base"],options.parentContext&&options.parentContext["@base"]||options.baseIRI)):(context2["@base"]=options.baseIRI,context2["@__baseDocument"]=!0))),context2}normalizeContextIri(contextIri,baseIRI){if(!Util_12.Util.isValidIri(contextIri))try{contextIri=(0,relative_to_absolute_iri_12.resolve)(contextIri,baseIRI)}catch{throw new Error(`Invalid context IRI: ${contextIri}`)}return this.redirectSchemaOrgHttps&&contextIri.startsWith("http://schema.org")&&(contextIri="https://schema.org/"),contextIri}async parseInnerContexts(context2,options){for(const key of Object.keys(context2)){const value=context2[key];if(value&&typeof value=="object"&&"@context"in value&&value["@context"]!==null&&!options.ignoreScopedContexts){if(this.validateContext)try{const parentContext=Object.assign({},context2);parentContext[key]=Object.assign({},parentContext[key]),delete parentContext[key]["@context"],await this.parse(value["@context"],Object.assign(Object.assign({},options),{external:!1,parentContext,ignoreProtection:!0,ignoreRemoteScopedContexts:!0,ignoreScopedContexts:!0}))}catch(e){throw new ErrorCoded_12.ErrorCoded(e.message,ErrorCoded_12.ERROR_CODES.INVALID_SCOPED_CONTEXT)}value["@context"]=(await this.parse(value["@context"],Object.assign(Object.assign({},options),{external:!1,minimalProcessing:!0,ignoreRemoteScopedContexts:!0,parentContext:context2}))).getContextRaw()}}return context2}async parse(context2,options={}){const{baseIRI,parentContext:parentContextInitial,external,processingMode=ContextParser2.DEFAULT_PROCESSING_MODE,normalizeLanguageTags,ignoreProtection,minimalProcessing}=options;let parentContext=parentContextInitial;const remoteContexts=options.remoteContexts||{};if(Object.keys(remoteContexts).length>=this.remoteContextsDepthLimit)throw new ErrorCoded_12.ErrorCoded("Detected an overflow in remote context inclusions: "+Object.keys(remoteContexts),ErrorCoded_12.ERROR_CODES.CONTEXT_OVERFLOW);if(context2==null){if(!ignoreProtection&&parentContext&&Util_12.Util.hasProtectedTerms(parentContext))throw new ErrorCoded_12.ErrorCoded("Illegal context nullification when terms are protected",ErrorCoded_12.ERROR_CODES.INVALID_CONTEXT_NULLIFICATION);return new JsonLdContextNormalized_1.JsonLdContextNormalized(this.applyBaseEntry({},options,!1))}else if(typeof context2=="string"){const contextIri=this.normalizeContextIri(context2,baseIRI),overriddenLoad=this.getOverriddenLoad(contextIri,options);if(overriddenLoad)return new JsonLdContextNormalized_1.JsonLdContextNormalized(overriddenLoad);const parsedStringContext=await this.parse(await this.load(contextIri),Object.assign(Object.assign({},options),{baseIRI:contextIri,external:!0,remoteContexts:Object.assign(Object.assign({},remoteContexts),{[contextIri]:!0})}));return this.applyBaseEntry(parsedStringContext.getContextRaw(),options,!0),parsedStringContext}else if(Array.isArray(context2)){const contextIris=[],contexts=await Promise.all(context2.map((subContext,i)=>{if(typeof subContext=="string"){const contextIri=this.normalizeContextIri(subContext,baseIRI);contextIris[i]=contextIri;const overriddenLoad=this.getOverriddenLoad(contextIri,options);return overriddenLoad||this.load(contextIri)}else return subContext}));if(minimalProcessing)return new JsonLdContextNormalized_1.JsonLdContextNormalized(contexts);const reducedContexts=await contexts.reduce((accContextPromise,contextEntry,i)=>accContextPromise.then(accContext=>this.parse(contextEntry,Object.assign(Object.assign({},options),{baseIRI:contextIris[i]||options.baseIRI,external:!!contextIris[i]||options.external,parentContext:accContext.getContextRaw(),remoteContexts:contextIris[i]?Object.assign(Object.assign({},remoteContexts),{[contextIris[i]]:!0}):remoteContexts}))),Promise.resolve(new JsonLdContextNormalized_1.JsonLdContextNormalized(parentContext||{})));return this.applyBaseEntry(reducedContexts.getContextRaw(),options,!0),reducedContexts}else if(typeof context2=="object"){if("@context"in context2)return await this.parse(context2["@context"],options);context2=JSON.parse(JSON.stringify(context2)),parentContext&&!minimalProcessing&&(parentContext=JSON.parse(JSON.stringify(parentContext)));let newContext={};if(external&&delete context2["@base"],this.applyBaseEntry(context2,options,!0),this.containersToHash(context2),minimalProcessing)return new JsonLdContextNormalized_1.JsonLdContextNormalized(context2);let importContext={};if("@import"in context2)if(processingMode>=1.1){if(typeof context2["@import"]!="string")throw new ErrorCoded_12.ErrorCoded("An @import value must be a string, but got "+typeof context2["@import"],ErrorCoded_12.ERROR_CODES.INVALID_IMPORT_VALUE);importContext=await this.loadImportContext(this.normalizeContextIri(context2["@import"],baseIRI)),delete context2["@import"]}else throw new ErrorCoded_12.ErrorCoded("Context importing is not supported in JSON-LD 1.0",ErrorCoded_12.ERROR_CODES.INVALID_CONTEXT_ENTRY);newContext=Object.assign(Object.assign(Object.assign(Object.assign({},newContext),typeof parentContext=="object"?parentContext:{}),importContext),context2);const newContextWrapped=new JsonLdContextNormalized_1.JsonLdContextNormalized(newContext);return await this.parseInnerContexts(newContext,options),(newContext&&newContext["@version"]||ContextParser2.DEFAULT_PROCESSING_MODE)>=1.1&&(context2["@vocab"]&&typeof context2["@vocab"]=="string"||context2["@vocab"]==="")&&(parentContext&&"@vocab"in parentContext&&context2["@vocab"].indexOf(":")<0?newContext["@vocab"]=parentContext["@vocab"]+context2["@vocab"]:(Util_12.Util.isCompactIri(context2["@vocab"])||context2["@vocab"]in newContextWrapped.getContextRaw())&&(newContext["@vocab"]=newContextWrapped.expandTerm(context2["@vocab"],!0))),this.idifyReverseTerms(newContext),this.expandPrefixedTerms(newContextWrapped,this.expandContentTypeToBase),!ignoreProtection&&parentContext&&processingMode>=1.1&&this.validateKeywordRedefinitions(parentContext,newContext,exports.defaultExpandOptions),this.normalize(newContext,{processingMode,normalizeLanguageTags}),this.applyScopedProtected(newContext,{processingMode}),this.validateContext&&this.validate(newContext,{processingMode}),newContextWrapped}else throw new ErrorCoded_12.ErrorCoded(`Tried parsing a context that is not a string, array or object, but got ${context2}`,ErrorCoded_12.ERROR_CODES.INVALID_LOCAL_CONTEXT)}async load(url){const cached=this.documentCache[url];if(cached)return typeof cached=="string"?cached:Array.isArray(cached)?cached.slice():Object.assign({},cached);let document2;try{document2=await this.documentLoader.load(url)}catch(e){throw new ErrorCoded_12.ErrorCoded(`Failed to load remote context ${url}: ${e.message}`,ErrorCoded_12.ERROR_CODES.LOADING_REMOTE_CONTEXT_FAILED)}if(!("@context"in document2))throw new ErrorCoded_12.ErrorCoded(`Missing @context in remote context at ${url}`,ErrorCoded_12.ERROR_CODES.INVALID_REMOTE_CONTEXT);return this.documentCache[url]=document2["@context"]}getOverriddenLoad(url,options){if(url in(options.remoteContexts||{})){if(options.ignoreRemoteScopedContexts)return url;throw new ErrorCoded_12.ErrorCoded("Detected a cyclic context inclusion of "+url,ErrorCoded_12.ERROR_CODES.RECURSIVE_CONTEXT_INCLUSION)}return null}async loadImportContext(importContextIri){const importContext=await this.load(importContextIri);if(typeof importContext!="object"||Array.isArray(importContext))throw new ErrorCoded_12.ErrorCoded("An imported context must be a single object: "+importContextIri,ErrorCoded_12.ERROR_CODES.INVALID_REMOTE_CONTEXT);if("@import"in importContext)throw new ErrorCoded_12.ErrorCoded("An imported context can not import another context: "+importContextIri,ErrorCoded_12.ERROR_CODES.INVALID_CONTEXT_ENTRY);return this.containersToHash(importContext),importContext}}__name(ContextParser2,"ContextParser"),exports.ContextParser=ContextParser2,ContextParser2.DEFAULT_PROCESSING_MODE=1.1,exports.defaultExpandOptions={allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}}(ContextParser)),ContextParser}__name(requireContextParser,"requireContextParser");var IDocumentLoader={};Object.defineProperty(IDocumentLoader,"__esModule",{value:!0});var JsonLdContext={};Object.defineProperty(JsonLdContext,"__esModule",{value:!0});(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(requireContextParser(),exports),__exportStar(ErrorCoded,exports),__exportStar(FetchDocumentLoader$1,exports),__exportStar(IDocumentLoader,exports),__exportStar(JsonLdContext,exports),__exportStar(requireJsonLdContextNormalized(),exports),__exportStar(Util$9,exports)})(jsonldContextParser);Object.defineProperty(Util$a,"__esModule",{value:!0});Util$a.Util=void 0;const rdf_data_factory_1$v=rdfDataFactory,jsonld_context_parser_1$c=jsonldContextParser,sparqlalgebrajs_1$t=sparqlalgebrajs;let Util$7=__name(class{constructor(settings){this.nodeHandlers={},this.nodeValueHandlers={},this.directiveNodeHandlers={},this.settings=settings,this.dataFactory=settings.dataFactory||new rdf_data_factory_1$v.DataFactory,this.operationFactory=new sparqlalgebrajs_1$t.Factory(this.dataFactory),this.contextParser=new jsonld_context_parser_1$c.ContextParser}registerNodeHandler(nodeHandler){this.nodeHandlers[nodeHandler.targetKind]=nodeHandler}registerNodeValueHandler(nodeValueHandler){this.nodeValueHandlers[nodeValueHandler.targetKind]=nodeValueHandler}registerDirectiveNodeHandler(directiveNodeHandler){this.directiveNodeHandlers[directiveNodeHandler.targetKind]=directiveNodeHandler}handleNode(node2,convertContext){const nodeHandler=this.nodeHandlers[node2.kind];if(!nodeHandler)throw new Error(`Unsupported GraphQL node '${node2.kind}'`);return nodeHandler.handle(node2,convertContext)}handleNodeValue(node2,fieldName,convertContext){const nodeValueHandler=this.nodeValueHandlers[node2.kind];if(!nodeValueHandler)throw new Error(`Unsupported GraphQL value node '${node2.kind}'`);return nodeValueHandler.handle(node2,fieldName,convertContext)}handleDirectiveNode(directiveContext,convertContext){const directiveNodeHandler=this.directiveNodeHandlers[directiveContext.directive.name.value];return directiveNodeHandler?directiveNodeHandler.handle(directiveContext,convertContext):null}joinOperations(operations){if(operations.length===1)return operations[0];const bgps=[],nonBgps=[];for(const operation of operations)operation.type==="bgp"?bgps.push(operation):nonBgps.push(operation);if(bgps.length===operations.length)return this.joinOperationsAsBgp(bgps);if(bgps.length===operations.length-1&&nonBgps[0].type==="leftjoin"&&nonBgps[0].input[0].type==="bgp"){const originalLeftJoin=nonBgps[0];return bgps.push(originalLeftJoin.input[0]),this.operationFactory.createLeftJoin(this.joinOperationsAsBgp(bgps),originalLeftJoin.input[1])}else return nonBgps.length===operations.length?this.joinOperationsAsNestedJoin(nonBgps):this.joinOperationsAsNestedJoin([this.joinOperationsAsBgp(bgps),this.joinOperationsAsNestedJoin(nonBgps)])}joinOperationsAsBgp(operations){return this.operationFactory.createBgp([].concat.apply([],operations.map(op=>op.patterns)))}joinOperationsAsNestedJoin(operations){return this.operationFactory.createJoin(operations)}appendFieldToPath(path,fieldLabel){return path.concat([fieldLabel])}getFieldLabel(field){return(field.alias?field.alias:field.name).value}nameToVariable(fieldLabel,convertContext){return this.dataFactory.variable((convertContext.path.length?convertContext.path.join(this.settings.variableDelimiter)+this.settings.variableDelimiter:"")+fieldLabel)}valueToNamedNode(value,context2){const contextValue=context2.expandTerm(value,!0);if(this.settings.requireContext&&!contextValue)throw new Error("No context entry was found for "+value);return this.dataFactory.namedNode(contextValue||value)}getArgument(args,name){if(args){for(const argument of args)if(argument.name.value===name)return argument}}newTypePattern(subject2,typeCondition,convertContext){return this.operationFactory.createPattern(subject2,this.dataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.valueToNamedNode(typeCondition.name.value,convertContext.context),convertContext.graph)}createQuadPattern(subject2,predicateName,object2,graph,context2){const predicate2=this.valueToNamedNode(predicateName.value,context2);return context2&&context2.getContextRaw()[predicateName.value]&&context2.getContextRaw()[predicateName.value]["@reverse"]?this.operationFactory.createPattern(object2,predicate2,subject2,graph):this.operationFactory.createPattern(subject2,predicate2,object2,graph)}createQuadPath(subject2,predicateName,predicateAlternatives,object2,graph,context2){const predicateInitial=this.valueToNamedNode(predicateName.value,context2);let pathSymbol=this.operationFactory.createLink(predicateInitial);for(const predicateAlternative of predicateAlternatives.values){if(predicateAlternative.kind!=="EnumValue")throw new Error("Invalid value type for 'alt' argument, must be EnumValue, but got "+predicateAlternative.kind);pathSymbol=this.operationFactory.createAlt([pathSymbol,this.operationFactory.createLink(this.valueToNamedNode(predicateAlternative.value,context2))])}return context2&&context2.getContextRaw()[predicateName.value]&&context2.getContextRaw()[predicateName.value]["@reverse"]?this.operationFactory.createPath(object2,pathSymbol,subject2,graph):this.operationFactory.createPath(subject2,pathSymbol,object2,graph)}},"Util");Util$a.Util=Util$7;var __awaiter$6=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(Converter$3,"__esModule",{value:!0});Converter$3.Converter=void 0;const language_1=require$$0$1,handler_1=handler,directivenode_1=directivenode,IConvertContext_1=IConvertContext,Util_1$7=Util$a;let Converter$2=__name(class Converter{constructor(settings){settings=settings||{},settings.variableDelimiter=settings.variableDelimiter||"_",settings.expressionVariableCounter=settings.expressionVariableCounter||0,this.util=new Util_1$7.Util(settings),this.initializeNodeHandlers(settings)}static registerNodeHandlers(util2,settings){util2.registerNodeHandler(new handler_1.NodeHandlerDocument(util2,settings)),util2.registerNodeHandler(new handler_1.NodeHandlerDefinitionOperation(util2,settings)),util2.registerNodeHandler(new handler_1.NodeHandlerDefinitionFragment(util2,settings)),util2.registerNodeHandler(new handler_1.NodeHandlerSelectionFragmentSpread(util2,settings)),util2.registerNodeHandler(new handler_1.NodeHandlerSelectionInlineFragment(util2,settings)),util2.registerNodeHandler(new handler_1.NodeHandlerSelectionField(util2,settings))}static registerNodeValueHandlers(util2,settings){util2.registerNodeValueHandler(new handler_1.NodeValueHandlerVariable(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerInt(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerFloat(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerString(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerBoolean(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerNull(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerEnum(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerList(util2,settings)),util2.registerNodeValueHandler(new handler_1.NodeValueHandlerObject(util2,settings))}static registerDirectiveNodeHandlers(util2,settings){util2.registerDirectiveNodeHandler(new directivenode_1.DirectiveNodeHandlerInclude(util2,settings)),util2.registerDirectiveNodeHandler(new directivenode_1.DirectiveNodeHandlerOptional(util2,settings)),util2.registerDirectiveNodeHandler(new directivenode_1.DirectiveNodeHandlerPlural(util2,settings)),util2.registerDirectiveNodeHandler(new directivenode_1.DirectiveNodeHandlerSingle(util2,settings)),util2.registerDirectiveNodeHandler(new directivenode_1.DirectiveNodeHandlerSkip(util2,settings))}graphqlToSparqlAlgebra(graphqlQuery,context2,options){return __awaiter$6(this,void 0,void 0,function*(){return this.graphqlToSparqlAlgebraRawContext(graphqlQuery,yield this.util.contextParser.parse(context2),options)})}graphqlToSparqlAlgebraRawContext(graphqlQuery,context2,options){options=options||{};const document2=typeof graphqlQuery=="string"?(0,language_1.parse)(graphqlQuery):graphqlQuery,fragmentDefinitions=this.indexFragments(document2),convertContext={context:context2,fragmentDefinitions,graph:this.util.dataFactory.defaultGraph(),path:[],singularizeState:IConvertContext_1.SingularizeState.PLURAL,singularizeVariables:options.singularizeVariables||{},subject:null,terminalVariables:[],variablesDict:options.variablesDict||{},variablesMetaDict:{}};return this.util.handleNode(document2,convertContext)}indexFragments(document2){const fragmentDefinitions={},newDefinitions=[];for(const definition of document2.definitions)definition.kind==="FragmentDefinition"?fragmentDefinitions[definition.name.value]=definition:newDefinitions.push(definition);return document2.definitions=newDefinitions,fragmentDefinitions}initializeNodeHandlers(settings){Converter.registerNodeHandlers(this.util,settings),Converter.registerNodeValueHandlers(this.util,settings),Converter.registerDirectiveNodeHandlers(this.util,settings)}},"Converter");Converter$3.Converter=Converter$2;var IConvertSettings={};Object.defineProperty(IConvertSettings,"__esModule",{value:!0});(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(handler,exports),__exportStar(Converter$3,exports),__exportStar(IConvertContext,exports),__exportStar(IConvertSettings,exports),__exportStar(Util$a,exports)})(graphqlToSparql);Object.defineProperty(ActorQueryParseGraphql$1,"__esModule",{value:!0});ActorQueryParseGraphql$1.ActorQueryParseGraphql=void 0;const bus_query_parse_1=lib$2f,context_entries_1$n=lib$2x,graphql_to_sparql_1=graphqlToSparql;class ActorQueryParseGraphql extends bus_query_parse_1.ActorQueryParse{constructor(args){super(args),this.graphqlToSparql=new graphql_to_sparql_1.Converter({requireContext:!0})}async test(action){var _a2;if(((_a2=action.queryFormat)==null?void 0:_a2.language)!=="graphql")throw new Error("This actor can only parse GraphQL queries");return!0}async run(action){const context2=action.context.get(context_entries_1$n.KeysInitQuery.jsonLdContext)||{},options={singularizeVariables:action.context.get(context_entries_1$n.KeysInitQuery.graphqlSingularizeVariables)};return{operation:await this.graphqlToSparql.graphqlToSparqlAlgebra(action.query,context2,options)}}}__name(ActorQueryParseGraphql,"ActorQueryParseGraphql");ActorQueryParseGraphql$1.ActorQueryParseGraphql=ActorQueryParseGraphql;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryParseGraphql$1,exports)})(lib$2e);var lib$2d={},MediatorCombineUnion$1={};Object.defineProperty(MediatorCombineUnion$1,"__esModule",{value:!0});MediatorCombineUnion$1.MediatorCombineUnion=void 0;const core_1$m=lib$2A;class MediatorCombineUnion extends core_1$m.Mediator{constructor(args){super(args),this.combiner=this.createCombiner()}async mediate(action){let testResults;try{testResults=this.publish(action)}catch{testResults=[]}await Promise.all(testResults.map(({reply})=>reply));const results=await Promise.all(testResults.map(result=>result.actor.runObservable(action)));return this.combiner(results)}mediateWith(){throw new Error("Method not supported.")}createCombiner(){return results=>{const data={};return data[this.field]={},[{}].concat(results.map(result=>result[this.field])).forEach((value,index,arr)=>{data[this.field]={...value,...data[this.field]}}),data}}}__name(MediatorCombineUnion,"MediatorCombineUnion");MediatorCombineUnion$1.MediatorCombineUnion=MediatorCombineUnion;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(MediatorCombineUnion$1,exports)})(lib$2d);var lib$2c={},ActorQueryResultSerializeJson$1={},lib$2b={},ActorQueryResultSerialize$1={},lib$2a={},ActorAbstractMediaTyped$1={};Object.defineProperty(ActorAbstractMediaTyped$1,"__esModule",{value:!0});ActorAbstractMediaTyped$1.ActorAbstractMediaTyped=void 0;const core_1$l=lib$2A;class ActorAbstractMediaTyped extends core_1$l.Actor{constructor(args){super(args)}async run(action){if("handle"in action){const typedAction=action;return{handle:await this.runHandle(typedAction.handle,typedAction.handleMediaType,action.context)}}if("mediaTypes"in action)return{mediaTypes:await this.getMediaTypes(action.context)};if("mediaTypeFormats"in action)return{mediaTypeFormats:await this.getMediaTypeFormats(action.context)};throw new Error("Either a handle, mediaTypes or mediaTypeFormats action needs to be provided")}async test(action){if("handle"in action){const typedAction=action;return{handle:await this.testHandle(typedAction.handle,typedAction.handleMediaType,action.context)}}if("mediaTypes"in action)return{mediaTypes:await this.testMediaType(action.context)};if("mediaTypeFormats"in action)return{mediaTypeFormats:await this.testMediaTypeFormats(action.context)};throw new Error("Either a handle, mediaTypes or mediaTypeFormats action needs to be provided")}}__name(ActorAbstractMediaTyped,"ActorAbstractMediaTyped");ActorAbstractMediaTyped$1.ActorAbstractMediaTyped=ActorAbstractMediaTyped;var ActorAbstractMediaTypedFixed$1={};Object.defineProperty(ActorAbstractMediaTypedFixed$1,"__esModule",{value:!0});ActorAbstractMediaTypedFixed$1.ActorAbstractMediaTypedFixed=void 0;const ActorAbstractMediaTyped_1=ActorAbstractMediaTyped$1;class ActorAbstractMediaTypedFixed extends ActorAbstractMediaTyped_1.ActorAbstractMediaTyped{constructor(args){super(args);const scale=this.priorityScale||this.priorityScale===0?this.priorityScale:1;this.mediaTypePriorities&&Object.entries(this.mediaTypePriorities).forEach(([key,value],index)=>{this.mediaTypePriorities[key]=scale*value}),this.mediaTypePriorities=Object.freeze(this.mediaTypePriorities),this.mediaTypeFormats=Object.freeze(this.mediaTypeFormats)}async testHandle(action,mediaType,context2){if(!(mediaType in this.mediaTypePriorities))throw new Error(`Unrecognized media type: ${mediaType}`);return await this.testHandleChecked(action,context2)}async testMediaType(context2){return!0}async getMediaTypes(context2){return this.mediaTypePriorities}async testMediaTypeFormats(context2){return!0}async getMediaTypeFormats(context2){return this.mediaTypeFormats}}__name(ActorAbstractMediaTypedFixed,"ActorAbstractMediaTypedFixed");ActorAbstractMediaTypedFixed$1.ActorAbstractMediaTypedFixed=ActorAbstractMediaTypedFixed;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorAbstractMediaTyped$1,exports),__exportStar(ActorAbstractMediaTypedFixed$1,exports)})(lib$2a);Object.defineProperty(ActorQueryResultSerialize$1,"__esModule",{value:!0});ActorQueryResultSerialize$1.ActorQueryResultSerialize=void 0;const actor_abstract_mediatyped_1$5=lib$2a;class ActorQueryResultSerialize extends actor_abstract_mediatyped_1$5.ActorAbstractMediaTyped{constructor(args){super(args)}}__name(ActorQueryResultSerialize,"ActorQueryResultSerialize");ActorQueryResultSerialize$1.ActorQueryResultSerialize=ActorQueryResultSerialize;var ActorQueryResultSerializeFixedMediaTypes$1={};Object.defineProperty(ActorQueryResultSerializeFixedMediaTypes$1,"__esModule",{value:!0});ActorQueryResultSerializeFixedMediaTypes$1.ActorQueryResultSerializeFixedMediaTypes=void 0;const actor_abstract_mediatyped_1$4=lib$2a;class ActorQueryResultSerializeFixedMediaTypes extends actor_abstract_mediatyped_1$4.ActorAbstractMediaTypedFixed{constructor(args){super(args)}async testHandleChecked(action,context2){return!0}}__name(ActorQueryResultSerializeFixedMediaTypes,"ActorQueryResultSerializeFixedMediaTypes");ActorQueryResultSerializeFixedMediaTypes$1.ActorQueryResultSerializeFixedMediaTypes=ActorQueryResultSerializeFixedMediaTypes;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerialize$1,exports),__exportStar(ActorQueryResultSerializeFixedMediaTypes$1,exports)})(lib$2b);Object.defineProperty(ActorQueryResultSerializeJson$1,"__esModule",{value:!0});ActorQueryResultSerializeJson$1.ActorQueryResultSerializeJson=void 0;const bus_query_result_serialize_1$9=lib$2b,RdfString$2=rdfString,readable_stream_1$o=browserExports$1;class ActorQueryResultSerializeJson extends bus_query_result_serialize_1$9.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}async testHandleChecked(action,context2){if(!["bindings","quads","boolean"].includes(action.type))throw new Error("This actor can only handle bindings or quad streams.");return!0}async runHandle(action,mediaType,context2){const data=new readable_stream_1$o.Readable;data._read=()=>{};let empty=!0;if(action.type==="bindings"){const resultStream=action.bindingsStream;data.push("["),resultStream.on("error",error=>data.emit("error",error)),resultStream.on("data",element=>{data.push(empty?`
`:`,
`),data.push(JSON.stringify(Object.fromEntries([...element].map(([key,value])=>[key.value,RdfString$2.termToString(value)])))),empty=!1}),resultStream.on("end",()=>{data.push(empty?`]
`:`
]
`),data.push(null)})}else if(action.type==="quads"){const resultStream=action.quadStream;data.push("["),resultStream.on("error",error=>data.emit("error",error)),resultStream.on("data",element=>{data.push(empty?`
`:`,
`),data.push(JSON.stringify(RdfString$2.quadToStringQuad(element))),empty=!1}),resultStream.on("end",()=>{data.push(empty?`]
`:`
]
`),data.push(null)})}else try{data.push(`${JSON.stringify(await action.execute())}
`),data.push(null)}catch(error){setTimeout(()=>data.emit("error",error))}return{data}}}__name(ActorQueryResultSerializeJson,"ActorQueryResultSerializeJson");ActorQueryResultSerializeJson$1.ActorQueryResultSerializeJson=ActorQueryResultSerializeJson;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerializeJson$1,exports)})(lib$2c);var lib$29={},ActorQueryResultSerializeSimple$1={};Object.defineProperty(ActorQueryResultSerializeSimple$1,"__esModule",{value:!0});ActorQueryResultSerializeSimple$1.ActorQueryResultSerializeSimple=void 0;const bus_query_result_serialize_1$8=lib$2b,rdf_string_1$e=rdfString,readable_stream_1$n=browserExports$1;class ActorQueryResultSerializeSimple extends bus_query_result_serialize_1$8.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}async testHandleChecked(action,context2){if(!["bindings","quads","boolean","void"].includes(action.type))throw new Error("This actor can only handle bindings streams, quad streams, booleans, or updates.");return!0}static termToString(term){return term.termType==="Quad"?(0,rdf_string_1$e.termToString)(term):term.value}async runHandle(action,mediaType,context2){const data=new readable_stream_1$n.Readable;data._read=()=>{};let resultStream;if(action.type==="bindings")resultStream=action.bindingsStream,resultStream.on("error",error=>data.emit("error",error)),resultStream.on("data",bindings=>data.push(`${[...bindings].map(([key,value])=>`?${key.value}: ${ActorQueryResultSerializeSimple.termToString(value)}`).join(`
`)}

`)),resultStream.on("end",()=>data.push(null));else if(action.type==="quads")resultStream=action.quadStream,resultStream.on("error",error=>data.emit("error",error)),resultStream.on("data",quad=>data.push(`subject: ${ActorQueryResultSerializeSimple.termToString(quad.subject)}
predicate: ${ActorQueryResultSerializeSimple.termToString(quad.predicate)}
object: ${ActorQueryResultSerializeSimple.termToString(quad.object)}
graph: ${ActorQueryResultSerializeSimple.termToString(quad.graph)}

`)),resultStream.on("end",()=>data.push(null));else if(action.type==="boolean")try{data.push(`${JSON.stringify(await action.execute())}
`),data.push(null)}catch(error){setTimeout(()=>data.emit("error",error))}else action.execute().then(()=>{data.push(`ok
`),data.push(null)}).catch(error=>setTimeout(()=>data.emit("error",error)));return{data}}}__name(ActorQueryResultSerializeSimple,"ActorQueryResultSerializeSimple");ActorQueryResultSerializeSimple$1.ActorQueryResultSerializeSimple=ActorQueryResultSerializeSimple;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerializeSimple$1,exports)})(lib$29);var lib$28={},ActorQueryResultSerializeSparqlCsv$1={};Object.defineProperty(ActorQueryResultSerializeSparqlCsv$1,"__esModule",{value:!0});ActorQueryResultSerializeSparqlCsv$1.ActorQueryResultSerializeSparqlCsv=void 0;const bus_query_result_serialize_1$7=lib$2b,readable_stream_1$m=browserExports$1;class ActorQueryResultSerializeSparqlCsv extends bus_query_result_serialize_1$7.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}static bindingToCsvBindings(value){if(!value)return"";let stringValue=value.value;if(value.termType==="Literal")stringValue=`${stringValue}`;else if(value.termType==="BlankNode")stringValue=`_:${stringValue}`;else if(value.termType==="Quad"){let object2=ActorQueryResultSerializeSparqlCsv.bindingToCsvBindings(value.object);value.object.termType==="Literal"&&(object2=`"${object2.replace(/"/ug,'""')}"`),stringValue=`<< ${ActorQueryResultSerializeSparqlCsv.bindingToCsvBindings(value.subject)} ${ActorQueryResultSerializeSparqlCsv.bindingToCsvBindings(value.predicate)} ${object2} >>`}else stringValue=`<${stringValue}>`;return/[",\n\r]/u.test(stringValue)&&(stringValue=`"${stringValue.replace(/"/ug,'""')}"`),stringValue}async testHandleChecked(action,context2){if(action.type!=="bindings")throw new Error("This actor can only handle bindings streams.");return!0}async runHandle(action,mediaType,context2){const bindingsAction=action,data=new readable_stream_1$m.Readable;data._read=()=>{};const metadata=await bindingsAction.metadata();return data.push(`${metadata.variables.map(variable=>variable.value).join(",")}\r
`),bindingsAction.bindingsStream.on("error",error=>{data.emit("error",error)}),bindingsAction.bindingsStream.on("data",bindings=>{data.push(`${metadata.variables.map(key=>ActorQueryResultSerializeSparqlCsv.bindingToCsvBindings(bindings.get(key))).join(",")}\r
`)}),bindingsAction.bindingsStream.on("end",()=>{data.push(null)}),{data}}}__name(ActorQueryResultSerializeSparqlCsv,"ActorQueryResultSerializeSparqlCsv");ActorQueryResultSerializeSparqlCsv$1.ActorQueryResultSerializeSparqlCsv=ActorQueryResultSerializeSparqlCsv;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerializeSparqlCsv$1,exports)})(lib$28);var lib$27={},ActorQueryResultSerializeSparqlTsv$1={},rdfStringTtl={},TermUtil={};Object.defineProperty(TermUtil,"__esModule",{value:!0});TermUtil.stringQuadToQuad=TermUtil.quadToStringQuad=TermUtil.stringToTerm=TermUtil.getLiteralLanguage=TermUtil.getLiteralType=TermUtil.getLiteralValue=TermUtil.termToString=void 0;const rdf_data_factory_1$u=rdfDataFactory,FACTORY$1=new rdf_data_factory_1$u.DataFactory;function termToString(term){if(term)switch(term.termType){case"NamedNode":return`<${escapeIRI(term.value)}>`;case"BlankNode":return`_:${term.value}`;case"Literal":{const literalValue=term;return`"${escapeStringRDF(literalValue.value)}"${literalValue.datatype&&literalValue.datatype.value!=="http://www.w3.org/2001/XMLSchema#string"&&literalValue.datatype.value!=="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"?`^^<${literalValue.datatype.value}>`:""}${literalValue.language?`@${literalValue.language}`:""}`}case"Quad":return`<<${termToString(term.subject)} ${termToString(term.predicate)} ${termToString(term.object)}${term.graph.termType==="DefaultGraph"?"":` ${termToString(term.graph)}`}>>`;case"Variable":return`?${term.value}`;case"DefaultGraph":return term.value}}__name(termToString,"termToString");TermUtil.termToString=termToString;function getLiteralValue(literalValue){const match=/^"([^]*)"((\^\^.*)|(@.*))?$/u.exec(literalValue);if(!match)throw new Error(`${literalValue} is not a literal`);return match[1].replace(/\\"/ug,'"')}__name(getLiteralValue,"getLiteralValue");TermUtil.getLiteralValue=getLiteralValue;function getLiteralType(literalValue){const match=/^"[^]*"(?:\^\^<([^"]+)>|(@)[^@"]+)?$/u.exec(literalValue);if(!match)throw new Error(`${literalValue} is not a literal`);return match[1]||(match[2]?"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString":"http://www.w3.org/2001/XMLSchema#string")}__name(getLiteralType,"getLiteralType");TermUtil.getLiteralType=getLiteralType;function getLiteralLanguage(literalValue){const match=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/u.exec(literalValue);if(!match)throw new Error(`${literalValue} is not a literal`);return match[1]?match[1].toLowerCase():""}__name(getLiteralLanguage,"getLiteralLanguage");TermUtil.getLiteralLanguage=getLiteralLanguage;function stringToTerm(value,dataFactory){if(dataFactory=dataFactory||FACTORY$1,!value||value.length===0)return dataFactory.defaultGraph();switch(value[0]){case"_":return dataFactory.blankNode(value.slice(2));case"?":if(!dataFactory.variable)throw new Error("Missing 'variable()' method on the given DataFactory");return dataFactory.variable(value.slice(1));case'"':{const language2=getLiteralLanguage(value),type=dataFactory.namedNode(getLiteralType(value));return dataFactory.literal(getLiteralValue(value),language2||type)}case"<":default:if(value.startsWith("<<")&&value.endsWith(">>")){const terms=value.slice(2,-2),stringTerms=[];let ignoreTags=0,lastIndex=0;for(let i=0;i<terms.length;i++){const char=terms[i];if(char==="<"&&ignoreTags++,char===">"){if(ignoreTags===0)throw new Error(`Found closing tag without opening tag in ${value}`);ignoreTags--}char===" "&&ignoreTags===0&&(stringTerms.push(terms.slice(lastIndex,i)),lastIndex=i+1)}if(ignoreTags!==0)throw new Error(`Found opening tag without closing tag in ${value}`);if(stringTerms.push(terms.slice(lastIndex,terms.length)),stringTerms.length!==3&&stringTerms.length!==4)throw new Error(`Nested quad syntax error ${value}`);return dataFactory.quad(stringToTerm(stringTerms[0]),stringToTerm(stringTerms[1]),stringToTerm(stringTerms[2]),stringTerms[3]?stringToTerm(stringTerms[3]):void 0)}if(!value.startsWith("<")||!value.endsWith(">"))throw new Error(`Detected invalid iri for named node (must be wrapped in <>): ${value}`);return dataFactory.namedNode(value.slice(1,-1))}}__name(stringToTerm,"stringToTerm");TermUtil.stringToTerm=stringToTerm;function quadToStringQuad(quad){return{subject:termToString(quad.subject),predicate:termToString(quad.predicate),object:termToString(quad.object),graph:termToString(quad.graph)}}__name(quadToStringQuad,"quadToStringQuad");TermUtil.quadToStringQuad=quadToStringQuad;function stringQuadToQuad(stringQuad,dataFactory){return dataFactory=dataFactory||FACTORY$1,dataFactory.quad(stringToTerm(stringQuad.subject,dataFactory),stringToTerm(stringQuad.predicate,dataFactory),stringToTerm(stringQuad.object,dataFactory),stringToTerm(stringQuad.graph,dataFactory))}__name(stringQuadToQuad,"stringQuadToQuad");TermUtil.stringQuadToQuad=stringQuadToQuad;function escapeIRI(iriValue){return iriValue.replace(escapePattern,replaceEscapedCharacter)}__name(escapeIRI,"escapeIRI");function escapeStringRDF(stringValue){return escapePattern.test(stringValue)&&(stringValue=stringValue.replace(escapePattern,replaceEscapedCharacter)),stringValue}__name(escapeStringRDF,"escapeStringRDF");const escapePattern=/["\\\t\n\r\b\f\u0000-\u0019]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,escapes=new Map([["\\","\\\\"],['"','\\"'],["	","\\t"],[`
`,"\\n"],["\r","\\r"],["\b","\\b"],["\f","\\f"]]);function replaceEscapedCharacter(character){const result=escapes.get(character);if(!result){if(character.length===1){const code2=character.charCodeAt(0).toString(16);return`${"\\u0000".slice(0,-code2.length)}${code2}`}const code=((character.charCodeAt(0)-55296)*1024+character.charCodeAt(1)+9216).toString(16);return`${"\\U00000000".slice(0,-code.length)}${code}`}return result}__name(replaceEscapedCharacter,"replaceEscapedCharacter");(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.termToString=exports.stringToTerm=exports.stringQuadToQuad=exports.quadToStringQuad=exports.getLiteralValue=exports.getLiteralType=exports.getLiteralLanguage=void 0;const TermUtil_1=TermUtil;Object.defineProperty(exports,"getLiteralLanguage",{enumerable:!0,get:function(){return TermUtil_1.getLiteralLanguage}}),Object.defineProperty(exports,"getLiteralType",{enumerable:!0,get:function(){return TermUtil_1.getLiteralType}}),Object.defineProperty(exports,"getLiteralValue",{enumerable:!0,get:function(){return TermUtil_1.getLiteralValue}}),Object.defineProperty(exports,"quadToStringQuad",{enumerable:!0,get:function(){return TermUtil_1.quadToStringQuad}}),Object.defineProperty(exports,"stringQuadToQuad",{enumerable:!0,get:function(){return TermUtil_1.stringQuadToQuad}}),Object.defineProperty(exports,"stringToTerm",{enumerable:!0,get:function(){return TermUtil_1.stringToTerm}}),Object.defineProperty(exports,"termToString",{enumerable:!0,get:function(){return TermUtil_1.termToString}})})(rdfStringTtl);Object.defineProperty(ActorQueryResultSerializeSparqlTsv$1,"__esModule",{value:!0});ActorQueryResultSerializeSparqlTsv$1.ActorQueryResultSerializeSparqlTsv=void 0;const bus_query_result_serialize_1$6=lib$2b,rdf_string_ttl_1$3=rdfStringTtl,readable_stream_1$l=browserExports$1;class ActorQueryResultSerializeSparqlTsv extends bus_query_result_serialize_1$6.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}static bindingToTsvBindings(value){return value?(0,rdf_string_ttl_1$3.termToString)(value).replace(/\t/gu,"\\t").replace(/\n/gu,"\\n").replace(/\r/gu,"\\r"):""}async testHandleChecked(action,context2){if(action.type!=="bindings")throw new Error("This actor can only handle bindings streams.");return!0}async runHandle(action,mediaType,context2){const bindingsAction=action,data=new readable_stream_1$l.Readable;data._read=()=>{};const metadata=await bindingsAction.metadata();return data.push(`${metadata.variables.map(variable=>variable.value).join("	")}
`),bindingsAction.bindingsStream.on("error",error=>{data.emit("error",error)}),bindingsAction.bindingsStream.on("data",bindings=>{data.push(`${metadata.variables.map(key=>ActorQueryResultSerializeSparqlTsv.bindingToTsvBindings(bindings.get(key))).join("	")}
`)}),bindingsAction.bindingsStream.on("end",()=>{data.push(null)}),{data}}}__name(ActorQueryResultSerializeSparqlTsv,"ActorQueryResultSerializeSparqlTsv");ActorQueryResultSerializeSparqlTsv$1.ActorQueryResultSerializeSparqlTsv=ActorQueryResultSerializeSparqlTsv;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerializeSparqlTsv$1,exports)})(lib$27);var lib$26={},ActorQueryResultSerializeSparqlXml$1={},XmlSerializer$1={};Object.defineProperty(XmlSerializer$1,"__esModule",{value:!0});XmlSerializer$1.XmlSerializer=void 0;class XmlSerializer{constructor(push){this.stack=[],this.push=push,this.push(`<?xml version="1.0" encoding="UTF-8"?>
`)}open(name,attributes){this.push(`${this.identation()+this.formatTag(name,attributes,"open")}
`),this.stack.push(name)}close(){const name=this.stack.pop();if(name===void 0)throw new Error("There is no tag left to close");this.push(`${this.identation()+this.formatTag(name,{},"close")}
`)}add(node2){this.push(this.serializeNode(node2))}serializeNode(node2){if(node2.children===void 0)return`${this.identation()+this.formatTag(node2.name,node2.attributes,"self-closing")}
`;if(typeof node2.children=="string")return`${this.identation()+this.formatTag(node2.name,node2.attributes,"open")+this.escape(node2.children)+this.formatTag(node2.name,{},"close")}
`;const parts=[];parts.push(`${this.identation()+this.formatTag(node2.name,node2.attributes,"open")}
`),this.stack.push(node2.name);for(const child of node2.children)parts.push(this.serializeNode(child));return this.stack.pop(),parts.push(`${this.identation()+this.formatTag(node2.name,{},"close")}
`),parts.join("")}identation(){return this.stack.map(_=>"  ").join("")}formatTag(name,attributes,state){return`<${state==="close"?"/":""}${name}${Object.entries(attributes||{}).map(attr=>` ${attr[0]}="${this.escape(attr[1])}"`)}${state==="self-closing"?"/":""}>`}escape(text){return text.replace(/["&'<>]/gu,char=>{switch(char){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})}}__name(XmlSerializer,"XmlSerializer");XmlSerializer$1.XmlSerializer=XmlSerializer;Object.defineProperty(ActorQueryResultSerializeSparqlXml$1,"__esModule",{value:!0});ActorQueryResultSerializeSparqlXml$1.ActorQueryResultSerializeSparqlXml=void 0;const bus_query_result_serialize_1$5=lib$2b,readable_stream_1$k=browserExports$1,XmlSerializer_1=XmlSerializer$1;class ActorQueryResultSerializeSparqlXml extends bus_query_result_serialize_1$5.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}static bindingToXmlBindings(value,key){return{name:"binding",attributes:{name:key.value},children:[this.valueToXmlValue(value)]}}static valueToXmlValue(value){let attributes;switch(value.termType){case"Literal":return value.language?attributes={"xml:lang":value.language}:value.datatype&&value.datatype.value!=="http://www.w3.org/2001/XMLSchema#string"?attributes={datatype:value.datatype.value}:attributes={},{name:"literal",attributes,children:value.value};case"BlankNode":return{name:"bnode",children:value.value};case"Quad":return{name:"triple",children:[{name:"subject",children:[this.valueToXmlValue(value.subject)]},{name:"predicate",children:[this.valueToXmlValue(value.predicate)]},{name:"object",children:[this.valueToXmlValue(value.object)]}]};default:return{name:"uri",children:value.value}}}async testHandleChecked(action,context2){if(!["bindings","boolean"].includes(action.type))throw new Error("This actor can only handle bindings streams or booleans.");return!0}async runHandle(action,mediaType,context2){const data=new readable_stream_1$k.Readable;data._read=()=>{};const serializer=new XmlSerializer_1.XmlSerializer(chunk=>data.push(chunk));serializer.open("sparql",{xmlns:"http://www.w3.org/2005/sparql-results#"});const metadata=await action.metadata();if(serializer.add({name:"head",children:metadata.variables.map(variable=>({name:"variable",attributes:{name:variable.value}}))}),action.type==="bindings"){serializer.open("results");const resultStream=action.bindingsStream;resultStream.on("error",error=>{data.emit("error",error)}),resultStream.on("data",bindings=>{serializer.add({name:"result",children:[...bindings].map(([key,value])=>ActorQueryResultSerializeSparqlXml.bindingToXmlBindings(value,key))})}),resultStream.on("end",()=>{serializer.close(),serializer.close(),setTimeout(()=>data.push(null))})}else try{const result=await action.execute();serializer.add({name:"boolean",children:result.toString()}),serializer.close(),setTimeout(()=>data.push(null))}catch(error){setTimeout(()=>data.emit("error",error))}return{data}}}__name(ActorQueryResultSerializeSparqlXml,"ActorQueryResultSerializeSparqlXml");ActorQueryResultSerializeSparqlXml$1.ActorQueryResultSerializeSparqlXml=ActorQueryResultSerializeSparqlXml;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerializeSparqlXml$1,exports)})(lib$26);var lib$25={},ActorQueryResultSerializeTable$1={};Object.defineProperty(ActorQueryResultSerializeTable$1,"__esModule",{value:!0});ActorQueryResultSerializeTable$1.ActorQueryResultSerializeTable=void 0;const bus_query_result_serialize_1$4=lib$2b,rdf_data_factory_1$t=rdfDataFactory,rdf_string_1$d=rdfString,rdf_terms_1$b=rdfTerms,readable_stream_1$j=browserExports$1,DF$j=new rdf_data_factory_1$t.DataFactory,QUAD_TERM_NAMES_VARS=rdf_terms_1$b.QUAD_TERM_NAMES.map(name=>DF$j.variable(name));class ActorQueryResultSerializeTable extends bus_query_result_serialize_1$4.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args),this.padding=ActorQueryResultSerializeTable.repeat(" ",this.columnWidth)}static repeat(str,count2){return new Array(count2+1).join(str)}async testHandleChecked(action,context2){if(!["bindings","quads"].includes(action.type))throw new Error("This actor can only handle bindings or quad streams.");return!0}termToString(term){return term.termType==="Quad"?(0,rdf_string_1$d.termToString)(term):term.value}pad(str){return str.length<=this.columnWidth?str+this.padding.slice(str.length):`${str.slice(0,this.columnWidth-1)}`}pushHeader(data,labels){const header=labels.map(label=>this.pad(label.value)).join(" ");data.push(`${header}
${ActorQueryResultSerializeTable.repeat("-",header.length)}
`)}pushRow(data,labels,bindings){data.push(`${labels.map(label=>bindings.has(label)?this.termToString(bindings.get(label)):"").map(label=>this.pad(label)).join(" ")}
`)}async runHandle(action,mediaType,context2){const data=new readable_stream_1$j.Readable;data._read=()=>{};let resultStream;if(action.type==="bindings"){resultStream=action.bindingsStream;const labels=(await action.metadata()).variables;this.pushHeader(data,labels),resultStream.on("error",error=>data.emit("error",error)),resultStream.on("data",bindings=>this.pushRow(data,labels,bindings))}else resultStream=action.quadStream,this.pushHeader(data,QUAD_TERM_NAMES_VARS),resultStream.on("error",error=>data.emit("error",error)),resultStream.on("data",quad=>data.push(`${(0,rdf_terms_1$b.getTerms)(quad).map(term=>this.pad(this.termToString(term))).join(" ")}
`));return resultStream.on("end",()=>data.push(null)),{data}}}__name(ActorQueryResultSerializeTable,"ActorQueryResultSerializeTable");ActorQueryResultSerializeTable$1.ActorQueryResultSerializeTable=ActorQueryResultSerializeTable;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerializeTable$1,exports)})(lib$25);var lib$24={},ActorQueryResultSerializeTree$1={},sparqljsonToTree={},Converter$1={};Object.defineProperty(Converter$1,"__esModule",{value:!0});Converter$1.Converter=void 0;const rdf_literal_1=rdfLiteral,sparqljson_parse_1$3=sparqljsonParse;class Converter2{constructor(settings){settings=settings||{delimiter:"_"},settings.prefixVariableQuestionMark=!1,this.delimiter=settings.delimiter||"_",this.parser=new sparqljson_parse_1$3.SparqlJsonParser(settings),this.materializeRdfJsTerms=settings.materializeRdfJsTerms}static addValueToTree(tree,path,value,lastKeyPath,schema,delimiter){const key=path[0],keyPath=lastKeyPath?lastKeyPath+delimiter+key:key,singularize=schema.singularizeVariables[keyPath];if(path.length===1)singularize?tree[key]||(tree[key]=value):(tree[key]||(tree[key]=[]),tree[key].push(value));else{let nextNode;singularize?(tree[key]||(tree[key]={}),nextNode=tree[key]):(tree[key]||(tree[key]=[{}]),nextNode=tree[key][0]),Converter2.addValueToTree(nextNode,path.slice(1),value,keyPath,schema,delimiter)}}static mergeTrees(tree1,tree2){if(typeof tree1!=typeof tree2)throw new Error(`Two incompatible tree nodes were found: ${typeof tree1} and ${typeof tree2}`);if(Array.isArray(tree1)!==Array.isArray(tree2))throw new Error(`Two incompatible tree nodes were found: Array?${Array.isArray(tree1)} and Array?${Array.isArray(tree2)}`);if(typeof tree1=="object"&&typeof tree2=="object"){if(tree1.termType&&tree2.termType)return tree1.equals(tree2)?{valid:!0,result:tree1}:{valid:!1,result:tree1};if(Array.isArray(tree1)&&Array.isArray(tree2)){if(tree1.length>0){const merged=[];let valid=!1;for(const tree1Element of tree1){const mergedElement=Converter2.mergeTrees(tree1Element,tree2[0]);mergedElement.valid?(valid=!0,merged.push(mergedElement.result)):merged.push(tree1Element)}if(valid)return{valid:!0,result:merged}}return{valid:!0,result:tree1.concat(tree2)}}else{const merged={};for(const key2 in tree2)merged[key2]=tree2[key2];for(const key1 in tree1)if(merged[key1]){const mergedElement=Converter2.mergeTrees(tree1[key1],merged[key1]);if(mergedElement.valid)merged[key1]=mergedElement.result;else return{valid:!1,result:tree1}}else merged[key1]=tree1[key1];return{valid:!0,result:merged}}}else throw new Error(`Unmergable tree types: ${typeof tree1} and ${typeof tree2}`)}static materializeTree(tree){if(tree.termType)return(0,rdf_literal_1.getTermRaw)(tree);if(Array.isArray(tree))return tree.map(Converter2.materializeTree);{const materialized={};for(const key in tree)materialized[key]=Converter2.materializeTree(tree[key]);return materialized}}sparqlJsonResultsToTree(sparqlResponse,schema){return this.bindingsToTree(this.parser.parseJsonResults(sparqlResponse),schema||{singularizeVariables:{}})}bindingsToTree(bindingsArray,schema){const singularRoot=schema&&schema.singularizeVariables[""];let tree=singularRoot?{}:[];for(const bindings of bindingsArray){const subTree=singularRoot?{}:[{}];for(const key in bindings){const path=key.split(this.delimiter),value=bindings[key];Converter2.addValueToTree(singularRoot?subTree:subTree[0],path,value,"",schema,this.delimiter)}tree=Converter2.mergeTrees(tree,subTree).result}return this.materializeRdfJsTerms&&(tree=Converter2.materializeTree(tree)),tree}}__name(Converter2,"Converter");Converter$1.Converter=Converter2;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(Converter$1,exports)})(sparqljsonToTree);Object.defineProperty(ActorQueryResultSerializeTree$1,"__esModule",{value:!0});ActorQueryResultSerializeTree$1.ActorQueryResultSerializeTree=void 0;const bus_query_result_serialize_1$3=lib$2b,context_entries_1$m=lib$2x,core_1$k=lib$2A,readable_stream_1$i=browserExports$1,sparqljson_to_tree_1=sparqljsonToTree;class ActorQueryResultSerializeTree extends bus_query_result_serialize_1$3.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}static bindingsStreamToGraphQl(bindingsStream,context2,converterSettings){const actionContext=core_1$k.ActionContext.ensureActionContext(context2);return new Promise((resolve2,reject)=>{const bindingsArray=[],converter=new sparqljson_to_tree_1.Converter(converterSettings),schema={singularizeVariables:actionContext.get(context_entries_1$m.KeysInitQuery.graphqlSingularizeVariables)||{}};bindingsStream.on("error",reject),bindingsStream.on("data",bindings=>{bindingsArray.push(Object.fromEntries([...bindings].map(([key,value])=>[key.value,value])))}),bindingsStream.on("end",()=>{resolve2(converter.bindingsToTree(bindingsArray,schema))})})}async testHandleChecked(action){if(action.type!=="bindings")throw new Error("This actor can only handle bindings streams.");return!0}async runHandle(action,mediaType){const data=new readable_stream_1$i.Readable;data._read=()=>{};const resultStream=action.bindingsStream;return resultStream.on("error",error=>data.emit("error",error)),ActorQueryResultSerializeTree.bindingsStreamToGraphQl(resultStream,action.context,{materializeRdfJsTerms:!0}).then(result=>{data.push(JSON.stringify(result,null,"  ")),data.push(null)}).catch(error=>data.emit("error",error)),{data}}}__name(ActorQueryResultSerializeTree,"ActorQueryResultSerializeTree");ActorQueryResultSerializeTree$1.ActorQueryResultSerializeTree=ActorQueryResultSerializeTree;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.bindingsStreamToGraphQl=void 0;const ActorQueryResultSerializeTree_1=ActorQueryResultSerializeTree$1,{bindingsStreamToGraphQl}=ActorQueryResultSerializeTree_1.ActorQueryResultSerializeTree;exports.bindingsStreamToGraphQl=bindingsStreamToGraphQl,__exportStar(ActorQueryResultSerializeTree$1,exports)})(lib$24);var lib$23={},MediatorAll$1={};Object.defineProperty(MediatorAll$1,"__esModule",{value:!0});MediatorAll$1.MediatorAll=void 0;const core_1$j=lib$2A;class MediatorAll extends core_1$j.Mediator{constructor(args){super(args)}async mediate(action){const validActors=[];let testResults;try{testResults=this.publish(action)}catch{testResults=[]}for(const testResult of testResults)try{await testResult.reply,validActors.push(testResult.actor)}catch{}return(await Promise.all(validActors.map(actor=>actor.runObservable(action))))[0]}async mediateWith(){throw new Error("Unsupported operation: MediatorAll#mediateWith")}}__name(MediatorAll,"MediatorAll");MediatorAll$1.MediatorAll=MediatorAll;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(MediatorAll$1,exports)})(lib$23);var lib$22={},ActorHttpInvalidate$1={};Object.defineProperty(ActorHttpInvalidate$1,"__esModule",{value:!0});ActorHttpInvalidate$1.ActorHttpInvalidate=void 0;const core_1$i=lib$2A;class ActorHttpInvalidate extends core_1$i.Actor{constructor(args){super(args)}}__name(ActorHttpInvalidate,"ActorHttpInvalidate");ActorHttpInvalidate$1.ActorHttpInvalidate=ActorHttpInvalidate;var ActorHttpInvalidateListenable$1={};Object.defineProperty(ActorHttpInvalidateListenable$1,"__esModule",{value:!0});ActorHttpInvalidateListenable$1.ActorHttpInvalidateListenable=void 0;const ActorHttpInvalidate_1=ActorHttpInvalidate$1;class ActorHttpInvalidateListenable extends ActorHttpInvalidate_1.ActorHttpInvalidate{constructor(args){super(args),this.invalidateListeners=[],this.invalidateListeners=[]}addInvalidateListener(listener){this.invalidateListeners.push(listener)}async test(action){return!0}async run(action){for(const listener of this.invalidateListeners)listener(action);return{}}}__name(ActorHttpInvalidateListenable,"ActorHttpInvalidateListenable");ActorHttpInvalidateListenable$1.ActorHttpInvalidateListenable=ActorHttpInvalidateListenable;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorHttpInvalidate$1,exports),__exportStar(ActorHttpInvalidateListenable$1,exports)})(lib$22);var lib$21={},ActorRdfSerializeN3$1={},lib$20={},ActorRdfSerialize$1={};Object.defineProperty(ActorRdfSerialize$1,"__esModule",{value:!0});ActorRdfSerialize$1.ActorRdfSerialize=void 0;const actor_abstract_mediatyped_1$3=lib$2a;class ActorRdfSerialize extends actor_abstract_mediatyped_1$3.ActorAbstractMediaTyped{constructor(args){super(args)}}__name(ActorRdfSerialize,"ActorRdfSerialize");ActorRdfSerialize$1.ActorRdfSerialize=ActorRdfSerialize;var ActorRdfSerializeFixedMediaTypes$1={};Object.defineProperty(ActorRdfSerializeFixedMediaTypes$1,"__esModule",{value:!0});ActorRdfSerializeFixedMediaTypes$1.ActorRdfSerializeFixedMediaTypes=void 0;const actor_abstract_mediatyped_1$2=lib$2a;class ActorRdfSerializeFixedMediaTypes extends actor_abstract_mediatyped_1$2.ActorAbstractMediaTypedFixed{constructor(args){super(args)}async testHandleChecked(action){return!0}}__name(ActorRdfSerializeFixedMediaTypes,"ActorRdfSerializeFixedMediaTypes");ActorRdfSerializeFixedMediaTypes$1.ActorRdfSerializeFixedMediaTypes=ActorRdfSerializeFixedMediaTypes;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfSerialize$1,exports),__exportStar(ActorRdfSerializeFixedMediaTypes$1,exports)})(lib$20);Object.defineProperty(ActorRdfSerializeN3$1,"__esModule",{value:!0});ActorRdfSerializeN3$1.ActorRdfSerializeN3=void 0;const bus_rdf_serialize_1$2=lib$20,n3_1$5=require$$0$3;class ActorRdfSerializeN3 extends bus_rdf_serialize_1$2.ActorRdfSerializeFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){const writer2=new n3_1$5.StreamWriter({format:mediaType});let data;return"pipe"in action.quadStream?(action.quadStream.on("error",error=>writer2.emit("error",error)),data=action.quadStream.pipe(writer2)):data=writer2.import(action.quadStream),{data,triples:mediaType==="text/turtle"||mediaType==="application/n-triples"||mediaType==="text/n3"}}}__name(ActorRdfSerializeN3,"ActorRdfSerializeN3");ActorRdfSerializeN3$1.ActorRdfSerializeN3=ActorRdfSerializeN3;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfSerializeN3$1,exports)})(lib$21);var lib$1$={},ActorRdfSerializeJsonLd$1={},jsonldStreamingSerializer={},JsonLdSerializer$1={},SeparatorType$1={};Object.defineProperty(SeparatorType$1,"__esModule",{value:!0});SeparatorType$1.SeparatorType=void 0;class SeparatorType{constructor(label){this.label=label}}__name(SeparatorType,"SeparatorType");SeparatorType$1.SeparatorType=SeparatorType;SeparatorType.COMMA=new SeparatorType(",");SeparatorType.OBJECT_START=new SeparatorType("{");SeparatorType.OBJECT_END=new SeparatorType("}");SeparatorType.OBJECT_END_COMMA=new SeparatorType("},");SeparatorType.ARRAY_START=new SeparatorType("[");SeparatorType.ARRAY_END=new SeparatorType("]");SeparatorType.ARRAY_END_COMMA=new SeparatorType("],");SeparatorType.GRAPH_FIELD_NONCOMPACT=new SeparatorType('"@graph": [');SeparatorType.GRAPH_FIELD_COMPACT=new SeparatorType('"@graph":[');SeparatorType.CONTEXT_FIELD=new SeparatorType('"@context":');var Util$6={};Object.defineProperty(Util$6,"__esModule",{value:!0});Util$6.Util=void 0;const jsonld_context_parser_1$b=jsonldContextParser;let Util$5=__name(class Util4{static termToValue(term,context2,options={compactIds:!1,useNativeTypes:!1}){switch(term.termType){case"NamedNode":const compacted=context2.compactIri(term.value,options.vocab);return options.compactIds?compacted:{"@id":compacted};case"DefaultGraph":return options.compactIds?term.value:{"@id":term.value};case"BlankNode":const id=`_:${term.value}`;return options.compactIds?id:{"@id":id};case"Literal":if(term.datatype.value===Util4.RDF_JSON){let parsedJson;try{parsedJson=JSON.parse(term.value)}catch(e){throw new jsonld_context_parser_1$b.ErrorCoded("Invalid JSON literal: "+e.message,jsonld_context_parser_1$b.ERROR_CODES.INVALID_JSON_LITERAL)}return{"@value":parsedJson,"@type":"@json"}}if(options.rdfDirection==="i18n-datatype"&&term.datatype.value.startsWith(Util4.I18N)){const[language2,direction]=term.datatype.value.substr(Util4.I18N.length,term.datatype.value.length).split("_");return Object.assign(Object.assign({"@value":term.value},language2?{"@language":language2}:{}),direction?{"@direction":direction}:{})}const stringType=term.datatype.value===Util4.XSD_STRING,rawValue={"@value":!stringType&&options.useNativeTypes?Util4.stringToNativeType(term.value,term.datatype.value):term.value};return term.language?Object.assign(Object.assign({},rawValue),{"@language":term.language}):!stringType&&typeof rawValue["@value"]=="string"?Object.assign(Object.assign({},rawValue),{"@type":term.datatype.value}):rawValue}}static stringToNativeType(value,type){if(type.startsWith(Util4.XSD))switch(type.substr(Util4.XSD.length)){case"boolean":if(value==="true")return!0;if(value==="false")return!1;throw new Error(`Invalid xsd:boolean value '${value}'`);case"integer":case"number":case"int":case"byte":case"long":const parsedInt=parseInt(value,10);if(isNaN(parsedInt))throw new Error(`Invalid xsd:integer value '${value}'`);return parsedInt;case"float":case"double":const parsedFloat=parseFloat(value);if(isNaN(parsedFloat))throw new Error(`Invalid xsd:float value '${value}'`);return parsedFloat}return value}},"Util");Util$6.Util=Util$5;Util$5.XSD="http://www.w3.org/2001/XMLSchema#";Util$5.XSD_STRING=Util$5.XSD+"string";Util$5.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";Util$5.RDF_TYPE=Util$5.RDF+"type";Util$5.RDF_JSON=Util$5.RDF+"JSON";Util$5.I18N="https://www.w3.org/ns/i18n#";Object.defineProperty(JsonLdSerializer$1,"__esModule",{value:!0});JsonLdSerializer$1.JsonLdSerializer=void 0;const jsonld_context_parser_1$a=jsonldContextParser,SeparatorType_1=SeparatorType$1,Util_1$6=Util$6,readable_stream_1$h=browserExports$1;class JsonLdSerializer extends readable_stream_1$h.Transform{constructor(options={}){super({objectMode:!0}),this.indentation=0,this.options=options,this.options.baseIRI&&!this.options.context&&(this.options.context={"@base":this.options.baseIRI}),this.options.context?(this.originalContext=this.options.context,this.context=new jsonld_context_parser_1$a.ContextParser().parse(this.options.context,{baseIRI:this.options.baseIRI})):this.context=Promise.resolve(new jsonld_context_parser_1$a.JsonLdContextNormalized({}))}import(stream){const output=new readable_stream_1$h.PassThrough({objectMode:!0});stream.on("error",error=>parsed.emit("error",error)),stream.on("data",data=>output.push(data)),stream.on("end",()=>output.push(null));const parsed=output.pipe(new JsonLdSerializer(this.options));return parsed}_transform(quad,encoding,callback){this.context.then(context2=>{this.transformQuad(quad,context2),callback()}).catch(callback)}async list(values2){const context2=await this.context;return{"@list":values2.map(value=>Util_1$6.Util.termToValue(value,context2,this.options))}}_flush(callback){return this.opened||this.pushDocumentStart(),this.lastPredicate&&this.endPredicate(),this.lastSubject&&this.endSubject(),this.lastGraph&&this.lastGraph.termType!=="DefaultGraph"&&this.endGraph(),this.endDocument(),callback(null,null)}transformQuad(quad,context2){this.opened||this.pushDocumentStart();const lastGraphMatchesSubject=this.lastGraph&&this.lastGraph.termType!=="DefaultGraph"&&this.lastGraph.equals(quad.subject);if(!lastGraphMatchesSubject&&(!this.lastGraph||!quad.graph.equals(this.lastGraph))){let lastSubjectMatchesGraph=quad.graph.termType!=="DefaultGraph"&&this.lastSubject&&this.lastSubject.equals(quad.graph);this.lastGraph&&(this.lastGraph.termType!=="DefaultGraph"?(this.endPredicate(),this.endSubject(),this.endGraph(!0),lastSubjectMatchesGraph=!1):lastSubjectMatchesGraph?(this.endPredicate(!0),this.lastSubject=null):(this.endPredicate(),this.endSubject(!0))),quad.graph.termType!=="DefaultGraph"&&(lastSubjectMatchesGraph||this.pushId(quad.graph,!0,context2),this.pushSeparator(this.options.space?SeparatorType_1.SeparatorType.GRAPH_FIELD_NONCOMPACT:SeparatorType_1.SeparatorType.GRAPH_FIELD_COMPACT),this.indentation++),this.lastGraph=quad.graph}(!this.lastSubject||!quad.subject.equals(this.lastSubject))&&(lastGraphMatchesSubject?(this.endPredicate(),this.endSubject(),this.indentation--,this.pushSeparator(SeparatorType_1.SeparatorType.ARRAY_END_COMMA),this.lastGraph=quad.graph):(this.lastSubject&&(this.endPredicate(),this.endSubject(!0)),this.pushId(quad.subject,!0,context2)),this.lastSubject=quad.subject),(!this.lastPredicate||!quad.predicate.equals(this.lastPredicate))&&(this.lastPredicate&&this.endPredicate(!0),this.pushPredicate(quad.predicate,context2)),this.pushObject(quad.object,context2)}pushDocumentStart(){this.opened=!0,this.originalContext&&!this.options.excludeContext?(this.pushSeparator(SeparatorType_1.SeparatorType.OBJECT_START),this.indentation++,this.pushSeparator(SeparatorType_1.SeparatorType.CONTEXT_FIELD),this.pushIndented(JSON.stringify(this.originalContext,null,this.options.space)+","),this.pushSeparator(this.options.space?SeparatorType_1.SeparatorType.GRAPH_FIELD_NONCOMPACT:SeparatorType_1.SeparatorType.GRAPH_FIELD_COMPACT),this.indentation++):(this.pushSeparator(SeparatorType_1.SeparatorType.ARRAY_START),this.indentation++)}pushId(term,startOnNewLine,context2){if(term.termType==="Quad")this.pushNestedQuad(term,!0,context2);else{const subjectValue=term.termType==="BlankNode"?"_:"+term.value:context2.compactIri(term.value,!1);startOnNewLine?this.pushSeparator(SeparatorType_1.SeparatorType.OBJECT_START):(this.push(SeparatorType_1.SeparatorType.OBJECT_START.label),this.options.space&&this.push(`
`)),this.indentation++,this.pushIndented(this.options.space?`"@id": "${subjectValue}",`:`"@id":"${subjectValue}",`)}}pushPredicate(predicate2,context2){let property=predicate2.value;!this.options.useRdfType&&property===Util_1$6.Util.RDF_TYPE&&(property="@type",this.objectOptions=Object.assign(Object.assign({},this.options),{compactIds:!0,vocab:!0}));const compactedProperty=context2.compactIri(property,!0);this.pushIndented(this.options.space?`"${compactedProperty}": [`:`"${compactedProperty}":[`),this.indentation++,this.lastPredicate=predicate2}pushObject(object2,context2){if(this.hadObjectForPredicate?this.pushSeparator(SeparatorType_1.SeparatorType.COMMA):this.hadObjectForPredicate=!0,object2.termType==="Quad"){const lastLastSubject=this.lastSubject,lastLastPredicate=this.lastPredicate;this.hadObjectForPredicate=!1,this.pushNestedQuad(object2,!1,context2),this.endSubject(!1),this.hadObjectForPredicate=!0,this.lastPredicate=lastLastPredicate,this.lastSubject=lastLastSubject;return}let value;try{object2["@list"]?value=object2:value=Util_1$6.Util.termToValue(object2,context2,this.objectOptions||this.options)}catch(e){return this.emit("error",e)}this.pushIndented(JSON.stringify(value,null,this.options.space))}pushNestedQuad(nestedQuad,commaAfterSubject,context2){this.pushSeparator(SeparatorType_1.SeparatorType.OBJECT_START),this.indentation++,this.pushIndented(this.options.space?'"@id": ':'"@id":',!1),nestedQuad.graph.termType!=="DefaultGraph"&&this.emit("error",new Error(`Found a nested quad with the non-default graph: ${nestedQuad.graph.value}`)),this.pushId(nestedQuad.subject,!1,context2),this.pushPredicate(nestedQuad.predicate,context2),this.pushObject(nestedQuad.object,context2),this.endPredicate(!1),this.endSubject(commaAfterSubject)}endDocument(){this.opened=!1,this.originalContext&&!this.options.excludeContext?(this.indentation--,this.pushSeparator(SeparatorType_1.SeparatorType.ARRAY_END),this.indentation--,this.pushSeparator(SeparatorType_1.SeparatorType.OBJECT_END)):(this.indentation--,this.pushSeparator(SeparatorType_1.SeparatorType.ARRAY_END))}endPredicate(comma){this.indentation--,this.pushSeparator(comma?SeparatorType_1.SeparatorType.ARRAY_END_COMMA:SeparatorType_1.SeparatorType.ARRAY_END),this.hadObjectForPredicate=!1,this.objectOptions=null,this.lastPredicate=null}endSubject(comma){this.indentation--,this.pushSeparator(comma?SeparatorType_1.SeparatorType.OBJECT_END_COMMA:SeparatorType_1.SeparatorType.OBJECT_END),this.lastSubject=null}endGraph(comma){this.indentation--,this.pushSeparator(SeparatorType_1.SeparatorType.ARRAY_END),this.indentation--,this.pushSeparator(comma?SeparatorType_1.SeparatorType.OBJECT_END_COMMA:SeparatorType_1.SeparatorType.OBJECT_END),this.lastGraph=null}pushSeparator(type){this.pushIndented(type.label)}pushIndented(data,pushNewLine=!0){const prefix=this.getIndentPrefix(),lines=data.split(`
`).map(line=>prefix+line).join(`
`);this.push(lines),this.options.space&&pushNewLine&&this.push(`
`)}getIndentPrefix(){return this.options.space?this.options.space.repeat(this.indentation):""}}__name(JsonLdSerializer,"JsonLdSerializer");JsonLdSerializer$1.JsonLdSerializer=JsonLdSerializer;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(JsonLdSerializer$1,exports),__exportStar(Util$6,exports)})(jsonldStreamingSerializer);Object.defineProperty(ActorRdfSerializeJsonLd$1,"__esModule",{value:!0});ActorRdfSerializeJsonLd$1.ActorRdfSerializeJsonLd=void 0;const bus_rdf_serialize_1$1=lib$20,jsonld_streaming_serializer_1=jsonldStreamingSerializer;class ActorRdfSerializeJsonLd extends bus_rdf_serialize_1$1.ActorRdfSerializeFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){const writer2=new jsonld_streaming_serializer_1.JsonLdSerializer({space:" ".repeat(this.jsonStringifyIndentSpaces)});let data;return"pipe"in action.quadStream?(action.quadStream.on("error",error=>writer2.emit("error",error)),data=action.quadStream.pipe(writer2)):data=writer2.import(action.quadStream),{data}}}__name(ActorRdfSerializeJsonLd,"ActorRdfSerializeJsonLd");ActorRdfSerializeJsonLd$1.ActorRdfSerializeJsonLd=ActorRdfSerializeJsonLd;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfSerializeJsonLd$1,exports)})(lib$1$);var lib$1_={},ActorRdfSerializeShaclc$1={},arrayifyStream$1={};Object.defineProperty(arrayifyStream$1,"__esModule",{value:!0});function promisifyEventEmitter(event,result){return new Promise((resolve2,reject)=>{event.on("end",()=>resolve2(result)),event.on("error",reject)})}__name(promisifyEventEmitter,"promisifyEventEmitter");function arrayifyStream(stream){const array=[];return promisifyEventEmitter(stream.on("data",data=>array.push(data)),array)}__name(arrayifyStream,"arrayifyStream");arrayifyStream$1.default=arrayifyStream;var dist$2={},ShaclcGenerator={},dist$1={},fragment$1={};Object.defineProperty(fragment$1,"__esModule",{value:!0});fragment$1.fragment=void 0;function getFragment(inputStr){let str=inputStr;(str.endsWith("/")||str.endsWith("#"))&&(str=str.slice(0,str.length-1));const args=[];str.lastIndexOf("/")>0&&args.push(str.lastIndexOf("/")),str.lastIndexOf("#")>0&&args.push(str.lastIndexOf("#"));const i=Math.max(...args);return str.slice(i+1)}__name(getFragment,"getFragment");function camelize(str){var _a2;const res=(_a2=str.split(/[^a-z0-9]+/ig).filter(s2=>s2!=="").map(s2=>s2[0].toUpperCase()+s2.slice(1)).join("").match(/[a-z][a-z0-9]+/ig))===null||_a2===void 0?void 0:_a2[0];return typeof res>"u"?void 0:res[0].toLowerCase()+res.slice(1)}__name(camelize,"camelize");function fragment(str){let value=getFragment(str);return value=value?camelize(value):void 0,value||"v"}__name(fragment,"fragment");fragment$1.fragment=fragment;var lookup={},lookupNamespace={},fetchContext$1={},browserPonyfill={exports:{}};(function(module,exports){var global=typeof self<"u"?self:commonjsGlobal,__self__=function(){function F(){this.fetch=!1,this.DOMException=global.DOMException}return __name(F,"F"),F.prototype=global,new F}();(function(self2){(function(exports2){var support={searchParams:"URLSearchParams"in self2,iterable:"Symbol"in self2&&"iterator"in Symbol,blob:"FileReader"in self2&&"Blob"in self2&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in self2,arrayBuffer:"ArrayBuffer"in self2};function isDataView(obj){return obj&&DataView.prototype.isPrototypeOf(obj)}if(__name(isDataView,"isDataView"),support.arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1};function normalizeName(name){if(typeof name!="string"&&(name=String(name)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(name))throw new TypeError("Invalid character in header field name");return name.toLowerCase()}__name(normalizeName,"normalizeName");function normalizeValue(value){return typeof value!="string"&&(value=String(value)),value}__name(normalizeValue,"normalizeValue");function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:value===void 0,value}}};return support.iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}__name(iteratorFor,"iteratorFor");function Headers2(headers){this.map={},headers instanceof Headers2?headers.forEach(function(value,name){this.append(name,value)},this):Array.isArray(headers)?headers.forEach(function(header){this.append(header[0],header[1])},this):headers&&Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}__name(Headers2,"Headers"),Headers2.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+", "+value:value},Headers2.prototype.delete=function(name){delete this.map[normalizeName(name)]},Headers2.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers2.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers2.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers2.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers2.prototype.keys=function(){var items=[];return this.forEach(function(value,name){items.push(name)}),iteratorFor(items)},Headers2.prototype.values=function(){var items=[];return this.forEach(function(value){items.push(value)}),iteratorFor(items)},Headers2.prototype.entries=function(){var items=[];return this.forEach(function(value,name){items.push([name,value])}),iteratorFor(items)},support.iterable&&(Headers2.prototype[Symbol.iterator]=Headers2.prototype.entries);function consumed(body){if(body.bodyUsed)return Promise.reject(new TypeError("Already read"));body.bodyUsed=!0}__name(consumed,"consumed");function fileReaderReady(reader){return new Promise(function(resolve2,reject){reader.onload=function(){resolve2(reader.result)},reader.onerror=function(){reject(reader.error)}})}__name(fileReaderReady,"fileReaderReady");function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}__name(readBlobAsArrayBuffer,"readBlobAsArrayBuffer");function readBlobAsText(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsText(blob),promise}__name(readBlobAsText,"readBlobAsText");function readArrayBufferAsText(buf){for(var view=new Uint8Array(buf),chars=new Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join("")}__name(readArrayBufferAsText,"readArrayBufferAsText");function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}__name(bufferClone,"bufferClone");function Body(){return this.bodyUsed=!1,this._initBody=function(body){this._bodyInit=body,body?typeof body=="string"?this._bodyText=body:support.blob&&Blob.prototype.isPrototypeOf(body)?this._bodyBlob=body:support.formData&&FormData.prototype.isPrototypeOf(body)?this._bodyFormData=body:support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)?this._bodyText=body.toString():support.arrayBuffer&&support.blob&&isDataView(body)?(this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))?this._bodyArrayBuffer=bufferClone(body):this._bodyText=body=Object.prototype.toString.call(body):this._bodyText="",this.headers.get("content-type")||(typeof body=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support.blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode2)}),this.json=function(){return this.text().then(JSON.parse)},this}__name(Body,"Body");var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}__name(normalizeMethod,"normalizeMethod");function Request2(input,options){options=options||{};var body=options.body;if(input instanceof Request2){if(input.bodyUsed)throw new TypeError("Already read");this.url=input.url,this.credentials=input.credentials,options.headers||(this.headers=new Headers2(input.headers)),this.method=input.method,this.mode=input.mode,this.signal=input.signal,!body&&input._bodyInit!=null&&(body=input._bodyInit,input.bodyUsed=!0)}else this.url=String(input);if(this.credentials=options.credentials||this.credentials||"same-origin",(options.headers||!this.headers)&&(this.headers=new Headers2(options.headers)),this.method=normalizeMethod(options.method||this.method||"GET"),this.mode=options.mode||this.mode||null,this.signal=options.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(body)}__name(Request2,"Request"),Request2.prototype.clone=function(){return new Request2(this,{body:this._bodyInit})};function decode2(body){var form=new FormData;return body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("="),name=split.shift().replace(/\+/g," "),value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}}),form}__name(decode2,"decode");function parseHeaders(rawHeaders){var headers=new Headers2,preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/g," ");return preProcessedHeaders.split(/\r?\n/).forEach(function(line){var parts=line.split(":"),key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}}),headers}__name(parseHeaders,"parseHeaders"),Body.call(Request2.prototype);function Response(bodyInit,options){options||(options={}),this.type="default",this.status=options.status===void 0?200:options.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in options?options.statusText:"OK",this.headers=new Headers2(options.headers),this.url=options.url||"",this._initBody(bodyInit)}__name(Response,"Response"),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers2(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:0,statusText:""});return response.type="error",response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1)throw new RangeError("Invalid status code");return new Response(null,{status,headers:{location:url}})},exports2.DOMException=self2.DOMException;try{new exports2.DOMException}catch{exports2.DOMException=function(message,name){this.message=message,this.name=name;var error=Error(message);this.stack=error.stack},exports2.DOMException.prototype=Object.create(Error.prototype),exports2.DOMException.prototype.constructor=exports2.DOMException}function fetch2(input,init2){return new Promise(function(resolve2,reject){var request=new Request2(input,init2);if(request.signal&&request.signal.aborted)return reject(new exports2.DOMException("Aborted","AbortError"));var xhr=new XMLHttpRequest;function abortXhr(){xhr.abort()}__name(abortXhr,"abortXhr"),xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve2(new Response(body,options))},xhr.onerror=function(){reject(new TypeError("Network request failed"))},xhr.ontimeout=function(){reject(new TypeError("Network request failed"))},xhr.onabort=function(){reject(new exports2.DOMException("Aborted","AbortError"))},xhr.open(request.method,request.url,!0),request.credentials==="include"?xhr.withCredentials=!0:request.credentials==="omit"&&(xhr.withCredentials=!1),"responseType"in xhr&&support.blob&&(xhr.responseType="blob"),request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)}),request.signal&&(request.signal.addEventListener("abort",abortXhr),xhr.onreadystatechange=function(){xhr.readyState===4&&request.signal.removeEventListener("abort",abortXhr)}),xhr.send(typeof request._bodyInit>"u"?null:request._bodyInit)})}return __name(fetch2,"fetch"),fetch2.polyfill=!0,self2.fetch||(self2.fetch=fetch2,self2.Headers=Headers2,self2.Request=Request2,self2.Response=Response),exports2.Headers=Headers2,exports2.Request=Request2,exports2.Response=Response,exports2.fetch=fetch2,Object.defineProperty(exports2,"__esModule",{value:!0}),exports2})({})})(__self__),__self__.fetch.ponyfill=!0,delete __self__.fetch.polyfill;var ctx=__self__;exports=ctx.fetch,exports.default=ctx.fetch,exports.fetch=ctx.fetch,exports.Headers=ctx.Headers,exports.Request=ctx.Request,exports.Response=ctx.Response,module.exports=exports})(browserPonyfill,browserPonyfill.exports);var browserPonyfillExports=browserPonyfill.exports,__awaiter$5=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(fetchContext$1,"__esModule",{value:!0});fetchContext$1.fetchContext=fetchContext$1.fetchJson=void 0;const cross_fetch_1$3=browserPonyfillExports;function fetchJson(url,options){var _a2;return __awaiter$5(this,void 0,void 0,function*(){return(yield((_a2=options==null?void 0:options.fetch)!==null&&_a2!==void 0?_a2:cross_fetch_1$3.fetch)(url)).json()})}__name(fetchJson,"fetchJson");fetchContext$1.fetchJson=fetchJson;function fetchContext(url,options){return __awaiter$5(this,void 0,void 0,function*(){return(yield fetchJson(url,options))["@context"]})}__name(fetchContext,"fetchContext");fetchContext$1.fetchContext=fetchContext;var __awaiter$4=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(lookupNamespace,"__esModule",{value:!0});lookupNamespace.lookupUri=void 0;const fetchContext_1$2=fetchContext$1;function lookupUri(prefix,options){return __awaiter$4(this,void 0,void 0,function*(){const uri=(yield(0,fetchContext_1$2.fetchContext)(`https://prefix.cc/${prefix}.file.jsonld`,options))[prefix];if(typeof uri!="string")throw new Error(`Expected uri to be a string, received: ${uri} of type ${typeof uri}`);return uri})}__name(lookupUri,"lookupUri");lookupNamespace.lookupUri=lookupUri;var lookupPrefix$1={},__awaiter$3=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(lookupPrefix$1,"__esModule",{value:!0});lookupPrefix$1.lookupPrefix=void 0;const fetchContext_1$1=fetchContext$1;function lookupPrefix(uri,options){return __awaiter$3(this,void 0,void 0,function*(){const url=new URL("https://prefix.cc/reverse");url.searchParams.append("uri",uri),url.searchParams.append("format","jsonld");const prefixes=Object.keys(yield(0,fetchContext_1$1.fetchContext)(url,options));if(prefixes.length===0)throw new Error("No prefixes returned");return prefixes[0]})}__name(lookupPrefix,"lookupPrefix");lookupPrefix$1.lookupPrefix=lookupPrefix;var lookupAllPrefixes$1={},__awaiter$2=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(lookupAllPrefixes$1,"__esModule",{value:!0});lookupAllPrefixes$1.lookupAllPrefixes=void 0;const fetchContext_1=fetchContext$1;function lookupAllPrefixes(options){return __awaiter$2(this,void 0,void 0,function*(){return(0,fetchContext_1.fetchContext)("https://prefix.cc/context",options)})}__name(lookupAllPrefixes,"lookupAllPrefixes");lookupAllPrefixes$1.lookupAllPrefixes=lookupAllPrefixes;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(lookupNamespace,exports),__exportStar(lookupPrefix$1,exports),__exportStar(lookupAllPrefixes$1,exports)})(lookup);(function(exports){var __awaiter2=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.lookupAllPrefixes=exports.prefixToUri=exports.uriToPrefix=void 0;const fragment_1=fragment$1,lookup_1=lookup;function uriToPrefix(uri,options){return __awaiter2(this,void 0,void 0,function*(){let result;try{result=yield(0,lookup_1.lookupPrefix)(uri,options)}catch{options!=null&&options.mintOnUnknown&&(result=(0,fragment_1.fragment)(uri).slice(0,4))}if(typeof result<"u"&&typeof(options==null?void 0:options.existingPrefixes)=="object"&&result in options.existingPrefixes){let i=0;for(;`${result}${i}`in options.existingPrefixes;)i+=1;result=`${result}${i}`}return result})}__name(uriToPrefix,"uriToPrefix"),exports.uriToPrefix=uriToPrefix;function prefixToUri(prefix,options){return __awaiter2(this,void 0,void 0,function*(){try{return yield(0,lookup_1.lookupUri)(prefix,options)}catch{return}})}__name(prefixToUri,"prefixToUri"),exports.prefixToUri=prefixToUri;var lookup_2=lookup;Object.defineProperty(exports,"lookupAllPrefixes",{enumerable:!0,get:function(){return lookup_2.lookupAllPrefixes}})})(dist$1);var utils$2={};Object.defineProperty(utils$2,"__esModule",{value:!0});utils$2.getShaclName=void 0;function getShaclName(term){if(term.termType!=="NamedNode"||!term.value.startsWith("http://www.w3.org/ns/shacl#"))throw new Error(`Term ${term.value} is not part of the SHACL namespace`);return term.value.slice(27)}__name(getShaclName,"getShaclName");utils$2.getShaclName=getShaclName;var propertyParam_={};Object.defineProperty(propertyParam_,"__esModule",{value:!0});propertyParam_.default={deactivated:!0,severity:!0,message:!0,class:!0,datatype:!0,nodeKind:!0,minExclusive:!0,minInclusive:!0,maxExclusive:!0,maxInclusive:!0,minLength:!0,maxLength:!0,pattern:!0,flags:!0,languageIn:!0,uniqueLang:!0,equals:!0,disjoint:!0,lessThan:!0,lessThanOrEquals:!0,qualifiedValueShape:!0,qualifiedMinCount:!0,qualifiedMaxCount:!0,qualifiedValueShapesDisjoint:!0,closed:!0,ignoredProperties:!0,hasValue:!0,in:!0,node:!0};var basePrefixes={};Object.defineProperty(basePrefixes,"__esModule",{value:!0});basePrefixes.default={owl:"http://www.w3.org/2002/07/owl#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",sh:"http://www.w3.org/ns/shacl#",xsd:"http://www.w3.org/2001/XMLSchema#"};var nodeParam={};Object.defineProperty(nodeParam,"__esModule",{value:!0});nodeParam.default={targetNode:!0,targetObjectsOf:!0,targetSubjectsOf:!0,deactivated:!0,severity:!0,message:!0,class:!0,datatype:!0,nodeKind:!0,minExclusive:!0,minInclusive:!0,maxExclusive:!0,maxInclusive:!0,minLength:!0,maxLength:!0,pattern:!0,flags:!0,languageIn:!0,equals:!0,disjoint:!0,closed:!0,ignoredProperties:!0,hasValue:!0,in:!0};var __awaiter$1=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(ShaclcGenerator,"__esModule",{value:!0});const n3_1$4=require$$0$3,prefixcc_1=dist$1,rdf_string_ttl_1$2=rdfStringTtl,utils_1=utils$2,property_param_1=__importDefault$3(propertyParam_),base_prefixes_1=__importDefault$3(basePrefixes),node_param_1=__importDefault$3(nodeParam);function getNamespace(str){var _a2;return(_a2=/^[^]*[#/]/.exec(str))===null||_a2===void 0?void 0:_a2[0]}__name(getNamespace,"getNamespace");const knownNamespaces={"http://www.w3.org/1999/02/22-rdf-syntax-ns#":"rdf","http://www.w3.org/2000/01/rdf-schema#":"rdfs","http://www.w3.org/ns/shacl#":"sh","http://www.w3.org/2001/XMLSchema#":"xsd"},knownPrefixes={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",sh:"http://www.w3.org/ns/shacl#",xsd:"http://www.w3.org/2001/XMLSchema#"};class SHACLCWriter{constructor(store,writer2,prefixes={},base=void 0,errorOnExtraQuads=!0,mintUnspecifiedPrefixes=!1,fetch2,extendedSyntax=!1){this.store=store,this.base=base,this.errorOnExtraQuads=errorOnExtraQuads,this.mintUnspecifiedPrefixes=mintUnspecifiedPrefixes,this.fetch=fetch2,this.extendedSyntax=extendedSyntax,this.prefixes={},this.prefixRev={};for(const key of Object.keys(prefixes)){const iri=prefixes[key],value=typeof iri=="string"?iri:iri.value;!(value in knownNamespaces)&&!(key in knownPrefixes)&&(this.prefixRev[value]=key,this.prefixes[key]=value)}this.writer=writer2}write(){return __awaiter$1(this,void 0,void 0,function*(){const onotology=this.store.getQuads(null,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","http://www.w3.org/2002/07/owl#Ontology",null);if(onotology.length===1&&onotology[0].subject.termType==="NamedNode"){const base=onotology[0].subject;this.store.removeQuads(onotology),base.equals(new n3_1$4.NamedNode("urn:x-base:default"))||this.writer.add(`BASE ${(0,rdf_string_ttl_1$2.termToString)(base)}`),yield this.writeImports(base)}else throw new Error("Base expected");if(this.mintUnspecifiedPrefixes){const namespaces=new Set;for(const term of[...this.store.getSubjects(null,null,null),...this.store.getPredicates(null,null,null),...this.store.getObjects(null,null,null)])if(term.termType==="NamedNode"){const namespace=getNamespace(term.value);namespace&&!(namespace in this.prefixRev)&&!(namespace in knownNamespaces)&&namespaces.add(namespace)}const existingPrefixes=Object.assign(Object.assign({},this.prefixes),knownPrefixes);yield Promise.all([...namespaces].map(ns=>(0,prefixcc_1.uriToPrefix)(ns,{fetch:this.fetch,mintOnUnknown:!0,existingPrefixes}).then(pref=>{this.prefixes[pref]=ns,existingPrefixes[pref]=ns,this.prefixRev[ns]=pref})))}const allNamespaces=new Set([...this.store.getSubjects(null,null,null),...this.store.getPredicates(null,null,null),...this.store.getObjects(null,null,null)].filter(term=>term.termType==="NamedNode").map(term=>getNamespace(term.value)).filter(str=>typeof str=="string"));for(const key in this.prefixRev)allNamespaces.has(key)||(delete this.prefixes[this.prefixRev[key]],delete this.prefixRev[key]);if(yield this.writePrefixes(),this.prefixes=Object.assign(Object.assign({},this.prefixes),knownPrefixes),this.prefixRev=Object.assign(Object.assign({},this.prefixRev),knownNamespaces),this.writer.newLine(),yield this.writeShapes(),this.extendedSyntax){const subjects=this.store.getSubjects(null,null,null);subjects.length>0&&this.writer.newLine(1);for(const subject2 of subjects)this.writer.add(yield this.termToString(subject2,!0,!0)),this.writer.add(" "),this.writer.indent(),yield this.writeTurtlePredicates(subject2),this.writer.deindent();subjects.length>0&&(this.writer.add(" ."),this.writer.newLine())}if(this.errorOnExtraQuads&&this.store.size>0)throw new Error("Dataset contains quads that cannot be written in SHACLC");this.writer.end()})}writeImports(base){return __awaiter$1(this,void 0,void 0,function*(){const imports=this.store.getObjectsOnce(base,new n3_1$4.NamedNode("http://www.w3.org/2002/07/owl#imports"),null);if(imports.length>0)for(const imp of imports)this.writer.add(`IMPORTS <${imp.value}>`,!0)})}writePrefixes(){return __awaiter$1(this,void 0,void 0,function*(){const keys2=Object.keys(this.prefixes).filter(key=>!(key in base_prefixes_1.default)).sort();if(keys2.length>0)for(const key of keys2)this.writer.add(`PREFIX ${key}: <${this.prefixes[key]}>`,!0)})}termToString(term,disableShaclName=!1,allowBlankNodes=!1){return __awaiter$1(this,void 0,void 0,function*(){try{if(disableShaclName)throw new Error("Shacl name disabled");return(0,utils_1.getShaclName)(term)}catch{}if(term.termType==="NamedNode"){const namespace=getNamespace(term.value);return namespace&&namespace in this.prefixRev&&namespace in this.prefixRev?`${this.prefixRev[namespace]}:${term.value.slice(namespace.length)}`:(0,rdf_string_ttl_1$2.termToString)(term)}if(term.termType==="Literal")return term.datatypeString==="http://www.w3.org/2001/XMLSchema#integer"||term.datatypeString==="http://www.w3.org/2001/XMLSchema#boolean"?term.value:(0,rdf_string_ttl_1$2.termToString)(term);throw term.termType==="BlankNode"&&allowBlankNodes&&(0,rdf_string_ttl_1$2.termToString)(term),new Error(`Invalid term type for extra statement ${term.value} (${term.termType})`)})}writeShapes(){return __awaiter$1(this,void 0,void 0,function*(){for(const subject2 of this.store.getSubjectsOnce(new n3_1$4.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#NodeShape"),null)){this.store.getQuadsOnce(subject2,new n3_1$4.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),new n3_1$4.NamedNode("http://www.w3.org/2000/01/rdf-schema#Class"),null).length>0?this.writer.add("shapeClass "):this.writer.add("shape "),this.writer.add(yield this.termToString(subject2)),this.writer.add(" ");const targetClasses=this.store.getObjectsOnce(subject2,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#targetClass"),null);if(targetClasses.length>0){this.writer.add("-> ");for(const targetClass of targetClasses)targetClass.termType==="NamedNode"?this.writer.add(yield this.termToString(targetClass)):(this.writer.add("!"),this.writer.add(yield this.termToString(this.singleObject(targetClass,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#not"),!0)))),this.writer.add(" ")}const unusedPredicates=this.store.getPredicates(subject2,null,null).filter(property=>[new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#targetClass"),new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#property"),new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#or"),...Object.keys(node_param_1.default).map(key=>new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#"+key))].every(elem=>!property.equals(elem)));unusedPredicates.length>0&&(this.writer.add(";"),this.writer.indent(),this.writer.newLine(1)),this.extendedSyntax&&(yield this.writeGivenTurtlePredicates(subject2,unusedPredicates)),unusedPredicates.length>0&&(this.writer.add(" "),this.writer.deindent()),yield this.writeShapeBody(subject2,!1)}})}getSingleProperty(quad,allowedPredicates){let examining=[quad];try{let name=(0,utils_1.getShaclName)(quad.predicate),type="pred";if(name==="not"){const quads=this.store.getQuadsOnce(quad.object,null,null,null);if(examining=examining.concat(quads),quads.length!==1)throw new Error("Can only handle having one predicate of 'not'");[quad]=quads,name=(0,utils_1.getShaclName)(quad.predicate),type="not"}if(!(name in allowedPredicates))throw new Error(`${name} is not allowed`);return{name,type,object:quad.object}}catch{this.store.addQuads(examining)}}singleLayerPropertiesList(term,allowedPredicates){const result=[];for(const quad of this.store.getQuadsOnce(term,null,null,null)){const property=this.getSingleProperty(quad,allowedPredicates);property&&result.push(property)}return result}expectOneProperty(term,allowedPredicates){const quads=this.store.getQuadsOnce(term,null,null,null);if(quads.length===1){const data=this.getSingleProperty(quads[0],allowedPredicates);if(data)return data}this.store.addQuads(quads)}orProperties(term,allowedPredicates){const orProperties=[];for(const quad of this.store.getQuadsOnce(term,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#or"),null,null)){const statement=[];for(const item of this.getList(quad.object)){const property=this.expectOneProperty(item,allowedPredicates);if(!property)throw this.store.addQuad(quad),new Error("Each entry of the 'or' statement must declare exactly one property");statement.push(property)}orProperties.push(statement)}return orProperties}getList(term){let termTemp=term;const list=[];for(;!termTemp.equals(new n3_1$4.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"));)list.push(this.singleObject(termTemp,new n3_1$4.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#first"),!0)),termTemp=this.singleObject(termTemp,new n3_1$4.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"),!0);return list}writeIriLiteralOrArray(object2){return __awaiter$1(this,void 0,void 0,function*(){if(object2.termType==="BlankNode"){this.writer.add("[");let first3=!0;for(const term of this.getList(object2))first3?first3=!1:this.writer.add(" "),this.writer.add(yield this.termToString(term));this.writer.add("]")}else this.writer.add(yield this.termToString(object2))})}singleObject(subject2,predicate2,strict){var _a2;return(_a2=this.singleQuad(subject2,predicate2,strict))===null||_a2===void 0?void 0:_a2.object}singleQuad(subject2,predicate2,strict=!1){const objects=this.store.getQuadsOnce(subject2,predicate2,null,null);if(strict&&objects.length!==1)throw this.store.addQuads(objects),new Error(`The subject and predicate ${subject2==null?void 0:subject2.value} ${predicate2==null?void 0:predicate2.value} must have exactly one object. Instead has ${objects.length}`);if(objects.length>1)throw this.store.addQuads(objects),new Error(`The subject and predicate ${subject2==null?void 0:subject2.value} ${predicate2==null?void 0:predicate2.value} can have at most one object. Instead has ${objects.length}`);return objects.length===1?objects[0]:void 0}writeAssigment({name,type,object:object2}){return __awaiter$1(this,void 0,void 0,function*(){type==="not"&&this.writer.add("!"),this.writer.add(name),this.writer.add("="),yield this.writeIriLiteralOrArray(object2)})}writeAtom({name,type,object:object2}){return __awaiter$1(this,void 0,void 0,function*(){switch(type==="not"&&this.writer.add("!"),name){case"node":{if(object2.termType==="NamedNode")this.writer.add(`@${yield this.termToString(object2)}`);else if(object2.termType==="BlankNode")yield this.writeShapeBody(object2);else throw new Error("Invalid nested shape, must be blank node or IRI");return}case"nodeKind":{this.writer.add((0,utils_1.getShaclName)(object2));return}case"class":{this.writer.add(yield this.termToString(object2));return}case"datatype":{this.writer.add(yield this.termToString(object2));return}default:this.writer.add(name),this.writer.add("="),yield this.writeIriLiteralOrArray(object2)}})}writeAssigments(assignments,divider=" ",first3=!0,shortcuts){return __awaiter$1(this,void 0,void 0,function*(){for(const assignment of assignments)first3?first3=!1:this.writer.add(divider),shortcuts?yield this.writeAtom(assignment):yield this.writeAssigment(assignment)})}writeParams(term,first3=!0,allowedParam,shortcuts=!1,surroundings=!1){return __awaiter$1(this,void 0,void 0,function*(){const or=this.orProperties(term,allowedParam),params=this.singleLayerPropertiesList(term,allowedParam);surroundings&&(or.length>0||params.length>0)&&this.writer.newLine(1);for(const statement of or)first3?first3=!1:this.writer.add(" "),yield this.writeAssigments(statement,"|",!0,shortcuts);yield this.writeAssigments(params," ",first3,shortcuts),surroundings&&(or.length>0||params.length>0)&&this.writer.add(" .")})}writeShapeBody(term,nested=!0){return __awaiter$1(this,void 0,void 0,function*(){this.writer.add("{").indent();const properties=this.store.getObjectsOnce(term,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#property"),null);yield this.writeParams(term,!0,node_param_1.default,!1,!0);for(const property of properties)this.writer.newLine(1),yield this.writeProperty(property);this.writer.deindent().newLine(1),nested?this.writer.add("} ."):this.writer.add("}").newLine(1)})}writeProperty(property){return __awaiter$1(this,void 0,void 0,function*(){yield this.writePath(this.singleObject(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#path"),!0));const min2=this.singleObject(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#minCount")),max2=this.singleObject(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#maxCount")),nodeKind=this.singleObject(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#nodeKind")),propertyClass=this.singleObject(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#class")),datatype2=this.singleObject(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#datatype")),nodeShapes=this.store.getObjectsOnce(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#node"),null);if(nodeKind&&(this.writer.add(" "),this.writer.add((0,utils_1.getShaclName)(nodeKind))),propertyClass&&(this.writer.add(" "),this.writer.add(yield this.termToString(propertyClass))),datatype2&&(this.writer.add(" "),this.writer.add(yield this.termToString(datatype2))),min2!==void 0||max2!==void 0){if(this.writer.add(" ["),min2){if(min2.termType!=="Literal"||min2.datatypeString!=="http://www.w3.org/2001/XMLSchema#integer")throw new Error("Invalid min value, must me an integer literal");this.writer.add(min2.value)}else this.writer.add("0");if(this.writer.add(".."),max2){if(max2.termType!=="Literal"||max2.datatypeString!=="http://www.w3.org/2001/XMLSchema#integer")throw new Error("Invalid max value, must me an integer literal");this.store.removeMatches(property,new n3_1$4.NamedNode("http://www.w3.org/ns/shacl#maxCount"),void 0,void 0),this.writer.add(max2.value)}else this.writer.add("*");this.writer.add("]")}yield this.writeParams(property,!1,property_param_1.default,!0);const nestedShapes=[];for(const node2 of nodeShapes)if(node2.termType==="NamedNode")this.writer.add(" "),this.writer.add(`@${yield this.termToString(node2)}`);else if(node2.termType==="BlankNode")nestedShapes.push(node2);else throw new Error("Invalid nested shape, must be blank node or IRI");for(const shape of nestedShapes)this.writer.add(" "),yield this.writeShapeBody(shape);this.extendedSyntax&&this.store.getQuads(property,null,null,null).length>0&&(this.writer.add(" %"),this.writer.indent(),this.writer.newLine(1),yield this.writeTurtlePredicates(property),this.writer.deindent(),this.writer.newLine(1),this.writer.add("%")),nestedShapes.length===0&&this.writer.add(" .")})}writeTurtlePredicates(term){return __awaiter$1(this,void 0,void 0,function*(){return this.writeGivenTurtlePredicates(term,this.store.getPredicates(term,null,null))})}writeGivenTurtlePredicates(term,predicates){return __awaiter$1(this,void 0,void 0,function*(){let semi=!1;if(predicates.some(predicate2=>predicate2.equals(n3_1$4.DataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type")))){const types2=this.store.getObjectsOnce(term,n3_1$4.DataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),null);types2.length>0&&(semi=!0,this.writer.add("a "),yield this.writeTurtleObjects(types2))}for(const predicate2 of predicates)predicate2.equals(n3_1$4.DataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"))||(semi?(this.writer.add(" ;"),this.writer.newLine(1)):semi=!0,this.writer.add(yield this.termToString(predicate2,!0)),this.writer.add(" "),yield this.writeTurtleObjects(this.store.getObjectsOnce(term,predicate2,null)))})}writeTurtleObjects(objects){return __awaiter$1(this,void 0,void 0,function*(){const blankObjects=[],nonBlankObjects=[];for(const object2 of objects)object2.termType==="BlankNode"&&[...this.store.match(null,null,object2),...this.store.match(null,object2,null)].length===0?blankObjects.push(object2):nonBlankObjects.push(object2);this.writer.add((yield Promise.all(nonBlankObjects.map(object2=>this.termToString(object2,!0,!0)))).join(", "));let comma=nonBlankObjects.length>0;if(blankObjects.length>0)for(const blank of blankObjects)comma?this.writer.add(", "):comma=!0,(yield this.writeList(blank))||(this.writer.add("["),this.writer.indent(),this.writer.newLine(1),yield this.writeTurtlePredicates(blank),this.writer.deindent(),this.writer.newLine(1),this.writer.add("]"))})}writeList(object2){return __awaiter$1(this,void 0,void 0,function*(){let node2=object2;const elems=[],quads=[];for(;!node2.equals(n3_1$4.DataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"));){const first3=this.store.getQuadsOnce(node2,n3_1$4.DataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#first"),null,null),rest2=this.store.getQuadsOnce(node2,n3_1$4.DataFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"),null,null);if(quads.push(...first3,...rest2),first3.length!==1||rest2.length!==1||this.store.getQuads(node2,null,null,null).length!==0)return this.store.addQuads(quads),!1;elems.push(first3[0].object),node2=rest2[0].object}let space=!1;this.writer.add("(");for(const elem of elems)space?this.writer.add(" "):space=!0,yield this.writeTurtleObjects([elem]);return this.writer.add(")"),!0})}writePath(term,braces=!1){return __awaiter$1(this,void 0,void 0,function*(){if(term.termType==="NamedNode")this.writer.add(yield this.termToString(term));else if(term.termType==="BlankNode"){const quads=this.store.getQuadsOnce(term,null,null,null);if(quads.length===1){const{predicate:predicate2,object:object2}=quads[0];switch(predicate2.value){case"http://www.w3.org/ns/shacl#inversePath":this.writer.add("^"),yield this.writePath(object2,!0);return;case"http://www.w3.org/ns/shacl#alternativePath":{const alternatives=this.getList(object2);if(alternatives.length===0)throw new Error("Invalid Alternative Path - no options");if(alternatives.length===1)yield this.writePath(alternatives[0]);else{braces&&this.writer.add("(");let first3=!0;for(const alt of alternatives)first3?first3=!1:this.writer.add("|"),yield this.writePath(alt,!0);braces&&this.writer.add(")")}return}case"http://www.w3.org/ns/shacl#zeroOrMorePath":yield this.writePath(object2,!0),this.writer.add("*");return;case"http://www.w3.org/ns/shacl#oneOrMorePath":yield this.writePath(object2,!0),this.writer.add("+");return;case"http://www.w3.org/ns/shacl#zeroOrOnePath":yield this.writePath(object2,!0),this.writer.add("?");return;default:throw new Error(`Invalid path type ${term.value}`)}}else{this.store.addQuads(quads);const sequence=this.getList(term);if(sequence.length===0)throw new Error("Invalid Path");{braces&&this.writer.add("(");let first3=!0;for(const alt of sequence)first3?first3=!1:this.writer.add("/"),yield this.writePath(alt,!0);braces&&this.writer.add(")")}}}else throw new Error("Path should be named node or blank node")})}}__name(SHACLCWriter,"SHACLCWriter");ShaclcGenerator.default=SHACLCWriter;var writer={};Object.defineProperty(writer,"__esModule",{value:!0});class Writer{constructor(options){this.indents=0,this.write=options.write,this.end=options.end}indent(){return this.indents+=1,this}deindent(){if(this.indents<1)throw new Error(`Trying to deindent when indent is only ${this.indents}`);return this.indents-=1,this}add(s2,newLine=!1){return this.write(newLine?`
${"	".repeat(this.indents)}${s2}`:s2,"utf-8"),this}newLine(no=2){return this.write(`
`.repeat(no)+"	".repeat(this.indents),"utf-8"),this}}__name(Writer,"Writer");writer.default=Writer;var volatileStore={};Object.defineProperty(volatileStore,"__esModule",{value:!0});const n3_1$3=require$$0$3;class VolitileStore extends n3_1$3.Store{getQuadsOnce(s2,p,o,g){const quads=this.getQuads(s2,p,o,g);return this.removeQuads(quads),quads}getSubjectsOnce(p,o,g){return this.getQuadsOnce(null,p,o,g).map(term=>term.subject)}getObjectsOnce(s2,p,g){return this.getQuadsOnce(s2,p,null,g).map(term=>term.object)}}__name(VolitileStore,"VolitileStore");volatileStore.default=VolitileStore;var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(dist$2,"__esModule",{value:!0});dist$2.write=void 0;const n3_1$2=require$$0$3,ShaclcGenerator_1=__importDefault$2(ShaclcGenerator),writer_1=__importDefault$2(writer),volatile_store_1=__importDefault$2(volatileStore);function write(quads,options){return __awaiter(this,void 0,void 0,function*(){return new Promise((resolve2,reject)=>__awaiter(this,void 0,void 0,function*(){try{let s2="";const volatileStore2=new volatile_store_1.default(quads),graphs=volatileStore2.getGraphs(null,null,null);if(graphs.length>1)throw new Error("More than one graph found - can serialize in the default graph");if(graphs.length===1&&!graphs[0].equals(n3_1$2.DataFactory.defaultGraph()))throw new Error(`Expected all triples to be in the default graph, instead triples were in ${graphs[0].value}`);const w=new writer_1.default({write:chunk=>{s2+=chunk},end:()=>{let extraQuads=volatileStore2.getQuads(null,null,null,null);extraQuads.length===0&&(extraQuads=void 0),resolve2({text:s2,extraQuads})}});yield new ShaclcGenerator_1.default(volatileStore2,w,options==null?void 0:options.prefixes,void 0,(options==null?void 0:options.errorOnUnused)!==!1,options==null?void 0:options.mintPrefixes,options==null?void 0:options.fetch,options==null?void 0:options.extendedSyntax).write()}catch(e){reject(e)}}))})}__name(write,"write");dist$2.write=write;Object.defineProperty(ActorRdfSerializeShaclc$1,"__esModule",{value:!0});ActorRdfSerializeShaclc$1.ActorRdfSerializeShaclc=void 0;const bus_rdf_serialize_1=lib$20,arrayify_stream_1=arrayifyStream$1,readable_stream_1$g=browserExports$1,shaclc_write_1=dist$2;class ActorRdfSerializeShaclc extends bus_rdf_serialize_1.ActorRdfSerializeFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){const data=new readable_stream_1$g.Readable;data._read=()=>{};try{const prefixes={};action.quadStream.on("prefix",(prefix,iri)=>{prefixes[prefix]=iri});const{text}=await(0,shaclc_write_1.write)(await(0,arrayify_stream_1.default)(action.quadStream),{errorOnUnused:!0,extendedSyntax:mediaType==="text/shaclc-ext",prefixes});data.push(text),data.push(null)}catch(error){data._read=()=>{data.emit("error",error)}}return{data,triples:!0}}}__name(ActorRdfSerializeShaclc,"ActorRdfSerializeShaclc");ActorRdfSerializeShaclc$1.ActorRdfSerializeShaclc=ActorRdfSerializeShaclc;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfSerializeShaclc$1,exports)})(lib$1_);var lib$1Z={},ActorHttpFetch$1={},lib$1Y={},ActorHttp$1={};function commonjsRequire(path){throw new Error('Could not dynamically require "'+path+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}__name(commonjsRequire,"commonjsRequire");var polyfillIe11_min={exports:{}},hasRequiredPolyfillIe11_min;function requirePolyfillIe11_min(){return hasRequiredPolyfillIe11_min||(hasRequiredPolyfillIe11_min=1,function(module,exports){(function(f2){module.exports=f2()})(function(){return __name(function e(t,n,r2){function s2(o2,u){if(!n[o2]){if(!t[o2]){var a=typeof commonjsRequire=="function"&&commonjsRequire;if(!u&&a)return a(o2,!0);if(i)return i(o2,!0);var f2=new Error("Cannot find module '"+o2+"'");throw f2.code="MODULE_NOT_FOUND",f2}var l=n[o2]={exports:{}};t[o2][0].call(l.exports,function(e2){var n2=t[o2][1][e2];return s2(n2||e2)},l,l.exports,e,t,n,r2)}return n[o2].exports}__name(s2,"s");for(var i=typeof commonjsRequire=="function"&&commonjsRequire,o=0;o<r2.length;o++)s2(r2[o]);return s2},"e")({1:[function(_dereq_,module2,exports2){Object.defineProperty(exports2,"__esModule",{value:!0});var _require=_dereq_("./spec/reference-implementation/lib/readable-stream"),ReadableStream2=_require.ReadableStream,_require2=_dereq_("./spec/reference-implementation/lib/writable-stream"),WritableStream=_require2.WritableStream,ByteLengthQueuingStrategy=_dereq_("./spec/reference-implementation/lib/byte-length-queuing-strategy"),CountQueuingStrategy=_dereq_("./spec/reference-implementation/lib/count-queuing-strategy"),_require3=_dereq_("./spec/reference-implementation/lib/transform-stream"),TransformStream=_require3.TransformStream;exports2.ByteLengthQueuingStrategy=ByteLengthQueuingStrategy,exports2.CountQueuingStrategy=CountQueuingStrategy,exports2.ReadableStream=ReadableStream2,exports2.WritableStream=WritableStream,exports2.TransformStream=TransformStream;var interfaces={ReadableStream:ReadableStream2,WritableStream,ByteLengthQueuingStrategy,CountQueuingStrategy,TransformStream};exports2.default=interfaces},{"./spec/reference-implementation/lib/byte-length-queuing-strategy":8,"./spec/reference-implementation/lib/count-queuing-strategy":9,"./spec/reference-implementation/lib/readable-stream":12,"./spec/reference-implementation/lib/transform-stream":13,"./spec/reference-implementation/lib/writable-stream":15}],2:[function(_dereq_,module2,exports2){(function(global){function compare(t,e){if(t===e)return 0;for(var r2=t.length,n=e.length,i=0,a=Math.min(r2,n);i<a;++i)if(t[i]!==e[i]){r2=t[i],n=e[i];break}return r2<n?-1:n<r2?1:0}__name(compare,"compare");function isBuffer(t){return global.Buffer&&typeof global.Buffer.isBuffer=="function"?global.Buffer.isBuffer(t):!(t==null||!t._isBuffer)}__name(isBuffer,"isBuffer");function pToString(t){return Object.prototype.toString.call(t)}__name(pToString,"pToString");function isView(t){return!isBuffer(t)&&typeof global.ArrayBuffer=="function"&&(typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}__name(isView,"isView");function getName2(t){if(util2.isFunction(t)){if(functionsHaveNames)return t.name;var e=t.toString().match(regex);return e&&e[1]}}__name(getName2,"getName");function truncate(t,e){return typeof t=="string"?t.length<e?t:t.slice(0,e):t}__name(truncate,"truncate");function inspect2(t){if(functionsHaveNames||!util2.isFunction(t))return util2.inspect(t);var e=getName2(t);return"[Function"+(e?": "+e:"")+"]"}__name(inspect2,"inspect");function getMessage(t){return truncate(inspect2(t.actual),128)+" "+t.operator+" "+truncate(inspect2(t.expected),128)}__name(getMessage,"getMessage");function fail(t,e,r2,n,i){throw new assert2.AssertionError({message:r2,actual:t,expected:e,operator:n,stackStartFunction:i})}__name(fail,"fail");function ok(t,e){t||fail(t,!0,e,"==",assert2.ok)}__name(ok,"ok");function _deepEqual(t,e,r2,n){if(t===e)return!0;if(isBuffer(t)&&isBuffer(e))return compare(t,e)===0;if(util2.isDate(t)&&util2.isDate(e))return t.getTime()===e.getTime();if(util2.isRegExp(t)&&util2.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(t!==null&&typeof t=="object"||e!==null&&typeof e=="object"){if(isView(t)&&isView(e)&&pToString(t)===pToString(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return compare(new Uint8Array(t.buffer),new Uint8Array(e.buffer))===0;if(isBuffer(t)!==isBuffer(e))return!1;var i=(n=n||{actual:[],expected:[]}).actual.indexOf(t);return i!==-1&&i===n.expected.indexOf(e)||(n.actual.push(t),n.expected.push(e),objEquiv(t,e,r2,n))}return r2?t===e:t==e}__name(_deepEqual,"_deepEqual");function isArguments(t){return Object.prototype.toString.call(t)=="[object Arguments]"}__name(isArguments,"isArguments");function objEquiv(t,e,r2,n){if(t==null||e===null||e===void 0)return!1;if(util2.isPrimitive(t)||util2.isPrimitive(e))return t===e;if(r2&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var i=isArguments(t),a=isArguments(e);if(i&&!a||!i&&a)return!1;if(i)return t=pSlice.call(t),e=pSlice.call(e),_deepEqual(t,e,r2);var o,s2,u=objectKeys(t),f2=objectKeys(e);if(u.length!==f2.length)return!1;for(u.sort(),f2.sort(),s2=u.length-1;s2>=0;s2--)if(u[s2]!==f2[s2])return!1;for(s2=u.length-1;s2>=0;s2--)if(o=u[s2],!_deepEqual(t[o],e[o],r2,n))return!1;return!0}__name(objEquiv,"objEquiv");function notDeepStrictEqual(t,e,r2){_deepEqual(t,e,!0)&&fail(t,e,r2,"notDeepStrictEqual",notDeepStrictEqual)}__name(notDeepStrictEqual,"notDeepStrictEqual");function expectedException(t,e){if(!t||!e)return!1;if(Object.prototype.toString.call(e)=="[object RegExp]")return e.test(t);try{if(t instanceof e)return!0}catch{}return!Error.isPrototypeOf(e)&&e.call({},t)===!0}__name(expectedException,"expectedException");function _tryBlock(t){var e;try{t()}catch(t2){e=t2}return e}__name(_tryBlock,"_tryBlock");function _throws(t,e,r2,n){var i;if(typeof e!="function")throw new TypeError('"block" argument must be a function');typeof r2=="string"&&(n=r2,r2=null),i=_tryBlock(e),n=(r2&&r2.name?" ("+r2.name+").":".")+(n?" "+n:"."),t&&!i&&fail(i,r2,"Missing expected exception"+n);var a=typeof n=="string",o=!t&&util2.isError(i),s2=!t&&i&&!r2;if((o&&a&&expectedException(i,r2)||s2)&&fail(i,r2,"Got unwanted exception"+n),t&&i&&r2&&!expectedException(i,r2)||!t&&i)throw i}__name(_throws,"_throws");var util2=_dereq_("util/"),hasOwn=Object.prototype.hasOwnProperty,pSlice=Array.prototype.slice,functionsHaveNames=__name(function(){},"foo").name==="foo",assert2=module2.exports=ok,regex=/\s*function\s+([^\(\s]*)\s*/;assert2.AssertionError=__name(function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var e=t.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var r2=new Error;if(r2.stack){var n=r2.stack,i=getName2(e),a=n.indexOf(`
`+i);if(a>=0){var o=n.indexOf(`
`,a+1);n=n.substring(o+1)}this.stack=n}}},"AssertionError"),util2.inherits(assert2.AssertionError,Error),assert2.fail=fail,assert2.ok=ok,assert2.equal=__name(function(t,e,r2){t!=e&&fail(t,e,r2,"==",assert2.equal)},"equal"),assert2.notEqual=__name(function(t,e,r2){t==e&&fail(t,e,r2,"!=",assert2.notEqual)},"notEqual"),assert2.deepEqual=__name(function(t,e,r2){_deepEqual(t,e,!1)||fail(t,e,r2,"deepEqual",assert2.deepEqual)},"deepEqual"),assert2.deepStrictEqual=__name(function(t,e,r2){_deepEqual(t,e,!0)||fail(t,e,r2,"deepStrictEqual",assert2.deepStrictEqual)},"deepStrictEqual"),assert2.notDeepEqual=__name(function(t,e,r2){_deepEqual(t,e,!1)&&fail(t,e,r2,"notDeepEqual",assert2.notDeepEqual)},"notDeepEqual"),assert2.notDeepStrictEqual=notDeepStrictEqual,assert2.strictEqual=__name(function(t,e,r2){t!==e&&fail(t,e,r2,"===",assert2.strictEqual)},"strictEqual"),assert2.notStrictEqual=__name(function(t,e,r2){t===e&&fail(t,e,r2,"!==",assert2.notStrictEqual)},"notStrictEqual"),assert2.throws=function(t,e,r2){_throws(!0,t,e,r2)},assert2.doesNotThrow=function(t,e,r2){_throws(!1,t,e,r2)},assert2.ifError=function(t){if(t)throw t};var objectKeys=Object.keys||function(t){var e=[];for(var r2 in t)hasOwn.call(t,r2)&&e.push(r2);return e}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"util/":7}],3:[function(_dereq_,module2,exports2){},{}],4:[function(_dereq_,module2,exports2){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}__name(defaultSetTimout,"defaultSetTimout");function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}__name(defaultClearTimeout,"defaultClearTimeout");function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch{try{return cachedSetTimeout.call(null,e,0)}catch{return cachedSetTimeout.call(this,e,0)}}}__name(runTimeout,"runTimeout");function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch{try{return cachedClearTimeout.call(null,e)}catch{return cachedClearTimeout.call(this,e)}}}__name(runClearTimeout,"runClearTimeout");function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}__name(cleanUpNextTick,"cleanUpNextTick");function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}__name(drainQueue,"drainQueue");function Item(e,t){this.fun=e,this.array=t}__name(Item,"Item");function noop(){}__name(noop,"noop");var cachedSetTimeout,cachedClearTimeout,process2=module2.exports={};(function(){try{cachedSetTimeout=typeof setTimeout=="function"?setTimeout:defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout=typeof clearTimeout=="function"?clearTimeout:defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();var currentQueue,queue=[],draining=!1,queueIndex=-1;process2.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r2=1;r2<arguments.length;r2++)t[r2-1]=arguments[r2];queue.push(new Item(e,t)),queue.length!==1||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process2.title="browser",process2.browser=!0,process2.env={},process2.argv=[],process2.version="",process2.versions={},process2.on=noop,process2.addListener=noop,process2.once=noop,process2.off=noop,process2.removeListener=noop,process2.removeAllListeners=noop,process2.emit=noop,process2.prependListener=noop,process2.prependOnceListener=noop,process2.listeners=function(e){return[]},process2.binding=function(e){throw new Error("process.binding is not supported")},process2.cwd=function(){return"/"},process2.chdir=function(e){throw new Error("process.chdir is not supported")},process2.umask=function(){return 0}},{}],5:[function(_dereq_,module2,exports2){typeof Object.create=="function"?module2.exports=__name(function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})},"inherits"):module2.exports=__name(function(t,e){t.super_=e;var o=__name(function(){},"o");o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t},"inherits")},{}],6:[function(_dereq_,module2,exports2){module2.exports=__name(function(o){return o&&typeof o=="object"&&typeof o.copy=="function"&&typeof o.fill=="function"&&typeof o.readUInt8=="function"},"isBuffer")},{}],7:[function(_dereq_,module2,exports2){(function(process2,global){function inspect2(e,r2){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r2)?t.showHidden=r2:r2&&exports2._extend(t,r2),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue2(t,e,t.depth)}__name(inspect2,"inspect");function stylizeWithColor(e,r2){var t=inspect2.styles[r2];return t?"\x1B["+inspect2.colors[t][0]+"m"+e+"\x1B["+inspect2.colors[t][1]+"m":e}__name(stylizeWithColor,"stylizeWithColor");function stylizeNoColor(e,r2){return e}__name(stylizeNoColor,"stylizeNoColor");function arrayToHash(e){var r2={};return e.forEach(function(e2,t){r2[e2]=!0}),r2}__name(arrayToHash,"arrayToHash");function formatValue2(e,r2,t){if(e.customInspect&&r2&&isFunction(r2.inspect)&&r2.inspect!==exports2.inspect&&(!r2.constructor||r2.constructor.prototype!==r2)){var n=r2.inspect(t,e);return isString2(n)||(n=formatValue2(e,n,t)),n}var i=formatPrimitive(e,r2);if(i)return i;var o=Object.keys(r2),s2=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r2)),isError(r2)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r2);if(o.length===0){if(isFunction(r2)){var u=r2.name?": "+r2.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r2))return e.stylize(RegExp.prototype.toString.call(r2),"regexp");if(isDate(r2))return e.stylize(Date.prototype.toString.call(r2),"date");if(isError(r2))return formatError(r2)}var c="",a=!1,l=["{","}"];if(isArray(r2)&&(a=!0,l=["[","]"]),isFunction(r2)&&(c=" [Function"+(r2.name?": "+r2.name:"")+"]"),isRegExp(r2)&&(c=" "+RegExp.prototype.toString.call(r2)),isDate(r2)&&(c=" "+Date.prototype.toUTCString.call(r2)),isError(r2)&&(c=" "+formatError(r2)),o.length===0&&(!a||r2.length==0))return l[0]+c+l[1];if(t<0)return isRegExp(r2)?e.stylize(RegExp.prototype.toString.call(r2),"regexp"):e.stylize("[Object]","special");e.seen.push(r2);var p;return p=a?formatArray2(e,r2,t,s2,o):o.map(function(n2){return formatProperty(e,r2,t,s2,n2,a)}),e.seen.pop(),reduceToSingleString(p,c,l)}__name(formatValue2,"formatValue");function formatPrimitive(e,r2){if(isUndefined(r2))return e.stylize("undefined","undefined");if(isString2(r2)){var t="'"+JSON.stringify(r2).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r2)?e.stylize(""+r2,"number"):isBoolean(r2)?e.stylize(""+r2,"boolean"):isNull(r2)?e.stylize("null","null"):void 0}__name(formatPrimitive,"formatPrimitive");function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}__name(formatError,"formatError");function formatArray2(e,r2,t,n,i){for(var o=[],s2=0,u=r2.length;s2<u;++s2)hasOwnProperty2(r2,String(s2))?o.push(formatProperty(e,r2,t,n,String(s2),!0)):o.push("");return i.forEach(function(i2){i2.match(/^\d+$/)||o.push(formatProperty(e,r2,t,n,i2,!0))}),o}__name(formatArray2,"formatArray");function formatProperty(e,r2,t,n,i,o){var s2,u,c;if((c=Object.getOwnPropertyDescriptor(r2,i)||{value:r2[i]}).get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty2(n,i)||(s2="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue2(e,c.value,null):formatValue2(e,c.value,t-1)).indexOf(`
`)>-1&&(u=o?u.split(`
`).map(function(e2){return"  "+e2}).join(`
`).substr(2):`
`+u.split(`
`).map(function(e2){return"   "+e2}).join(`
`)):u=e.stylize("[Circular]","special")),isUndefined(s2)){if(o&&i.match(/^\d+$/))return u;(s2=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s2=s2.substr(1,s2.length-2),s2=e.stylize(s2,"name")):(s2=s2.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s2=e.stylize(s2,"string"))}return s2+": "+u}__name(formatProperty,"formatProperty");function reduceToSingleString(e,r2,t){var n=0;return e.reduce(function(e2,r3){return n++,r3.indexOf(`
`)>=0&&n++,e2+r3.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?t[0]+(r2===""?"":r2+`
 `)+" "+e.join(`,
  `)+" "+t[1]:t[0]+r2+" "+e.join(", ")+" "+t[1]}__name(reduceToSingleString,"reduceToSingleString");function isArray(e){return Array.isArray(e)}__name(isArray,"isArray");function isBoolean(e){return typeof e=="boolean"}__name(isBoolean,"isBoolean");function isNull(e){return e===null}__name(isNull,"isNull");function isNullOrUndefined(e){return e==null}__name(isNullOrUndefined,"isNullOrUndefined");function isNumber(e){return typeof e=="number"}__name(isNumber,"isNumber");function isString2(e){return typeof e=="string"}__name(isString2,"isString");function isSymbol(e){return typeof e=="symbol"}__name(isSymbol,"isSymbol");function isUndefined(e){return e===void 0}__name(isUndefined,"isUndefined");function isRegExp(e){return isObject(e)&&objectToString(e)==="[object RegExp]"}__name(isRegExp,"isRegExp");function isObject(e){return typeof e=="object"&&e!==null}__name(isObject,"isObject");function isDate(e){return isObject(e)&&objectToString(e)==="[object Date]"}__name(isDate,"isDate");function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}__name(isError,"isError");function isFunction(e){return typeof e=="function"}__name(isFunction,"isFunction");function isPrimitive(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||e===void 0}__name(isPrimitive,"isPrimitive");function objectToString(e){return Object.prototype.toString.call(e)}__name(objectToString,"objectToString");function pad2(e){return e<10?"0"+e.toString(10):e.toString(10)}__name(pad2,"pad");function timestamp(){var e=new Date,r2=[pad2(e.getHours()),pad2(e.getMinutes()),pad2(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r2].join(" ")}__name(timestamp,"timestamp");function hasOwnProperty2(e,r2){return Object.prototype.hasOwnProperty.call(e,r2)}__name(hasOwnProperty2,"hasOwnProperty");var formatRegExp=/%[sdj%]/g;exports2.format=function(e){if(!isString2(e)){for(var r2=[],t=0;t<arguments.length;t++)r2.push(inspect2(arguments[t]));return r2.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e2){if(e2==="%%")return"%";if(t>=i)return e2;switch(e2){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch{return"[Circular]"}default:return e2}}),s2=n[t];t<i;s2=n[++t])isNull(s2)||!isObject(s2)?o+=" "+s2:o+=" "+inspect2(s2);return o},exports2.deprecate=function(e,r2){if(isUndefined(global.process))return function(){return exports2.deprecate(e,r2).apply(this,arguments)};if(process2.noDeprecation===!0)return e;var t=!1;return __name(function(){if(!t){if(process2.throwDeprecation)throw new Error(r2);process2.traceDeprecation?console.trace(r2):console.error(r2),t=!0}return e.apply(this,arguments)},"deprecated")};var debugEnviron,debugs={};exports2.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron={}.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r2=process2.pid;debugs[e]=function(){var t=exports2.format.apply(exports2,arguments);console.error("%s %d: %s",e,r2,t)}}else debugs[e]=function(){};return debugs[e]},exports2.inspect=inspect2,inspect2.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect2.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports2.isArray=isArray,exports2.isBoolean=isBoolean,exports2.isNull=isNull,exports2.isNullOrUndefined=isNullOrUndefined,exports2.isNumber=isNumber,exports2.isString=isString2,exports2.isSymbol=isSymbol,exports2.isUndefined=isUndefined,exports2.isRegExp=isRegExp,exports2.isObject=isObject,exports2.isDate=isDate,exports2.isError=isError,exports2.isFunction=isFunction,exports2.isPrimitive=isPrimitive,exports2.isBuffer=_dereq_("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports2.log=function(){console.log("%s - %s",timestamp(),exports2.format.apply(exports2,arguments))},exports2.inherits=_dereq_("inherits"),exports2._extend=function(e,r2){if(!r2||!isObject(r2))return e;for(var t=Object.keys(r2),n=t.length;n--;)e[t[n]]=r2[t[n]];return e}}).call(this,_dereq_("_process"),typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"./support/isBuffer":6,_process:4,inherits:5}],8:[function(_dereq_,module2,exports2){function _classCallCheck2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}__name(_classCallCheck2,"_classCallCheck");var _createClass2=function(){function defineProperties(e,t){for(var r2=0;r2<t.length;r2++){var n=t[r2];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return __name(defineProperties,"defineProperties"),function(e,t,r2){return t&&defineProperties(e.prototype,t),r2&&defineProperties(e,r2),e}}(),_require=_dereq_("./helpers.js"),createDataProperty=_require.createDataProperty;module2.exports=function(){function ByteLengthQueuingStrategy(e){var t=e.highWaterMark;_classCallCheck2(this,ByteLengthQueuingStrategy),createDataProperty(this,"highWaterMark",t)}return __name(ByteLengthQueuingStrategy,"ByteLengthQueuingStrategy"),_createClass2(ByteLengthQueuingStrategy,[{key:"size",value:__name(function(e){return e.byteLength},"size")}]),ByteLengthQueuingStrategy}()},{"./helpers.js":10}],9:[function(_dereq_,module2,exports2){function _classCallCheck2(e,r2){if(!(e instanceof r2))throw new TypeError("Cannot call a class as a function")}__name(_classCallCheck2,"_classCallCheck");var _createClass2=function(){function defineProperties(e,r2){for(var t=0;t<r2.length;t++){var a=r2[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return __name(defineProperties,"defineProperties"),function(e,r2,t){return r2&&defineProperties(e.prototype,r2),t&&defineProperties(e,t),e}}(),_require=_dereq_("./helpers.js"),createDataProperty=_require.createDataProperty;module2.exports=function(){function CountQueuingStrategy(e){var r2=e.highWaterMark;_classCallCheck2(this,CountQueuingStrategy),createDataProperty(this,"highWaterMark",r2)}return __name(CountQueuingStrategy,"CountQueuingStrategy"),_createClass2(CountQueuingStrategy,[{key:"size",value:__name(function(){return 1},"size")}]),CountQueuingStrategy}()},{"./helpers.js":10}],10:[function(_dereq_,module2,exports2){function Call(e,r2,t){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,r2,t)}__name(Call,"Call");function PromiseCall(e,r2,t){try{return Promise.resolve(Call(e,r2,t))}catch(e2){return Promise.reject(e2)}}__name(PromiseCall,"PromiseCall");var _typeof2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};_dereq_("better-assert");var isFakeDetached=Symbol('is "detached" for our purposes');exports2.typeIsObject=function(e){return(e===void 0?"undefined":_typeof2(e))==="object"&&e!==null||typeof e=="function"},exports2.createDataProperty=function(e,r2,t){Object.defineProperty(e,r2,{value:t,writable:!0,enumerable:!0,configurable:!0})},exports2.createArrayFromList=function(e){return e.slice()},exports2.ArrayBufferCopy=function(e,r2,t,n,o){new Uint8Array(e).set(new Uint8Array(t,n,o),r2)},exports2.CreateIterResultObject=function(e,r2){var t={};return Object.defineProperty(t,"value",{value:e,enumerable:!0,writable:!0,configurable:!0}),Object.defineProperty(t,"done",{value:r2,enumerable:!0,writable:!0,configurable:!0}),t},exports2.IsFiniteNonNegativeNumber=function(e){return exports2.IsNonNegativeNumber(e)!==!1&&e!==1/0},exports2.IsNonNegativeNumber=function(e){return typeof e=="number"&&!Number.isNaN(e)&&!(e<0)},exports2.Call=Call,exports2.CreateAlgorithmFromUnderlyingMethod=function(e,r2,t,n){var o=e[r2];if(o!==void 0){if(typeof o!="function")throw new TypeError(o+" is not a method");switch(t){case 0:return function(){return PromiseCall(o,e,n)};case 1:return function(r3){var t2=[r3].concat(n);return PromiseCall(o,e,t2)}}}return function(){return Promise.resolve()}},exports2.InvokeOrNoop=function(e,r2,t){var n=e[r2];if(n!==void 0)return Call(n,e,t)},exports2.PromiseCall=PromiseCall,exports2.TransferArrayBuffer=function(e){var r2=e.slice();return Object.defineProperty(e,"byteLength",{get:__name(function(){return 0},"get")}),e[isFakeDetached]=!0,r2},exports2.IsDetachedBuffer=function(e){return isFakeDetached in e},exports2.ValidateAndNormalizeHighWaterMark=function(e){if(e=Number(e),Number.isNaN(e)||e<0)throw new RangeError("highWaterMark property of a queuing strategy must be non-negative and non-NaN");return e},exports2.MakeSizeAlgorithmFromSizeFunction=function(e){if(e===void 0)return function(){return 1};if(typeof e!="function")throw new TypeError("size property of a queuing strategy must be a function");return function(r2){return e(r2)}}},{"better-assert":16}],11:[function(_dereq_,module2,exports2){_dereq_("better-assert");var _require=_dereq_("./helpers.js"),IsFiniteNonNegativeNumber=_require.IsFiniteNonNegativeNumber;exports2.DequeueValue=function(e){var u=e._queue.shift();return e._queueTotalSize-=u.size,e._queueTotalSize<0&&(e._queueTotalSize=0),u.value},exports2.EnqueueValueWithSize=function(e,u,t){if(t=Number(t),!IsFiniteNonNegativeNumber(t))throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:u,size:t}),e._queueTotalSize+=t},exports2.PeekQueueValue=function(e){return e._queue[0].value},exports2.ResetQueue=function(e){e._queue=[],e._queueTotalSize=0}},{"./helpers.js":10,"better-assert":16}],12:[function(_dereq_,module2,exports2){function _classCallCheck2(e,r2){if(!(e instanceof r2))throw new TypeError("Cannot call a class as a function")}__name(_classCallCheck2,"_classCallCheck");function AcquireReadableStreamBYOBReader(e){return new ReadableStreamBYOBReader(e)}__name(AcquireReadableStreamBYOBReader,"AcquireReadableStreamBYOBReader");function AcquireReadableStreamDefaultReader(e){return new ReadableStreamDefaultReader(e)}__name(AcquireReadableStreamDefaultReader,"AcquireReadableStreamDefaultReader");function CreateReadableStream(e,r2,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:function(){return 1},o=Object.create(ReadableStream2.prototype);return InitializeReadableStream(o),SetUpReadableStreamDefaultController(o,Object.create(ReadableStreamDefaultController.prototype),e,r2,t,a,l),o}__name(CreateReadableStream,"CreateReadableStream");function CreateReadableByteStream(e,r2,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0,o=Object.create(ReadableStream2.prototype);return InitializeReadableStream(o),SetUpReadableByteStreamController(o,Object.create(ReadableByteStreamController.prototype),e,r2,t,a,l),o}__name(CreateReadableByteStream,"CreateReadableByteStream");function InitializeReadableStream(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}__name(InitializeReadableStream,"InitializeReadableStream");function IsReadableStream(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")}__name(IsReadableStream,"IsReadableStream");function IsReadableStreamDisturbed(e){return e._disturbed}__name(IsReadableStreamDisturbed,"IsReadableStreamDisturbed");function IsReadableStreamLocked(e){return e._reader!==void 0}__name(IsReadableStreamLocked,"IsReadableStreamLocked");function ReadableStreamTee(e,r2){function pullAlgorithm(){return ReadableStreamDefaultReaderRead(t).then(function(e2){var r3=e2.value;if(e2.done===!0&&a===!1&&(l===!1&&ReadableStreamDefaultControllerClose(d._readableStreamController),o===!1&&ReadableStreamDefaultControllerClose(s2._readableStreamController),a=!0),a!==!0){var t2=r3,n2=r3;l===!1&&ReadableStreamDefaultControllerEnqueue(d._readableStreamController,t2),o===!1&&ReadableStreamDefaultControllerEnqueue(s2._readableStreamController,n2)}})}__name(pullAlgorithm,"pullAlgorithm");function startAlgorithm(){}__name(startAlgorithm,"startAlgorithm");var t=AcquireReadableStreamDefaultReader(e),a=!1,l=!1,o=!1,n=void 0,i=void 0,d=void 0,s2=void 0,u=void 0,c=new Promise(function(e2){u=e2});return d=CreateReadableStream(startAlgorithm,pullAlgorithm,__name(function(r3){if(l=!0,n=r3,o===!0){var t2=createArrayFromList([n,i]),a2=ReadableStreamCancel(e,t2);u(a2)}return c},"cancel1Algorithm")),s2=CreateReadableStream(startAlgorithm,pullAlgorithm,__name(function(r3){if(o=!0,i=r3,l===!0){var t2=createArrayFromList([n,i]),a2=ReadableStreamCancel(e,t2);u(a2)}return c},"cancel2Algorithm")),t._closedPromise.catch(function(e2){a!==!0&&(ReadableStreamDefaultControllerErrorIfNeeded(d._readableStreamController,e2),ReadableStreamDefaultControllerErrorIfNeeded(s2._readableStreamController,e2),a=!0)}),[d,s2]}__name(ReadableStreamTee,"ReadableStreamTee");function ReadableStreamAddReadIntoRequest(e){return new Promise(function(r2,t){var a={_resolve:r2,_reject:t};e._reader._readIntoRequests.push(a)})}__name(ReadableStreamAddReadIntoRequest,"ReadableStreamAddReadIntoRequest");function ReadableStreamAddReadRequest(e){return new Promise(function(r2,t){var a={_resolve:r2,_reject:t};e._reader._readRequests.push(a)})}__name(ReadableStreamAddReadRequest,"ReadableStreamAddReadRequest");function ReadableStreamCancel(e,r2){return e._disturbed=!0,e._state==="closed"?Promise.resolve(void 0):e._state==="errored"?Promise.reject(e._storedError):(ReadableStreamClose(e),e._readableStreamController[CancelSteps](r2).then(function(){}))}__name(ReadableStreamCancel,"ReadableStreamCancel");function ReadableStreamClose(e){e._state="closed";var r2=e._reader;if(r2!==void 0){if(IsReadableStreamDefaultReader(r2)===!0){var t=!0,a=!1,l=void 0;try{for(var o,n=r2._readRequests[Symbol.iterator]();!(t=(o=n.next()).done);t=!0)(0,o.value._resolve)(CreateIterResultObject(void 0,!0))}catch(e2){a=!0,l=e2}finally{try{!t&&n.return&&n.return()}finally{if(a)throw l}}r2._readRequests=[]}defaultReaderClosedPromiseResolve(r2)}}__name(ReadableStreamClose,"ReadableStreamClose");function ReadableStreamError(e,r2){e._state="errored",e._storedError=r2;var t=e._reader;if(t!==void 0){if(IsReadableStreamDefaultReader(t)===!0){var a=!0,l=!1,o=void 0;try{for(var n,i=t._readRequests[Symbol.iterator]();!(a=(n=i.next()).done);a=!0)n.value._reject(r2)}catch(e2){l=!0,o=e2}finally{try{!a&&i.return&&i.return()}finally{if(l)throw o}}t._readRequests=[]}else{var d=!0,s2=!1,u=void 0;try{for(var c,b=t._readIntoRequests[Symbol.iterator]();!(d=(c=b.next()).done);d=!0)c.value._reject(r2)}catch(e2){s2=!0,u=e2}finally{try{!d&&b.return&&b.return()}finally{if(s2)throw u}}t._readIntoRequests=[]}defaultReaderClosedPromiseReject(t,r2),t._closedPromise.catch(function(){})}}__name(ReadableStreamError,"ReadableStreamError");function ReadableStreamFulfillReadIntoRequest(e,r2,t){e._reader._readIntoRequests.shift()._resolve(CreateIterResultObject(r2,t))}__name(ReadableStreamFulfillReadIntoRequest,"ReadableStreamFulfillReadIntoRequest");function ReadableStreamFulfillReadRequest(e,r2,t){e._reader._readRequests.shift()._resolve(CreateIterResultObject(r2,t))}__name(ReadableStreamFulfillReadRequest,"ReadableStreamFulfillReadRequest");function ReadableStreamGetNumReadIntoRequests(e){return e._reader._readIntoRequests.length}__name(ReadableStreamGetNumReadIntoRequests,"ReadableStreamGetNumReadIntoRequests");function ReadableStreamGetNumReadRequests(e){return e._reader._readRequests.length}__name(ReadableStreamGetNumReadRequests,"ReadableStreamGetNumReadRequests");function ReadableStreamHasBYOBReader(e){var r2=e._reader;return r2!==void 0&&IsReadableStreamBYOBReader(r2)!==!1}__name(ReadableStreamHasBYOBReader,"ReadableStreamHasBYOBReader");function ReadableStreamHasDefaultReader(e){var r2=e._reader;return r2!==void 0&&IsReadableStreamDefaultReader(r2)!==!1}__name(ReadableStreamHasDefaultReader,"ReadableStreamHasDefaultReader");function IsReadableStreamBYOBReader(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")}__name(IsReadableStreamBYOBReader,"IsReadableStreamBYOBReader");function IsReadableStreamDefaultReader(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readRequests")}__name(IsReadableStreamDefaultReader,"IsReadableStreamDefaultReader");function ReadableStreamReaderGenericInitialize(e,r2){e._ownerReadableStream=r2,r2._reader=e,r2._state==="readable"?defaultReaderClosedPromiseInitialize(e):r2._state==="closed"?defaultReaderClosedPromiseInitializeAsResolved(e):(defaultReaderClosedPromiseInitializeAsRejected(e,r2._storedError),e._closedPromise.catch(function(){}))}__name(ReadableStreamReaderGenericInitialize,"ReadableStreamReaderGenericInitialize");function ReadableStreamReaderGenericCancel(e,r2){return ReadableStreamCancel(e._ownerReadableStream,r2)}__name(ReadableStreamReaderGenericCancel,"ReadableStreamReaderGenericCancel");function ReadableStreamReaderGenericRelease(e){e._ownerReadableStream._state==="readable"?defaultReaderClosedPromiseReject(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):defaultReaderClosedPromiseResetToRejected(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._closedPromise.catch(function(){}),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}__name(ReadableStreamReaderGenericRelease,"ReadableStreamReaderGenericRelease");function ReadableStreamBYOBReaderRead(e,r2){var t=e._ownerReadableStream;return t._disturbed=!0,t._state==="errored"?Promise.reject(t._storedError):ReadableByteStreamControllerPullInto(t._readableStreamController,r2)}__name(ReadableStreamBYOBReaderRead,"ReadableStreamBYOBReaderRead");function ReadableStreamDefaultReaderRead(e){var r2=e._ownerReadableStream;return r2._disturbed=!0,r2._state==="closed"?Promise.resolve(CreateIterResultObject(void 0,!0)):r2._state==="errored"?Promise.reject(r2._storedError):r2._readableStreamController[PullSteps]()}__name(ReadableStreamDefaultReaderRead,"ReadableStreamDefaultReaderRead");function IsReadableStreamDefaultController(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")}__name(IsReadableStreamDefaultController,"IsReadableStreamDefaultController");function ReadableStreamDefaultControllerCallPullIfNeeded(e){ReadableStreamDefaultControllerShouldCallPull(e)!==!1&&(e._pulling!==!0?(e._pulling=!0,e._pullAlgorithm().then(function(){if(e._pulling=!1,e._pullAgain===!0)return e._pullAgain=!1,ReadableStreamDefaultControllerCallPullIfNeeded(e)},function(r2){ReadableStreamDefaultControllerErrorIfNeeded(e,r2)}).catch(rethrowAssertionErrorRejection)):e._pullAgain=!0)}__name(ReadableStreamDefaultControllerCallPullIfNeeded,"ReadableStreamDefaultControllerCallPullIfNeeded");function ReadableStreamDefaultControllerShouldCallPull(e){var r2=e._controlledReadableStream;return ReadableStreamDefaultControllerCanCloseOrEnqueue(e)!==!1&&e._started!==!1&&(IsReadableStreamLocked(r2)===!0&&ReadableStreamGetNumReadRequests(r2)>0||ReadableStreamDefaultControllerGetDesiredSize(e)>0)}__name(ReadableStreamDefaultControllerShouldCallPull,"ReadableStreamDefaultControllerShouldCallPull");function ReadableStreamDefaultControllerClose(e){var r2=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&ReadableStreamClose(r2)}__name(ReadableStreamDefaultControllerClose,"ReadableStreamDefaultControllerClose");function ReadableStreamDefaultControllerEnqueue(e,r2){var t=e._controlledReadableStream;if(IsReadableStreamLocked(t)===!0&&ReadableStreamGetNumReadRequests(t)>0)ReadableStreamFulfillReadRequest(t,r2,!1);else{var a=void 0;try{a=e._strategySizeAlgorithm(r2)}catch(r3){throw ReadableStreamDefaultControllerErrorIfNeeded(e,r3),r3}try{EnqueueValueWithSize(e,r2,a)}catch(r3){throw ReadableStreamDefaultControllerErrorIfNeeded(e,r3),r3}}ReadableStreamDefaultControllerCallPullIfNeeded(e)}__name(ReadableStreamDefaultControllerEnqueue,"ReadableStreamDefaultControllerEnqueue");function ReadableStreamDefaultControllerError(e,r2){var t=e._controlledReadableStream;ResetQueue(e),ReadableStreamError(t,r2)}__name(ReadableStreamDefaultControllerError,"ReadableStreamDefaultControllerError");function ReadableStreamDefaultControllerErrorIfNeeded(e,r2){e._controlledReadableStream._state==="readable"&&ReadableStreamDefaultControllerError(e,r2)}__name(ReadableStreamDefaultControllerErrorIfNeeded,"ReadableStreamDefaultControllerErrorIfNeeded");function ReadableStreamDefaultControllerGetDesiredSize(e){var r2=e._controlledReadableStream._state;return r2==="errored"?null:r2==="closed"?0:e._strategyHWM-e._queueTotalSize}__name(ReadableStreamDefaultControllerGetDesiredSize,"ReadableStreamDefaultControllerGetDesiredSize");function ReadableStreamDefaultControllerHasBackpressure(e){return ReadableStreamDefaultControllerShouldCallPull(e)!==!0}__name(ReadableStreamDefaultControllerHasBackpressure,"ReadableStreamDefaultControllerHasBackpressure");function ReadableStreamDefaultControllerCanCloseOrEnqueue(e){var r2=e._controlledReadableStream._state;return e._closeRequested===!1&&r2==="readable"}__name(ReadableStreamDefaultControllerCanCloseOrEnqueue,"ReadableStreamDefaultControllerCanCloseOrEnqueue");function SetUpReadableStreamDefaultController(e,r2,t,a,l,o,n){r2._controlledReadableStream=e,r2._queue=void 0,r2._queueTotalSize=void 0,ResetQueue(r2),r2._started=!1,r2._closeRequested=!1,r2._pullAgain=!1,r2._pulling=!1,r2._strategySizeAlgorithm=n,r2._strategyHWM=o,r2._pullAlgorithm=a,r2._cancelAlgorithm=l,e._readableStreamController=r2;var i=t();Promise.resolve(i).then(function(){r2._started=!0,ReadableStreamDefaultControllerCallPullIfNeeded(r2)},function(e2){ReadableStreamDefaultControllerErrorIfNeeded(r2,e2)}).catch(rethrowAssertionErrorRejection)}__name(SetUpReadableStreamDefaultController,"SetUpReadableStreamDefaultController");function SetUpReadableStreamDefaultControllerFromUnderlyingSource(e,r2,t,a){var l=Object.create(ReadableStreamDefaultController.prototype),o=CreateAlgorithmFromUnderlyingMethod(r2,"pull",0,[l]),n=CreateAlgorithmFromUnderlyingMethod(r2,"cancel",1,[]);SetUpReadableStreamDefaultController(e,l,__name(function(){return InvokeOrNoop(r2,"start",[l])},"startAlgorithm"),o,n,t,a)}__name(SetUpReadableStreamDefaultControllerFromUnderlyingSource,"SetUpReadableStreamDefaultControllerFromUnderlyingSource");function IsReadableByteStreamController(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")}__name(IsReadableByteStreamController,"IsReadableByteStreamController");function IsReadableStreamBYOBRequest(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")}__name(IsReadableStreamBYOBRequest,"IsReadableStreamBYOBRequest");function ReadableByteStreamControllerCallPullIfNeeded(e){ReadableByteStreamControllerShouldCallPull(e)!==!1&&(e._pulling!==!0?(e._pulling=!0,e._pullAlgorithm().then(function(){e._pulling=!1,e._pullAgain===!0&&(e._pullAgain=!1,ReadableByteStreamControllerCallPullIfNeeded(e))},function(r2){e._controlledReadableByteStream._state==="readable"&&ReadableByteStreamControllerError(e,r2)}).catch(rethrowAssertionErrorRejection)):e._pullAgain=!0)}__name(ReadableByteStreamControllerCallPullIfNeeded,"ReadableByteStreamControllerCallPullIfNeeded");function ReadableByteStreamControllerClearPendingPullIntos(e){ReadableByteStreamControllerInvalidateBYOBRequest(e),e._pendingPullIntos=[]}__name(ReadableByteStreamControllerClearPendingPullIntos,"ReadableByteStreamControllerClearPendingPullIntos");function ReadableByteStreamControllerCommitPullIntoDescriptor(e,r2){var t=!1;e._state==="closed"&&(t=!0);var a=ReadableByteStreamControllerConvertPullIntoDescriptor(r2);r2.readerType==="default"?ReadableStreamFulfillReadRequest(e,a,t):ReadableStreamFulfillReadIntoRequest(e,a,t)}__name(ReadableByteStreamControllerCommitPullIntoDescriptor,"ReadableByteStreamControllerCommitPullIntoDescriptor");function ReadableByteStreamControllerConvertPullIntoDescriptor(e){var r2=e.bytesFilled,t=e.elementSize;return new e.ctor(e.buffer,e.byteOffset,r2/t)}__name(ReadableByteStreamControllerConvertPullIntoDescriptor,"ReadableByteStreamControllerConvertPullIntoDescriptor");function ReadableByteStreamControllerEnqueueChunkToQueue(e,r2,t,a){e._queue.push({buffer:r2,byteOffset:t,byteLength:a}),e._queueTotalSize+=a}__name(ReadableByteStreamControllerEnqueueChunkToQueue,"ReadableByteStreamControllerEnqueueChunkToQueue");function ReadableByteStreamControllerFillPullIntoDescriptorFromQueue(e,r2){var t=r2.elementSize,a=r2.bytesFilled-r2.bytesFilled%t,l=Math.min(e._queueTotalSize,r2.byteLength-r2.bytesFilled),o=r2.bytesFilled+l,n=o-o%t,i=l,d=!1;n>a&&(i=n-r2.bytesFilled,d=!0);for(var s2=e._queue;i>0;){var u=s2[0],c=Math.min(i,u.byteLength),b=r2.byteOffset+r2.bytesFilled;ArrayBufferCopy(r2.buffer,b,u.buffer,u.byteOffset,c),u.byteLength===c?s2.shift():(u.byteOffset+=c,u.byteLength-=c),e._queueTotalSize-=c,ReadableByteStreamControllerFillHeadPullIntoDescriptor(e,c,r2),i-=c}return d}__name(ReadableByteStreamControllerFillPullIntoDescriptorFromQueue,"ReadableByteStreamControllerFillPullIntoDescriptorFromQueue");function ReadableByteStreamControllerFillHeadPullIntoDescriptor(e,r2,t){ReadableByteStreamControllerInvalidateBYOBRequest(e),t.bytesFilled+=r2}__name(ReadableByteStreamControllerFillHeadPullIntoDescriptor,"ReadableByteStreamControllerFillHeadPullIntoDescriptor");function ReadableByteStreamControllerHandleQueueDrain(e){e._queueTotalSize===0&&e._closeRequested===!0?ReadableStreamClose(e._controlledReadableByteStream):ReadableByteStreamControllerCallPullIfNeeded(e)}__name(ReadableByteStreamControllerHandleQueueDrain,"ReadableByteStreamControllerHandleQueueDrain");function ReadableByteStreamControllerInvalidateBYOBRequest(e){e._byobRequest!==void 0&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=void 0,e._byobRequest=void 0)}__name(ReadableByteStreamControllerInvalidateBYOBRequest,"ReadableByteStreamControllerInvalidateBYOBRequest");function ReadableByteStreamControllerProcessPullIntoDescriptorsUsingQueue(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;var r2=e._pendingPullIntos[0];ReadableByteStreamControllerFillPullIntoDescriptorFromQueue(e,r2)===!0&&(ReadableByteStreamControllerShiftPendingPullInto(e),ReadableByteStreamControllerCommitPullIntoDescriptor(e._controlledReadableByteStream,r2))}}__name(ReadableByteStreamControllerProcessPullIntoDescriptorsUsingQueue,"ReadableByteStreamControllerProcessPullIntoDescriptorsUsingQueue");function ReadableByteStreamControllerPullInto(e,r2){var t=e._controlledReadableByteStream,a=1;r2.constructor!==DataView&&(a=r2.constructor.BYTES_PER_ELEMENT);var l=r2.constructor,o={buffer:TransferArrayBuffer(r2.buffer),byteOffset:r2.byteOffset,byteLength:r2.byteLength,bytesFilled:0,elementSize:a,ctor:l,readerType:"byob"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(o),ReadableStreamAddReadIntoRequest(t);if(t._state==="closed"){var n=new r2.constructor(o.buffer,o.byteOffset,0);return Promise.resolve(CreateIterResultObject(n,!0))}if(e._queueTotalSize>0){if(ReadableByteStreamControllerFillPullIntoDescriptorFromQueue(e,o)===!0){var i=ReadableByteStreamControllerConvertPullIntoDescriptor(o);return ReadableByteStreamControllerHandleQueueDrain(e),Promise.resolve(CreateIterResultObject(i,!1))}if(e._closeRequested===!0){var d=new TypeError("Insufficient bytes to fill elements in the given buffer");return ReadableByteStreamControllerError(e,d),Promise.reject(d)}}e._pendingPullIntos.push(o);var s2=ReadableStreamAddReadIntoRequest(t);return ReadableByteStreamControllerCallPullIfNeeded(e),s2}__name(ReadableByteStreamControllerPullInto,"ReadableByteStreamControllerPullInto");function ReadableByteStreamControllerRespondInClosedState(e,r2){r2.buffer=TransferArrayBuffer(r2.buffer);var t=e._controlledReadableByteStream;if(ReadableStreamHasBYOBReader(t)===!0)for(;ReadableStreamGetNumReadIntoRequests(t)>0;)ReadableByteStreamControllerCommitPullIntoDescriptor(t,ReadableByteStreamControllerShiftPendingPullInto(e))}__name(ReadableByteStreamControllerRespondInClosedState,"ReadableByteStreamControllerRespondInClosedState");function ReadableByteStreamControllerRespondInReadableState(e,r2,t){if(t.bytesFilled+r2>t.byteLength)throw new RangeError("bytesWritten out of range");if(ReadableByteStreamControllerFillHeadPullIntoDescriptor(e,r2,t),!(t.bytesFilled<t.elementSize)){ReadableByteStreamControllerShiftPendingPullInto(e);var a=t.bytesFilled%t.elementSize;if(a>0){var l=t.byteOffset+t.bytesFilled,o=t.buffer.slice(l-a,l);ReadableByteStreamControllerEnqueueChunkToQueue(e,o,0,o.byteLength)}t.buffer=TransferArrayBuffer(t.buffer),t.bytesFilled-=a,ReadableByteStreamControllerCommitPullIntoDescriptor(e._controlledReadableByteStream,t),ReadableByteStreamControllerProcessPullIntoDescriptorsUsingQueue(e)}}__name(ReadableByteStreamControllerRespondInReadableState,"ReadableByteStreamControllerRespondInReadableState");function ReadableByteStreamControllerRespondInternal(e,r2){var t=e._pendingPullIntos[0];if(e._controlledReadableByteStream._state==="closed"){if(r2!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream");ReadableByteStreamControllerRespondInClosedState(e,t)}else ReadableByteStreamControllerRespondInReadableState(e,r2,t)}__name(ReadableByteStreamControllerRespondInternal,"ReadableByteStreamControllerRespondInternal");function ReadableByteStreamControllerShiftPendingPullInto(e){var r2=e._pendingPullIntos.shift();return ReadableByteStreamControllerInvalidateBYOBRequest(e),r2}__name(ReadableByteStreamControllerShiftPendingPullInto,"ReadableByteStreamControllerShiftPendingPullInto");function ReadableByteStreamControllerShouldCallPull(e){var r2=e._controlledReadableByteStream;return r2._state==="readable"&&e._closeRequested!==!0&&e._started!==!1&&(ReadableStreamHasDefaultReader(r2)===!0&&ReadableStreamGetNumReadRequests(r2)>0||ReadableStreamHasBYOBReader(r2)===!0&&ReadableStreamGetNumReadIntoRequests(r2)>0||ReadableByteStreamControllerGetDesiredSize(e)>0)}__name(ReadableByteStreamControllerShouldCallPull,"ReadableByteStreamControllerShouldCallPull");function ReadableByteStreamControllerClose(e){var r2=e._controlledReadableByteStream;if(e._queueTotalSize>0)e._closeRequested=!0;else{if(e._pendingPullIntos.length>0&&e._pendingPullIntos[0].bytesFilled>0){var t=new TypeError("Insufficient bytes to fill elements in the given buffer");throw ReadableByteStreamControllerError(e,t),t}ReadableStreamClose(r2)}}__name(ReadableByteStreamControllerClose,"ReadableByteStreamControllerClose");function ReadableByteStreamControllerEnqueue(e,r2){var t=e._controlledReadableByteStream,a=r2.buffer,l=r2.byteOffset,o=r2.byteLength,n=TransferArrayBuffer(a);ReadableStreamHasDefaultReader(t)===!0?ReadableStreamGetNumReadRequests(t)===0?ReadableByteStreamControllerEnqueueChunkToQueue(e,n,l,o):ReadableStreamFulfillReadRequest(t,new Uint8Array(n,l,o),!1):ReadableStreamHasBYOBReader(t)===!0?(ReadableByteStreamControllerEnqueueChunkToQueue(e,n,l,o),ReadableByteStreamControllerProcessPullIntoDescriptorsUsingQueue(e)):ReadableByteStreamControllerEnqueueChunkToQueue(e,n,l,o)}__name(ReadableByteStreamControllerEnqueue,"ReadableByteStreamControllerEnqueue");function ReadableByteStreamControllerError(e,r2){var t=e._controlledReadableByteStream;ReadableByteStreamControllerClearPendingPullIntos(e),ResetQueue(e),ReadableStreamError(t,r2)}__name(ReadableByteStreamControllerError,"ReadableByteStreamControllerError");function ReadableByteStreamControllerGetDesiredSize(e){var r2=e._controlledReadableByteStream._state;return r2==="errored"?null:r2==="closed"?0:e._strategyHWM-e._queueTotalSize}__name(ReadableByteStreamControllerGetDesiredSize,"ReadableByteStreamControllerGetDesiredSize");function ReadableByteStreamControllerRespond(e,r2){if(r2=Number(r2),IsFiniteNonNegativeNumber(r2)===!1)throw new RangeError("bytesWritten must be a finite");ReadableByteStreamControllerRespondInternal(e,r2)}__name(ReadableByteStreamControllerRespond,"ReadableByteStreamControllerRespond");function ReadableByteStreamControllerRespondWithNewView(e,r2){var t=e._pendingPullIntos[0];if(t.byteOffset+t.bytesFilled!==r2.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(t.byteLength!==r2.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");t.buffer=r2.buffer,ReadableByteStreamControllerRespondInternal(e,r2.byteLength)}__name(ReadableByteStreamControllerRespondWithNewView,"ReadableByteStreamControllerRespondWithNewView");function SetUpReadableByteStreamController(e,r2,t,a,l,o,n){r2._controlledReadableByteStream=e,r2._pullAgain=!1,r2._pulling=!1,ReadableByteStreamControllerClearPendingPullIntos(r2),r2._queue=r2._queueTotalSize=void 0,ResetQueue(r2),r2._closeRequested=!1,r2._started=!1,r2._strategyHWM=ValidateAndNormalizeHighWaterMark(o),r2._pullAlgorithm=a,r2._cancelAlgorithm=l,r2._autoAllocateChunkSize=n,r2._pendingPullIntos=[],e._readableStreamController=r2;var i=t();Promise.resolve(i).then(function(){r2._started=!0,ReadableByteStreamControllerCallPullIfNeeded(r2)},function(t2){e._state==="readable"&&ReadableByteStreamControllerError(r2,t2)}).catch(rethrowAssertionErrorRejection)}__name(SetUpReadableByteStreamController,"SetUpReadableByteStreamController");function SetUpReadableByteStreamControllerFromUnderlyingSource(e,r2,t){var a=Object.create(ReadableByteStreamController.prototype),l=CreateAlgorithmFromUnderlyingMethod(r2,"pull",0,[a]),o=CreateAlgorithmFromUnderlyingMethod(r2,"cancel",1,[]),n=r2.autoAllocateChunkSize;if(n!==void 0&&(Number.isInteger(n)===!1||n<=0))throw new RangeError("autoAllocateChunkSize must be a positive integer");SetUpReadableByteStreamController(e,a,__name(function(){return InvokeOrNoop(r2,"start",[a])},"startAlgorithm"),l,o,t,n)}__name(SetUpReadableByteStreamControllerFromUnderlyingSource,"SetUpReadableByteStreamControllerFromUnderlyingSource");function SetUpReadableStreamBYOBRequest(e,r2,t){e._associatedReadableByteStreamController=r2,e._view=t}__name(SetUpReadableStreamBYOBRequest,"SetUpReadableStreamBYOBRequest");function streamBrandCheckException(e){return new TypeError("ReadableStream.prototype."+e+" can only be used on a ReadableStream")}__name(streamBrandCheckException,"streamBrandCheckException");function readerLockException(e){return new TypeError("Cannot "+e+" a stream using a released reader")}__name(readerLockException,"readerLockException");function defaultReaderBrandCheckException(e){return new TypeError("ReadableStreamDefaultReader.prototype."+e+" can only be used on a ReadableStreamDefaultReader")}__name(defaultReaderBrandCheckException,"defaultReaderBrandCheckException");function defaultReaderClosedPromiseInitialize(e){e._closedPromise=new Promise(function(r2,t){e._closedPromise_resolve=r2,e._closedPromise_reject=t})}__name(defaultReaderClosedPromiseInitialize,"defaultReaderClosedPromiseInitialize");function defaultReaderClosedPromiseInitializeAsRejected(e,r2){e._closedPromise=Promise.reject(r2),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}__name(defaultReaderClosedPromiseInitializeAsRejected,"defaultReaderClosedPromiseInitializeAsRejected");function defaultReaderClosedPromiseInitializeAsResolved(e){e._closedPromise=Promise.resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}__name(defaultReaderClosedPromiseInitializeAsResolved,"defaultReaderClosedPromiseInitializeAsResolved");function defaultReaderClosedPromiseReject(e,r2){e._closedPromise_reject(r2),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}__name(defaultReaderClosedPromiseReject,"defaultReaderClosedPromiseReject");function defaultReaderClosedPromiseResetToRejected(e,r2){e._closedPromise=Promise.reject(r2)}__name(defaultReaderClosedPromiseResetToRejected,"defaultReaderClosedPromiseResetToRejected");function defaultReaderClosedPromiseResolve(e){e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}__name(defaultReaderClosedPromiseResolve,"defaultReaderClosedPromiseResolve");function byobReaderBrandCheckException(e){return new TypeError("ReadableStreamBYOBReader.prototype."+e+" can only be used on a ReadableStreamBYOBReader")}__name(byobReaderBrandCheckException,"byobReaderBrandCheckException");function defaultControllerBrandCheckException(e){return new TypeError("ReadableStreamDefaultController.prototype."+e+" can only be used on a ReadableStreamDefaultController")}__name(defaultControllerBrandCheckException,"defaultControllerBrandCheckException");function byobRequestBrandCheckException(e){return new TypeError("ReadableStreamBYOBRequest.prototype."+e+" can only be used on a ReadableStreamBYOBRequest")}__name(byobRequestBrandCheckException,"byobRequestBrandCheckException");function byteStreamControllerBrandCheckException(e){return new TypeError("ReadableByteStreamController.prototype."+e+" can only be used on a ReadableByteStreamController")}__name(byteStreamControllerBrandCheckException,"byteStreamControllerBrandCheckException");function ifIsObjectAndHasAPromiseIsHandledInternalSlotSetPromiseIsHandledToTrue(e){try{Promise.prototype.then.call(e,void 0,function(){})}catch{}}__name(ifIsObjectAndHasAPromiseIsHandledInternalSlotSetPromiseIsHandledToTrue,"ifIsObjectAndHasAPromiseIsHandledInternalSlotSetPromiseIsHandledToTrue");var _createClass2=function(){function defineProperties(e,r2){for(var t=0;t<r2.length;t++){var a=r2[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return __name(defineProperties,"defineProperties"),function(e,r2,t){return r2&&defineProperties(e.prototype,r2),t&&defineProperties(e,t),e}}();_dereq_("better-assert");var _require=_dereq_("./helpers.js"),ArrayBufferCopy=_require.ArrayBufferCopy,CreateAlgorithmFromUnderlyingMethod=_require.CreateAlgorithmFromUnderlyingMethod,CreateIterResultObject=_require.CreateIterResultObject,IsFiniteNonNegativeNumber=_require.IsFiniteNonNegativeNumber,InvokeOrNoop=_require.InvokeOrNoop,IsDetachedBuffer=_require.IsDetachedBuffer,TransferArrayBuffer=_require.TransferArrayBuffer,ValidateAndNormalizeHighWaterMark=_require.ValidateAndNormalizeHighWaterMark;_require.IsNonNegativeNumber;var MakeSizeAlgorithmFromSizeFunction=_require.MakeSizeAlgorithmFromSizeFunction,createArrayFromList=_require.createArrayFromList,typeIsObject=_require.typeIsObject,_require2=_dereq_("./utils.js"),rethrowAssertionErrorRejection=_require2.rethrowAssertionErrorRejection,_require3=_dereq_("./queue-with-sizes.js"),DequeueValue=_require3.DequeueValue,EnqueueValueWithSize=_require3.EnqueueValueWithSize,ResetQueue=_require3.ResetQueue,_require4=_dereq_("./writable-stream.js"),AcquireWritableStreamDefaultWriter=_require4.AcquireWritableStreamDefaultWriter,IsWritableStream=_require4.IsWritableStream,IsWritableStreamLocked=_require4.IsWritableStreamLocked,WritableStreamAbort=_require4.WritableStreamAbort,WritableStreamDefaultWriterCloseWithErrorPropagation=_require4.WritableStreamDefaultWriterCloseWithErrorPropagation,WritableStreamDefaultWriterRelease=_require4.WritableStreamDefaultWriterRelease,WritableStreamDefaultWriterWrite=_require4.WritableStreamDefaultWriterWrite,WritableStreamCloseQueuedOrInFlight=_require4.WritableStreamCloseQueuedOrInFlight,CancelSteps=Symbol("[[CancelSteps]]"),PullSteps=Symbol("[[PullSteps]]"),ReadableStream2=function(){function ReadableStream3(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r2=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r2.size,a=r2.highWaterMark;_classCallCheck2(this,ReadableStream3),InitializeReadableStream(this);var l=e.type;if(String(l)==="bytes"){if(a===void 0&&(a=0),a=ValidateAndNormalizeHighWaterMark(a),t!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");SetUpReadableByteStreamControllerFromUnderlyingSource(this,e,a)}else{if(l!==void 0)throw new RangeError("Invalid type is specified");a===void 0&&(a=1),SetUpReadableStreamDefaultControllerFromUnderlyingSource(this,e,a=ValidateAndNormalizeHighWaterMark(a),MakeSizeAlgorithmFromSizeFunction(t))}}return __name(ReadableStream3,"ReadableStream"),_createClass2(ReadableStream3,[{key:"cancel",value:__name(function(e){return IsReadableStream(this)===!1?Promise.reject(streamBrandCheckException("cancel")):IsReadableStreamLocked(this)===!0?Promise.reject(new TypeError("Cannot cancel a stream that already has a reader")):ReadableStreamCancel(this,e)},"cancel")},{key:"getReader",value:__name(function(){var e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).mode;if(IsReadableStream(this)===!1)throw streamBrandCheckException("getReader");if(e===void 0)return AcquireReadableStreamDefaultReader(this);if((e=String(e))==="byob")return AcquireReadableStreamBYOBReader(this);throw new RangeError("Invalid mode is specified")},"getReader")},{key:"pipeThrough",value:__name(function(e,r2){var t=e.writable,a=e.readable;if(t===void 0||a===void 0)throw new TypeError("readable and writable arguments must be defined");return ifIsObjectAndHasAPromiseIsHandledInternalSlotSetPromiseIsHandledToTrue(this.pipeTo(t,r2)),a},"pipeThrough")},{key:"pipeTo",value:__name(function(e){var r2=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=t.preventClose,l=t.preventAbort,o=t.preventCancel;if(IsReadableStream(this)===!1)return Promise.reject(streamBrandCheckException("pipeTo"));if(IsWritableStream(e)===!1)return Promise.reject(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));if(a=!!a,l=!!l,o=!!o,IsReadableStreamLocked(this)===!0)return Promise.reject(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream"));if(IsWritableStreamLocked(e)===!0)return Promise.reject(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream"));var n=AcquireReadableStreamDefaultReader(this),i=AcquireWritableStreamDefaultWriter(e),d=!1,s2=Promise.resolve();return new Promise(function(t2,u){function pipeLoop(){return d===!0?Promise.resolve():i._readyPromise.then(function(){return ReadableStreamDefaultReaderRead(n).then(function(e2){var r3=e2.value;e2.done!==!0&&(s2=WritableStreamDefaultWriterWrite(i,r3).catch(function(){}))})}).then(pipeLoop)}__name(pipeLoop,"pipeLoop");function waitForWritesToFinish(){var e2=s2;return s2.then(function(){return e2!==s2?waitForWritesToFinish():void 0})}__name(waitForWritesToFinish,"waitForWritesToFinish");function isOrBecomesErrored(e2,r3,t3){e2._state==="errored"?t3(e2._storedError):r3.catch(t3).catch(rethrowAssertionErrorRejection)}__name(isOrBecomesErrored,"isOrBecomesErrored");function shutdownWithAction(r3,t3,a2){function doTheRest(){r3().then(function(){return finalize(t3,a2)},function(e2){return finalize(!0,e2)}).catch(rethrowAssertionErrorRejection)}__name(doTheRest,"doTheRest"),d!==!0&&(d=!0,e._state==="writable"&&WritableStreamCloseQueuedOrInFlight(e)===!1?waitForWritesToFinish().then(doTheRest):doTheRest())}__name(shutdownWithAction,"shutdownWithAction");function shutdown(r3,t3){d!==!0&&(d=!0,e._state==="writable"&&WritableStreamCloseQueuedOrInFlight(e)===!1?waitForWritesToFinish().then(function(){return finalize(r3,t3)}).catch(rethrowAssertionErrorRejection):finalize(r3,t3))}__name(shutdown,"shutdown");function finalize(e2,r3){WritableStreamDefaultWriterRelease(i),ReadableStreamReaderGenericRelease(n),e2?u(r3):t2(void 0)}if(__name(finalize,"finalize"),isOrBecomesErrored(r2,n._closedPromise,function(r3){l===!1?shutdownWithAction(function(){return WritableStreamAbort(e,r3)},!0,r3):shutdown(!0,r3)}),isOrBecomesErrored(e,i._closedPromise,function(e2){o===!1?shutdownWithAction(function(){return ReadableStreamCancel(r2,e2)},!0,e2):shutdown(!0,e2)}),__name(function(e2,r3,t3){e2._state==="closed"?t3():r3.then(t3).catch(rethrowAssertionErrorRejection)},"isOrBecomesClosed")(r2,n._closedPromise,function(){a===!1?shutdownWithAction(function(){return WritableStreamDefaultWriterCloseWithErrorPropagation(i)}):shutdown()}),WritableStreamCloseQueuedOrInFlight(e)===!0||e._state==="closed"){var c=new TypeError("the destination writable stream closed before all data could be piped to it");o===!1?shutdownWithAction(function(){return ReadableStreamCancel(r2,c)},!0,c):shutdown(!0,c)}pipeLoop().catch(function(e2){s2=Promise.resolve(),rethrowAssertionErrorRejection(e2)})})},"pipeTo")},{key:"tee",value:__name(function(){if(IsReadableStream(this)===!1)throw streamBrandCheckException("tee");var e=ReadableStreamTee(this);return createArrayFromList(e)},"tee")},{key:"locked",get:__name(function(){if(IsReadableStream(this)===!1)throw streamBrandCheckException("locked");return IsReadableStreamLocked(this)},"get")}]),ReadableStream3}();module2.exports={CreateReadableByteStream,CreateReadableStream,ReadableStream:ReadableStream2,IsReadableStreamDisturbed,ReadableStreamDefaultControllerClose,ReadableStreamDefaultControllerEnqueue,ReadableStreamDefaultControllerError,ReadableStreamDefaultControllerGetDesiredSize,ReadableStreamDefaultControllerHasBackpressure,ReadableStreamDefaultControllerCanCloseOrEnqueue};var ReadableStreamDefaultReader=function(){function ReadableStreamDefaultReader2(e){if(_classCallCheck2(this,ReadableStreamDefaultReader2),IsReadableStream(e)===!1)throw new TypeError("ReadableStreamDefaultReader can only be constructed with a ReadableStream instance");if(IsReadableStreamLocked(e)===!0)throw new TypeError("This stream has already been locked for exclusive reading by another reader");ReadableStreamReaderGenericInitialize(this,e),this._readRequests=[]}return __name(ReadableStreamDefaultReader2,"ReadableStreamDefaultReader"),_createClass2(ReadableStreamDefaultReader2,[{key:"cancel",value:__name(function(e){return IsReadableStreamDefaultReader(this)===!1?Promise.reject(defaultReaderBrandCheckException("cancel")):this._ownerReadableStream===void 0?Promise.reject(readerLockException("cancel")):ReadableStreamReaderGenericCancel(this,e)},"cancel")},{key:"read",value:__name(function(){return IsReadableStreamDefaultReader(this)===!1?Promise.reject(defaultReaderBrandCheckException("read")):this._ownerReadableStream===void 0?Promise.reject(readerLockException("read from")):ReadableStreamDefaultReaderRead(this)},"read")},{key:"releaseLock",value:__name(function(){if(IsReadableStreamDefaultReader(this)===!1)throw defaultReaderBrandCheckException("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");ReadableStreamReaderGenericRelease(this)}},"releaseLock")},{key:"closed",get:__name(function(){return IsReadableStreamDefaultReader(this)===!1?Promise.reject(defaultReaderBrandCheckException("closed")):this._closedPromise},"get")}]),ReadableStreamDefaultReader2}(),ReadableStreamBYOBReader=function(){function ReadableStreamBYOBReader2(e){if(_classCallCheck2(this,ReadableStreamBYOBReader2),!IsReadableStream(e))throw new TypeError("ReadableStreamBYOBReader can only be constructed with a ReadableStream instance given a byte source");if(IsReadableByteStreamController(e._readableStreamController)===!1)throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");if(IsReadableStreamLocked(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");ReadableStreamReaderGenericInitialize(this,e),this._readIntoRequests=[]}return __name(ReadableStreamBYOBReader2,"ReadableStreamBYOBReader"),_createClass2(ReadableStreamBYOBReader2,[{key:"cancel",value:__name(function(e){return IsReadableStreamBYOBReader(this)?this._ownerReadableStream===void 0?Promise.reject(readerLockException("cancel")):ReadableStreamReaderGenericCancel(this,e):Promise.reject(byobReaderBrandCheckException("cancel"))},"cancel")},{key:"read",value:__name(function(e){return IsReadableStreamBYOBReader(this)?this._ownerReadableStream===void 0?Promise.reject(readerLockException("read from")):ArrayBuffer.isView(e)?IsDetachedBuffer(e.buffer)===!0?Promise.reject(new TypeError("Cannot read into a view onto a detached ArrayBuffer")):e.byteLength===0?Promise.reject(new TypeError("view must have non-zero byteLength")):ReadableStreamBYOBReaderRead(this,e):Promise.reject(new TypeError("view must be an array buffer view")):Promise.reject(byobReaderBrandCheckException("read"))},"read")},{key:"releaseLock",value:__name(function(){if(!IsReadableStreamBYOBReader(this))throw byobReaderBrandCheckException("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");ReadableStreamReaderGenericRelease(this)}},"releaseLock")},{key:"closed",get:__name(function(){return IsReadableStreamBYOBReader(this)?this._closedPromise:Promise.reject(byobReaderBrandCheckException("closed"))},"get")}]),ReadableStreamBYOBReader2}(),ReadableStreamDefaultController=function(){function ReadableStreamDefaultController2(){throw _classCallCheck2(this,ReadableStreamDefaultController2),new TypeError}return __name(ReadableStreamDefaultController2,"ReadableStreamDefaultController"),_createClass2(ReadableStreamDefaultController2,[{key:"close",value:__name(function(){if(IsReadableStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("close");if(ReadableStreamDefaultControllerCanCloseOrEnqueue(this)===!1)throw new TypeError("The stream is not in a state that permits close");ReadableStreamDefaultControllerClose(this)},"close")},{key:"enqueue",value:__name(function(e){if(IsReadableStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("enqueue");if(ReadableStreamDefaultControllerCanCloseOrEnqueue(this)===!1)throw new TypeError("The stream is not in a state that permits enqueue");return ReadableStreamDefaultControllerEnqueue(this,e)},"enqueue")},{key:"error",value:__name(function(e){if(IsReadableStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("error");var r2=this._controlledReadableStream;if(r2._state!=="readable")throw new TypeError("The stream is "+r2._state+" and so cannot be errored");ReadableStreamDefaultControllerError(this,e)},"error")},{key:CancelSteps,value:__name(function(e){return ResetQueue(this),this._cancelAlgorithm(e)},"value")},{key:PullSteps,value:__name(function(){var e=this._controlledReadableStream;if(this._queue.length>0){var r2=DequeueValue(this);return this._closeRequested===!0&&this._queue.length===0?ReadableStreamClose(e):ReadableStreamDefaultControllerCallPullIfNeeded(this),Promise.resolve(CreateIterResultObject(r2,!1))}var t=ReadableStreamAddReadRequest(e);return ReadableStreamDefaultControllerCallPullIfNeeded(this),t},"value")},{key:"desiredSize",get:__name(function(){if(IsReadableStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("desiredSize");return ReadableStreamDefaultControllerGetDesiredSize(this)},"get")}]),ReadableStreamDefaultController2}(),ReadableStreamBYOBRequest=function(){function ReadableStreamBYOBRequest2(){throw _classCallCheck2(this,ReadableStreamBYOBRequest2),new TypeError("ReadableStreamBYOBRequest cannot be used directly")}return __name(ReadableStreamBYOBRequest2,"ReadableStreamBYOBRequest"),_createClass2(ReadableStreamBYOBRequest2,[{key:"respond",value:__name(function(e){if(IsReadableStreamBYOBRequest(this)===!1)throw byobRequestBrandCheckException("respond");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(IsDetachedBuffer(this._view.buffer)===!0)throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");ReadableByteStreamControllerRespond(this._associatedReadableByteStreamController,e)},"respond")},{key:"respondWithNewView",value:__name(function(e){if(IsReadableStreamBYOBRequest(this)===!1)throw byobRequestBrandCheckException("respond");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");if(IsDetachedBuffer(e.buffer)===!0)throw new TypeError("The supplied view's buffer has been detached and so cannot be used as a response");ReadableByteStreamControllerRespondWithNewView(this._associatedReadableByteStreamController,e)},"respondWithNewView")},{key:"view",get:__name(function(){if(IsReadableStreamBYOBRequest(this)===!1)throw byobRequestBrandCheckException("view");return this._view},"get")}]),ReadableStreamBYOBRequest2}(),ReadableByteStreamController=function(){function ReadableByteStreamController2(){throw _classCallCheck2(this,ReadableByteStreamController2),new TypeError("ReadableByteStreamController constructor cannot be used directly")}return __name(ReadableByteStreamController2,"ReadableByteStreamController"),_createClass2(ReadableByteStreamController2,[{key:"close",value:__name(function(){if(IsReadableByteStreamController(this)===!1)throw byteStreamControllerBrandCheckException("close");if(this._closeRequested===!0)throw new TypeError("The stream has already been closed; do not close it again!");var e=this._controlledReadableByteStream._state;if(e!=="readable")throw new TypeError("The stream (in "+e+" state) is not in the readable state and cannot be closed");ReadableByteStreamControllerClose(this)},"close")},{key:"enqueue",value:__name(function(e){if(IsReadableByteStreamController(this)===!1)throw byteStreamControllerBrandCheckException("enqueue");if(this._closeRequested===!0)throw new TypeError("stream is closed or draining");var r2=this._controlledReadableByteStream._state;if(r2!=="readable")throw new TypeError("The stream (in "+r2+" state) is not in the readable state and cannot be enqueued to");if(!ArrayBuffer.isView(e))throw new TypeError("You can only enqueue array buffer views when using a ReadableByteStreamController");if(IsDetachedBuffer(e.buffer)===!0)throw new TypeError("Cannot enqueue a view onto a detached ArrayBuffer");ReadableByteStreamControllerEnqueue(this,e)},"enqueue")},{key:"error",value:__name(function(e){if(IsReadableByteStreamController(this)===!1)throw byteStreamControllerBrandCheckException("error");var r2=this._controlledReadableByteStream;if(r2._state!=="readable")throw new TypeError("The stream is "+r2._state+" and so cannot be errored");ReadableByteStreamControllerError(this,e)},"error")},{key:CancelSteps,value:__name(function(e){return this._pendingPullIntos.length>0&&(this._pendingPullIntos[0].bytesFilled=0),ResetQueue(this),this._cancelAlgorithm(e)},"value")},{key:PullSteps,value:__name(function(){var e=this._controlledReadableByteStream;if(this._queueTotalSize>0){var r2=this._queue.shift();this._queueTotalSize-=r2.byteLength,ReadableByteStreamControllerHandleQueueDrain(this);var t=void 0;try{t=new Uint8Array(r2.buffer,r2.byteOffset,r2.byteLength)}catch(e2){return Promise.reject(e2)}return Promise.resolve(CreateIterResultObject(t,!1))}var a=this._autoAllocateChunkSize;if(a!==void 0){var l=void 0;try{l=new ArrayBuffer(a)}catch(e2){return Promise.reject(e2)}var o={buffer:l,byteOffset:0,byteLength:a,bytesFilled:0,elementSize:1,ctor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(o)}var n=ReadableStreamAddReadRequest(e);return ReadableByteStreamControllerCallPullIfNeeded(this),n},"value")},{key:"byobRequest",get:__name(function(){if(IsReadableByteStreamController(this)===!1)throw byteStreamControllerBrandCheckException("byobRequest");if(this._byobRequest===void 0&&this._pendingPullIntos.length>0){var e=this._pendingPullIntos[0],r2=new Uint8Array(e.buffer,e.byteOffset+e.bytesFilled,e.byteLength-e.bytesFilled),t=Object.create(ReadableStreamBYOBRequest.prototype);SetUpReadableStreamBYOBRequest(t,this,r2),this._byobRequest=t}return this._byobRequest},"get")},{key:"desiredSize",get:__name(function(){if(IsReadableByteStreamController(this)===!1)throw byteStreamControllerBrandCheckException("desiredSize");return ReadableByteStreamControllerGetDesiredSize(this)},"get")}]),ReadableByteStreamController2}()},{"./helpers.js":10,"./queue-with-sizes.js":11,"./utils.js":14,"./writable-stream.js":15,"better-assert":16}],13:[function(_dereq_,module2,exports2){function _classCallCheck2(r2,e){if(!(r2 instanceof e))throw new TypeError("Cannot call a class as a function")}__name(_classCallCheck2,"_classCallCheck");function CreateTransformStream(r2,e,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:function(){return 1},n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:function(){return 1},i=Object.create(TransformStream.prototype),m=void 0;InitializeTransformStream(i,new Promise(function(r3){m=r3}),a,o,n,l),SetUpTransformStreamDefaultController(i,Object.create(TransformStreamDefaultController.prototype),e,t);var s2=r2();return m(s2),i}__name(CreateTransformStream,"CreateTransformStream");function InitializeTransformStream(r2,e,t,a,o,n){function startAlgorithm(){return e}__name(startAlgorithm,"startAlgorithm"),r2._writable=CreateWritableStream(startAlgorithm,__name(function(e2){return TransformStreamDefaultSinkWriteAlgorithm(r2,e2)},"writeAlgorithm"),__name(function(){return TransformStreamDefaultSinkCloseAlgorithm(r2)},"closeAlgorithm"),__name(function(){return TransformStreamDefaultSinkAbortAlgorithm(r2)},"abortAlgorithm"),t,a),r2._readable=CreateReadableStream(startAlgorithm,__name(function(){return TransformStreamDefaultSourcePullAlgorithm(r2)},"pullAlgorithm"),__name(function(e2){return TransformStreamErrorWritableAndUnblockWrite(r2,e2),Promise.resolve()},"cancelAlgorithm"),o,n),r2._backpressure=void 0,r2._backpressureChangePromise=void 0,r2._backpressureChangePromise_resolve=void 0,TransformStreamSetBackpressure(r2,!0),r2._transformStreamController=void 0}__name(InitializeTransformStream,"InitializeTransformStream");function IsTransformStream(r2){return!!typeIsObject(r2)&&!!Object.prototype.hasOwnProperty.call(r2,"_transformStreamController")}__name(IsTransformStream,"IsTransformStream");function TransformStreamError(r2,e){verbose("TransformStreamError()"),r2._readable._state==="readable"&&ReadableStreamDefaultControllerError(r2._readable._readableStreamController,e),TransformStreamErrorWritableAndUnblockWrite(r2,e)}__name(TransformStreamError,"TransformStreamError");function TransformStreamErrorWritableAndUnblockWrite(r2,e){WritableStreamDefaultControllerErrorIfNeeded(r2._writable._writableStreamController,e),r2._backpressure===!0&&TransformStreamSetBackpressure(r2,!1)}__name(TransformStreamErrorWritableAndUnblockWrite,"TransformStreamErrorWritableAndUnblockWrite");function TransformStreamSetBackpressure(r2,e){verbose("TransformStreamSetBackpressure() [backpressure = "+e+"]"),r2._backpressureChangePromise!==void 0&&r2._backpressureChangePromise_resolve(),r2._backpressureChangePromise=new Promise(function(e2){r2._backpressureChangePromise_resolve=e2}),r2._backpressure=e}__name(TransformStreamSetBackpressure,"TransformStreamSetBackpressure");function IsTransformStreamDefaultController(r2){return!!typeIsObject(r2)&&!!Object.prototype.hasOwnProperty.call(r2,"_controlledTransformStream")}__name(IsTransformStreamDefaultController,"IsTransformStreamDefaultController");function SetUpTransformStreamDefaultController(r2,e,t,a){e._controlledTransformStream=r2,r2._transformStreamController=e,e._transformAlgorithm=t,e._flushAlgorithm=a}__name(SetUpTransformStreamDefaultController,"SetUpTransformStreamDefaultController");function SetUpTransformStreamDefaultControllerFromTransformer(r2,e){var t=Object.create(TransformStreamDefaultController.prototype),a=__name(function(r3){try{return TransformStreamDefaultControllerEnqueue(t,r3),Promise.resolve()}catch(r4){return Promise.reject(r4)}},"transformAlgorithm"),o=e.transform;if(o!==void 0){if(typeof o!="function")throw new TypeError("transform is not a method");a=__name(function(a2){return PromiseCall(o,e,[a2,t]).catch(function(e2){throw TransformStreamError(r2,e2),e2})},"transformAlgorithm")}var n=CreateAlgorithmFromUnderlyingMethod(e,"flush",0,[t]);SetUpTransformStreamDefaultController(r2,t,a,n)}__name(SetUpTransformStreamDefaultControllerFromTransformer,"SetUpTransformStreamDefaultControllerFromTransformer");function TransformStreamDefaultControllerEnqueue(r2,e){verbose("TransformStreamDefaultControllerEnqueue()");var t=r2._controlledTransformStream,a=t._readable._readableStreamController;if(ReadableStreamDefaultControllerCanCloseOrEnqueue(a)===!1)throw new TypeError("Readable side is not in a state that permits enqueue");try{ReadableStreamDefaultControllerEnqueue(a,e)}catch(r3){throw TransformStreamErrorWritableAndUnblockWrite(t,r3),t._readable._storedError}ReadableStreamDefaultControllerHasBackpressure(a)!==t._backpressure&&TransformStreamSetBackpressure(t,!0)}__name(TransformStreamDefaultControllerEnqueue,"TransformStreamDefaultControllerEnqueue");function TransformStreamDefaultControllerError(r2,e){TransformStreamError(r2._controlledTransformStream,e)}__name(TransformStreamDefaultControllerError,"TransformStreamDefaultControllerError");function TransformStreamDefaultControllerTerminate(r2){verbose("TransformStreamDefaultControllerTerminate()");var e=r2._controlledTransformStream,t=e._readable._readableStreamController;ReadableStreamDefaultControllerCanCloseOrEnqueue(t)===!0&&ReadableStreamDefaultControllerClose(t),TransformStreamErrorWritableAndUnblockWrite(e,new TypeError("TransformStream terminated"))}__name(TransformStreamDefaultControllerTerminate,"TransformStreamDefaultControllerTerminate");function TransformStreamDefaultSinkWriteAlgorithm(r2,e){verbose("TransformStreamDefaultSinkWriteAlgorithm()");var t=r2._transformStreamController;return r2._backpressure===!0?r2._backpressureChangePromise.then(function(){var a=r2._writable;if(a._state==="erroring")throw a._storedError;return t._transformAlgorithm(e)}):t._transformAlgorithm(e)}__name(TransformStreamDefaultSinkWriteAlgorithm,"TransformStreamDefaultSinkWriteAlgorithm");function TransformStreamDefaultSinkAbortAlgorithm(r2){return TransformStreamError(r2,new TypeError("Writable side aborted")),Promise.resolve()}__name(TransformStreamDefaultSinkAbortAlgorithm,"TransformStreamDefaultSinkAbortAlgorithm");function TransformStreamDefaultSinkCloseAlgorithm(r2){verbose("TransformStreamDefaultSinkCloseAlgorithm()");var e=r2._readable;return r2._transformStreamController._flushAlgorithm().then(function(){if(e._state==="errored")throw e._storedError;var r3=e._readableStreamController;ReadableStreamDefaultControllerCanCloseOrEnqueue(r3)===!0&&ReadableStreamDefaultControllerClose(r3)}).catch(function(t){throw TransformStreamError(r2,t),e._storedError})}__name(TransformStreamDefaultSinkCloseAlgorithm,"TransformStreamDefaultSinkCloseAlgorithm");function TransformStreamDefaultSourcePullAlgorithm(r2){return verbose("TransformStreamDefaultSourcePullAlgorithm()"),TransformStreamSetBackpressure(r2,!1),r2._backpressureChangePromise}__name(TransformStreamDefaultSourcePullAlgorithm,"TransformStreamDefaultSourcePullAlgorithm");function defaultControllerBrandCheckException(r2){return new TypeError("TransformStreamDefaultController.prototype."+r2+" can only be used on a TransformStreamDefaultController")}__name(defaultControllerBrandCheckException,"defaultControllerBrandCheckException");function streamBrandCheckException(r2){return new TypeError("TransformStream.prototype."+r2+" can only be used on a TransformStream")}__name(streamBrandCheckException,"streamBrandCheckException");var _createClass2=function(){function defineProperties(r2,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r2,a.key,a)}}return __name(defineProperties,"defineProperties"),function(r2,e,t){return e&&defineProperties(r2.prototype,e),t&&defineProperties(r2,t),r2}}();_dereq_("better-assert");var verbose=_dereq_("debug")("streams:transform-stream:verbose"),_require=_dereq_("./helpers.js"),InvokeOrNoop=_require.InvokeOrNoop,CreateAlgorithmFromUnderlyingMethod=_require.CreateAlgorithmFromUnderlyingMethod,PromiseCall=_require.PromiseCall,typeIsObject=_require.typeIsObject,ValidateAndNormalizeHighWaterMark=_require.ValidateAndNormalizeHighWaterMark;_require.IsNonNegativeNumber;var MakeSizeAlgorithmFromSizeFunction=_require.MakeSizeAlgorithmFromSizeFunction,_require2=_dereq_("./readable-stream.js"),CreateReadableStream=_require2.CreateReadableStream,ReadableStreamDefaultControllerClose=_require2.ReadableStreamDefaultControllerClose,ReadableStreamDefaultControllerEnqueue=_require2.ReadableStreamDefaultControllerEnqueue,ReadableStreamDefaultControllerError=_require2.ReadableStreamDefaultControllerError,ReadableStreamDefaultControllerGetDesiredSize=_require2.ReadableStreamDefaultControllerGetDesiredSize,ReadableStreamDefaultControllerHasBackpressure=_require2.ReadableStreamDefaultControllerHasBackpressure,ReadableStreamDefaultControllerCanCloseOrEnqueue=_require2.ReadableStreamDefaultControllerCanCloseOrEnqueue,_require3=_dereq_("./writable-stream.js"),CreateWritableStream=_require3.CreateWritableStream,WritableStreamDefaultControllerErrorIfNeeded=_require3.WritableStreamDefaultControllerErrorIfNeeded,TransformStream=function(){function TransformStream2(){var r2=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(_classCallCheck2(this,TransformStream2),r2.readableType!==void 0)throw new RangeError("Invalid readable type specified");if(r2.writableType!==void 0)throw new RangeError("Invalid writable type specified");var a=e.size,o=MakeSizeAlgorithmFromSizeFunction(a),n=e.highWaterMark;n===void 0&&(n=1),n=ValidateAndNormalizeHighWaterMark(n);var l=t.size,i=MakeSizeAlgorithmFromSizeFunction(l),m=t.highWaterMark;m===void 0&&(m=0),m=ValidateAndNormalizeHighWaterMark(m);var s2=void 0;InitializeTransformStream(this,new Promise(function(r3){s2=r3}),n,o,m,i),SetUpTransformStreamDefaultControllerFromTransformer(this,r2);var u=InvokeOrNoop(r2,"start",[this._transformStreamController]);s2(u)}return __name(TransformStream2,"TransformStream"),_createClass2(TransformStream2,[{key:"readable",get:__name(function(){if(IsTransformStream(this)===!1)throw streamBrandCheckException("readable");return this._readable},"get")},{key:"writable",get:__name(function(){if(IsTransformStream(this)===!1)throw streamBrandCheckException("writable");return this._writable},"get")}]),TransformStream2}(),TransformStreamDefaultController=function(){function TransformStreamDefaultController2(){throw _classCallCheck2(this,TransformStreamDefaultController2),new TypeError("TransformStreamDefaultController instances cannot be created directly")}return __name(TransformStreamDefaultController2,"TransformStreamDefaultController"),_createClass2(TransformStreamDefaultController2,[{key:"enqueue",value:__name(function(r2){if(IsTransformStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("enqueue");TransformStreamDefaultControllerEnqueue(this,r2)},"enqueue")},{key:"error",value:__name(function(r2){if(IsTransformStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("error");TransformStreamDefaultControllerError(this,r2)},"error")},{key:"terminate",value:__name(function(){if(IsTransformStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("terminate");TransformStreamDefaultControllerTerminate(this)},"terminate")},{key:"desiredSize",get:__name(function(){if(IsTransformStreamDefaultController(this)===!1)throw defaultControllerBrandCheckException("desiredSize");var r2=this._controlledTransformStream._readable._readableStreamController;return ReadableStreamDefaultControllerGetDesiredSize(r2)},"get")}]),TransformStreamDefaultController2}();module2.exports={CreateTransformStream,TransformStream}},{"./helpers.js":10,"./readable-stream.js":12,"./writable-stream.js":15,"better-assert":16,debug:18}],14:[function(_dereq_,module2,exports2){var assert2=_dereq_("better-assert");exports2.rethrowAssertionErrorRejection=function(r2){r2&&r2.constructor===assert2.AssertionError&&setTimeout(function(){throw r2},0)}},{"better-assert":16}],15:[function(_dereq_,module2,exports2){function _classCallCheck2(e,r2){if(!(e instanceof r2))throw new TypeError("Cannot call a class as a function")}__name(_classCallCheck2,"_classCallCheck");function AcquireWritableStreamDefaultWriter(e){return new WritableStreamDefaultWriter(e)}__name(AcquireWritableStreamDefaultWriter,"AcquireWritableStreamDefaultWriter");function CreateWritableStream(e,r2,t,i){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:function(){return 1},l=Object.create(WritableStream.prototype);return InitializeWritableStream(l),SetUpWritableStreamDefaultController(l,Object.create(WritableStreamDefaultController.prototype),e,r2,t,i,a,o),l}__name(CreateWritableStream,"CreateWritableStream");function InitializeWritableStream(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=[],e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}__name(InitializeWritableStream,"InitializeWritableStream");function IsWritableStream(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")}__name(IsWritableStream,"IsWritableStream");function IsWritableStreamLocked(e){return e._writer!==void 0}__name(IsWritableStreamLocked,"IsWritableStreamLocked");function WritableStreamAbort(e,r2){var t=e._state;if(t==="closed")return Promise.resolve(void 0);if(t==="errored")return Promise.reject(e._storedError);var i=new TypeError("Requested to abort");if(e._pendingAbortRequest!==void 0)return Promise.reject(i);var a=!1;t==="erroring"&&(a=!0,r2=void 0);var o=new Promise(function(t2,i2){e._pendingAbortRequest={_resolve:t2,_reject:i2,_reason:r2,_wasAlreadyErroring:a}});return a===!1&&WritableStreamStartErroring(e,i),o}__name(WritableStreamAbort,"WritableStreamAbort");function WritableStreamAddWriteRequest(e){return new Promise(function(r2,t){var i={_resolve:r2,_reject:t};e._writeRequests.push(i)})}__name(WritableStreamAddWriteRequest,"WritableStreamAddWriteRequest");function WritableStreamDealWithRejection(e,r2){verbose("WritableStreamDealWithRejection(stream, %o)",r2),e._state!=="writable"?WritableStreamFinishErroring(e):WritableStreamStartErroring(e,r2)}__name(WritableStreamDealWithRejection,"WritableStreamDealWithRejection");function WritableStreamStartErroring(e,r2){verbose("WritableStreamStartErroring(stream, %o)",r2);var t=e._writableStreamController;e._state="erroring",e._storedError=r2;var i=e._writer;i!==void 0&&WritableStreamDefaultWriterEnsureReadyPromiseRejected(i,r2),WritableStreamHasOperationMarkedInFlight(e)===!1&&t._started===!0&&WritableStreamFinishErroring(e)}__name(WritableStreamStartErroring,"WritableStreamStartErroring");function WritableStreamFinishErroring(e){verbose("WritableStreamFinishErroring()"),e._state="errored",e._writableStreamController[ErrorSteps]();var r2=e._storedError,t=!0,i=!1,a=void 0;try{for(var o,l=e._writeRequests[Symbol.iterator]();!(t=(o=l.next()).done);t=!0)o.value._reject(r2)}catch(e2){i=!0,a=e2}finally{try{!t&&l.return&&l.return()}finally{if(i)throw a}}if(e._writeRequests=[],e._pendingAbortRequest!==void 0){var s2=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,s2._wasAlreadyErroring===!0)return s2._reject(r2),void WritableStreamRejectCloseAndClosedPromiseIfNeeded(e);e._writableStreamController[AbortSteps](s2._reason).then(function(){s2._resolve(),WritableStreamRejectCloseAndClosedPromiseIfNeeded(e)},function(r3){s2._reject(r3),WritableStreamRejectCloseAndClosedPromiseIfNeeded(e)})}else WritableStreamRejectCloseAndClosedPromiseIfNeeded(e)}__name(WritableStreamFinishErroring,"WritableStreamFinishErroring");function WritableStreamFinishInFlightWrite(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}__name(WritableStreamFinishInFlightWrite,"WritableStreamFinishInFlightWrite");function WritableStreamFinishInFlightWriteWithError(e,r2){e._inFlightWriteRequest._reject(r2),e._inFlightWriteRequest=void 0,WritableStreamDealWithRejection(e,r2)}__name(WritableStreamFinishInFlightWriteWithError,"WritableStreamFinishInFlightWriteWithError");function WritableStreamFinishInFlightClose(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";var r2=e._writer;r2!==void 0&&defaultWriterClosedPromiseResolve(r2)}__name(WritableStreamFinishInFlightClose,"WritableStreamFinishInFlightClose");function WritableStreamFinishInFlightCloseWithError(e,r2){e._inFlightCloseRequest._reject(r2),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(r2),e._pendingAbortRequest=void 0),WritableStreamDealWithRejection(e,r2)}__name(WritableStreamFinishInFlightCloseWithError,"WritableStreamFinishInFlightCloseWithError");function WritableStreamCloseQueuedOrInFlight(e){return e._closeRequest!==void 0||e._inFlightCloseRequest!==void 0}__name(WritableStreamCloseQueuedOrInFlight,"WritableStreamCloseQueuedOrInFlight");function WritableStreamHasOperationMarkedInFlight(e){return e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0?(verbose("WritableStreamHasOperationMarkedInFlight() is false"),!1):(verbose("WritableStreamHasOperationMarkedInFlight() is true"),!0)}__name(WritableStreamHasOperationMarkedInFlight,"WritableStreamHasOperationMarkedInFlight");function WritableStreamMarkCloseRequestInFlight(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}__name(WritableStreamMarkCloseRequestInFlight,"WritableStreamMarkCloseRequestInFlight");function WritableStreamMarkFirstWriteRequestInFlight(e){e._inFlightWriteRequest=e._writeRequests.shift()}__name(WritableStreamMarkFirstWriteRequestInFlight,"WritableStreamMarkFirstWriteRequestInFlight");function WritableStreamRejectCloseAndClosedPromiseIfNeeded(e){verbose("WritableStreamRejectCloseAndClosedPromiseIfNeeded()"),e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);var r2=e._writer;r2!==void 0&&(defaultWriterClosedPromiseReject(r2,e._storedError),r2._closedPromise.catch(function(){}))}__name(WritableStreamRejectCloseAndClosedPromiseIfNeeded,"WritableStreamRejectCloseAndClosedPromiseIfNeeded");function WritableStreamUpdateBackpressure(e,r2){var t=e._writer;t!==void 0&&r2!==e._backpressure&&(r2===!0?defaultWriterReadyPromiseReset(t):defaultWriterReadyPromiseResolve(t)),e._backpressure=r2}__name(WritableStreamUpdateBackpressure,"WritableStreamUpdateBackpressure");function IsWritableStreamDefaultWriter(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")}__name(IsWritableStreamDefaultWriter,"IsWritableStreamDefaultWriter");function WritableStreamDefaultWriterAbort(e,r2){return WritableStreamAbort(e._ownerWritableStream,r2)}__name(WritableStreamDefaultWriterAbort,"WritableStreamDefaultWriterAbort");function WritableStreamDefaultWriterClose(e){var r2=e._ownerWritableStream,t=r2._state;if(t==="closed"||t==="errored")return Promise.reject(new TypeError("The stream (in "+t+" state) is not in the writable state and cannot be closed"));var i=new Promise(function(e2,t2){var i2={_resolve:e2,_reject:t2};r2._closeRequest=i2});return r2._backpressure===!0&&t==="writable"&&defaultWriterReadyPromiseResolve(e),WritableStreamDefaultControllerClose(r2._writableStreamController),i}__name(WritableStreamDefaultWriterClose,"WritableStreamDefaultWriterClose");function WritableStreamDefaultWriterCloseWithErrorPropagation(e){var r2=e._ownerWritableStream,t=r2._state;return WritableStreamCloseQueuedOrInFlight(r2)===!0||t==="closed"?Promise.resolve():t==="errored"?Promise.reject(r2._storedError):WritableStreamDefaultWriterClose(e)}__name(WritableStreamDefaultWriterCloseWithErrorPropagation,"WritableStreamDefaultWriterCloseWithErrorPropagation");function WritableStreamDefaultWriterEnsureClosedPromiseRejected(e,r2){e._closedPromiseState==="pending"?defaultWriterClosedPromiseReject(e,r2):defaultWriterClosedPromiseResetToRejected(e,r2),e._closedPromise.catch(function(){})}__name(WritableStreamDefaultWriterEnsureClosedPromiseRejected,"WritableStreamDefaultWriterEnsureClosedPromiseRejected");function WritableStreamDefaultWriterEnsureReadyPromiseRejected(e,r2){verbose("WritableStreamDefaultWriterEnsureReadyPromiseRejected(writer, %o)",r2),e._readyPromiseState==="pending"?defaultWriterReadyPromiseReject(e,r2):defaultWriterReadyPromiseResetToRejected(e,r2),e._readyPromise.catch(function(){})}__name(WritableStreamDefaultWriterEnsureReadyPromiseRejected,"WritableStreamDefaultWriterEnsureReadyPromiseRejected");function WritableStreamDefaultWriterGetDesiredSize(e){var r2=e._ownerWritableStream,t=r2._state;return t==="errored"||t==="erroring"?null:t==="closed"?0:WritableStreamDefaultControllerGetDesiredSize(r2._writableStreamController)}__name(WritableStreamDefaultWriterGetDesiredSize,"WritableStreamDefaultWriterGetDesiredSize");function WritableStreamDefaultWriterRelease(e){var r2=e._ownerWritableStream,t=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");WritableStreamDefaultWriterEnsureReadyPromiseRejected(e,t),WritableStreamDefaultWriterEnsureClosedPromiseRejected(e,t),r2._writer=void 0,e._ownerWritableStream=void 0}__name(WritableStreamDefaultWriterRelease,"WritableStreamDefaultWriterRelease");function WritableStreamDefaultWriterWrite(e,r2){var t=e._ownerWritableStream,i=t._writableStreamController,a=WritableStreamDefaultControllerGetChunkSize(i,r2);if(t!==e._ownerWritableStream)return Promise.reject(defaultWriterLockException("write to"));var o=t._state;if(o==="errored")return Promise.reject(t._storedError);if(WritableStreamCloseQueuedOrInFlight(t)===!0||o==="closed")return Promise.reject(new TypeError("The stream is closing or closed and cannot be written to"));if(o==="erroring")return Promise.reject(t._storedError);var l=WritableStreamAddWriteRequest(t);return WritableStreamDefaultControllerWrite(i,r2,a),l}__name(WritableStreamDefaultWriterWrite,"WritableStreamDefaultWriterWrite");function IsWritableStreamDefaultController(e){return!!typeIsObject(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")}__name(IsWritableStreamDefaultController,"IsWritableStreamDefaultController");function SetUpWritableStreamDefaultController(e,r2,t,i,a,o,l,s2){r2._controlledWritableStream=e,e._writableStreamController=r2,r2._queue=void 0,r2._queueTotalSize=void 0,ResetQueue(r2),r2._started=!1,r2._strategySizeAlgorithm=s2,r2._strategyHWM=l,r2._writeAlgorithm=i,r2._closeAlgorithm=a,r2._abortAlgorithm=o;var n=WritableStreamDefaultControllerGetBackpressure(r2);WritableStreamUpdateBackpressure(e,n);var u=t();Promise.resolve(u).then(function(){r2._started=!0,WritableStreamDefaultControllerAdvanceQueueIfNeeded(r2)},function(t2){r2._started=!0,WritableStreamDealWithRejection(e,t2)}).catch(rethrowAssertionErrorRejection)}__name(SetUpWritableStreamDefaultController,"SetUpWritableStreamDefaultController");function SetUpWritableStreamDefaultControllerFromUnderlyingSink(e,r2,t,i){var a=Object.create(WritableStreamDefaultController.prototype),o=CreateAlgorithmFromUnderlyingMethod(r2,"write",1,[a]),l=CreateAlgorithmFromUnderlyingMethod(r2,"close",0,[]),s2=CreateAlgorithmFromUnderlyingMethod(r2,"abort",1,[]);SetUpWritableStreamDefaultController(e,a,__name(function(){return InvokeOrNoop(r2,"start",[a])},"startAlgorithm"),o,l,s2,t,i)}__name(SetUpWritableStreamDefaultControllerFromUnderlyingSink,"SetUpWritableStreamDefaultControllerFromUnderlyingSink");function WritableStreamDefaultControllerClose(e){EnqueueValueWithSize(e,"close",0),WritableStreamDefaultControllerAdvanceQueueIfNeeded(e)}__name(WritableStreamDefaultControllerClose,"WritableStreamDefaultControllerClose");function WritableStreamDefaultControllerGetChunkSize(e,r2){try{return e._strategySizeAlgorithm(r2)}catch(r3){return WritableStreamDefaultControllerErrorIfNeeded(e,r3),1}}__name(WritableStreamDefaultControllerGetChunkSize,"WritableStreamDefaultControllerGetChunkSize");function WritableStreamDefaultControllerGetDesiredSize(e){return e._strategyHWM-e._queueTotalSize}__name(WritableStreamDefaultControllerGetDesiredSize,"WritableStreamDefaultControllerGetDesiredSize");function WritableStreamDefaultControllerWrite(e,r2,t){var i={chunk:r2};try{EnqueueValueWithSize(e,i,t)}catch(r3){return void WritableStreamDefaultControllerErrorIfNeeded(e,r3)}var a=e._controlledWritableStream;WritableStreamCloseQueuedOrInFlight(a)===!1&&a._state==="writable"&&WritableStreamUpdateBackpressure(a,WritableStreamDefaultControllerGetBackpressure(e)),WritableStreamDefaultControllerAdvanceQueueIfNeeded(e)}__name(WritableStreamDefaultControllerWrite,"WritableStreamDefaultControllerWrite");function WritableStreamDefaultControllerAdvanceQueueIfNeeded(e){verbose("WritableStreamDefaultControllerAdvanceQueueIfNeeded()");var r2=e._controlledWritableStream;if(e._started!==!1&&r2._inFlightWriteRequest===void 0){var t=r2._state;if(t!=="closed"&&t!=="errored")if(t!=="erroring"){if(e._queue.length!==0){var i=PeekQueueValue(e);i==="close"?WritableStreamDefaultControllerProcessClose(e):WritableStreamDefaultControllerProcessWrite(e,i.chunk)}}else WritableStreamFinishErroring(r2)}}__name(WritableStreamDefaultControllerAdvanceQueueIfNeeded,"WritableStreamDefaultControllerAdvanceQueueIfNeeded");function WritableStreamDefaultControllerErrorIfNeeded(e,r2){e._controlledWritableStream._state==="writable"&&WritableStreamDefaultControllerError(e,r2)}__name(WritableStreamDefaultControllerErrorIfNeeded,"WritableStreamDefaultControllerErrorIfNeeded");function WritableStreamDefaultControllerProcessClose(e){var r2=e._controlledWritableStream;WritableStreamMarkCloseRequestInFlight(r2),DequeueValue(e),e._closeAlgorithm().then(function(){WritableStreamFinishInFlightClose(r2)},function(e2){WritableStreamFinishInFlightCloseWithError(r2,e2)}).catch(rethrowAssertionErrorRejection)}__name(WritableStreamDefaultControllerProcessClose,"WritableStreamDefaultControllerProcessClose");function WritableStreamDefaultControllerProcessWrite(e,r2){var t=e._controlledWritableStream;WritableStreamMarkFirstWriteRequestInFlight(t),e._writeAlgorithm(r2).then(function(){WritableStreamFinishInFlightWrite(t);var r3=t._state;if(DequeueValue(e),WritableStreamCloseQueuedOrInFlight(t)===!1&&r3==="writable"){var i=WritableStreamDefaultControllerGetBackpressure(e);WritableStreamUpdateBackpressure(t,i)}WritableStreamDefaultControllerAdvanceQueueIfNeeded(e)},function(e2){WritableStreamFinishInFlightWriteWithError(t,e2)}).catch(rethrowAssertionErrorRejection)}__name(WritableStreamDefaultControllerProcessWrite,"WritableStreamDefaultControllerProcessWrite");function WritableStreamDefaultControllerGetBackpressure(e){return WritableStreamDefaultControllerGetDesiredSize(e)<=0}__name(WritableStreamDefaultControllerGetBackpressure,"WritableStreamDefaultControllerGetBackpressure");function WritableStreamDefaultControllerError(e,r2){WritableStreamStartErroring(e._controlledWritableStream,r2)}__name(WritableStreamDefaultControllerError,"WritableStreamDefaultControllerError");function streamBrandCheckException(e){return new TypeError("WritableStream.prototype."+e+" can only be used on a WritableStream")}__name(streamBrandCheckException,"streamBrandCheckException");function defaultWriterBrandCheckException(e){return new TypeError("WritableStreamDefaultWriter.prototype."+e+" can only be used on a WritableStreamDefaultWriter")}__name(defaultWriterBrandCheckException,"defaultWriterBrandCheckException");function defaultWriterLockException(e){return new TypeError("Cannot "+e+" a stream using a released writer")}__name(defaultWriterLockException,"defaultWriterLockException");function defaultWriterClosedPromiseInitialize(e){e._closedPromise=new Promise(function(r2,t){e._closedPromise_resolve=r2,e._closedPromise_reject=t,e._closedPromiseState="pending"})}__name(defaultWriterClosedPromiseInitialize,"defaultWriterClosedPromiseInitialize");function defaultWriterClosedPromiseInitializeAsRejected(e,r2){e._closedPromise=Promise.reject(r2),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected"}__name(defaultWriterClosedPromiseInitializeAsRejected,"defaultWriterClosedPromiseInitializeAsRejected");function defaultWriterClosedPromiseInitializeAsResolved(e){e._closedPromise=Promise.resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved"}__name(defaultWriterClosedPromiseInitializeAsResolved,"defaultWriterClosedPromiseInitializeAsResolved");function defaultWriterClosedPromiseReject(e,r2){e._closedPromise_reject(r2),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected"}__name(defaultWriterClosedPromiseReject,"defaultWriterClosedPromiseReject");function defaultWriterClosedPromiseResetToRejected(e,r2){e._closedPromise=Promise.reject(r2),e._closedPromiseState="rejected"}__name(defaultWriterClosedPromiseResetToRejected,"defaultWriterClosedPromiseResetToRejected");function defaultWriterClosedPromiseResolve(e){e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved"}__name(defaultWriterClosedPromiseResolve,"defaultWriterClosedPromiseResolve");function defaultWriterReadyPromiseInitialize(e){verbose("defaultWriterReadyPromiseInitialize()"),e._readyPromise=new Promise(function(r2,t){e._readyPromise_resolve=r2,e._readyPromise_reject=t}),e._readyPromiseState="pending"}__name(defaultWriterReadyPromiseInitialize,"defaultWriterReadyPromiseInitialize");function defaultWriterReadyPromiseInitializeAsRejected(e,r2){verbose("defaultWriterReadyPromiseInitializeAsRejected(writer, %o)",r2),e._readyPromise=Promise.reject(r2),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected"}__name(defaultWriterReadyPromiseInitializeAsRejected,"defaultWriterReadyPromiseInitializeAsRejected");function defaultWriterReadyPromiseInitializeAsResolved(e){verbose("defaultWriterReadyPromiseInitializeAsResolved()"),e._readyPromise=Promise.resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled"}__name(defaultWriterReadyPromiseInitializeAsResolved,"defaultWriterReadyPromiseInitializeAsResolved");function defaultWriterReadyPromiseReject(e,r2){verbose("defaultWriterReadyPromiseReject(writer, %o)",r2),e._readyPromise_reject(r2),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected"}__name(defaultWriterReadyPromiseReject,"defaultWriterReadyPromiseReject");function defaultWriterReadyPromiseReset(e){verbose("defaultWriterReadyPromiseReset()"),e._readyPromise=new Promise(function(r2,t){e._readyPromise_resolve=r2,e._readyPromise_reject=t}),e._readyPromiseState="pending"}__name(defaultWriterReadyPromiseReset,"defaultWriterReadyPromiseReset");function defaultWriterReadyPromiseResetToRejected(e,r2){verbose("defaultWriterReadyPromiseResetToRejected(writer, %o)",r2),e._readyPromise=Promise.reject(r2),e._readyPromiseState="rejected"}__name(defaultWriterReadyPromiseResetToRejected,"defaultWriterReadyPromiseResetToRejected");function defaultWriterReadyPromiseResolve(e){verbose("defaultWriterReadyPromiseResolve()"),e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled"}__name(defaultWriterReadyPromiseResolve,"defaultWriterReadyPromiseResolve");var _createClass2=function(){function defineProperties(e,r2){for(var t=0;t<r2.length;t++){var i=r2[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return __name(defineProperties,"defineProperties"),function(e,r2,t){return r2&&defineProperties(e.prototype,r2),t&&defineProperties(e,t),e}}();_dereq_("better-assert");var verbose=_dereq_("debug")("streams:writable-stream:verbose"),_require=_dereq_("./helpers.js"),CreateAlgorithmFromUnderlyingMethod=_require.CreateAlgorithmFromUnderlyingMethod,InvokeOrNoop=_require.InvokeOrNoop,ValidateAndNormalizeHighWaterMark=_require.ValidateAndNormalizeHighWaterMark;_require.IsNonNegativeNumber;var MakeSizeAlgorithmFromSizeFunction=_require.MakeSizeAlgorithmFromSizeFunction,typeIsObject=_require.typeIsObject,_require2=_dereq_("./utils.js"),rethrowAssertionErrorRejection=_require2.rethrowAssertionErrorRejection,_require3=_dereq_("./queue-with-sizes.js"),DequeueValue=_require3.DequeueValue,EnqueueValueWithSize=_require3.EnqueueValueWithSize,PeekQueueValue=_require3.PeekQueueValue,ResetQueue=_require3.ResetQueue,AbortSteps=Symbol("[[AbortSteps]]"),ErrorSteps=Symbol("[[ErrorSteps]]"),WritableStream=function(){function WritableStream2(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r2=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r2.size,i=r2.highWaterMark,a=i===void 0?1:i;if(_classCallCheck2(this,WritableStream2),InitializeWritableStream(this),e.type!==void 0)throw new RangeError("Invalid type is specified");var o=MakeSizeAlgorithmFromSizeFunction(t);SetUpWritableStreamDefaultControllerFromUnderlyingSink(this,e,a=ValidateAndNormalizeHighWaterMark(a),o)}return __name(WritableStream2,"WritableStream"),_createClass2(WritableStream2,[{key:"abort",value:__name(function(e){return IsWritableStream(this)===!1?Promise.reject(streamBrandCheckException("abort")):IsWritableStreamLocked(this)===!0?Promise.reject(new TypeError("Cannot abort a stream that already has a writer")):WritableStreamAbort(this,e)},"abort")},{key:"getWriter",value:__name(function(){if(IsWritableStream(this)===!1)throw streamBrandCheckException("getWriter");return AcquireWritableStreamDefaultWriter(this)},"getWriter")},{key:"locked",get:__name(function(){if(IsWritableStream(this)===!1)throw streamBrandCheckException("locked");return IsWritableStreamLocked(this)},"get")}]),WritableStream2}();module2.exports={AcquireWritableStreamDefaultWriter,CreateWritableStream,IsWritableStream,IsWritableStreamLocked,WritableStream,WritableStreamAbort,WritableStreamDefaultControllerErrorIfNeeded,WritableStreamDefaultWriterCloseWithErrorPropagation,WritableStreamDefaultWriterRelease,WritableStreamDefaultWriterWrite,WritableStreamCloseQueuedOrInFlight};var WritableStreamDefaultWriter=function(){function WritableStreamDefaultWriter2(e){if(_classCallCheck2(this,WritableStreamDefaultWriter2),IsWritableStream(e)===!1)throw new TypeError("WritableStreamDefaultWriter can only be constructed with a WritableStream instance");if(IsWritableStreamLocked(e)===!0)throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;var r2=e._state;if(r2==="writable")WritableStreamCloseQueuedOrInFlight(e)===!1&&e._backpressure===!0?defaultWriterReadyPromiseInitialize(this):defaultWriterReadyPromiseInitializeAsResolved(this),defaultWriterClosedPromiseInitialize(this);else if(r2==="erroring")defaultWriterReadyPromiseInitializeAsRejected(this,e._storedError),this._readyPromise.catch(function(){}),defaultWriterClosedPromiseInitialize(this);else if(r2==="closed")defaultWriterReadyPromiseInitializeAsResolved(this),defaultWriterClosedPromiseInitializeAsResolved(this);else{var t=e._storedError;defaultWriterReadyPromiseInitializeAsRejected(this,t),this._readyPromise.catch(function(){}),defaultWriterClosedPromiseInitializeAsRejected(this,t),this._closedPromise.catch(function(){})}}return __name(WritableStreamDefaultWriter2,"WritableStreamDefaultWriter"),_createClass2(WritableStreamDefaultWriter2,[{key:"abort",value:__name(function(e){return IsWritableStreamDefaultWriter(this)===!1?Promise.reject(defaultWriterBrandCheckException("abort")):this._ownerWritableStream===void 0?Promise.reject(defaultWriterLockException("abort")):WritableStreamDefaultWriterAbort(this,e)},"abort")},{key:"close",value:__name(function(){if(IsWritableStreamDefaultWriter(this)===!1)return Promise.reject(defaultWriterBrandCheckException("close"));var e=this._ownerWritableStream;return e===void 0?Promise.reject(defaultWriterLockException("close")):WritableStreamCloseQueuedOrInFlight(e)===!0?Promise.reject(new TypeError("cannot close an already-closing stream")):WritableStreamDefaultWriterClose(this)},"close")},{key:"releaseLock",value:__name(function(){if(IsWritableStreamDefaultWriter(this)===!1)throw defaultWriterBrandCheckException("releaseLock");this._ownerWritableStream!==void 0&&WritableStreamDefaultWriterRelease(this)},"releaseLock")},{key:"write",value:__name(function(e){return IsWritableStreamDefaultWriter(this)===!1?Promise.reject(defaultWriterBrandCheckException("write")):this._ownerWritableStream===void 0?Promise.reject(defaultWriterLockException("write to")):WritableStreamDefaultWriterWrite(this,e)},"write")},{key:"closed",get:__name(function(){return IsWritableStreamDefaultWriter(this)===!1?Promise.reject(defaultWriterBrandCheckException("closed")):this._closedPromise},"get")},{key:"desiredSize",get:__name(function(){if(IsWritableStreamDefaultWriter(this)===!1)throw defaultWriterBrandCheckException("desiredSize");if(this._ownerWritableStream===void 0)throw defaultWriterLockException("desiredSize");return WritableStreamDefaultWriterGetDesiredSize(this)},"get")},{key:"ready",get:__name(function(){return IsWritableStreamDefaultWriter(this)===!1?Promise.reject(defaultWriterBrandCheckException("ready")):this._readyPromise},"get")}]),WritableStreamDefaultWriter2}(),WritableStreamDefaultController=function(){function WritableStreamDefaultController2(){throw _classCallCheck2(this,WritableStreamDefaultController2),new TypeError("WritableStreamDefaultController cannot be constructed explicitly")}return __name(WritableStreamDefaultController2,"WritableStreamDefaultController"),_createClass2(WritableStreamDefaultController2,[{key:"error",value:__name(function(e){if(IsWritableStreamDefaultController(this)===!1)throw new TypeError("WritableStreamDefaultController.prototype.error can only be used on a WritableStreamDefaultController");this._controlledWritableStream._state==="writable"&&WritableStreamDefaultControllerError(this,e)},"error")},{key:AbortSteps,value:__name(function(e){return this._abortAlgorithm(e)},"value")},{key:ErrorSteps,value:__name(function(){ResetQueue(this)},"value")}]),WritableStreamDefaultController2}()},{"./helpers.js":10,"./queue-with-sizes.js":11,"./utils.js":14,"better-assert":16,debug:18}],16:[function(_dereq_,module2,exports2){(function(process2){function assert2(e){if(!e){var r2=callsite(),s2=r2[1],t=s2.getFileName(),i=s2.getLineNumber(),n=(n=fs.readFileSync(t,"utf8")).split(`
`)[i-1].match(/assert\((.*)\)/)[1];throw new AssertionError({message:n,stackStartFunction:r2[0].getFunction()})}}__name(assert2,"assert");var AssertionError=_dereq_("assert").AssertionError,callsite=_dereq_("callsite"),fs=_dereq_("fs");module2.exports={}.NO_ASSERT?function(){}:assert2}).call(this,_dereq_("_process"))},{_process:4,assert:2,callsite:17,fs:3}],17:[function(_dereq_,module2,exports2){module2.exports=function(){var r2=Error.prepareStackTrace;Error.prepareStackTrace=function(r3,e2){return e2};var e=new Error;Error.captureStackTrace(e,arguments.callee);var a=e.stack;return Error.prepareStackTrace=r2,a}},{}],18:[function(_dereq_,module2,exports2){(function(process2){function useColors(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer")||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}__name(useColors,"useColors");function formatArgs(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+exports2.humanize(this.diff),o){var C2="color: "+this.color;e.splice(1,0,C2,"color: inherit");var t=0,r2=0;e[0].replace(/%[a-zA-Z%]/g,function(e2){e2!=="%%"&&(t++,e2==="%c"&&(r2=t))}),e.splice(r2,0,C2)}}__name(formatArgs,"formatArgs");function log(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}__name(log,"log");function save(e){try{e==null?exports2.storage.removeItem("debug"):exports2.storage.debug=e}catch{}}__name(save,"save");function load(){var e;try{e=exports2.storage.debug}catch{}return!e&&typeof process2<"u"&&"env"in process2&&(e={}.DEBUG),e}__name(load,"load");function localstorage(){try{return window.localStorage}catch{}}__name(localstorage,"localstorage"),exports2=module2.exports=_dereq_("./debug"),exports2.log=log,exports2.formatArgs=formatArgs,exports2.save=save,exports2.load=load,exports2.useColors=useColors,exports2.storage=typeof chrome<"u"&&chrome.storage!==void 0?chrome.storage.local:localstorage(),exports2.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports2.formatters.j=function(e){try{return JSON.stringify(e)}catch(e2){return"[UnexpectedJSONParseError]: "+e2.message}},exports2.enable(load())}).call(this,_dereq_("_process"))},{"./debug":19,_process:4}],19:[function(_dereq_,module2,exports2){function selectColor(e){var r2,t=0;for(r2 in e)t=(t<<5)-t+e.charCodeAt(r2),t|=0;return exports2.colors[Math.abs(t)%exports2.colors.length]}__name(selectColor,"selectColor");function createDebug(e){function debug(){if(debug.enabled){var e2=debug,t=+new Date,s2=t-(r2||t);e2.diff=s2,e2.prev=r2,e2.curr=t,r2=t;for(var o=new Array(arguments.length),n=0;n<o.length;n++)o[n]=arguments[n];o[0]=exports2.coerce(o[0]),typeof o[0]!="string"&&o.unshift("%O");var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(r3,t2){if(r3==="%%")return r3;a++;var s3=exports2.formatters[t2];if(typeof s3=="function"){var n2=o[a];r3=s3.call(e2,n2),o.splice(a,1),a--}return r3}),exports2.formatArgs.call(e2,o),(debug.log||exports2.log||console.log.bind(console)).apply(e2,o)}}__name(debug,"debug");var r2;return debug.namespace=e,debug.enabled=exports2.enabled(e),debug.useColors=exports2.useColors(),debug.color=selectColor(e),debug.destroy=destroy,typeof exports2.init=="function"&&exports2.init(debug),exports2.instances.push(debug),debug}__name(createDebug,"createDebug");function destroy(){var e=exports2.instances.indexOf(this);return e!==-1&&(exports2.instances.splice(e,1),!0)}__name(destroy,"destroy");function enable(e){exports2.save(e),exports2.names=[],exports2.skips=[];var r2,t=(typeof e=="string"?e:"").split(/[\s,]+/),s2=t.length;for(r2=0;r2<s2;r2++)t[r2]&&((e=t[r2].replace(/\*/g,".*?"))[0]==="-"?exports2.skips.push(new RegExp("^"+e.substr(1)+"$")):exports2.names.push(new RegExp("^"+e+"$")));for(r2=0;r2<exports2.instances.length;r2++){var o=exports2.instances[r2];o.enabled=exports2.enabled(o.namespace)}}__name(enable,"enable");function disable(){exports2.enable("")}__name(disable,"disable");function enabled(e){if(e[e.length-1]==="*")return!0;var r2,t;for(r2=0,t=exports2.skips.length;r2<t;r2++)if(exports2.skips[r2].test(e))return!1;for(r2=0,t=exports2.names.length;r2<t;r2++)if(exports2.names[r2].test(e))return!0;return!1}__name(enabled,"enabled");function coerce(e){return e instanceof Error?e.stack||e.message:e}__name(coerce,"coerce"),exports2=module2.exports=createDebug.debug=createDebug.default=createDebug,exports2.coerce=coerce,exports2.disable=disable,exports2.enable=enable,exports2.enabled=enabled,exports2.humanize=_dereq_("ms"),exports2.instances=[],exports2.names=[],exports2.skips=[],exports2.formatters={}},{ms:20}],20:[function(_dereq_,module2,exports2){function parse3(e){if(!((e=String(e)).length>100)){var r2=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(r2){var a=parseFloat(r2[1]);switch((r2[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*y;case"days":case"day":case"d":return a*d;case"hours":case"hour":case"hrs":case"hr":case"h":return a*h;case"minutes":case"minute":case"mins":case"min":case"m":return a*m;case"seconds":case"second":case"secs":case"sec":case"s":return a*s2;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}__name(parse3,"parse");function fmtShort(e){return e>=d?Math.round(e/d)+"d":e>=h?Math.round(e/h)+"h":e>=m?Math.round(e/m)+"m":e>=s2?Math.round(e/s2)+"s":e+"ms"}__name(fmtShort,"fmtShort");function fmtLong(e){return plural(e,d,"day")||plural(e,h,"hour")||plural(e,m,"minute")||plural(e,s2,"second")||e+" ms"}__name(fmtLong,"fmtLong");function plural(s3,e,r2){if(!(s3<e))return s3<1.5*e?Math.floor(s3/e)+" "+r2:Math.ceil(s3/e)+" "+r2+"s"}__name(plural,"plural");var s2=1e3,m=60*s2,h=60*m,d=24*h,y=365.25*d;module2.exports=function(s3,e){e=e||{};var r2=typeof s3;if(r2==="string"&&s3.length>0)return parse3(s3);if(r2==="number"&&isNaN(s3)===!1)return e.long?fmtLong(s3):fmtShort(s3);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s3))}},{}]},{},[1])(1)})}(polyfillIe11_min)),polyfillIe11_min.exports}__name(requirePolyfillIe11_min,"requirePolyfillIe11_min");var readableStreamNodeToWeb={exports:{}};(function(module){module.exports=nodeToWeb,module.exports.WEBSTREAM_SUPPORT=typeof ReadableStream<"u";function nodeToWeb(nodeStream){if(!module.exports.WEBSTREAM_SUPPORT)throw new Error("No web ReadableStream support");var destroyed=!1,listeners={};function start(controller){listeners.data=onData,listeners.end=onData,listeners.end=onDestroy,listeners.close=onDestroy,listeners.error=onDestroy;for(var name in listeners)nodeStream.on(name,listeners[name]);nodeStream.pause();function onData(chunk){destroyed||(controller.enqueue(chunk),nodeStream.pause())}__name(onData,"onData");function onDestroy(err){if(!destroyed){destroyed=!0;for(var name2 in listeners)nodeStream.removeListener(name2,listeners[name2]);err?controller.error(err):controller.close()}}__name(onDestroy,"onDestroy")}__name(start,"start");function pull(){destroyed||nodeStream.resume()}__name(pull,"pull");function cancel(){destroyed=!0;for(var name in listeners)nodeStream.removeListener(name,listeners[name]);nodeStream.push(null),nodeStream.pause(),nodeStream.destroy?nodeStream.destroy():nodeStream.close&&nodeStream.close()}return __name(cancel,"cancel"),new ReadableStream({start,pull,cancel})}__name(nodeToWeb,"nodeToWeb")})(readableStreamNodeToWeb);var readableStreamNodeToWebExports=readableStreamNodeToWeb.exports;Object.defineProperty(ActorHttp$1,"__esModule",{value:!0});ActorHttp$1.ActorHttp=void 0;const core_1$h=lib$2A,readable_web_to_node_stream_1$3=lib$2C;globalThis.ReadableStream||(globalThis.ReadableStream=requirePolyfillIe11_min().ReadableStream);const isStream$3=isStream_1,toWebReadableStream=readableStreamNodeToWebExports;class ActorHttp extends core_1$h.Actor{constructor(args){super(args)}static toNodeReadable(body){return isStream$3(body)||body===null?body:new readable_web_to_node_stream_1$3.ReadableWebToNodeStream(body)}static toWebReadableStream(body){return toWebReadableStream(body)}static headersToHash(headers){const hash2={};return headers.forEach((value,key)=>{hash2[key]=value}),hash2}}__name(ActorHttp,"ActorHttp");ActorHttp$1.ActorHttp=ActorHttp;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorHttp$1,exports)})(lib$1Y);var FetchInitPreprocessorBrowser={};Object.defineProperty(FetchInitPreprocessorBrowser,"__esModule",{value:!0});FetchInitPreprocessorBrowser.FetchInitPreprocessor=void 0;const bus_http_1$8=lib$1Y;class FetchInitPreprocessor{async handle(init2){if(init2.headers){const headers=new Headers(init2.headers);headers.has("user-agent")&&headers.delete("user-agent"),init2.headers=headers}if(init2!=null&&init2.headers&&"append"in init2.headers&&(init2.headers=bus_http_1$8.ActorHttp.headersToHash(init2.headers)),init2.body&&typeof init2.body!="string"&&"getReader"in init2.body){const reader=init2.body.getReader(),chunks=[];for(;;){const{done,value}=await reader.read();if(done)break;chunks.push(value)}init2.body=chunks.join("")}return{keepalive:!init2.body,...init2}}async createAbortController(){return new AbortController}}__name(FetchInitPreprocessor,"FetchInitPreprocessor");FetchInitPreprocessorBrowser.FetchInitPreprocessor=FetchInitPreprocessor;Object.defineProperty(ActorHttpFetch$1,"__esModule",{value:!0});ActorHttpFetch$1.ActorHttpFetch=void 0;const bus_http_1$7=lib$1Y,context_entries_1$l=lib$2x,FetchInitPreprocessor_1=FetchInitPreprocessorBrowser;class ActorHttpFetch extends bus_http_1$7.ActorHttp{constructor(args){super(args),this.userAgent=ActorHttpFetch.createUserAgent(),this.fetchInitPreprocessor=new FetchInitPreprocessor_1.FetchInitPreprocessor(args.agentOptions)}static createUserAgent(){return`Comunica/actor-http-fetch (${typeof globalThis.navigator>"u"?`Node.js ${process.version}; ${process.platform}`:`Browser-${globalThis.navigator.userAgent}`})`}async test(action){return{time:Number.POSITIVE_INFINITY}}static async getResponse(fetchFn,requestInput,requestInit,retryCount,retryDelay,throwOnServerError){var _a2;let lastError,triesLeft=retryCount+1;for(;triesLeft-- >0;)try{const response=await fetchFn(requestInput,requestInit);if(throwOnServerError&&response.status>=500&&response.status<600)throw new Error(`Server replied with response code ${response.status}: ${response.statusText}`);return response}catch(error){if(lastError=error,(_a2=requestInit.signal)!=null&&_a2.aborted)throw error;triesLeft>0&&await new Promise((resolve2,reject)=>{var _a3;setTimeout(resolve2,retryDelay),(_a3=requestInit.signal)==null||_a3.addEventListener("abort",()=>{reject(new Error("Fetch aborted by timeout."))})})}throw retryCount>0?new Error(`Number of fetch retries (${retryCount}) exceeded. Last error: ${String(lastError)}`):lastError}async run(action){var _a2,_b,_c,_d,_e,_f,_g,_h;const initHeaders=((_a2=action.init)==null?void 0:_a2.headers)??{};action.init=action.init??{},action.init.headers=new Headers(initHeaders),action.init.headers.has("user-agent")||action.init.headers.append("user-agent",this.userAgent);const authString=action.context.get(context_entries_1$l.KeysHttp.auth);authString&&action.init.headers.append("Authorization",`Basic ${Buffer.from(authString).toString("base64")}`),this.logInfo(action.context,`Requesting ${typeof action.input=="string"?action.input:action.input.url}`,()=>({headers:bus_http_1$7.ActorHttp.headersToHash(new Headers(action.init.headers)),method:action.init.method||"GET"})),(_b=action.init)!=null&&_b.headers&&"append"in action.init.headers&&action.context.has(context_entries_1$l.KeysHttp.fetch)&&(action.init.headers=bus_http_1$7.ActorHttp.headersToHash(action.init.headers));let requestInit={...action.init};action.context.get(context_entries_1$l.KeysHttp.includeCredentials)&&(requestInit.credentials="include");const httpTimeout=(_c=action.context)==null?void 0:_c.get(context_entries_1$l.KeysHttp.httpTimeout);let requestTimeout,onTimeout;if(httpTimeout!==void 0){const controller=await this.fetchInitPreprocessor.createAbortController();requestInit.signal=controller.signal,onTimeout=__name(()=>controller.abort(),"onTimeout"),requestTimeout=setTimeout(()=>onTimeout(),httpTimeout)}try{requestInit=await this.fetchInitPreprocessor.handle(requestInit);const retryCount=((_d=action.context)==null?void 0:_d.get(context_entries_1$l.KeysHttp.httpRetryCount))??0,retryDelay=((_e=action.context)==null?void 0:_e.get(context_entries_1$l.KeysHttp.httpRetryDelay))??0,retryOnSeverError=((_f=action.context)==null?void 0:_f.get(context_entries_1$l.KeysHttp.httpRetryOnServerError))??!1,customFetch=(_g=action.context)==null?void 0:_g.get(context_entries_1$l.KeysHttp.fetch),response=await ActorHttpFetch.getResponse(customFetch||fetch,action.input,requestInit,retryCount,retryDelay,retryOnSeverError);return requestTimeout!==void 0&&((((_h=action.context)==null?void 0:_h.get(context_entries_1$l.KeysHttp.httpBodyTimeout))||!1)&&response.body?(onTimeout=__name(()=>{var _a3;return(_a3=response.body)==null?void 0:_a3.cancel(new Error(`HTTP timeout when reading the body of ${response.url}.
This error can be disabled by modifying the 'httpBodyTimeout' and/or 'httpTimeout' options.`))},"onTimeout"),response.body.on("close",()=>{clearTimeout(requestTimeout)})):clearTimeout(requestTimeout)),response.body&&!response.body.cancel&&(response.body.cancel=async error=>{response.body.destroy(error),requestTimeout!==void 0&&clearTimeout(requestTimeout)}),response}catch(error){throw requestTimeout!==void 0&&clearTimeout(requestTimeout),error}}}__name(ActorHttpFetch,"ActorHttpFetch");ActorHttpFetch$1.ActorHttpFetch=ActorHttpFetch;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorHttpFetch$1,exports)})(lib$1Z);var lib$1X={},ActorDereferenceFallback$1={},lib$1W={},ActorDereference$1={},ActorDereferenceBase$1={};Object.defineProperty(ActorDereferenceBase$1,"__esModule",{value:!0});ActorDereferenceBase$1.ActorDereferenceBase=ActorDereferenceBase$1.isHardError=ActorDereferenceBase$1.emptyReadable=void 0;const context_entries_1$k=lib$2x,core_1$g=lib$2A,readable_stream_1$f=browserExports$1;function emptyReadable(){const data=new readable_stream_1$f.Readable;return data.push(null),data}__name(emptyReadable,"emptyReadable");ActorDereferenceBase$1.emptyReadable=emptyReadable;function isHardError(context2){return!context2.get(context_entries_1$k.KeysInitQuery.lenient)}__name(isHardError,"isHardError");ActorDereferenceBase$1.isHardError=isHardError;class ActorDereferenceBase extends core_1$g.Actor{constructor(args){super(args)}async dereferenceErrorHandler(action,error,output){if(isHardError(action.context))throw error;return this.logError(action.context,error.message),{...output,data:emptyReadable()}}}__name(ActorDereferenceBase,"ActorDereferenceBase");ActorDereferenceBase$1.ActorDereferenceBase=ActorDereferenceBase;Object.defineProperty(ActorDereference$1,"__esModule",{value:!0});ActorDereference$1.ActorDereference=void 0;const ActorDereferenceBase_1$1=ActorDereferenceBase$1;class ActorDereference extends ActorDereferenceBase_1$1.ActorDereferenceBase{constructor(args){super(args)}async handleDereferenceErrors(action,error,headers,requestTime=0){return this.dereferenceErrorHandler(action,error,{url:action.url,exists:!1,headers,requestTime})}}__name(ActorDereference,"ActorDereference");ActorDereference$1.ActorDereference=ActorDereference;var ActorDereferenceParse$1={};Object.defineProperty(ActorDereferenceParse$1,"__esModule",{value:!0});ActorDereferenceParse$1.ActorDereferenceParse=ActorDereferenceParse$1.getMediaTypeFromExtension=void 0;const readable_stream_1$e=browserExports$1,ActorDereferenceBase_1=ActorDereferenceBase$1;function getMediaTypeFromExtension(path,mediaMappings){const dotIndex=path.lastIndexOf(".");return dotIndex>=0&&(mediaMappings==null?void 0:mediaMappings[path.slice(dotIndex+1)])||""}__name(getMediaTypeFromExtension,"getMediaTypeFromExtension");ActorDereferenceParse$1.getMediaTypeFromExtension=getMediaTypeFromExtension;class ActorDereferenceParse extends ActorDereferenceBase_1.ActorDereferenceBase{constructor(args){super(args)}async test(action){return!0}handleDereferenceStreamErrors(action,data){return(0,ActorDereferenceBase_1.isHardError)(action.context)||(data.on("error",error=>{this.logError(action.context,error.message,()=>({url:action.url})),data.push(null)}),data=data.pipe(new readable_stream_1$e.PassThrough({objectMode:!0}))),data}async run(action){var _a2,_b;const{context:context2}=action,dereference=await this.mediatorDereference.mediate({...action,mediaTypes:async()=>{var _a3,_b2;return(_b2=await((_a3=this.mediatorParseMediatypes)==null?void 0:_a3.mediate({context:context2,mediaTypes:!0})))==null?void 0:_b2.mediaTypes}});let result;try{result=(await this.mediatorParse.mediate({context:context2,handle:{context:context2,...dereference,metadata:await this.getMetadata(dereference)},handleMediaType:dereference.mediaType||getMediaTypeFromExtension(dereference.url,this.mediaMappings)||action.mediaType})).handle,result.data=this.handleDereferenceStreamErrors(action,result.data)}catch(error){await((_b=(_a2=dereference.data).close)==null?void 0:_b.call(_a2)),result=await this.dereferenceErrorHandler(action,error,{})}return{...dereference,...result}}}__name(ActorDereferenceParse,"ActorDereferenceParse");ActorDereferenceParse$1.ActorDereferenceParse=ActorDereferenceParse;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorDereference$1,exports),__exportStar(ActorDereferenceParse$1,exports),__exportStar(ActorDereferenceBase$1,exports)})(lib$1W);Object.defineProperty(ActorDereferenceFallback$1,"__esModule",{value:!0});ActorDereferenceFallback$1.ActorDereferenceFallback=void 0;const bus_dereference_1$2=lib$1W;class ActorDereferenceFallback extends bus_dereference_1$2.ActorDereference{constructor(args){super(args)}async test(action){return!0}async run(action){return this.handleDereferenceErrors(action,new Error(`Could not dereference '${action.url}'`))}}__name(ActorDereferenceFallback,"ActorDereferenceFallback");ActorDereferenceFallback$1.ActorDereferenceFallback=ActorDereferenceFallback;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorDereferenceFallback$1,exports)})(lib$1X);var lib$1V={},ActorRdfParseN3$1={},lib$1U={},ActorRdfParse$1={};Object.defineProperty(ActorRdfParse$1,"__esModule",{value:!0});ActorRdfParse$1.ActorRdfParse=void 0;const actor_abstract_mediatyped_1$1=lib$2a;class ActorRdfParse extends actor_abstract_mediatyped_1$1.ActorAbstractMediaTyped{constructor(args){super(args)}}__name(ActorRdfParse,"ActorRdfParse");ActorRdfParse$1.ActorRdfParse=ActorRdfParse;var ActorRdfParseFixedMediaTypes$1={};Object.defineProperty(ActorRdfParseFixedMediaTypes$1,"__esModule",{value:!0});ActorRdfParseFixedMediaTypes$1.ActorRdfParseFixedMediaTypes=void 0;const actor_abstract_mediatyped_1=lib$2a;class ActorRdfParseFixedMediaTypes extends actor_abstract_mediatyped_1.ActorAbstractMediaTypedFixed{constructor(args){super(args)}async testHandleChecked(action){return!0}}__name(ActorRdfParseFixedMediaTypes,"ActorRdfParseFixedMediaTypes");ActorRdfParseFixedMediaTypes$1.ActorRdfParseFixedMediaTypes=ActorRdfParseFixedMediaTypes;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParse$1,exports),__exportStar(ActorRdfParseFixedMediaTypes$1,exports)})(lib$1U);Object.defineProperty(ActorRdfParseN3$1,"__esModule",{value:!0});ActorRdfParseN3$1.ActorRdfParseN3=void 0;const bus_rdf_parse_1$5=lib$1U,n3_1$1=require$$0$3;class ActorRdfParseN3 extends bus_rdf_parse_1$5.ActorRdfParseFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){var _a2;action.data.on("error",error=>data.emit("error",error));const data=action.data.pipe(new n3_1$1.StreamParser({baseIRI:(_a2=action.metadata)==null?void 0:_a2.baseIRI,format:mediaType.endsWith("n3")?mediaType:`${mediaType}*`}));return{data,metadata:{triples:mediaType==="text/turtle"||mediaType==="application/n-triples"||mediaType==="text/n3"}}}}__name(ActorRdfParseN3,"ActorRdfParseN3");ActorRdfParseN3$1.ActorRdfParseN3=ActorRdfParseN3;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseN3$1,exports)})(lib$1V);var lib$1T={},ActorRdfParseRdfXml$1={},rdfxmlStreamingParser={},RdfXmlParser$1={},ParseError$2={};Object.defineProperty(ParseError$2,"__esModule",{value:!0});ParseError$2.ParseError=void 0;let ParseError$1=__name(class extends Error{constructor(parser,message){const saxParser=parser.saxParser;super(parser.trackPosition?`Line ${saxParser.line} column ${saxParser.column+1}: ${message}`:message)}},"ParseError");ParseError$2.ParseError=ParseError$1;var validateIri={},Validate={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateIri=exports.IriValidationStrategy=void 0;function buildAbsoluteIriRfc3987Regex(){const sub_delims="[!$&'()*+,;=]",pct_encoded="%[a-fA-F0-9]{2}",dec_octet="([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",ipv4address=`${dec_octet}\\.${dec_octet}\\.${dec_octet}\\.${dec_octet}`,h16="[a-fA-F0-9]{1,4}",ls32=`(${h16}:${h16}|${ipv4address})`,ipv6address=`((${h16}:){6}${ls32}|::(${h16}:){5}${ls32}|(${h16})?::(${h16}:){4}${ls32}|((${h16}:){0,1}${h16})?::(${h16}:){3}${ls32}|((${h16}:){0,2}${h16})?::(${h16}:){2}${ls32}|((${h16}:){0,3}${h16})?::${h16}:${ls32}|((${h16}:){0,4}${h16})?::${ls32}|((${h16}:){0,5}${h16})?::${h16}|((${h16}:){0,6}${h16})?::)`,ipvfuture=`v[a-fA-F0-9]+\\.(${sub_delims}|${sub_delims}|":)+`,ip_literal=`\\[(${ipv6address}|${ipvfuture})\\]`,port="[0-9]*",scheme="[a-zA-Z][a-zA-Z0-9+\\-.]*",iprivate="[---]",iunreserved="[a-zA-Z0-9\\-._~-----------------]",ipchar=`(${iunreserved}|${pct_encoded}|${sub_delims}|[:@])*`,ifragment=`(${ipchar}|[\\/?])*`,iquery=`(${ipchar}|${iprivate}|[\\/?])*`,isegment_nz=`(${ipchar})+`,isegment=`(${ipchar})*`,ipath_empty="",ipath_rootless=`${isegment_nz}(\\/${isegment})*`,ipath_absolute=`\\/(${isegment_nz}(\\/${isegment})*)?`,ipath_abempty=`(\\/${isegment})*`,ireg_name=`(${iunreserved}|${pct_encoded}|${sub_delims})*`,ihost=`(${ip_literal}|${ipv4address}|${ireg_name})`,ihier_part=`(\\/\\/${`(${`(${iunreserved}|${pct_encoded}|${sub_delims}|:)*`}@)?${ihost}(:${port})?`}${ipath_abempty}|${ipath_absolute}|${ipath_rootless}|${ipath_empty})`,iri=`^${scheme}:${ihier_part}(\\?${iquery})?(#${ifragment})?$`;return new RegExp(iri,"u")}__name(buildAbsoluteIriRfc3987Regex,"buildAbsoluteIriRfc3987Regex");const STRICT_IRI_REGEX=buildAbsoluteIriRfc3987Regex(),PRAGMATIC_IRI_REGEX=/^[A-Za-z][\d+-.A-Za-z]*:[^\u0000-\u0020"<>\\^`{|}]*$/u;var IriValidationStrategy;(function(IriValidationStrategy2){IriValidationStrategy2.Strict="strict",IriValidationStrategy2.Pragmatic="pragmatic",IriValidationStrategy2.None="none"})(IriValidationStrategy=exports.IriValidationStrategy||(exports.IriValidationStrategy={}));function validateIri2(iri,strategy=IriValidationStrategy.Strict){switch(strategy){case IriValidationStrategy.Strict:return STRICT_IRI_REGEX.test(iri)?void 0:new Error(`Invalid IRI according to RFC 3987: '${iri}'`);case IriValidationStrategy.Pragmatic:return PRAGMATIC_IRI_REGEX.test(iri)?void 0:new Error(`Invalid IRI according to RDF Turtle: '${iri}'`);case IriValidationStrategy.None:return;default:return new Error(`Not supported validation strategy "${strategy}"`)}}__name(validateIri2,"validateIri"),exports.validateIri=validateIri2})(Validate);(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(Validate,exports)})(validateIri);Object.defineProperty(RdfXmlParser$1,"__esModule",{value:!0});RdfXmlParser$1.ParseType=RdfXmlParser$1.RdfXmlParser=void 0;const relative_to_absolute_iri_1$7=relativeToAbsoluteIri,saxes_1=saxes,readable_stream_1$d=browserExports$1,ParseError_1=ParseError$2,rdf_data_factory_1$s=rdfDataFactory,validate_iri_1=validateIri;class RdfXmlParser extends readable_stream_1$d.Transform{constructor(args){super({readableObjectMode:!0}),this.activeTagStack=[],this.nodeIds={},args&&(Object.assign(this,args),this.options=args),this.dataFactory||(this.dataFactory=new rdf_data_factory_1$s.DataFactory),this.baseIRI||(this.baseIRI=""),this.defaultGraph||(this.defaultGraph=this.dataFactory.defaultGraph()),this.validateUri!==!1&&(this.validateUri=!0),this.iriValidationStrategy||(this.iriValidationStrategy=this.validateUri?validate_iri_1.IriValidationStrategy.Pragmatic:validate_iri_1.IriValidationStrategy.None),this.saxParser=new saxes_1.SaxesParser({xmlns:!0,position:this.trackPosition}),this.attachSaxListeners()}import(stream){const output=new readable_stream_1$d.PassThrough({readableObjectMode:!0});stream.on("error",error=>parsed.emit("error",error)),stream.on("data",data=>output.push(data)),stream.on("end",()=>output.push(null));const parsed=output.pipe(new RdfXmlParser(this.options));return parsed}_transform(chunk,encoding,callback){try{this.saxParser.write(chunk)}catch(e){return callback(e)}callback()}newParseError(message){return new ParseError_1.ParseError(this,message)}valueToUri(value,activeTag){return this.uriToNamedNode((0,relative_to_absolute_iri_1$7.resolve)(value,activeTag.baseIRI))}uriToNamedNode(uri){const uriValidationResult=(0,validate_iri_1.validateIri)(uri,this.iriValidationStrategy);if(uriValidationResult instanceof Error)throw this.newParseError(uriValidationResult.message);return this.dataFactory.namedNode(uri)}validateNcname(value){if(!RdfXmlParser.NCNAME_MATCHER.test(value))throw this.newParseError(`Not a valid NCName: ${value}`)}attachSaxListeners(){this.saxParser.on("error",error=>this.emit("error",error)),this.saxParser.on("opentag",this.onTag.bind(this)),this.saxParser.on("text",this.onText.bind(this)),this.saxParser.on("closetag",this.onCloseTag.bind(this)),this.saxParser.on("doctype",this.onDoctype.bind(this))}onTag(tag){const parentTag=this.activeTagStack.length?this.activeTagStack[this.activeTagStack.length-1]:null;let currentParseType=ParseType.RESOURCE;if(parentTag&&(parentTag.hadChildren=!0,currentParseType=parentTag.childrenParseType),parentTag&&parentTag.childrenStringTags){const tagName=tag.name;let attributes="";for(const attributeKey in tag.attributes)attributes+=` ${attributeKey}="${tag.attributes[attributeKey].value}"`;const tagString=`<${`${tagName}${attributes}`}>`;parentTag.childrenStringTags.push(tagString);const stringActiveTag={childrenStringTags:parentTag.childrenStringTags};stringActiveTag.childrenStringEmitClosingTag=`</${tagName}>`,this.activeTagStack.push(stringActiveTag);return}const activeTag={};parentTag?(activeTag.language=parentTag.language,activeTag.baseIRI=parentTag.baseIRI):activeTag.baseIRI=this.baseIRI,this.activeTagStack.push(activeTag),currentParseType===ParseType.RESOURCE?this.onTagResource(tag,activeTag,parentTag,!parentTag):this.onTagProperty(tag,activeTag,parentTag)}onTagResource(tag,activeTag,parentTag,rootTag){activeTag.childrenParseType=ParseType.PROPERTY;let typedNode=!0;if(tag.uri===RdfXmlParser.RDF){if(!rootTag&&RdfXmlParser.FORBIDDEN_NODE_ELEMENTS.indexOf(tag.local)>=0)throw this.newParseError(`Illegal node element name: ${tag.local}`);switch(tag.local){case"RDF":activeTag.childrenParseType=ParseType.RESOURCE;case"Description":typedNode=!1}}const predicates=[],objects=[];let activeSubjectValue=null,claimSubjectNodeId=!1,subjectValueBlank=!1,explicitType=null;for(const attributeKey in tag.attributes){const attribute=tag.attributes[attributeKey];if(parentTag&&attribute.uri===RdfXmlParser.RDF)switch(attribute.local){case"about":if(activeSubjectValue)throw this.newParseError(`Only one of rdf:about, rdf:nodeID and rdf:ID can be present, while ${attribute.value} and ${activeSubjectValue} where found.`);activeSubjectValue=attribute.value;continue;case"ID":if(activeSubjectValue)throw this.newParseError(`Only one of rdf:about, rdf:nodeID and rdf:ID can be present, while ${attribute.value} and ${activeSubjectValue} where found.`);this.validateNcname(attribute.value),activeSubjectValue="#"+attribute.value,claimSubjectNodeId=!0;continue;case"nodeID":if(activeSubjectValue)throw this.newParseError(`Only one of rdf:about, rdf:nodeID and rdf:ID can be present, while ${attribute.value} and ${activeSubjectValue} where found.`);this.validateNcname(attribute.value),activeSubjectValue=attribute.value,subjectValueBlank=!0;continue;case"bagID":throw this.newParseError("rdf:bagID is not supported.");case"type":explicitType=attribute.value;continue;case"aboutEach":throw this.newParseError("rdf:aboutEach is not supported.");case"aboutEachPrefix":throw this.newParseError("rdf:aboutEachPrefix is not supported.");case"li":throw this.newParseError("rdf:li on node elements are not supported.")}else if(attribute.uri===RdfXmlParser.XML){if(attribute.local==="lang"){activeTag.language=attribute.value===""?null:attribute.value.toLowerCase();continue}else if(attribute.local==="base"){activeTag.baseIRI=(0,relative_to_absolute_iri_1$7.resolve)(attribute.value,activeTag.baseIRI);continue}}attribute.prefix!=="xml"&&attribute.uri&&(predicates.push(this.uriToNamedNode(attribute.uri+attribute.local)),objects.push(attribute.value))}if(activeSubjectValue!==null&&(activeTag.subject=subjectValueBlank?this.dataFactory.blankNode(activeSubjectValue):this.valueToUri(activeSubjectValue,activeTag),claimSubjectNodeId&&this.claimNodeId(activeTag.subject)),activeTag.subject||(activeTag.subject=this.dataFactory.blankNode()),typedNode){const type=this.uriToNamedNode(tag.uri+tag.local);this.emitTriple(activeTag.subject,this.dataFactory.namedNode(RdfXmlParser.RDF+"type"),type,parentTag?parentTag.reifiedStatementId:null)}if(parentTag){if(parentTag.predicate)if(parentTag.childrenCollectionSubject){const linkTerm=this.dataFactory.blankNode();this.emitTriple(parentTag.childrenCollectionSubject,parentTag.childrenCollectionPredicate,linkTerm,parentTag.reifiedStatementId),this.emitTriple(linkTerm,this.dataFactory.namedNode(RdfXmlParser.RDF+"first"),activeTag.subject,activeTag.reifiedStatementId),parentTag.childrenCollectionSubject=linkTerm,parentTag.childrenCollectionPredicate=this.dataFactory.namedNode(RdfXmlParser.RDF+"rest")}else{this.emitTriple(parentTag.subject,parentTag.predicate,activeTag.subject,parentTag.reifiedStatementId);for(let i=0;i<parentTag.predicateSubPredicates.length;i++)this.emitTriple(activeTag.subject,parentTag.predicateSubPredicates[i],parentTag.predicateSubObjects[i],null);parentTag.predicateSubPredicates=[],parentTag.predicateSubObjects=[],parentTag.predicateEmitted=!0}for(let i=0;i<predicates.length;i++){const object2=this.dataFactory.literal(objects[i],activeTag.datatype||activeTag.language);this.emitTriple(activeTag.subject,predicates[i],object2,parentTag.reifiedStatementId)}explicitType&&this.emitTriple(activeTag.subject,this.dataFactory.namedNode(RdfXmlParser.RDF+"type"),this.uriToNamedNode(explicitType),null)}}onTagProperty(tag,activeTag,parentTag){if(activeTag.childrenParseType=ParseType.RESOURCE,activeTag.subject=parentTag.subject,tag.uri===RdfXmlParser.RDF&&tag.local==="li"?(parentTag.listItemCounter||(parentTag.listItemCounter=1),activeTag.predicate=this.uriToNamedNode(tag.uri+"_"+parentTag.listItemCounter++)):activeTag.predicate=this.uriToNamedNode(tag.uri+tag.local),tag.uri===RdfXmlParser.RDF&&RdfXmlParser.FORBIDDEN_PROPERTY_ELEMENTS.indexOf(tag.local)>=0)throw this.newParseError(`Illegal property element name: ${tag.local}`);activeTag.predicateSubPredicates=[],activeTag.predicateSubObjects=[];let parseType2=!1,attributedProperty=!1,activeSubSubjectValue=null,subSubjectValueBlank=!0;const predicates=[],objects=[];for(const propertyAttributeKey in tag.attributes){const propertyAttribute=tag.attributes[propertyAttributeKey];if(propertyAttribute.uri===RdfXmlParser.RDF)switch(propertyAttribute.local){case"resource":if(activeSubSubjectValue)throw this.newParseError(`Found both rdf:resource (${propertyAttribute.value}) and rdf:nodeID (${activeSubSubjectValue}).`);if(parseType2)throw this.newParseError(`rdf:parseType is not allowed on property elements with rdf:resource (${propertyAttribute.value})`);activeTag.hadChildren=!0,activeSubSubjectValue=propertyAttribute.value,subSubjectValueBlank=!1;continue;case"datatype":if(attributedProperty)throw this.newParseError(`Found both non-rdf:* property attributes and rdf:datatype (${propertyAttribute.value}).`);if(parseType2)throw this.newParseError(`rdf:parseType is not allowed on property elements with rdf:datatype (${propertyAttribute.value})`);activeTag.datatype=this.valueToUri(propertyAttribute.value,activeTag);continue;case"nodeID":if(attributedProperty)throw this.newParseError(`Found both non-rdf:* property attributes and rdf:nodeID (${propertyAttribute.value}).`);if(activeTag.hadChildren)throw this.newParseError(`Found both rdf:resource and rdf:nodeID (${propertyAttribute.value}).`);if(parseType2)throw this.newParseError(`rdf:parseType is not allowed on property elements with rdf:nodeID (${propertyAttribute.value})`);this.validateNcname(propertyAttribute.value),activeTag.hadChildren=!0,activeSubSubjectValue=propertyAttribute.value,subSubjectValueBlank=!0;continue;case"bagID":throw this.newParseError("rdf:bagID is not supported.");case"parseType":if(attributedProperty)throw this.newParseError("rdf:parseType is not allowed when non-rdf:* property attributes are present");if(activeTag.datatype)throw this.newParseError(`rdf:parseType is not allowed on property elements with rdf:datatype (${activeTag.datatype.value})`);if(activeSubSubjectValue)throw this.newParseError(`rdf:parseType is not allowed on property elements with rdf:nodeID or rdf:resource (${activeSubSubjectValue})`);if(propertyAttribute.value==="Resource"){parseType2=!0,activeTag.childrenParseType=ParseType.PROPERTY;const nestedBNode=this.dataFactory.blankNode();this.emitTriple(activeTag.subject,activeTag.predicate,nestedBNode,activeTag.reifiedStatementId),activeTag.subject=nestedBNode,activeTag.predicate=null}else propertyAttribute.value==="Collection"?(parseType2=!0,activeTag.hadChildren=!0,activeTag.childrenCollectionSubject=activeTag.subject,activeTag.childrenCollectionPredicate=activeTag.predicate,subSubjectValueBlank=!1):propertyAttribute.value==="Literal"&&(parseType2=!0,activeTag.childrenTagsToString=!0,activeTag.childrenStringTags=[]);continue;case"ID":this.validateNcname(propertyAttribute.value),activeTag.reifiedStatementId=this.valueToUri("#"+propertyAttribute.value,activeTag),this.claimNodeId(activeTag.reifiedStatementId);continue}else if(propertyAttribute.uri===RdfXmlParser.XML&&propertyAttribute.local==="lang"){activeTag.language=propertyAttribute.value===""?null:propertyAttribute.value.toLowerCase();continue}if(propertyAttribute.prefix!=="xml"&&propertyAttribute.prefix!=="xmlns"&&(propertyAttribute.prefix!==""||propertyAttribute.local!=="xmlns")&&propertyAttribute.uri){if(parseType2||activeTag.datatype)throw this.newParseError(`Found illegal rdf:* properties on property element with attribute: ${propertyAttribute.value}`);activeTag.hadChildren=!0,attributedProperty=!0,predicates.push(this.uriToNamedNode(propertyAttribute.uri+propertyAttribute.local)),objects.push(this.dataFactory.literal(propertyAttribute.value,activeTag.datatype||activeTag.language))}}if(activeSubSubjectValue!==null){const subjectParent=activeTag.subject;activeTag.subject=subSubjectValueBlank?this.dataFactory.blankNode(activeSubSubjectValue):this.valueToUri(activeSubSubjectValue,activeTag),this.emitTriple(subjectParent,activeTag.predicate,activeTag.subject,activeTag.reifiedStatementId);for(let i=0;i<predicates.length;i++)this.emitTriple(activeTag.subject,predicates[i],objects[i],null);activeTag.predicateEmitted=!0}else subSubjectValueBlank&&(activeTag.predicateSubPredicates=predicates,activeTag.predicateSubObjects=objects,activeTag.predicateEmitted=!1)}emitTriple(subject2,predicate2,object2,statementId){this.push(this.dataFactory.quad(subject2,predicate2,object2,this.defaultGraph)),statementId&&(this.push(this.dataFactory.quad(statementId,this.dataFactory.namedNode(RdfXmlParser.RDF+"type"),this.dataFactory.namedNode(RdfXmlParser.RDF+"Statement"),this.defaultGraph)),this.push(this.dataFactory.quad(statementId,this.dataFactory.namedNode(RdfXmlParser.RDF+"subject"),subject2,this.defaultGraph)),this.push(this.dataFactory.quad(statementId,this.dataFactory.namedNode(RdfXmlParser.RDF+"predicate"),predicate2,this.defaultGraph)),this.push(this.dataFactory.quad(statementId,this.dataFactory.namedNode(RdfXmlParser.RDF+"object"),object2,this.defaultGraph)))}claimNodeId(term){if(!this.allowDuplicateRdfIds){if(this.nodeIds[term.value])throw this.newParseError(`Found multiple occurrences of rdf:ID='${term.value}'.`);this.nodeIds[term.value]=!0}}onText(text){const activeTag=this.activeTagStack.length?this.activeTagStack[this.activeTagStack.length-1]:null;activeTag&&(activeTag.childrenStringTags?activeTag.childrenStringTags.push(text):activeTag.predicate&&(activeTag.text=text))}onCloseTag(){const poppedTag=this.activeTagStack.pop();if(poppedTag.childrenStringEmitClosingTag&&poppedTag.childrenStringTags.push(poppedTag.childrenStringEmitClosingTag),poppedTag.childrenTagsToString&&(poppedTag.datatype=this.dataFactory.namedNode(RdfXmlParser.RDF+"XMLLiteral"),poppedTag.text=poppedTag.childrenStringTags.join(""),poppedTag.hadChildren=!1),poppedTag.childrenCollectionSubject)this.emitTriple(poppedTag.childrenCollectionSubject,poppedTag.childrenCollectionPredicate,this.dataFactory.namedNode(RdfXmlParser.RDF+"nil"),poppedTag.reifiedStatementId);else if(poppedTag.predicate){if(!poppedTag.hadChildren&&poppedTag.childrenParseType!==ParseType.PROPERTY)this.emitTriple(poppedTag.subject,poppedTag.predicate,this.dataFactory.literal(poppedTag.text||"",poppedTag.datatype||poppedTag.language),poppedTag.reifiedStatementId);else if(!poppedTag.predicateEmitted){const subject2=this.dataFactory.blankNode();this.emitTriple(poppedTag.subject,poppedTag.predicate,subject2,poppedTag.reifiedStatementId);for(let i=0;i<poppedTag.predicateSubPredicates.length;i++)this.emitTriple(subject2,poppedTag.predicateSubPredicates[i],poppedTag.predicateSubObjects[i],null)}}}onDoctype(doctype){doctype.replace(/<!ENTITY\s+([^\s]+)\s+["']([^"']+)["']\s*>/g,(match,prefix,uri)=>(this.saxParser.ENTITIES[prefix]=uri,""))}}__name(RdfXmlParser,"RdfXmlParser");RdfXmlParser$1.RdfXmlParser=RdfXmlParser;RdfXmlParser.MIME_TYPE="application/rdf+xml";RdfXmlParser.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";RdfXmlParser.XML="http://www.w3.org/XML/1998/namespace";RdfXmlParser.FORBIDDEN_NODE_ELEMENTS=["RDF","ID","about","bagID","parseType","resource","nodeID","li","aboutEach","aboutEachPrefix"];RdfXmlParser.FORBIDDEN_PROPERTY_ELEMENTS=["Description","RDF","ID","about","bagID","parseType","resource","nodeID","aboutEach","aboutEachPrefix"];RdfXmlParser.NCNAME_MATCHER=/^([A-Za-z\xC0-\xD6\xD8-\xF6\u{F8}-\u{2FF}\u{370}-\u{37D}\u{37F}-\u{1FFF}\u{200C}-\u{200D}\u{2070}-\u{218F}\u{2C00}-\u{2FEF}\u{3001}-\u{D7FF}\u{F900}-\u{FDCF}\u{FDF0}-\u{FFFD}\u{10000}-\u{EFFFF}_])([A-Za-z\xC0-\xD6\xD8-\xF6\u{F8}-\u{2FF}\u{370}-\u{37D}\u{37F}-\u{1FFF}\u{200C}-\u{200D}\u{2070}-\u{218F}\u{2C00}-\u{2FEF}\u{3001}-\u{D7FF}\u{F900}-\u{FDCF}\u{FDF0}-\u{FFFD}\u{10000}-\u{EFFFF}_\-.0-9#xB7\u{0300}-\u{036F}\u{203F}-\u{2040}])*$/u;var ParseType;(function(ParseType2){ParseType2[ParseType2.RESOURCE=0]="RESOURCE",ParseType2[ParseType2.PROPERTY=1]="PROPERTY"})(ParseType||(RdfXmlParser$1.ParseType=ParseType={}));(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(RdfXmlParser$1,exports)})(rdfxmlStreamingParser);Object.defineProperty(ActorRdfParseRdfXml$1,"__esModule",{value:!0});ActorRdfParseRdfXml$1.ActorRdfParseRdfXml=void 0;const bus_rdf_parse_1$4=lib$1U,rdfxml_streaming_parser_1=rdfxmlStreamingParser;class ActorRdfParseRdfXml extends bus_rdf_parse_1$4.ActorRdfParseFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){var _a2;action.data.on("error",error=>data.emit("error",error));const data=action.data.pipe(new rdfxml_streaming_parser_1.RdfXmlParser({baseIRI:(_a2=action.metadata)==null?void 0:_a2.baseIRI}));return{data,metadata:{triples:!0}}}}__name(ActorRdfParseRdfXml,"ActorRdfParseRdfXml");ActorRdfParseRdfXml$1.ActorRdfParseRdfXml=ActorRdfParseRdfXml;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseRdfXml$1,exports)})(lib$1T);var lib$1S={},ActorRdfParseXmlRdfa$1={},rdfaStreamingParser={},IActiveTag={};Object.defineProperty(IActiveTag,"__esModule",{value:!0});var IHtmlParseListener$1={};Object.defineProperty(IHtmlParseListener$1,"__esModule",{value:!0});var IRdfaPattern={};Object.defineProperty(IRdfaPattern,"__esModule",{value:!0});var RdfaParser$1={},lib$1R={},Parser$6={},Tokenizer$2={},decode={},decodeDataHtml={};Object.defineProperty(decodeDataHtml,"__esModule",{value:!0});decodeDataHtml.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(c){return c.charCodeAt(0)}));var decodeDataXml={};Object.defineProperty(decodeDataXml,"__esModule",{value:!0});decodeDataXml.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(c){return c.charCodeAt(0)}));var decode_codepoint={};(function(exports){var _a2;Object.defineProperty(exports,"__esModule",{value:!0}),exports.replaceCodePoint=exports.fromCodePoint=void 0;var decodeMap=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);exports.fromCodePoint=(_a2=String.fromCodePoint)!==null&&_a2!==void 0?_a2:function(codePoint){var output="";return codePoint>65535&&(codePoint-=65536,output+=String.fromCharCode(codePoint>>>10&1023|55296),codePoint=56320|codePoint&1023),output+=String.fromCharCode(codePoint),output};function replaceCodePoint(codePoint){var _a3;return codePoint>=55296&&codePoint<=57343||codePoint>1114111?65533:(_a3=decodeMap.get(codePoint))!==null&&_a3!==void 0?_a3:codePoint}__name(replaceCodePoint,"replaceCodePoint"),exports.replaceCodePoint=replaceCodePoint;function decodeCodePoint(codePoint){return(0,exports.fromCodePoint)(replaceCodePoint(codePoint))}__name(decodeCodePoint,"decodeCodePoint"),exports.default=decodeCodePoint})(decode_codepoint);(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar2=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding2(result,mod,k);return __setModuleDefault2(result,mod),result},__importDefault2=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeXML=exports.decodeHTMLStrict=exports.decodeHTMLAttribute=exports.decodeHTML=exports.determineBranch=exports.EntityDecoder=exports.DecodingMode=exports.BinTrieFlags=exports.fromCodePoint=exports.replaceCodePoint=exports.decodeCodePoint=exports.xmlDecodeTree=exports.htmlDecodeTree=void 0;var decode_data_html_js_1=__importDefault2(decodeDataHtml);exports.htmlDecodeTree=decode_data_html_js_1.default;var decode_data_xml_js_1=__importDefault2(decodeDataXml);exports.xmlDecodeTree=decode_data_xml_js_1.default;var decode_codepoint_js_1=__importStar2(decode_codepoint);exports.decodeCodePoint=decode_codepoint_js_1.default;var decode_codepoint_js_2=decode_codepoint;Object.defineProperty(exports,"replaceCodePoint",{enumerable:!0,get:function(){return decode_codepoint_js_2.replaceCodePoint}}),Object.defineProperty(exports,"fromCodePoint",{enumerable:!0,get:function(){return decode_codepoint_js_2.fromCodePoint}});var CharCodes;(function(CharCodes2){CharCodes2[CharCodes2.NUM=35]="NUM",CharCodes2[CharCodes2.SEMI=59]="SEMI",CharCodes2[CharCodes2.EQUALS=61]="EQUALS",CharCodes2[CharCodes2.ZERO=48]="ZERO",CharCodes2[CharCodes2.NINE=57]="NINE",CharCodes2[CharCodes2.LOWER_A=97]="LOWER_A",CharCodes2[CharCodes2.LOWER_F=102]="LOWER_F",CharCodes2[CharCodes2.LOWER_X=120]="LOWER_X",CharCodes2[CharCodes2.LOWER_Z=122]="LOWER_Z",CharCodes2[CharCodes2.UPPER_A=65]="UPPER_A",CharCodes2[CharCodes2.UPPER_F=70]="UPPER_F",CharCodes2[CharCodes2.UPPER_Z=90]="UPPER_Z"})(CharCodes||(CharCodes={}));var TO_LOWER_BIT=32,BinTrieFlags;(function(BinTrieFlags2){BinTrieFlags2[BinTrieFlags2.VALUE_LENGTH=49152]="VALUE_LENGTH",BinTrieFlags2[BinTrieFlags2.BRANCH_LENGTH=16256]="BRANCH_LENGTH",BinTrieFlags2[BinTrieFlags2.JUMP_TABLE=127]="JUMP_TABLE"})(BinTrieFlags=exports.BinTrieFlags||(exports.BinTrieFlags={}));function isNumber(code){return code>=CharCodes.ZERO&&code<=CharCodes.NINE}__name(isNumber,"isNumber");function isHexadecimalCharacter(code){return code>=CharCodes.UPPER_A&&code<=CharCodes.UPPER_F||code>=CharCodes.LOWER_A&&code<=CharCodes.LOWER_F}__name(isHexadecimalCharacter,"isHexadecimalCharacter");function isAsciiAlphaNumeric(code){return code>=CharCodes.UPPER_A&&code<=CharCodes.UPPER_Z||code>=CharCodes.LOWER_A&&code<=CharCodes.LOWER_Z||isNumber(code)}__name(isAsciiAlphaNumeric,"isAsciiAlphaNumeric");function isEntityInAttributeInvalidEnd(code){return code===CharCodes.EQUALS||isAsciiAlphaNumeric(code)}__name(isEntityInAttributeInvalidEnd,"isEntityInAttributeInvalidEnd");var EntityDecoderState;(function(EntityDecoderState2){EntityDecoderState2[EntityDecoderState2.EntityStart=0]="EntityStart",EntityDecoderState2[EntityDecoderState2.NumericStart=1]="NumericStart",EntityDecoderState2[EntityDecoderState2.NumericDecimal=2]="NumericDecimal",EntityDecoderState2[EntityDecoderState2.NumericHex=3]="NumericHex",EntityDecoderState2[EntityDecoderState2.NamedEntity=4]="NamedEntity"})(EntityDecoderState||(EntityDecoderState={}));var DecodingMode;(function(DecodingMode2){DecodingMode2[DecodingMode2.Legacy=0]="Legacy",DecodingMode2[DecodingMode2.Strict=1]="Strict",DecodingMode2[DecodingMode2.Attribute=2]="Attribute"})(DecodingMode=exports.DecodingMode||(exports.DecodingMode={}));var EntityDecoder=function(){function EntityDecoder2(decodeTree,emitCodePoint,errors){this.decodeTree=decodeTree,this.emitCodePoint=emitCodePoint,this.errors=errors,this.state=EntityDecoderState.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=DecodingMode.Strict}return __name(EntityDecoder2,"EntityDecoder"),EntityDecoder2.prototype.startEntity=function(decodeMode){this.decodeMode=decodeMode,this.state=EntityDecoderState.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},EntityDecoder2.prototype.write=function(str,offset){switch(this.state){case EntityDecoderState.EntityStart:return str.charCodeAt(offset)===CharCodes.NUM?(this.state=EntityDecoderState.NumericStart,this.consumed+=1,this.stateNumericStart(str,offset+1)):(this.state=EntityDecoderState.NamedEntity,this.stateNamedEntity(str,offset));case EntityDecoderState.NumericStart:return this.stateNumericStart(str,offset);case EntityDecoderState.NumericDecimal:return this.stateNumericDecimal(str,offset);case EntityDecoderState.NumericHex:return this.stateNumericHex(str,offset);case EntityDecoderState.NamedEntity:return this.stateNamedEntity(str,offset)}},EntityDecoder2.prototype.stateNumericStart=function(str,offset){return offset>=str.length?-1:(str.charCodeAt(offset)|TO_LOWER_BIT)===CharCodes.LOWER_X?(this.state=EntityDecoderState.NumericHex,this.consumed+=1,this.stateNumericHex(str,offset+1)):(this.state=EntityDecoderState.NumericDecimal,this.stateNumericDecimal(str,offset))},EntityDecoder2.prototype.addToNumericResult=function(str,start,end,base){if(start!==end){var digitCount=end-start;this.result=this.result*Math.pow(base,digitCount)+parseInt(str.substr(start,digitCount),base),this.consumed+=digitCount}},EntityDecoder2.prototype.stateNumericHex=function(str,offset){for(var startIdx=offset;offset<str.length;){var char=str.charCodeAt(offset);if(isNumber(char)||isHexadecimalCharacter(char))offset+=1;else return this.addToNumericResult(str,startIdx,offset,16),this.emitNumericEntity(char,3)}return this.addToNumericResult(str,startIdx,offset,16),-1},EntityDecoder2.prototype.stateNumericDecimal=function(str,offset){for(var startIdx=offset;offset<str.length;){var char=str.charCodeAt(offset);if(isNumber(char))offset+=1;else return this.addToNumericResult(str,startIdx,offset,10),this.emitNumericEntity(char,2)}return this.addToNumericResult(str,startIdx,offset,10),-1},EntityDecoder2.prototype.emitNumericEntity=function(lastCp,expectedLength){var _a2;if(this.consumed<=expectedLength)return(_a2=this.errors)===null||_a2===void 0||_a2.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(lastCp===CharCodes.SEMI)this.consumed+=1;else if(this.decodeMode===DecodingMode.Strict)return 0;return this.emitCodePoint((0,decode_codepoint_js_1.replaceCodePoint)(this.result),this.consumed),this.errors&&(lastCp!==CharCodes.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},EntityDecoder2.prototype.stateNamedEntity=function(str,offset){for(var decodeTree=this.decodeTree,current=decodeTree[this.treeIndex],valueLength=(current&BinTrieFlags.VALUE_LENGTH)>>14;offset<str.length;offset++,this.excess++){var char=str.charCodeAt(offset);if(this.treeIndex=determineBranch(decodeTree,current,this.treeIndex+Math.max(1,valueLength),char),this.treeIndex<0)return this.result===0||this.decodeMode===DecodingMode.Attribute&&(valueLength===0||isEntityInAttributeInvalidEnd(char))?0:this.emitNotTerminatedNamedEntity();if(current=decodeTree[this.treeIndex],valueLength=(current&BinTrieFlags.VALUE_LENGTH)>>14,valueLength!==0){if(char===CharCodes.SEMI)return this.emitNamedEntityData(this.treeIndex,valueLength,this.consumed+this.excess);this.decodeMode!==DecodingMode.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},EntityDecoder2.prototype.emitNotTerminatedNamedEntity=function(){var _a2,_b=this,result=_b.result,decodeTree=_b.decodeTree,valueLength=(decodeTree[result]&BinTrieFlags.VALUE_LENGTH)>>14;return this.emitNamedEntityData(result,valueLength,this.consumed),(_a2=this.errors)===null||_a2===void 0||_a2.missingSemicolonAfterCharacterReference(),this.consumed},EntityDecoder2.prototype.emitNamedEntityData=function(result,valueLength,consumed){var decodeTree=this.decodeTree;return this.emitCodePoint(valueLength===1?decodeTree[result]&~BinTrieFlags.VALUE_LENGTH:decodeTree[result+1],consumed),valueLength===3&&this.emitCodePoint(decodeTree[result+2],consumed),consumed},EntityDecoder2.prototype.end=function(){var _a2;switch(this.state){case EntityDecoderState.NamedEntity:return this.result!==0&&(this.decodeMode!==DecodingMode.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case EntityDecoderState.NumericDecimal:return this.emitNumericEntity(0,2);case EntityDecoderState.NumericHex:return this.emitNumericEntity(0,3);case EntityDecoderState.NumericStart:return(_a2=this.errors)===null||_a2===void 0||_a2.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case EntityDecoderState.EntityStart:return 0}},EntityDecoder2}();exports.EntityDecoder=EntityDecoder;function getDecoder(decodeTree){var ret="",decoder=new EntityDecoder(decodeTree,function(str){return ret+=(0,decode_codepoint_js_1.fromCodePoint)(str)});return __name(function(str,decodeMode){for(var lastIndex=0,offset=0;(offset=str.indexOf("&",offset))>=0;){ret+=str.slice(lastIndex,offset),decoder.startEntity(decodeMode);var len=decoder.write(str,offset+1);if(len<0){lastIndex=offset+decoder.end();break}lastIndex=offset+len,offset=len===0?lastIndex+1:lastIndex}var result=ret+str.slice(lastIndex);return ret="",result},"decodeWithTrie")}__name(getDecoder,"getDecoder");function determineBranch(decodeTree,current,nodeIdx,char){var branchCount=(current&BinTrieFlags.BRANCH_LENGTH)>>7,jumpOffset=current&BinTrieFlags.JUMP_TABLE;if(branchCount===0)return jumpOffset!==0&&char===jumpOffset?nodeIdx:-1;if(jumpOffset){var value=char-jumpOffset;return value<0||value>=branchCount?-1:decodeTree[nodeIdx+value]-1}for(var lo=nodeIdx,hi=lo+branchCount-1;lo<=hi;){var mid=lo+hi>>>1,midVal=decodeTree[mid];if(midVal<char)lo=mid+1;else if(midVal>char)hi=mid-1;else return decodeTree[mid+branchCount]}return-1}__name(determineBranch,"determineBranch"),exports.determineBranch=determineBranch;var htmlDecoder=getDecoder(decode_data_html_js_1.default),xmlDecoder=getDecoder(decode_data_xml_js_1.default);function decodeHTML(str,mode){return mode===void 0&&(mode=DecodingMode.Legacy),htmlDecoder(str,mode)}__name(decodeHTML,"decodeHTML"),exports.decodeHTML=decodeHTML;function decodeHTMLAttribute(str){return htmlDecoder(str,DecodingMode.Attribute)}__name(decodeHTMLAttribute,"decodeHTMLAttribute"),exports.decodeHTMLAttribute=decodeHTMLAttribute;function decodeHTMLStrict(str){return htmlDecoder(str,DecodingMode.Strict)}__name(decodeHTMLStrict,"decodeHTMLStrict"),exports.decodeHTMLStrict=decodeHTMLStrict;function decodeXML(str){return xmlDecoder(str,DecodingMode.Strict)}__name(decodeXML,"decodeXML"),exports.decodeXML=decodeXML})(decode);(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.QuoteType=void 0;var decode_js_12=decode,CharCodes;(function(CharCodes2){CharCodes2[CharCodes2.Tab=9]="Tab",CharCodes2[CharCodes2.NewLine=10]="NewLine",CharCodes2[CharCodes2.FormFeed=12]="FormFeed",CharCodes2[CharCodes2.CarriageReturn=13]="CarriageReturn",CharCodes2[CharCodes2.Space=32]="Space",CharCodes2[CharCodes2.ExclamationMark=33]="ExclamationMark",CharCodes2[CharCodes2.Number=35]="Number",CharCodes2[CharCodes2.Amp=38]="Amp",CharCodes2[CharCodes2.SingleQuote=39]="SingleQuote",CharCodes2[CharCodes2.DoubleQuote=34]="DoubleQuote",CharCodes2[CharCodes2.Dash=45]="Dash",CharCodes2[CharCodes2.Slash=47]="Slash",CharCodes2[CharCodes2.Zero=48]="Zero",CharCodes2[CharCodes2.Nine=57]="Nine",CharCodes2[CharCodes2.Semi=59]="Semi",CharCodes2[CharCodes2.Lt=60]="Lt",CharCodes2[CharCodes2.Eq=61]="Eq",CharCodes2[CharCodes2.Gt=62]="Gt",CharCodes2[CharCodes2.Questionmark=63]="Questionmark",CharCodes2[CharCodes2.UpperA=65]="UpperA",CharCodes2[CharCodes2.LowerA=97]="LowerA",CharCodes2[CharCodes2.UpperF=70]="UpperF",CharCodes2[CharCodes2.LowerF=102]="LowerF",CharCodes2[CharCodes2.UpperZ=90]="UpperZ",CharCodes2[CharCodes2.LowerZ=122]="LowerZ",CharCodes2[CharCodes2.LowerX=120]="LowerX",CharCodes2[CharCodes2.OpeningSquareBracket=91]="OpeningSquareBracket"})(CharCodes||(CharCodes={}));var State;(function(State2){State2[State2.Text=1]="Text",State2[State2.BeforeTagName=2]="BeforeTagName",State2[State2.InTagName=3]="InTagName",State2[State2.InSelfClosingTag=4]="InSelfClosingTag",State2[State2.BeforeClosingTagName=5]="BeforeClosingTagName",State2[State2.InClosingTagName=6]="InClosingTagName",State2[State2.AfterClosingTagName=7]="AfterClosingTagName",State2[State2.BeforeAttributeName=8]="BeforeAttributeName",State2[State2.InAttributeName=9]="InAttributeName",State2[State2.AfterAttributeName=10]="AfterAttributeName",State2[State2.BeforeAttributeValue=11]="BeforeAttributeValue",State2[State2.InAttributeValueDq=12]="InAttributeValueDq",State2[State2.InAttributeValueSq=13]="InAttributeValueSq",State2[State2.InAttributeValueNq=14]="InAttributeValueNq",State2[State2.BeforeDeclaration=15]="BeforeDeclaration",State2[State2.InDeclaration=16]="InDeclaration",State2[State2.InProcessingInstruction=17]="InProcessingInstruction",State2[State2.BeforeComment=18]="BeforeComment",State2[State2.CDATASequence=19]="CDATASequence",State2[State2.InSpecialComment=20]="InSpecialComment",State2[State2.InCommentLike=21]="InCommentLike",State2[State2.BeforeSpecialS=22]="BeforeSpecialS",State2[State2.SpecialStartSequence=23]="SpecialStartSequence",State2[State2.InSpecialTag=24]="InSpecialTag",State2[State2.BeforeEntity=25]="BeforeEntity",State2[State2.BeforeNumericEntity=26]="BeforeNumericEntity",State2[State2.InNamedEntity=27]="InNamedEntity",State2[State2.InNumericEntity=28]="InNumericEntity",State2[State2.InHexEntity=29]="InHexEntity"})(State||(State={}));function isWhitespace(c){return c===CharCodes.Space||c===CharCodes.NewLine||c===CharCodes.Tab||c===CharCodes.FormFeed||c===CharCodes.CarriageReturn}__name(isWhitespace,"isWhitespace");function isEndOfTagSection(c){return c===CharCodes.Slash||c===CharCodes.Gt||isWhitespace(c)}__name(isEndOfTagSection,"isEndOfTagSection");function isNumber(c){return c>=CharCodes.Zero&&c<=CharCodes.Nine}__name(isNumber,"isNumber");function isASCIIAlpha(c){return c>=CharCodes.LowerA&&c<=CharCodes.LowerZ||c>=CharCodes.UpperA&&c<=CharCodes.UpperZ}__name(isASCIIAlpha,"isASCIIAlpha");function isHexDigit(c){return c>=CharCodes.UpperA&&c<=CharCodes.UpperF||c>=CharCodes.LowerA&&c<=CharCodes.LowerF}__name(isHexDigit,"isHexDigit");var QuoteType;(function(QuoteType2){QuoteType2[QuoteType2.NoValue=0]="NoValue",QuoteType2[QuoteType2.Unquoted=1]="Unquoted",QuoteType2[QuoteType2.Single=2]="Single",QuoteType2[QuoteType2.Double=3]="Double"})(QuoteType=exports.QuoteType||(exports.QuoteType={}));var Sequences={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},Tokenizer2=function(){function Tokenizer3(_a2,cbs){var _b=_a2.xmlMode,xmlMode=_b===void 0?!1:_b,_c=_a2.decodeEntities,decodeEntities=_c===void 0?!0:_c;this.cbs=cbs,this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=xmlMode,this.decodeEntities=decodeEntities,this.entityTrie=xmlMode?decode_js_12.xmlDecodeTree:decode_js_12.htmlDecodeTree}return __name(Tokenizer3,"Tokenizer"),Tokenizer3.prototype.reset=function(){this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},Tokenizer3.prototype.write=function(chunk){this.offset+=this.buffer.length,this.buffer=chunk,this.parse()},Tokenizer3.prototype.end=function(){this.running&&this.finish()},Tokenizer3.prototype.pause=function(){this.running=!1},Tokenizer3.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},Tokenizer3.prototype.getIndex=function(){return this.index},Tokenizer3.prototype.getSectionStart=function(){return this.sectionStart},Tokenizer3.prototype.stateText=function(c){c===CharCodes.Lt||!this.decodeEntities&&this.fastForwardTo(CharCodes.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=State.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&c===CharCodes.Amp&&(this.state=State.BeforeEntity)},Tokenizer3.prototype.stateSpecialStartSequence=function(c){var isEnd=this.sequenceIndex===this.currentSequence.length,isMatch=isEnd?isEndOfTagSection(c):(c|32)===this.currentSequence[this.sequenceIndex];if(!isMatch)this.isSpecial=!1;else if(!isEnd){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=State.InTagName,this.stateInTagName(c)},Tokenizer3.prototype.stateInSpecialTag=function(c){if(this.sequenceIndex===this.currentSequence.length){if(c===CharCodes.Gt||isWhitespace(c)){var endOfText=this.index-this.currentSequence.length;if(this.sectionStart<endOfText){var actualIndex=this.index;this.index=endOfText,this.cbs.ontext(this.sectionStart,endOfText),this.index=actualIndex}this.isSpecial=!1,this.sectionStart=endOfText+2,this.stateInClosingTagName(c);return}this.sequenceIndex=0}(c|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Sequences.TitleEnd?this.decodeEntities&&c===CharCodes.Amp&&(this.state=State.BeforeEntity):this.fastForwardTo(CharCodes.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(c===CharCodes.Lt)},Tokenizer3.prototype.stateCDATASequence=function(c){c===Sequences.Cdata[this.sequenceIndex]?++this.sequenceIndex===Sequences.Cdata.length&&(this.state=State.InCommentLike,this.currentSequence=Sequences.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=State.InDeclaration,this.stateInDeclaration(c))},Tokenizer3.prototype.fastForwardTo=function(c){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===c)return!0;return this.index=this.buffer.length+this.offset-1,!1},Tokenizer3.prototype.stateInCommentLike=function(c){c===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=State.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):c!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},Tokenizer3.prototype.isTagStartChar=function(c){return this.xmlMode?!isEndOfTagSection(c):isASCIIAlpha(c)},Tokenizer3.prototype.startSpecial=function(sequence,offset){this.isSpecial=!0,this.currentSequence=sequence,this.sequenceIndex=offset,this.state=State.SpecialStartSequence},Tokenizer3.prototype.stateBeforeTagName=function(c){if(c===CharCodes.ExclamationMark)this.state=State.BeforeDeclaration,this.sectionStart=this.index+1;else if(c===CharCodes.Questionmark)this.state=State.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(c)){var lower=c|32;this.sectionStart=this.index,!this.xmlMode&&lower===Sequences.TitleEnd[2]?this.startSpecial(Sequences.TitleEnd,3):this.state=!this.xmlMode&&lower===Sequences.ScriptEnd[2]?State.BeforeSpecialS:State.InTagName}else c===CharCodes.Slash?this.state=State.BeforeClosingTagName:(this.state=State.Text,this.stateText(c))},Tokenizer3.prototype.stateInTagName=function(c){isEndOfTagSection(c)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c))},Tokenizer3.prototype.stateBeforeClosingTagName=function(c){isWhitespace(c)||(c===CharCodes.Gt?this.state=State.Text:(this.state=this.isTagStartChar(c)?State.InClosingTagName:State.InSpecialComment,this.sectionStart=this.index))},Tokenizer3.prototype.stateInClosingTagName=function(c){(c===CharCodes.Gt||isWhitespace(c))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterClosingTagName,this.stateAfterClosingTagName(c))},Tokenizer3.prototype.stateAfterClosingTagName=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.state=State.Text,this.baseState=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeAttributeName=function(c){c===CharCodes.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=State.InSpecialTag,this.sequenceIndex=0):this.state=State.Text,this.baseState=this.state,this.sectionStart=this.index+1):c===CharCodes.Slash?this.state=State.InSelfClosingTag:isWhitespace(c)||(this.state=State.InAttributeName,this.sectionStart=this.index)},Tokenizer3.prototype.stateInSelfClosingTag=function(c){c===CharCodes.Gt?(this.cbs.onselfclosingtag(this.index),this.state=State.Text,this.baseState=State.Text,this.sectionStart=this.index+1,this.isSpecial=!1):isWhitespace(c)||(this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c))},Tokenizer3.prototype.stateInAttributeName=function(c){(c===CharCodes.Eq||isEndOfTagSection(c))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterAttributeName,this.stateAfterAttributeName(c))},Tokenizer3.prototype.stateAfterAttributeName=function(c){c===CharCodes.Eq?this.state=State.BeforeAttributeValue:c===CharCodes.Slash||c===CharCodes.Gt?(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c)):isWhitespace(c)||(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.InAttributeName,this.sectionStart=this.index)},Tokenizer3.prototype.stateBeforeAttributeValue=function(c){c===CharCodes.DoubleQuote?(this.state=State.InAttributeValueDq,this.sectionStart=this.index+1):c===CharCodes.SingleQuote?(this.state=State.InAttributeValueSq,this.sectionStart=this.index+1):isWhitespace(c)||(this.sectionStart=this.index,this.state=State.InAttributeValueNq,this.stateInAttributeValueNoQuotes(c))},Tokenizer3.prototype.handleInAttributeValue=function(c,quote){c===quote||!this.decodeEntities&&this.fastForwardTo(quote)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(quote===CharCodes.DoubleQuote?QuoteType.Double:QuoteType.Single,this.index),this.state=State.BeforeAttributeName):this.decodeEntities&&c===CharCodes.Amp&&(this.baseState=this.state,this.state=State.BeforeEntity)},Tokenizer3.prototype.stateInAttributeValueDoubleQuotes=function(c){this.handleInAttributeValue(c,CharCodes.DoubleQuote)},Tokenizer3.prototype.stateInAttributeValueSingleQuotes=function(c){this.handleInAttributeValue(c,CharCodes.SingleQuote)},Tokenizer3.prototype.stateInAttributeValueNoQuotes=function(c){isWhitespace(c)||c===CharCodes.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(QuoteType.Unquoted,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c)):this.decodeEntities&&c===CharCodes.Amp&&(this.baseState=this.state,this.state=State.BeforeEntity)},Tokenizer3.prototype.stateBeforeDeclaration=function(c){c===CharCodes.OpeningSquareBracket?(this.state=State.CDATASequence,this.sequenceIndex=0):this.state=c===CharCodes.Dash?State.BeforeComment:State.InDeclaration},Tokenizer3.prototype.stateInDeclaration=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateInProcessingInstruction=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeComment=function(c){c===CharCodes.Dash?(this.state=State.InCommentLike,this.currentSequence=Sequences.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=State.InDeclaration},Tokenizer3.prototype.stateInSpecialComment=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeSpecialS=function(c){var lower=c|32;lower===Sequences.ScriptEnd[3]?this.startSpecial(Sequences.ScriptEnd,4):lower===Sequences.StyleEnd[3]?this.startSpecial(Sequences.StyleEnd,4):(this.state=State.InTagName,this.stateInTagName(c))},Tokenizer3.prototype.stateBeforeEntity=function(c){this.entityExcess=1,this.entityResult=0,c===CharCodes.Number?this.state=State.BeforeNumericEntity:c===CharCodes.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=State.InNamedEntity,this.stateInNamedEntity(c))},Tokenizer3.prototype.stateInNamedEntity=function(c){if(this.entityExcess+=1,this.trieIndex=(0,decode_js_12.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,c),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var masked=this.trieCurrent&decode_js_12.BinTrieFlags.VALUE_LENGTH;if(masked){var valueLength=(masked>>14)-1;if(!this.allowLegacyEntity()&&c!==CharCodes.Semi)this.trieIndex+=valueLength;else{var entityStart=this.index-this.entityExcess+1;entityStart>this.sectionStart&&this.emitPartial(this.sectionStart,entityStart),this.entityResult=this.trieIndex,this.trieIndex+=valueLength,this.entityExcess=0,this.sectionStart=this.index+1,valueLength===0&&this.emitNamedEntity()}}},Tokenizer3.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var valueLength=(this.entityTrie[this.entityResult]&decode_js_12.BinTrieFlags.VALUE_LENGTH)>>14;switch(valueLength){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~decode_js_12.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},Tokenizer3.prototype.stateBeforeNumericEntity=function(c){(c|32)===CharCodes.LowerX?(this.entityExcess++,this.state=State.InHexEntity):(this.state=State.InNumericEntity,this.stateInNumericEntity(c))},Tokenizer3.prototype.emitNumericEntity=function(strict){var entityStart=this.index-this.entityExcess-1,numberStart=entityStart+2+ +(this.state===State.InHexEntity);numberStart!==this.index&&(entityStart>this.sectionStart&&this.emitPartial(this.sectionStart,entityStart),this.sectionStart=this.index+Number(strict),this.emitCodePoint((0,decode_js_12.replaceCodePoint)(this.entityResult))),this.state=this.baseState},Tokenizer3.prototype.stateInNumericEntity=function(c){c===CharCodes.Semi?this.emitNumericEntity(!0):isNumber(c)?(this.entityResult=this.entityResult*10+(c-CharCodes.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Tokenizer3.prototype.stateInHexEntity=function(c){c===CharCodes.Semi?this.emitNumericEntity(!0):isNumber(c)?(this.entityResult=this.entityResult*16+(c-CharCodes.Zero),this.entityExcess++):isHexDigit(c)?(this.entityResult=this.entityResult*16+((c|32)-CharCodes.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Tokenizer3.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===State.Text||this.baseState===State.InSpecialTag)},Tokenizer3.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===State.Text||this.state===State.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===State.InAttributeValueDq||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},Tokenizer3.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},Tokenizer3.prototype.parse=function(){for(;this.shouldContinue();){var c=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case State.Text:{this.stateText(c);break}case State.SpecialStartSequence:{this.stateSpecialStartSequence(c);break}case State.InSpecialTag:{this.stateInSpecialTag(c);break}case State.CDATASequence:{this.stateCDATASequence(c);break}case State.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(c);break}case State.InAttributeName:{this.stateInAttributeName(c);break}case State.InCommentLike:{this.stateInCommentLike(c);break}case State.InSpecialComment:{this.stateInSpecialComment(c);break}case State.BeforeAttributeName:{this.stateBeforeAttributeName(c);break}case State.InTagName:{this.stateInTagName(c);break}case State.InClosingTagName:{this.stateInClosingTagName(c);break}case State.BeforeTagName:{this.stateBeforeTagName(c);break}case State.AfterAttributeName:{this.stateAfterAttributeName(c);break}case State.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(c);break}case State.BeforeAttributeValue:{this.stateBeforeAttributeValue(c);break}case State.BeforeClosingTagName:{this.stateBeforeClosingTagName(c);break}case State.AfterClosingTagName:{this.stateAfterClosingTagName(c);break}case State.BeforeSpecialS:{this.stateBeforeSpecialS(c);break}case State.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(c);break}case State.InSelfClosingTag:{this.stateInSelfClosingTag(c);break}case State.InDeclaration:{this.stateInDeclaration(c);break}case State.BeforeDeclaration:{this.stateBeforeDeclaration(c);break}case State.BeforeComment:{this.stateBeforeComment(c);break}case State.InProcessingInstruction:{this.stateInProcessingInstruction(c);break}case State.InNamedEntity:{this.stateInNamedEntity(c);break}case State.BeforeEntity:{this.stateBeforeEntity(c);break}case State.InHexEntity:{this.stateInHexEntity(c);break}case State.InNumericEntity:{this.stateInNumericEntity(c);break}default:this.stateBeforeNumericEntity(c)}this.index++}this.cleanup()},Tokenizer3.prototype.finish=function(){this.state===State.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},Tokenizer3.prototype.handleTrailingData=function(){var endIndex=this.buffer.length+this.offset;this.state===State.InCommentLike?this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,endIndex,0):this.cbs.oncomment(this.sectionStart,endIndex,0):this.state===State.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===State.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===State.InTagName||this.state===State.BeforeAttributeName||this.state===State.BeforeAttributeValue||this.state===State.AfterAttributeName||this.state===State.InAttributeName||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueDq||this.state===State.InAttributeValueNq||this.state===State.InClosingTagName||this.cbs.ontext(this.sectionStart,endIndex)},Tokenizer3.prototype.emitPartial=function(start,endIndex){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?this.cbs.onattribdata(start,endIndex):this.cbs.ontext(start,endIndex)},Tokenizer3.prototype.emitCodePoint=function(cp){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?this.cbs.onattribentity(cp):this.cbs.ontextentity(cp)},Tokenizer3}();exports.default=Tokenizer2})(Tokenizer$2);var __createBinding$3=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault$3=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar$3=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding$3(result,mod,k);return __setModuleDefault$3(result,mod),result};Object.defineProperty(Parser$6,"__esModule",{value:!0});Parser$6.Parser=void 0;var Tokenizer_js_1$2=__importStar$3(Tokenizer$2),decode_js_1$2=decode,formTags$2=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag$2=new Set(["p"]),tableSectionTags$2=new Set(["thead","tbody"]),ddtTags$2=new Set(["dd","dt"]),rtpTags$2=new Set(["rt","rp"]),openImpliesClose$2=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag$2],["h1",pTag$2],["h2",pTag$2],["h3",pTag$2],["h4",pTag$2],["h5",pTag$2],["h6",pTag$2],["select",formTags$2],["input",formTags$2],["output",formTags$2],["button",formTags$2],["datalist",formTags$2],["textarea",formTags$2],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags$2],["dt",ddtTags$2],["address",pTag$2],["article",pTag$2],["aside",pTag$2],["blockquote",pTag$2],["details",pTag$2],["div",pTag$2],["dl",pTag$2],["fieldset",pTag$2],["figcaption",pTag$2],["figure",pTag$2],["footer",pTag$2],["form",pTag$2],["header",pTag$2],["hr",pTag$2],["main",pTag$2],["nav",pTag$2],["ol",pTag$2],["pre",pTag$2],["section",pTag$2],["table",pTag$2],["ul",pTag$2],["rt",rtpTags$2],["rp",rtpTags$2],["tbody",tableSectionTags$2],["tfoot",tableSectionTags$2]]),voidElements$2=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements$2=new Set(["math","svg"]),htmlIntegrationElements$2=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd$2=/\s|\//,Parser$5=function(){function Parser3(cbs,options){options===void 0&&(options={});var _a2,_b,_c,_d,_e;this.options=options,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=cbs??{},this.lowerCaseTagNames=(_a2=options.lowerCaseTags)!==null&&_a2!==void 0?_a2:!options.xmlMode,this.lowerCaseAttributeNames=(_b=options.lowerCaseAttributeNames)!==null&&_b!==void 0?_b:!options.xmlMode,this.tokenizer=new((_c=options.Tokenizer)!==null&&_c!==void 0?_c:Tokenizer_js_1$2.default)(this.options,this),(_e=(_d=this.cbs).onparserinit)===null||_e===void 0||_e.call(_d,this)}return __name(Parser3,"Parser"),Parser3.prototype.ontext=function(start,endIndex){var _a2,_b,data=this.getSlice(start,endIndex);this.endIndex=endIndex-1,(_b=(_a2=this.cbs).ontext)===null||_b===void 0||_b.call(_a2,data),this.startIndex=endIndex},Parser3.prototype.ontextentity=function(cp){var _a2,_b,index=this.tokenizer.getSectionStart();this.endIndex=index-1,(_b=(_a2=this.cbs).ontext)===null||_b===void 0||_b.call(_a2,(0,decode_js_1$2.fromCodePoint)(cp)),this.startIndex=index},Parser3.prototype.isVoidElement=function(name){return!this.options.xmlMode&&voidElements$2.has(name)},Parser3.prototype.onopentagname=function(start,endIndex){this.endIndex=endIndex;var name=this.getSlice(start,endIndex);this.lowerCaseTagNames&&(name=name.toLowerCase()),this.emitOpenTag(name)},Parser3.prototype.emitOpenTag=function(name){var _a2,_b,_c,_d;this.openTagStart=this.startIndex,this.tagname=name;var impliesClose=!this.options.xmlMode&&openImpliesClose$2.get(name);if(impliesClose)for(;this.stack.length>0&&impliesClose.has(this.stack[this.stack.length-1]);){var element=this.stack.pop();(_b=(_a2=this.cbs).onclosetag)===null||_b===void 0||_b.call(_a2,element,!0)}this.isVoidElement(name)||(this.stack.push(name),foreignContextElements$2.has(name)?this.foreignContext.push(!0):htmlIntegrationElements$2.has(name)&&this.foreignContext.push(!1)),(_d=(_c=this.cbs).onopentagname)===null||_d===void 0||_d.call(_c,name),this.cbs.onopentag&&(this.attribs={})},Parser3.prototype.endOpenTag=function(isImplied){var _a2,_b;this.startIndex=this.openTagStart,this.attribs&&((_b=(_a2=this.cbs).onopentag)===null||_b===void 0||_b.call(_a2,this.tagname,this.attribs,isImplied),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},Parser3.prototype.onopentagend=function(endIndex){this.endIndex=endIndex,this.endOpenTag(!1),this.startIndex=endIndex+1},Parser3.prototype.onclosetag=function(start,endIndex){var _a2,_b,_c,_d,_e,_f;this.endIndex=endIndex;var name=this.getSlice(start,endIndex);if(this.lowerCaseTagNames&&(name=name.toLowerCase()),(foreignContextElements$2.has(name)||htmlIntegrationElements$2.has(name))&&this.foreignContext.pop(),this.isVoidElement(name))!this.options.xmlMode&&name==="br"&&((_b=(_a2=this.cbs).onopentagname)===null||_b===void 0||_b.call(_a2,"br"),(_d=(_c=this.cbs).onopentag)===null||_d===void 0||_d.call(_c,"br",{},!0),(_f=(_e=this.cbs).onclosetag)===null||_f===void 0||_f.call(_e,"br",!1));else{var pos=this.stack.lastIndexOf(name);if(pos!==-1)if(this.cbs.onclosetag)for(var count2=this.stack.length-pos;count2--;)this.cbs.onclosetag(this.stack.pop(),count2!==0);else this.stack.length=pos;else!this.options.xmlMode&&name==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=endIndex+1},Parser3.prototype.onselfclosingtag=function(endIndex){this.endIndex=endIndex,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=endIndex+1):this.onopentagend(endIndex)},Parser3.prototype.closeCurrentTag=function(isOpenImplied){var _a2,_b,name=this.tagname;this.endOpenTag(isOpenImplied),this.stack[this.stack.length-1]===name&&((_b=(_a2=this.cbs).onclosetag)===null||_b===void 0||_b.call(_a2,name,!isOpenImplied),this.stack.pop())},Parser3.prototype.onattribname=function(start,endIndex){this.startIndex=start;var name=this.getSlice(start,endIndex);this.attribname=this.lowerCaseAttributeNames?name.toLowerCase():name},Parser3.prototype.onattribdata=function(start,endIndex){this.attribvalue+=this.getSlice(start,endIndex)},Parser3.prototype.onattribentity=function(cp){this.attribvalue+=(0,decode_js_1$2.fromCodePoint)(cp)},Parser3.prototype.onattribend=function(quote,endIndex){var _a2,_b;this.endIndex=endIndex,(_b=(_a2=this.cbs).onattribute)===null||_b===void 0||_b.call(_a2,this.attribname,this.attribvalue,quote===Tokenizer_js_1$2.QuoteType.Double?'"':quote===Tokenizer_js_1$2.QuoteType.Single?"'":quote===Tokenizer_js_1$2.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},Parser3.prototype.getInstructionName=function(value){var index=value.search(reNameEnd$2),name=index<0?value:value.substr(0,index);return this.lowerCaseTagNames&&(name=name.toLowerCase()),name},Parser3.prototype.ondeclaration=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction("!".concat(name),"!".concat(value))}this.startIndex=endIndex+1},Parser3.prototype.onprocessinginstruction=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction("?".concat(name),"?".concat(value))}this.startIndex=endIndex+1},Parser3.prototype.oncomment=function(start,endIndex,offset){var _a2,_b,_c,_d;this.endIndex=endIndex,(_b=(_a2=this.cbs).oncomment)===null||_b===void 0||_b.call(_a2,this.getSlice(start,endIndex-offset)),(_d=(_c=this.cbs).oncommentend)===null||_d===void 0||_d.call(_c),this.startIndex=endIndex+1},Parser3.prototype.oncdata=function(start,endIndex,offset){var _a2,_b,_c,_d,_e,_f,_g,_h,_j,_k;this.endIndex=endIndex;var value=this.getSlice(start,endIndex-offset);this.options.xmlMode||this.options.recognizeCDATA?((_b=(_a2=this.cbs).oncdatastart)===null||_b===void 0||_b.call(_a2),(_d=(_c=this.cbs).ontext)===null||_d===void 0||_d.call(_c,value),(_f=(_e=this.cbs).oncdataend)===null||_f===void 0||_f.call(_e)):((_h=(_g=this.cbs).oncomment)===null||_h===void 0||_h.call(_g,"[CDATA[".concat(value,"]]")),(_k=(_j=this.cbs).oncommentend)===null||_k===void 0||_k.call(_j)),this.startIndex=endIndex+1},Parser3.prototype.onend=function(){var _a2,_b;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var index=this.stack.length;index>0;this.cbs.onclosetag(this.stack[--index],!0));}(_b=(_a2=this.cbs).onend)===null||_b===void 0||_b.call(_a2)},Parser3.prototype.reset=function(){var _a2,_b,_c,_d;(_b=(_a2=this.cbs).onreset)===null||_b===void 0||_b.call(_a2),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(_d=(_c=this.cbs).onparserinit)===null||_d===void 0||_d.call(_c,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},Parser3.prototype.parseComplete=function(data){this.reset(),this.end(data)},Parser3.prototype.getSlice=function(start,end){for(;start-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var slice3=this.buffers[0].slice(start-this.bufferOffset,end-this.bufferOffset);end-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),slice3+=this.buffers[0].slice(0,end-this.bufferOffset);return slice3},Parser3.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},Parser3.prototype.write=function(chunk){var _a2,_b;if(this.ended){(_b=(_a2=this.cbs).onerror)===null||_b===void 0||_b.call(_a2,new Error(".write() after done!"));return}this.buffers.push(chunk),this.tokenizer.running&&(this.tokenizer.write(chunk),this.writeIndex++)},Parser3.prototype.end=function(chunk){var _a2,_b;if(this.ended){(_b=(_a2=this.cbs).onerror)===null||_b===void 0||_b.call(_a2,new Error(".end() after done!"));return}chunk&&this.write(chunk),this.ended=!0,this.tokenizer.end()},Parser3.prototype.pause=function(){this.tokenizer.pause()},Parser3.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},Parser3.prototype.parseChunk=function(chunk){this.write(chunk)},Parser3.prototype.done=function(chunk){this.end(chunk)},Parser3}();Parser$6.Parser=Parser$5;var lib$1Q={},lib$1P={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Doctype=exports.CDATA=exports.Tag=exports.Style=exports.Script=exports.Comment=exports.Directive=exports.Text=exports.Root=exports.isTag=exports.ElementType=void 0;var ElementType2;(function(ElementType3){ElementType3.Root="root",ElementType3.Text="text",ElementType3.Directive="directive",ElementType3.Comment="comment",ElementType3.Script="script",ElementType3.Style="style",ElementType3.Tag="tag",ElementType3.CDATA="cdata",ElementType3.Doctype="doctype"})(ElementType2=exports.ElementType||(exports.ElementType={}));function isTag2(elem){return elem.type===ElementType2.Tag||elem.type===ElementType2.Script||elem.type===ElementType2.Style}__name(isTag2,"isTag"),exports.isTag=isTag2,exports.Root=ElementType2.Root,exports.Text=ElementType2.Text,exports.Directive=ElementType2.Directive,exports.Comment=ElementType2.Comment,exports.Script=ElementType2.Script,exports.Style=ElementType2.Style,exports.Tag=ElementType2.Tag,exports.CDATA=ElementType2.CDATA,exports.Doctype=ElementType2.Doctype})(lib$1P);var node={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var extendStatics=__name(function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])},extendStatics(d,b)},"extendStatics");return function(d,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}__name(__,"__"),d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}(),__assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(t){for(var s2,i=1,n=arguments.length;i<n;i++){s2=arguments[i];for(var p in s2)Object.prototype.hasOwnProperty.call(s2,p)&&(t[p]=s2[p])}return t},__assign$1.apply(this,arguments)};Object.defineProperty(node,"__esModule",{value:!0});node.cloneNode=node.hasChildren=node.isDocument=node.isDirective=node.isComment=node.isText=node.isCDATA=node.isTag=node.Element=node.Document=node.CDATA=node.NodeWithChildren=node.ProcessingInstruction=node.Comment=node.Text=node.DataNode=node.Node=void 0;var domelementtype_1$1=lib$1P,Node=function(){function Node2(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return __name(Node2,"Node"),Object.defineProperty(Node2.prototype,"parentNode",{get:function(){return this.parent},set:function(parent){this.parent=parent},enumerable:!1,configurable:!0}),Object.defineProperty(Node2.prototype,"previousSibling",{get:function(){return this.prev},set:function(prev){this.prev=prev},enumerable:!1,configurable:!0}),Object.defineProperty(Node2.prototype,"nextSibling",{get:function(){return this.next},set:function(next){this.next=next},enumerable:!1,configurable:!0}),Node2.prototype.cloneNode=function(recursive){return recursive===void 0&&(recursive=!1),cloneNode(this,recursive)},Node2}();node.Node=Node;var DataNode=function(_super){__extends(DataNode2,_super);function DataNode2(data){var _this=_super.call(this)||this;return _this.data=data,_this}return __name(DataNode2,"DataNode"),Object.defineProperty(DataNode2.prototype,"nodeValue",{get:function(){return this.data},set:function(data){this.data=data},enumerable:!1,configurable:!0}),DataNode2}(Node);node.DataNode=DataNode;var Text=function(_super){__extends(Text2,_super);function Text2(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.type=domelementtype_1$1.ElementType.Text,_this}return __name(Text2,"Text"),Object.defineProperty(Text2.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),Text2}(DataNode);node.Text=Text;var Comment=function(_super){__extends(Comment2,_super);function Comment2(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.type=domelementtype_1$1.ElementType.Comment,_this}return __name(Comment2,"Comment"),Object.defineProperty(Comment2.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),Comment2}(DataNode);node.Comment=Comment;var ProcessingInstruction=function(_super){__extends(ProcessingInstruction2,_super);function ProcessingInstruction2(name,data){var _this=_super.call(this,data)||this;return _this.name=name,_this.type=domelementtype_1$1.ElementType.Directive,_this}return __name(ProcessingInstruction2,"ProcessingInstruction"),Object.defineProperty(ProcessingInstruction2.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),ProcessingInstruction2}(DataNode);node.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(_super){__extends(NodeWithChildren2,_super);function NodeWithChildren2(children){var _this=_super.call(this)||this;return _this.children=children,_this}return __name(NodeWithChildren2,"NodeWithChildren"),Object.defineProperty(NodeWithChildren2.prototype,"firstChild",{get:function(){var _a2;return(_a2=this.children[0])!==null&&_a2!==void 0?_a2:null},enumerable:!1,configurable:!0}),Object.defineProperty(NodeWithChildren2.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(NodeWithChildren2.prototype,"childNodes",{get:function(){return this.children},set:function(children){this.children=children},enumerable:!1,configurable:!0}),NodeWithChildren2}(Node);node.NodeWithChildren=NodeWithChildren;var CDATA=function(_super){__extends(CDATA2,_super);function CDATA2(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.type=domelementtype_1$1.ElementType.CDATA,_this}return __name(CDATA2,"CDATA"),Object.defineProperty(CDATA2.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),CDATA2}(NodeWithChildren);node.CDATA=CDATA;var Document2=function(_super){__extends(Document3,_super);function Document3(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.type=domelementtype_1$1.ElementType.Root,_this}return __name(Document3,"Document"),Object.defineProperty(Document3.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),Document3}(NodeWithChildren);node.Document=Document2;var Element=function(_super){__extends(Element2,_super);function Element2(name,attribs,children,type){children===void 0&&(children=[]),type===void 0&&(type=name==="script"?domelementtype_1$1.ElementType.Script:name==="style"?domelementtype_1$1.ElementType.Style:domelementtype_1$1.ElementType.Tag);var _this=_super.call(this,children)||this;return _this.name=name,_this.attribs=attribs,_this.type=type,_this}return __name(Element2,"Element"),Object.defineProperty(Element2.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(Element2.prototype,"tagName",{get:function(){return this.name},set:function(name){this.name=name},enumerable:!1,configurable:!0}),Object.defineProperty(Element2.prototype,"attributes",{get:function(){var _this=this;return Object.keys(this.attribs).map(function(name){var _a2,_b;return{name,value:_this.attribs[name],namespace:(_a2=_this["x-attribsNamespace"])===null||_a2===void 0?void 0:_a2[name],prefix:(_b=_this["x-attribsPrefix"])===null||_b===void 0?void 0:_b[name]}})},enumerable:!1,configurable:!0}),Element2}(NodeWithChildren);node.Element=Element;function isTag(node2){return(0,domelementtype_1$1.isTag)(node2)}__name(isTag,"isTag");node.isTag=isTag;function isCDATA(node2){return node2.type===domelementtype_1$1.ElementType.CDATA}__name(isCDATA,"isCDATA");node.isCDATA=isCDATA;function isText(node2){return node2.type===domelementtype_1$1.ElementType.Text}__name(isText,"isText");node.isText=isText;function isComment(node2){return node2.type===domelementtype_1$1.ElementType.Comment}__name(isComment,"isComment");node.isComment=isComment;function isDirective(node2){return node2.type===domelementtype_1$1.ElementType.Directive}__name(isDirective,"isDirective");node.isDirective=isDirective;function isDocument(node2){return node2.type===domelementtype_1$1.ElementType.Root}__name(isDocument,"isDocument");node.isDocument=isDocument;function hasChildren(node2){return Object.prototype.hasOwnProperty.call(node2,"children")}__name(hasChildren,"hasChildren");node.hasChildren=hasChildren;function cloneNode(node2,recursive){recursive===void 0&&(recursive=!1);var result;if(isText(node2))result=new Text(node2.data);else if(isComment(node2))result=new Comment(node2.data);else if(isTag(node2)){var children=recursive?cloneChildren(node2.children):[],clone_1=new Element(node2.name,__assign$1({},node2.attribs),children);children.forEach(function(child){return child.parent=clone_1}),node2.namespace!=null&&(clone_1.namespace=node2.namespace),node2["x-attribsNamespace"]&&(clone_1["x-attribsNamespace"]=__assign$1({},node2["x-attribsNamespace"])),node2["x-attribsPrefix"]&&(clone_1["x-attribsPrefix"]=__assign$1({},node2["x-attribsPrefix"])),result=clone_1}else if(isCDATA(node2)){var children=recursive?cloneChildren(node2.children):[],clone_2=new CDATA(children);children.forEach(function(child){return child.parent=clone_2}),result=clone_2}else if(isDocument(node2)){var children=recursive?cloneChildren(node2.children):[],clone_3=new Document2(children);children.forEach(function(child){return child.parent=clone_3}),node2["x-mode"]&&(clone_3["x-mode"]=node2["x-mode"]),result=clone_3}else if(isDirective(node2)){var instruction=new ProcessingInstruction(node2.name,node2.data);node2["x-name"]!=null&&(instruction["x-name"]=node2["x-name"],instruction["x-publicId"]=node2["x-publicId"],instruction["x-systemId"]=node2["x-systemId"]),result=instruction}else throw new Error("Not implemented yet: ".concat(node2.type));return result.startIndex=node2.startIndex,result.endIndex=node2.endIndex,node2.sourceCodeLocation!=null&&(result.sourceCodeLocation=node2.sourceCodeLocation),result}__name(cloneNode,"cloneNode");node.cloneNode=cloneNode;function cloneChildren(childs){for(var children=childs.map(function(child){return cloneNode(child,!0)}),i=1;i<children.length;i++)children[i].prev=children[i-1],children[i-1].next=children[i];return children}__name(cloneChildren,"cloneChildren");(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DomHandler=void 0;var domelementtype_12=lib$1P,node_js_1=node;__exportStar(node,exports);var defaultOpts={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},DomHandler=function(){function DomHandler2(callback,options,elementCB){this.dom=[],this.root=new node_js_1.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof options=="function"&&(elementCB=options,options=defaultOpts),typeof callback=="object"&&(options=callback,callback=void 0),this.callback=callback??null,this.options=options??defaultOpts,this.elementCB=elementCB??null}return __name(DomHandler2,"DomHandler"),DomHandler2.prototype.onparserinit=function(parser){this.parser=parser},DomHandler2.prototype.onreset=function(){this.dom=[],this.root=new node_js_1.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},DomHandler2.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},DomHandler2.prototype.onerror=function(error){this.handleCallback(error)},DomHandler2.prototype.onclosetag=function(){this.lastNode=null;var elem=this.tagStack.pop();this.options.withEndIndices&&(elem.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(elem)},DomHandler2.prototype.onopentag=function(name,attribs){var type=this.options.xmlMode?domelementtype_12.ElementType.Tag:void 0,element=new node_js_1.Element(name,attribs,void 0,type);this.addNode(element),this.tagStack.push(element)},DomHandler2.prototype.ontext=function(data){var lastNode=this.lastNode;if(lastNode&&lastNode.type===domelementtype_12.ElementType.Text)lastNode.data+=data,this.options.withEndIndices&&(lastNode.endIndex=this.parser.endIndex);else{var node2=new node_js_1.Text(data);this.addNode(node2),this.lastNode=node2}},DomHandler2.prototype.oncomment=function(data){if(this.lastNode&&this.lastNode.type===domelementtype_12.ElementType.Comment){this.lastNode.data+=data;return}var node2=new node_js_1.Comment(data);this.addNode(node2),this.lastNode=node2},DomHandler2.prototype.oncommentend=function(){this.lastNode=null},DomHandler2.prototype.oncdatastart=function(){var text=new node_js_1.Text(""),node2=new node_js_1.CDATA([text]);this.addNode(node2),text.parent=node2,this.lastNode=text},DomHandler2.prototype.oncdataend=function(){this.lastNode=null},DomHandler2.prototype.onprocessinginstruction=function(name,data){var node2=new node_js_1.ProcessingInstruction(name,data);this.addNode(node2)},DomHandler2.prototype.handleCallback=function(error){if(typeof this.callback=="function")this.callback(error,this.dom);else if(error)throw error},DomHandler2.prototype.addNode=function(node2){var parent=this.tagStack[this.tagStack.length-1],previousSibling=parent.children[parent.children.length-1];this.options.withStartIndices&&(node2.startIndex=this.parser.startIndex),this.options.withEndIndices&&(node2.endIndex=this.parser.endIndex),parent.children.push(node2),previousSibling&&(node2.prev=previousSibling,previousSibling.next=node2),node2.parent=parent,this.lastNode=null},DomHandler2}();exports.DomHandler=DomHandler,exports.default=DomHandler})(lib$1Q);var lib$1O={},stringify$1={},lib$1N={},lib$1M={},encode={},encodeHtml={};Object.defineProperty(encodeHtml,"__esModule",{value:!0});function restoreDiff(arr){for(var i=1;i<arr.length;i++)arr[i][0]+=arr[i-1][0]+1;return arr}__name(restoreDiff,"restoreDiff");encodeHtml.default=new Map(restoreDiff([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(restoreDiff([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(restoreDiff([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(restoreDiff([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var _escape={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.escapeText=exports.escapeAttribute=exports.escapeUTF8=exports.escape=exports.encodeXML=exports.getCodePoint=exports.xmlReplacer=void 0,exports.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var xmlCodeMap=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);exports.getCodePoint=String.prototype.codePointAt!=null?function(str,index){return str.codePointAt(index)}:function(c,index){return(c.charCodeAt(index)&64512)===55296?(c.charCodeAt(index)-55296)*1024+c.charCodeAt(index+1)-56320+65536:c.charCodeAt(index)};function encodeXML(str){for(var ret="",lastIdx=0,match;(match=exports.xmlReplacer.exec(str))!==null;){var i=match.index,char=str.charCodeAt(i),next=xmlCodeMap.get(char);next!==void 0?(ret+=str.substring(lastIdx,i)+next,lastIdx=i+1):(ret+="".concat(str.substring(lastIdx,i),"&#x").concat((0,exports.getCodePoint)(str,i).toString(16),";"),lastIdx=exports.xmlReplacer.lastIndex+=+((char&64512)===55296))}return ret+str.substr(lastIdx)}__name(encodeXML,"encodeXML"),exports.encodeXML=encodeXML,exports.escape=encodeXML;function getEscaper(regex,map2){return __name(function(data){for(var match,lastIdx=0,result="";match=regex.exec(data);)lastIdx!==match.index&&(result+=data.substring(lastIdx,match.index)),result+=map2.get(match[0].charCodeAt(0)),lastIdx=match.index+1;return result+data.substring(lastIdx)},"escape")}__name(getEscaper,"getEscaper"),exports.escapeUTF8=getEscaper(/[&<>'"]/g,xmlCodeMap),exports.escapeAttribute=getEscaper(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),exports.escapeText=getEscaper(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(_escape);var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(encode,"__esModule",{value:!0});encode.encodeNonAsciiHTML=encode.encodeHTML=void 0;var encode_html_js_1=__importDefault$1(encodeHtml),escape_js_1=_escape,htmlReplacer=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function encodeHTML(data){return encodeHTMLTrieRe(htmlReplacer,data)}__name(encodeHTML,"encodeHTML");encode.encodeHTML=encodeHTML;function encodeNonAsciiHTML(data){return encodeHTMLTrieRe(escape_js_1.xmlReplacer,data)}__name(encodeNonAsciiHTML,"encodeNonAsciiHTML");encode.encodeNonAsciiHTML=encodeNonAsciiHTML;function encodeHTMLTrieRe(regExp,str){for(var ret="",lastIdx=0,match;(match=regExp.exec(str))!==null;){var i=match.index;ret+=str.substring(lastIdx,i);var char=str.charCodeAt(i),next=encode_html_js_1.default.get(char);if(typeof next=="object"){if(i+1<str.length){var nextChar=str.charCodeAt(i+1),value=typeof next.n=="number"?next.n===nextChar?next.o:void 0:next.n.get(nextChar);if(value!==void 0){ret+=value,lastIdx=regExp.lastIndex+=1;continue}}next=next.v}if(next!==void 0)ret+=next,lastIdx=i+1;else{var cp=(0,escape_js_1.getCodePoint)(str,i);ret+="&#x".concat(cp.toString(16),";"),lastIdx=regExp.lastIndex+=+(cp!==char)}}return ret+str.substr(lastIdx)}__name(encodeHTMLTrieRe,"encodeHTMLTrieRe");(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeXMLStrict=exports.decodeHTML5Strict=exports.decodeHTML4Strict=exports.decodeHTML5=exports.decodeHTML4=exports.decodeHTMLAttribute=exports.decodeHTMLStrict=exports.decodeHTML=exports.decodeXML=exports.DecodingMode=exports.EntityDecoder=exports.encodeHTML5=exports.encodeHTML4=exports.encodeNonAsciiHTML=exports.encodeHTML=exports.escapeText=exports.escapeAttribute=exports.escapeUTF8=exports.escape=exports.encodeXML=exports.encode=exports.decodeStrict=exports.decode=exports.EncodingMode=exports.EntityLevel=void 0;var decode_js_12=decode,encode_js_1=encode,escape_js_12=_escape,EntityLevel;(function(EntityLevel2){EntityLevel2[EntityLevel2.XML=0]="XML",EntityLevel2[EntityLevel2.HTML=1]="HTML"})(EntityLevel=exports.EntityLevel||(exports.EntityLevel={}));var EncodingMode;(function(EncodingMode2){EncodingMode2[EncodingMode2.UTF8=0]="UTF8",EncodingMode2[EncodingMode2.ASCII=1]="ASCII",EncodingMode2[EncodingMode2.Extensive=2]="Extensive",EncodingMode2[EncodingMode2.Attribute=3]="Attribute",EncodingMode2[EncodingMode2.Text=4]="Text"})(EncodingMode=exports.EncodingMode||(exports.EncodingMode={}));function decode$1(data,options){options===void 0&&(options=EntityLevel.XML);var level=typeof options=="number"?options:options.level;if(level===EntityLevel.HTML){var mode=typeof options=="object"?options.mode:void 0;return(0,decode_js_12.decodeHTML)(data,mode)}return(0,decode_js_12.decodeXML)(data)}__name(decode$1,"decode$1"),exports.decode=decode$1;function decodeStrict(data,options){var _a2;options===void 0&&(options=EntityLevel.XML);var opts=typeof options=="number"?{level:options}:options;return(_a2=opts.mode)!==null&&_a2!==void 0||(opts.mode=decode_js_12.DecodingMode.Strict),decode$1(data,opts)}__name(decodeStrict,"decodeStrict"),exports.decodeStrict=decodeStrict;function encode$1(data,options){options===void 0&&(options=EntityLevel.XML);var opts=typeof options=="number"?{level:options}:options;return opts.mode===EncodingMode.UTF8?(0,escape_js_12.escapeUTF8)(data):opts.mode===EncodingMode.Attribute?(0,escape_js_12.escapeAttribute)(data):opts.mode===EncodingMode.Text?(0,escape_js_12.escapeText)(data):opts.level===EntityLevel.HTML?opts.mode===EncodingMode.ASCII?(0,encode_js_1.encodeNonAsciiHTML)(data):(0,encode_js_1.encodeHTML)(data):(0,escape_js_12.encodeXML)(data)}__name(encode$1,"encode$1"),exports.encode=encode$1;var escape_js_2=_escape;Object.defineProperty(exports,"encodeXML",{enumerable:!0,get:function(){return escape_js_2.encodeXML}}),Object.defineProperty(exports,"escape",{enumerable:!0,get:function(){return escape_js_2.escape}}),Object.defineProperty(exports,"escapeUTF8",{enumerable:!0,get:function(){return escape_js_2.escapeUTF8}}),Object.defineProperty(exports,"escapeAttribute",{enumerable:!0,get:function(){return escape_js_2.escapeAttribute}}),Object.defineProperty(exports,"escapeText",{enumerable:!0,get:function(){return escape_js_2.escapeText}});var encode_js_2=encode;Object.defineProperty(exports,"encodeHTML",{enumerable:!0,get:function(){return encode_js_2.encodeHTML}}),Object.defineProperty(exports,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return encode_js_2.encodeNonAsciiHTML}}),Object.defineProperty(exports,"encodeHTML4",{enumerable:!0,get:function(){return encode_js_2.encodeHTML}}),Object.defineProperty(exports,"encodeHTML5",{enumerable:!0,get:function(){return encode_js_2.encodeHTML}});var decode_js_2=decode;Object.defineProperty(exports,"EntityDecoder",{enumerable:!0,get:function(){return decode_js_2.EntityDecoder}}),Object.defineProperty(exports,"DecodingMode",{enumerable:!0,get:function(){return decode_js_2.DecodingMode}}),Object.defineProperty(exports,"decodeXML",{enumerable:!0,get:function(){return decode_js_2.decodeXML}}),Object.defineProperty(exports,"decodeHTML",{enumerable:!0,get:function(){return decode_js_2.decodeHTML}}),Object.defineProperty(exports,"decodeHTMLStrict",{enumerable:!0,get:function(){return decode_js_2.decodeHTMLStrict}}),Object.defineProperty(exports,"decodeHTMLAttribute",{enumerable:!0,get:function(){return decode_js_2.decodeHTMLAttribute}}),Object.defineProperty(exports,"decodeHTML4",{enumerable:!0,get:function(){return decode_js_2.decodeHTML}}),Object.defineProperty(exports,"decodeHTML5",{enumerable:!0,get:function(){return decode_js_2.decodeHTML}}),Object.defineProperty(exports,"decodeHTML4Strict",{enumerable:!0,get:function(){return decode_js_2.decodeHTMLStrict}}),Object.defineProperty(exports,"decodeHTML5Strict",{enumerable:!0,get:function(){return decode_js_2.decodeHTMLStrict}}),Object.defineProperty(exports,"decodeXMLStrict",{enumerable:!0,get:function(){return decode_js_2.decodeXML}})})(lib$1M);var foreignNames={};Object.defineProperty(foreignNames,"__esModule",{value:!0});foreignNames.attributeNames=foreignNames.elementNames=void 0;foreignNames.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(val){return[val.toLowerCase(),val]}));foreignNames.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(val){return[val.toLowerCase(),val]}));var __assign=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign=Object.assign||function(t){for(var s2,i=1,n=arguments.length;i<n;i++){s2=arguments[i];for(var p in s2)Object.prototype.hasOwnProperty.call(s2,p)&&(t[p]=s2[p])}return t},__assign.apply(this,arguments)},__createBinding$2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault$2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar$2=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding$2(result,mod,k);return __setModuleDefault$2(result,mod),result};Object.defineProperty(lib$1N,"__esModule",{value:!0});lib$1N.render=void 0;var ElementType=__importStar$2(lib$1P),entities_1=lib$1M,foreignNames_js_1=foreignNames,unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(value){return value.replace(/"/g,"&quot;")}__name(replaceQuotes,"replaceQuotes");function formatAttributes(attributes,opts){var _a2;if(attributes){var encode2=((_a2=opts.encodeEntities)!==null&&_a2!==void 0?_a2:opts.decodeEntities)===!1?replaceQuotes:opts.xmlMode||opts.encodeEntities!=="utf8"?entities_1.encodeXML:entities_1.escapeAttribute;return Object.keys(attributes).map(function(key){var _a3,_b,value=(_a3=attributes[key])!==null&&_a3!==void 0?_a3:"";return opts.xmlMode==="foreign"&&(key=(_b=foreignNames_js_1.attributeNames.get(key))!==null&&_b!==void 0?_b:key),!opts.emptyAttrs&&!opts.xmlMode&&value===""?key:"".concat(key,'="').concat(encode2(value),'"')}).join(" ")}}__name(formatAttributes,"formatAttributes");var singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(node2,options){options===void 0&&(options={});for(var nodes=("length"in node2)?node2:[node2],output="",i=0;i<nodes.length;i++)output+=renderNode(nodes[i],options);return output}__name(render,"render");lib$1N.render=render;lib$1N.default=render;function renderNode(node2,options){switch(node2.type){case ElementType.Root:return render(node2.children,options);case ElementType.Doctype:case ElementType.Directive:return renderDirective(node2);case ElementType.Comment:return renderComment(node2);case ElementType.CDATA:return renderCdata(node2);case ElementType.Script:case ElementType.Style:case ElementType.Tag:return renderTag(node2,options);case ElementType.Text:return renderText(node2,options)}}__name(renderNode,"renderNode");var foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(elem,opts){var _a2;opts.xmlMode==="foreign"&&(elem.name=(_a2=foreignNames_js_1.elementNames.get(elem.name))!==null&&_a2!==void 0?_a2:elem.name,elem.parent&&foreignModeIntegrationPoints.has(elem.parent.name)&&(opts=__assign(__assign({},opts),{xmlMode:!1}))),!opts.xmlMode&&foreignElements.has(elem.name)&&(opts=__assign(__assign({},opts),{xmlMode:"foreign"}));var tag="<".concat(elem.name),attribs=formatAttributes(elem.attribs,opts);return attribs&&(tag+=" ".concat(attribs)),elem.children.length===0&&(opts.xmlMode?opts.selfClosingTags!==!1:opts.selfClosingTags&&singleTag.has(elem.name))?(opts.xmlMode||(tag+=" "),tag+="/>"):(tag+=">",elem.children.length>0&&(tag+=render(elem.children,opts)),(opts.xmlMode||!singleTag.has(elem.name))&&(tag+="</".concat(elem.name,">"))),tag}__name(renderTag,"renderTag");function renderDirective(elem){return"<".concat(elem.data,">")}__name(renderDirective,"renderDirective");function renderText(elem,opts){var _a2,data=elem.data||"";return((_a2=opts.encodeEntities)!==null&&_a2!==void 0?_a2:opts.decodeEntities)!==!1&&!(!opts.xmlMode&&elem.parent&&unencodedElements.has(elem.parent.name))&&(data=opts.xmlMode||opts.encodeEntities!=="utf8"?(0,entities_1.encodeXML)(data):(0,entities_1.escapeText)(data)),data}__name(renderText,"renderText");function renderCdata(elem){return"<![CDATA[".concat(elem.children[0].data,"]]>")}__name(renderCdata,"renderCdata");function renderComment(elem){return"<!--".concat(elem.data,"-->")}__name(renderComment,"renderComment");var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(stringify$1,"__esModule",{value:!0});stringify$1.innerText=stringify$1.textContent=stringify$1.getText=stringify$1.getInnerHTML=stringify$1.getOuterHTML=void 0;var domhandler_1$3=lib$1Q,dom_serializer_1=__importDefault(lib$1N),domelementtype_1=lib$1P;function getOuterHTML(node2,options){return(0,dom_serializer_1.default)(node2,options)}__name(getOuterHTML,"getOuterHTML");stringify$1.getOuterHTML=getOuterHTML;function getInnerHTML(node2,options){return(0,domhandler_1$3.hasChildren)(node2)?node2.children.map(function(node3){return getOuterHTML(node3,options)}).join(""):""}__name(getInnerHTML,"getInnerHTML");stringify$1.getInnerHTML=getInnerHTML;function getText(node2){return Array.isArray(node2)?node2.map(getText).join(""):(0,domhandler_1$3.isTag)(node2)?node2.name==="br"?`
`:getText(node2.children):(0,domhandler_1$3.isCDATA)(node2)?getText(node2.children):(0,domhandler_1$3.isText)(node2)?node2.data:""}__name(getText,"getText");stringify$1.getText=getText;function textContent(node2){return Array.isArray(node2)?node2.map(textContent).join(""):(0,domhandler_1$3.hasChildren)(node2)&&!(0,domhandler_1$3.isComment)(node2)?textContent(node2.children):(0,domhandler_1$3.isText)(node2)?node2.data:""}__name(textContent,"textContent");stringify$1.textContent=textContent;function innerText(node2){return Array.isArray(node2)?node2.map(innerText).join(""):(0,domhandler_1$3.hasChildren)(node2)&&(node2.type===domelementtype_1.ElementType.Tag||(0,domhandler_1$3.isCDATA)(node2))?innerText(node2.children):(0,domhandler_1$3.isText)(node2)?node2.data:""}__name(innerText,"innerText");stringify$1.innerText=innerText;var traversal={};Object.defineProperty(traversal,"__esModule",{value:!0});traversal.prevElementSibling=traversal.nextElementSibling=traversal.getName=traversal.hasAttrib=traversal.getAttributeValue=traversal.getSiblings=traversal.getParent=traversal.getChildren=void 0;var domhandler_1$2=lib$1Q;function getChildren(elem){return(0,domhandler_1$2.hasChildren)(elem)?elem.children:[]}__name(getChildren,"getChildren");traversal.getChildren=getChildren;function getParent(elem){return elem.parent||null}__name(getParent,"getParent");traversal.getParent=getParent;function getSiblings(elem){var _a2,_b,parent=getParent(elem);if(parent!=null)return getChildren(parent);for(var siblings=[elem],prev=elem.prev,next=elem.next;prev!=null;)siblings.unshift(prev),_a2=prev,prev=_a2.prev;for(;next!=null;)siblings.push(next),_b=next,next=_b.next;return siblings}__name(getSiblings,"getSiblings");traversal.getSiblings=getSiblings;function getAttributeValue(elem,name){var _a2;return(_a2=elem.attribs)===null||_a2===void 0?void 0:_a2[name]}__name(getAttributeValue,"getAttributeValue");traversal.getAttributeValue=getAttributeValue;function hasAttrib(elem,name){return elem.attribs!=null&&Object.prototype.hasOwnProperty.call(elem.attribs,name)&&elem.attribs[name]!=null}__name(hasAttrib,"hasAttrib");traversal.hasAttrib=hasAttrib;function getName(elem){return elem.name}__name(getName,"getName");traversal.getName=getName;function nextElementSibling(elem){for(var _a2,next=elem.next;next!==null&&!(0,domhandler_1$2.isTag)(next);)_a2=next,next=_a2.next;return next}__name(nextElementSibling,"nextElementSibling");traversal.nextElementSibling=nextElementSibling;function prevElementSibling(elem){for(var _a2,prev=elem.prev;prev!==null&&!(0,domhandler_1$2.isTag)(prev);)_a2=prev,prev=_a2.prev;return prev}__name(prevElementSibling,"prevElementSibling");traversal.prevElementSibling=prevElementSibling;var manipulation={};Object.defineProperty(manipulation,"__esModule",{value:!0});manipulation.prepend=manipulation.prependChild=manipulation.append=manipulation.appendChild=manipulation.replaceElement=manipulation.removeElement=void 0;function removeElement(elem){if(elem.prev&&(elem.prev.next=elem.next),elem.next&&(elem.next.prev=elem.prev),elem.parent){var childs=elem.parent.children,childsIndex=childs.lastIndexOf(elem);childsIndex>=0&&childs.splice(childsIndex,1)}elem.next=null,elem.prev=null,elem.parent=null}__name(removeElement,"removeElement");manipulation.removeElement=removeElement;function replaceElement(elem,replacement){var prev=replacement.prev=elem.prev;prev&&(prev.next=replacement);var next=replacement.next=elem.next;next&&(next.prev=replacement);var parent=replacement.parent=elem.parent;if(parent){var childs=parent.children;childs[childs.lastIndexOf(elem)]=replacement,elem.parent=null}}__name(replaceElement,"replaceElement");manipulation.replaceElement=replaceElement;function appendChild(parent,child){if(removeElement(child),child.next=null,child.parent=parent,parent.children.push(child)>1){var sibling=parent.children[parent.children.length-2];sibling.next=child,child.prev=sibling}else child.prev=null}__name(appendChild,"appendChild");manipulation.appendChild=appendChild;function append(elem,next){removeElement(next);var parent=elem.parent,currNext=elem.next;if(next.next=currNext,next.prev=elem,elem.next=next,next.parent=parent,currNext){if(currNext.prev=next,parent){var childs=parent.children;childs.splice(childs.lastIndexOf(currNext),0,next)}}else parent&&parent.children.push(next)}__name(append,"append");manipulation.append=append;function prependChild(parent,child){if(removeElement(child),child.parent=parent,child.prev=null,parent.children.unshift(child)!==1){var sibling=parent.children[1];sibling.prev=child,child.next=sibling}else child.next=null}__name(prependChild,"prependChild");manipulation.prependChild=prependChild;function prepend(elem,prev){removeElement(prev);var parent=elem.parent;if(parent){var childs=parent.children;childs.splice(childs.indexOf(elem),0,prev)}elem.prev&&(elem.prev.next=prev),prev.parent=parent,prev.prev=elem.prev,prev.next=elem,elem.prev=prev}__name(prepend,"prepend");manipulation.prepend=prepend;var querying={};Object.defineProperty(querying,"__esModule",{value:!0});querying.findAll=querying.existsOne=querying.findOne=querying.findOneChild=querying.find=querying.filter=void 0;var domhandler_1$1=lib$1Q;function filter3(test,node2,recurse,limit){return recurse===void 0&&(recurse=!0),limit===void 0&&(limit=1/0),find2(test,Array.isArray(node2)?node2:[node2],recurse,limit)}__name(filter3,"filter");querying.filter=filter3;function find2(test,nodes,recurse,limit){for(var result=[],nodeStack=[nodes],indexStack=[0];;){if(indexStack[0]>=nodeStack[0].length){if(indexStack.length===1)return result;nodeStack.shift(),indexStack.shift();continue}var elem=nodeStack[0][indexStack[0]++];if(test(elem)&&(result.push(elem),--limit<=0))return result;recurse&&(0,domhandler_1$1.hasChildren)(elem)&&elem.children.length>0&&(indexStack.unshift(0),nodeStack.unshift(elem.children))}}__name(find2,"find");querying.find=find2;function findOneChild(test,nodes){return nodes.find(test)}__name(findOneChild,"findOneChild");querying.findOneChild=findOneChild;function findOne(test,nodes,recurse){recurse===void 0&&(recurse=!0);for(var elem=null,i=0;i<nodes.length&&!elem;i++){var node2=nodes[i];if((0,domhandler_1$1.isTag)(node2))test(node2)?elem=node2:recurse&&node2.children.length>0&&(elem=findOne(test,node2.children,!0));else continue}return elem}__name(findOne,"findOne");querying.findOne=findOne;function existsOne(test,nodes){return nodes.some(function(checked){return(0,domhandler_1$1.isTag)(checked)&&(test(checked)||existsOne(test,checked.children))})}__name(existsOne,"existsOne");querying.existsOne=existsOne;function findAll(test,nodes){for(var result=[],nodeStack=[nodes],indexStack=[0];;){if(indexStack[0]>=nodeStack[0].length){if(nodeStack.length===1)return result;nodeStack.shift(),indexStack.shift();continue}var elem=nodeStack[0][indexStack[0]++];(0,domhandler_1$1.isTag)(elem)&&(test(elem)&&result.push(elem),elem.children.length>0&&(indexStack.unshift(0),nodeStack.unshift(elem.children)))}}__name(findAll,"findAll");querying.findAll=findAll;var legacy={};Object.defineProperty(legacy,"__esModule",{value:!0});legacy.getElementsByTagType=legacy.getElementsByTagName=legacy.getElementById=legacy.getElements=legacy.testElement=void 0;var domhandler_1=lib$1Q,querying_js_1=querying,Checks={tag_name:function(name){return typeof name=="function"?function(elem){return(0,domhandler_1.isTag)(elem)&&name(elem.name)}:name==="*"?domhandler_1.isTag:function(elem){return(0,domhandler_1.isTag)(elem)&&elem.name===name}},tag_type:function(type){return typeof type=="function"?function(elem){return type(elem.type)}:function(elem){return elem.type===type}},tag_contains:function(data){return typeof data=="function"?function(elem){return(0,domhandler_1.isText)(elem)&&data(elem.data)}:function(elem){return(0,domhandler_1.isText)(elem)&&elem.data===data}}};function getAttribCheck(attrib,value){return typeof value=="function"?function(elem){return(0,domhandler_1.isTag)(elem)&&value(elem.attribs[attrib])}:function(elem){return(0,domhandler_1.isTag)(elem)&&elem.attribs[attrib]===value}}__name(getAttribCheck,"getAttribCheck");function combineFuncs(a,b){return function(elem){return a(elem)||b(elem)}}__name(combineFuncs,"combineFuncs");function compileTest(options){var funcs=Object.keys(options).map(function(key){var value=options[key];return Object.prototype.hasOwnProperty.call(Checks,key)?Checks[key](value):getAttribCheck(key,value)});return funcs.length===0?null:funcs.reduce(combineFuncs)}__name(compileTest,"compileTest");function testElement(options,node2){var test=compileTest(options);return test?test(node2):!0}__name(testElement,"testElement");legacy.testElement=testElement;function getElements(options,nodes,recurse,limit){limit===void 0&&(limit=1/0);var test=compileTest(options);return test?(0,querying_js_1.filter)(test,nodes,recurse,limit):[]}__name(getElements,"getElements");legacy.getElements=getElements;function getElementById(id,nodes,recurse){return recurse===void 0&&(recurse=!0),Array.isArray(nodes)||(nodes=[nodes]),(0,querying_js_1.findOne)(getAttribCheck("id",id),nodes,recurse)}__name(getElementById,"getElementById");legacy.getElementById=getElementById;function getElementsByTagName(tagName,nodes,recurse,limit){return recurse===void 0&&(recurse=!0),limit===void 0&&(limit=1/0),(0,querying_js_1.filter)(Checks.tag_name(tagName),nodes,recurse,limit)}__name(getElementsByTagName,"getElementsByTagName");legacy.getElementsByTagName=getElementsByTagName;function getElementsByTagType(type,nodes,recurse,limit){return recurse===void 0&&(recurse=!0),limit===void 0&&(limit=1/0),(0,querying_js_1.filter)(Checks.tag_type(type),nodes,recurse,limit)}__name(getElementsByTagType,"getElementsByTagType");legacy.getElementsByTagType=getElementsByTagType;var helpers={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.uniqueSort=exports.compareDocumentPosition=exports.DocumentPosition=exports.removeSubsets=void 0;var domhandler_12=lib$1Q;function removeSubsets(nodes){for(var idx=nodes.length;--idx>=0;){var node2=nodes[idx];if(idx>0&&nodes.lastIndexOf(node2,idx-1)>=0){nodes.splice(idx,1);continue}for(var ancestor=node2.parent;ancestor;ancestor=ancestor.parent)if(nodes.includes(ancestor)){nodes.splice(idx,1);break}}return nodes}__name(removeSubsets,"removeSubsets"),exports.removeSubsets=removeSubsets;var DocumentPosition;(function(DocumentPosition2){DocumentPosition2[DocumentPosition2.DISCONNECTED=1]="DISCONNECTED",DocumentPosition2[DocumentPosition2.PRECEDING=2]="PRECEDING",DocumentPosition2[DocumentPosition2.FOLLOWING=4]="FOLLOWING",DocumentPosition2[DocumentPosition2.CONTAINS=8]="CONTAINS",DocumentPosition2[DocumentPosition2.CONTAINED_BY=16]="CONTAINED_BY"})(DocumentPosition=exports.DocumentPosition||(exports.DocumentPosition={}));function compareDocumentPosition(nodeA,nodeB){var aParents=[],bParents=[];if(nodeA===nodeB)return 0;for(var current=(0,domhandler_12.hasChildren)(nodeA)?nodeA:nodeA.parent;current;)aParents.unshift(current),current=current.parent;for(current=(0,domhandler_12.hasChildren)(nodeB)?nodeB:nodeB.parent;current;)bParents.unshift(current),current=current.parent;for(var maxIdx=Math.min(aParents.length,bParents.length),idx=0;idx<maxIdx&&aParents[idx]===bParents[idx];)idx++;if(idx===0)return DocumentPosition.DISCONNECTED;var sharedParent=aParents[idx-1],siblings=sharedParent.children,aSibling=aParents[idx],bSibling=bParents[idx];return siblings.indexOf(aSibling)>siblings.indexOf(bSibling)?sharedParent===nodeB?DocumentPosition.FOLLOWING|DocumentPosition.CONTAINED_BY:DocumentPosition.FOLLOWING:sharedParent===nodeA?DocumentPosition.PRECEDING|DocumentPosition.CONTAINS:DocumentPosition.PRECEDING}__name(compareDocumentPosition,"compareDocumentPosition"),exports.compareDocumentPosition=compareDocumentPosition;function uniqueSort(nodes){return nodes=nodes.filter(function(node2,i,arr){return!arr.includes(node2,i+1)}),nodes.sort(function(a,b){var relative=compareDocumentPosition(a,b);return relative&DocumentPosition.PRECEDING?-1:relative&DocumentPosition.FOLLOWING?1:0}),nodes}__name(uniqueSort,"uniqueSort"),exports.uniqueSort=uniqueSort})(helpers);var feeds={};Object.defineProperty(feeds,"__esModule",{value:!0});feeds.getFeed=void 0;var stringify_js_1=stringify$1,legacy_js_1=legacy;function getFeed(doc){var feedRoot=getOneElement(isValidFeed,doc);return feedRoot?feedRoot.name==="feed"?getAtomFeed(feedRoot):getRssFeed(feedRoot):null}__name(getFeed,"getFeed");feeds.getFeed=getFeed;function getAtomFeed(feedRoot){var _a2,childs=feedRoot.children,feed={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",childs).map(function(item){var _a3,children=item.children,entry={media:getMediaElements(children)};addConditionally(entry,"id","id",children),addConditionally(entry,"title","title",children);var href2=(_a3=getOneElement("link",children))===null||_a3===void 0?void 0:_a3.attribs.href;href2&&(entry.link=href2);var description=fetch$1("summary",children)||fetch$1("content",children);description&&(entry.description=description);var pubDate=fetch$1("updated",children);return pubDate&&(entry.pubDate=new Date(pubDate)),entry})};addConditionally(feed,"id","id",childs),addConditionally(feed,"title","title",childs);var href=(_a2=getOneElement("link",childs))===null||_a2===void 0?void 0:_a2.attribs.href;href&&(feed.link=href),addConditionally(feed,"description","subtitle",childs);var updated=fetch$1("updated",childs);return updated&&(feed.updated=new Date(updated)),addConditionally(feed,"author","email",childs,!0),feed}__name(getAtomFeed,"getAtomFeed");function getRssFeed(feedRoot){var _a2,_b,childs=(_b=(_a2=getOneElement("channel",feedRoot.children))===null||_a2===void 0?void 0:_a2.children)!==null&&_b!==void 0?_b:[],feed={type:feedRoot.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",feedRoot.children).map(function(item){var children=item.children,entry={media:getMediaElements(children)};addConditionally(entry,"id","guid",children),addConditionally(entry,"title","title",children),addConditionally(entry,"link","link",children),addConditionally(entry,"description","description",children);var pubDate=fetch$1("pubDate",children)||fetch$1("dc:date",children);return pubDate&&(entry.pubDate=new Date(pubDate)),entry})};addConditionally(feed,"title","title",childs),addConditionally(feed,"link","link",childs),addConditionally(feed,"description","description",childs);var updated=fetch$1("lastBuildDate",childs);return updated&&(feed.updated=new Date(updated)),addConditionally(feed,"author","managingEditor",childs,!0),feed}__name(getRssFeed,"getRssFeed");var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(where){return(0,legacy_js_1.getElementsByTagName)("media:content",where).map(function(elem){for(var attribs=elem.attribs,media={medium:attribs.medium,isDefault:!!attribs.isDefault},_i=0,MEDIA_KEYS_STRING_1=MEDIA_KEYS_STRING;_i<MEDIA_KEYS_STRING_1.length;_i++){var attrib=MEDIA_KEYS_STRING_1[_i];attribs[attrib]&&(media[attrib]=attribs[attrib])}for(var _a2=0,MEDIA_KEYS_INT_1=MEDIA_KEYS_INT;_a2<MEDIA_KEYS_INT_1.length;_a2++){var attrib=MEDIA_KEYS_INT_1[_a2];attribs[attrib]&&(media[attrib]=parseInt(attribs[attrib],10))}return attribs.expression&&(media.expression=attribs.expression),media})}__name(getMediaElements,"getMediaElements");function getOneElement(tagName,node2){return(0,legacy_js_1.getElementsByTagName)(tagName,node2,!0,1)[0]}__name(getOneElement,"getOneElement");function fetch$1(tagName,where,recurse){return recurse===void 0&&(recurse=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(tagName,where,recurse,1)).trim()}__name(fetch$1,"fetch$1");function addConditionally(obj,prop,tagName,where,recurse){recurse===void 0&&(recurse=!1);var val=fetch$1(tagName,where,recurse);val&&(obj[prop]=val)}__name(addConditionally,"addConditionally");function isValidFeed(value){return value==="rss"||value==="feed"||value==="rdf:RDF"}__name(isValidFeed,"isValidFeed");(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasChildren=exports.isDocument=exports.isComment=exports.isText=exports.isCDATA=exports.isTag=void 0,__exportStar(stringify$1,exports),__exportStar(traversal,exports),__exportStar(manipulation,exports),__exportStar(querying,exports),__exportStar(legacy,exports),__exportStar(helpers,exports),__exportStar(feeds,exports);var domhandler_12=lib$1Q;Object.defineProperty(exports,"isTag",{enumerable:!0,get:function(){return domhandler_12.isTag}}),Object.defineProperty(exports,"isCDATA",{enumerable:!0,get:function(){return domhandler_12.isCDATA}}),Object.defineProperty(exports,"isText",{enumerable:!0,get:function(){return domhandler_12.isText}}),Object.defineProperty(exports,"isComment",{enumerable:!0,get:function(){return domhandler_12.isComment}}),Object.defineProperty(exports,"isDocument",{enumerable:!0,get:function(){return domhandler_12.isDocument}}),Object.defineProperty(exports,"hasChildren",{enumerable:!0,get:function(){return domhandler_12.hasChildren}})})(lib$1O);(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar2=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding2(result,mod,k);return __setModuleDefault2(result,mod),result},__importDefault2=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DomUtils=exports.parseFeed=exports.getFeed=exports.ElementType=exports.Tokenizer=exports.createDomStream=exports.parseDOM=exports.parseDocument=exports.DefaultHandler=exports.DomHandler=exports.Parser=void 0;var Parser_js_1=Parser$6,Parser_js_2=Parser$6;Object.defineProperty(exports,"Parser",{enumerable:!0,get:function(){return Parser_js_2.Parser}});var domhandler_12=lib$1Q,domhandler_2=lib$1Q;Object.defineProperty(exports,"DomHandler",{enumerable:!0,get:function(){return domhandler_2.DomHandler}}),Object.defineProperty(exports,"DefaultHandler",{enumerable:!0,get:function(){return domhandler_2.DomHandler}});function parseDocument(data,options){var handler2=new domhandler_12.DomHandler(void 0,options);return new Parser_js_1.Parser(handler2,options).end(data),handler2.root}__name(parseDocument,"parseDocument"),exports.parseDocument=parseDocument;function parseDOM(data,options){return parseDocument(data,options).children}__name(parseDOM,"parseDOM"),exports.parseDOM=parseDOM;function createDomStream(callback,options,elementCallback){var handler2=new domhandler_12.DomHandler(callback,options,elementCallback);return new Parser_js_1.Parser(handler2,options)}__name(createDomStream,"createDomStream"),exports.createDomStream=createDomStream;var Tokenizer_js_12=Tokenizer$2;Object.defineProperty(exports,"Tokenizer",{enumerable:!0,get:function(){return __importDefault2(Tokenizer_js_12).default}}),exports.ElementType=__importStar2(lib$1P);var domutils_1=lib$1O,domutils_2=lib$1O;Object.defineProperty(exports,"getFeed",{enumerable:!0,get:function(){return domutils_2.getFeed}});var parseFeedDefaultOptions={xmlMode:!0};function parseFeed(feed,options){return options===void 0&&(options=parseFeedDefaultOptions),(0,domutils_1.getFeed)(parseDOM(feed,options))}__name(parseFeed,"parseFeed"),exports.parseFeed=parseFeed,exports.DomUtils=__importStar2(lib$1O)})(lib$1R);const require$$2={"@context":{alternate:"http://www.w3.org/1999/xhtml/vocab#alternate",appendix:"http://www.w3.org/1999/xhtml/vocab#appendix",cite:"http://www.w3.org/1999/xhtml/vocab#cite",bookmark:"http://www.w3.org/1999/xhtml/vocab#bookmark",contents:"http://www.w3.org/1999/xhtml/vocab#contents",chapter:"http://www.w3.org/1999/xhtml/vocab#chapter",copyright:"http://www.w3.org/1999/xhtml/vocab#copyright",first:"http://www.w3.org/1999/xhtml/vocab#first",glossary:"http://www.w3.org/1999/xhtml/vocab#glossary",help:"http://www.w3.org/1999/xhtml/vocab#help",icon:"http://www.w3.org/1999/xhtml/vocab#icon",index:"http://www.w3.org/1999/xhtml/vocab#index",last:"http://www.w3.org/1999/xhtml/vocab#last",license:"http://www.w3.org/1999/xhtml/vocab#license",meta:"http://www.w3.org/1999/xhtml/vocab#meta",next:"http://www.w3.org/1999/xhtml/vocab#next",prev:"http://www.w3.org/1999/xhtml/vocab#prev",previous:"http://www.w3.org/1999/xhtml/vocab#previous",section:"http://www.w3.org/1999/xhtml/vocab#section",start:"http://www.w3.org/1999/xhtml/vocab#start",stylesheet:"http://www.w3.org/1999/xhtml/vocab#stylesheet",subsection:"http://www.w3.org/1999/xhtml/vocab#subsection",top:"http://www.w3.org/1999/xhtml/vocab#top",up:"http://www.w3.org/1999/xhtml/vocab#up",p3pv1:"http://www.w3.org/1999/xhtml/vocab#p3pv1"}},require$$3={"@context":{as:"https://www.w3.org/ns/activitystreams#",cat:"http://www.w3.org/ns/dcat#",cc:"http://creativecommons.org/ns#",cnt:"http://www.w3.org/2008/content#",csvw:"http://www.w3.org/ns/csvw#",ctag:"http://commontag.org/ns#",dc:"http://purl.org/dc/terms/",dc11:"http://purl.org/dc/elements/1.1/",dcat:"http://www.w3.org/ns/dcat#",dcterms:"http://purl.org/dc/terms/",dqv:"http://www.w3.org/ns/dqv#",duv:"https://www.w3.org/TR/vocab-duv#",earl:"http://www.w3.org/ns/earl#",foaf:"http://xmlns.com/foaf/0.1/",gldp:"http://www.w3.org/ns/people#",gr:"http://purl.org/goodrelations/v1#",grddl:"http://www.w3.org/2003/g/data-view#",ht:"http://www.w3.org/2006/http#",ical:"http://www.w3.org/2002/12/cal/icaltzd#",ldp:"http://www.w3.org/ns/ldp#",ma:"http://www.w3.org/ns/ma-ont#",oa:"http://www.w3.org/ns/oa#",odrl:"http://www.w3.org/ns/odrl/2/",og:"http://ogp.me/ns#",org:"http://www.w3.org/ns/org#",owl:"http://www.w3.org/2002/07/owl#",prov:"http://www.w3.org/ns/prov#",ptr:"http://www.w3.org/2009/pointers#",qb:"http://purl.org/linked-data/cube#",rev:"http://purl.org/stuff/rev#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfa:"http://www.w3.org/ns/rdfa#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rif:"http://www.w3.org/2007/rif#",rr:"http://www.w3.org/ns/r2rml#",schema:"http://schema.org/",sd:"http://www.w3.org/ns/sparql-service-description#",sioc:"http://rdfs.org/sioc/ns#",skos:"http://www.w3.org/2004/02/skos/core#",skosxl:"http://www.w3.org/2008/05/skos-xl#",ssn:"http://www.w3.org/ns/ssn/",sosa:"http://www.w3.org/ns/sosa/",time:"http://www.w3.org/2006/time#",v:"http://rdf.data-vocabulary.org/#",vcard:"http://www.w3.org/2006/vcard/ns#",void:"http://rdfs.org/ns/void#",wdr:"http://www.w3.org/2007/05/powder#",wdrs:"http://www.w3.org/2007/05/powder-s#",xhv:"http://www.w3.org/1999/xhtml/vocab#",xml:"http://www.w3.org/XML/1998/namespace",xsd:"http://www.w3.org/2001/XMLSchema#",describedby:"http://www.w3.org/2007/05/powder-s#describedby",license:"http://www.w3.org/1999/xhtml/vocab#license",role:"http://www.w3.org/1999/xhtml/vocab#role"}};var RdfaProfile={};Object.defineProperty(RdfaProfile,"__esModule",{value:!0});RdfaProfile.RDFA_CONTENTTYPES=RdfaProfile.RDFA_FEATURES=void 0;RdfaProfile.RDFA_FEATURES={"":{baseTag:!0,xmlBase:!0,langAttribute:!0,onlyAllowUriRelRevIfProperty:!0,inheritSubjectInHeadBody:!0,datetimeAttribute:!0,timeTag:!0,htmlDatatype:!0,copyRdfaPatterns:!0,xmlnsPrefixMappings:!0,xhtmlInitialContext:!0,roleAttribute:!0},core:{baseTag:!1,xmlBase:!1,langAttribute:!0,onlyAllowUriRelRevIfProperty:!0,inheritSubjectInHeadBody:!1,datetimeAttribute:!1,timeTag:!1,htmlDatatype:!1,copyRdfaPatterns:!0,xmlnsPrefixMappings:!0,xhtmlInitialContext:!1,roleAttribute:!1},html:{baseTag:!0,xmlBase:!1,langAttribute:!0,onlyAllowUriRelRevIfProperty:!0,inheritSubjectInHeadBody:!0,datetimeAttribute:!0,timeTag:!0,htmlDatatype:!0,copyRdfaPatterns:!0,xmlnsPrefixMappings:!0,xhtmlInitialContext:!1,roleAttribute:!0},xhtml:{baseTag:!0,xmlBase:!1,langAttribute:!0,onlyAllowUriRelRevIfProperty:!0,inheritSubjectInHeadBody:!0,datetimeAttribute:!0,timeTag:!0,htmlDatatype:!0,copyRdfaPatterns:!0,xmlnsPrefixMappings:!0,xhtmlInitialContext:!0,roleAttribute:!0},xml:{baseTag:!1,xmlBase:!0,langAttribute:!0,onlyAllowUriRelRevIfProperty:!1,inheritSubjectInHeadBody:!1,datetimeAttribute:!0,timeTag:!0,htmlDatatype:!1,copyRdfaPatterns:!1,xmlnsPrefixMappings:!0,xhtmlInitialContext:!1,roleAttribute:!0}};RdfaProfile.RDFA_CONTENTTYPES={"text/html":"html","application/xhtml+xml":"xhtml","application/xml":"xml","text/xml":"xml","image/svg+xml":"xml"};var Util$4={};Object.defineProperty(Util$4,"__esModule",{value:!0});Util$4.Util=void 0;const relative_to_absolute_iri_1$6=relativeToAbsoluteIri,RdfaProfile_1$1=RdfaProfile,rdf_data_factory_1$r=rdfDataFactory;let Util$3=__name(class Util5{constructor(dataFactory,baseIRI){this.dataFactory=dataFactory||new rdf_data_factory_1$r.DataFactory,this.baseIRI=this.dataFactory.namedNode(baseIRI||""),this.baseIRIDocument=this.baseIRI}static parsePrefixes(attributes,parentPrefixes,xmlnsPrefixMappings){const additionalPrefixes={};if(xmlnsPrefixMappings)for(const attribute in attributes)attribute.startsWith("xmlns")&&(additionalPrefixes[attribute.substr(6)]=attributes[attribute]);if(attributes.prefix||Object.keys(additionalPrefixes).length>0){const prefixes=Object.assign(Object.assign({},parentPrefixes),additionalPrefixes);if(attributes.prefix){let prefixMatch;for(;prefixMatch=Util5.PREFIX_REGEX.exec(attributes.prefix);)prefixes[prefixMatch[1]]=prefixMatch[2]}return prefixes}else return parentPrefixes}static expandPrefixedTerm(term,activeTag){const colonIndex=term.indexOf(":");let prefix,local;if(colonIndex>=0&&(prefix=term.substr(0,colonIndex),local=term.substr(colonIndex+1)),prefix==="")return"http://www.w3.org/1999/xhtml/vocab#"+local;if(prefix){const prefixElement=activeTag.prefixesAll[prefix];if(prefixElement)return prefixElement+local}if(term){const expandedTerm=activeTag.prefixesAll[term.toLocaleLowerCase()];if(expandedTerm)return expandedTerm}return term}static isValidIri(iri){return Util5.IRI_REGEX.test(iri)}static contentTypeToProfile(contentType){return RdfaProfile_1$1.RDFA_CONTENTTYPES[contentType]||""}getBaseIRI(baseIriValue){let href=baseIriValue;const fragmentIndex=href.indexOf("#");return fragmentIndex>=0&&(href=href.substr(0,fragmentIndex)),this.dataFactory.namedNode((0,relative_to_absolute_iri_1$6.resolve)(href,this.baseIRI.value))}getResourceOrBaseIri(term,activeTag){return term===!0?this.getBaseIriTerm(activeTag):term}getBaseIriTerm(activeTag){return activeTag.localBaseIRI||this.baseIRI}createVocabIris(terms,activeTag,allowTerms,allowBlankNode){return terms.split(/\s+/).filter(term=>term&&(allowTerms||term.indexOf(":")>=0)).map(property=>this.createIri(property,activeTag,!0,!0,allowBlankNode)).filter(term=>term!=null)}createLiteral(literal,activeTag){if(activeTag.interpretObjectAsTime&&!activeTag.datatype){for(const entry of Util5.TIME_REGEXES)if(literal.match(entry.regex)){activeTag.datatype=this.dataFactory.namedNode(Util5.XSD+entry.type);break}}return this.dataFactory.literal(literal,activeTag.datatype||activeTag.language)}createBlankNode(){return this.blankNodeFactory?this.blankNodeFactory():this.dataFactory.blankNode()}createIri(term,activeTag,vocab,allowSafeCurie,allowBlankNode){if(term=term||"",!allowSafeCurie)return vocab||(term=(0,relative_to_absolute_iri_1$6.resolve)(term,this.getBaseIriTerm(activeTag).value)),Util5.isValidIri(term)?this.dataFactory.namedNode(term):null;if(term.length>0&&term[0]==="["&&term[term.length-1]==="]"&&(term=term.substr(1,term.length-2),term.indexOf(":")<0))return null;if(term.startsWith("_:"))return allowBlankNode?this.dataFactory.blankNode(term.substr(2)||"b_identity"):null;if(vocab&&activeTag.vocab&&term.indexOf(":")<0)return this.dataFactory.namedNode(activeTag.vocab+term);let iri=Util5.expandPrefixedTerm(term,activeTag);return vocab?term!==iri&&(iri=(0,relative_to_absolute_iri_1$6.resolve)(iri,this.baseIRIDocument.value)):iri=(0,relative_to_absolute_iri_1$6.resolve)(iri,this.getBaseIriTerm(activeTag).value),Util5.isValidIri(iri)?this.dataFactory.namedNode(iri):null}},"Util");Util$4.Util=Util$3;Util$3.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";Util$3.XSD="http://www.w3.org/2001/XMLSchema#";Util$3.RDFA="http://www.w3.org/ns/rdfa#";Util$3.PREFIX_REGEX=/\s*([^:\s]*)*:\s*([^\s]*)*\s*/g;Util$3.TIME_REGEXES=[{regex:/^-?P([0-9]+Y)?([0-9]+M)?([0-9]+D)?(T([0-9]+H)?([0-9]+M)?([0-9]+(\.[0-9])?S)?)?$/,type:"duration"},{regex:/^[0-9]+-[0-9][0-9]-[0-9][0-9]T[0-9][0-9]:[0-9][0-9]:[0-9][0-9]((Z?)|([\+-][0-9][0-9]:[0-9][0-9]))$/,type:"dateTime"},{regex:/^[0-9]+-[0-9][0-9]-[0-9][0-9]Z?$/,type:"date"},{regex:/^[0-9][0-9]:[0-9][0-9]:[0-9][0-9]((Z?)|([\+-][0-9][0-9]:[0-9][0-9]))$/,type:"time"},{regex:/^[0-9]+-[0-9][0-9]$/,type:"gYearMonth"},{regex:/^[0-9]+$/,type:"gYear"}];Util$3.IRI_REGEX=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^ "<>{}|\\\[\]`]*$/;Object.defineProperty(RdfaParser$1,"__esModule",{value:!0});RdfaParser$1.RdfaParser=void 0;const htmlparser2_1$2=lib$1R,readable_stream_1$c=browserExports$1,INITIAL_CONTEXT_XHTML=require$$2,INITIAL_CONTEXT=require$$3,RdfaProfile_1=RdfaProfile,Util_1$5=Util$4;class RdfaParser extends readable_stream_1$c.Transform{constructor(options){super({readableObjectMode:!0}),this.activeTagStack=[],options=options||{},this.options=options,this.util=new Util_1$5.Util(options.dataFactory,options.baseIRI),this.defaultGraph=options.defaultGraph||this.util.dataFactory.defaultGraph();const profile=options.contentType?Util_1$5.Util.contentTypeToProfile(options.contentType):options.profile||"";this.features=options.features||RdfaProfile_1.RDFA_FEATURES[profile],this.htmlParseListener=options.htmlParseListener,this.rdfaPatterns=this.features.copyRdfaPatterns?{}:null,this.pendingRdfaPatternCopies=this.features.copyRdfaPatterns?{}:null,this.parser=this.initializeParser(profile==="xml"),this.activeTagStack.push({incompleteTriples:[],inlist:!1,language:options.language,listMapping:{},listMappingLocal:{},name:"",prefixesAll:Object.assign(Object.assign({},INITIAL_CONTEXT["@context"]),this.features.xhtmlInitialContext?INITIAL_CONTEXT_XHTML["@context"]:{}),prefixesCustom:{},skipElement:!1,vocab:options.vocab})}import(stream){const output=new readable_stream_1$c.PassThrough({readableObjectMode:!0});stream.on("error",error=>parsed.emit("error",error)),stream.on("data",data=>output.push(data)),stream.on("end",()=>output.push(null));const parsed=output.pipe(new RdfaParser(this.options));return parsed}_transform(chunk,encoding,callback){this.parser.write(chunk.toString()),callback()}_flush(callback){this.parser.end(),callback()}onTagOpen(name,attributes){let parentTagI=this.activeTagStack.length-1;for(;parentTagI>0&&this.activeTagStack[parentTagI].skipElement;)parentTagI--;let parentTag=this.activeTagStack[parentTagI];parentTagI!==this.activeTagStack.length-1&&(parentTag=Object.assign(Object.assign({},parentTag),{language:this.activeTagStack[this.activeTagStack.length-1].language,prefixesAll:this.activeTagStack[this.activeTagStack.length-1].prefixesAll,prefixesCustom:this.activeTagStack[this.activeTagStack.length-1].prefixesCustom,vocab:this.activeTagStack[this.activeTagStack.length-1].vocab}));const activeTag={collectChildTags:parentTag.collectChildTags,incompleteTriples:[],inlist:"inlist"in attributes,listMapping:[],listMappingLocal:parentTag.listMapping,localBaseIRI:parentTag.localBaseIRI,name,prefixesAll:null,prefixesCustom:null,skipElement:!1};if(this.activeTagStack.push(activeTag),activeTag.collectChildTags){for(const prefix of Object.keys(parentTag.prefixesCustom).sort()){const suffix=parentTag.prefixesCustom[prefix],attributeKey=prefix===""?"xmlns":"xmlns:"+prefix;attributeKey in attributes||(attributes[attributeKey]=suffix)}const attributesSerialized=Object.keys(attributes).map(key=>`${key}="${attributes[key]}"`).join(" ");if(activeTag.text=[`<${name}${attributesSerialized?" "+attributesSerialized:""}>`],this.features.skipHandlingXmlLiteralChildren)return}let allowTermsInRelPredicates=!0,allowTermsInRevPredicates=!0;if(this.features.onlyAllowUriRelRevIfProperty&&("property"in attributes&&"rel"in attributes&&(allowTermsInRelPredicates=!1,attributes.rel.indexOf(":")<0&&delete attributes.rel),"property"in attributes&&"rev"in attributes&&(allowTermsInRevPredicates=!1,attributes.rev.indexOf(":")<0&&delete attributes.rev)),this.features.copyRdfaPatterns){if(parentTag.collectedPatternTag){const patternTag={attributes,children:[],name,referenced:!1,rootPattern:!1,text:[]};parentTag.collectedPatternTag.children.push(patternTag),activeTag.collectedPatternTag=patternTag;return}if(attributes.typeof==="rdfa:Pattern"){activeTag.collectedPatternTag={attributes,children:[],name,parentTag,referenced:!1,rootPattern:!0,text:[]};return}if(attributes.property==="rdfa:copy"){const copyTargetPatternId=attributes.resource||attributes.href||attributes.src;this.rdfaPatterns[copyTargetPatternId]?this.emitPatternCopy(parentTag,this.rdfaPatterns[copyTargetPatternId],copyTargetPatternId):(this.pendingRdfaPatternCopies[copyTargetPatternId]||(this.pendingRdfaPatternCopies[copyTargetPatternId]=[]),this.pendingRdfaPatternCopies[copyTargetPatternId].push(parentTag));return}}this.features.baseTag&&name==="base"&&attributes.href&&(this.util.baseIRI=this.util.getBaseIRI(attributes.href)),this.features.xmlBase&&attributes["xml:base"]&&(activeTag.localBaseIRI=this.util.getBaseIRI(attributes["xml:base"])),this.features.timeTag&&name==="time"&&!attributes.datatype&&(activeTag.interpretObjectAsTime=!0);let newSubject,currentObjectResource,typedResource;if("vocab"in attributes?attributes.vocab?(activeTag.vocab=attributes.vocab,this.emitTriple(this.util.getBaseIriTerm(activeTag),this.util.dataFactory.namedNode(Util_1$5.Util.RDFA+"usesVocabulary"),this.util.dataFactory.namedNode(activeTag.vocab))):activeTag.vocab=this.activeTagStack[0].vocab:activeTag.vocab=parentTag.vocab,activeTag.prefixesCustom=Util_1$5.Util.parsePrefixes(attributes,parentTag.prefixesCustom,this.features.xmlnsPrefixMappings),activeTag.prefixesAll=Object.keys(activeTag.prefixesCustom).length>0?Object.assign(Object.assign({},parentTag.prefixesAll),activeTag.prefixesCustom):parentTag.prefixesAll,this.features.roleAttribute&&attributes.role){const roleSubject=attributes.id?this.util.createIri("#"+attributes.id,activeTag,!1,!1,!1):this.util.createBlankNode(),vocabOld=activeTag.vocab;activeTag.vocab="http://www.w3.org/1999/xhtml/vocab#";for(const role of this.util.createVocabIris(attributes.role,activeTag,!0,!1))this.emitTriple(roleSubject,this.util.dataFactory.namedNode("http://www.w3.org/1999/xhtml/vocab#role"),role);activeTag.vocab=vocabOld}"xml:lang"in attributes||this.features.langAttribute&&"lang"in attributes?activeTag.language=attributes["xml:lang"]||attributes.lang:activeTag.language=parentTag.language;const isRootTag=this.activeTagStack.length===2;if(!("rel"in attributes)&&!("rev"in attributes)?"property"in attributes&&!("content"in attributes)&&!("datatype"in attributes)?("about"in attributes?(newSubject=this.util.createIri(attributes.about,activeTag,!1,!0,!0),activeTag.explicitNewSubject=!!newSubject):isRootTag?newSubject=!0:parentTag.object&&(newSubject=parentTag.object),"typeof"in attributes&&("about"in attributes&&(typedResource=this.util.createIri(attributes.about,activeTag,!1,!0,!0)),!typedResource&&isRootTag&&(typedResource=!0),!typedResource&&"resource"in attributes&&(typedResource=this.util.createIri(attributes.resource,activeTag,!1,!0,!0)),!typedResource&&("href"in attributes||"src"in attributes)&&(typedResource=this.util.createIri(attributes.href||attributes.src,activeTag,!1,!1,!0)),!typedResource&&this.isInheritSubjectInHeadBody(name)&&(typedResource=newSubject),typedResource||(typedResource=this.util.createBlankNode()),currentObjectResource=typedResource)):(("about"in attributes||"resource"in attributes)&&(newSubject=this.util.createIri(attributes.about||attributes.resource,activeTag,!1,!0,!0),activeTag.explicitNewSubject=!!newSubject),!newSubject&&("href"in attributes||"src"in attributes)&&(newSubject=this.util.createIri(attributes.href||attributes.src,activeTag,!1,!1,!0),activeTag.explicitNewSubject=!!newSubject),newSubject||(isRootTag?newSubject=!0:this.isInheritSubjectInHeadBody(name)?newSubject=parentTag.object:"typeof"in attributes?(newSubject=this.util.createBlankNode(),activeTag.explicitNewSubject=!0):parentTag.object&&(newSubject=parentTag.object,"property"in attributes||(activeTag.skipElement=!0))),"typeof"in attributes&&(typedResource=newSubject)):("about"in attributes?(newSubject=this.util.createIri(attributes.about,activeTag,!1,!0,!0),activeTag.explicitNewSubject=!!newSubject,"typeof"in attributes&&(typedResource=newSubject)):isRootTag?newSubject=!0:parentTag.object&&(newSubject=parentTag.object),"resource"in attributes&&(currentObjectResource=this.util.createIri(attributes.resource,activeTag,!1,!0,!0)),currentObjectResource||("href"in attributes||"src"in attributes?currentObjectResource=this.util.createIri(attributes.href||attributes.src,activeTag,!1,!1,!0):"typeof"in attributes&&!("about"in attributes)&&!this.isInheritSubjectInHeadBody(name)&&(currentObjectResource=this.util.createBlankNode())),"typeof"in attributes&&!("about"in attributes)&&(this.isInheritSubjectInHeadBody(name)?typedResource=newSubject:typedResource=currentObjectResource)),typedResource)for(const type of this.util.createVocabIris(attributes.typeof,activeTag,!0,!0))this.emitTriple(this.util.getResourceOrBaseIri(typedResource,activeTag),this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"type"),type);if(newSubject&&(activeTag.listMapping={}),currentObjectResource){if("rel"in attributes&&"inlist"in attributes)for(const predicate2 of this.util.createVocabIris(attributes.rel,activeTag,allowTermsInRelPredicates,!1))this.addListMapping(activeTag,newSubject,predicate2,currentObjectResource);if(!("rel"in attributes&&"inlist"in attributes)){if("rel"in attributes)for(const predicate2 of this.util.createVocabIris(attributes.rel,activeTag,allowTermsInRelPredicates,!1))this.emitTriple(this.util.getResourceOrBaseIri(newSubject,activeTag),predicate2,this.util.getResourceOrBaseIri(currentObjectResource,activeTag));if("rev"in attributes)for(const predicate2 of this.util.createVocabIris(attributes.rev,activeTag,allowTermsInRevPredicates,!1))this.emitTriple(this.util.getResourceOrBaseIri(currentObjectResource,activeTag),predicate2,this.util.getResourceOrBaseIri(newSubject,activeTag))}}if(!currentObjectResource){if("rel"in attributes)if("inlist"in attributes)for(const predicate2 of this.util.createVocabIris(attributes.rel,activeTag,allowTermsInRelPredicates,!1))this.addListMapping(activeTag,newSubject,predicate2,null),activeTag.incompleteTriples.push({predicate:predicate2,reverse:!1,list:!0});else for(const predicate2 of this.util.createVocabIris(attributes.rel,activeTag,allowTermsInRelPredicates,!1))activeTag.incompleteTriples.push({predicate:predicate2,reverse:!1});if("rev"in attributes)for(const predicate2 of this.util.createVocabIris(attributes.rev,activeTag,allowTermsInRevPredicates,!1))activeTag.incompleteTriples.push({predicate:predicate2,reverse:!0});activeTag.incompleteTriples.length>0&&(currentObjectResource=this.util.createBlankNode())}if("property"in attributes){activeTag.predicates=this.util.createVocabIris(attributes.property,activeTag,!0,!1);let localObjectResource;if("datatype"in attributes?(activeTag.datatype=this.util.createIri(attributes.datatype,activeTag,!0,!0,!1),activeTag.datatype&&(activeTag.datatype.value===Util_1$5.Util.RDF+"XMLLiteral"||this.features.htmlDatatype&&activeTag.datatype.value===Util_1$5.Util.RDF+"HTML")&&(activeTag.collectChildTags=!0)):(!("rev"in attributes)&&!("rel"in attributes)&&!("content"in attributes)&&("resource"in attributes&&(localObjectResource=this.util.createIri(attributes.resource,activeTag,!1,!0,!0)),!localObjectResource&&"href"in attributes&&(localObjectResource=this.util.createIri(attributes.href,activeTag,!1,!1,!0)),!localObjectResource&&"src"in attributes&&(localObjectResource=this.util.createIri(attributes.src,activeTag,!1,!1,!0))),"typeof"in attributes&&!("about"in attributes)&&(localObjectResource=typedResource)),"content"in attributes){const object2=this.util.createLiteral(attributes.content,activeTag);if("inlist"in attributes)for(const predicate2 of activeTag.predicates)this.addListMapping(activeTag,newSubject,predicate2,object2);else{const subject2=this.util.getResourceOrBaseIri(newSubject,activeTag);for(const predicate2 of activeTag.predicates)this.emitTriple(subject2,predicate2,object2)}activeTag.predicates=null}else if(this.features.datetimeAttribute&&"datetime"in attributes){activeTag.interpretObjectAsTime=!0;const object2=this.util.createLiteral(attributes.datetime,activeTag);if("inlist"in attributes)for(const predicate2 of activeTag.predicates)this.addListMapping(activeTag,newSubject,predicate2,object2);else{const subject2=this.util.getResourceOrBaseIri(newSubject,activeTag);for(const predicate2 of activeTag.predicates)this.emitTriple(subject2,predicate2,object2)}activeTag.predicates=null}else if(localObjectResource){const object2=this.util.getResourceOrBaseIri(localObjectResource,activeTag);if("inlist"in attributes)for(const predicate2 of activeTag.predicates)this.addListMapping(activeTag,newSubject,predicate2,object2);else{const subject2=this.util.getResourceOrBaseIri(newSubject,activeTag);for(const predicate2 of activeTag.predicates)this.emitTriple(subject2,predicate2,object2)}activeTag.predicates=null}}let incompleteTriplesCompleted=!1;if(!activeTag.skipElement&&newSubject&&parentTag.incompleteTriples.length>0){incompleteTriplesCompleted=!0;const subject2=this.util.getResourceOrBaseIri(parentTag.subject,activeTag),object2=this.util.getResourceOrBaseIri(newSubject,activeTag);for(const incompleteTriple of parentTag.incompleteTriples)if(incompleteTriple.reverse)this.emitTriple(object2,incompleteTriple.predicate,subject2);else if(incompleteTriple.list){let firstInListTag=null;for(let i=this.activeTagStack.length-1;i>=0;i--)if(this.activeTagStack[i].inlist){firstInListTag=this.activeTagStack[i];break}this.addListMapping(firstInListTag,newSubject,incompleteTriple.predicate,object2)}else this.emitTriple(subject2,incompleteTriple.predicate,object2)}!incompleteTriplesCompleted&&parentTag.incompleteTriples.length>0&&(activeTag.incompleteTriples=activeTag.incompleteTriples.concat(parentTag.incompleteTriples)),activeTag.subject=newSubject||parentTag.subject,activeTag.object=currentObjectResource||newSubject}onText(data){const activeTag=this.activeTagStack[this.activeTagStack.length-1];if(this.features.copyRdfaPatterns&&activeTag.collectedPatternTag){activeTag.collectedPatternTag.text.push(data);return}activeTag.text||(activeTag.text=[]),activeTag.text.push(data)}onTagClose(){const activeTag=this.activeTagStack[this.activeTagStack.length-1],parentTag=this.activeTagStack[this.activeTagStack.length-2];if(!(activeTag.collectChildTags&&parentTag.collectChildTags&&this.features.skipHandlingXmlLiteralChildren)){if(this.features.copyRdfaPatterns&&activeTag.collectedPatternTag&&activeTag.collectedPatternTag.rootPattern){const patternId=activeTag.collectedPatternTag.attributes.resource;if(delete activeTag.collectedPatternTag.attributes.resource,delete activeTag.collectedPatternTag.attributes.typeof,this.rdfaPatterns[patternId]=activeTag.collectedPatternTag,this.pendingRdfaPatternCopies[patternId]){for(const tag of this.pendingRdfaPatternCopies[patternId])this.emitPatternCopy(tag,activeTag.collectedPatternTag,patternId);delete this.pendingRdfaPatternCopies[patternId]}this.activeTagStack.pop();return}if(activeTag.predicates){const subject2=this.util.getResourceOrBaseIri(activeTag.subject,activeTag);let textSegments=activeTag.text||[];activeTag.collectChildTags&&parentTag.collectChildTags&&(textSegments=textSegments.slice(1));const object2=this.util.createLiteral(textSegments.join(""),activeTag);if(activeTag.inlist)for(const predicate2 of activeTag.predicates)this.addListMapping(activeTag,subject2,predicate2,object2);else for(const predicate2 of activeTag.predicates)this.emitTriple(subject2,predicate2,object2);parentTag.predicates||(activeTag.text=null)}if(activeTag.object&&Object.keys(activeTag.listMapping).length>0){const subject2=this.util.getResourceOrBaseIri(activeTag.object,activeTag);for(const predicateValue in activeTag.listMapping){const predicate2=this.util.dataFactory.namedNode(predicateValue),values2=activeTag.listMapping[predicateValue];if(values2.length>0){const bnodes=values2.map(()=>this.util.createBlankNode());for(let i=0;i<values2.length;i++){const object2=this.util.getResourceOrBaseIri(values2[i],activeTag);this.emitTriple(bnodes[i],this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"first"),object2),this.emitTriple(bnodes[i],this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"rest"),i<values2.length-1?bnodes[i+1]:this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"nil"))}this.emitTriple(subject2,predicate2,bnodes[0])}else this.emitTriple(subject2,predicate2,this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"nil"))}}}this.activeTagStack.pop(),activeTag.collectChildTags&&activeTag.text&&activeTag.text.push(`</${activeTag.name}>`),activeTag.text&&parentTag&&(parentTag.text?parentTag.text=parentTag.text.concat(activeTag.text):parentTag.text=activeTag.text)}onEnd(){if(this.features.copyRdfaPatterns){this.features.copyRdfaPatterns=!1;for(const patternId in this.rdfaPatterns){const pattern=this.rdfaPatterns[patternId];pattern.referenced||(pattern.attributes.typeof="rdfa:Pattern",pattern.attributes.resource=patternId,this.emitPatternCopy(pattern.parentTag,pattern,patternId),pattern.referenced=!1,delete pattern.attributes.typeof,delete pattern.attributes.resource)}for(const patternId in this.pendingRdfaPatternCopies)for(const parentTag of this.pendingRdfaPatternCopies[patternId])this.activeTagStack.push(parentTag),this.onTagOpen("link",{property:"rdfa:copy",href:patternId}),this.onTagClose(),this.activeTagStack.pop();this.features.copyRdfaPatterns=!0}}isInheritSubjectInHeadBody(name){return this.features.inheritSubjectInHeadBody&&(name==="head"||name==="body")}addListMapping(activeTag,subject2,predicate2,currentObjectResource){if(activeTag.explicitNewSubject){const bNode=this.util.createBlankNode();this.emitTriple(this.util.getResourceOrBaseIri(subject2,activeTag),predicate2,bNode),this.emitTriple(bNode,this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"first"),this.util.getResourceOrBaseIri(currentObjectResource,activeTag)),this.emitTriple(bNode,this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"rest"),this.util.dataFactory.namedNode(Util_1$5.Util.RDF+"nil"))}else{let predicateList=activeTag.listMappingLocal[predicate2.value];predicateList||(activeTag.listMappingLocal[predicate2.value]=predicateList=[]),currentObjectResource&&predicateList.push(currentObjectResource)}}emitTriple(subject2,predicate2,object2){subject2.termType==="NamedNode"&&subject2.value.indexOf(":")<0||predicate2.termType==="NamedNode"&&predicate2.value.indexOf(":")<0||object2.termType==="NamedNode"&&object2.value.indexOf(":")<0||this.push(this.util.dataFactory.quad(subject2,predicate2,object2,this.defaultGraph))}emitPatternCopy(parentTag,pattern,rootPatternId){if(this.activeTagStack.push(parentTag),pattern.referenced=!0,!pattern.constructedBlankNodes)pattern.constructedBlankNodes=[],this.util.blankNodeFactory=()=>{const bNode=this.util.dataFactory.blankNode();return pattern.constructedBlankNodes.push(bNode),bNode};else{let blankNodeIndex=0;this.util.blankNodeFactory=()=>pattern.constructedBlankNodes[blankNodeIndex++]}this.emitPatternCopyAbsolute(pattern,!0,rootPatternId),this.util.blankNodeFactory=null,this.activeTagStack.pop()}emitPatternCopyAbsolute(pattern,root,rootPatternId){if(!(!root&&pattern.attributes.property==="rdfa:copy"&&pattern.attributes.href===rootPatternId)){this.onTagOpen(pattern.name,pattern.attributes);for(const text of pattern.text)this.onText(text);for(const child of pattern.children)this.emitPatternCopyAbsolute(child,!1,rootPatternId);this.onTagClose()}}initializeParser(xmlMode){return new htmlparser2_1$2.Parser({onclosetag:()=>{try{this.onTagClose(),this.htmlParseListener&&this.htmlParseListener.onTagClose()}catch(e){this.emit("error",e)}},onend:()=>{try{this.onEnd(),this.htmlParseListener&&this.htmlParseListener.onEnd()}catch(e){this.emit("error",e)}},onopentag:(name,attributes)=>{try{this.onTagOpen(name,attributes),this.htmlParseListener&&this.htmlParseListener.onTagOpen(name,attributes)}catch(e){this.emit("error",e)}},ontext:data=>{try{this.onText(data),this.htmlParseListener&&this.htmlParseListener.onText(data)}catch(e){this.emit("error",e)}}},{decodeEntities:!0,recognizeSelfClosing:!0,xmlMode})}}__name(RdfaParser,"RdfaParser");RdfaParser$1.RdfaParser=RdfaParser;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(IActiveTag,exports),__exportStar(IHtmlParseListener$1,exports),__exportStar(IRdfaPattern,exports),__exportStar(RdfaParser$1,exports),__exportStar(RdfaProfile,exports),__exportStar(Util$4,exports)})(rdfaStreamingParser);Object.defineProperty(ActorRdfParseXmlRdfa$1,"__esModule",{value:!0});ActorRdfParseXmlRdfa$1.ActorRdfParseXmlRdfa=void 0;const bus_rdf_parse_1$3=lib$1U,rdfa_streaming_parser_1$1=rdfaStreamingParser;class ActorRdfParseXmlRdfa extends bus_rdf_parse_1$3.ActorRdfParseFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){var _a2;const language2=(action.headers&&action.headers.get("content-language"))??void 0;action.data.on("error",error=>data.emit("error",error));const data=action.data.pipe(new rdfa_streaming_parser_1$1.RdfaParser({baseIRI:(_a2=action.metadata)==null?void 0:_a2.baseIRI,profile:"xml",language:language2}));return{data,metadata:{triples:!0}}}}__name(ActorRdfParseXmlRdfa,"ActorRdfParseXmlRdfa");ActorRdfParseXmlRdfa$1.ActorRdfParseXmlRdfa=ActorRdfParseXmlRdfa;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseXmlRdfa$1,exports)})(lib$1S);var lib$1L={},ActorRdfParseShaclc$1={},lib$1K={},ShaclcParser$1=function(){var o=__name(function(k,v,o2,l){for(o2=o2||{},l=k.length;l--;o2[k[l]]=v);return o2},"o"),$V0=[7,12,13,14,15,16,20,25,115,130],$V1=[7,13,16,20,25,115,130],$V2=[7,13,16,115,130],$V3=[1,25],$V4=[1,29],$V5=[1,27],$V6=[1,28],$V7=[13,16,115,130],$V8=[13,16,28,38,40,42,44,46,48,53,56,61,67,85,87,92,93,95,96,102,110,111,115,119,120,126,128,129,130,131,132,133,134,135,136],$V9=[28,56],$Va=[1,42],$Vb=[46,48,53,56],$Vc=[1,54],$Vd=[1,60],$Ve=[1,56],$Vf=[1,57],$Vg=[1,58],$Vh=[1,63],$Vi=[1,64],$Vj=[1,65],$Vk=[1,66],$Vl=[1,67],$Vm=[1,68],$Vn=[1,75],$Vo=[28,46,48,53,56],$Vp=[28,42,46,48,53,56],$Vq=[13,16,28,38,40,42,44,46,48,53,56,92,115,119,120,130,131,132,133,134,135,136],$Vr=[13,16,28,38,40,42,44,46,48,53,56,67,85,87,92,95,96,115,119,120,126,128,129,130,131,132,133,134,135,136],$Vs=[13,16,38,40,44,92,115,119,120,130,131,132,133,134,135,136],$Vt=[13,16,28,38,40,42,44,46,48,53,56,67,85,87,92,95,96,115,117,118,119,120,126,128,129,130,131,132,133,134,135,136],$Vu=[13,16,28,56,115,130],$Vv=[13,16,38,58,87,96,109,115,126,130],$Vw=[1,116],$Vx=[1,112],$Vy=[1,108],$Vz=[1,114],$VA=[1,111],$VB=[7,13,16,20,25,44,48,53,56,67,85,87,95,96,115,128,129,130],$VC=[48,53],$VD=[48,53,87,96,126],$VE=[13,16,44,48,53,56,85,87,95,96,115,128,129,130],$VF=[1,126],$VG=[13,16,40,44,48,53,56,85,87,95,96,115,128,129,130],$VH=[1,129],$VI=[48,53,67,87,96,126],$VJ=[13,16,40,44,48,53,56,67,85,87,95,96,115,128,129,130],$VK=[1,133],$VL=[13,16,40,44,48,53,56,67,85,87,95,96,102,115,128,129,130],$VM=[13,16,40,44,48,53,56,67,85,87,93,95,96,102,110,111,115,128,129,130],$VN=[1,151],$VO=[1,153],$VP=[1,156],$VQ=[1,157],$VR=[1,158],$VS=[1,167],$VT=[1,175],$VU=[13,16,44,48,53,56,67,85,87,95,96,115,128,129,130],$VV=[13,16,44,48,53,56,67,85,87,95,96,115,126,128,129,130],$VW=[13,16,46,92,115,119,120,130,131,132,133,134,135,136],parser={trace:__name(function(){},"trace"),yy:{},symbols_:{error:2,shaclDoc:3,shaclDoc_repetition0:4,shaclDoc_repetition1:5,ttlSection:6,EOF:7,directive:8,baseDecl:9,importsDecl:10,prefixDecl:11,KW_BASE:12,IRIREF:13,KW_IMPORTS:14,KW_PREFIX:15,PNAME_NS:16,nodeShapeIri:17,iri:18,nodeShape:19,KW_SHAPE:20,nodeShape_option0:21,nodeShape_option1:22,nodeShapeBody:23,shapeClass:24,KW_SHAPE_CLASS:25,shapeClass_option0:26,turtleAnnotation:27,";":28,turtleAnnotation2:29,predicate:30,turtleAnnotation2_option0:31,objectList:32,object:33,objectList_repetition0:34,iriOrLiteral:35,blankNodeSection:36,list:37,"(":38,list_repetition0:39,")":40,objectTail:41,",":42,LB:43,"[":44,RB:45,"]":46,LP:47,"%":48,RP:49,pcSection:50,iriHead:51,ttlStatement:52,".":53,ttlSection_repetition0:54,startNodeShape:55,"{":56,endNodeShape:57,"}":58,nodeShapeBody_repetition0:59,targetClass:60,"->":61,targetClass_repetition_plus0:62,constraint:63,constraint_group0:64,constraint_option0:65,orNotComponent:66,"|":67,nodeNot:68,nodeOrEmit:69,nodeOr:70,nodeOr_repetition_plus0:71,nodeValue:72,negation:73,nodeValue_group0:74,"=":75,iriOrLiteralOrArray:76,propertyShape:77,path:78,propertyShape_repetition0:79,propertyOrComponent:80,propertyNot:81,propertyOr:82,propertyOr_repetition_plus0:83,propertyAtom:84,NODEKIND:85,shapeRef:86,PARAM:87,propertyCount:88,propertyMinCount:89,"..":90,propertyMaxCount:91,INTEGER:92,"*":93,shapeRef_group0:94,"@":95,"!":96,pathAlternative:97,additionalAlternative:98,pathSequence:99,pathAlternative_repetition_plus0:100,additionalSequence:101,"/":102,pathEltOrInverse:103,pathSequence_repetition_plus0:104,pathElt:105,pathPrimary:106,pathMod:107,pathInverse:108,"^":109,"?":110,"+":111,iriOrLiteralOrArray_repetition0:112,literal:113,iri_group0:114,a:115,string:116,LANGTAG:117,"^^":118,DECIMAL:119,DOUBLE:120,literal_group0:121,string_group0:122,string_group1:123,shaclDoc_repetition1_group0:124,constraint_group0_repetition_plus0:125,TARGET:126,propertyShape_repetition0_group0:127,ATPNAME_LN:128,ATPNAME_NS:129,PNAME_LN:130,KW_TRUE:131,KW_FALSE:132,STRING_LITERAL1:133,STRING_LITERAL2:134,STRING_LITERAL_LONG1:135,STRING_LITERAL_LONG2:136,$accept:0,$end:1},terminals_:{2:"error",7:"EOF",12:"KW_BASE",13:"IRIREF",14:"KW_IMPORTS",15:"KW_PREFIX",16:"PNAME_NS",20:"KW_SHAPE",25:"KW_SHAPE_CLASS",28:";",38:"(",40:")",42:",",44:"[",46:"]",48:"%",53:".",56:"{",58:"}",61:"->",67:"|",75:"=",85:"NODEKIND",87:"PARAM",90:"..",92:"INTEGER",93:"*",95:"@",96:"!",102:"/",109:"^",110:"?",111:"+",115:"a",117:"LANGTAG",118:"^^",119:"DECIMAL",120:"DOUBLE",126:"TARGET",128:"ATPNAME_LN",129:"ATPNAME_NS",130:"PNAME_LN",131:"KW_TRUE",132:"KW_FALSE",133:"STRING_LITERAL1",134:"STRING_LITERAL2",135:"STRING_LITERAL_LONG1",136:"STRING_LITERAL_LONG2"},productions_:[0,[3,4],[8,1],[8,1],[8,1],[9,2],[10,2],[11,3],[17,1],[19,5],[24,4],[27,2],[29,2],[30,2],[32,2],[33,1],[33,1],[33,1],[37,3],[41,2],[43,1],[45,1],[36,3],[47,1],[49,1],[50,3],[51,1],[52,3],[6,1],[55,1],[57,1],[23,3],[60,2],[63,3],[66,2],[69,1],[70,1],[70,2],[68,1],[68,2],[72,3],[77,2],[80,2],[82,1],[82,2],[81,1],[81,2],[84,1],[84,1],[84,1],[84,3],[84,1],[88,5],[89,1],[91,1],[91,1],[86,1],[86,2],[73,1],[78,1],[98,2],[97,1],[97,2],[101,2],[99,1],[99,2],[105,1],[105,2],[103,1],[103,2],[108,1],[107,1],[107,1],[107,1],[106,1],[106,3],[76,1],[76,3],[35,1],[35,1],[18,1],[18,1],[18,1],[113,1],[113,2],[113,3],[113,1],[113,1],[113,1],[113,1],[116,1],[116,1],[4,0],[4,2],[124,1],[124,1],[5,0],[5,2],[21,0],[21,1],[22,0],[22,1],[26,0],[26,1],[31,0],[31,1],[34,0],[34,2],[39,0],[39,2],[54,0],[54,2],[59,0],[59,2],[62,1],[62,2],[125,1],[125,2],[64,1],[64,1],[65,0],[65,1],[71,1],[71,2],[74,1],[74,1],[127,1],[127,1],[79,0],[79,2],[83,1],[83,2],[94,1],[94,1],[100,1],[100,2],[104,1],[104,2],[112,0],[112,2],[114,1],[114,1],[121,1],[121,1],[122,1],[122,1],[123,1],[123,1]],performAction:__name(function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:this.$=emit(Parser3.factory.namedNode(resolveIRI("")),Parser3.factory.namedNode(RDF_TYPE),Parser3.factory.namedNode(OWL+"Ontology"));break;case 5:Parser3.base=Parser3.factory.namedNode($$[$0].slice(1,-1)),Parser3.n3Parser._setBase(Parser3.base.value);break;case 6:this.$=emit(Parser3.base,Parser3.factory.namedNode(OWL+"imports"),Parser3.factory.namedNode($$[$0].slice(1,-1)));break;case 7:this.$=Parser3.prefixes[$$[$0-1].substr(0,$$[$0-1].length-1)]=resolveIRI($$[$0]);break;case 8:Parser3.nodeShapeStack=!1,emit(Parser3.currentNodeShape=$$[$0],Parser3.factory.namedNode(RDF_TYPE),Parser3.factory.namedNode(SH+"NodeShape"));break;case 10:this.$=emit(Parser3.currentNodeShape,Parser3.factory.namedNode(RDF_TYPE),Parser3.factory.namedNode(RDFS+"Class"));break;case 11:this.$=ensureExtended();break;case 13:this.$=$$[$0].forEach(e=>emit(Parser3.currentNodeShape,$$[$0-1],e));break;case 14:this.$=[$$[$0-1],...$$[$0]];break;case 18:this.$=addList($$[$0-1],!0);break;case 19:case 34:case 42:case 60:case 63:this.$=$$[$0];break;case 20:Parser3.tempCurrentNodeShape=Parser3.currentNodeShape,this.$=Parser3.currentNodeShape=blank();break;case 21:Parser3.currentNodeShape=Parser3.tempCurrentNodeShape;break;case 22:case 31:this.$=$$[$0-2];break;case 23:Parser3.tempCurrentNodeShape=Parser3.currentNodeShape,Parser3.currentNodeShape=Parser3.currentPropertyNode;break;case 24:Parser3.currentNodeShape=Parser3.tempCurrentNodeShape;break;case 26:Parser3.currentNodeShape=$$[$0];break;case 29:Parser3.nodeShapeStack?(Parser3.nodeShapeStack.push(Parser3.currentNodeShape),emit(Parser3.currentPropertyNode,Parser3.factory.namedNode(SH+"node"),Parser3.currentNodeShape=blank())):Parser3.nodeShapeStack=[],this.$=Parser3.currentNodeShape;break;case 30:Parser3.nodeShapeStack.length>0&&(Parser3.currentNodeShape=Parser3.nodeShapeStack.pop());break;case 32:this.$=$$[$0].forEach(node2=>{emit(Parser3.currentNodeShape,Parser3.factory.namedNode(SH+"targetClass"),node2)});break;case 35:this.$=emit(Parser3.currentNodeShape,Parser3.factory.namedNode(SH+$$[$0][0]),$$[$0][1]);break;case 36:break;case 37:const o2=addList([$$[$0-1],...$$[$0]].map(elem=>{const x=blank();return emit(x,Parser3.factory.namedNode(SH+elem[0]),elem[1]),x}));this.$=["or",o2];break;case 39:case 46:this.$=chainProperty("not",...$$[$0]);break;case 40:case 50:this.$=[$$[$0-2],$$[$0]];break;case 43:this.$=$$[$0]&&emitProperty(...$$[$0]);break;case 44:this.$=emitProperty("or",addList([$$[$0-1],...$$[$0]].map(elem=>{const x=blank();return emit(x,Parser3.factory.namedNode(SH+elem[0]),elem[1]),x})));break;case 47:this.$=[datatypes[$$[$0].value]?"datatype":"class",$$[$0]];break;case 48:this.$=["nodeKind",Parser3.factory.namedNode(SH+$$[$0])];break;case 49:this.$=["node",Parser3.factory.namedNode($$[$0])];break;case 51:this.$=void 0;break;case 53:this.$=$$[$0]>0&&emitProperty("minCount",createTypedLiteral($$[$0],XSD_INTEGER));break;case 54:this.$=emitProperty("maxCount",createTypedLiteral($$[$0],XSD_INTEGER));break;case 56:this.$=expandPrefix($$[$0].slice(1));break;case 57:this.$=resolveIRI($$[$0]);break;case 59:emit(Parser3.currentNodeShape,Parser3.factory.namedNode(SH+"property"),Parser3.currentPropertyNode=blank()),emitProperty("path",$$[$0]);break;case 62:const n=blank();emit(n,Parser3.factory.namedNode(SH+"alternativePath"),addList([$$[$0-1],...$$[$0]])),this.$=n;break;case 65:this.$=addList([$$[$0-1],...$$[$0]]);break;case 67:emit(this.$=blank(),Parser3.factory.namedNode(SH+$$[$0]),$$[$0-1]);break;case 69:emit(this.$=blank(),Parser3.factory.namedNode(SH+"inversePath"),$$[$0]);break;case 71:this.$="zeroOrOnePath";break;case 72:this.$="zeroOrMorePath";break;case 73:this.$="oneOrMorePath";break;case 75:this.$=$$[$0-1];break;case 77:this.$=addList($$[$0-1]);break;case 80:this.$=Parser3.factory.namedNode(resolveIRI($$[$0]));break;case 81:this.$=Parser3.factory.namedNode(expandPrefix($$[$0]));break;case 82:this.$=ensureExtended(Parser3.factory.namedNode(RDF_TYPE));break;case 83:this.$=createTypedLiteral($$[$0]);break;case 84:this.$=createLangLiteral($$[$0-1],lowercase($$[$0].substr(1)));break;case 85:this.$=createTypedLiteral($$[$0-2],$$[$0]);break;case 86:this.$=createTypedLiteral($$[$0],XSD_INTEGER);break;case 87:this.$=createTypedLiteral($$[$0],XSD_DECIMAL);break;case 88:this.$=createTypedLiteral($$[$0].toLowerCase(),XSD_DOUBLE);break;case 89:this.$=createTypedLiteral($$[$0].toLowerCase(),XSD_BOOLEAN);break;case 90:this.$=unescapeString($$[$0],1);break;case 91:this.$=unescapeString($$[$0],3);break;case 92:case 96:case 106:case 108:case 110:case 112:case 128:case 138:this.$=[];break;case 93:case 97:case 107:case 109:case 111:case 113:case 115:case 117:case 123:case 129:case 131:case 135:case 137:case 139:$$[$0-1].push($$[$0]);break;case 114:case 116:case 122:case 130:case 134:case 136:this.$=[$$[$0]];break}},"anonymous"),table:[o($V0,[2,92],{3:1,4:2}),{1:[3]},o($V1,[2,96],{5:3,8:4,9:5,10:6,11:7,12:[1,8],14:[1,9],15:[1,10]}),o($V2,[2,110],{6:11,124:12,54:13,19:14,24:15,20:[1,16],25:[1,17]}),o($V0,[2,93]),o($V0,[2,2]),o($V0,[2,3]),o($V0,[2,4]),{13:[1,18]},{13:[1,19]},{16:[1,20]},{7:[1,21]},o($V1,[2,97]),{7:[2,28],13:$V3,16:$V4,18:24,51:23,52:22,114:26,115:$V5,130:$V6},o($V1,[2,94]),o($V1,[2,95]),{13:$V3,16:$V4,17:30,18:31,114:26,115:$V5,130:$V6},{13:$V3,16:$V4,17:32,18:31,114:26,115:$V5,130:$V6},o($V0,[2,5]),o($V0,[2,6]),{13:[1,33]},{1:[2,1]},o($V2,[2,111]),{13:$V3,16:$V4,18:36,29:34,30:35,114:26,115:$V5,130:$V6},o($V7,[2,26]),o($V8,[2,80]),o($V8,[2,81]),o($V8,[2,82]),o($V8,[2,140]),o($V8,[2,141]),o($V9,[2,98],{21:37,60:38,61:[1,39]}),o([28,56,61],[2,8]),{26:40,27:41,28:$Va,56:[2,102]},o($V0,[2,7]),{53:[1,43]},o($Vb,[2,104],{31:44,27:45,28:$Va}),{13:$V3,16:$V4,18:51,32:46,33:47,35:48,36:49,37:50,38:$Vc,43:53,44:$Vd,92:$Ve,113:52,114:26,115:$V5,116:55,119:$Vf,120:$Vg,121:59,122:61,123:62,130:$V6,131:$Vh,132:$Vi,133:$Vj,134:$Vk,135:$Vl,136:$Vm},{22:69,27:70,28:$Va,56:[2,100]},o($V9,[2,99]),{13:$V3,16:$V4,18:72,62:71,114:26,115:$V5,130:$V6},{23:73,55:74,56:$Vn},{56:[2,103]},{13:$V3,16:$V4,18:36,29:76,30:35,114:26,115:$V5,130:$V6},o($V2,[2,27]),o($Vb,[2,12]),o($Vb,[2,105]),o($Vo,[2,13]),o($Vp,[2,106],{34:77}),o($Vq,[2,15]),o($Vq,[2,16]),o($Vq,[2,17]),o($Vr,[2,78]),o($Vr,[2,79]),{13:$V3,16:$V4,18:36,29:78,30:35,114:26,115:$V5,130:$V6},o($Vs,[2,108],{39:79}),o($Vr,[2,83],{117:[1,80],118:[1,81]}),o($Vr,[2,86]),o($Vr,[2,87]),o($Vr,[2,88]),o($Vr,[2,89]),o($V7,[2,20]),o($Vt,[2,90]),o($Vt,[2,91]),o($Vr,[2,142]),o($Vr,[2,143]),o($Vt,[2,144]),o($Vt,[2,145]),o($Vt,[2,146]),o($Vt,[2,147]),{23:82,55:74,56:$Vn},{56:[2,101]},o($V9,[2,32],{114:26,18:83,13:$V3,16:$V4,115:$V5,130:$V6}),o($Vu,[2,114]),o($V1,[2,10]),o($Vv,[2,112],{59:84}),o($Vv,[2,29]),o($Vb,[2,11]),o($Vo,[2,14],{41:85,42:[1,86]}),{45:87,46:[1,88]},{13:$V3,16:$V4,18:51,33:90,35:48,36:49,37:50,38:$Vc,40:[1,89],43:53,44:$Vd,92:$Ve,113:52,114:26,115:$V5,116:55,119:$Vf,120:$Vg,121:59,122:61,123:62,130:$V6,131:$Vh,132:$Vi,133:$Vj,134:$Vk,135:$Vl,136:$Vm},o($Vr,[2,84]),{13:$V3,16:$V4,18:91,114:26,115:$V5,130:$V6},o($V1,[2,9]),o($Vu,[2,115]),{13:$V3,16:$V4,18:115,38:$Vw,57:92,58:[1,94],63:93,64:95,68:102,69:98,70:100,72:104,73:105,74:107,77:97,78:99,87:$Vx,96:$Vy,97:101,99:103,103:106,105:109,106:113,108:110,109:$Vz,114:26,115:$V5,125:96,126:$VA,130:$V6},o($Vp,[2,107]),{13:$V3,16:$V4,18:51,33:117,35:48,36:49,37:50,38:$Vc,43:53,44:$Vd,92:$Ve,113:52,114:26,115:$V5,116:55,119:$Vf,120:$Vg,121:59,122:61,123:62,130:$V6,131:$Vh,132:$Vi,133:$Vj,134:$Vk,135:$Vl,136:$Vm},o($Vq,[2,22]),o($Vq,[2,21]),o($Vq,[2,18]),o($Vs,[2,109]),o($Vr,[2,85]),o($VB,[2,31]),o($Vv,[2,113]),o($VB,[2,30]),{47:120,48:[1,121],50:119,53:[2,120],65:118},o($VC,[2,118],{70:100,68:102,72:104,73:105,74:107,69:122,87:$Vx,96:$Vy,126:$VA}),o($VC,[2,119]),o($VD,[2,116]),o($VE,[2,128],{79:123}),o($VD,[2,35]),o($VE,[2,59]),o($VD,[2,36],{71:124,66:125,67:$VF}),o($VG,[2,61],{100:127,98:128,67:$VH}),o($VI,[2,38]),{72:130,74:107,87:$Vx,126:$VA},o($VJ,[2,64],{104:131,101:132,102:$VK}),{75:[1,134]},o([13,16,56,85,87,95,115,126,128,129,130],[2,58]),o($VL,[2,68]),{13:$V3,16:$V4,18:115,38:$Vw,105:135,106:113,114:26,115:$V5,130:$V6},{75:[2,124]},{75:[2,125]},o($VL,[2,66],{107:136,93:[1,138],110:[1,137],111:[1,139]}),o([13,16,38,115,130],[2,70]),o($VM,[2,74]),{13:$V3,16:$V4,18:115,38:$Vw,97:140,99:103,103:106,105:109,106:113,108:110,109:$Vz,114:26,115:$V5,130:$V6},o($Vp,[2,19]),{53:[1,141]},{53:[2,121]},{13:$V3,16:$V4,18:36,29:142,30:35,114:26,115:$V5,130:$V6},o($V7,[2,23]),o($VD,[2,117]),o($VC,[2,41],{114:26,55:74,127:143,88:144,82:145,81:147,84:148,73:149,18:150,86:152,23:154,94:155,13:$V3,16:$V4,44:[1,146],56:$Vn,85:$VN,87:$VO,95:$VP,96:$Vy,115:$V5,128:$VQ,129:$VR,130:$V6}),o($VD,[2,37],{66:159,67:$VF}),o($VI,[2,122]),{68:160,72:104,73:105,74:107,87:$Vx,96:$Vy,126:$VA},o($VG,[2,62],{98:161,67:$VH}),o($VJ,[2,134]),{13:$V3,16:$V4,18:115,38:$Vw,99:162,103:106,105:109,106:113,108:110,109:$Vz,114:26,115:$V5,130:$V6},o($VI,[2,39]),o($VJ,[2,65],{101:163,102:$VK}),o($VL,[2,136]),{13:$V3,16:$V4,18:115,38:$Vw,103:164,105:109,106:113,108:110,109:$Vz,114:26,115:$V5,130:$V6},{13:$V3,16:$V4,18:51,35:166,44:$VS,76:165,92:$Ve,113:52,114:26,115:$V5,116:55,119:$Vf,120:$Vg,121:59,122:61,123:62,130:$V6,131:$Vh,132:$Vi,133:$Vj,134:$Vk,135:$Vl,136:$Vm},o($VL,[2,69]),o($VL,[2,67]),o($VL,[2,71]),o($VL,[2,72]),o($VL,[2,73]),{40:[1,168]},o($Vv,[2,33]),{48:[1,170],49:169},o($VE,[2,129]),o($VE,[2,126]),o($VE,[2,127]),{89:171,92:[1,172]},o($VE,[2,43],{83:173,80:174,67:$VT}),o($VU,[2,45]),{13:$V3,16:$V4,18:150,23:154,55:74,56:$Vn,84:176,85:$VN,86:152,87:$VO,94:155,95:$VP,114:26,115:$V5,128:$VQ,129:$VR,130:$V6},o($VU,[2,47]),o($VU,[2,48]),o($VU,[2,49]),{75:[1,177]},o($VU,[2,51]),o($VU,[2,56]),{13:[1,178]},o($VU,[2,132]),o($VU,[2,133]),o($VI,[2,123]),o($VI,[2,34]),o($VJ,[2,135]),o($VJ,[2,60]),o($VL,[2,137]),o($VL,[2,63]),o($VI,[2,40]),o($VV,[2,76]),o($VW,[2,138],{112:179}),o($VM,[2,75]),{53:[2,25]},{53:[2,24]},{90:[1,180]},{90:[2,53]},o($VE,[2,44],{80:181,67:$VT}),o($VU,[2,130]),{13:$V3,16:$V4,18:150,23:154,55:74,56:$Vn,73:149,81:182,84:148,85:$VN,86:152,87:$VO,94:155,95:$VP,96:$Vy,114:26,115:$V5,128:$VQ,129:$VR,130:$V6},o($VU,[2,46]),{13:$V3,16:$V4,18:51,35:166,44:$VS,76:183,92:$Ve,113:52,114:26,115:$V5,116:55,119:$Vf,120:$Vg,121:59,122:61,123:62,130:$V6,131:$Vh,132:$Vi,133:$Vj,134:$Vk,135:$Vl,136:$Vm},o($VU,[2,57]),{13:$V3,16:$V4,18:51,35:185,46:[1,184],92:$Ve,113:52,114:26,115:$V5,116:55,119:$Vf,120:$Vg,121:59,122:61,123:62,130:$V6,131:$Vh,132:$Vi,133:$Vj,134:$Vk,135:$Vl,136:$Vm},{91:186,92:[1,187],93:[1,188]},o($VU,[2,131]),o($VU,[2,42]),o($VU,[2,50]),o($VV,[2,77]),o($VW,[2,139]),{46:[1,189]},{46:[2,54]},{46:[2,55]},o($VE,[2,52])],defaultActions:{21:[2,1],41:[2,103],70:[2,101],111:[2,124],112:[2,125],119:[2,121],169:[2,25],170:[2,24],172:[2,53],187:[2,54],188:[2,55]},parseError:__name(function(str,hash2){if(hash2.recoverable)this.trace(str);else{var error=new Error(str);throw error.hash=hash2,error}},"parseError"),parse:__name(function(input){var self2=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,TERROR=2,EOF=1,args=lstack.slice.call(arguments,1),lexer2=Object.create(this.lexer),sharedState={yy:{}};for(var k in this.yy)Object.prototype.hasOwnProperty.call(this.yy,k)&&(sharedState.yy[k]=this.yy[k]);lexer2.setInput(input,sharedState.yy),sharedState.yy.lexer=lexer2,sharedState.yy.parser=this,typeof lexer2.yylloc>"u"&&(lexer2.yylloc={});var yyloc=lexer2.yylloc;lstack.push(yyloc);var ranges=lexer2.options&&lexer2.options.ranges;typeof sharedState.yy.parseError=="function"?this.parseError=sharedState.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var lex=__name(function(){var token;return token=lexer2.lex()||EOF,typeof token!="number"&&(token=self2.symbols_[token]||token),token},"lex"),symbol,state,action,r2,yyval={},p,len,newState,expected;;){if(state=stack[stack.length-1],this.defaultActions[state]?action=this.defaultActions[state]:((symbol===null||typeof symbol>"u")&&(symbol=lex()),action=table[state]&&table[state][symbol]),typeof action>"u"||!action.length||!action[0]){var errStr="";expected=[];for(p in table[state])this.terminals_[p]&&p>TERROR&&expected.push("'"+this.terminals_[p]+"'");lexer2.showPosition?errStr="Parse error on line "+(yylineno+1)+`:
`+lexer2.showPosition()+`
Expecting `+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==EOF?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:lexer2.match,token:this.terminals_[symbol]||symbol,line:lexer2.yylineno,loc:yyloc,expected})}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(lexer2.yytext),lstack.push(lexer2.yylloc),stack.push(action[1]),symbol=null,yyleng=lexer2.yyleng,yytext=lexer2.yytext,yylineno=lexer2.yylineno,yyloc=lexer2.yylloc;break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),r2=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args)),typeof r2<"u")return r2;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0},"parse")};const RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_TYPE=RDF+"type",RDF_FIRST=RDF+"first",RDF_REST=RDF+"rest",RDF_NIL=RDF+"nil",XSD="http://www.w3.org/2001/XMLSchema#",XSD_INTEGER=XSD+"integer",XSD_DECIMAL=XSD+"decimal",XSD_DOUBLE=XSD+"double",XSD_BOOLEAN=XSD+"boolean",SH="http://www.w3.org/ns/shacl#",OWL="http://www.w3.org/2002/07/owl#",RDFS="http://www.w3.org/2000/01/rdf-schema#",datatypes={[XSD_INTEGER]:!0,[XSD_DECIMAL]:!0,[XSD+"float"]:!0,[XSD_DOUBLE]:!0,[XSD+"string"]:!0,[XSD_BOOLEAN]:!0,[XSD+"dateTime"]:!0,[XSD+"nonPositiveInteger"]:!0,[XSD+"negativeInteger"]:!0,[XSD+"long"]:!0,[XSD+"int"]:!0,[XSD+"short"]:!0,[XSD+"byte"]:!0,[XSD+"nonNegativeInteger"]:!0,[XSD+"unsignedLong"]:!0,[XSD+"unsignedShort"]:!0,[XSD+"unsignedByte"]:!0,[XSD+"positiveInteger"]:!0,[RDF+"langString"]:!0};function addList(elems,ttlList=!1){let i=0,l=elems.length;if(ttlList&&l===0)return Parser3.factory.namedNode(RDF_NIL);const list=head=blank();return l===0&&emit(head,Parser3.factory.namedNode(RDF_REST),Parser3.factory.namedNode(RDF_NIL)),elems.forEach(elem=>{if(elem===void 0)throw new Error("b");emit(head,Parser3.factory.namedNode(RDF_FIRST),elem),emit(head,Parser3.factory.namedNode(RDF_REST),head=++i<l?blank():Parser3.factory.namedNode(RDF_NIL))}),list}__name(addList,"addList");function resolveIRI(iri){return Parser3.n3Parser._resolveIRI(iri[0]==="<"?iri.substring(1,iri.length-1):iri)}__name(resolveIRI,"resolveIRI");function expandPrefix(iri){const namePos=iri.indexOf(":"),prefix=iri.substr(0,namePos),expansion=Parser3.prefixes[prefix];if(!expansion)throw new Error("Unknown prefix: "+prefix);return resolveIRI(expansion+iri.substr(namePos+1))}__name(expandPrefix,"expandPrefix");function createTypedLiteral(value,type){return type&&type.termType!=="NamedNode"&&(type=Parser3.factory.namedNode(type)),Parser3.factory.literal(value,type)}__name(createTypedLiteral,"createTypedLiteral");function createLangLiteral(value,lang2){return Parser3.factory.literal(value,lang2)}__name(createLangLiteral,"createLangLiteral");function blank(name){return typeof name=="string"?name.startsWith("e_")?Parser3.factory.blankNode(name):Parser3.factory.blankNode("e_"+name):Parser3.factory.blankNode("g_"+blankId++)}__name(blank,"blank");var blankId=0;Parser3._resetBlanks=function(){blankId=0};function unescapeString(string,trimLength){return Parser3.n3Parser._lexer._unescape(string.substring(trimLength,string.length-trimLength))}__name(unescapeString,"unescapeString");function emit(s2,p,o2){if(!s2.termType||!p.termType||p.value.includes(",")||!o2.termType)throw new Error(`boo ${s2.value} ${p.value} ${o2.value}`);Parser3.onQuad(Parser3.factory.quad(s2,p,o2))}__name(emit,"emit");function emitProperty(p,o2){emit(Parser3.currentPropertyNode,Parser3.factory.namedNode(SH+p),o2)}__name(emitProperty,"emitProperty");function chainProperty(name,p,o2){const b=blank();return emit(b,Parser3.factory.namedNode(SH+p),o2),[name,b]}__name(chainProperty,"chainProperty");function ensureExtended(input){if(!Parser3.extended)throw new Error("Encountered extended SHACLC syntax; but extended parsing is disabled");return input}__name(ensureExtended,"ensureExtended");var lexer=function(){var lexer2={EOF:1,parseError:__name(function(str,hash2){if(this.yy.parser)this.yy.parser.parseError(str,hash2);else throw new Error(str)},"parseError"),setInput:function(input,yy){return this.yy=yy||this.yy||{},this._input=input,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);return lines?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r2=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r2[0],r2[0]+this.yyleng-len]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+`
`+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer&&(backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(backup.yylloc.range=this.yylloc.range.slice(0))),lines=match[0].match(/(?:\r\n?|\n).*/g),lines&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token)return token;if(this._backtrack){for(var k in backup)this[k]=backup[k];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var token,match,tempMatch,index;this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length;i++)if(tempMatch=this._input.match(this.rules[rules[i]]),tempMatch&&(!match||tempMatch[0].length>match[0].length)){if(match=tempMatch,index=i,this.options.backtrack_lexer){if(token=this.test_match(tempMatch,rules[i]),token!==!1)return token;if(this._backtrack){match=!1;continue}else return!1}else if(!this.options.flex)break}return match?(token=this.test_match(match,rules[index]),token!==!1?token:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:__name(function(){var r2=this.next();return r2||this.lex()},"lex"),begin:__name(function(condition){this.conditionStack.push(condition)},"begin"),popState:__name(function(){var n=this.conditionStack.length-1;return n>0?this.conditionStack.pop():this.conditionStack[0]},"popState"),_currentRules:__name(function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},"_currentRules"),topState:__name(function(n){return n=this.conditionStack.length-1-Math.abs(n||0),n>=0?this.conditionStack[n]:"INITIAL"},"topState"),pushState:__name(function(condition){this.begin(condition)},"pushState"),stateStackSize:__name(function(){return this.conditionStack.length},"stateStackSize"),options:{flex:!0,"case-insensitive":!0},performAction:__name(function(yy,yy_,$avoiding_name_collisions,YY_START){switch($avoiding_name_collisions){case 0:break;case 1:return 12;case 2:return 14;case 3:return 15;case 4:return 25;case 5:return 20;case 6:return 131;case 7:return 132;case 8:return 85;case 9:return 126;case 10:return 87;case 11:return"PASS";case 12:return"COMMENT";case 13:return 13;case 14:return 16;case 15:return 130;case 16:return 129;case 17:return 128;case 18:return 117;case 19:return 92;case 20:return 119;case 21:return 120;case 22:return"EXPONENT";case 23:return 133;case 24:return 134;case 25:return 135;case 26:return 136;case 27:return 61;case 28:return 90;case 29:return 58;case 30:return 56;case 31:return 38;case 32:return 40;case 33:return 44;case 34:return 46;case 35:return 110;case 36:return 93;case 37:return 111;case 38:return 67;case 39:return 118;case 40:return 53;case 41:return 96;case 42:return 102;case 43:return 75;case 44:return 95;case 45:return 109;case 46:return 28;case 47:return 42;case 48:return 48;case 49:return 115;case 50:return 7;case 51:console.log(yy_.yytext);break}},"anonymous"),rules:[/^(?:\s+|#[^\n\r]*)/i,/^(?:BASE)/i,/^(?:IMPORTS)/i,/^(?:PREFIX)/i,/^(?:shapeClass)/i,/^(?:shape)/i,/^(?:true)/i,/^(?:false)/i,/^(?:(BlankNode|IRI|Literal|BlankNodeOrIRI|BlankNodeOrLiteral|IRIOrLiteral\b))/i,/^(?:(targetNode|targetObjectsOf|targetSubjectsOf\b))/i,/^(?:(deactivated|severity|message|class|datatype|nodeKind|minExclusive|minInclusive|maxExclusive|maxInclusive|minLength|maxLength|pattern|flags|languageIn|uniqueLang|equals|disjoint|lessThan|lessThanOrEquals|qualifiedValueShape|qualifiedMinCount|qualifiedMaxCount|qualifiedValueShapesDisjoint|closed|ignoredProperties|hasValue|in))/i,/^(?:([ \t\r\n]+))/i,/^(?:(#[\r\n]*))/i,/^(?:(<([^=<>\"\{\}\|\^`\\\u0000-\u0020]|(\\u([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])|\\U([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f])))*>))/i,/^(?:((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])((((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|\.)*((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040]))?)?:))/i,/^(?:(((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])((((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|\.)*((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040]))?)?:)(((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|:|[0-9]|((%([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))((((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|\.|:|((%([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))*(((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|:|((%([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%)))))?)))/i,/^(?:(@(([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])((((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|\.)*((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040]))?)?:))/i,/^(?:(@((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])((((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|\.)*((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040]))?)?:)(((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|:|[0-9]|((%([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))((((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|\.|:|((%([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))*(((([A-Z]|[a-z]|[\u00C0-\u00D6]|[\u00D8-\u00F6]|[\u00F8-\u02FF]|[\u0370-\u037D]|[\u037F-\u1FFF]|[\u200C-\u200D]|[\u2070-\u218F]|[\u2C00-\u2FEF]|[\u3001-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFFD])|_\b)|-|[0-9]|[\u00B7]|[\u0300-\u036F]|[\u203F-\u2040])|:|((%([0-9]|[A-F]|[a-f])([0-9]|[A-F]|[a-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%)))))?)))/i,/^(?:(@[a-zA-Z]+(-[a-zA-Z0-9]+)*))/i,/^(?:([+-]?[0-9]+))/i,/^(?:([+-]?[0-9]*\.[0-9]+))/i,/^(?:([+-]?([0-9]+\.[0-9]*([eE][+-]?[0-9]+)|\.?[0-9]+([eE][+-]?[0-9]+))))/i,/^(?:([eE][+-]?[0-9]+))/i,/^(?:('(?:(?:[^\u0027\u005C\u000A\u000D])|(\\[tbnrf\\\"\']))*'))/i,/^(?:("(?:(?:[^\u0022\u005C\u000A\u000D])|(\\[tbnrf\\\"\']))*"))/i,/^(?:('''(?:(?:'|'')?(?:[^'\\]|(\\[tbnrf\\\"\'])))*'''))/i,/^(?:("""(?:(?:"|"")?(?:[^\"\\]|(\\[tbnrf\\\"\'])))*"""))/i,/^(?:->)/i,/^(?:\.\.)/i,/^(?:\})/i,/^(?:\{)/i,/^(?:\()/i,/^(?:\))/i,/^(?:\[)/i,/^(?:\])/i,/^(?:\?)/i,/^(?:\*)/i,/^(?:\+)/i,/^(?:\|)/i,/^(?:\^\^)/i,/^(?:\.)/i,/^(?:!)/i,/^(?:\/)/i,/^(?:=)/i,/^(?:@)/i,/^(?:\^)/i,/^(?:;)/i,/^(?:,)/i,/^(?:%)/i,/^(?:a)/i,/^(?:$)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],inclusive:!0}}};return lexer2}();parser.lexer=lexer;function Parser3(){this.yy={}}return __name(Parser3,"Parser"),Parser3.prototype=parser,parser.Parser=Parser3,new Parser3}(),ShaclcParser_1=ShaclcParser$1;const ShaclcParser=ShaclcParser_1.Parser,N3=require$$0$3;let Parser$4=__name(class{constructor(){}parse(str,{extendedSyntax,baseIRI}={}){this._parser=new ShaclcParser,this._parser.Parser.factory=N3.DataFactory,this._parser.Parser.base=N3.DataFactory.namedNode(baseIRI||"urn:x-base:default"),this._parser.Parser.extended=extendedSyntax===!0,this._parser.Parser.prefixes={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",sh:"http://www.w3.org/ns/shacl#",xsd:"http://www.w3.org/2001/XMLSchema#"},this._parser.Parser.currentNodeShape=void 0,this._parser.Parser.currentPropertyNode=void 0,this._parser.Parser.nodeShapeStack=[],this._parser.Parser.tempCurrentNodeShape=void 0,this._parser.Parser.n3Parser=new N3.Parser({baseIRI:baseIRI||"urn:x-base:default"});const arr=[];return this._parser.Parser.onQuad=quad=>{arr.push(quad)},this._parser.parse(str),arr.prefixes=this._parser.Parser.prefixes,arr}},"Parser");lib$1K.Parser=Parser$4;lib$1K.parse=__name(function(str,options){return new Parser$4().parse(str,options)},"parse");var PrefixWrappingIterator$1={};Object.defineProperty(PrefixWrappingIterator$1,"__esModule",{value:!0});PrefixWrappingIterator$1.PrefixWrappingIterator=void 0;const asynciterator_1$o=asynciterator;class PrefixWrappingIterator extends asynciterator_1$o.WrappingIterator{constructor(source){super(source==null?void 0:source.then(src=>(this.prefixes=src.prefixes,src)))}read(){if(this.prefixes){for(const args of Object.entries(this.prefixes))this.emit("prefix",...args);delete this.prefixes}return super.read()}}__name(PrefixWrappingIterator,"PrefixWrappingIterator");PrefixWrappingIterator$1.PrefixWrappingIterator=PrefixWrappingIterator;Object.defineProperty(ActorRdfParseShaclc$1,"__esModule",{value:!0});ActorRdfParseShaclc$1.ActorRdfParseShaclc=void 0;const bus_rdf_parse_1$2=lib$1U,readable_stream_1$b=browserExports$1,shaclc_parse_1=lib$1K,streamToString=streamToString$1,PrefixWrappingIterator_1=PrefixWrappingIterator$1;class ActorRdfParseShaclc extends bus_rdf_parse_1$2.ActorRdfParseFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){const prefixIterator=new PrefixWrappingIterator_1.PrefixWrappingIterator(streamToString(action.data).then(str=>{var _a2;return(0,shaclc_parse_1.parse)(str,{extendedSyntax:mediaType==="text/shaclc-ext",baseIRI:(_a2=action.metadata)==null?void 0:_a2.baseIRI})})),readable=new readable_stream_1$b.Readable({objectMode:!0});return prefixIterator.on("prefix",(...args)=>readable.emit("prefix",...args)),{data:readable.wrap(prefixIterator),metadata:{triples:!0}}}}__name(ActorRdfParseShaclc,"ActorRdfParseShaclc");ActorRdfParseShaclc$1.ActorRdfParseShaclc=ActorRdfParseShaclc;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseShaclc$1,exports)})(lib$1L);var lib$1J={},ActorRdfJoinSelectivityVariableCounting$1={},lib$1I={},ActorRdfJoinSelectivity$1={};Object.defineProperty(ActorRdfJoinSelectivity$1,"__esModule",{value:!0});ActorRdfJoinSelectivity$1.ActorRdfJoinSelectivity=void 0;const core_1$f=lib$2A;class ActorRdfJoinSelectivity extends core_1$f.Actor{constructor(args){super(args)}}__name(ActorRdfJoinSelectivity,"ActorRdfJoinSelectivity");ActorRdfJoinSelectivity$1.ActorRdfJoinSelectivity=ActorRdfJoinSelectivity;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinSelectivity$1,exports)})(lib$1I);Object.defineProperty(ActorRdfJoinSelectivityVariableCounting$1,"__esModule",{value:!0});ActorRdfJoinSelectivityVariableCounting$1.JoinTypes=ActorRdfJoinSelectivityVariableCounting$1.ActorRdfJoinSelectivityVariableCounting=void 0;const bus_rdf_join_selectivity_1=lib$1I,sparqlalgebrajs_1$s=sparqlalgebrajs;class ActorRdfJoinSelectivityVariableCounting extends bus_rdf_join_selectivity_1.ActorRdfJoinSelectivity{constructor(args){super(args)}async test(action){return{accuracy:.5}}static getPatternCost(pattern){let cost=1;return pattern.subject.termType==="Variable"&&(cost+=4),(pattern.predicate.termType==="Variable"||pattern.type===sparqlalgebrajs_1$s.Algebra.types.PATH)&&(cost+=1),pattern.object.termType==="Variable"&&(cost+=2),pattern.graph.termType==="Variable"&&(cost+=1),cost/9}static getJoinTypes(operation1,operation2){const joinTypes=[];return operation1.subject.termType==="Variable"?(operation1.subject.equals(operation2.subject)&&joinTypes.push(JoinTypes.unboundSS),operation2.type==="pattern"&&operation1.subject.equals(operation2.predicate)&&joinTypes.push(JoinTypes.unboundSP),operation1.subject.equals(operation2.object)&&joinTypes.push(JoinTypes.unboundSO),operation1.subject.equals(operation2.graph)&&joinTypes.push(JoinTypes.unboundSG)):(operation1.subject.equals(operation2.subject)&&joinTypes.push(JoinTypes.boundSS),operation2.type==="pattern"&&operation1.subject.equals(operation2.predicate)&&joinTypes.push(JoinTypes.boundSP),operation1.subject.equals(operation2.object)&&joinTypes.push(JoinTypes.boundSO),operation1.subject.equals(operation2.graph)&&joinTypes.push(JoinTypes.boundSG)),operation1.type==="pattern"&&(operation1.predicate.termType==="Variable"?(operation1.predicate.equals(operation2.subject)&&joinTypes.push(JoinTypes.unboundPS),operation2.type==="pattern"&&operation1.predicate.equals(operation2.predicate)&&joinTypes.push(JoinTypes.unboundPP),operation1.predicate.equals(operation2.object)&&joinTypes.push(JoinTypes.unboundPO),operation1.predicate.equals(operation2.graph)&&joinTypes.push(JoinTypes.unboundPG)):(operation1.predicate.equals(operation2.subject)&&joinTypes.push(JoinTypes.boundPS),operation2.type==="pattern"&&operation1.predicate.equals(operation2.predicate)&&joinTypes.push(JoinTypes.boundPP),operation1.predicate.equals(operation2.object)&&joinTypes.push(JoinTypes.boundPO),operation1.predicate.equals(operation2.graph)&&joinTypes.push(JoinTypes.boundPG))),operation1.object.termType==="Variable"?(operation1.object.equals(operation2.subject)&&joinTypes.push(JoinTypes.unboundOS),operation2.type==="pattern"&&operation1.object.equals(operation2.predicate)&&joinTypes.push(JoinTypes.unboundOP),operation1.object.equals(operation2.object)&&joinTypes.push(JoinTypes.unboundOO),operation1.object.equals(operation2.graph)&&joinTypes.push(JoinTypes.unboundOG)):(operation1.object.equals(operation2.subject)&&joinTypes.push(JoinTypes.boundOS),operation2.type==="pattern"&&operation1.object.equals(operation2.predicate)&&joinTypes.push(JoinTypes.boundOP),operation1.object.equals(operation2.object)&&joinTypes.push(JoinTypes.boundOO),operation1.object.equals(operation2.graph)&&joinTypes.push(JoinTypes.boundOG)),operation1.graph.termType==="Variable"?(operation1.graph.equals(operation2.subject)&&joinTypes.push(JoinTypes.unboundGS),operation2.type==="pattern"&&operation1.graph.equals(operation2.predicate)&&joinTypes.push(JoinTypes.unboundGP),operation1.graph.equals(operation2.object)&&joinTypes.push(JoinTypes.unboundGO),operation1.graph.equals(operation2.graph)&&joinTypes.push(JoinTypes.unboundGG)):(operation1.graph.equals(operation2.subject)&&joinTypes.push(JoinTypes.boundGS),operation2.type==="pattern"&&operation1.graph.equals(operation2.predicate)&&joinTypes.push(JoinTypes.boundGP),operation1.graph.equals(operation2.object)&&joinTypes.push(JoinTypes.boundGO),operation1.graph.equals(operation2.graph)&&joinTypes.push(JoinTypes.boundGG)),joinTypes}static getOperationsPairwiseJoinCost(operation1,operation2){let cost=ActorRdfJoinSelectivityVariableCounting.MAX_PAIRWISE_COST;for(const joinType of ActorRdfJoinSelectivityVariableCounting.getJoinTypes(operation1,operation2))switch(joinType){case JoinTypes.boundSS:cost-=2*2;break;case JoinTypes.boundSP:cost-=3*2;break;case JoinTypes.boundSO:cost-=1*2;break;case JoinTypes.boundSG:cost-=3*2;break;case JoinTypes.boundPS:cost-=3*2;break;case JoinTypes.boundPP:return 1;case JoinTypes.boundPO:cost-=3*2;break;case JoinTypes.boundPG:cost-=3*2;break;case JoinTypes.boundOS:cost-=1*2;break;case JoinTypes.boundOP:cost-=3*2;break;case JoinTypes.boundOO:cost-=1*2;break;case JoinTypes.boundOG:cost-=3*2;break;case JoinTypes.boundGS:cost-=3*2;break;case JoinTypes.boundGP:cost-=3*2;break;case JoinTypes.boundGO:cost-=3*2;break;case JoinTypes.boundGG:cost-=3*2;break;case JoinTypes.unboundSS:cost-=2;break;case JoinTypes.unboundSP:cost-=3;break;case JoinTypes.unboundSO:cost-=1;break;case JoinTypes.unboundSG:cost-=3;break;case JoinTypes.unboundPS:cost-=3;break;case JoinTypes.unboundPP:cost-=3;break;case JoinTypes.unboundPO:cost-=3;break;case JoinTypes.unboundPG:cost-=3;break;case JoinTypes.unboundOS:cost-=1;break;case JoinTypes.unboundOP:cost-=3;break;case JoinTypes.unboundOO:cost-=1;break;case JoinTypes.unboundOG:cost-=3;break;case JoinTypes.unboundGS:cost-=3;break;case JoinTypes.unboundGP:cost-=3;break;case JoinTypes.unboundGO:cost-=3;break;case JoinTypes.unboundGG:cost-=3;break}return cost/ActorRdfJoinSelectivityVariableCounting.MAX_PAIRWISE_COST}static getOperationsJoinCost(operations){const patterns=[];for(const operation of operations)sparqlalgebrajs_1$s.Util.recurseOperation(operation,{[sparqlalgebrajs_1$s.Algebra.types.PATTERN](pattern){return patterns.push(pattern),!1},[sparqlalgebrajs_1$s.Algebra.types.PATH](path){return patterns.push(path),!1}});let totalCost=0,costEntries=0;for(const pattern1 of patterns)for(const pattern2 of patterns)pattern1!==pattern2&&(totalCost+=ActorRdfJoinSelectivityVariableCounting.getOperationsPairwiseJoinCost(pattern1,pattern2),costEntries++);return costEntries===0?1:totalCost/costEntries*patterns.reduce((factor,pattern)=>factor*ActorRdfJoinSelectivityVariableCounting.getPatternCost(pattern),1)}async run(action){return action.entries.length<=1?{selectivity:1}:{selectivity:ActorRdfJoinSelectivityVariableCounting.getOperationsJoinCost(action.entries.map(entry=>entry.operation))}}}__name(ActorRdfJoinSelectivityVariableCounting,"ActorRdfJoinSelectivityVariableCounting");ActorRdfJoinSelectivityVariableCounting$1.ActorRdfJoinSelectivityVariableCounting=ActorRdfJoinSelectivityVariableCounting;ActorRdfJoinSelectivityVariableCounting.MAX_PAIRWISE_COST=41*2;var JoinTypes;(function(JoinTypes2){JoinTypes2[JoinTypes2.boundSS=0]="boundSS",JoinTypes2[JoinTypes2.boundSP=1]="boundSP",JoinTypes2[JoinTypes2.boundSO=2]="boundSO",JoinTypes2[JoinTypes2.boundSG=3]="boundSG",JoinTypes2[JoinTypes2.boundPS=4]="boundPS",JoinTypes2[JoinTypes2.boundPP=5]="boundPP",JoinTypes2[JoinTypes2.boundPO=6]="boundPO",JoinTypes2[JoinTypes2.boundPG=7]="boundPG",JoinTypes2[JoinTypes2.boundOS=8]="boundOS",JoinTypes2[JoinTypes2.boundOP=9]="boundOP",JoinTypes2[JoinTypes2.boundOO=10]="boundOO",JoinTypes2[JoinTypes2.boundOG=11]="boundOG",JoinTypes2[JoinTypes2.boundGS=12]="boundGS",JoinTypes2[JoinTypes2.boundGP=13]="boundGP",JoinTypes2[JoinTypes2.boundGO=14]="boundGO",JoinTypes2[JoinTypes2.boundGG=15]="boundGG",JoinTypes2[JoinTypes2.unboundSS=16]="unboundSS",JoinTypes2[JoinTypes2.unboundSP=17]="unboundSP",JoinTypes2[JoinTypes2.unboundSO=18]="unboundSO",JoinTypes2[JoinTypes2.unboundSG=19]="unboundSG",JoinTypes2[JoinTypes2.unboundPS=20]="unboundPS",JoinTypes2[JoinTypes2.unboundPP=21]="unboundPP",JoinTypes2[JoinTypes2.unboundPO=22]="unboundPO",JoinTypes2[JoinTypes2.unboundPG=23]="unboundPG",JoinTypes2[JoinTypes2.unboundOS=24]="unboundOS",JoinTypes2[JoinTypes2.unboundOP=25]="unboundOP",JoinTypes2[JoinTypes2.unboundOO=26]="unboundOO",JoinTypes2[JoinTypes2.unboundOG=27]="unboundOG",JoinTypes2[JoinTypes2.unboundGS=28]="unboundGS",JoinTypes2[JoinTypes2.unboundGP=29]="unboundGP",JoinTypes2[JoinTypes2.unboundGO=30]="unboundGO",JoinTypes2[JoinTypes2.unboundGG=31]="unboundGG"})(JoinTypes||(ActorRdfJoinSelectivityVariableCounting$1.JoinTypes=JoinTypes={}));(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinSelectivityVariableCounting$1,exports)})(lib$1J);var lib$1H={},ActorRdfJoinEntriesSortCardinality$1={},lib$1G={},ActorRdfJoinEntriesSort$1={};Object.defineProperty(ActorRdfJoinEntriesSort$1,"__esModule",{value:!0});ActorRdfJoinEntriesSort$1.ActorRdfJoinEntriesSort=void 0;const core_1$e=lib$2A;class ActorRdfJoinEntriesSort extends core_1$e.Actor{constructor(args){super(args)}}__name(ActorRdfJoinEntriesSort,"ActorRdfJoinEntriesSort");ActorRdfJoinEntriesSort$1.ActorRdfJoinEntriesSort=ActorRdfJoinEntriesSort;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinEntriesSort$1,exports)})(lib$1G);Object.defineProperty(ActorRdfJoinEntriesSortCardinality$1,"__esModule",{value:!0});ActorRdfJoinEntriesSortCardinality$1.ActorRdfJoinEntriesSortCardinality=void 0;const bus_rdf_join_entries_sort_1=lib$1G;class ActorRdfJoinEntriesSortCardinality extends bus_rdf_join_entries_sort_1.ActorRdfJoinEntriesSort{constructor(args){super(args)}async test(action){return!0}async run(action){return{entries:[...action.entries].sort((entryLeft,entryRight)=>entryLeft.metadata.cardinality.value-entryRight.metadata.cardinality.value)}}}__name(ActorRdfJoinEntriesSortCardinality,"ActorRdfJoinEntriesSortCardinality");ActorRdfJoinEntriesSortCardinality$1.ActorRdfJoinEntriesSortCardinality=ActorRdfJoinEntriesSortCardinality;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinEntriesSortCardinality$1,exports)})(lib$1H);var lib$1F={},ActorRdfMetadataPrimaryTopic$1={},lib$1E={},ActorRdfMetadata$1={};Object.defineProperty(ActorRdfMetadata$1,"__esModule",{value:!0});ActorRdfMetadata$1.ActorRdfMetadata=void 0;const core_1$d=lib$2A;class ActorRdfMetadata extends core_1$d.Actor{constructor(args){super(args)}}__name(ActorRdfMetadata,"ActorRdfMetadata");ActorRdfMetadata$1.ActorRdfMetadata=ActorRdfMetadata;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadata$1,exports)})(lib$1E);Object.defineProperty(ActorRdfMetadataPrimaryTopic$1,"__esModule",{value:!0});ActorRdfMetadataPrimaryTopic$1.ActorRdfMetadataPrimaryTopic=void 0;const bus_rdf_metadata_1$1=lib$1E,readable_stream_1$a=browserExports$1;class ActorRdfMetadataPrimaryTopic extends bus_rdf_metadata_1$1.ActorRdfMetadata{constructor(args){super(args)}async test(action){if(action.triples)throw new Error("This actor only supports non-triple quad streams.");return!0}async run(action){const data=new readable_stream_1$a.Readable({objectMode:!0}),metadata=new readable_stream_1$a.Readable({objectMode:!0}),attachListeners=__name(()=>{data._read=metadata._read=()=>{},action.quads.on("error",error=>{data.emit("error",error),metadata.emit("error",error)});const graphs={};let endpointIdentifier;const primaryTopics={};action.quads.on("data",quad=>{quad.predicate.value==="http://rdfs.org/ns/void#subset"&&quad.object.value===action.url?endpointIdentifier=quad.subject.value:quad.predicate.value==="http://xmlns.com/foaf/0.1/primaryTopic"&&(primaryTopics[quad.object.value]=quad.subject.value);let quads=graphs[quad.graph.value];quads||(quads=graphs[quad.graph.value]=[]),quads.push(quad)}),action.quads.on("end",()=>{const metadataGraph=endpointIdentifier?primaryTopics[endpointIdentifier]:void 0;for(const graphName in graphs)if(graphName===metadataGraph){for(const quad of graphs[graphName])metadata.push(quad);if(this.metadataToData)for(const quad of graphs[graphName])data.push(quad)}else{for(const quad of graphs[graphName])data.push(quad);if(!metadataGraph&&this.dataToMetadataOnInvalidMetadataGraph)for(const quad of graphs[graphName])metadata.push(quad)}data.push(null),metadata.push(null)})},"attachListeners");return data._read=metadata._read=()=>{attachListeners()},{data,metadata}}}__name(ActorRdfMetadataPrimaryTopic,"ActorRdfMetadataPrimaryTopic");ActorRdfMetadataPrimaryTopic$1.ActorRdfMetadataPrimaryTopic=ActorRdfMetadataPrimaryTopic;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataPrimaryTopic$1,exports)})(lib$1F);var lib$1D={},ActorRdfMetadataAll$1={};Object.defineProperty(ActorRdfMetadataAll$1,"__esModule",{value:!0});ActorRdfMetadataAll$1.ActorRdfMetadataAll=void 0;const bus_rdf_metadata_1=lib$1E,readable_stream_1$9=browserExports$1;class ActorRdfMetadataAll extends bus_rdf_metadata_1.ActorRdfMetadata{constructor(args){super(args)}async test(action){return!0}async run(action){const data=new readable_stream_1$9.Readable({objectMode:!0}),metadata=new readable_stream_1$9.Readable({objectMode:!0});action.quads.on("error",error=>{data.emit("error",error),metadata.emit("error",error)});const attachListeners=__name(()=>{data._read=metadata._read=()=>{},action.quads.on("data",quad=>{data.push(quad),metadata.push(quad)}),action.quads.on("end",()=>{data.push(null),metadata.push(null)})},"attachListeners");return data._read=metadata._read=()=>{attachListeners()},{data,metadata}}}__name(ActorRdfMetadataAll,"ActorRdfMetadataAll");ActorRdfMetadataAll$1.ActorRdfMetadataAll=ActorRdfMetadataAll;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataAll$1,exports)})(lib$1D);var lib$1C={},ActorRdfMetadataAccumulateCanContainUndefs$1={},lib$1B={},ActorRdfMetadataAccumulate$1={};Object.defineProperty(ActorRdfMetadataAccumulate$1,"__esModule",{value:!0});ActorRdfMetadataAccumulate$1.ActorRdfMetadataAccumulate=void 0;const core_1$c=lib$2A;class ActorRdfMetadataAccumulate extends core_1$c.Actor{constructor(args){super(args)}}__name(ActorRdfMetadataAccumulate,"ActorRdfMetadataAccumulate");ActorRdfMetadataAccumulate$1.ActorRdfMetadataAccumulate=ActorRdfMetadataAccumulate;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataAccumulate$1,exports)})(lib$1B);Object.defineProperty(ActorRdfMetadataAccumulateCanContainUndefs$1,"__esModule",{value:!0});ActorRdfMetadataAccumulateCanContainUndefs$1.ActorRdfMetadataAccumulateCanContainUndefs=void 0;const bus_rdf_metadata_accumulate_1$3=lib$1B;class ActorRdfMetadataAccumulateCanContainUndefs extends bus_rdf_metadata_accumulate_1$3.ActorRdfMetadataAccumulate{constructor(args){super(args)}async test(action){return!0}async run(action){if(action.mode==="initialize")return{metadata:{canContainUndefs:!1}};let canContainUndefs=action.accumulatedMetadata.canContainUndefs;return action.appendingMetadata.canContainUndefs&&(canContainUndefs=!0),{metadata:{canContainUndefs}}}}__name(ActorRdfMetadataAccumulateCanContainUndefs,"ActorRdfMetadataAccumulateCanContainUndefs");ActorRdfMetadataAccumulateCanContainUndefs$1.ActorRdfMetadataAccumulateCanContainUndefs=ActorRdfMetadataAccumulateCanContainUndefs;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataAccumulateCanContainUndefs$1,exports)})(lib$1C);var lib$1A={},ActorRdfMetadataAccumulateCardinality$1={};Object.defineProperty(ActorRdfMetadataAccumulateCardinality$1,"__esModule",{value:!0});ActorRdfMetadataAccumulateCardinality$1.ActorRdfMetadataAccumulateCardinality=void 0;const bus_rdf_metadata_accumulate_1$2=lib$1B;class ActorRdfMetadataAccumulateCardinality extends bus_rdf_metadata_accumulate_1$2.ActorRdfMetadataAccumulate{constructor(args){super(args)}async test(action){return!0}async run(action){if(action.mode==="initialize")return{metadata:{cardinality:{type:"exact",value:0}}};const cardinality={...action.accumulatedMetadata.cardinality};if(cardinality.dataset)if(action.appendingMetadata.cardinality.dataset){if(cardinality.dataset!==action.appendingMetadata.cardinality.dataset&&action.appendingMetadata.subsetOf===cardinality.dataset)return{metadata:{cardinality:action.appendingMetadata.cardinality}};if(cardinality.dataset!==action.appendingMetadata.cardinality.dataset)delete cardinality.dataset;else return{metadata:{cardinality}}}else return{metadata:{cardinality}};return!action.appendingMetadata.cardinality||!Number.isFinite(action.appendingMetadata.cardinality.value)?(cardinality.type="estimate",cardinality.value=Number.POSITIVE_INFINITY):(action.appendingMetadata.cardinality.type==="estimate"&&(cardinality.type="estimate"),cardinality.value+=action.appendingMetadata.cardinality.value),{metadata:{cardinality}}}}__name(ActorRdfMetadataAccumulateCardinality,"ActorRdfMetadataAccumulateCardinality");ActorRdfMetadataAccumulateCardinality$1.ActorRdfMetadataAccumulateCardinality=ActorRdfMetadataAccumulateCardinality;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataAccumulateCardinality$1,exports)})(lib$1A);var lib$1z={},ActorRdfMetadataAccumulatePageSize$1={};Object.defineProperty(ActorRdfMetadataAccumulatePageSize$1,"__esModule",{value:!0});ActorRdfMetadataAccumulatePageSize$1.ActorRdfMetadataAccumulatePageSize=void 0;const bus_rdf_metadata_accumulate_1$1=lib$1B;class ActorRdfMetadataAccumulatePageSize extends bus_rdf_metadata_accumulate_1$1.ActorRdfMetadataAccumulate{constructor(args){super(args)}async test(action){return!0}async run(action){return action.mode==="initialize"?{metadata:{}}:{metadata:{..."pageSize"in action.accumulatedMetadata||"pageSize"in action.appendingMetadata?{pageSize:(action.accumulatedMetadata.pageSize||0)+(action.appendingMetadata.pageSize||0)}:{}}}}}__name(ActorRdfMetadataAccumulatePageSize,"ActorRdfMetadataAccumulatePageSize");ActorRdfMetadataAccumulatePageSize$1.ActorRdfMetadataAccumulatePageSize=ActorRdfMetadataAccumulatePageSize;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataAccumulatePageSize$1,exports)})(lib$1z);var lib$1y={},ActorRdfMetadataAccumulateRequestTime$1={};Object.defineProperty(ActorRdfMetadataAccumulateRequestTime$1,"__esModule",{value:!0});ActorRdfMetadataAccumulateRequestTime$1.ActorRdfMetadataAccumulateRequestTime=void 0;const bus_rdf_metadata_accumulate_1=lib$1B;class ActorRdfMetadataAccumulateRequestTime extends bus_rdf_metadata_accumulate_1.ActorRdfMetadataAccumulate{constructor(args){super(args)}async test(action){return!0}async run(action){return action.mode==="initialize"?{metadata:{}}:{metadata:{..."requestTime"in action.accumulatedMetadata||"requestTime"in action.appendingMetadata?{requestTime:(action.accumulatedMetadata.requestTime||0)+(action.appendingMetadata.requestTime||0)}:{}}}}}__name(ActorRdfMetadataAccumulateRequestTime,"ActorRdfMetadataAccumulateRequestTime");ActorRdfMetadataAccumulateRequestTime$1.ActorRdfMetadataAccumulateRequestTime=ActorRdfMetadataAccumulateRequestTime;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataAccumulateRequestTime$1,exports)})(lib$1y);var lib$1x={},ActorRdfMetadataExtractHydraControls$1={},lib$1w={},ActorRdfMetadataExtract$1={};Object.defineProperty(ActorRdfMetadataExtract$1,"__esModule",{value:!0});ActorRdfMetadataExtract$1.ActorRdfMetadataExtract=void 0;const core_1$b=lib$2A;class ActorRdfMetadataExtract extends core_1$b.Actor{constructor(args){super(args)}}__name(ActorRdfMetadataExtract,"ActorRdfMetadataExtract");ActorRdfMetadataExtract$1.ActorRdfMetadataExtract=ActorRdfMetadataExtract;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtract$1,exports)})(lib$1w);var uritemplate={exports:{}};(function(module){(function(exportCallback){var UriTemplateError=function(){function UriTemplateError2(options){this.options=options}return __name(UriTemplateError2,"UriTemplateError"),UriTemplateError2.prototype.toString=function(){return JSON&&JSON.stringify?JSON.stringify(this.options):this.options},UriTemplateError2}(),objectHelper=function(){function isArray(value){return Object.prototype.toString.apply(value)==="[object Array]"}__name(isArray,"isArray");function isString2(value){return Object.prototype.toString.apply(value)==="[object String]"}__name(isString2,"isString");function isNumber(value){return Object.prototype.toString.apply(value)==="[object Number]"}__name(isNumber,"isNumber");function isBoolean(value){return Object.prototype.toString.apply(value)==="[object Boolean]"}__name(isBoolean,"isBoolean");function join3(arr,separator){var result="",first3=!0,index;for(index=0;index<arr.length;index+=1)first3?first3=!1:result+=separator,result+=arr[index];return result}__name(join3,"join");function map2(arr,mapper){for(var result=[],index=0;index<arr.length;index+=1)result.push(mapper(arr[index]));return result}__name(map2,"map");function filter4(arr,predicate2){for(var result=[],index=0;index<arr.length;index+=1)predicate2(arr[index])&&result.push(arr[index]);return result}__name(filter4,"filter");function deepFreezeUsingObjectFreeze(object2){if(typeof object2!="object"||object2===null)return object2;Object.freeze(object2);var property,propertyName;for(propertyName in object2)object2.hasOwnProperty(propertyName)&&(property=object2[propertyName],typeof property=="object"&&deepFreeze(property));return object2}__name(deepFreezeUsingObjectFreeze,"deepFreezeUsingObjectFreeze");function deepFreeze(object2){return typeof Object.freeze=="function"?deepFreezeUsingObjectFreeze(object2):object2}return __name(deepFreeze,"deepFreeze"),{isArray,isString:isString2,isNumber,isBoolean,join:join3,map:map2,filter:filter4,deepFreeze}}(),charHelper=function(){function isAlpha(chr){return chr>="a"&&chr<="z"||chr>="A"&&chr<="Z"}__name(isAlpha,"isAlpha");function isDigit(chr){return chr>="0"&&chr<="9"}__name(isDigit,"isDigit");function isHexDigit(chr){return isDigit(chr)||chr>="a"&&chr<="f"||chr>="A"&&chr<="F"}return __name(isHexDigit,"isHexDigit"),{isAlpha,isDigit,isHexDigit}}(),pctEncoder=function(){var utf8={encode:function(chr){return unescape(encodeURIComponent(chr))},numBytes:function(firstCharCode){return firstCharCode<=127?1:194<=firstCharCode&&firstCharCode<=223?2:224<=firstCharCode&&firstCharCode<=239?3:240<=firstCharCode&&firstCharCode<=244?4:0},isValidFollowingCharCode:function(charCode){return 128<=charCode&&charCode<=191}};function encodeCharacter(chr){var result="",octets=utf8.encode(chr),octet,index;for(index=0;index<octets.length;index+=1)octet=octets.charCodeAt(index),result+="%"+(octet<16?"0":"")+octet.toString(16).toUpperCase();return result}__name(encodeCharacter,"encodeCharacter");function isPercentDigitDigit(text,start){return text.charAt(start)==="%"&&charHelper.isHexDigit(text.charAt(start+1))&&charHelper.isHexDigit(text.charAt(start+2))}__name(isPercentDigitDigit,"isPercentDigitDigit");function parseHex2(text,start){return parseInt(text.substr(start,2),16)}__name(parseHex2,"parseHex2");function isPctEncoded(chr){if(!isPercentDigitDigit(chr,0))return!1;var firstCharCode=parseHex2(chr,1),numBytes=utf8.numBytes(firstCharCode);if(numBytes===0)return!1;for(var byteNumber=1;byteNumber<numBytes;byteNumber+=1)if(!isPercentDigitDigit(chr,3*byteNumber)||!utf8.isValidFollowingCharCode(parseHex2(chr,3*byteNumber+1)))return!1;return!0}__name(isPctEncoded,"isPctEncoded");function pctCharAt(text,startIndex){var chr=text.charAt(startIndex);if(!isPercentDigitDigit(text,startIndex))return chr;var utf8CharCode=parseHex2(text,startIndex+1),numBytes=utf8.numBytes(utf8CharCode);if(numBytes===0)return chr;for(var byteNumber=1;byteNumber<numBytes;byteNumber+=1)if(!isPercentDigitDigit(text,startIndex+3*byteNumber)||!utf8.isValidFollowingCharCode(parseHex2(text,startIndex+3*byteNumber+1)))return chr;return text.substr(startIndex,3*numBytes)}return __name(pctCharAt,"pctCharAt"),{encodeCharacter,isPctEncoded,pctCharAt}}(),rfcCharHelper=function(){function isVarchar(chr){return charHelper.isAlpha(chr)||charHelper.isDigit(chr)||chr==="_"||pctEncoder.isPctEncoded(chr)}__name(isVarchar,"isVarchar");function isUnreserved(chr){return charHelper.isAlpha(chr)||charHelper.isDigit(chr)||chr==="-"||chr==="."||chr==="_"||chr==="~"}__name(isUnreserved,"isUnreserved");function isReserved(chr){return chr===":"||chr==="/"||chr==="?"||chr==="#"||chr==="["||chr==="]"||chr==="@"||chr==="!"||chr==="$"||chr==="&"||chr==="("||chr===")"||chr==="*"||chr==="+"||chr===","||chr===";"||chr==="="||chr==="'"}return __name(isReserved,"isReserved"),{isVarchar,isUnreserved,isReserved}}(),encodingHelper=function(){function encode2(text,passReserved){var result="",index,chr="";for((typeof text=="number"||typeof text=="boolean")&&(text=text.toString()),index=0;index<text.length;index+=chr.length)chr=text.charAt(index),result+=rfcCharHelper.isUnreserved(chr)||passReserved&&rfcCharHelper.isReserved(chr)?chr:pctEncoder.encodeCharacter(chr);return result}__name(encode2,"encode");function encodePassReserved(text){return encode2(text,!0)}__name(encodePassReserved,"encodePassReserved");function encodeLiteralCharacter(literal,index){var chr=pctEncoder.pctCharAt(literal,index);return chr.length>1||rfcCharHelper.isReserved(chr)||rfcCharHelper.isUnreserved(chr)?chr:pctEncoder.encodeCharacter(chr)}__name(encodeLiteralCharacter,"encodeLiteralCharacter");function encodeLiteral(literal){var result="",index,chr="";for(index=0;index<literal.length;index+=chr.length)chr=pctEncoder.pctCharAt(literal,index),chr.length>1?result+=chr:result+=rfcCharHelper.isReserved(chr)||rfcCharHelper.isUnreserved(chr)?chr:pctEncoder.encodeCharacter(chr);return result}return __name(encodeLiteral,"encodeLiteral"),{encode:encode2,encodePassReserved,encodeLiteral,encodeLiteralCharacter}}(),operators=function(){var bySymbol={};function create(symbol){bySymbol[symbol]={symbol,separator:symbol==="?"?"&":symbol===""||symbol==="+"||symbol==="#"?",":symbol,named:symbol===";"||symbol==="&"||symbol==="?",ifEmpty:symbol==="&"||symbol==="?"?"=":"",first:symbol==="+"?"":symbol,encode:symbol==="+"||symbol==="#"?encodingHelper.encodePassReserved:encodingHelper.encode,toString:function(){return this.symbol}}}return __name(create,"create"),create(""),create("+"),create("#"),create("."),create("/"),create(";"),create("?"),create("&"),{valueOf:function(chr){return bySymbol[chr]?bySymbol[chr]:"=,!@|".indexOf(chr)>=0?null:bySymbol[""]}}}();function isDefined(object2){var propertyName;if(object2==null)return!1;if(objectHelper.isArray(object2))return object2.length>0;if(typeof object2=="string"||typeof object2=="number"||typeof object2=="boolean")return!0;for(propertyName in object2)if(object2.hasOwnProperty(propertyName)&&isDefined(object2[propertyName]))return!0;return!1}__name(isDefined,"isDefined");var LiteralExpression=function(){function LiteralExpression2(literal){this.literal=encodingHelper.encodeLiteral(literal)}return __name(LiteralExpression2,"LiteralExpression"),LiteralExpression2.prototype.expand=function(){return this.literal},LiteralExpression2.prototype.toString=LiteralExpression2.prototype.expand,LiteralExpression2}(),parse3=function(){function parseExpression(expressionText){var operator,varspecs=[],varspec=null,varnameStart=null,maxLengthStart=null,index,chr="";function closeVarname(){var varname=expressionText.substring(varnameStart,index);if(varname.length===0)throw new UriTemplateError({expressionText,message:"a varname must be specified",position:index});varspec={varname,exploded:!1,maxLength:null},varnameStart=null}__name(closeVarname,"closeVarname");function closeMaxLength(){if(maxLengthStart===index)throw new UriTemplateError({expressionText,message:"after a ':' you have to specify the length",position:index});varspec.maxLength=parseInt(expressionText.substring(maxLengthStart,index),10),maxLengthStart=null}for(__name(closeMaxLength,"closeMaxLength"),operator=function(operatorText){var op=operators.valueOf(operatorText);if(op===null)throw new UriTemplateError({expressionText,message:"illegal use of reserved operator",position:index,operator:operatorText});return op}(expressionText.charAt(0)),index=operator.symbol.length,varnameStart=index;index<expressionText.length;index+=chr.length){if(chr=pctEncoder.pctCharAt(expressionText,index),varnameStart!==null){if(chr==="."){if(varnameStart===index)throw new UriTemplateError({expressionText,message:"a varname MUST NOT start with a dot",position:index});continue}if(rfcCharHelper.isVarchar(chr))continue;closeVarname()}if(maxLengthStart!==null){if(index===maxLengthStart&&chr==="0")throw new UriTemplateError({expressionText,message:"A :prefix must not start with digit 0",position:index});if(charHelper.isDigit(chr)){if(index-maxLengthStart>=4)throw new UriTemplateError({expressionText,message:"A :prefix must have max 4 digits",position:index});continue}closeMaxLength()}if(chr===":"){if(varspec.maxLength!==null)throw new UriTemplateError({expressionText,message:"only one :maxLength is allowed per varspec",position:index});if(varspec.exploded)throw new UriTemplateError({expressionText,message:"an exploeded varspec MUST NOT be varspeced",position:index});maxLengthStart=index+1;continue}if(chr==="*"){if(varspec===null)throw new UriTemplateError({expressionText,message:"exploded without varspec",position:index});if(varspec.exploded)throw new UriTemplateError({expressionText,message:"exploded twice",position:index});if(varspec.maxLength)throw new UriTemplateError({expressionText,message:"an explode (*) MUST NOT follow to a prefix",position:index});varspec.exploded=!0;continue}if(chr===","){varspecs.push(varspec),varspec=null,varnameStart=index+1;continue}throw new UriTemplateError({expressionText,message:"illegal character",character:chr,position:index})}return varnameStart!==null&&closeVarname(),maxLengthStart!==null&&closeMaxLength(),varspecs.push(varspec),new VariableExpression(expressionText,operator,varspecs)}__name(parseExpression,"parseExpression");function parse4(uriTemplateText){var index,chr,expressions2=[],braceOpenIndex=null,literalStart=0;for(index=0;index<uriTemplateText.length;index+=1){if(chr=uriTemplateText.charAt(index),literalStart!==null){if(chr==="}")throw new UriTemplateError({templateText:uriTemplateText,message:"unopened brace closed",position:index});chr==="{"&&(literalStart<index&&expressions2.push(new LiteralExpression(uriTemplateText.substring(literalStart,index))),literalStart=null,braceOpenIndex=index);continue}if(braceOpenIndex!==null){if(chr==="{")throw new UriTemplateError({templateText:uriTemplateText,message:"brace already opened",position:index});if(chr==="}"){if(braceOpenIndex+1===index)throw new UriTemplateError({templateText:uriTemplateText,message:"empty braces",position:braceOpenIndex});try{expressions2.push(parseExpression(uriTemplateText.substring(braceOpenIndex+1,index)))}catch(error){throw error.prototype===UriTemplateError.prototype?new UriTemplateError({templateText:uriTemplateText,message:error.options.message,position:braceOpenIndex+error.options.position,details:error.options}):error}braceOpenIndex=null,literalStart=index+1}continue}throw new Error("reached unreachable code")}if(braceOpenIndex!==null)throw new UriTemplateError({templateText:uriTemplateText,message:"unclosed brace",position:braceOpenIndex});return literalStart<uriTemplateText.length&&expressions2.push(new LiteralExpression(uriTemplateText.substr(literalStart))),new UriTemplate(uriTemplateText,expressions2)}return __name(parse4,"parse"),parse4}(),VariableExpression=function(){function prettyPrint(value){return JSON&&JSON.stringify?JSON.stringify(value):value}__name(prettyPrint,"prettyPrint");function isEmpty2(value){if(!isDefined(value))return!0;if(objectHelper.isString(value))return value==="";if(objectHelper.isNumber(value)||objectHelper.isBoolean(value))return!1;if(objectHelper.isArray(value))return value.length===0;for(var propertyName in value)if(value.hasOwnProperty(propertyName))return!1;return!0}__name(isEmpty2,"isEmpty");function propertyArray(object2){var result=[],propertyName;for(propertyName in object2)object2.hasOwnProperty(propertyName)&&result.push({name:propertyName,value:object2[propertyName]});return result}__name(propertyArray,"propertyArray");function VariableExpression2(templateText,operator,varspecs){this.templateText=templateText,this.operator=operator,this.varspecs=varspecs}__name(VariableExpression2,"VariableExpression"),VariableExpression2.prototype.toString=function(){return this.templateText};function expandSimpleValue(varspec,operator,value){var result="";if(value=value.toString(),operator.named){if(result+=encodingHelper.encodeLiteral(varspec.varname),value==="")return result+=operator.ifEmpty,result;result+="="}return varspec.maxLength!==null&&(value=value.substr(0,varspec.maxLength)),result+=operator.encode(value),result}__name(expandSimpleValue,"expandSimpleValue");function valueDefined(nameValue){return isDefined(nameValue.value)}__name(valueDefined,"valueDefined");function expandNotExploded(varspec,operator,value){var arr=[],result="";if(operator.named){if(result+=encodingHelper.encodeLiteral(varspec.varname),isEmpty2(value))return result+=operator.ifEmpty,result;result+="="}return objectHelper.isArray(value)?(arr=value,arr=objectHelper.filter(arr,isDefined),arr=objectHelper.map(arr,operator.encode),result+=objectHelper.join(arr,",")):(arr=propertyArray(value),arr=objectHelper.filter(arr,valueDefined),arr=objectHelper.map(arr,function(nameValue){return operator.encode(nameValue.name)+","+operator.encode(nameValue.value)}),result+=objectHelper.join(arr,",")),result}__name(expandNotExploded,"expandNotExploded");function expandExplodedNamed(varspec,operator,value){var isArray=objectHelper.isArray(value),arr=[];return isArray?(arr=value,arr=objectHelper.filter(arr,isDefined),arr=objectHelper.map(arr,function(listElement){var tmp=encodingHelper.encodeLiteral(varspec.varname);return isEmpty2(listElement)?tmp+=operator.ifEmpty:tmp+="="+operator.encode(listElement),tmp})):(arr=propertyArray(value),arr=objectHelper.filter(arr,valueDefined),arr=objectHelper.map(arr,function(nameValue){var tmp=encodingHelper.encodeLiteral(nameValue.name);return isEmpty2(nameValue.value)?tmp+=operator.ifEmpty:tmp+="="+operator.encode(nameValue.value),tmp})),objectHelper.join(arr,operator.separator)}__name(expandExplodedNamed,"expandExplodedNamed");function expandExplodedUnnamed(operator,value){var arr=[],result="";return objectHelper.isArray(value)?(arr=value,arr=objectHelper.filter(arr,isDefined),arr=objectHelper.map(arr,operator.encode),result+=objectHelper.join(arr,operator.separator)):(arr=propertyArray(value),arr=objectHelper.filter(arr,function(nameValue){return isDefined(nameValue.value)}),arr=objectHelper.map(arr,function(nameValue){return operator.encode(nameValue.name)+"="+operator.encode(nameValue.value)}),result+=objectHelper.join(arr,operator.separator)),result}return __name(expandExplodedUnnamed,"expandExplodedUnnamed"),VariableExpression2.prototype.expand=function(variables2){var expanded=[],index,varspec,value,operator=this.operator;for(index=0;index<this.varspecs.length;index+=1)if(varspec=this.varspecs[index],value=variables2[varspec.varname],value!=null)if(varspec.exploded,objectHelper.isArray(value),typeof value=="string"||typeof value=="number"||typeof value=="boolean")expanded.push(expandSimpleValue(varspec,operator,value));else{if(varspec.maxLength&&isDefined(value))throw new Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+prettyPrint(value));varspec.exploded?isDefined(value)&&(operator.named?expanded.push(expandExplodedNamed(varspec,operator,value)):expanded.push(expandExplodedUnnamed(operator,value))):(operator.named||!isEmpty2(value))&&expanded.push(expandNotExploded(varspec,operator,value))}return expanded.length===0?"":operator.first+objectHelper.join(expanded,operator.separator)},VariableExpression2}(),UriTemplate=function(){function UriTemplate2(templateText,expressions2){this.templateText=templateText,this.expressions=expressions2,objectHelper.deepFreeze(this)}return __name(UriTemplate2,"UriTemplate"),UriTemplate2.prototype.toString=function(){return this.templateText},UriTemplate2.prototype.expand=function(variables2){var index,result="";for(index=0;index<this.expressions.length;index+=1)result+=this.expressions[index].expand(variables2);return result},UriTemplate2.parse=parse3,UriTemplate2.UriTemplateError=UriTemplateError,UriTemplate2}();exportCallback(UriTemplate)})(function(UriTemplate){module.exports=UriTemplate})})(uritemplate);var uritemplateExports=uritemplate.exports;Object.defineProperty(ActorRdfMetadataExtractHydraControls$1,"__esModule",{value:!0});ActorRdfMetadataExtractHydraControls$1.ActorRdfMetadataExtractHydraControls=void 0;const bus_rdf_metadata_extract_1$7=lib$1w,uritemplate_1=uritemplateExports;class ActorRdfMetadataExtractHydraControls extends bus_rdf_metadata_extract_1$7.ActorRdfMetadataExtract{constructor(args){super(args),this.parsedUriTemplateCache={}}async test(action){return!0}getLinks(pageUrl,hydraProperties){return Object.fromEntries(ActorRdfMetadataExtractHydraControls.LINK_TYPES.map(link2=>{const links=hydraProperties[link2]||hydraProperties[`${link2}Page`],linkTargets=links&&links[pageUrl];return[link2,linkTargets&&linkTargets.length>0?linkTargets[0]:null]}))}parseUriTemplateCached(template){const cachedUriTemplate=this.parsedUriTemplateCache[template];return cachedUriTemplate||(this.parsedUriTemplateCache[template]=(0,uritemplate_1.parse)(template))}getSearchForms(hydraProperties){const searchFormData=hydraProperties.search,searchForms=[];if(searchFormData)for(const dataset in searchFormData)for(const searchFormId of searchFormData[dataset]){const searchTemplates=(hydraProperties.template||{})[searchFormId]||[];if(searchTemplates.length!==1)throw new Error(`Expected 1 hydra:template for ${searchFormId}`);const template=searchTemplates[0],searchTemplate=this.parseUriTemplateCached(template),mappings=Object.fromEntries(((hydraProperties.mapping||{})[searchFormId]||[]).map(mapping=>{const variable=((hydraProperties.variable||{})[mapping]||[])[0],property=((hydraProperties.property||{})[mapping]||[])[0];if(!variable)throw new Error(`Expected a hydra:variable for ${mapping}`);if(!property)throw new Error(`Expected a hydra:property for ${mapping}`);return[property,variable]})),getUri=__name(entries3=>searchTemplate.expand(Object.fromEntries(Object.keys(entries3).map(key=>[mappings[key],entries3[key]]))),"getUri");searchForms.push({dataset,template,mappings,getUri})}return{values:searchForms}}getHydraProperties(metadata){return new Promise((resolve2,reject)=>{metadata.on("error",reject);const hydraProperties={};metadata.on("data",quad=>{if(quad.predicate.value.startsWith(ActorRdfMetadataExtractHydraControls.HYDRA)){const property=quad.predicate.value.slice(ActorRdfMetadataExtractHydraControls.HYDRA.length),subjectProperties=hydraProperties[property]||(hydraProperties[property]={});(subjectProperties[quad.subject.value]||(subjectProperties[quad.subject.value]=[])).push(quad.object.value)}}),metadata.on("end",()=>resolve2(hydraProperties))})}async run(action){const metadata={},hydraProperties=await this.getHydraProperties(action.metadata);return Object.assign(metadata,this.getLinks(action.url,hydraProperties)),metadata.searchForms=this.getSearchForms(hydraProperties),{metadata}}}__name(ActorRdfMetadataExtractHydraControls,"ActorRdfMetadataExtractHydraControls");ActorRdfMetadataExtractHydraControls$1.ActorRdfMetadataExtractHydraControls=ActorRdfMetadataExtractHydraControls;ActorRdfMetadataExtractHydraControls.HYDRA="http://www.w3.org/ns/hydra/core#";ActorRdfMetadataExtractHydraControls.LINK_TYPES=["first","next","previous","last"];(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractHydraControls$1,exports)})(lib$1x);var lib$1v={},ActorRdfMetadataExtractHydraCount$1={};Object.defineProperty(ActorRdfMetadataExtractHydraCount$1,"__esModule",{value:!0});ActorRdfMetadataExtractHydraCount$1.ActorRdfMetadataExtractHydraCount=void 0;const bus_rdf_metadata_extract_1$6=lib$1w;class ActorRdfMetadataExtractHydraCount extends bus_rdf_metadata_extract_1$6.ActorRdfMetadataExtract{constructor(args){super(args)}async test(action){return!0}run(action){return new Promise((resolve2,reject)=>{action.metadata.on("error",reject),action.metadata.on("data",quad=>{this.predicates.includes(quad.predicate.value)&&resolve2({metadata:{cardinality:{type:"estimate",value:Number.parseInt(quad.object.value,10),dataset:quad.subject.value}}})}),action.metadata.on("end",()=>{resolve2({metadata:{cardinality:{type:"estimate",value:0}}})})})}}__name(ActorRdfMetadataExtractHydraCount,"ActorRdfMetadataExtractHydraCount");ActorRdfMetadataExtractHydraCount$1.ActorRdfMetadataExtractHydraCount=ActorRdfMetadataExtractHydraCount;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractHydraCount$1,exports)})(lib$1v);var lib$1u={},ActorRdfMetadataExtractHydraPagesize$1={};Object.defineProperty(ActorRdfMetadataExtractHydraPagesize$1,"__esModule",{value:!0});ActorRdfMetadataExtractHydraPagesize$1.ActorRdfMetadataExtractHydraPagesize=void 0;const bus_rdf_metadata_extract_1$5=lib$1w;class ActorRdfMetadataExtractHydraPagesize extends bus_rdf_metadata_extract_1$5.ActorRdfMetadataExtract{constructor(args){super(args)}async test(action){return!0}async run(action){return new Promise((resolve2,reject)=>{action.metadata.on("error",reject),action.metadata.on("data",quad=>{this.predicates.includes(quad.predicate.value)&&resolve2({metadata:{pageSize:Number.parseInt(quad.object.value,10)}})}),action.metadata.on("end",()=>{resolve2({metadata:{}})})})}}__name(ActorRdfMetadataExtractHydraPagesize,"ActorRdfMetadataExtractHydraPagesize");ActorRdfMetadataExtractHydraPagesize$1.ActorRdfMetadataExtractHydraPagesize=ActorRdfMetadataExtractHydraPagesize;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractHydraPagesize$1,exports)})(lib$1u);var lib$1t={},ActorRdfMetadataExtractRequestTime$1={};Object.defineProperty(ActorRdfMetadataExtractRequestTime$1,"__esModule",{value:!0});ActorRdfMetadataExtractRequestTime$1.ActorRdfMetadataExtractRequestTime=void 0;const bus_rdf_metadata_extract_1$4=lib$1w;class ActorRdfMetadataExtractRequestTime extends bus_rdf_metadata_extract_1$4.ActorRdfMetadataExtract{constructor(args){super(args)}async test(action){return!0}async run(action){return{metadata:{requestTime:action.requestTime}}}}__name(ActorRdfMetadataExtractRequestTime,"ActorRdfMetadataExtractRequestTime");ActorRdfMetadataExtractRequestTime$1.ActorRdfMetadataExtractRequestTime=ActorRdfMetadataExtractRequestTime;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractRequestTime$1,exports)})(lib$1t);var lib$1s={},ActorRdfMetadataExtractAllowHttpMethods$1={};Object.defineProperty(ActorRdfMetadataExtractAllowHttpMethods$1,"__esModule",{value:!0});ActorRdfMetadataExtractAllowHttpMethods$1.ActorRdfMetadataExtractAllowHttpMethods=void 0;const bus_rdf_metadata_extract_1$3=lib$1w;class ActorRdfMetadataExtractAllowHttpMethods extends bus_rdf_metadata_extract_1$3.ActorRdfMetadataExtract{constructor(args){super(args)}async test(action){return!0}async run(action){var _a2,_b;const metadata={};return(_a2=action.headers)!=null&&_a2.get("allow")&&(metadata.allowHttpMethods=(_b=action.headers.get("allow"))==null?void 0:_b.split(/, */u)),{metadata}}}__name(ActorRdfMetadataExtractAllowHttpMethods,"ActorRdfMetadataExtractAllowHttpMethods");ActorRdfMetadataExtractAllowHttpMethods$1.ActorRdfMetadataExtractAllowHttpMethods=ActorRdfMetadataExtractAllowHttpMethods;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractAllowHttpMethods$1,exports)})(lib$1s);var lib$1r={},ActorRdfMetadataExtractPutAccepted$1={};Object.defineProperty(ActorRdfMetadataExtractPutAccepted$1,"__esModule",{value:!0});ActorRdfMetadataExtractPutAccepted$1.ActorRdfMetadataExtractPutAccepted=void 0;const bus_rdf_metadata_extract_1$2=lib$1w;class ActorRdfMetadataExtractPutAccepted extends bus_rdf_metadata_extract_1$2.ActorRdfMetadataExtract{constructor(args){super(args)}async test(action){return!0}async run(action){var _a2,_b;const metadata={};return(_a2=action.headers)!=null&&_a2.get("accept-put")&&(metadata.putAccepted=(_b=action.headers.get("accept-put"))==null?void 0:_b.split(/, */u)),{metadata}}}__name(ActorRdfMetadataExtractPutAccepted,"ActorRdfMetadataExtractPutAccepted");ActorRdfMetadataExtractPutAccepted$1.ActorRdfMetadataExtractPutAccepted=ActorRdfMetadataExtractPutAccepted;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractPutAccepted$1,exports)})(lib$1r);var lib$1q={},ActorRdfMetadataExtractPatchSparqlUpdate$1={};Object.defineProperty(ActorRdfMetadataExtractPatchSparqlUpdate$1,"__esModule",{value:!0});ActorRdfMetadataExtractPatchSparqlUpdate$1.ActorRdfMetadataExtractPatchSparqlUpdate=void 0;const bus_rdf_metadata_extract_1$1=lib$1w;class ActorRdfMetadataExtractPatchSparqlUpdate extends bus_rdf_metadata_extract_1$1.ActorRdfMetadataExtract{constructor(args){super(args)}async test(action){return!0}async run(action){var _a2,_b,_c,_d;const metadata={};return((_b=(_a2=action.headers)==null?void 0:_a2.get("accept-patch"))!=null&&_b.includes("application/sparql-update")||(_d=(_c=action.headers)==null?void 0:_c.get("ms-author-via"))!=null&&_d.includes("SPARQL"))&&(metadata.patchSparqlUpdate=!0),{metadata}}}__name(ActorRdfMetadataExtractPatchSparqlUpdate,"ActorRdfMetadataExtractPatchSparqlUpdate");ActorRdfMetadataExtractPatchSparqlUpdate$1.ActorRdfMetadataExtractPatchSparqlUpdate=ActorRdfMetadataExtractPatchSparqlUpdate;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractPatchSparqlUpdate$1,exports)})(lib$1q);var lib$1p={},ActorRdfMetadataExtractSparqlService$1={};Object.defineProperty(ActorRdfMetadataExtractSparqlService$1,"__esModule",{value:!0});ActorRdfMetadataExtractSparqlService$1.ActorRdfMetadataExtractSparqlService=void 0;const bus_rdf_metadata_extract_1=lib$1w,relative_to_absolute_iri_1$5=relativeToAbsoluteIri;class ActorRdfMetadataExtractSparqlService extends bus_rdf_metadata_extract_1.ActorRdfMetadataExtract{constructor(args){super(args)}async test(action){return!0}async run(action){return new Promise((resolve2,reject)=>{action.metadata.on("error",reject);const metadata={};action.metadata.on("data",quad=>{quad.predicate.value==="http://www.w3.org/ns/sparql-service-description#endpoint"&&(quad.subject.termType==="BlankNode"||quad.subject.value===action.url)?(metadata.sparqlService=quad.object.termType==="Literal"?(0,relative_to_absolute_iri_1$5.resolve)(quad.object.value,action.url):quad.object.value,this.inferHttpsEndpoint&&action.url.startsWith("https")&&!metadata.sparqlService.startsWith("https")&&(metadata.sparqlService=metadata.sparqlService.replace("http:","https:"))):quad.predicate.value==="http://www.w3.org/ns/sparql-service-description#defaultGraph"&&(metadata.defaultGraph=quad.object.value)}),action.metadata.on("end",()=>{resolve2({metadata})})})}}__name(ActorRdfMetadataExtractSparqlService,"ActorRdfMetadataExtractSparqlService");ActorRdfMetadataExtractSparqlService$1.ActorRdfMetadataExtractSparqlService=ActorRdfMetadataExtractSparqlService;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfMetadataExtractSparqlService$1,exports)})(lib$1p);var lib$1o={},ActorRdfParseHtml$3={},lib$1n={},Parser$3={},Tokenizer$1={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.QuoteType=void 0;var decode_js_12=decode,CharCodes;(function(CharCodes2){CharCodes2[CharCodes2.Tab=9]="Tab",CharCodes2[CharCodes2.NewLine=10]="NewLine",CharCodes2[CharCodes2.FormFeed=12]="FormFeed",CharCodes2[CharCodes2.CarriageReturn=13]="CarriageReturn",CharCodes2[CharCodes2.Space=32]="Space",CharCodes2[CharCodes2.ExclamationMark=33]="ExclamationMark",CharCodes2[CharCodes2.Number=35]="Number",CharCodes2[CharCodes2.Amp=38]="Amp",CharCodes2[CharCodes2.SingleQuote=39]="SingleQuote",CharCodes2[CharCodes2.DoubleQuote=34]="DoubleQuote",CharCodes2[CharCodes2.Dash=45]="Dash",CharCodes2[CharCodes2.Slash=47]="Slash",CharCodes2[CharCodes2.Zero=48]="Zero",CharCodes2[CharCodes2.Nine=57]="Nine",CharCodes2[CharCodes2.Semi=59]="Semi",CharCodes2[CharCodes2.Lt=60]="Lt",CharCodes2[CharCodes2.Eq=61]="Eq",CharCodes2[CharCodes2.Gt=62]="Gt",CharCodes2[CharCodes2.Questionmark=63]="Questionmark",CharCodes2[CharCodes2.UpperA=65]="UpperA",CharCodes2[CharCodes2.LowerA=97]="LowerA",CharCodes2[CharCodes2.UpperF=70]="UpperF",CharCodes2[CharCodes2.LowerF=102]="LowerF",CharCodes2[CharCodes2.UpperZ=90]="UpperZ",CharCodes2[CharCodes2.LowerZ=122]="LowerZ",CharCodes2[CharCodes2.LowerX=120]="LowerX",CharCodes2[CharCodes2.OpeningSquareBracket=91]="OpeningSquareBracket"})(CharCodes||(CharCodes={}));var State;(function(State2){State2[State2.Text=1]="Text",State2[State2.BeforeTagName=2]="BeforeTagName",State2[State2.InTagName=3]="InTagName",State2[State2.InSelfClosingTag=4]="InSelfClosingTag",State2[State2.BeforeClosingTagName=5]="BeforeClosingTagName",State2[State2.InClosingTagName=6]="InClosingTagName",State2[State2.AfterClosingTagName=7]="AfterClosingTagName",State2[State2.BeforeAttributeName=8]="BeforeAttributeName",State2[State2.InAttributeName=9]="InAttributeName",State2[State2.AfterAttributeName=10]="AfterAttributeName",State2[State2.BeforeAttributeValue=11]="BeforeAttributeValue",State2[State2.InAttributeValueDq=12]="InAttributeValueDq",State2[State2.InAttributeValueSq=13]="InAttributeValueSq",State2[State2.InAttributeValueNq=14]="InAttributeValueNq",State2[State2.BeforeDeclaration=15]="BeforeDeclaration",State2[State2.InDeclaration=16]="InDeclaration",State2[State2.InProcessingInstruction=17]="InProcessingInstruction",State2[State2.BeforeComment=18]="BeforeComment",State2[State2.CDATASequence=19]="CDATASequence",State2[State2.InSpecialComment=20]="InSpecialComment",State2[State2.InCommentLike=21]="InCommentLike",State2[State2.BeforeSpecialS=22]="BeforeSpecialS",State2[State2.SpecialStartSequence=23]="SpecialStartSequence",State2[State2.InSpecialTag=24]="InSpecialTag",State2[State2.InEntity=25]="InEntity"})(State||(State={}));function isWhitespace(c){return c===CharCodes.Space||c===CharCodes.NewLine||c===CharCodes.Tab||c===CharCodes.FormFeed||c===CharCodes.CarriageReturn}__name(isWhitespace,"isWhitespace");function isEndOfTagSection(c){return c===CharCodes.Slash||c===CharCodes.Gt||isWhitespace(c)}__name(isEndOfTagSection,"isEndOfTagSection");function isASCIIAlpha(c){return c>=CharCodes.LowerA&&c<=CharCodes.LowerZ||c>=CharCodes.UpperA&&c<=CharCodes.UpperZ}__name(isASCIIAlpha,"isASCIIAlpha");var QuoteType;(function(QuoteType2){QuoteType2[QuoteType2.NoValue=0]="NoValue",QuoteType2[QuoteType2.Unquoted=1]="Unquoted",QuoteType2[QuoteType2.Single=2]="Single",QuoteType2[QuoteType2.Double=3]="Double"})(QuoteType=exports.QuoteType||(exports.QuoteType={}));var Sequences={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},Tokenizer2=function(){function Tokenizer3(_a2,cbs){var _b=_a2.xmlMode,xmlMode=_b===void 0?!1:_b,_c=_a2.decodeEntities,decodeEntities=_c===void 0?!0:_c,_this=this;this.cbs=cbs,this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=State.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=xmlMode,this.decodeEntities=decodeEntities,this.entityDecoder=new decode_js_12.EntityDecoder(xmlMode?decode_js_12.xmlDecodeTree:decode_js_12.htmlDecodeTree,function(cp,consumed){return _this.emitCodePoint(cp,consumed)})}return __name(Tokenizer3,"Tokenizer"),Tokenizer3.prototype.reset=function(){this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},Tokenizer3.prototype.write=function(chunk){this.offset+=this.buffer.length,this.buffer=chunk,this.parse()},Tokenizer3.prototype.end=function(){this.running&&this.finish()},Tokenizer3.prototype.pause=function(){this.running=!1},Tokenizer3.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},Tokenizer3.prototype.stateText=function(c){c===CharCodes.Lt||!this.decodeEntities&&this.fastForwardTo(CharCodes.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=State.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&c===CharCodes.Amp&&this.startEntity()},Tokenizer3.prototype.stateSpecialStartSequence=function(c){var isEnd=this.sequenceIndex===this.currentSequence.length,isMatch=isEnd?isEndOfTagSection(c):(c|32)===this.currentSequence[this.sequenceIndex];if(!isMatch)this.isSpecial=!1;else if(!isEnd){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=State.InTagName,this.stateInTagName(c)},Tokenizer3.prototype.stateInSpecialTag=function(c){if(this.sequenceIndex===this.currentSequence.length){if(c===CharCodes.Gt||isWhitespace(c)){var endOfText=this.index-this.currentSequence.length;if(this.sectionStart<endOfText){var actualIndex=this.index;this.index=endOfText,this.cbs.ontext(this.sectionStart,endOfText),this.index=actualIndex}this.isSpecial=!1,this.sectionStart=endOfText+2,this.stateInClosingTagName(c);return}this.sequenceIndex=0}(c|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Sequences.TitleEnd?this.decodeEntities&&c===CharCodes.Amp&&this.startEntity():this.fastForwardTo(CharCodes.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(c===CharCodes.Lt)},Tokenizer3.prototype.stateCDATASequence=function(c){c===Sequences.Cdata[this.sequenceIndex]?++this.sequenceIndex===Sequences.Cdata.length&&(this.state=State.InCommentLike,this.currentSequence=Sequences.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=State.InDeclaration,this.stateInDeclaration(c))},Tokenizer3.prototype.fastForwardTo=function(c){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===c)return!0;return this.index=this.buffer.length+this.offset-1,!1},Tokenizer3.prototype.stateInCommentLike=function(c){c===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=State.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):c!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},Tokenizer3.prototype.isTagStartChar=function(c){return this.xmlMode?!isEndOfTagSection(c):isASCIIAlpha(c)},Tokenizer3.prototype.startSpecial=function(sequence,offset){this.isSpecial=!0,this.currentSequence=sequence,this.sequenceIndex=offset,this.state=State.SpecialStartSequence},Tokenizer3.prototype.stateBeforeTagName=function(c){if(c===CharCodes.ExclamationMark)this.state=State.BeforeDeclaration,this.sectionStart=this.index+1;else if(c===CharCodes.Questionmark)this.state=State.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(c)){var lower=c|32;this.sectionStart=this.index,!this.xmlMode&&lower===Sequences.TitleEnd[2]?this.startSpecial(Sequences.TitleEnd,3):this.state=!this.xmlMode&&lower===Sequences.ScriptEnd[2]?State.BeforeSpecialS:State.InTagName}else c===CharCodes.Slash?this.state=State.BeforeClosingTagName:(this.state=State.Text,this.stateText(c))},Tokenizer3.prototype.stateInTagName=function(c){isEndOfTagSection(c)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c))},Tokenizer3.prototype.stateBeforeClosingTagName=function(c){isWhitespace(c)||(c===CharCodes.Gt?this.state=State.Text:(this.state=this.isTagStartChar(c)?State.InClosingTagName:State.InSpecialComment,this.sectionStart=this.index))},Tokenizer3.prototype.stateInClosingTagName=function(c){(c===CharCodes.Gt||isWhitespace(c))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterClosingTagName,this.stateAfterClosingTagName(c))},Tokenizer3.prototype.stateAfterClosingTagName=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeAttributeName=function(c){c===CharCodes.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=State.InSpecialTag,this.sequenceIndex=0):this.state=State.Text,this.sectionStart=this.index+1):c===CharCodes.Slash?this.state=State.InSelfClosingTag:isWhitespace(c)||(this.state=State.InAttributeName,this.sectionStart=this.index)},Tokenizer3.prototype.stateInSelfClosingTag=function(c){c===CharCodes.Gt?(this.cbs.onselfclosingtag(this.index),this.state=State.Text,this.sectionStart=this.index+1,this.isSpecial=!1):isWhitespace(c)||(this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c))},Tokenizer3.prototype.stateInAttributeName=function(c){(c===CharCodes.Eq||isEndOfTagSection(c))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterAttributeName,this.stateAfterAttributeName(c))},Tokenizer3.prototype.stateAfterAttributeName=function(c){c===CharCodes.Eq?this.state=State.BeforeAttributeValue:c===CharCodes.Slash||c===CharCodes.Gt?(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c)):isWhitespace(c)||(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.InAttributeName,this.sectionStart=this.index)},Tokenizer3.prototype.stateBeforeAttributeValue=function(c){c===CharCodes.DoubleQuote?(this.state=State.InAttributeValueDq,this.sectionStart=this.index+1):c===CharCodes.SingleQuote?(this.state=State.InAttributeValueSq,this.sectionStart=this.index+1):isWhitespace(c)||(this.sectionStart=this.index,this.state=State.InAttributeValueNq,this.stateInAttributeValueNoQuotes(c))},Tokenizer3.prototype.handleInAttributeValue=function(c,quote){c===quote||!this.decodeEntities&&this.fastForwardTo(quote)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(quote===CharCodes.DoubleQuote?QuoteType.Double:QuoteType.Single,this.index),this.state=State.BeforeAttributeName):this.decodeEntities&&c===CharCodes.Amp&&this.startEntity()},Tokenizer3.prototype.stateInAttributeValueDoubleQuotes=function(c){this.handleInAttributeValue(c,CharCodes.DoubleQuote)},Tokenizer3.prototype.stateInAttributeValueSingleQuotes=function(c){this.handleInAttributeValue(c,CharCodes.SingleQuote)},Tokenizer3.prototype.stateInAttributeValueNoQuotes=function(c){isWhitespace(c)||c===CharCodes.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(QuoteType.Unquoted,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c)):this.decodeEntities&&c===CharCodes.Amp&&this.startEntity()},Tokenizer3.prototype.stateBeforeDeclaration=function(c){c===CharCodes.OpeningSquareBracket?(this.state=State.CDATASequence,this.sequenceIndex=0):this.state=c===CharCodes.Dash?State.BeforeComment:State.InDeclaration},Tokenizer3.prototype.stateInDeclaration=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateInProcessingInstruction=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeComment=function(c){c===CharCodes.Dash?(this.state=State.InCommentLike,this.currentSequence=Sequences.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=State.InDeclaration},Tokenizer3.prototype.stateInSpecialComment=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeSpecialS=function(c){var lower=c|32;lower===Sequences.ScriptEnd[3]?this.startSpecial(Sequences.ScriptEnd,4):lower===Sequences.StyleEnd[3]?this.startSpecial(Sequences.StyleEnd,4):(this.state=State.InTagName,this.stateInTagName(c))},Tokenizer3.prototype.startEntity=function(){this.baseState=this.state,this.state=State.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?decode_js_12.DecodingMode.Strict:this.baseState===State.Text||this.baseState===State.InSpecialTag?decode_js_12.DecodingMode.Legacy:decode_js_12.DecodingMode.Attribute)},Tokenizer3.prototype.stateInEntity=function(){var length=this.entityDecoder.write(this.buffer,this.index-this.offset);length>=0?(this.state=this.baseState,length===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1},Tokenizer3.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===State.Text||this.state===State.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===State.InAttributeValueDq||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},Tokenizer3.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},Tokenizer3.prototype.parse=function(){for(;this.shouldContinue();){var c=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case State.Text:{this.stateText(c);break}case State.SpecialStartSequence:{this.stateSpecialStartSequence(c);break}case State.InSpecialTag:{this.stateInSpecialTag(c);break}case State.CDATASequence:{this.stateCDATASequence(c);break}case State.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(c);break}case State.InAttributeName:{this.stateInAttributeName(c);break}case State.InCommentLike:{this.stateInCommentLike(c);break}case State.InSpecialComment:{this.stateInSpecialComment(c);break}case State.BeforeAttributeName:{this.stateBeforeAttributeName(c);break}case State.InTagName:{this.stateInTagName(c);break}case State.InClosingTagName:{this.stateInClosingTagName(c);break}case State.BeforeTagName:{this.stateBeforeTagName(c);break}case State.AfterAttributeName:{this.stateAfterAttributeName(c);break}case State.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(c);break}case State.BeforeAttributeValue:{this.stateBeforeAttributeValue(c);break}case State.BeforeClosingTagName:{this.stateBeforeClosingTagName(c);break}case State.AfterClosingTagName:{this.stateAfterClosingTagName(c);break}case State.BeforeSpecialS:{this.stateBeforeSpecialS(c);break}case State.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(c);break}case State.InSelfClosingTag:{this.stateInSelfClosingTag(c);break}case State.InDeclaration:{this.stateInDeclaration(c);break}case State.BeforeDeclaration:{this.stateBeforeDeclaration(c);break}case State.BeforeComment:{this.stateBeforeComment(c);break}case State.InProcessingInstruction:{this.stateInProcessingInstruction(c);break}case State.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()},Tokenizer3.prototype.finish=function(){this.state===State.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()},Tokenizer3.prototype.handleTrailingData=function(){var endIndex=this.buffer.length+this.offset;this.sectionStart>=endIndex||(this.state===State.InCommentLike?this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,endIndex,0):this.cbs.oncomment(this.sectionStart,endIndex,0):this.state===State.InTagName||this.state===State.BeforeAttributeName||this.state===State.BeforeAttributeValue||this.state===State.AfterAttributeName||this.state===State.InAttributeName||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueDq||this.state===State.InAttributeValueNq||this.state===State.InClosingTagName||this.cbs.ontext(this.sectionStart,endIndex))},Tokenizer3.prototype.emitCodePoint=function(cp,consumed){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+consumed,this.index=this.sectionStart-1,this.cbs.onattribentity(cp)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+consumed,this.index=this.sectionStart-1,this.cbs.ontextentity(cp,this.sectionStart))},Tokenizer3}();exports.default=Tokenizer2})(Tokenizer$1);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding$1(result,mod,k);return __setModuleDefault$1(result,mod),result};Object.defineProperty(Parser$3,"__esModule",{value:!0});Parser$3.Parser=void 0;var Tokenizer_js_1$1=__importStar$1(Tokenizer$1),decode_js_1$1=decode,formTags$1=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag$1=new Set(["p"]),tableSectionTags$1=new Set(["thead","tbody"]),ddtTags$1=new Set(["dd","dt"]),rtpTags$1=new Set(["rt","rp"]),openImpliesClose$1=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag$1],["h1",pTag$1],["h2",pTag$1],["h3",pTag$1],["h4",pTag$1],["h5",pTag$1],["h6",pTag$1],["select",formTags$1],["input",formTags$1],["output",formTags$1],["button",formTags$1],["datalist",formTags$1],["textarea",formTags$1],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags$1],["dt",ddtTags$1],["address",pTag$1],["article",pTag$1],["aside",pTag$1],["blockquote",pTag$1],["details",pTag$1],["div",pTag$1],["dl",pTag$1],["fieldset",pTag$1],["figcaption",pTag$1],["figure",pTag$1],["footer",pTag$1],["form",pTag$1],["header",pTag$1],["hr",pTag$1],["main",pTag$1],["nav",pTag$1],["ol",pTag$1],["pre",pTag$1],["section",pTag$1],["table",pTag$1],["ul",pTag$1],["rt",rtpTags$1],["rp",rtpTags$1],["tbody",tableSectionTags$1],["tfoot",tableSectionTags$1]]),voidElements$1=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements$1=new Set(["math","svg"]),htmlIntegrationElements$1=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd$1=/\s|\//,Parser$2=function(){function Parser3(cbs,options){options===void 0&&(options={});var _a2,_b,_c,_d,_e;this.options=options,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=cbs??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(_a2=options.lowerCaseTags)!==null&&_a2!==void 0?_a2:this.htmlMode,this.lowerCaseAttributeNames=(_b=options.lowerCaseAttributeNames)!==null&&_b!==void 0?_b:this.htmlMode,this.tokenizer=new((_c=options.Tokenizer)!==null&&_c!==void 0?_c:Tokenizer_js_1$1.default)(this.options,this),this.foreignContext=[!this.htmlMode],(_e=(_d=this.cbs).onparserinit)===null||_e===void 0||_e.call(_d,this)}return __name(Parser3,"Parser"),Parser3.prototype.ontext=function(start,endIndex){var _a2,_b,data=this.getSlice(start,endIndex);this.endIndex=endIndex-1,(_b=(_a2=this.cbs).ontext)===null||_b===void 0||_b.call(_a2,data),this.startIndex=endIndex},Parser3.prototype.ontextentity=function(cp,endIndex){var _a2,_b;this.endIndex=endIndex-1,(_b=(_a2=this.cbs).ontext)===null||_b===void 0||_b.call(_a2,(0,decode_js_1$1.fromCodePoint)(cp)),this.startIndex=endIndex},Parser3.prototype.isVoidElement=function(name){return this.htmlMode&&voidElements$1.has(name)},Parser3.prototype.onopentagname=function(start,endIndex){this.endIndex=endIndex;var name=this.getSlice(start,endIndex);this.lowerCaseTagNames&&(name=name.toLowerCase()),this.emitOpenTag(name)},Parser3.prototype.emitOpenTag=function(name){var _a2,_b,_c,_d;this.openTagStart=this.startIndex,this.tagname=name;var impliesClose=this.htmlMode&&openImpliesClose$1.get(name);if(impliesClose)for(;this.stack.length>0&&impliesClose.has(this.stack[0]);){var element=this.stack.shift();(_b=(_a2=this.cbs).onclosetag)===null||_b===void 0||_b.call(_a2,element,!0)}this.isVoidElement(name)||(this.stack.unshift(name),this.htmlMode&&(foreignContextElements$1.has(name)?this.foreignContext.unshift(!0):htmlIntegrationElements$1.has(name)&&this.foreignContext.unshift(!1))),(_d=(_c=this.cbs).onopentagname)===null||_d===void 0||_d.call(_c,name),this.cbs.onopentag&&(this.attribs={})},Parser3.prototype.endOpenTag=function(isImplied){var _a2,_b;this.startIndex=this.openTagStart,this.attribs&&((_b=(_a2=this.cbs).onopentag)===null||_b===void 0||_b.call(_a2,this.tagname,this.attribs,isImplied),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},Parser3.prototype.onopentagend=function(endIndex){this.endIndex=endIndex,this.endOpenTag(!1),this.startIndex=endIndex+1},Parser3.prototype.onclosetag=function(start,endIndex){var _a2,_b,_c,_d,_e,_f,_g,_h;this.endIndex=endIndex;var name=this.getSlice(start,endIndex);if(this.lowerCaseTagNames&&(name=name.toLowerCase()),this.htmlMode&&(foreignContextElements$1.has(name)||htmlIntegrationElements$1.has(name))&&this.foreignContext.shift(),this.isVoidElement(name))this.htmlMode&&name==="br"&&((_d=(_c=this.cbs).onopentagname)===null||_d===void 0||_d.call(_c,"br"),(_f=(_e=this.cbs).onopentag)===null||_f===void 0||_f.call(_e,"br",{},!0),(_h=(_g=this.cbs).onclosetag)===null||_h===void 0||_h.call(_g,"br",!1));else{var pos=this.stack.indexOf(name);if(pos!==-1)for(var index=0;index<=pos;index++){var element=this.stack.shift();(_b=(_a2=this.cbs).onclosetag)===null||_b===void 0||_b.call(_a2,element,index!==pos)}else this.htmlMode&&name==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=endIndex+1},Parser3.prototype.onselfclosingtag=function(endIndex){this.endIndex=endIndex,this.options.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=endIndex+1):this.onopentagend(endIndex)},Parser3.prototype.closeCurrentTag=function(isOpenImplied){var _a2,_b,name=this.tagname;this.endOpenTag(isOpenImplied),this.stack[0]===name&&((_b=(_a2=this.cbs).onclosetag)===null||_b===void 0||_b.call(_a2,name,!isOpenImplied),this.stack.shift())},Parser3.prototype.onattribname=function(start,endIndex){this.startIndex=start;var name=this.getSlice(start,endIndex);this.attribname=this.lowerCaseAttributeNames?name.toLowerCase():name},Parser3.prototype.onattribdata=function(start,endIndex){this.attribvalue+=this.getSlice(start,endIndex)},Parser3.prototype.onattribentity=function(cp){this.attribvalue+=(0,decode_js_1$1.fromCodePoint)(cp)},Parser3.prototype.onattribend=function(quote,endIndex){var _a2,_b;this.endIndex=endIndex,(_b=(_a2=this.cbs).onattribute)===null||_b===void 0||_b.call(_a2,this.attribname,this.attribvalue,quote===Tokenizer_js_1$1.QuoteType.Double?'"':quote===Tokenizer_js_1$1.QuoteType.Single?"'":quote===Tokenizer_js_1$1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},Parser3.prototype.getInstructionName=function(value){var index=value.search(reNameEnd$1),name=index<0?value:value.substr(0,index);return this.lowerCaseTagNames&&(name=name.toLowerCase()),name},Parser3.prototype.ondeclaration=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction("!".concat(name),"!".concat(value))}this.startIndex=endIndex+1},Parser3.prototype.onprocessinginstruction=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction("?".concat(name),"?".concat(value))}this.startIndex=endIndex+1},Parser3.prototype.oncomment=function(start,endIndex,offset){var _a2,_b,_c,_d;this.endIndex=endIndex,(_b=(_a2=this.cbs).oncomment)===null||_b===void 0||_b.call(_a2,this.getSlice(start,endIndex-offset)),(_d=(_c=this.cbs).oncommentend)===null||_d===void 0||_d.call(_c),this.startIndex=endIndex+1},Parser3.prototype.oncdata=function(start,endIndex,offset){var _a2,_b,_c,_d,_e,_f,_g,_h,_j,_k;this.endIndex=endIndex;var value=this.getSlice(start,endIndex-offset);!this.htmlMode||this.options.recognizeCDATA?((_b=(_a2=this.cbs).oncdatastart)===null||_b===void 0||_b.call(_a2),(_d=(_c=this.cbs).ontext)===null||_d===void 0||_d.call(_c,value),(_f=(_e=this.cbs).oncdataend)===null||_f===void 0||_f.call(_e)):((_h=(_g=this.cbs).oncomment)===null||_h===void 0||_h.call(_g,"[CDATA[".concat(value,"]]")),(_k=(_j=this.cbs).oncommentend)===null||_k===void 0||_k.call(_j)),this.startIndex=endIndex+1},Parser3.prototype.onend=function(){var _a2,_b;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var index=0;index<this.stack.length;index++)this.cbs.onclosetag(this.stack[index],!0)}(_b=(_a2=this.cbs).onend)===null||_b===void 0||_b.call(_a2)},Parser3.prototype.reset=function(){var _a2,_b,_c,_d;(_b=(_a2=this.cbs).onreset)===null||_b===void 0||_b.call(_a2),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(_d=(_c=this.cbs).onparserinit)===null||_d===void 0||_d.call(_c,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1},Parser3.prototype.parseComplete=function(data){this.reset(),this.end(data)},Parser3.prototype.getSlice=function(start,end){for(;start-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var slice3=this.buffers[0].slice(start-this.bufferOffset,end-this.bufferOffset);end-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),slice3+=this.buffers[0].slice(0,end-this.bufferOffset);return slice3},Parser3.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},Parser3.prototype.write=function(chunk){var _a2,_b;if(this.ended){(_b=(_a2=this.cbs).onerror)===null||_b===void 0||_b.call(_a2,new Error(".write() after done!"));return}this.buffers.push(chunk),this.tokenizer.running&&(this.tokenizer.write(chunk),this.writeIndex++)},Parser3.prototype.end=function(chunk){var _a2,_b;if(this.ended){(_b=(_a2=this.cbs).onerror)===null||_b===void 0||_b.call(_a2,new Error(".end() after done!"));return}chunk&&this.write(chunk),this.ended=!0,this.tokenizer.end()},Parser3.prototype.pause=function(){this.tokenizer.pause()},Parser3.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},Parser3.prototype.parseChunk=function(chunk){this.write(chunk)},Parser3.prototype.done=function(chunk){this.end(chunk)},Parser3}();Parser$3.Parser=Parser$2;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar2=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding2(result,mod,k);return __setModuleDefault2(result,mod),result},__importDefault2=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DomUtils=exports.parseFeed=exports.getFeed=exports.ElementType=exports.Tokenizer=exports.createDomStream=exports.createDocumentStream=exports.parseDOM=exports.parseDocument=exports.DefaultHandler=exports.DomHandler=exports.Parser=void 0;var Parser_js_1=Parser$3,Parser_js_2=Parser$3;Object.defineProperty(exports,"Parser",{enumerable:!0,get:function(){return Parser_js_2.Parser}});var domhandler_12=lib$1Q,domhandler_2=lib$1Q;Object.defineProperty(exports,"DomHandler",{enumerable:!0,get:function(){return domhandler_2.DomHandler}}),Object.defineProperty(exports,"DefaultHandler",{enumerable:!0,get:function(){return domhandler_2.DomHandler}});function parseDocument(data,options){var handler2=new domhandler_12.DomHandler(void 0,options);return new Parser_js_1.Parser(handler2,options).end(data),handler2.root}__name(parseDocument,"parseDocument"),exports.parseDocument=parseDocument;function parseDOM(data,options){return parseDocument(data,options).children}__name(parseDOM,"parseDOM"),exports.parseDOM=parseDOM;function createDocumentStream(callback,options,elementCallback){var handler2=new domhandler_12.DomHandler(function(error){return callback(error,handler2.root)},options,elementCallback);return new Parser_js_1.Parser(handler2,options)}__name(createDocumentStream,"createDocumentStream"),exports.createDocumentStream=createDocumentStream;function createDomStream(callback,options,elementCallback){var handler2=new domhandler_12.DomHandler(callback,options,elementCallback);return new Parser_js_1.Parser(handler2,options)}__name(createDomStream,"createDomStream"),exports.createDomStream=createDomStream;var Tokenizer_js_12=Tokenizer$1;Object.defineProperty(exports,"Tokenizer",{enumerable:!0,get:function(){return __importDefault2(Tokenizer_js_12).default}}),exports.ElementType=__importStar2(lib$1P);var domutils_1=lib$1O,domutils_2=lib$1O;Object.defineProperty(exports,"getFeed",{enumerable:!0,get:function(){return domutils_2.getFeed}});var parseFeedDefaultOptions={xmlMode:!0};function parseFeed(feed,options){return options===void 0&&(options=parseFeedDefaultOptions),(0,domutils_1.getFeed)(parseDOM(feed,options))}__name(parseFeed,"parseFeed"),exports.parseFeed=parseFeed,exports.DomUtils=__importStar2(lib$1O)})(lib$1n);Object.defineProperty(ActorRdfParseHtml$3,"__esModule",{value:!0});ActorRdfParseHtml$3.ActorRdfParseHtml=void 0;const bus_rdf_parse_1$1=lib$1U,htmlparser2_1$1=lib$1n,readable_stream_1$8=browserExports$1;let ActorRdfParseHtml$2=__name(class extends bus_rdf_parse_1$1.ActorRdfParseFixedMediaTypes{constructor(args){super(args)}async runHandle(action,mediaType,context2){const data=new readable_stream_1$8.Readable({objectMode:!0});return data._read=async()=>{var _a2;data._read=()=>{};let endBarrier=1;function emit(quad){data.emit("data",quad)}__name(emit,"emit");function error(subError){data.emit("error",subError)}__name(error,"error");function end(){--endBarrier===0&&data.push(null)}__name(end,"end");const htmlAction={baseIRI:((_a2=action.metadata)==null?void 0:_a2.baseIRI)??"",context:context2,emit,end,error,headers:action.headers};Promise.all(this.busRdfParseHtml.publish(htmlAction)).then(async outputs=>{endBarrier+=outputs.length;const htmlParseListeners=[];for(const output of outputs){const{htmlParseListener}=await output.actor.run(htmlAction);htmlParseListeners.push(htmlParseListener)}const parser=new htmlparser2_1$1.Parser({onclosetag(){try{for(const htmlParseListener of htmlParseListeners)htmlParseListener.onTagClose()}catch(error_){error(error_)}},onend(){try{for(const htmlParseListener of htmlParseListeners)htmlParseListener.onEnd()}catch(error_){error(error_)}end()},onopentag(name,attributes){try{for(const htmlParseListener of htmlParseListeners)htmlParseListener.onTagOpen(name,attributes)}catch(error_){error(error_)}},ontext(text){try{for(const htmlParseListener of htmlParseListeners)htmlParseListener.onText(text)}catch(error_){error(error_)}}},{decodeEntities:!0,recognizeSelfClosing:!0,xmlMode:!1});action.data.on("error",error).on("data",chunk=>parser.write(chunk.toString())).on("end",()=>parser.end())}).catch(error)},{data}}},"ActorRdfParseHtml");ActorRdfParseHtml$3.ActorRdfParseHtml=ActorRdfParseHtml$2;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseHtml$3,exports)})(lib$1o);var lib$1m={},ActorRdfParseHtmlMicrodata$1={},lib$1l={},ActorRdfParseHtml$1={};Object.defineProperty(ActorRdfParseHtml$1,"__esModule",{value:!0});ActorRdfParseHtml$1.ActorRdfParseHtml=void 0;const core_1$a=lib$2A;class ActorRdfParseHtml2 extends core_1$a.Actor{constructor(args){super(args)}}__name(ActorRdfParseHtml2,"ActorRdfParseHtml");ActorRdfParseHtml$1.ActorRdfParseHtml=ActorRdfParseHtml2;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseHtml$1,exports)})(lib$1l);var microdataRdfStreamingParser={},IItemPropertyHandler={};Object.defineProperty(IItemPropertyHandler,"__esModule",{value:!0});var ItemPropertyHandlerContent$1={};Object.defineProperty(ItemPropertyHandlerContent$1,"__esModule",{value:!0});ItemPropertyHandlerContent$1.ItemPropertyHandlerContent=void 0;class ItemPropertyHandlerContent{canHandle(tagName,attributes){return"content"in attributes}getObject(attributes,util2,itemScope){return util2.createLiteral(attributes.content,itemScope)}}__name(ItemPropertyHandlerContent,"ItemPropertyHandlerContent");ItemPropertyHandlerContent$1.ItemPropertyHandlerContent=ItemPropertyHandlerContent;var ItemPropertyHandlerNumber$1={},Util$2={};Object.defineProperty(Util$2,"__esModule",{value:!0});Util$2.Util=void 0;const rdf_data_factory_1$q=rdfDataFactory,relative_to_absolute_iri_1$4=relativeToAbsoluteIri;let Util$1=__name(class Util6{constructor(dataFactory,baseIRI){this.dataFactory=dataFactory||new rdf_data_factory_1$q.DataFactory,this.baseIRI=baseIRI||""}static isValidIri(iri){return Util6.IRI_REGEX.test(iri)}createVocabIris(terms,itemScope,allowRelativeIris){return terms.split(/\s+/u).filter(term=>!!term).map(property=>{if(!Util6.isValidIri(property)){if(!allowRelativeIris)return;property=`${itemScope.vocab||`${this.baseIRI}#`}${property}`}return this.dataFactory.namedNode(property)}).filter(term=>!!term)}getVocabularyExpansionType(terms,itemScope,vocabRegistry){const parts=terms.split(/\s+/u);if(parts.includes("subPropertyOf")||parts.includes("equivalentProperty"))return[this.dataFactory.namedNode(`${Util6.RDF}type`)];if(itemScope.vocab&&itemScope.vocab in vocabRegistry&&vocabRegistry[itemScope.vocab].properties){let predicates=[];for(const[property,expansions]of Object.entries(vocabRegistry[itemScope.vocab].properties))parts.includes(property)&&(predicates=[...Object.values(expansions).map(iri=>this.dataFactory.namedNode(iri))]);return predicates}return[]}createSubject(iri){if(!Util6.isValidIri(iri))try{iri=(0,relative_to_absolute_iri_1$4.resolve)(iri,this.baseIRI)}catch{return}return this.dataFactory.namedNode(iri)}createLiteral(literal,activeTag){return this.dataFactory.literal(literal,activeTag.language)}deriveVocab(typeIri,vocabRegistry){let vocab;for(const uriPrefix in vocabRegistry)if(typeIri.startsWith(uriPrefix)){vocab=uriPrefix,vocab.endsWith("/")||(vocab+="#");break}if(!vocab){const hashPos=typeIri.indexOf("#");hashPos>0?vocab=typeIri.slice(0,hashPos+1):vocab=(0,relative_to_absolute_iri_1$4.resolve)(".",typeIri)}return vocab}},"Util");Util$2.Util=Util$1;Util$1.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";Util$1.XSD="http://www.w3.org/2001/XMLSchema#";Util$1.RDFA="http://www.w3.org/ns/rdfa#";Util$1.IRI_REGEX=/^([A-Za-z][\d+-.A-Za-z]*|_):[^ "<>[\\\]`{|}]*$/u;Object.defineProperty(ItemPropertyHandlerNumber$1,"__esModule",{value:!0});ItemPropertyHandlerNumber$1.ItemPropertyHandlerNumber=void 0;const Util_1$4=Util$2;class ItemPropertyHandlerNumber{constructor(tagName,attributeName){this.tagName=tagName,this.attributeName=attributeName}canHandle(tagName,attributes){return this.tagName===tagName&&this.attributeName in attributes}getObject(attributes,util2,itemScope){const value=attributes[this.attributeName];let datatype2;return!Number.isNaN(Number.parseInt(value,10))&&!value.includes(".")?datatype2=`${Util_1$4.Util.XSD}integer`:Number.isNaN(Number.parseFloat(value))||(datatype2=`${Util_1$4.Util.XSD}double`),util2.dataFactory.literal(value,datatype2&&util2.dataFactory.namedNode(datatype2))}}__name(ItemPropertyHandlerNumber,"ItemPropertyHandlerNumber");ItemPropertyHandlerNumber$1.ItemPropertyHandlerNumber=ItemPropertyHandlerNumber;var ItemPropertyHandlerTime$1={};Object.defineProperty(ItemPropertyHandlerTime$1,"__esModule",{value:!0});ItemPropertyHandlerTime$1.ItemPropertyHandlerTime=void 0;const Util_1$3=Util$2;class ItemPropertyHandlerTime{canHandle(tagName,attributes){return tagName==="time"&&"datetime"in attributes}getObject(attributes,util2,itemScope){const value=attributes.datetime;let datatype2;for(const entry of ItemPropertyHandlerTime.TIME_REGEXES)if(entry.regex.test(value)){datatype2=util2.dataFactory.namedNode(Util_1$3.Util.XSD+entry.type);break}return util2.dataFactory.literal(value,datatype2)}}__name(ItemPropertyHandlerTime,"ItemPropertyHandlerTime");ItemPropertyHandlerTime$1.ItemPropertyHandlerTime=ItemPropertyHandlerTime;ItemPropertyHandlerTime.TIME_REGEXES=[{regex:/^-?P(\d+Y)?(\d+M)?(\d+D)?(T(\d+H)?(\d+M)?(\d+(\.\d)?S)?)?$/u,type:"duration"},{regex:/^\d+-\d\d-\d\dT\d\d:\d\d:\d\d((Z?)|([+-]\d\d:\d\d))$/u,type:"dateTime"},{regex:/^\d+-\d\d-\d\dZ?$/u,type:"date"},{regex:/^\d\d:\d\d:\d\d((Z?)|([+-]\d\d:\d\d))$/u,type:"time"},{regex:/^\d+-\d\d$/u,type:"gYearMonth"},{regex:/^\d+$/u,type:"gYear"}];var ItemPropertyHandlerUrl$1={};Object.defineProperty(ItemPropertyHandlerUrl$1,"__esModule",{value:!0});ItemPropertyHandlerUrl$1.ItemPropertyHandlerUrl=void 0;const relative_to_absolute_iri_1$3=relativeToAbsoluteIri;class ItemPropertyHandlerUrl{constructor(tagName,attributeName){this.tagName=tagName,this.attributeName=attributeName}canHandle(tagName,attributes){return this.tagName===tagName&&this.attributeName in attributes}getObject(attributes,util2,itemScope){return util2.dataFactory.namedNode((0,relative_to_absolute_iri_1$3.resolve)(attributes[this.attributeName],util2.baseIRI))}}__name(ItemPropertyHandlerUrl,"ItemPropertyHandlerUrl");ItemPropertyHandlerUrl$1.ItemPropertyHandlerUrl=ItemPropertyHandlerUrl;var IHtmlParseListener={};Object.defineProperty(IHtmlParseListener,"__esModule",{value:!0});var IItemScope={};Object.defineProperty(IItemScope,"__esModule",{value:!0});var IVocabRegistry={};Object.defineProperty(IVocabRegistry,"__esModule",{value:!0});var MicrodataRdfParser$1={},lib$1k={},Parser$1={},Tokenizer={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.QuoteType=void 0;var decode_js_12=decode,CharCodes;(function(CharCodes2){CharCodes2[CharCodes2.Tab=9]="Tab",CharCodes2[CharCodes2.NewLine=10]="NewLine",CharCodes2[CharCodes2.FormFeed=12]="FormFeed",CharCodes2[CharCodes2.CarriageReturn=13]="CarriageReturn",CharCodes2[CharCodes2.Space=32]="Space",CharCodes2[CharCodes2.ExclamationMark=33]="ExclamationMark",CharCodes2[CharCodes2.Number=35]="Number",CharCodes2[CharCodes2.Amp=38]="Amp",CharCodes2[CharCodes2.SingleQuote=39]="SingleQuote",CharCodes2[CharCodes2.DoubleQuote=34]="DoubleQuote",CharCodes2[CharCodes2.Dash=45]="Dash",CharCodes2[CharCodes2.Slash=47]="Slash",CharCodes2[CharCodes2.Zero=48]="Zero",CharCodes2[CharCodes2.Nine=57]="Nine",CharCodes2[CharCodes2.Semi=59]="Semi",CharCodes2[CharCodes2.Lt=60]="Lt",CharCodes2[CharCodes2.Eq=61]="Eq",CharCodes2[CharCodes2.Gt=62]="Gt",CharCodes2[CharCodes2.Questionmark=63]="Questionmark",CharCodes2[CharCodes2.UpperA=65]="UpperA",CharCodes2[CharCodes2.LowerA=97]="LowerA",CharCodes2[CharCodes2.UpperF=70]="UpperF",CharCodes2[CharCodes2.LowerF=102]="LowerF",CharCodes2[CharCodes2.UpperZ=90]="UpperZ",CharCodes2[CharCodes2.LowerZ=122]="LowerZ",CharCodes2[CharCodes2.LowerX=120]="LowerX",CharCodes2[CharCodes2.OpeningSquareBracket=91]="OpeningSquareBracket"})(CharCodes||(CharCodes={}));var State;(function(State2){State2[State2.Text=1]="Text",State2[State2.BeforeTagName=2]="BeforeTagName",State2[State2.InTagName=3]="InTagName",State2[State2.InSelfClosingTag=4]="InSelfClosingTag",State2[State2.BeforeClosingTagName=5]="BeforeClosingTagName",State2[State2.InClosingTagName=6]="InClosingTagName",State2[State2.AfterClosingTagName=7]="AfterClosingTagName",State2[State2.BeforeAttributeName=8]="BeforeAttributeName",State2[State2.InAttributeName=9]="InAttributeName",State2[State2.AfterAttributeName=10]="AfterAttributeName",State2[State2.BeforeAttributeValue=11]="BeforeAttributeValue",State2[State2.InAttributeValueDq=12]="InAttributeValueDq",State2[State2.InAttributeValueSq=13]="InAttributeValueSq",State2[State2.InAttributeValueNq=14]="InAttributeValueNq",State2[State2.BeforeDeclaration=15]="BeforeDeclaration",State2[State2.InDeclaration=16]="InDeclaration",State2[State2.InProcessingInstruction=17]="InProcessingInstruction",State2[State2.BeforeComment=18]="BeforeComment",State2[State2.CDATASequence=19]="CDATASequence",State2[State2.InSpecialComment=20]="InSpecialComment",State2[State2.InCommentLike=21]="InCommentLike",State2[State2.BeforeSpecialS=22]="BeforeSpecialS",State2[State2.SpecialStartSequence=23]="SpecialStartSequence",State2[State2.InSpecialTag=24]="InSpecialTag",State2[State2.BeforeEntity=25]="BeforeEntity",State2[State2.BeforeNumericEntity=26]="BeforeNumericEntity",State2[State2.InNamedEntity=27]="InNamedEntity",State2[State2.InNumericEntity=28]="InNumericEntity",State2[State2.InHexEntity=29]="InHexEntity"})(State||(State={}));function isWhitespace(c){return c===CharCodes.Space||c===CharCodes.NewLine||c===CharCodes.Tab||c===CharCodes.FormFeed||c===CharCodes.CarriageReturn}__name(isWhitespace,"isWhitespace");function isEndOfTagSection(c){return c===CharCodes.Slash||c===CharCodes.Gt||isWhitespace(c)}__name(isEndOfTagSection,"isEndOfTagSection");function isNumber(c){return c>=CharCodes.Zero&&c<=CharCodes.Nine}__name(isNumber,"isNumber");function isASCIIAlpha(c){return c>=CharCodes.LowerA&&c<=CharCodes.LowerZ||c>=CharCodes.UpperA&&c<=CharCodes.UpperZ}__name(isASCIIAlpha,"isASCIIAlpha");function isHexDigit(c){return c>=CharCodes.UpperA&&c<=CharCodes.UpperF||c>=CharCodes.LowerA&&c<=CharCodes.LowerF}__name(isHexDigit,"isHexDigit");var QuoteType;(function(QuoteType2){QuoteType2[QuoteType2.NoValue=0]="NoValue",QuoteType2[QuoteType2.Unquoted=1]="Unquoted",QuoteType2[QuoteType2.Single=2]="Single",QuoteType2[QuoteType2.Double=3]="Double"})(QuoteType=exports.QuoteType||(exports.QuoteType={}));var Sequences={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},Tokenizer2=function(){function Tokenizer3(_a2,cbs){var _b=_a2.xmlMode,xmlMode=_b===void 0?!1:_b,_c=_a2.decodeEntities,decodeEntities=_c===void 0?!0:_c;this.cbs=cbs,this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=xmlMode,this.decodeEntities=decodeEntities,this.entityTrie=xmlMode?decode_js_12.xmlDecodeTree:decode_js_12.htmlDecodeTree}return __name(Tokenizer3,"Tokenizer"),Tokenizer3.prototype.reset=function(){this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},Tokenizer3.prototype.write=function(chunk){this.offset+=this.buffer.length,this.buffer=chunk,this.parse()},Tokenizer3.prototype.end=function(){this.running&&this.finish()},Tokenizer3.prototype.pause=function(){this.running=!1},Tokenizer3.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},Tokenizer3.prototype.getIndex=function(){return this.index},Tokenizer3.prototype.getSectionStart=function(){return this.sectionStart},Tokenizer3.prototype.stateText=function(c){c===CharCodes.Lt||!this.decodeEntities&&this.fastForwardTo(CharCodes.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=State.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&c===CharCodes.Amp&&(this.state=State.BeforeEntity)},Tokenizer3.prototype.stateSpecialStartSequence=function(c){var isEnd=this.sequenceIndex===this.currentSequence.length,isMatch=isEnd?isEndOfTagSection(c):(c|32)===this.currentSequence[this.sequenceIndex];if(!isMatch)this.isSpecial=!1;else if(!isEnd){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=State.InTagName,this.stateInTagName(c)},Tokenizer3.prototype.stateInSpecialTag=function(c){if(this.sequenceIndex===this.currentSequence.length){if(c===CharCodes.Gt||isWhitespace(c)){var endOfText=this.index-this.currentSequence.length;if(this.sectionStart<endOfText){var actualIndex=this.index;this.index=endOfText,this.cbs.ontext(this.sectionStart,endOfText),this.index=actualIndex}this.isSpecial=!1,this.sectionStart=endOfText+2,this.stateInClosingTagName(c);return}this.sequenceIndex=0}(c|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Sequences.TitleEnd?this.decodeEntities&&c===CharCodes.Amp&&(this.state=State.BeforeEntity):this.fastForwardTo(CharCodes.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(c===CharCodes.Lt)},Tokenizer3.prototype.stateCDATASequence=function(c){c===Sequences.Cdata[this.sequenceIndex]?++this.sequenceIndex===Sequences.Cdata.length&&(this.state=State.InCommentLike,this.currentSequence=Sequences.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=State.InDeclaration,this.stateInDeclaration(c))},Tokenizer3.prototype.fastForwardTo=function(c){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===c)return!0;return this.index=this.buffer.length+this.offset-1,!1},Tokenizer3.prototype.stateInCommentLike=function(c){c===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=State.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):c!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},Tokenizer3.prototype.isTagStartChar=function(c){return this.xmlMode?!isEndOfTagSection(c):isASCIIAlpha(c)},Tokenizer3.prototype.startSpecial=function(sequence,offset){this.isSpecial=!0,this.currentSequence=sequence,this.sequenceIndex=offset,this.state=State.SpecialStartSequence},Tokenizer3.prototype.stateBeforeTagName=function(c){if(c===CharCodes.ExclamationMark)this.state=State.BeforeDeclaration,this.sectionStart=this.index+1;else if(c===CharCodes.Questionmark)this.state=State.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(c)){var lower=c|32;this.sectionStart=this.index,!this.xmlMode&&lower===Sequences.TitleEnd[2]?this.startSpecial(Sequences.TitleEnd,3):this.state=!this.xmlMode&&lower===Sequences.ScriptEnd[2]?State.BeforeSpecialS:State.InTagName}else c===CharCodes.Slash?this.state=State.BeforeClosingTagName:(this.state=State.Text,this.stateText(c))},Tokenizer3.prototype.stateInTagName=function(c){isEndOfTagSection(c)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c))},Tokenizer3.prototype.stateBeforeClosingTagName=function(c){isWhitespace(c)||(c===CharCodes.Gt?this.state=State.Text:(this.state=this.isTagStartChar(c)?State.InClosingTagName:State.InSpecialComment,this.sectionStart=this.index))},Tokenizer3.prototype.stateInClosingTagName=function(c){(c===CharCodes.Gt||isWhitespace(c))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterClosingTagName,this.stateAfterClosingTagName(c))},Tokenizer3.prototype.stateAfterClosingTagName=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.state=State.Text,this.baseState=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeAttributeName=function(c){c===CharCodes.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=State.InSpecialTag,this.sequenceIndex=0):this.state=State.Text,this.baseState=this.state,this.sectionStart=this.index+1):c===CharCodes.Slash?this.state=State.InSelfClosingTag:isWhitespace(c)||(this.state=State.InAttributeName,this.sectionStart=this.index)},Tokenizer3.prototype.stateInSelfClosingTag=function(c){c===CharCodes.Gt?(this.cbs.onselfclosingtag(this.index),this.state=State.Text,this.baseState=State.Text,this.sectionStart=this.index+1,this.isSpecial=!1):isWhitespace(c)||(this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c))},Tokenizer3.prototype.stateInAttributeName=function(c){(c===CharCodes.Eq||isEndOfTagSection(c))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterAttributeName,this.stateAfterAttributeName(c))},Tokenizer3.prototype.stateAfterAttributeName=function(c){c===CharCodes.Eq?this.state=State.BeforeAttributeValue:c===CharCodes.Slash||c===CharCodes.Gt?(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c)):isWhitespace(c)||(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.InAttributeName,this.sectionStart=this.index)},Tokenizer3.prototype.stateBeforeAttributeValue=function(c){c===CharCodes.DoubleQuote?(this.state=State.InAttributeValueDq,this.sectionStart=this.index+1):c===CharCodes.SingleQuote?(this.state=State.InAttributeValueSq,this.sectionStart=this.index+1):isWhitespace(c)||(this.sectionStart=this.index,this.state=State.InAttributeValueNq,this.stateInAttributeValueNoQuotes(c))},Tokenizer3.prototype.handleInAttributeValue=function(c,quote){c===quote||!this.decodeEntities&&this.fastForwardTo(quote)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(quote===CharCodes.DoubleQuote?QuoteType.Double:QuoteType.Single,this.index),this.state=State.BeforeAttributeName):this.decodeEntities&&c===CharCodes.Amp&&(this.baseState=this.state,this.state=State.BeforeEntity)},Tokenizer3.prototype.stateInAttributeValueDoubleQuotes=function(c){this.handleInAttributeValue(c,CharCodes.DoubleQuote)},Tokenizer3.prototype.stateInAttributeValueSingleQuotes=function(c){this.handleInAttributeValue(c,CharCodes.SingleQuote)},Tokenizer3.prototype.stateInAttributeValueNoQuotes=function(c){isWhitespace(c)||c===CharCodes.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(QuoteType.Unquoted,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(c)):this.decodeEntities&&c===CharCodes.Amp&&(this.baseState=this.state,this.state=State.BeforeEntity)},Tokenizer3.prototype.stateBeforeDeclaration=function(c){c===CharCodes.OpeningSquareBracket?(this.state=State.CDATASequence,this.sequenceIndex=0):this.state=c===CharCodes.Dash?State.BeforeComment:State.InDeclaration},Tokenizer3.prototype.stateInDeclaration=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateInProcessingInstruction=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeComment=function(c){c===CharCodes.Dash?(this.state=State.InCommentLike,this.currentSequence=Sequences.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=State.InDeclaration},Tokenizer3.prototype.stateInSpecialComment=function(c){(c===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=State.Text,this.sectionStart=this.index+1)},Tokenizer3.prototype.stateBeforeSpecialS=function(c){var lower=c|32;lower===Sequences.ScriptEnd[3]?this.startSpecial(Sequences.ScriptEnd,4):lower===Sequences.StyleEnd[3]?this.startSpecial(Sequences.StyleEnd,4):(this.state=State.InTagName,this.stateInTagName(c))},Tokenizer3.prototype.stateBeforeEntity=function(c){this.entityExcess=1,this.entityResult=0,c===CharCodes.Number?this.state=State.BeforeNumericEntity:c===CharCodes.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=State.InNamedEntity,this.stateInNamedEntity(c))},Tokenizer3.prototype.stateInNamedEntity=function(c){if(this.entityExcess+=1,this.trieIndex=(0,decode_js_12.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,c),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var masked=this.trieCurrent&decode_js_12.BinTrieFlags.VALUE_LENGTH;if(masked){var valueLength=(masked>>14)-1;if(!this.allowLegacyEntity()&&c!==CharCodes.Semi)this.trieIndex+=valueLength;else{var entityStart=this.index-this.entityExcess+1;entityStart>this.sectionStart&&this.emitPartial(this.sectionStart,entityStart),this.entityResult=this.trieIndex,this.trieIndex+=valueLength,this.entityExcess=0,this.sectionStart=this.index+1,valueLength===0&&this.emitNamedEntity()}}},Tokenizer3.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var valueLength=(this.entityTrie[this.entityResult]&decode_js_12.BinTrieFlags.VALUE_LENGTH)>>14;switch(valueLength){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~decode_js_12.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},Tokenizer3.prototype.stateBeforeNumericEntity=function(c){(c|32)===CharCodes.LowerX?(this.entityExcess++,this.state=State.InHexEntity):(this.state=State.InNumericEntity,this.stateInNumericEntity(c))},Tokenizer3.prototype.emitNumericEntity=function(strict){var entityStart=this.index-this.entityExcess-1,numberStart=entityStart+2+ +(this.state===State.InHexEntity);numberStart!==this.index&&(entityStart>this.sectionStart&&this.emitPartial(this.sectionStart,entityStart),this.sectionStart=this.index+Number(strict),this.emitCodePoint((0,decode_js_12.replaceCodePoint)(this.entityResult))),this.state=this.baseState},Tokenizer3.prototype.stateInNumericEntity=function(c){c===CharCodes.Semi?this.emitNumericEntity(!0):isNumber(c)?(this.entityResult=this.entityResult*10+(c-CharCodes.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Tokenizer3.prototype.stateInHexEntity=function(c){c===CharCodes.Semi?this.emitNumericEntity(!0):isNumber(c)?(this.entityResult=this.entityResult*16+(c-CharCodes.Zero),this.entityExcess++):isHexDigit(c)?(this.entityResult=this.entityResult*16+((c|32)-CharCodes.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Tokenizer3.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===State.Text||this.baseState===State.InSpecialTag)},Tokenizer3.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===State.Text||this.state===State.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===State.InAttributeValueDq||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},Tokenizer3.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},Tokenizer3.prototype.parse=function(){for(;this.shouldContinue();){var c=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case State.Text:{this.stateText(c);break}case State.SpecialStartSequence:{this.stateSpecialStartSequence(c);break}case State.InSpecialTag:{this.stateInSpecialTag(c);break}case State.CDATASequence:{this.stateCDATASequence(c);break}case State.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(c);break}case State.InAttributeName:{this.stateInAttributeName(c);break}case State.InCommentLike:{this.stateInCommentLike(c);break}case State.InSpecialComment:{this.stateInSpecialComment(c);break}case State.BeforeAttributeName:{this.stateBeforeAttributeName(c);break}case State.InTagName:{this.stateInTagName(c);break}case State.InClosingTagName:{this.stateInClosingTagName(c);break}case State.BeforeTagName:{this.stateBeforeTagName(c);break}case State.AfterAttributeName:{this.stateAfterAttributeName(c);break}case State.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(c);break}case State.BeforeAttributeValue:{this.stateBeforeAttributeValue(c);break}case State.BeforeClosingTagName:{this.stateBeforeClosingTagName(c);break}case State.AfterClosingTagName:{this.stateAfterClosingTagName(c);break}case State.BeforeSpecialS:{this.stateBeforeSpecialS(c);break}case State.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(c);break}case State.InSelfClosingTag:{this.stateInSelfClosingTag(c);break}case State.InDeclaration:{this.stateInDeclaration(c);break}case State.BeforeDeclaration:{this.stateBeforeDeclaration(c);break}case State.BeforeComment:{this.stateBeforeComment(c);break}case State.InProcessingInstruction:{this.stateInProcessingInstruction(c);break}case State.InNamedEntity:{this.stateInNamedEntity(c);break}case State.BeforeEntity:{this.stateBeforeEntity(c);break}case State.InHexEntity:{this.stateInHexEntity(c);break}case State.InNumericEntity:{this.stateInNumericEntity(c);break}default:this.stateBeforeNumericEntity(c)}this.index++}this.cleanup()},Tokenizer3.prototype.finish=function(){this.state===State.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},Tokenizer3.prototype.handleTrailingData=function(){var endIndex=this.buffer.length+this.offset;this.state===State.InCommentLike?this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,endIndex,0):this.cbs.oncomment(this.sectionStart,endIndex,0):this.state===State.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===State.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===State.InTagName||this.state===State.BeforeAttributeName||this.state===State.BeforeAttributeValue||this.state===State.AfterAttributeName||this.state===State.InAttributeName||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueDq||this.state===State.InAttributeValueNq||this.state===State.InClosingTagName||this.cbs.ontext(this.sectionStart,endIndex)},Tokenizer3.prototype.emitPartial=function(start,endIndex){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?this.cbs.onattribdata(start,endIndex):this.cbs.ontext(start,endIndex)},Tokenizer3.prototype.emitCodePoint=function(cp){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?this.cbs.onattribentity(cp):this.cbs.ontextentity(cp)},Tokenizer3}();exports.default=Tokenizer2})(Tokenizer);var __createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(Parser$1,"__esModule",{value:!0});Parser$1.Parser=void 0;var Tokenizer_js_1=__importStar(Tokenizer),decode_js_1=decode,formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//,Parser2=function(){function Parser3(cbs,options){options===void 0&&(options={});var _a2,_b,_c,_d,_e;this.options=options,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=cbs??{},this.lowerCaseTagNames=(_a2=options.lowerCaseTags)!==null&&_a2!==void 0?_a2:!options.xmlMode,this.lowerCaseAttributeNames=(_b=options.lowerCaseAttributeNames)!==null&&_b!==void 0?_b:!options.xmlMode,this.tokenizer=new((_c=options.Tokenizer)!==null&&_c!==void 0?_c:Tokenizer_js_1.default)(this.options,this),(_e=(_d=this.cbs).onparserinit)===null||_e===void 0||_e.call(_d,this)}return __name(Parser3,"Parser"),Parser3.prototype.ontext=function(start,endIndex){var _a2,_b,data=this.getSlice(start,endIndex);this.endIndex=endIndex-1,(_b=(_a2=this.cbs).ontext)===null||_b===void 0||_b.call(_a2,data),this.startIndex=endIndex},Parser3.prototype.ontextentity=function(cp){var _a2,_b,index=this.tokenizer.getSectionStart();this.endIndex=index-1,(_b=(_a2=this.cbs).ontext)===null||_b===void 0||_b.call(_a2,(0,decode_js_1.fromCodePoint)(cp)),this.startIndex=index},Parser3.prototype.isVoidElement=function(name){return!this.options.xmlMode&&voidElements.has(name)},Parser3.prototype.onopentagname=function(start,endIndex){this.endIndex=endIndex;var name=this.getSlice(start,endIndex);this.lowerCaseTagNames&&(name=name.toLowerCase()),this.emitOpenTag(name)},Parser3.prototype.emitOpenTag=function(name){var _a2,_b,_c,_d;this.openTagStart=this.startIndex,this.tagname=name;var impliesClose=!this.options.xmlMode&&openImpliesClose.get(name);if(impliesClose)for(;this.stack.length>0&&impliesClose.has(this.stack[this.stack.length-1]);){var element=this.stack.pop();(_b=(_a2=this.cbs).onclosetag)===null||_b===void 0||_b.call(_a2,element,!0)}this.isVoidElement(name)||(this.stack.push(name),foreignContextElements.has(name)?this.foreignContext.push(!0):htmlIntegrationElements.has(name)&&this.foreignContext.push(!1)),(_d=(_c=this.cbs).onopentagname)===null||_d===void 0||_d.call(_c,name),this.cbs.onopentag&&(this.attribs={})},Parser3.prototype.endOpenTag=function(isImplied){var _a2,_b;this.startIndex=this.openTagStart,this.attribs&&((_b=(_a2=this.cbs).onopentag)===null||_b===void 0||_b.call(_a2,this.tagname,this.attribs,isImplied),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},Parser3.prototype.onopentagend=function(endIndex){this.endIndex=endIndex,this.endOpenTag(!1),this.startIndex=endIndex+1},Parser3.prototype.onclosetag=function(start,endIndex){var _a2,_b,_c,_d,_e,_f;this.endIndex=endIndex;var name=this.getSlice(start,endIndex);if(this.lowerCaseTagNames&&(name=name.toLowerCase()),(foreignContextElements.has(name)||htmlIntegrationElements.has(name))&&this.foreignContext.pop(),this.isVoidElement(name))!this.options.xmlMode&&name==="br"&&((_b=(_a2=this.cbs).onopentagname)===null||_b===void 0||_b.call(_a2,"br"),(_d=(_c=this.cbs).onopentag)===null||_d===void 0||_d.call(_c,"br",{},!0),(_f=(_e=this.cbs).onclosetag)===null||_f===void 0||_f.call(_e,"br",!1));else{var pos=this.stack.lastIndexOf(name);if(pos!==-1)if(this.cbs.onclosetag)for(var count2=this.stack.length-pos;count2--;)this.cbs.onclosetag(this.stack.pop(),count2!==0);else this.stack.length=pos;else!this.options.xmlMode&&name==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=endIndex+1},Parser3.prototype.onselfclosingtag=function(endIndex){this.endIndex=endIndex,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=endIndex+1):this.onopentagend(endIndex)},Parser3.prototype.closeCurrentTag=function(isOpenImplied){var _a2,_b,name=this.tagname;this.endOpenTag(isOpenImplied),this.stack[this.stack.length-1]===name&&((_b=(_a2=this.cbs).onclosetag)===null||_b===void 0||_b.call(_a2,name,!isOpenImplied),this.stack.pop())},Parser3.prototype.onattribname=function(start,endIndex){this.startIndex=start;var name=this.getSlice(start,endIndex);this.attribname=this.lowerCaseAttributeNames?name.toLowerCase():name},Parser3.prototype.onattribdata=function(start,endIndex){this.attribvalue+=this.getSlice(start,endIndex)},Parser3.prototype.onattribentity=function(cp){this.attribvalue+=(0,decode_js_1.fromCodePoint)(cp)},Parser3.prototype.onattribend=function(quote,endIndex){var _a2,_b;this.endIndex=endIndex,(_b=(_a2=this.cbs).onattribute)===null||_b===void 0||_b.call(_a2,this.attribname,this.attribvalue,quote===Tokenizer_js_1.QuoteType.Double?'"':quote===Tokenizer_js_1.QuoteType.Single?"'":quote===Tokenizer_js_1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},Parser3.prototype.getInstructionName=function(value){var index=value.search(reNameEnd),name=index<0?value:value.substr(0,index);return this.lowerCaseTagNames&&(name=name.toLowerCase()),name},Parser3.prototype.ondeclaration=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction("!".concat(name),"!".concat(value))}this.startIndex=endIndex+1},Parser3.prototype.onprocessinginstruction=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction("?".concat(name),"?".concat(value))}this.startIndex=endIndex+1},Parser3.prototype.oncomment=function(start,endIndex,offset){var _a2,_b,_c,_d;this.endIndex=endIndex,(_b=(_a2=this.cbs).oncomment)===null||_b===void 0||_b.call(_a2,this.getSlice(start,endIndex-offset)),(_d=(_c=this.cbs).oncommentend)===null||_d===void 0||_d.call(_c),this.startIndex=endIndex+1},Parser3.prototype.oncdata=function(start,endIndex,offset){var _a2,_b,_c,_d,_e,_f,_g,_h,_j,_k;this.endIndex=endIndex;var value=this.getSlice(start,endIndex-offset);this.options.xmlMode||this.options.recognizeCDATA?((_b=(_a2=this.cbs).oncdatastart)===null||_b===void 0||_b.call(_a2),(_d=(_c=this.cbs).ontext)===null||_d===void 0||_d.call(_c,value),(_f=(_e=this.cbs).oncdataend)===null||_f===void 0||_f.call(_e)):((_h=(_g=this.cbs).oncomment)===null||_h===void 0||_h.call(_g,"[CDATA[".concat(value,"]]")),(_k=(_j=this.cbs).oncommentend)===null||_k===void 0||_k.call(_j)),this.startIndex=endIndex+1},Parser3.prototype.onend=function(){var _a2,_b;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var index=this.stack.length;index>0;this.cbs.onclosetag(this.stack[--index],!0));}(_b=(_a2=this.cbs).onend)===null||_b===void 0||_b.call(_a2)},Parser3.prototype.reset=function(){var _a2,_b,_c,_d;(_b=(_a2=this.cbs).onreset)===null||_b===void 0||_b.call(_a2),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(_d=(_c=this.cbs).onparserinit)===null||_d===void 0||_d.call(_c,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},Parser3.prototype.parseComplete=function(data){this.reset(),this.end(data)},Parser3.prototype.getSlice=function(start,end){for(;start-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var slice3=this.buffers[0].slice(start-this.bufferOffset,end-this.bufferOffset);end-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),slice3+=this.buffers[0].slice(0,end-this.bufferOffset);return slice3},Parser3.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},Parser3.prototype.write=function(chunk){var _a2,_b;if(this.ended){(_b=(_a2=this.cbs).onerror)===null||_b===void 0||_b.call(_a2,new Error(".write() after done!"));return}this.buffers.push(chunk),this.tokenizer.running&&(this.tokenizer.write(chunk),this.writeIndex++)},Parser3.prototype.end=function(chunk){var _a2,_b;if(this.ended){(_b=(_a2=this.cbs).onerror)===null||_b===void 0||_b.call(_a2,new Error(".end() after done!"));return}chunk&&this.write(chunk),this.ended=!0,this.tokenizer.end()},Parser3.prototype.pause=function(){this.tokenizer.pause()},Parser3.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},Parser3.prototype.parseChunk=function(chunk){this.write(chunk)},Parser3.prototype.done=function(chunk){this.end(chunk)},Parser3}();Parser$1.Parser=Parser2;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__setModuleDefault2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar2=commonjsGlobal&&commonjsGlobal.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding2(result,mod,k);return __setModuleDefault2(result,mod),result},__importDefault2=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DomUtils=exports.parseFeed=exports.getFeed=exports.ElementType=exports.Tokenizer=exports.createDomStream=exports.parseDOM=exports.parseDocument=exports.DefaultHandler=exports.DomHandler=exports.Parser=void 0;var Parser_js_1=Parser$1,Parser_js_2=Parser$1;Object.defineProperty(exports,"Parser",{enumerable:!0,get:function(){return Parser_js_2.Parser}});var domhandler_12=lib$1Q,domhandler_2=lib$1Q;Object.defineProperty(exports,"DomHandler",{enumerable:!0,get:function(){return domhandler_2.DomHandler}}),Object.defineProperty(exports,"DefaultHandler",{enumerable:!0,get:function(){return domhandler_2.DomHandler}});function parseDocument(data,options){var handler2=new domhandler_12.DomHandler(void 0,options);return new Parser_js_1.Parser(handler2,options).end(data),handler2.root}__name(parseDocument,"parseDocument"),exports.parseDocument=parseDocument;function parseDOM(data,options){return parseDocument(data,options).children}__name(parseDOM,"parseDOM"),exports.parseDOM=parseDOM;function createDomStream(callback,options,elementCallback){var handler2=new domhandler_12.DomHandler(callback,options,elementCallback);return new Parser_js_1.Parser(handler2,options)}__name(createDomStream,"createDomStream"),exports.createDomStream=createDomStream;var Tokenizer_js_12=Tokenizer;Object.defineProperty(exports,"Tokenizer",{enumerable:!0,get:function(){return __importDefault2(Tokenizer_js_12).default}}),exports.ElementType=__importStar2(lib$1P);var domutils_1=lib$1O,domutils_2=lib$1O;Object.defineProperty(exports,"getFeed",{enumerable:!0,get:function(){return domutils_2.getFeed}});var parseFeedDefaultOptions={xmlMode:!0};function parseFeed(feed,options){return options===void 0&&(options=parseFeedDefaultOptions),(0,domutils_1.getFeed)(parseDOM(feed,options))}__name(parseFeed,"parseFeed"),exports.parseFeed=parseFeed,exports.DomUtils=__importStar2(lib$1O)})(lib$1k);const require$$7={"http://schema.org/":{properties:{additionalType:{subPropertyOf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}}},"http://microformats.org/profile/hcard":{}};Object.defineProperty(MicrodataRdfParser$1,"__esModule",{value:!0});MicrodataRdfParser$1.MicrodataRdfParser=void 0;const htmlparser2_1=lib$1k,readable_stream_1$7=browserExports$1,ItemPropertyHandlerContent_1=ItemPropertyHandlerContent$1,ItemPropertyHandlerNumber_1=ItemPropertyHandlerNumber$1,ItemPropertyHandlerTime_1=ItemPropertyHandlerTime$1,ItemPropertyHandlerUrl_1=ItemPropertyHandlerUrl$1,Util_1$2=Util$2,VOCAB_REGISTRY_DEFAULT=require$$7;class MicrodataRdfParser extends readable_stream_1$7.Transform{constructor(options){super({readableObjectMode:!0}),this.itemScopeStack=[],this.textBufferStack=[],this.isEmittingReferences=!1,this.pendingItemRefsDomain={},this.pendingItemRefsRangeFinalized={},this.pendingItemRefsRangeCollecting={},options=options||{},this.options=options,this.util=new Util_1$2.Util(options.dataFactory,options.baseIRI),this.defaultGraph=options.defaultGraph||this.util.dataFactory.defaultGraph(),this.htmlParseListener=options.htmlParseListener,this.vocabRegistry=options.vocabRegistry||VOCAB_REGISTRY_DEFAULT,this.parser=this.initializeParser(!!options.xmlMode)}import(stream){const output=new readable_stream_1$7.PassThrough({readableObjectMode:!0});stream.on("error",error=>parsed.emit("error",error)),stream.on("data",data=>output.push(data)),stream.on("end",()=>output.push(null));const parsed=output.pipe(new MicrodataRdfParser(this.options));return parsed}_transform(chunk,encoding,callback){this.parser.write(chunk.toString()),callback()}_flush(callback){this.parser.end(),callback()}getItemScope(parent){let parentTagI=this.itemScopeStack.length-(parent?2:1);for(;parentTagI>0&&!this.itemScopeStack[parentTagI];)parentTagI--;return this.itemScopeStack[parentTagI]}getDepth(){return this.itemScopeStack.length}onTagOpen(name,attributes){if(!this.isEmittingReferences){if("id"in attributes){const id=attributes.id;this.pendingItemRefsRangeCollecting[id]={events:[],counter:0,ids:[]}}for(const buffer of Object.values(this.pendingItemRefsRangeCollecting))buffer.counter++,buffer.events.push({type:"open",name,attributes})}this.textBufferStack.push(void 0);let itemScope;if("itemscope"in attributes){let subject2;if(this.emittingReferencesItemScopeIdGenerator)subject2=this.emittingReferencesItemScopeIdGenerator();else{subject2="itemid"in attributes&&this.util.createSubject(attributes.itemid)||this.util.dataFactory.blankNode();for(const buffer of Object.values(this.pendingItemRefsRangeCollecting))buffer.ids.push(subject2)}itemScope={subject:subject2},this.isEmittingReferences&&(itemScope.blockEmission=!0);const parentItemScope=this.getItemScope();parentItemScope&&parentItemScope.vocab&&(itemScope.vocab=parentItemScope.vocab),this.itemScopeStack.push(itemScope)}else itemScope=this.getItemScope(),this.itemScopeStack.push(void 0);if(itemScope){if("itemtype"in attributes)for(const type of this.util.createVocabIris(attributes.itemtype,itemScope,!1))itemScope.vocab||(itemScope.vocab=this.util.deriveVocab(type.value,this.vocabRegistry)),itemScope.blockEmission||this.emitTriple(itemScope.subject,this.util.dataFactory.namedNode(`${Util_1$2.Util.RDF}type`),type);if("lang"in attributes&&(itemScope.language=attributes.lang),"xml:lang"in attributes&&(itemScope.language=attributes["xml:lang"]),"itemscope"in attributes&&!this.isEmittingReferences&&"itemref"in attributes)for(const reference of attributes.itemref.split(/\s+/u))reference in this.pendingItemRefsDomain||(this.pendingItemRefsDomain[reference]=[]),this.pendingItemRefsDomain[reference].push(itemScope),this.tryToEmitReferences(reference,itemScope)}"itemprop"in attributes&&this.handleItemProperties(attributes.itemprop,!1,itemScope,name,attributes),"itemprop-reverse"in attributes&&this.handleItemProperties(attributes["itemprop-reverse"],!0,itemScope,name,attributes)}onText(data){if(!this.isEmittingReferences)for(const buffer of Object.values(this.pendingItemRefsRangeCollecting))buffer.events.push({type:"text",data});for(const textBuffer of this.textBufferStack)textBuffer&&textBuffer.push(data)}onTagClose(){if(!this.isEmittingReferences)for(const[reference,buffer]of Object.entries(this.pendingItemRefsRangeCollecting))buffer.counter--,buffer.events.push({type:"close"}),buffer.counter===0&&(this.pendingItemRefsRangeFinalized[reference]=buffer,delete this.pendingItemRefsRangeCollecting[reference],this.tryToEmitReferences(reference));const itemScope=this.getItemScope(!0);if(itemScope){const depth=this.getDepth();if(itemScope.predicates&&depth in itemScope.predicates)for(const[predicateKey,predicates]of Object.entries(itemScope.predicates[depth])){const object2=this.util.createLiteral(this.textBufferStack[depth].join(""),itemScope);this.emitPredicateTriples(itemScope,predicates,object2,predicateKey==="reverse"),delete itemScope.predicates[depth][predicateKey]}}this.itemScopeStack.pop(),this.textBufferStack.pop()}onEnd(){}initializeParser(xmlMode){return new htmlparser2_1.Parser({onclosetag:()=>{try{this.onTagClose(),this.htmlParseListener&&this.htmlParseListener.onTagClose()}catch(error){this.emit("error",error)}},onend:()=>{try{this.onEnd(),this.htmlParseListener&&this.htmlParseListener.onEnd()}catch(error){this.emit("error",error)}},onopentag:(name,attributes)=>{try{this.onTagOpen(name,attributes),this.htmlParseListener&&this.htmlParseListener.onTagOpen(name,attributes)}catch(error){this.emit("error",error)}},ontext:data=>{try{this.onText(data),this.htmlParseListener&&this.htmlParseListener.onText(data)}catch(error){this.emit("error",error)}}},{decodeEntities:!0,recognizeSelfClosing:!0,xmlMode})}handleItemProperties(itempropValue,reverse3,itemScope,tagName,tagAttributes){const parentItemScope=this.getItemScope(!0);if(parentItemScope){const depth=this.getDepth(),predicates=this.util.createVocabIris(itempropValue,parentItemScope,!0);parentItemScope.predicates||(parentItemScope.predicates={}),parentItemScope.predicates[depth]||(parentItemScope.predicates[depth]={});const predicatesKey=reverse3?"reverse":"forward";parentItemScope.predicates[depth][predicatesKey]=predicates;for(const vocabularyExpansionType of this.util.getVocabularyExpansionType(itempropValue,parentItemScope,this.vocabRegistry))predicates.push(vocabularyExpansionType);if(itemScope&&"itemscope"in tagAttributes)this.emitPredicateTriples(parentItemScope,predicates,itemScope.subject,reverse3),delete parentItemScope.predicates[depth][predicatesKey];else for(const handler2 of MicrodataRdfParser.ITEM_PROPERTY_HANDLERS)if(handler2.canHandle(tagName,tagAttributes)){const object2=handler2.getObject(tagAttributes,this.util,parentItemScope);this.emitPredicateTriples(parentItemScope,predicates,object2,reverse3),delete parentItemScope.predicates[depth][predicatesKey]}parentItemScope.predicates[depth][predicatesKey]&&(this.textBufferStack[depth]=[])}}emitPredicateTriples(itemScope,predicates,object2,reverse3){if(!itemScope.blockEmission)for(const predicate2 of predicates)reverse3?object2.termType!=="Literal"&&this.emitTriple(object2,predicate2,itemScope.subject):this.emitTriple(itemScope.subject,predicate2,object2)}emitTriple(subject2,predicate2,object2){this.push(this.util.dataFactory.quad(subject2,predicate2,object2,this.defaultGraph))}tryToEmitReferences(reference,itemScopeDomain){const range=this.pendingItemRefsRangeFinalized[reference];if(range){let applicableItemScopes;if(itemScopeDomain){applicableItemScopes=[itemScopeDomain];const itemScopeDomainIndex=this.pendingItemRefsDomain[reference].indexOf(itemScopeDomain);this.pendingItemRefsDomain[reference].splice(itemScopeDomainIndex,1)}else applicableItemScopes=this.pendingItemRefsDomain[reference],delete this.pendingItemRefsDomain[reference];if(applicableItemScopes){const itemScopeStackOld=this.itemScopeStack,textBufferStackOld=this.textBufferStack;this.isEmittingReferences=!0;for(const itemScope of applicableItemScopes){this.itemScopeStack=[itemScope],this.textBufferStack=[void 0];const pendingIds=[...range.ids];this.emittingReferencesItemScopeIdGenerator=()=>pendingIds.shift();for(const event of range.events)switch(event.type){case"open":this.onTagOpen(event.name,event.attributes);break;case"text":this.onText(event.data);break;case"close":this.onTagClose();break}}this.emittingReferencesItemScopeIdGenerator=void 0,this.itemScopeStack=itemScopeStackOld,this.textBufferStack=textBufferStackOld,this.isEmittingReferences=!1}}}}__name(MicrodataRdfParser,"MicrodataRdfParser");MicrodataRdfParser$1.MicrodataRdfParser=MicrodataRdfParser;MicrodataRdfParser.ITEM_PROPERTY_HANDLERS=[new ItemPropertyHandlerContent_1.ItemPropertyHandlerContent,new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("a","href"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("area","href"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("audio","src"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("embed","src"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("iframe","src"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("img","src"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("link","href"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("object","data"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("source","src"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("track","src"),new ItemPropertyHandlerUrl_1.ItemPropertyHandlerUrl("video","src"),new ItemPropertyHandlerNumber_1.ItemPropertyHandlerNumber("data","value"),new ItemPropertyHandlerNumber_1.ItemPropertyHandlerNumber("meter","value"),new ItemPropertyHandlerTime_1.ItemPropertyHandlerTime];(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(IItemPropertyHandler,exports),__exportStar(ItemPropertyHandlerContent$1,exports),__exportStar(ItemPropertyHandlerNumber$1,exports),__exportStar(ItemPropertyHandlerTime$1,exports),__exportStar(ItemPropertyHandlerUrl$1,exports),__exportStar(IHtmlParseListener,exports),__exportStar(IItemScope,exports),__exportStar(IVocabRegistry,exports),__exportStar(MicrodataRdfParser$1,exports),__exportStar(Util$2,exports)})(microdataRdfStreamingParser);Object.defineProperty(ActorRdfParseHtmlMicrodata$1,"__esModule",{value:!0});ActorRdfParseHtmlMicrodata$1.ActorRdfParseHtmlMicrodata=void 0;const bus_rdf_parse_html_1$2=lib$1l,microdata_rdf_streaming_parser_1=microdataRdfStreamingParser;class ActorRdfParseHtmlMicrodata extends bus_rdf_parse_html_1$2.ActorRdfParseHtml{constructor(args){super(args)}async test(action){return!0}async run(action){const mediaType=action.headers?action.headers.get("content-type"):null,xmlMode=mediaType==null?void 0:mediaType.includes("xml"),htmlParseListener=new microdata_rdf_streaming_parser_1.MicrodataRdfParser({baseIRI:action.baseIRI,xmlMode});htmlParseListener.on("error",action.error),htmlParseListener.on("data",action.emit);const onTagEndOld=htmlParseListener.onEnd;return htmlParseListener.onEnd=()=>{onTagEndOld.call(htmlParseListener),action.end()},{htmlParseListener}}}__name(ActorRdfParseHtmlMicrodata,"ActorRdfParseHtmlMicrodata");ActorRdfParseHtmlMicrodata$1.ActorRdfParseHtmlMicrodata=ActorRdfParseHtmlMicrodata;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseHtmlMicrodata$1,exports)})(lib$1m);var lib$1j={},ActorRdfParseHtmlRdfa$1={};Object.defineProperty(ActorRdfParseHtmlRdfa$1,"__esModule",{value:!0});ActorRdfParseHtmlRdfa$1.ActorRdfParseHtmlRdfa=void 0;const bus_rdf_parse_html_1$1=lib$1l,rdfa_streaming_parser_1=rdfaStreamingParser;class ActorRdfParseHtmlRdfa extends bus_rdf_parse_html_1$1.ActorRdfParseHtml{constructor(args){super(args)}async test(action){return!0}async run(action){const mediaType=action.headers?action.headers.get("content-type"):null,language2=(action.headers&&action.headers.get("content-language"))??void 0,profile=mediaType&&mediaType.includes("xml")?"xhtml":"html",htmlParseListener=new rdfa_streaming_parser_1.RdfaParser({baseIRI:action.baseIRI,profile,language:language2});htmlParseListener.on("error",action.error),htmlParseListener.on("data",action.emit);const onTagEndOld=htmlParseListener.onEnd;return htmlParseListener.onEnd=()=>{onTagEndOld.call(htmlParseListener),action.end()},{htmlParseListener}}}__name(ActorRdfParseHtmlRdfa,"ActorRdfParseHtmlRdfa");ActorRdfParseHtmlRdfa$1.ActorRdfParseHtmlRdfa=ActorRdfParseHtmlRdfa;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseHtmlRdfa$1,exports)})(lib$1j);var lib$1i={},ActorRdfResolveHypermediaNone$1={},lib$1h={},ActorRdfResolveQuadPatternRdfJsSource$1={},lib$1g={},ActorRdfResolveQuadPattern$1={};Object.defineProperty(ActorRdfResolveQuadPattern$1,"__esModule",{value:!0});ActorRdfResolveQuadPattern$1.ActorRdfResolveQuadPattern=void 0;const core_1$9=lib$2A;class ActorRdfResolveQuadPattern extends core_1$9.Actor{constructor(args){super(args)}}__name(ActorRdfResolveQuadPattern,"ActorRdfResolveQuadPattern");ActorRdfResolveQuadPattern$1.ActorRdfResolveQuadPattern=ActorRdfResolveQuadPattern;var ActorRdfResolveQuadPatternSource$1={};Object.defineProperty(ActorRdfResolveQuadPatternSource$1,"__esModule",{value:!0});ActorRdfResolveQuadPatternSource$1.ActorRdfResolveQuadPatternSource=void 0;const ActorRdfResolveQuadPattern_1=ActorRdfResolveQuadPattern$1;class ActorRdfResolveQuadPatternSource extends ActorRdfResolveQuadPattern_1.ActorRdfResolveQuadPattern{constructor(args){super(args)}async test(action){return!0}async run(action){const source=await this.getSource(action.context,action.pattern);return await this.getOutput(source,action.pattern,action.context)}async getOutput(source,pattern,context2){return{data:source.match(pattern.subject,pattern.predicate,pattern.object,pattern.graph,context2)}}}__name(ActorRdfResolveQuadPatternSource,"ActorRdfResolveQuadPatternSource");ActorRdfResolveQuadPatternSource$1.ActorRdfResolveQuadPatternSource=ActorRdfResolveQuadPatternSource;var utils$1={};Object.defineProperty(utils$1,"__esModule",{value:!0});utils$1.hasContextSingleSourceOfType=utils$1.hasContextSingleSource=utils$1.getContextSourceUrl=utils$1.getContextSourceFirst=utils$1.getContextSource=utils$1.getContextSources=utils$1.getDataSourceContext=utils$1.getDataSourceValue=utils$1.getDataSourceType=utils$1.isDataSourceRawType=void 0;const context_entries_1$j=lib$2x;function isDataSourceRawType(dataSource){return typeof dataSource=="string"||"match"in dataSource}__name(isDataSourceRawType,"isDataSourceRawType");utils$1.isDataSourceRawType=isDataSourceRawType;function getDataSourceType(dataSource){return typeof dataSource=="string"?"":"match"in dataSource?"rdfjsSource":dataSource.type}__name(getDataSourceType,"getDataSourceType");utils$1.getDataSourceType=getDataSourceType;function getDataSourceValue(dataSource){return isDataSourceRawType(dataSource)?dataSource:dataSource.value}__name(getDataSourceValue,"getDataSourceValue");utils$1.getDataSourceValue=getDataSourceValue;function getDataSourceContext(dataSource,context2){return typeof dataSource=="string"||"match"in dataSource||!dataSource.context?context2:context2.merge(dataSource.context)}__name(getDataSourceContext,"getDataSourceContext");utils$1.getDataSourceContext=getDataSourceContext;function getContextSources(context2){return context2.get(context_entries_1$j.KeysRdfResolveQuadPattern.sources)}__name(getContextSources,"getContextSources");utils$1.getContextSources=getContextSources;function getContextSource(context2){return context2.get(context_entries_1$j.KeysRdfResolveQuadPattern.source)}__name(getContextSource,"getContextSource");utils$1.getContextSource=getContextSource;function getContextSourceFirst(context2){if(context2.has(context_entries_1$j.KeysRdfResolveQuadPattern.source))return context2.get(context_entries_1$j.KeysRdfResolveQuadPattern.source);const datasources=context2.get(context_entries_1$j.KeysRdfResolveQuadPattern.sources);if((datasources==null?void 0:datasources.length)===1)return datasources[0]}__name(getContextSourceFirst,"getContextSourceFirst");utils$1.getContextSourceFirst=getContextSourceFirst;function getContextSourceUrl(source){if(source){let fileUrl=getDataSourceValue(source);if(typeof fileUrl=="string"){const hashPosition=fileUrl.indexOf("#");return hashPosition>=0&&(fileUrl=fileUrl.slice(0,hashPosition)),fileUrl}}}__name(getContextSourceUrl,"getContextSourceUrl");utils$1.getContextSourceUrl=getContextSourceUrl;function hasContextSingleSource(context2){const source=getContextSource(context2);return!!(source&&(isDataSourceRawType(source)||source.value))}__name(hasContextSingleSource,"hasContextSingleSource");utils$1.hasContextSingleSource=hasContextSingleSource;function hasContextSingleSourceOfType(requiredType,context2){const source=getContextSource(context2);return!!(source&&getDataSourceType(source)===requiredType&&getDataSourceValue(source))}__name(hasContextSingleSourceOfType,"hasContextSingleSourceOfType");utils$1.hasContextSingleSourceOfType=hasContextSingleSourceOfType;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveQuadPattern$1,exports),__exportStar(ActorRdfResolveQuadPatternSource$1,exports),__exportStar(utils$1,exports)})(lib$1g);var RdfJsQuadSource$1={};Object.defineProperty(RdfJsQuadSource$1,"__esModule",{value:!0});RdfJsQuadSource$1.RdfJsQuadSource=void 0;const metadata_1$b=lib$2h,asynciterator_1$n=asynciterator,rdf_data_factory_1$p=rdfDataFactory,rdf_terms_1$a=rdfTerms,DF$i=new rdf_data_factory_1$p.DataFactory;class RdfJsQuadSource{constructor(source){this.source=source}static nullifyVariables(term,quotedTripleFiltering){return!term||term.termType==="Variable"||!quotedTripleFiltering&&term.termType==="Quad"&&(0,rdf_terms_1$a.someTermsNested)(term,value=>value.termType==="Variable")?void 0:term}static hasDuplicateVariables(pattern){const variables2=(0,rdf_terms_1$a.filterTermsNested)(pattern,term=>term.termType==="Variable");return variables2.length>1&&(0,rdf_terms_1$a.uniqTerms)(variables2).length<variables2.length}match(subject2,predicate2,object2,graph){var _a2;const quotedTripleFiltering=!!((_a2=this.source.features)!=null&&_a2.quotedTripleFiltering),rawStream=this.source.match(RdfJsQuadSource.nullifyVariables(subject2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(predicate2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(object2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(graph,quotedTripleFiltering));let it=(0,asynciterator_1$n.wrap)(rawStream,{autoStart:!1});const pattern=DF$i.quad(subject2,predicate2,object2,graph);return!quotedTripleFiltering&&(0,rdf_terms_1$a.someTerms)(pattern,term=>term.termType==="Quad")&&(it=it.filter(quad=>(0,rdf_terms_1$a.matchPatternComplete)(quad,pattern))),this.setMetadata(it,subject2,predicate2,object2,graph).catch(error=>it.destroy(error)),it}async setMetadata(it,subject2,predicate2,object2,graph){var _a2;const quotedTripleFiltering=!!((_a2=this.source.features)!=null&&_a2.quotedTripleFiltering);let cardinality;if(this.source.countQuads)cardinality=await this.source.countQuads(RdfJsQuadSource.nullifyVariables(subject2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(predicate2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(object2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(graph,quotedTripleFiltering));else{let i=0;cardinality=await new Promise((resolve2,reject)=>{const matches2=this.source.match(RdfJsQuadSource.nullifyVariables(subject2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(predicate2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(object2,quotedTripleFiltering),RdfJsQuadSource.nullifyVariables(graph,quotedTripleFiltering));matches2.on("error",reject),matches2.on("end",()=>resolve2(i)),matches2.on("data",()=>i++)})}const pattern=DF$i.quad(subject2,predicate2,object2,graph),wouldRequirePostFiltering=!quotedTripleFiltering&&(0,rdf_terms_1$a.someTerms)(pattern,term=>term.termType==="Quad")||RdfJsQuadSource.hasDuplicateVariables(pattern);it.setProperty("metadata",{state:new metadata_1$b.MetadataValidationState,cardinality:{type:wouldRequirePostFiltering?"estimate":"exact",value:cardinality},canContainUndefs:!1})}}__name(RdfJsQuadSource,"RdfJsQuadSource");RdfJsQuadSource$1.RdfJsQuadSource=RdfJsQuadSource;Object.defineProperty(ActorRdfResolveQuadPatternRdfJsSource$1,"__esModule",{value:!0});ActorRdfResolveQuadPatternRdfJsSource$1.ActorRdfResolveQuadPatternRdfJsSource=void 0;const bus_rdf_resolve_quad_pattern_1$5=lib$1g,RdfJsQuadSource_1=RdfJsQuadSource$1;class ActorRdfResolveQuadPatternRdfJsSource extends bus_rdf_resolve_quad_pattern_1$5.ActorRdfResolveQuadPatternSource{constructor(args){super(args)}async test(action){if(!(0,bus_rdf_resolve_quad_pattern_1$5.hasContextSingleSourceOfType)("rdfjsSource",action.context))throw new Error(`${this.name} requires a single source with an rdfjsSource to be present in the context.`);const source=(0,bus_rdf_resolve_quad_pattern_1$5.getContextSource)(action.context);if(!source||typeof source=="string"||!("match"in source)&&!source.value.match)throw new Error(`${this.name} received an invalid rdfjsSource.`);return!0}async getSource(context2){const source=(0,bus_rdf_resolve_quad_pattern_1$5.getContextSource)(context2);return new RdfJsQuadSource_1.RdfJsQuadSource("match"in source?source:source.value)}}__name(ActorRdfResolveQuadPatternRdfJsSource,"ActorRdfResolveQuadPatternRdfJsSource");ActorRdfResolveQuadPatternRdfJsSource$1.ActorRdfResolveQuadPatternRdfJsSource=ActorRdfResolveQuadPatternRdfJsSource;var IRdfJsSourceExtended={};Object.defineProperty(IRdfJsSourceExtended,"__esModule",{value:!0});(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveQuadPatternRdfJsSource$1,exports),__exportStar(IRdfJsSourceExtended,exports),__exportStar(RdfJsQuadSource$1,exports)})(lib$1h);var lib$1f={},ActorRdfResolveHypermedia$1={};Object.defineProperty(ActorRdfResolveHypermedia$1,"__esModule",{value:!0});ActorRdfResolveHypermedia$1.ActorRdfResolveHypermedia=void 0;const core_1$8=lib$2A;class ActorRdfResolveHypermedia extends core_1$8.Actor{constructor(args,sourceType){super(args),this.sourceType=sourceType}async test(action){if(action.forceSourceType&&this.sourceType!==action.forceSourceType)throw new Error(`Actor ${this.name} is not able to handle source type ${action.forceSourceType}.`);return this.testMetadata(action)}}__name(ActorRdfResolveHypermedia,"ActorRdfResolveHypermedia");ActorRdfResolveHypermedia$1.ActorRdfResolveHypermedia=ActorRdfResolveHypermedia;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermedia$1,exports)})(lib$1f);var rdfStoreStream={},rdfStores={},DatasetCoreWrapper={},RdfStore={},TermDictionaryNumberRecordFullTerms$1={};Object.defineProperty(TermDictionaryNumberRecordFullTerms$1,"__esModule",{value:!0});TermDictionaryNumberRecordFullTerms$1.TermDictionaryNumberRecordFullTerms=void 0;const rdf_data_factory_1$o=rdfDataFactory,rdf_string_1$c=rdfString;class TermDictionaryNumberRecordFullTerms{constructor(dataFactory=new rdf_data_factory_1$o.DataFactory){this.lastId=0,this.dictionary={},this.reverseDictionary={},this.features={quotedTriples:!1},this.dataFactory=dataFactory}encode(term){const key=(0,rdf_string_1$c.termToString)(term);let encoded=this.dictionary[key];return encoded===void 0&&(encoded=this.lastId++,this.dictionary[key]=encoded,this.reverseDictionary[encoded]=term),encoded}encodeOptional(term){const key=(0,rdf_string_1$c.termToString)(term);return this.dictionary[key]}decode(encoding){const string=this.reverseDictionary[encoding];if(string===void 0)throw new Error(`The value ${encoding} is not present in this dictionary`);return string}*encodings(){for(const key of Object.keys(this.reverseDictionary))yield Number.parseInt(key,10)}findQuotedTriples(quotedTriplePattern){throw new Error("findQuotedTriples is not supported")}findQuotedTriplesEncoded(quotedTriplePattern){throw new Error("findQuotedTriplesEncoded is not supported")}}__name(TermDictionaryNumberRecordFullTerms,"TermDictionaryNumberRecordFullTerms");TermDictionaryNumberRecordFullTerms$1.TermDictionaryNumberRecordFullTerms=TermDictionaryNumberRecordFullTerms;var TermDictionaryQuotedIndexed$1={},RdfStoreIndexNestedMap$1={},OrderUtils={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.arePatternsQuoted=exports.quadHasVariables=exports.quadToPattern=exports.encodeOptionalTerms=exports.orderQuadComponents=exports.getComponentOrderScore=exports.getBestIndex=exports.QUAD_TERM_NAMES_INVERSE=void 0;const rdf_terms_12=rdfTerms;exports.QUAD_TERM_NAMES_INVERSE=Object.fromEntries(rdf_terms_12.QUAD_TERM_NAMES.map((value,key)=>[value,key]));function getBestIndex(componentOrders,quadPattern){if(componentOrders.length===1||quadPattern.every(term=>term!==void 0))return 0;const definedQuadComponentNames=[];for(let quadComponentId=0;quadComponentId<rdf_terms_12.QUAD_TERM_NAMES.length;quadComponentId++)quadPattern[quadComponentId]&&definedQuadComponentNames.push(rdf_terms_12.QUAD_TERM_NAMES[quadComponentId]);return componentOrders.map((componentOrder,index)=>({score:getComponentOrderScore(componentOrder,definedQuadComponentNames),index})).sort((scoredLeft,scoredRight)=>scoredRight.score-scoredLeft.score)[0].index}__name(getBestIndex,"getBestIndex"),exports.getBestIndex=getBestIndex;function getComponentOrderScore(componentOrder,partialComponentOrder){return componentOrder.map((order,i)=>partialComponentOrder.includes(order)?componentOrder.length-i:0).reduce((acc,add)=>acc+add,0)}__name(getComponentOrderScore,"getComponentOrderScore"),exports.getComponentOrderScore=getComponentOrderScore;function orderQuadComponents(desiredComponentOrder,quadPattern){return desiredComponentOrder.map(desiredComponent=>{const desiredComponentIndex=exports.QUAD_TERM_NAMES_INVERSE[desiredComponent];return quadPattern[desiredComponentIndex]})}__name(orderQuadComponents,"orderQuadComponents"),exports.orderQuadComponents=orderQuadComponents;function encodeOptionalTerms(terms,dictionary){const encodedTerms=terms.map(term=>{if(term){if(term.termType==="Quad"&&quadHasVariables(term))return;const encodedTerm=dictionary.encodeOptional(term);return encodedTerm===void 0?"none":encodedTerm}return term});if(!encodedTerms.includes("none"))return encodedTerms}__name(encodeOptionalTerms,"encodeOptionalTerms"),exports.encodeOptionalTerms=encodeOptionalTerms;function quadToPattern(subject2,predicate2,object2,graph,quotedPatterns){let requireQuotedTripleFiltering=!1;return[[subject2||void 0,predicate2||void 0,object2||void 0,graph||void 0].map(term=>{if(term){if(term.termType==="Variable")return;if(term.termType==="Quad"){if(quotedPatterns)return term;requireQuotedTripleFiltering=!0;return}}return term}),requireQuotedTripleFiltering]}__name(quadToPattern,"quadToPattern"),exports.quadToPattern=quadToPattern;function quadHasVariables(currentTerm){for(const component of rdf_terms_12.QUAD_TERM_NAMES){const subTerm=currentTerm[component];if(subTerm.termType==="Variable"||subTerm.termType==="Quad"&&quadHasVariables(subTerm))return!0}return!1}__name(quadHasVariables,"quadHasVariables"),exports.quadHasVariables=quadHasVariables;function arePatternsQuoted(terms){return terms.map(term=>(term==null?void 0:term.termType)==="Quad"&&quadHasVariables(term))}__name(arePatternsQuoted,"arePatternsQuoted"),exports.arePatternsQuoted=arePatternsQuoted})(OrderUtils);Object.defineProperty(RdfStoreIndexNestedMap$1,"__esModule",{value:!0});RdfStoreIndexNestedMap$1.RdfStoreIndexNestedMap=void 0;const OrderUtils_1$7=OrderUtils;class RdfStoreIndexNestedMap{constructor(options){this.features={quotedTripleFiltering:!1},this.dictionary=options.dictionary,this.nestedMap=new Map}set(terms,value){const map0=this.nestedMap;let map1=map0.get(terms[0]);map1||(map1=new Map,map0.set(terms[0],map1));let map2=map1.get(terms[1]);map2||(map2=new Map,map1.set(terms[1],map2));let map3=map2.get(terms[2]);map3||(map3=new Map,map2.set(terms[2],map3));const contained=map3.has(terms[3]);return contained||map3.set(terms[3],value),!contained}remove(terms){const map0=this.nestedMap,map1=map0.get(terms[0]);if(!map1)return!1;const map2=map1.get(terms[1]);if(!map2)return!1;const map3=map2.get(terms[2]);if(!map3)return!1;const ret=map3.delete(terms[3]);return ret&&map3.size===0&&(map2.delete(terms[2]),map2.size===0&&(map1.delete(terms[1]),map1.size===0&&map0.delete(terms[0]))),ret}get(key){const encoded=(0,OrderUtils_1$7.encodeOptionalTerms)(key,this.dictionary);if(!(!encoded||encoded.includes(void 0)))return this.getEncoded(encoded)}getEncoded(ids){const map1=this.nestedMap.get(ids[0]);if(!map1)return;const map2=map1.get(ids[1]);if(!map2)return;const map3=map2.get(ids[2]);if(map3)return map3.get(ids[3])}*find(terms){const ids=(0,OrderUtils_1$7.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return;const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms;let partialQuad0,partialQuad1,partialQuad2,partialQuad3,map1,map2,map3;const map0=this.nestedMap,map0Keys=id0!==void 0?map0.has(id0)?[id0]:[]:map0.keys();for(const key1 of map0Keys){map1=map0.get(key1),partialQuad0=term0||this.dictionary.decode(key1);const map1Keys=id1!==void 0?map1.has(id1)?[id1]:[]:map1.keys();for(const key2 of map1Keys){map2=map1.get(key2),partialQuad1=term1||this.dictionary.decode(key2);const map2Keys=id2!==void 0?map2.has(id2)?[id2]:[]:map2.keys();for(const key3 of map2Keys){map3=map2.get(key3),partialQuad2=term2||this.dictionary.decode(key3);const map3Keys=id3!==void 0?map3.has(id3)?[id3]:[]:map3.keys();for(const key4 of map3Keys)partialQuad3=term3||this.dictionary.decode(key4),yield[partialQuad0,partialQuad1,partialQuad2,partialQuad3]}}}}*findEncoded(ids,terms){const[id0,id1,id2,id3]=ids;let map1,map2,map3;const map0=this.nestedMap,map0Keys=id0!==void 0?map0.has(id0)?[id0]:[]:map0.keys();for(const key1 of map0Keys){map1=map0.get(key1);const map1Keys=id1!==void 0?map1.has(id1)?[id1]:[]:map1.keys();for(const key2 of map1Keys){map2=map1.get(key2);const map2Keys=id2!==void 0?map2.has(id2)?[id2]:[]:map2.keys();for(const key3 of map2Keys){map3=map2.get(key3);const map3Keys=id3!==void 0?map3.has(id3)?[id3]:[]:map3.keys();for(const key4 of map3Keys)yield[key1,key2,key3,key4]}}}}count(terms){let count2=0;const ids=(0,OrderUtils_1$7.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return 0;const id0=ids[0],id1=ids[1],id2=ids[2],id3=ids[3];let map1,map2,map3;const map0=this.nestedMap,map0Keys=id0!==void 0?map0.has(id0)?[id0]:[]:map0.keys();for(const key1 of map0Keys){map1=map0.get(key1);const map1Keys=id1!==void 0?map1.has(id1)?[id1]:[]:map1.keys();for(const key2 of map1Keys){map2=map1.get(key2);const map2Keys=id2!==void 0?map2.has(id2)?[id2]:[]:map2.keys();for(const key3 of map2Keys)map3=map2.get(key3),id3!==void 0?map3.has(id3)&&count2++:count2+=map3.size}}return count2}}__name(RdfStoreIndexNestedMap,"RdfStoreIndexNestedMap");RdfStoreIndexNestedMap$1.RdfStoreIndexNestedMap=RdfStoreIndexNestedMap;Object.defineProperty(TermDictionaryQuotedIndexed$1,"__esModule",{value:!0});TermDictionaryQuotedIndexed$1.TermDictionaryQuotedIndexed=void 0;const rdf_data_factory_1$n=rdfDataFactory,RdfStoreIndexNestedMap_1$1=RdfStoreIndexNestedMap$1,OrderUtils_1$6=OrderUtils;class TermDictionaryQuotedIndexed{constructor(rawTermDictionary,dataFactory=new rdf_data_factory_1$n.DataFactory){this.quotedTriplesDictionary=[],this.features={quotedTriples:!0},this.plainTermDictionary=rawTermDictionary;const subIndexOpts={indexCombinations:[],indexConstructor:void 0,dictionary:this,dataFactory};this.quotedTriplesReverseDictionaries=[new RdfStoreIndexNestedMap_1$1.RdfStoreIndexNestedMap(subIndexOpts),new RdfStoreIndexNestedMap_1$1.RdfStoreIndexNestedMap(subIndexOpts),new RdfStoreIndexNestedMap_1$1.RdfStoreIndexNestedMap(subIndexOpts)],this.dataFactory=dataFactory}encode(term){return term.termType==="Quad"?this.encodeQuotedTriple(term,!1):this.plainTermDictionary.encode(term)}encodeQuotedTriple(quad,optional){if(quad.graph.termType!=="DefaultGraph")throw new Error("Encoding of quoted quads outside of the default graph is not allowed");const encodedTripleOptional=(0,OrderUtils_1$6.encodeOptionalTerms)([quad.subject,quad.predicate,quad.object,quad.graph],this),id=encodedTripleOptional&&encodedTripleOptional.every(encoded=>encoded!==void 0)?this.quotedTriplesReverseDictionaries[0].getEncoded(encodedTripleOptional):void 0;if(id!==void 0||optional)return id===void 0?void 0:TermDictionaryQuotedIndexed.BITMASK|id;const encodedTriple=[this.encode(quad.subject),this.encode(quad.predicate),this.encode(quad.object)],encodingBase=this.quotedTriplesDictionary.length+1;this.quotedTriplesDictionary.push(encodedTriple);const encodedGraph=this.encode(this.dataFactory.defaultGraph());return this.quotedTriplesReverseDictionaries[0].set([encodedTriple[0],encodedTriple[1],encodedTriple[2],encodedGraph],encodingBase),this.quotedTriplesReverseDictionaries[1].set([encodedTriple[1],encodedTriple[2],encodedTriple[0],encodedGraph],encodingBase),this.quotedTriplesReverseDictionaries[2].set([encodedTriple[2],encodedTriple[0],encodedTriple[1],encodedGraph],encodingBase),TermDictionaryQuotedIndexed.BITMASK|encodingBase}encodeOptional(term){return term.termType==="Quad"?this.encodeQuotedTriple(term,!0):this.plainTermDictionary.encodeOptional(term)}decode(encoding){if(TermDictionaryQuotedIndexed.BITMASK&encoding){const encodingBase=(~TermDictionaryQuotedIndexed.BITMASK&encoding)-1;if(encodingBase>=this.quotedTriplesDictionary.length)throw new Error(`The value ${encoding} is not present in the quoted triples range of the dictionary`);const encodedTerms=this.quotedTriplesDictionary[encodingBase];return this.dataFactory.quad(this.decode(encodedTerms[0]),this.decode(encodedTerms[1]),this.decode(encodedTerms[2]))}return this.plainTermDictionary.decode(encoding)}*encodings(){for(const encoding of this.plainTermDictionary.encodings())yield encoding;for(const encoding of this.quotedTriplesDictionary.keys())yield TermDictionaryQuotedIndexed.BITMASK|1+encoding}*findQuotedTriples(quotedTriplePattern){for(const termEncoded of this.findQuotedTriplesEncoded(quotedTriplePattern))yield this.decode(termEncoded)}*findQuotedTriplesEncoded(quotedTriplePattern){const[patternIn,requireQuotedTripleFiltering]=(0,OrderUtils_1$6.quadToPattern)(quotedTriplePattern.subject,quotedTriplePattern.predicate,quotedTriplePattern.object,quotedTriplePattern.graph,!0);for(const termS of this.patternToIterable(patternIn[0]))for(const termP of this.patternToIterable(patternIn[1]))for(const termO of this.patternToIterable(patternIn[2]))for(const termG of this.patternToIterable(patternIn[3]))if(termS&&termP||!termP&&!termO){const pattern=[termS,termP,termO,termG];for(const termEncoded of this.quotedTriplesReverseDictionaries[0].findEncoded(pattern,patternIn))yield TermDictionaryQuotedIndexed.BITMASK|this.quotedTriplesReverseDictionaries[0].getEncoded(termEncoded)}else if(!termS&&termP){const pattern=[termP,termO,termS,termG];for(const termEncoded of this.quotedTriplesReverseDictionaries[1].findEncoded(pattern,patternIn))yield TermDictionaryQuotedIndexed.BITMASK|this.quotedTriplesReverseDictionaries[1].getEncoded(termEncoded)}else{const pattern=[termO,termS,termP,termG];for(const termEncoded of this.quotedTriplesReverseDictionaries[2].findEncoded(pattern,patternIn))yield TermDictionaryQuotedIndexed.BITMASK|this.quotedTriplesReverseDictionaries[2].getEncoded(termEncoded)}}*patternToIterable(patternTerm){if((patternTerm==null?void 0:patternTerm.termType)==="Quad"){yield*this.findQuotedTriplesEncoded(patternTerm);return}if(patternTerm===void 0){yield void 0;return}const enc=this.encodeOptional(patternTerm);enc!==void 0&&(yield enc)}}__name(TermDictionaryQuotedIndexed,"TermDictionaryQuotedIndexed");TermDictionaryQuotedIndexed.BITMASK=1<<31;TermDictionaryQuotedIndexed$1.TermDictionaryQuotedIndexed=TermDictionaryQuotedIndexed;var RdfStoreIndexNestedMapQuoted$1={};Object.defineProperty(RdfStoreIndexNestedMapQuoted$1,"__esModule",{value:!0});RdfStoreIndexNestedMapQuoted$1.RdfStoreIndexNestedMapQuoted=void 0;const OrderUtils_1$5=OrderUtils,RdfStoreIndexNestedMap_1=RdfStoreIndexNestedMap$1;class RdfStoreIndexNestedMapQuoted extends RdfStoreIndexNestedMap_1.RdfStoreIndexNestedMap{constructor(options){super(options),this.features={quotedTripleFiltering:!0}}*getQuotedPatternKeys(map2,term){for(const quotedTripleEncoded of this.dictionary.findQuotedTriplesEncoded(term))map2.has(quotedTripleEncoded)&&(yield quotedTripleEncoded)}*find(terms){const ids=(0,OrderUtils_1$5.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return;const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms,[quotedTerm0,quotedTerm1,quotedTerm2,quotedTerm3]=(0,OrderUtils_1$5.arePatternsQuoted)(terms);let partialQuad0,partialQuad1,partialQuad2,partialQuad3,map1,map2,map3;const map0=this.nestedMap,map0Keys=term0!==void 0?quotedTerm0?this.getQuotedPatternKeys(map0,term0):map0.has(id0)?[id0]:[]:map0.keys();for(const key1 of map0Keys){map1=map0.get(key1),partialQuad0=!quotedTerm0&&term0?term0:this.dictionary.decode(key1);const map1Keys=term1!==void 0?quotedTerm1?this.getQuotedPatternKeys(map1,term1):map1.has(id1)?[id1]:[]:map1.keys();for(const key2 of map1Keys){map2=map1.get(key2),partialQuad1=!quotedTerm1&&term1?term1:this.dictionary.decode(key2);const map2Keys=term2!==void 0?quotedTerm2?this.getQuotedPatternKeys(map2,term2):map2.has(id2)?[id2]:[]:map2.keys();for(const key3 of map2Keys){map3=map2.get(key3),partialQuad2=!quotedTerm2&&term2?term2:this.dictionary.decode(key3);const map3Keys=term3!==void 0?quotedTerm3?this.getQuotedPatternKeys(map3,term3):map3.has(id3)?[id3]:[]:map3.keys();for(const key4 of map3Keys)partialQuad3=!quotedTerm3&&term3?term3:this.dictionary.decode(key4),yield[partialQuad0,partialQuad1,partialQuad2,partialQuad3]}}}}*findEncoded(ids,terms){const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms,[quotedTerm0,quotedTerm1,quotedTerm2,quotedTerm3]=(0,OrderUtils_1$5.arePatternsQuoted)(terms);let map1,map2,map3;const map0=this.nestedMap,map0Keys=term0!==void 0?quotedTerm0?this.getQuotedPatternKeys(map0,term0):map0.has(id0)?[id0]:[]:map0.keys();for(const key1 of map0Keys){map1=map0.get(key1);const map1Keys=term1!==void 0?quotedTerm1?this.getQuotedPatternKeys(map1,term1):map1.has(id1)?[id1]:[]:map1.keys();for(const key2 of map1Keys){map2=map1.get(key2);const map2Keys=term2!==void 0?quotedTerm2?this.getQuotedPatternKeys(map2,term2):map2.has(id2)?[id2]:[]:map2.keys();for(const key3 of map2Keys){map3=map2.get(key3);const map3Keys=term3!==void 0?quotedTerm3?this.getQuotedPatternKeys(map3,term3):map3.has(id3)?[id3]:[]:map3.keys();for(const key4 of map3Keys)yield[Number.parseInt(key1,10),Number.parseInt(key2,10),Number.parseInt(key3,10),Number.parseInt(key4,10)]}}}}count(terms){let count2=0;const ids=(0,OrderUtils_1$5.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return 0;const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms,[quotedTerm0,quotedTerm1,quotedTerm2,quotedTerm3]=(0,OrderUtils_1$5.arePatternsQuoted)(terms);let map1,map2,map3;const map0=this.nestedMap,map0Keys=term0!==void 0?quotedTerm0?this.getQuotedPatternKeys(map0,term0):map0.has(id0)?[id0]:[]:map0.keys();for(const key1 of map0Keys){map1=map0.get(key1);const map1Keys=term1!==void 0?quotedTerm1?this.getQuotedPatternKeys(map1,term1):map1.has(id1)?[id1]:[]:map1.keys();for(const key2 of map1Keys){map2=map1.get(key2);const map2Keys=term2!==void 0?quotedTerm2?this.getQuotedPatternKeys(map2,term2):map2.has(id2)?[id2]:[]:map2.keys();for(const key3 of map2Keys)map3=map2.get(key3),term3!==void 0?quotedTerm3?count2+=[...this.getQuotedPatternKeys(map3,term3)].length:map3.has(id3)&&count2++:count2+=map3.size}}return count2}}__name(RdfStoreIndexNestedMapQuoted,"RdfStoreIndexNestedMapQuoted");RdfStoreIndexNestedMapQuoted$1.RdfStoreIndexNestedMapQuoted=RdfStoreIndexNestedMapQuoted;var hasRequiredRdfStore;function requireRdfStore(){if(hasRequiredRdfStore)return RdfStore;hasRequiredRdfStore=1,Object.defineProperty(RdfStore,"__esModule",{value:!0}),RdfStore.RdfStore=void 0;const asynciterator_12=asynciterator,rdf_data_factory_12=rdfDataFactory,rdf_terms_12=rdfTerms,DatasetCoreWrapper_1=requireDatasetCoreWrapper(),TermDictionaryNumberRecordFullTerms_1=TermDictionaryNumberRecordFullTerms$1,TermDictionaryQuotedIndexed_1=TermDictionaryQuotedIndexed$1,RdfStoreIndexNestedMapQuoted_1=RdfStoreIndexNestedMapQuoted$1,OrderUtils_12=OrderUtils;let RdfStore$1=__name(class RdfStore2{constructor(options){this.features={quotedTripleFiltering:!0},this._size=0,this.options=options,this.dataFactory=options.dataFactory,this.dictionary=options.dictionary,this.indexesWrapped=RdfStore2.constructIndexesWrapped(options),this.indexesWrappedComponentOrders=this.indexesWrapped.map(indexThis=>indexThis.componentOrder)}static createDefault(){return new RdfStore2({indexCombinations:RdfStore2.DEFAULT_INDEX_COMBINATIONS,indexConstructor:subOptions=>new RdfStoreIndexNestedMapQuoted_1.RdfStoreIndexNestedMapQuoted(subOptions),dictionary:new TermDictionaryQuotedIndexed_1.TermDictionaryQuotedIndexed(new TermDictionaryNumberRecordFullTerms_1.TermDictionaryNumberRecordFullTerms),dataFactory:new rdf_data_factory_12.DataFactory})}static constructIndexesWrapped(options){const indexes=[];if(options.indexCombinations.length===0)throw new Error("At least one index combination is required");for(const componentOrder of options.indexCombinations){if(!RdfStore2.isCombinationValid(componentOrder))throw new Error(`Invalid index combination: ${componentOrder}`);indexes.push({index:options.indexConstructor(options),componentOrder,componentOrderInverse:Object.fromEntries(componentOrder.map((value,key)=>[value,key]))})}return indexes}static isCombinationValid(combination){for(const quadTermName of rdf_terms_12.QUAD_TERM_NAMES)if(!combination.includes(quadTermName))return!1;return combination.length===4}get size(){return this._size}addQuad(quad){const quadEncoded=[this.dictionary.encode(quad.subject),this.dictionary.encode(quad.predicate),this.dictionary.encode(quad.object),this.dictionary.encode(quad.graph)];let newQuad=!1;for(const indexWrapped of this.indexesWrapped)newQuad=indexWrapped.index.set((0,OrderUtils_12.orderQuadComponents)(indexWrapped.componentOrder,quadEncoded),!0);return newQuad?(this._size++,!0):!1}removeQuad(quad){const quadEncoded=[this.dictionary.encodeOptional(quad.subject),this.dictionary.encodeOptional(quad.predicate),this.dictionary.encodeOptional(quad.object),this.dictionary.encodeOptional(quad.graph)];if(quadEncoded.includes(void 0))return!1;let wasPresent=!1;for(const indexWrapped of this.indexesWrapped)if(wasPresent=indexWrapped.index.remove((0,OrderUtils_12.orderQuadComponents)(indexWrapped.componentOrder,quadEncoded)),!wasPresent)break;return wasPresent?(this._size--,!0):!1}remove(stream){return stream.on("data",quad=>this.removeQuad(quad)),stream}removeMatches(subject2,predicate2,object2,graph){return this.remove(this.match(subject2,predicate2,object2,graph))}deleteGraph(graph){return typeof graph=="string"&&(graph=this.dataFactory.namedNode(graph)),this.removeMatches(void 0,void 0,void 0,graph)}import(stream){return stream.on("data",quad=>this.addQuad(quad)),stream}*readQuads(subject2,predicate2,object2,graph){const indexesSupportQuotedPatterns=!!this.dictionary.features.quotedTriples&&Object.values(this.indexesWrapped).every(wrapped=>wrapped.index.features.quotedTripleFiltering),[quadComponents,requireQuotedTripleFiltering]=(0,OrderUtils_12.quadToPattern)(subject2,predicate2,object2,graph,indexesSupportQuotedPatterns),indexWrapped=this.indexesWrapped[(0,OrderUtils_12.getBestIndex)(this.indexesWrappedComponentOrders,quadComponents)],quadComponentsOrdered=(0,OrderUtils_12.orderQuadComponents)(indexWrapped.componentOrder,quadComponents);for(const decomposedQuad of indexWrapped.index.find(quadComponentsOrdered)){const quad=this.dataFactory.quad(decomposedQuad[indexWrapped.componentOrderInverse.subject],decomposedQuad[indexWrapped.componentOrderInverse.predicate],decomposedQuad[indexWrapped.componentOrderInverse.object],decomposedQuad[indexWrapped.componentOrderInverse.graph]);requireQuotedTripleFiltering?(0,rdf_terms_12.matchPattern)(quad,subject2,predicate2,object2,graph)&&(yield quad):yield quad}}getQuads(subject2,predicate2,object2,graph){return[...this.readQuads(subject2,predicate2,object2,graph)]}match(subject2,predicate2,object2,graph){return(0,asynciterator_12.wrap)(this.readQuads(subject2,predicate2,object2,graph))}countQuads(subject2,predicate2,object2,graph){const indexesSupportQuotedPatterns=!!this.dictionary.features.quotedTriples&&Object.values(this.indexesWrapped).every(wrapped=>wrapped.index.features.quotedTripleFiltering),[quadComponents]=(0,OrderUtils_12.quadToPattern)(subject2,predicate2,object2,graph,indexesSupportQuotedPatterns);if(quadComponents.every(quadComponent=>quadComponent===void 0))return this.size;const indexWrapped=this.indexesWrapped[(0,OrderUtils_12.getBestIndex)(this.indexesWrappedComponentOrders,quadComponents)],quadComponentsOrdered=(0,OrderUtils_12.orderQuadComponents)(indexWrapped.componentOrder,quadComponents);return indexWrapped.index.count(quadComponentsOrdered)}asDataset(){return new DatasetCoreWrapper_1.DatasetCoreWrapper(this)}},"RdfStore");return RdfStore$1.DEFAULT_INDEX_COMBINATIONS=[["graph","subject","predicate","object"],["graph","predicate","object","subject"],["graph","object","subject","predicate"]],RdfStore.RdfStore=RdfStore$1,RdfStore}__name(requireRdfStore,"requireRdfStore");var hasRequiredDatasetCoreWrapper;function requireDatasetCoreWrapper(){if(hasRequiredDatasetCoreWrapper)return DatasetCoreWrapper;hasRequiredDatasetCoreWrapper=1,Object.defineProperty(DatasetCoreWrapper,"__esModule",{value:!0}),DatasetCoreWrapper.DatasetCoreWrapper=void 0;const RdfStore_1=requireRdfStore();let DatasetCoreWrapper$1=__name(class DatasetCoreWrapper2{constructor(store){this.store=store}get size(){return this.store.size}add(quad){return this.store.addQuad(quad),this}delete(quad){return this.store.removeQuad(quad),this}has(quad){for(const result of this.store.readQuads(quad.subject,quad.predicate,quad.object,quad.graph))return!0;return!1}match(subject2,predicate2,object2,graph){const newStore=new RdfStore_1.RdfStore(this.store.options);for(const quad of this.store.readQuads(subject2,predicate2,object2,graph))newStore.addQuad(quad);return new DatasetCoreWrapper2(newStore)}[Symbol.iterator](){return this.store.readQuads()}},"DatasetCoreWrapper");return DatasetCoreWrapper.DatasetCoreWrapper=DatasetCoreWrapper$1,DatasetCoreWrapper}__name(requireDatasetCoreWrapper,"requireDatasetCoreWrapper");var ITermDictionary={};Object.defineProperty(ITermDictionary,"__esModule",{value:!0});var TermDictionaryNumberMap$1={};Object.defineProperty(TermDictionaryNumberMap$1,"__esModule",{value:!0});TermDictionaryNumberMap$1.TermDictionaryNumberMap=void 0;const rdf_data_factory_1$m=rdfDataFactory,rdf_string_1$b=rdfString;class TermDictionaryNumberMap{constructor(dataFactory=new rdf_data_factory_1$m.DataFactory){this.lastId=0,this.dictionary=new Map,this.reverseDictionary=new Map,this.features={quotedTriples:!1},this.dataFactory=dataFactory}encode(term){const key=(0,rdf_string_1$b.termToString)(term);let encoded=this.dictionary.get(key);return encoded===void 0&&(encoded=this.lastId++,this.dictionary.set(key,encoded),this.reverseDictionary.set(encoded,key)),encoded}encodeOptional(term){const key=(0,rdf_string_1$b.termToString)(term);return this.dictionary.get(key)}decode(encoding){const string=this.reverseDictionary.get(encoding);if(string===void 0)throw new Error(`The value ${encoding} is not present in this dictionary`);return(0,rdf_string_1$b.stringToTerm)(string,this.dataFactory)}encodings(){return this.reverseDictionary.keys()}findQuotedTriples(quotedTriplePattern){throw new Error("findQuotedTriples is not supported")}findQuotedTriplesEncoded(quotedTriplePattern){throw new Error("findQuotedTriplesEncoded is not supported")}}__name(TermDictionaryNumberMap,"TermDictionaryNumberMap");TermDictionaryNumberMap$1.TermDictionaryNumberMap=TermDictionaryNumberMap;var TermDictionaryNumberRecord$1={};Object.defineProperty(TermDictionaryNumberRecord$1,"__esModule",{value:!0});TermDictionaryNumberRecord$1.TermDictionaryNumberRecord=void 0;const rdf_data_factory_1$l=rdfDataFactory,rdf_string_1$a=rdfString;class TermDictionaryNumberRecord{constructor(dataFactory=new rdf_data_factory_1$l.DataFactory){this.lastId=0,this.dictionary={},this.reverseDictionary={},this.features={quotedTriples:!1},this.dataFactory=dataFactory}encode(term){const key=(0,rdf_string_1$a.termToString)(term);let encoded=this.dictionary[key];return encoded===void 0&&(encoded=this.lastId++,this.dictionary[key]=encoded,this.reverseDictionary[encoded]=key),encoded}encodeOptional(term){const key=(0,rdf_string_1$a.termToString)(term);return this.dictionary[key]}decode(encoding){const string=this.reverseDictionary[encoding];if(string===void 0)throw new Error(`The value ${encoding} is not present in this dictionary`);return(0,rdf_string_1$a.stringToTerm)(string,this.dataFactory)}*encodings(){for(const key of Object.keys(this.reverseDictionary))yield Number.parseInt(key,10)}findQuotedTriples(quotedTriplePattern){throw new Error("findQuotedTriples is not supported")}findQuotedTriplesEncoded(quotedTriplePattern){throw new Error("findQuotedTriplesEncoded is not supported")}}__name(TermDictionaryNumberRecord,"TermDictionaryNumberRecord");TermDictionaryNumberRecord$1.TermDictionaryNumberRecord=TermDictionaryNumberRecord;var TermDictionaryQuoted$1={};Object.defineProperty(TermDictionaryQuoted$1,"__esModule",{value:!0});TermDictionaryQuoted$1.TermDictionaryQuoted=void 0;const rdf_data_factory_1$k=rdfDataFactory,rdf_terms_1$9=rdfTerms;class TermDictionaryQuoted{constructor(plainTermDictionary,quotedTriplesDictionary,dataFactory=new rdf_data_factory_1$k.DataFactory){this.features={quotedTriples:!0},this.plainTermDictionary=plainTermDictionary,this.quotedTriplesDictionary=quotedTriplesDictionary,this.dataFactory=dataFactory}encode(term){return term.termType==="Quad"?TermDictionaryQuoted.BITMASK|1+this.quotedTriplesDictionary.encode(term):this.plainTermDictionary.encode(term)}encodeOptional(term){if(term.termType==="Quad"){const encoding=this.quotedTriplesDictionary.encodeOptional(term);return encoding===void 0?encoding:TermDictionaryQuoted.BITMASK|1+encoding}return this.plainTermDictionary.encodeOptional(term)}decode(encoding){if(TermDictionaryQuoted.BITMASK&encoding){const encodingBase=(~TermDictionaryQuoted.BITMASK&encoding)-1;return this.quotedTriplesDictionary.decode(encodingBase)}return this.plainTermDictionary.decode(encoding)}*encodings(){for(const encoding of this.plainTermDictionary.encodings())yield encoding;for(const encoding of this.quotedTriplesDictionary.encodings())yield TermDictionaryQuoted.BITMASK|1+encoding}*findQuotedTriples(quotedTriplePattern){for(const termEncoded of this.findQuotedTriplesEncoded(quotedTriplePattern))yield this.decode(termEncoded)}*findQuotedTriplesEncoded(quotedTriplePattern){for(let encodedQuotedTriple of this.quotedTriplesDictionary.encodings()){encodedQuotedTriple=TermDictionaryQuoted.BITMASK|1+encodedQuotedTriple;const quotedTriple=this.decode(encodedQuotedTriple);(0,rdf_terms_1$9.matchPattern)(quotedTriple,quotedTriplePattern.subject,quotedTriplePattern.predicate,quotedTriplePattern.object,quotedTriplePattern.graph)&&(yield encodedQuotedTriple)}}}__name(TermDictionaryQuoted,"TermDictionaryQuoted");TermDictionaryQuoted.BITMASK=1<<31;TermDictionaryQuoted$1.TermDictionaryQuoted=TermDictionaryQuoted;var TermDictionaryQuotedReferential$1={};Object.defineProperty(TermDictionaryQuotedReferential$1,"__esModule",{value:!0});TermDictionaryQuotedReferential$1.TermDictionaryQuotedReferential=void 0;const rdf_data_factory_1$j=rdfDataFactory,rdf_terms_1$8=rdfTerms,OrderUtils_1$4=OrderUtils;class TermDictionaryQuotedReferential{constructor(plainTermDictionary,dataFactory=new rdf_data_factory_1$j.DataFactory){this.quotedTriplesDictionary=[],this.quotedTriplesReverseDictionary={},this.features={quotedTriples:!0},this.plainTermDictionary=plainTermDictionary,this.dataFactory=dataFactory}encode(term){return term.termType==="Quad"?this.encodeQuotedTriple(term,!1):this.plainTermDictionary.encode(term)}encodeQuotedTriple(quad,optional){var _a2;if(quad.graph.termType!=="DefaultGraph")throw new Error("Encoding of quoted quads outside of the default graph is not allowed");const encodedTripleOptional=(_a2=(0,OrderUtils_1$4.encodeOptionalTerms)([quad.subject,quad.predicate,quad.object,void 0],this))===null||_a2===void 0?void 0:_a2.slice(0,3),id=encodedTripleOptional&&encodedTripleOptional.every(encoded=>encoded!==void 0)?this.quotedTriplesReverseDictionary[encodedTripleOptional.join(TermDictionaryQuotedReferential.SEPARATOR)]:void 0;if(id!==void 0||optional)return id===void 0?void 0:TermDictionaryQuotedReferential.BITMASK|id;const encodedTriple=[this.encode(quad.subject),this.encode(quad.predicate),this.encode(quad.object)],encodingBase=this.quotedTriplesDictionary.length+1;return this.quotedTriplesDictionary.push(encodedTriple),this.quotedTriplesReverseDictionary[encodedTriple.join(TermDictionaryQuotedReferential.SEPARATOR)]=encodingBase,TermDictionaryQuotedReferential.BITMASK|encodingBase}encodeOptional(term){return term.termType==="Quad"?this.encodeQuotedTriple(term,!0):this.plainTermDictionary.encodeOptional(term)}decode(encoding){if(TermDictionaryQuotedReferential.BITMASK&encoding){const encodingBase=(~TermDictionaryQuotedReferential.BITMASK&encoding)-1;if(encodingBase>=this.quotedTriplesDictionary.length)throw new Error(`The value ${encoding} is not present in the quoted triples range of the dictionary`);const encodedTerms=this.quotedTriplesDictionary[encodingBase];return this.dataFactory.quad(this.decode(encodedTerms[0]),this.decode(encodedTerms[1]),this.decode(encodedTerms[2]))}return this.plainTermDictionary.decode(encoding)}*encodings(){for(const encoding of this.plainTermDictionary.encodings())yield encoding;for(const encoding of this.quotedTriplesDictionary.keys())yield TermDictionaryQuotedReferential.BITMASK|1+encoding}*findQuotedTriples(quotedTriplePattern){for(const termEncoded of this.findQuotedTriplesEncoded(quotedTriplePattern))yield this.decode(termEncoded)}*findQuotedTriplesEncoded(quotedTriplePattern){for(let encodedQuotedTriple of this.quotedTriplesDictionary.keys()){encodedQuotedTriple=TermDictionaryQuotedReferential.BITMASK|1+encodedQuotedTriple;const quotedTriple=this.decode(encodedQuotedTriple);(0,rdf_terms_1$8.matchPattern)(quotedTriple,quotedTriplePattern.subject,quotedTriplePattern.predicate,quotedTriplePattern.object,quotedTriplePattern.graph)&&(yield encodedQuotedTriple)}}}__name(TermDictionaryQuotedReferential,"TermDictionaryQuotedReferential");TermDictionaryQuotedReferential.BITMASK=1<<31;TermDictionaryQuotedReferential.SEPARATOR="_";TermDictionaryQuotedReferential$1.TermDictionaryQuotedReferential=TermDictionaryQuotedReferential;var TermDictionarySymbol$1={};Object.defineProperty(TermDictionarySymbol$1,"__esModule",{value:!0});TermDictionarySymbol$1.TermDictionarySymbol=void 0;const rdf_data_factory_1$i=rdfDataFactory,rdf_string_1$9=rdfString;class TermDictionarySymbol{constructor(dataFactory=new rdf_data_factory_1$i.DataFactory){this.features={quotedTriples:!1},this.dataFactory=dataFactory}encode(term){return Symbol.for(`rdf::${(0,rdf_string_1$9.termToString)(term)}`)}encodeOptional(term){return this.encode(term)}decode(encoding){const string=Symbol.keyFor(encoding);if(string===void 0)throw new Error(`The value ${String(encoding)} is not present in this dictionary`);return(0,rdf_string_1$9.stringToTerm)(string.slice(5),this.dataFactory)}encodings(){throw new Error("encodings is not supported")}findQuotedTriples(quotedTriplePattern){throw new Error("findQuotedTriples is not supported")}findQuotedTriplesEncoded(quotedTriplePattern){throw new Error("findQuotedTriplesEncoded is not supported")}}__name(TermDictionarySymbol,"TermDictionarySymbol");TermDictionarySymbol$1.TermDictionarySymbol=TermDictionarySymbol;var IRdfStoreIndex={};Object.defineProperty(IRdfStoreIndex,"__esModule",{value:!0});var RdfStoreIndexNestedMapRecursive$1={};Object.defineProperty(RdfStoreIndexNestedMapRecursive$1,"__esModule",{value:!0});RdfStoreIndexNestedMapRecursive$1.RdfStoreIndexNestedMapRecursive=void 0;const OrderUtils_1$3=OrderUtils;class RdfStoreIndexNestedMapRecursive{constructor(options){this.features={quotedTripleFiltering:!1},this.dictionary=options.dictionary,this.nestedMap=new Map}set(terms,value){let map2=this.nestedMap,contained=!1;for(const[i,term]of terms.entries()){const mapActual=map2;let nextMap=mapActual.get(term);nextMap?i===terms.length-1&&(contained=!0):(nextMap=i===terms.length-1?value:new Map,mapActual.set(term,nextMap)),map2=nextMap}return!contained}remove(terms){const map0=this.nestedMap,map1=map0.get(terms[0]);if(!map1)return!1;const map2=map1.get(terms[1]);if(!map2)return!1;const map3=map2.get(terms[2]);if(!map3)return!1;const ret=map3.delete(terms[3]);return ret&&map3.size===0&&(map2.delete(terms[2]),map2.size===0&&(map1.delete(terms[1]),map1.size===0&&map0.delete(terms[0]))),ret}get(key){const encoded=(0,OrderUtils_1$3.encodeOptionalTerms)(key,this.dictionary);if(!(!encoded||encoded.includes(void 0)))return this.getEncoded(encoded)}getEncoded(ids){const map1=this.nestedMap.get(ids[0]);if(!map1)return;const map2=map1.get(ids[1]);if(!map2)return;const map3=map2.get(ids[2]);if(map3)return map3.get(ids[3])}*find(terms){const ids=(0,OrderUtils_1$3.encodeOptionalTerms)(terms,this.dictionary);if(ids)for(const termsEncoded of this.findEncoded(ids,terms))yield[ids[0]!==void 0?terms[0]:this.dictionary.decode(termsEncoded[0]),ids[1]!==void 0?terms[1]:this.dictionary.decode(termsEncoded[1]),ids[2]!==void 0?terms[2]:this.dictionary.decode(termsEncoded[2]),ids[3]!==void 0?terms[3]:this.dictionary.decode(termsEncoded[3])]}*findEncoded(ids,terms){return yield*this.findEncodedInner(0,ids,terms,this.nestedMap,[])}*findEncodedInner(index,ids,terms,map2,partialQuad){if(index===ids.length)yield[...partialQuad];else{const id=ids[index];if(terms[index]){const encodedTerm=id;if(encodedTerm!==void 0){const subMap=map2.get(encodedTerm);subMap&&(partialQuad[index]=id,yield*this.findEncodedInner(index+1,ids,terms,subMap,partialQuad))}}else for(const[key,subMap]of map2.entries())partialQuad[index]=key,yield*this.findEncodedInner(index+1,ids,terms,subMap,partialQuad)}}count(terms){return this.countInner(0,terms,this.nestedMap)}countInner(index,terms,map2){const currentTerm=terms[index];let count2=0;if(currentTerm){const encodedTerm=this.dictionary.encodeOptional(currentTerm);if(encodedTerm!==void 0){if(index===terms.length-1)return map2.has(encodedTerm)?1:0;const subMap=map2.get(encodedTerm);subMap&&(count2+=this.countInner(index+1,terms,subMap))}}else{if(index===terms.length-1)return map2.size;for(const subMap of map2.values())count2+=this.countInner(index+1,terms,subMap)}return count2}}__name(RdfStoreIndexNestedMapRecursive,"RdfStoreIndexNestedMapRecursive");RdfStoreIndexNestedMapRecursive$1.RdfStoreIndexNestedMapRecursive=RdfStoreIndexNestedMapRecursive;var RdfStoreIndexNestedMapRecursiveQuoted$1={};Object.defineProperty(RdfStoreIndexNestedMapRecursiveQuoted$1,"__esModule",{value:!0});RdfStoreIndexNestedMapRecursiveQuoted$1.RdfStoreIndexNestedMapRecursiveQuoted=void 0;const OrderUtils_1$2=OrderUtils,RdfStoreIndexNestedMapRecursive_1=RdfStoreIndexNestedMapRecursive$1;class RdfStoreIndexNestedMapRecursiveQuoted extends RdfStoreIndexNestedMapRecursive_1.RdfStoreIndexNestedMapRecursive{constructor(options){super(options),this.features={quotedTripleFiltering:!0}}*findEncoded(ids,terms){return yield*this.findEncodedInnerQuoted(0,ids,terms,(0,OrderUtils_1$2.arePatternsQuoted)(terms),this.nestedMap,[])}*findEncodedInnerQuoted(index,ids,terms,isQuotedPattern,map2,partialQuad){if(index===ids.length)yield[...partialQuad];else{const id=ids[index],currentTerm=terms[index];if(currentTerm)if(isQuotedPattern[index]){const quotedTriplesEncoded=this.dictionary.findQuotedTriplesEncoded(currentTerm);for(const quotedTripleEncoded of quotedTriplesEncoded){const subMap=map2.get(quotedTripleEncoded);subMap&&(partialQuad[index]=quotedTripleEncoded,yield*this.findEncodedInnerQuoted(index+1,ids,terms,isQuotedPattern,subMap,partialQuad))}}else{const encodedTerm=id;if(encodedTerm!==void 0){const subMap=map2.get(encodedTerm);subMap&&(partialQuad[index]=id,yield*this.findEncodedInnerQuoted(index+1,ids,terms,isQuotedPattern,subMap,partialQuad))}}else for(const[key,subMap]of map2.entries())partialQuad[index]=key,yield*this.findEncodedInnerQuoted(index+1,ids,terms,isQuotedPattern,subMap,partialQuad)}}countInner(index,terms,map2){const currentTerm=terms[index];let count2=0;if(currentTerm)if(currentTerm.termType==="Quad"&&(0,OrderUtils_1$2.quadHasVariables)(currentTerm)){const quotedTriplesEncoded=this.dictionary.findQuotedTriplesEncoded(currentTerm);for(const quotedTripleEncoded of quotedTriplesEncoded)if(index===terms.length-1)map2.has(quotedTripleEncoded)&&count2++;else{const subMap=map2.get(quotedTripleEncoded);subMap&&(count2+=this.countInner(index+1,terms,subMap))}}else{const encodedTerm=this.dictionary.encodeOptional(currentTerm);if(encodedTerm!==void 0){if(index===terms.length-1)return map2.has(encodedTerm)?1:0;const subMap=map2.get(encodedTerm);subMap&&(count2+=this.countInner(index+1,terms,subMap))}}else{if(index===terms.length-1)return map2.size;for(const subMap of map2.values())count2+=this.countInner(index+1,terms,subMap)}return count2}}__name(RdfStoreIndexNestedMapRecursiveQuoted,"RdfStoreIndexNestedMapRecursiveQuoted");RdfStoreIndexNestedMapRecursiveQuoted$1.RdfStoreIndexNestedMapRecursiveQuoted=RdfStoreIndexNestedMapRecursiveQuoted;var RdfStoreIndexNestedRecord$1={};Object.defineProperty(RdfStoreIndexNestedRecord$1,"__esModule",{value:!0});RdfStoreIndexNestedRecord$1.RdfStoreIndexNestedRecord=void 0;const OrderUtils_1$1=OrderUtils;class RdfStoreIndexNestedRecord{constructor(options){this.features={quotedTripleFiltering:!1},this.dictionary=options.dictionary,this.nestedRecords={}}set(terms,value){const map0=this.nestedRecords,map1=map0[terms[0]]||(map0[terms[0]]={}),map2=map1[terms[1]]||(map1[terms[1]]={}),map3=map2[terms[2]]||(map2[terms[2]]={});return map3[terms[3]]?!1:(map3[terms[3]]=value,!0)}remove(terms){const map0=this.nestedRecords,map1=map0[terms[0]];if(!map1)return!1;const map2=map1[terms[1]];if(!map2)return!1;const map3=map2[terms[2]];return!map3||!map3[terms[3]]?!1:(delete map3[terms[3]],Object.keys(map3).length===0&&(delete map2[terms[2]],Object.keys(map2).length===0&&(delete map1[terms[1]],Object.keys(map1).length===0&&delete map0[terms[0]])),!0)}get(key){const encoded=(0,OrderUtils_1$1.encodeOptionalTerms)(key,this.dictionary);if(!(!encoded||encoded.includes(void 0)))return this.getEncoded(encoded)}getEncoded(ids){var _a2,_b,_c;return(_c=(_b=(_a2=this.nestedRecords[ids[0]])===null||_a2===void 0?void 0:_a2[ids[1]])===null||_b===void 0?void 0:_b[ids[2]])===null||_c===void 0?void 0:_c[ids[3]]}*find(terms){const ids=(0,OrderUtils_1$1.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return;const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms;let partialQuad0,partialQuad1,partialQuad2,partialQuad3,map1,map2,map3;const map0=this.nestedRecords,map0Keys=id0!==void 0?id0 in map0?[id0]:[]:Object.keys(map0);for(const key1 of map0Keys){map1=map0[key1],partialQuad0=term0||this.dictionary.decode(Number.parseInt(key1,10));const map1Keys=id1!==void 0?id1 in map1?[id1]:[]:Object.keys(map1);for(const key2 of map1Keys){map2=map1[key2],partialQuad1=term1||this.dictionary.decode(Number.parseInt(key2,10));const map2Keys=id2!==void 0?id2 in map2?[id2]:[]:Object.keys(map2);for(const key3 of map2Keys){map3=map2[key3],partialQuad2=term2||this.dictionary.decode(Number.parseInt(key3,10));const map3Keys=id3!==void 0?id3 in map3?[id3]:[]:Object.keys(map3);for(const key4 of map3Keys)partialQuad3=term3||this.dictionary.decode(Number.parseInt(key4,10)),yield[partialQuad0,partialQuad1,partialQuad2,partialQuad3]}}}}*findEncoded(ids,terms){const[id0,id1,id2,id3]=ids;let map1,map2,map3;const map0=this.nestedRecords,map0Keys=id0!==void 0?id0 in map0?[id0]:[]:Object.keys(map0);for(const key1 of map0Keys){map1=map0[key1];const map1Keys=id1!==void 0?id1 in map1?[id1]:[]:Object.keys(map1);for(const key2 of map1Keys){map2=map1[key2];const map2Keys=id2!==void 0?id2 in map2?[id2]:[]:Object.keys(map2);for(const key3 of map2Keys){map3=map2[key3];const map3Keys=id3!==void 0?id3 in map3?[id3]:[]:Object.keys(map3);for(const key4 of map3Keys)yield[Number.parseInt(key1,10),Number.parseInt(key2,10),Number.parseInt(key3,10),Number.parseInt(key4,10)]}}}}count(terms){let count2=0;const ids=(0,OrderUtils_1$1.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return 0;const id0=ids[0],id1=ids[1],id2=ids[2],id3=ids[3];let map1,map2,map3;const map0=this.nestedRecords,map0Keys=id0!==void 0?id0 in map0?[id0]:[]:Object.keys(map0);for(const key1 of map0Keys){map1=map0[key1];const map1Keys=id1!==void 0?id1 in map1?[id1]:[]:Object.keys(map1);for(const key2 of map1Keys){map2=map1[key2];const map2Keys=id2!==void 0?id2 in map2?[id2]:[]:Object.keys(map2);for(const key3 of map2Keys)map3=map2[key3],id3!==void 0?id3 in map3&&count2++:count2+=Object.keys(map3).length}}return count2}}__name(RdfStoreIndexNestedRecord,"RdfStoreIndexNestedRecord");RdfStoreIndexNestedRecord$1.RdfStoreIndexNestedRecord=RdfStoreIndexNestedRecord;var RdfStoreIndexNestedRecordQuoted$1={};Object.defineProperty(RdfStoreIndexNestedRecordQuoted$1,"__esModule",{value:!0});RdfStoreIndexNestedRecordQuoted$1.RdfStoreIndexNestedRecordQuoted=void 0;const OrderUtils_1=OrderUtils,RdfStoreIndexNestedRecord_1=RdfStoreIndexNestedRecord$1;class RdfStoreIndexNestedRecordQuoted extends RdfStoreIndexNestedRecord_1.RdfStoreIndexNestedRecord{constructor(options){super(options),this.features={quotedTripleFiltering:!0}}*getQuotedPatternKeys(map2,term){for(const quotedTripleEncoded of this.dictionary.findQuotedTriplesEncoded(term))quotedTripleEncoded in map2&&(yield quotedTripleEncoded)}*find(terms){const ids=(0,OrderUtils_1.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return;const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms,[quotedTerm0,quotedTerm1,quotedTerm2,quotedTerm3]=(0,OrderUtils_1.arePatternsQuoted)(terms);let partialQuad0,partialQuad1,partialQuad2,partialQuad3,map1,map2,map3;const map0=this.nestedRecords,map0Keys=term0!==void 0?quotedTerm0?this.getQuotedPatternKeys(map0,term0):id0 in map0?[id0]:[]:Object.keys(map0);for(const key1 of map0Keys){map1=map0[key1],partialQuad0=!quotedTerm0&&term0?term0:this.dictionary.decode(Number.parseInt(key1,10));const map1Keys=term1!==void 0?quotedTerm1?this.getQuotedPatternKeys(map1,term1):id1 in map1?[id1]:[]:Object.keys(map1);for(const key2 of map1Keys){map2=map1[key2],partialQuad1=!quotedTerm1&&term1?term1:this.dictionary.decode(Number.parseInt(key2,10));const map2Keys=term2!==void 0?quotedTerm2?this.getQuotedPatternKeys(map2,term2):id2 in map2?[id2]:[]:Object.keys(map2);for(const key3 of map2Keys){map3=map2[key3],partialQuad2=!quotedTerm2&&term2?term2:this.dictionary.decode(Number.parseInt(key3,10));const map3Keys=term3!==void 0?quotedTerm3?this.getQuotedPatternKeys(map3,term3):id3 in map3?[id3]:[]:Object.keys(map3);for(const key4 of map3Keys)partialQuad3=!quotedTerm3&&term3?term3:this.dictionary.decode(Number.parseInt(key4,10)),yield[partialQuad0,partialQuad1,partialQuad2,partialQuad3]}}}}*findEncoded(ids,terms){const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms,[quotedTerm0,quotedTerm1,quotedTerm2,quotedTerm3]=(0,OrderUtils_1.arePatternsQuoted)(terms);let map1,map2,map3;const map0=this.nestedRecords,map0Keys=term0!==void 0?quotedTerm0?this.getQuotedPatternKeys(map0,term0):id0 in map0?[id0]:[]:Object.keys(map0);for(const key1 of map0Keys){map1=map0[key1];const map1Keys=term1!==void 0?quotedTerm1?this.getQuotedPatternKeys(map1,term1):id1 in map1?[id1]:[]:Object.keys(map1);for(const key2 of map1Keys){map2=map1[key2];const map2Keys=term2!==void 0?quotedTerm2?this.getQuotedPatternKeys(map2,term2):id2 in map2?[id2]:[]:Object.keys(map2);for(const key3 of map2Keys){map3=map2[key3];const map3Keys=term3!==void 0?quotedTerm3?this.getQuotedPatternKeys(map3,term3):id3 in map3?[id3]:[]:Object.keys(map3);for(const key4 of map3Keys)yield[Number.parseInt(key1,10),Number.parseInt(key2,10),Number.parseInt(key3,10),Number.parseInt(key4,10)]}}}}count(terms){let count2=0;const ids=(0,OrderUtils_1.encodeOptionalTerms)(terms,this.dictionary);if(!ids)return 0;const[id0,id1,id2,id3]=ids,[term0,term1,term2,term3]=terms,[quotedTerm0,quotedTerm1,quotedTerm2,quotedTerm3]=(0,OrderUtils_1.arePatternsQuoted)(terms);let map1,map2,map3;const map0=this.nestedRecords,map0Keys=term0!==void 0?quotedTerm0?this.getQuotedPatternKeys(map0,term0):id0 in map0?[id0]:[]:Object.keys(map0);for(const key1 of map0Keys){map1=map0[key1];const map1Keys=term1!==void 0?quotedTerm1?this.getQuotedPatternKeys(map1,term1):id1 in map1?[id1]:[]:Object.keys(map1);for(const key2 of map1Keys){map2=map1[key2];const map2Keys=term2!==void 0?quotedTerm2?this.getQuotedPatternKeys(map2,term2):id2 in map2?[id2]:[]:Object.keys(map2);for(const key3 of map2Keys)map3=map2[key3],term3!==void 0?quotedTerm3?count2+=[...this.getQuotedPatternKeys(map3,term3)].length:id3 in map3&&count2++:count2+=Object.keys(map3).length}}return count2}}__name(RdfStoreIndexNestedRecordQuoted,"RdfStoreIndexNestedRecordQuoted");RdfStoreIndexNestedRecordQuoted$1.RdfStoreIndexNestedRecordQuoted=RdfStoreIndexNestedRecordQuoted;var IRdfStoreOptions={};Object.defineProperty(IRdfStoreOptions,"__esModule",{value:!0});var PatternTerm={};Object.defineProperty(PatternTerm,"__esModule",{value:!0});(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(requireDatasetCoreWrapper(),exports),__exportStar(ITermDictionary,exports),__exportStar(TermDictionaryNumberMap$1,exports),__exportStar(TermDictionaryNumberRecord$1,exports),__exportStar(TermDictionaryNumberRecordFullTerms$1,exports),__exportStar(TermDictionaryQuoted$1,exports),__exportStar(TermDictionaryQuotedIndexed$1,exports),__exportStar(TermDictionaryQuotedReferential$1,exports),__exportStar(TermDictionarySymbol$1,exports),__exportStar(IRdfStoreIndex,exports),__exportStar(RdfStoreIndexNestedMap$1,exports),__exportStar(RdfStoreIndexNestedMapQuoted$1,exports),__exportStar(RdfStoreIndexNestedMapRecursive$1,exports),__exportStar(RdfStoreIndexNestedMapRecursiveQuoted$1,exports),__exportStar(RdfStoreIndexNestedRecord$1,exports),__exportStar(RdfStoreIndexNestedRecordQuoted$1,exports),__exportStar(IRdfStoreOptions,exports),__exportStar(OrderUtils,exports),__exportStar(PatternTerm,exports),__exportStar(requireRdfStore(),exports)})(rdfStores);Object.defineProperty(rdfStoreStream,"__esModule",{value:!0});rdfStoreStream.storeStream=void 0;const rdf_stores_1=rdfStores;function storeStream(stream){const store=rdf_stores_1.RdfStore.createDefault();return new Promise((resolve2,reject)=>store.import(stream).on("error",reject).once("end",()=>resolve2(store)))}__name(storeStream,"storeStream");rdfStoreStream.storeStream=storeStream;Object.defineProperty(ActorRdfResolveHypermediaNone$1,"__esModule",{value:!0});ActorRdfResolveHypermediaNone$1.ActorRdfResolveHypermediaNone=void 0;const actor_rdf_resolve_quad_pattern_rdfjs_source_1=lib$1h,bus_rdf_resolve_hypermedia_1$2=lib$1f,rdf_store_stream_1$1=rdfStoreStream;class ActorRdfResolveHypermediaNone extends bus_rdf_resolve_hypermedia_1$2.ActorRdfResolveHypermedia{constructor(args){super(args,"file")}async testMetadata(action){return{filterFactor:0}}async run(action){return this.logInfo(action.context,`Identified as file source: ${action.url}`),{source:new actor_rdf_resolve_quad_pattern_rdfjs_source_1.RdfJsQuadSource(await(0,rdf_store_stream_1$1.storeStream)(action.quads))}}}__name(ActorRdfResolveHypermediaNone,"ActorRdfResolveHypermediaNone");ActorRdfResolveHypermediaNone$1.ActorRdfResolveHypermediaNone=ActorRdfResolveHypermediaNone;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermediaNone$1,exports)})(lib$1i);var lib$1e={},ActorRdfResolveHypermediaLinksNext$1={},lib$1d={},ActorRdfResolveHypermediaLinks$1={};Object.defineProperty(ActorRdfResolveHypermediaLinks$1,"__esModule",{value:!0});ActorRdfResolveHypermediaLinks$1.ActorRdfResolveHypermediaLinks=void 0;const core_1$7=lib$2A;class ActorRdfResolveHypermediaLinks extends core_1$7.Actor{constructor(args){super(args)}}__name(ActorRdfResolveHypermediaLinks,"ActorRdfResolveHypermediaLinks");ActorRdfResolveHypermediaLinks$1.ActorRdfResolveHypermediaLinks=ActorRdfResolveHypermediaLinks;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermediaLinks$1,exports)})(lib$1d);Object.defineProperty(ActorRdfResolveHypermediaLinksNext$1,"__esModule",{value:!0});ActorRdfResolveHypermediaLinksNext$1.ActorRdfResolveHypermediaLinksNext=void 0;const bus_rdf_resolve_hypermedia_links_1=lib$1d;class ActorRdfResolveHypermediaLinksNext extends bus_rdf_resolve_hypermedia_links_1.ActorRdfResolveHypermediaLinks{constructor(args){super(args)}async test(action){if(!action.metadata.next)throw new Error(`Actor ${this.name} requires a 'next' metadata entry.`);return!0}async run(action){return{links:[{url:action.metadata.next}]}}}__name(ActorRdfResolveHypermediaLinksNext,"ActorRdfResolveHypermediaLinksNext");ActorRdfResolveHypermediaLinksNext$1.ActorRdfResolveHypermediaLinksNext=ActorRdfResolveHypermediaLinksNext;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermediaLinksNext$1,exports)})(lib$1e);var lib$1c={},ActorRdfResolveHypermediaLinksQueueFifo$1={},lib$1b={},ActorRdfResolveHypermediaLinksQueue$1={};Object.defineProperty(ActorRdfResolveHypermediaLinksQueue$1,"__esModule",{value:!0});ActorRdfResolveHypermediaLinksQueue$1.ActorRdfResolveHypermediaLinksQueue=void 0;const core_1$6=lib$2A;class ActorRdfResolveHypermediaLinksQueue extends core_1$6.Actor{constructor(args){super(args)}}__name(ActorRdfResolveHypermediaLinksQueue,"ActorRdfResolveHypermediaLinksQueue");ActorRdfResolveHypermediaLinksQueue$1.ActorRdfResolveHypermediaLinksQueue=ActorRdfResolveHypermediaLinksQueue;var ILinkQueue={};Object.defineProperty(ILinkQueue,"__esModule",{value:!0});var LinkQueueWrapper$1={};Object.defineProperty(LinkQueueWrapper$1,"__esModule",{value:!0});LinkQueueWrapper$1.LinkQueueWrapper=void 0;class LinkQueueWrapper{constructor(linkQueue){this.linkQueue=linkQueue}push(link2,parent){return this.linkQueue.push(link2,parent)}getSize(){return this.linkQueue.getSize()}isEmpty(){return this.linkQueue.isEmpty()}pop(){return this.linkQueue.pop()}peek(){return this.linkQueue.peek()}}__name(LinkQueueWrapper,"LinkQueueWrapper");LinkQueueWrapper$1.LinkQueueWrapper=LinkQueueWrapper;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermediaLinksQueue$1,exports),__exportStar(ILinkQueue,exports),__exportStar(LinkQueueWrapper$1,exports)})(lib$1b);var LinkQueueFifo$1={};Object.defineProperty(LinkQueueFifo$1,"__esModule",{value:!0});LinkQueueFifo$1.LinkQueueFifo=void 0;class LinkQueueFifo{constructor(){this.links=[]}push(link2){return this.links.push(link2),!0}getSize(){return this.links.length}isEmpty(){return this.links.length===0}pop(){return this.links.shift()}peek(){return this.links[0]}}__name(LinkQueueFifo,"LinkQueueFifo");LinkQueueFifo$1.LinkQueueFifo=LinkQueueFifo;Object.defineProperty(ActorRdfResolveHypermediaLinksQueueFifo$1,"__esModule",{value:!0});ActorRdfResolveHypermediaLinksQueueFifo$1.ActorRdfResolveHypermediaLinksQueueFifo=void 0;const bus_rdf_resolve_hypermedia_links_queue_1=lib$1b,LinkQueueFifo_1=LinkQueueFifo$1;class ActorRdfResolveHypermediaLinksQueueFifo extends bus_rdf_resolve_hypermedia_links_queue_1.ActorRdfResolveHypermediaLinksQueue{constructor(args){super(args)}async test(action){return!0}async run(action){return{linkQueue:new LinkQueueFifo_1.LinkQueueFifo}}}__name(ActorRdfResolveHypermediaLinksQueueFifo,"ActorRdfResolveHypermediaLinksQueueFifo");ActorRdfResolveHypermediaLinksQueueFifo$1.ActorRdfResolveHypermediaLinksQueueFifo=ActorRdfResolveHypermediaLinksQueueFifo;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermediaLinksQueueFifo$1,exports),__exportStar(LinkQueueFifo$1,exports)})(lib$1c);var lib$1a={},ActorRdfUpdateQuadsRdfJsStore$1={},lib$19={},ActorRdfUpdateQuads$1={};Object.defineProperty(ActorRdfUpdateQuads$1,"__esModule",{value:!0});ActorRdfUpdateQuads$1.ActorRdfUpdateQuads=void 0;const core_1$5=lib$2A;class ActorRdfUpdateQuads extends core_1$5.Actor{constructor(args){super(args)}}__name(ActorRdfUpdateQuads,"ActorRdfUpdateQuads");ActorRdfUpdateQuads$1.ActorRdfUpdateQuads=ActorRdfUpdateQuads;var ActorRdfUpdateQuadsDestination$1={},lib$18={},ActorRdfResolveQuadPatternFederated$1={},FederatedQuadSource$1={};Object.defineProperty(FederatedQuadSource$1,"__esModule",{value:!0});FederatedQuadSource$1.FederatedQuadSource=void 0;const bus_query_operation_1$J=lib$2y,bus_rdf_resolve_quad_pattern_1$4=lib$1g,context_entries_1$i=lib$2x,data_factory_1$1=lib$2w,metadata_1$a=lib$2h,asynciterator_1$m=asynciterator,rdf_data_factory_1$h=rdfDataFactory,rdf_terms_1$7=rdfTerms,sparqlalgebrajs_1$r=sparqlalgebrajs,DF$h=new rdf_data_factory_1$h.DataFactory;class FederatedQuadSource{constructor(mediatorResolveQuadPattern,mediatorRdfMetadataAccumulate,context2,emptyPatterns,skipEmptyPatterns){if(this.mediatorResolveQuadPattern=mediatorResolveQuadPattern,this.mediatorRdfMetadataAccumulate=mediatorRdfMetadataAccumulate,this.sources=context2.get(context_entries_1$i.KeysRdfResolveQuadPattern.sources),this.contextDefault=context2.delete(context_entries_1$i.KeysRdfResolveQuadPattern.sources),this.emptyPatterns=emptyPatterns,this.sourceIds=context2.get(context_entries_1$i.KeysRdfResolveQuadPattern.sourceIds)??new Map,this.skipEmptyPatterns=skipEmptyPatterns,this.algebraFactory=new sparqlalgebrajs_1$r.Factory,this.skipEmptyPatterns)for(const source of this.sources)this.emptyPatterns.has(source)||this.emptyPatterns.set(source,[])}static isTermBound(term){return term.termType!=="Variable"}static isSubPatternOf(child,parent){return(!FederatedQuadSource.isTermBound(parent.subject)||parent.subject.equals(child.subject))&&(!FederatedQuadSource.isTermBound(parent.predicate)||parent.predicate.equals(child.predicate))&&(!FederatedQuadSource.isTermBound(parent.object)||parent.object.equals(child.object))&&(!FederatedQuadSource.isTermBound(parent.graph)||parent.graph.equals(child.graph))}static skolemizeTerm(term,sourceId){return term.termType==="BlankNode"?new data_factory_1$1.BlankNodeScoped(`bc_${sourceId}_${term.value}`,DF$h.namedNode(`${FederatedQuadSource.SKOLEM_PREFIX}${sourceId}:${term.value}`)):term}static skolemizeQuad(quad,sourceId){return(0,rdf_terms_1$7.mapTermsNested)(quad,term=>FederatedQuadSource.skolemizeTerm(term,sourceId))}static deskolemizeTerm(term,sourceId){if(term.termType==="BlankNode"&&"skolemized"in term&&(term=term.skolemized),term.termType==="NamedNode"&&term.value.startsWith(FederatedQuadSource.SKOLEM_PREFIX)){const colonSeparator=term.value.indexOf(":",FederatedQuadSource.SKOLEM_PREFIX.length);if(term.value.slice(FederatedQuadSource.SKOLEM_PREFIX.length,colonSeparator)===sourceId){const termLabel=term.value.slice(colonSeparator+1,term.value.length);return DF$h.blankNode(termLabel)}return null}return term}static deskolemizeQuad(quad,sourceId){return(0,rdf_terms_1$7.mapTermsNested)(quad,term=>{const newTerm=FederatedQuadSource.deskolemizeTerm(term,sourceId);return newTerm||term})}isSourceEmpty(source,pattern){if(!this.skipEmptyPatterns)return!1;const emptyPatterns=this.emptyPatterns.get(source);if(emptyPatterns){for(const emptyPattern of emptyPatterns)if(FederatedQuadSource.isSubPatternOf(pattern,emptyPattern))return!0}return!1}getSourceId(source){let sourceId=this.sourceIds.get(source);return sourceId===void 0&&(sourceId=`${this.sourceIds.size}`,this.sourceIds.set(source,sourceId)),sourceId}match(subject2,predicate2,object2,graph){const tryAccumulatingMetadata=__name(async()=>{if(accumulatingMetadata.size===this.sources.length){let accumulatedMetadata=(await this.mediatorRdfMetadataAccumulate.mediate({mode:"initialize",context:this.contextDefault})).metadata;for(const appendingMetadata of accumulatingMetadata.values())accumulatedMetadata={...appendingMetadata,...(await this.mediatorRdfMetadataAccumulate.mediate({mode:"append",accumulatedMetadata,appendingMetadata,context:this.contextDefault})).metadata};accumulatedMetadata.state=new metadata_1$a.MetadataValidationState;const metadataToInvalidate=it.getProperty("metadata");it.setProperty("metadata",accumulatedMetadata),metadataToInvalidate==null||metadataToInvalidate.state.invalidate()}},"tryAccumulatingMetadata"),accumulatingMetadata=new Map,proxyIt=Promise.all(this.sources.map(async(source,sourceIndex)=>{const sourceId=this.getSourceId(source),patternS=FederatedQuadSource.deskolemizeTerm(subject2,sourceId),patternP=FederatedQuadSource.deskolemizeTerm(predicate2,sourceId),patternO=FederatedQuadSource.deskolemizeTerm(object2,sourceId),patternG=FederatedQuadSource.deskolemizeTerm(graph,sourceId);let pattern,context2=(0,bus_rdf_resolve_quad_pattern_1$4.getDataSourceContext)(source,this.contextDefault);context2=context2.set(context_entries_1$i.KeysRdfResolveQuadPattern.source,source);let output;!patternS||!patternP||!patternO||!patternG||this.isSourceEmpty(source,pattern=this.algebraFactory.createPattern(patternS,patternP,patternO,patternG))?(output={data:new asynciterator_1$m.ArrayIterator([],{autoStart:!1})},output.data.setProperty("metadata",{state:new metadata_1$a.MetadataValidationState,...(await this.mediatorRdfMetadataAccumulate.mediate({mode:"initialize",context:this.contextDefault})).metadata})):output=await this.mediatorResolveQuadPattern.mediate({pattern,context:context2});const addMetadataPropertyListener=__name(()=>{output.data.getProperty("metadata",subMetadata=>{var _a2,_b;accumulatingMetadata.set(`${sourceIndex}`,subMetadata),this.skipEmptyPatterns&&!((_a2=subMetadata.cardinality)!=null&&_a2.value)&&pattern&&!this.isSourceEmpty(source,pattern)&&this.emptyPatterns.get(source).push(pattern),tryAccumulatingMetadata().catch(error=>it.emit("error",error)),(_b=subMetadata.state)==null||_b.addInvalidateListener(()=>{accumulatingMetadata.delete(`${sourceIndex}`),addMetadataPropertyListener()})})},"addMetadataPropertyListener");addMetadataPropertyListener();const data=output.data.map(quad=>FederatedQuadSource.skolemizeQuad(quad,sourceId));return data.on("error",error=>it.emit("error",error)),data}));proxyIt.catch(error=>it.emit("error",error));const it=new bus_query_operation_1$J.ClosableTransformIterator(async()=>new asynciterator_1$m.UnionIterator(await proxyIt),{autoStart:!1,onClose(){proxyIt.then(proxyItResolved=>{for(const subIt of proxyItResolved)subIt.destroy()},()=>{})}});return this.sources.length===0&&this.mediatorRdfMetadataAccumulate.mediate({mode:"initialize",context:this.contextDefault}).then(result=>it.setProperty("metadata",{state:new metadata_1$a.MetadataValidationState,...result.metadata})).catch(error=>it.emit("error",error)),it}}__name(FederatedQuadSource,"FederatedQuadSource");FederatedQuadSource$1.FederatedQuadSource=FederatedQuadSource;FederatedQuadSource.SKOLEM_PREFIX="urn:comunica_skolem:source_";Object.defineProperty(ActorRdfResolveQuadPatternFederated$1,"__esModule",{value:!0});ActorRdfResolveQuadPatternFederated$1.ActorRdfResolveQuadPatternFederated=void 0;const bus_rdf_resolve_quad_pattern_1$3=lib$1g,FederatedQuadSource_1=FederatedQuadSource$1;class ActorRdfResolveQuadPatternFederated extends bus_rdf_resolve_quad_pattern_1$3.ActorRdfResolveQuadPatternSource{constructor(args){super(args),this.emptyPatterns=new Map,args.mediatorRdfMetadataAccumulate||(this.mediatorRdfMetadataAccumulate={async mediate(action){if(action.mode==="initialize")return{metadata:{cardinality:{type:"exact",value:0},canContainUndefs:!1}};const metadata={...action.accumulatedMetadata},subMetadata=action.appendingMetadata;return!subMetadata.cardinality||!Number.isFinite(subMetadata.cardinality.value)?(metadata.cardinality.type="estimate",metadata.cardinality.value=Number.POSITIVE_INFINITY):(subMetadata.cardinality.type==="estimate"&&(metadata.cardinality.type="estimate"),metadata.cardinality.value+=subMetadata.cardinality.value),(metadata.requestTime||subMetadata.requestTime)&&(metadata.requestTime=metadata.requestTime||0,subMetadata.requestTime=subMetadata.requestTime||0,metadata.requestTime+=subMetadata.requestTime),(metadata.pageSize||subMetadata.pageSize)&&(metadata.pageSize=metadata.pageSize||0,subMetadata.pageSize=subMetadata.pageSize||0,metadata.pageSize+=subMetadata.pageSize),subMetadata.canContainUndefs&&(metadata.canContainUndefs=!0),{metadata}}})}async test(action){if(!(0,bus_rdf_resolve_quad_pattern_1$3.getContextSources)(action.context))throw new Error(`Actor ${this.name} can only resolve quad pattern queries against a sources array.`);return!0}async getSource(context2){return new FederatedQuadSource_1.FederatedQuadSource(this.mediatorResolveQuadPattern,this.mediatorRdfMetadataAccumulate,context2,this.emptyPatterns,this.skipEmptyPatterns)}}__name(ActorRdfResolveQuadPatternFederated,"ActorRdfResolveQuadPatternFederated");ActorRdfResolveQuadPatternFederated$1.ActorRdfResolveQuadPatternFederated=ActorRdfResolveQuadPatternFederated;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveQuadPatternFederated$1,exports),__exportStar(FederatedQuadSource$1,exports)})(lib$18);Object.defineProperty(ActorRdfUpdateQuadsDestination$1,"__esModule",{value:!0});ActorRdfUpdateQuadsDestination$1.ActorRdfUpdateQuadsDestination=ActorRdfUpdateQuadsDestination$1.deskolemize=ActorRdfUpdateQuadsDestination$1.deskolemizeStream=void 0;const actor_rdf_resolve_quad_pattern_federated_1=lib$18,context_entries_1$h=lib$2x,ActorRdfUpdateQuads_1=ActorRdfUpdateQuads$1;function deskolemizeStream(stream,id){return stream==null?void 0:stream.map(quad=>actor_rdf_resolve_quad_pattern_federated_1.FederatedQuadSource.deskolemizeQuad(quad,id))}__name(deskolemizeStream,"deskolemizeStream");ActorRdfUpdateQuadsDestination$1.deskolemizeStream=deskolemizeStream;function deskolemize(action){var _a2;const destination=action.context.get(context_entries_1$h.KeysRdfUpdateQuads.destination),id=(_a2=action.context.get(context_entries_1$h.KeysRdfResolveQuadPattern.sourceIds))==null?void 0:_a2.get(destination);return id?{...action,quadStreamInsert:deskolemizeStream(action.quadStreamInsert,id),quadStreamDelete:deskolemizeStream(action.quadStreamDelete,id)}:action}__name(deskolemize,"deskolemize");ActorRdfUpdateQuadsDestination$1.deskolemize=deskolemize;class ActorRdfUpdateQuadsDestination extends ActorRdfUpdateQuads_1.ActorRdfUpdateQuads{async test(action){return!0}async run(action){const destination=await this.getDestination(action.context);return await this.getOutput(destination,deskolemize(action),action.context)}async getOutput(destination,action,context2){return{execute:__name(()=>Promise.all([action.quadStreamInsert?destination.insert(action.quadStreamInsert):Promise.resolve(),action.quadStreamDelete?destination.delete(action.quadStreamDelete):Promise.resolve(),action.deleteGraphs?destination.deleteGraphs(action.deleteGraphs.graphs,action.deleteGraphs.requireExistence,action.deleteGraphs.dropGraphs):Promise.resolve(),action.createGraphs?destination.createGraphs(action.createGraphs.graphs,action.createGraphs.requireNonExistence):Promise.resolve()]).then(()=>{}),"execute")}}}__name(ActorRdfUpdateQuadsDestination,"ActorRdfUpdateQuadsDestination");ActorRdfUpdateQuadsDestination$1.ActorRdfUpdateQuadsDestination=ActorRdfUpdateQuadsDestination;var IQuadDestination={};Object.defineProperty(IQuadDestination,"__esModule",{value:!0});IQuadDestination.validateHttpResponse=void 0;const bus_http_1$6=lib$1Y,stringifyStream$7=streamToString$1;async function validateHttpResponse(url,httpResponse){var _a2;if(httpResponse.status>=400){let bodyString="empty response";if(httpResponse.body){const responseStream=bus_http_1$6.ActorHttp.toNodeReadable(httpResponse.body);bodyString=await stringifyStream$7(responseStream)}throw new Error(`Could not update ${url} (HTTP status ${httpResponse.status}):
${bodyString}`)}await((_a2=httpResponse.body)==null?void 0:_a2.cancel())}__name(validateHttpResponse,"validateHttpResponse");IQuadDestination.validateHttpResponse=validateHttpResponse;var utils={};Object.defineProperty(utils,"__esModule",{value:!0});utils.getContextDestinationUrl=utils.getContextDestinationFirst=utils.getContextDestination=utils.getDataDestinationContext=utils.getDataDestinationValue=utils.getDataDestinationType=utils.isDataDestinationRawType=void 0;const context_entries_1$g=lib$2x;function isDataDestinationRawType(dataDestination){return typeof dataDestination=="string"||"remove"in dataDestination}__name(isDataDestinationRawType,"isDataDestinationRawType");utils.isDataDestinationRawType=isDataDestinationRawType;function getDataDestinationType(dataDestination){return typeof dataDestination=="string"?"":"remove"in dataDestination?"rdfjsStore":dataDestination.type}__name(getDataDestinationType,"getDataDestinationType");utils.getDataDestinationType=getDataDestinationType;function getDataDestinationValue(dataDestination){return isDataDestinationRawType(dataDestination)?dataDestination:dataDestination.value}__name(getDataDestinationValue,"getDataDestinationValue");utils.getDataDestinationValue=getDataDestinationValue;function getDataDestinationContext(dataDestination,context2){return typeof dataDestination=="string"||"remove"in dataDestination||!dataDestination.context?context2:context2.merge(dataDestination.context)}__name(getDataDestinationContext,"getDataDestinationContext");utils.getDataDestinationContext=getDataDestinationContext;function getContextDestination(context2){return context2.get(context_entries_1$g.KeysRdfUpdateQuads.destination)}__name(getContextDestination,"getContextDestination");utils.getContextDestination=getContextDestination;function getContextDestinationFirst(context2){if(context2.has(context_entries_1$g.KeysRdfUpdateQuads.destination))return context2.get(context_entries_1$g.KeysRdfUpdateQuads.destination)}__name(getContextDestinationFirst,"getContextDestinationFirst");utils.getContextDestinationFirst=getContextDestinationFirst;function getContextDestinationUrl(destination){if(destination){let fileUrl=getDataDestinationValue(destination);if(typeof fileUrl=="string"){const hashPosition=fileUrl.indexOf("#");return hashPosition>=0&&(fileUrl=fileUrl.slice(0,hashPosition)),fileUrl}}}__name(getContextDestinationUrl,"getContextDestinationUrl");utils.getContextDestinationUrl=getContextDestinationUrl;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfUpdateQuads$1,exports),__exportStar(ActorRdfUpdateQuadsDestination$1,exports),__exportStar(IQuadDestination,exports),__exportStar(utils,exports)})(lib$19);var RdfJsQuadDestination$1={};Object.defineProperty(RdfJsQuadDestination$1,"__esModule",{value:!0});RdfJsQuadDestination$1.RdfJsQuadDestination=void 0;const rdf_data_factory_1$g=rdfDataFactory,rdf_string_1$8=rdfString,DF$g=new rdf_data_factory_1$g.DataFactory;class RdfJsQuadDestination{constructor(store){this.store=store}promisifyEventEmitter(eventEmitter){return new Promise((resolve2,reject)=>{eventEmitter.on("end",resolve2),eventEmitter.on("error",reject)})}delete(quads){return this.promisifyEventEmitter(this.store.remove(quads))}insert(quads){return this.promisifyEventEmitter(this.store.import(quads))}async deleteGraphs(graphs,requireExistence,dropGraphs){switch(graphs){case"ALL":await this.promisifyEventEmitter(this.store.deleteGraph(DF$g.defaultGraph()));case"NAMED":const allQuads=this.store.match(),namedGraphs={};allQuads.on("data",quad=>{quad.graph.termType!=="DefaultGraph"&&(namedGraphs[(0,rdf_string_1$8.termToString)(quad.graph)]=!0)}),await this.promisifyEventEmitter(allQuads),await Promise.all(Object.keys(namedGraphs).map(namedGraph=>this.promisifyEventEmitter(this.store.deleteGraph((0,rdf_string_1$8.stringToTerm)(namedGraph)))));break;default:for(const graph of Array.isArray(graphs)?graphs:[graphs])await this.promisifyEventEmitter(this.store.deleteGraph(graph))}}async createGraphs(graphs,requireNonExistence){if(requireNonExistence)for(const graph of graphs){const eventEmitter=this.store.match(void 0,void 0,void 0,graph);await new Promise((resolve2,reject)=>{eventEmitter.once("data",()=>{reject(new Error(`Unable to create graph ${graph.value} as it already exists`))}),eventEmitter.on("end",resolve2),eventEmitter.on("error",reject)})}}}__name(RdfJsQuadDestination,"RdfJsQuadDestination");RdfJsQuadDestination$1.RdfJsQuadDestination=RdfJsQuadDestination;Object.defineProperty(ActorRdfUpdateQuadsRdfJsStore$1,"__esModule",{value:!0});ActorRdfUpdateQuadsRdfJsStore$1.ActorRdfUpdateQuadsRdfJsStore=void 0;const bus_rdf_update_quads_1$4=lib$19,RdfJsQuadDestination_1=RdfJsQuadDestination$1;class ActorRdfUpdateQuadsRdfJsStore extends bus_rdf_update_quads_1$4.ActorRdfUpdateQuadsDestination{constructor(args){super(args)}async test(action){const destination=(0,bus_rdf_update_quads_1$4.getContextDestination)(action.context);if(!destination||typeof destination=="string"||!("remove"in destination)&&"value"in destination&&!destination.value.remove)throw new Error(`${this.name} received an invalid rdfjsStore.`);return!0}async getDestination(context2){const destination=(0,bus_rdf_update_quads_1$4.getContextDestination)(context2);return new RdfJsQuadDestination_1.RdfJsQuadDestination("remove"in destination?destination:destination.value)}}__name(ActorRdfUpdateQuadsRdfJsStore,"ActorRdfUpdateQuadsRdfJsStore");ActorRdfUpdateQuadsRdfJsStore$1.ActorRdfUpdateQuadsRdfJsStore=ActorRdfUpdateQuadsRdfJsStore;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfUpdateQuadsRdfJsStore$1,exports)})(lib$1a);var lib$17={},MediatorJoinCoefficientsFixed$1={};Object.defineProperty(MediatorJoinCoefficientsFixed$1,"__esModule",{value:!0});MediatorJoinCoefficientsFixed$1.MediatorJoinCoefficientsFixed=void 0;const context_entries_1$f=lib$2x,core_1$4=lib$2A;class MediatorJoinCoefficientsFixed extends core_1$4.Mediator{constructor(args){super(args)}async mediateWith(action,testResults){var _a2;const errors=[],promises=testResults.map(({reply})=>reply).map(promise=>promise.catch(error=>{errors.push(error)})),coefficients=await Promise.all(promises);let costs=coefficients.map((coeff,i)=>{if(coeff)return coeff.iterations*this.cpuWeight+coeff.persistedItems*this.memoryWeight+coeff.blockingItems*this.timeWeight+coeff.requestTime*this.ioWeight});const maxCost=Math.max(...costs.filter(cost=>cost!==void 0)),limitIndicator=action.context.get(context_entries_1$f.KeysQueryOperation.limitIndicator);limitIndicator&&(costs=costs.map((cost,i)=>cost!==void 0&&coefficients[i].persistedItems>0&&coefficients[i].iterations>limitIndicator?cost+maxCost:cost));let minIndex=-1,minValue=Number.POSITIVE_INFINITY;for(const[i,cost]of costs.entries())cost!==void 0&&(minIndex===-1||cost<minValue)&&(minIndex=i,minValue=cost);if(minIndex<0)throw new Error(`All actors rejected their test in ${this.name}
${errors.map(error=>error.message).join(`
`)}`);const bestActor=testResults[minIndex].actor;return bestActor.includeInLogs&&((_a2=core_1$4.Actor.getContextLogger(action.context))==null||_a2.debug(`Determined physical join operator '${bestActor.logicalType}-${bestActor.physicalName}'`,{entries:action.entries.length,variables:await Promise.all(action.entries.map(async entry=>(await entry.output.metadata()).variables.map(variable=>variable.value))),costs:Object.fromEntries(costs.map((coeff,i)=>[`${testResults[i].actor.logicalType}-${testResults[i].actor.physicalName}`,coeff])),coefficients:Object.fromEntries(coefficients.map((coeff,i)=>[`${testResults[i].actor.logicalType}-${testResults[i].actor.physicalName}`,coeff]))})),bestActor}}__name(MediatorJoinCoefficientsFixed,"MediatorJoinCoefficientsFixed");MediatorJoinCoefficientsFixed$1.MediatorJoinCoefficientsFixed=MediatorJoinCoefficientsFixed;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(MediatorJoinCoefficientsFixed$1,exports)})(lib$17);var lib$16={},ActorQueryOperationAsk$1={};Object.defineProperty(ActorQueryOperationAsk$1,"__esModule",{value:!0});ActorQueryOperationAsk$1.ActorQueryOperationAsk=void 0;const bus_query_operation_1$I=lib$2y;class ActorQueryOperationAsk extends bus_query_operation_1$I.ActorQueryOperationTypedMediated{constructor(args){super(args,"ask")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){const output=await this.mediatorQueryOperation.mediate({operation:operation.input,context:context2}),{bindingsStream}=bus_query_operation_1$I.ActorQueryOperation.getSafeBindings(output);return{type:"boolean",execute:async()=>(await bindingsStream.take(1).toArray()).length===1}}}__name(ActorQueryOperationAsk,"ActorQueryOperationAsk");ActorQueryOperationAsk$1.ActorQueryOperationAsk=ActorQueryOperationAsk;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationAsk$1,exports)})(lib$16);var lib$15={},ActorQueryOperationConstruct$1={},BindingsToQuadsIterator$1={};Object.defineProperty(BindingsToQuadsIterator$1,"__esModule",{value:!0});BindingsToQuadsIterator$1.BindingsToQuadsIterator=void 0;const asynciterator_1$l=asynciterator,rdf_data_factory_1$f=rdfDataFactory,rdf_terms_1$6=rdfTerms,DF$f=new rdf_data_factory_1$f.DataFactory;class BindingsToQuadsIterator extends asynciterator_1$l.MultiTransformIterator{constructor(template,bindingsStream){super(bindingsStream,{autoStart:!1}),this.template=template,this.blankNodeCounter=0}static bindTerm(bindings,term){return term.termType==="Variable"?bindings.get(term):term}static bindQuad(bindings,pattern){try{return(0,rdf_terms_1$6.mapTermsNested)(pattern,term=>{const boundTerm=BindingsToQuadsIterator.bindTerm(bindings,term);if(!boundTerm)throw new Error("Unbound term");return boundTerm})}catch{}}static localizeBlankNode(blankNodeCounter,term){return term.termType==="BlankNode"?DF$f.blankNode(`${term.value}${blankNodeCounter}`):term}static localizeQuad(blankNodeCounter,pattern){return(0,rdf_terms_1$6.mapTermsNested)(pattern,term=>BindingsToQuadsIterator.localizeBlankNode(blankNodeCounter,term))}bindTemplate(bindings,template,blankNodeCounter){return template.map(BindingsToQuadsIterator.localizeQuad.bind(null,blankNodeCounter)).map(x=>BindingsToQuadsIterator.bindQuad.bind(null,bindings)(x)).filter(Boolean)}_createTransformer(bindings){return new asynciterator_1$l.ArrayIterator(this.bindTemplate(bindings,this.template,this.blankNodeCounter++),{autoStart:!1})}}__name(BindingsToQuadsIterator,"BindingsToQuadsIterator");BindingsToQuadsIterator$1.BindingsToQuadsIterator=BindingsToQuadsIterator;Object.defineProperty(ActorQueryOperationConstruct$1,"__esModule",{value:!0});ActorQueryOperationConstruct$1.ActorQueryOperationConstruct=void 0;const bus_query_operation_1$H=lib$2y,rdf_terms_1$5=rdfTerms,sparqlalgebrajs_1$q=sparqlalgebrajs,BindingsToQuadsIterator_1=BindingsToQuadsIterator$1;class ActorQueryOperationConstruct extends bus_query_operation_1$H.ActorQueryOperationTypedMediated{constructor(args){super(args,"construct")}static getVariables(patterns){return(0,rdf_terms_1$5.uniqTerms)([].concat.apply([],patterns.map(pattern=>(0,rdf_terms_1$5.getVariables)((0,rdf_terms_1$5.getTermsNested)(pattern)))))}async testOperation(operation,context2){return!0}async runOperation(operationOriginal,context2){const variables2=ActorQueryOperationConstruct.getVariables(operationOriginal.template),operation={type:sparqlalgebrajs_1$q.Algebra.types.PROJECT,input:operationOriginal.input,variables:variables2},output=bus_query_operation_1$H.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation,context:context2})),quadStream=new BindingsToQuadsIterator_1.BindingsToQuadsIterator(operationOriginal.template,output.bindingsStream);return{metadata:__name(()=>output.metadata().then(meta=>({...meta,order:void 0,cardinality:{type:meta.cardinality.type,value:meta.cardinality.value*operationOriginal.template.length},canContainUndefs:!1,availableOrders:void 0})),"metadata"),quadStream,type:"quads"}}}__name(ActorQueryOperationConstruct,"ActorQueryOperationConstruct");ActorQueryOperationConstruct$1.ActorQueryOperationConstruct=ActorQueryOperationConstruct;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationConstruct$1,exports),__exportStar(BindingsToQuadsIterator$1,exports)})(lib$15);var lib$14={},ActorQueryOperationBgpJoin$1={};Object.defineProperty(ActorQueryOperationBgpJoin$1,"__esModule",{value:!0});ActorQueryOperationBgpJoin$1.ActorQueryOperationBgpJoin=void 0;const bus_query_operation_1$G=lib$2y,sparqlalgebrajs_1$p=sparqlalgebrajs;class ActorQueryOperationBgpJoin extends bus_query_operation_1$G.ActorQueryOperationTypedMediated{constructor(args){super(args,"bgp")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){return this.mediatorQueryOperation.mediate({operation:ActorQueryOperationBgpJoin.FACTORY.createJoin(operation.patterns),context:context2})}}__name(ActorQueryOperationBgpJoin,"ActorQueryOperationBgpJoin");ActorQueryOperationBgpJoin$1.ActorQueryOperationBgpJoin=ActorQueryOperationBgpJoin;ActorQueryOperationBgpJoin.FACTORY=new sparqlalgebrajs_1$p.Factory;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationBgpJoin$1,exports)})(lib$14);var lib$13={},ActorQueryOperationDistinctHash$1={};Object.defineProperty(ActorQueryOperationDistinctHash$1,"__esModule",{value:!0});ActorQueryOperationDistinctHash$1.ActorQueryOperationDistinctHash=void 0;const bus_query_operation_1$F=lib$2y;class ActorQueryOperationDistinctHash extends bus_query_operation_1$F.ActorQueryOperationTypedMediated{constructor(args){super(args,"distinct")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){const output=bus_query_operation_1$F.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:operation.input,context:context2}));return{type:"bindings",bindingsStream:output.bindingsStream.filter(await this.newHashFilter(context2)),metadata:output.metadata}}async newHashFilter(context2){const{hashFunction}=await this.mediatorHashBindings.mediate({allowHashCollisions:!0,context:context2}),hashes={};return bindings=>{const hash2=hashFunction(bindings);return!(hash2 in hashes)&&(hashes[hash2]=!0)}}}__name(ActorQueryOperationDistinctHash,"ActorQueryOperationDistinctHash");ActorQueryOperationDistinctHash$1.ActorQueryOperationDistinctHash=ActorQueryOperationDistinctHash;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationDistinctHash$1,exports)})(lib$13);var lib$12={},ActorQueryOperationExtend$1={},dist={},AsyncEvaluator$1={};const Yallist=yallist,MAX=Symbol("max"),LENGTH=Symbol("length"),LENGTH_CALCULATOR=Symbol("lengthCalculator"),ALLOW_STALE=Symbol("allowStale"),MAX_AGE=Symbol("maxAge"),DISPOSE=Symbol("dispose"),NO_DISPOSE_ON_SET=Symbol("noDisposeOnSet"),LRU_LIST=Symbol("lruList"),CACHE=Symbol("cache"),UPDATE_AGE_ON_GET=Symbol("updateAgeOnGet"),naiveLength=__name(()=>1,"naiveLength");let LRUCache$4=__name(class{constructor(options){if(typeof options=="number"&&(options={max:options}),options||(options={}),options.max&&(typeof options.max!="number"||options.max<0))throw new TypeError("max must be a non-negative number");this[MAX]=options.max||1/0;const lc=options.length||naiveLength;if(this[LENGTH_CALCULATOR]=typeof lc!="function"?naiveLength:lc,this[ALLOW_STALE]=options.stale||!1,options.maxAge&&typeof options.maxAge!="number")throw new TypeError("maxAge must be a number");this[MAX_AGE]=options.maxAge||0,this[DISPOSE]=options.dispose,this[NO_DISPOSE_ON_SET]=options.noDisposeOnSet||!1,this[UPDATE_AGE_ON_GET]=options.updateAgeOnGet||!1,this.reset()}set max(mL){if(typeof mL!="number"||mL<0)throw new TypeError("max must be a non-negative number");this[MAX]=mL||1/0,trim(this)}get max(){return this[MAX]}set allowStale(allowStale){this[ALLOW_STALE]=!!allowStale}get allowStale(){return this[ALLOW_STALE]}set maxAge(mA){if(typeof mA!="number")throw new TypeError("maxAge must be a non-negative number");this[MAX_AGE]=mA,trim(this)}get maxAge(){return this[MAX_AGE]}set lengthCalculator(lC){typeof lC!="function"&&(lC=naiveLength),lC!==this[LENGTH_CALCULATOR]&&(this[LENGTH_CALCULATOR]=lC,this[LENGTH]=0,this[LRU_LIST].forEach(hit=>{hit.length=this[LENGTH_CALCULATOR](hit.value,hit.key),this[LENGTH]+=hit.length})),trim(this)}get lengthCalculator(){return this[LENGTH_CALCULATOR]}get length(){return this[LENGTH]}get itemCount(){return this[LRU_LIST].length}rforEach(fn,thisp){thisp=thisp||this;for(let walker=this[LRU_LIST].tail;walker!==null;){const prev=walker.prev;forEachStep(this,fn,walker,thisp),walker=prev}}forEach(fn,thisp){thisp=thisp||this;for(let walker=this[LRU_LIST].head;walker!==null;){const next=walker.next;forEachStep(this,fn,walker,thisp),walker=next}}keys(){return this[LRU_LIST].toArray().map(k=>k.key)}values(){return this[LRU_LIST].toArray().map(k=>k.value)}reset(){this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length&&this[LRU_LIST].forEach(hit=>this[DISPOSE](hit.key,hit.value)),this[CACHE]=new Map,this[LRU_LIST]=new Yallist,this[LENGTH]=0}dump(){return this[LRU_LIST].map(hit=>isStale(this,hit)?!1:{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)}).toArray().filter(h=>h)}dumpLru(){return this[LRU_LIST]}set(key,value,maxAge){if(maxAge=maxAge||this[MAX_AGE],maxAge&&typeof maxAge!="number")throw new TypeError("maxAge must be a number");const now2=maxAge?Date.now():0,len=this[LENGTH_CALCULATOR](value,key);if(this[CACHE].has(key)){if(len>this[MAX])return del(this,this[CACHE].get(key)),!1;const item=this[CACHE].get(key).value;return this[DISPOSE]&&(this[NO_DISPOSE_ON_SET]||this[DISPOSE](key,item.value)),item.now=now2,item.maxAge=maxAge,item.value=value,this[LENGTH]+=len-item.length,item.length=len,this.get(key),trim(this),!0}const hit=new Entry(key,value,len,now2,maxAge);return hit.length>this[MAX]?(this[DISPOSE]&&this[DISPOSE](key,value),!1):(this[LENGTH]+=hit.length,this[LRU_LIST].unshift(hit),this[CACHE].set(key,this[LRU_LIST].head),trim(this),!0)}has(key){if(!this[CACHE].has(key))return!1;const hit=this[CACHE].get(key).value;return!isStale(this,hit)}get(key){return get10(this,key,!0)}peek(key){return get10(this,key,!1)}pop(){const node2=this[LRU_LIST].tail;return node2?(del(this,node2),node2.value):null}del(key){del(this,this[CACHE].get(key))}load(arr){this.reset();const now2=Date.now();for(let l=arr.length-1;l>=0;l--){const hit=arr[l],expiresAt=hit.e||0;if(expiresAt===0)this.set(hit.k,hit.v);else{const maxAge=expiresAt-now2;maxAge>0&&this.set(hit.k,hit.v,maxAge)}}}prune(){this[CACHE].forEach((value,key)=>get10(this,key,!1))}},"LRUCache");const get10=__name((self2,key,doUse)=>{const node2=self2[CACHE].get(key);if(node2){const hit=node2.value;if(isStale(self2,hit)){if(del(self2,node2),!self2[ALLOW_STALE])return}else doUse&&(self2[UPDATE_AGE_ON_GET]&&(node2.value.now=Date.now()),self2[LRU_LIST].unshiftNode(node2));return hit.value}},"get"),isStale=__name((self2,hit)=>{if(!hit||!hit.maxAge&&!self2[MAX_AGE])return!1;const diff=Date.now()-hit.now;return hit.maxAge?diff>hit.maxAge:self2[MAX_AGE]&&diff>self2[MAX_AGE]},"isStale"),trim=__name(self2=>{if(self2[LENGTH]>self2[MAX])for(let walker=self2[LRU_LIST].tail;self2[LENGTH]>self2[MAX]&&walker!==null;){const prev=walker.prev;del(self2,walker),walker=prev}},"trim"),del=__name((self2,node2)=>{if(node2){const hit=node2.value;self2[DISPOSE]&&self2[DISPOSE](hit.key,hit.value),self2[LENGTH]-=hit.length,self2[CACHE].delete(hit.key),self2[LRU_LIST].removeNode(node2)}},"del");class Entry{constructor(key,value,length,now2,maxAge){this.key=key,this.value=value,this.length=length,this.now=now2,this.maxAge=maxAge||0}}__name(Entry,"Entry");const forEachStep=__name((self2,fn,node2,thisp)=>{let hit=node2.value;isStale(self2,hit)&&(del(self2,node2),self2[ALLOW_STALE]||(hit=void 0)),hit&&fn.call(thisp,hit.value,hit.key,self2)},"forEachStep");var lruCache=LRUCache$4,AlgebraTransformer$1={},expressions={},Expressions={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.asTermType=exports.ExpressionType=void 0,function(ExpressionType){ExpressionType.Aggregate="aggregate",ExpressionType.Existence="existence",ExpressionType.Named="named",ExpressionType.Operator="operator",ExpressionType.SpecialOperator="specialOperator",ExpressionType.Term="term",ExpressionType.Variable="variable",ExpressionType.AsyncExtension="asyncExtension",ExpressionType.SyncExtension="syncExtension"}(exports.ExpressionType||(exports.ExpressionType={}));function asTermType(type){if(type==="namedNode"||type==="literal"||type==="blankNode"||type==="quad")return type}__name(asTermType,"asTermType"),exports.asTermType=asTermType})(Expressions);var Variable$1={};Object.defineProperty(Variable$1,"__esModule",{value:!0});Variable$1.Variable=void 0;const Expressions_1$7=Expressions;class Variable2{constructor(name){this.expressionType=Expressions_1$7.ExpressionType.Variable,this.name=name}}__name(Variable2,"Variable");Variable$1.Variable=Variable2;var Term={},TermTransformer={},Consts={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.NamedOperators=exports.SetFunctions=exports.SetFunction=exports.Operators=exports.SpecialOperators=exports.RegularOperators=exports.SpecialOperator=exports.RegularOperator=exports.TypeURL=exports.TypeAlias=void 0,function(TypeAlias){TypeAlias.SPARQL_NUMERIC="SPARQL_NUMERIC",TypeAlias.SPARQL_STRINGLY="SPARQL_STRINGLY"}(exports.TypeAlias||(exports.TypeAlias={}));var TypeURL;(function(TypeURL2){TypeURL2.XSD_ANY_URI="http://www.w3.org/2001/XMLSchema#anyURI",TypeURL2.XSD_STRING="http://www.w3.org/2001/XMLSchema#string",TypeURL2.RDF_LANG_STRING="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",TypeURL2.XSD_BOOLEAN="http://www.w3.org/2001/XMLSchema#boolean",TypeURL2.XSD_DATE_TIME="http://www.w3.org/2001/XMLSchema#dateTime",TypeURL2.XSD_DATE_TIME_STAMP="http://www.w3.org/2001/XMLSchema#dateTimeStamp",TypeURL2.XSD_DATE="http://www.w3.org/2001/XMLSchema#date",TypeURL2.XSD_G_MONTH="http://www.w3.org/2001/XMLSchema#gMonth",TypeURL2.XSD_G_MONTHDAY="http://www.w3.org/2001/XMLSchema#gMonthDay",TypeURL2.XSD_G_YEAR="http://www.w3.org/2001/XMLSchema#gYear",TypeURL2.XSD_G_YEAR_MONTH="http://www.w3.org/2001/XMLSchema#gYearMonth",TypeURL2.XSD_TIME="http://www.w3.org/2001/XMLSchema#time",TypeURL2.XSD_G_DAY="http://www.w3.org/2001/XMLSchema#gDay",TypeURL2.XSD_DECIMAL="http://www.w3.org/2001/XMLSchema#decimal",TypeURL2.XSD_FLOAT="http://www.w3.org/2001/XMLSchema#float",TypeURL2.XSD_DOUBLE="http://www.w3.org/2001/XMLSchema#double",TypeURL2.XSD_INTEGER="http://www.w3.org/2001/XMLSchema#integer",TypeURL2.XSD_NON_POSITIVE_INTEGER="http://www.w3.org/2001/XMLSchema#nonPositiveInteger",TypeURL2.XSD_NEGATIVE_INTEGER="http://www.w3.org/2001/XMLSchema#negativeInteger",TypeURL2.XSD_LONG="http://www.w3.org/2001/XMLSchema#long",TypeURL2.XSD_INT="http://www.w3.org/2001/XMLSchema#int",TypeURL2.XSD_SHORT="http://www.w3.org/2001/XMLSchema#short",TypeURL2.XSD_BYTE="http://www.w3.org/2001/XMLSchema#byte",TypeURL2.XSD_NON_NEGATIVE_INTEGER="http://www.w3.org/2001/XMLSchema#nonNegativeInteger",TypeURL2.XSD_POSITIVE_INTEGER="http://www.w3.org/2001/XMLSchema#positiveInteger",TypeURL2.XSD_UNSIGNED_LONG="http://www.w3.org/2001/XMLSchema#unsignedLong",TypeURL2.XSD_UNSIGNED_INT="http://www.w3.org/2001/XMLSchema#unsignedInt",TypeURL2.XSD_UNSIGNED_SHORT="http://www.w3.org/2001/XMLSchema#unsignedShort",TypeURL2.XSD_UNSIGNED_BYTE="http://www.w3.org/2001/XMLSchema#unsignedByte",TypeURL2.XSD_NORMALIZED_STRING="http://www.w3.org/2001/XMLSchema#normalizedString",TypeURL2.XSD_TOKEN="http://www.w3.org/2001/XMLSchema#token",TypeURL2.XSD_LANGUAGE="http://www.w3.org/2001/XMLSchema#language",TypeURL2.XSD_NM_TOKEN="http://www.w3.org/2001/XMLSchema#NMTOKEN",TypeURL2.XSD_NAME="http://www.w3.org/2001/XMLSchema#name",TypeURL2.XSD_NC_NAME="http://www.w3.org/2001/XMLSchema#NCName",TypeURL2.XSD_ENTITY="http://www.w3.org/2001/XMLSchema#ENTITY",TypeURL2.XSD_ID="http://www.w3.org/2001/XMLSchema#ID",TypeURL2.XSD_ID_REF="http://www.w3.org/2001/XMLSchema#IDREF",TypeURL2.XSD_DURATION="http://www.w3.org/2001/XMLSchema#duration",TypeURL2.XSD_YEAR_MONTH_DURATION="http://www.w3.org/2001/XMLSchema#yearMonthDuration",TypeURL2.XSD_DAY_TIME_DURATION="http://www.w3.org/2001/XMLSchema#dayTimeDuration"})(TypeURL=exports.TypeURL||(exports.TypeURL={}));var RegularOperator;(function(RegularOperator2){RegularOperator2.NOT="!",RegularOperator2.UMINUS="uminus",RegularOperator2.UPLUS="uplus",RegularOperator2.EQUAL="=",RegularOperator2.NOT_EQUAL="!=",RegularOperator2.LT="<",RegularOperator2.GT=">",RegularOperator2.LTE="<=",RegularOperator2.GTE=">=",RegularOperator2.MULTIPLICATION="*",RegularOperator2.DIVISION="/",RegularOperator2.ADDITION="+",RegularOperator2.SUBTRACTION="-",RegularOperator2.IS_IRI="isiri",RegularOperator2.IS_URI="isuri",RegularOperator2.IS_BLANK="isblank",RegularOperator2.IS_LITERAL="isliteral",RegularOperator2.IS_NUMERIC="isnumeric",RegularOperator2.STR="str",RegularOperator2.LANG="lang",RegularOperator2.DATATYPE="datatype",RegularOperator2.IRI="iri",RegularOperator2.URI="uri",RegularOperator2.STRDT="strdt",RegularOperator2.STRLANG="strlang",RegularOperator2.UUID="uuid",RegularOperator2.STRUUID="struuid",RegularOperator2.STRLEN="strlen",RegularOperator2.SUBSTR="substr",RegularOperator2.UCASE="ucase",RegularOperator2.LCASE="lcase",RegularOperator2.STRSTARTS="strstarts",RegularOperator2.STRENDS="strends",RegularOperator2.CONTAINS="contains",RegularOperator2.STRBEFORE="strbefore",RegularOperator2.STRAFTER="strafter",RegularOperator2.ENCODE_FOR_URI="encode_for_uri",RegularOperator2.LANG_MATCHES="langmatches",RegularOperator2.REGEX="regex",RegularOperator2.REPLACE="replace",RegularOperator2.ABS="abs",RegularOperator2.ROUND="round",RegularOperator2.CEIL="ceil",RegularOperator2.FLOOR="floor",RegularOperator2.RAND="rand",RegularOperator2.NOW="now",RegularOperator2.YEAR="year",RegularOperator2.MONTH="month",RegularOperator2.DAY="day",RegularOperator2.HOURS="hours",RegularOperator2.MINUTES="minutes",RegularOperator2.SECONDS="seconds",RegularOperator2.TIMEZONE="timezone",RegularOperator2.TZ="tz",RegularOperator2.MD5="md5",RegularOperator2.SHA1="sha1",RegularOperator2.SHA256="sha256",RegularOperator2.SHA384="sha384",RegularOperator2.SHA512="sha512",RegularOperator2.TRIPLE="triple",RegularOperator2.SUBJECT="subject",RegularOperator2.PREDICATE="predicate",RegularOperator2.OBJECT="object",RegularOperator2.IS_TRIPLE="istriple"})(RegularOperator=exports.RegularOperator||(exports.RegularOperator={}));var SpecialOperator2;(function(SpecialOperator3){SpecialOperator3.BOUND="bound",SpecialOperator3.IF="if",SpecialOperator3.COALESCE="coalesce",SpecialOperator3.LOGICAL_OR="||",SpecialOperator3.LOGICAL_AND="&&",SpecialOperator3.SAME_TERM="sameterm",SpecialOperator3.IN="in",SpecialOperator3.NOT_IN="notin",SpecialOperator3.CONCAT="concat",SpecialOperator3.BNODE="bnode"})(SpecialOperator2=exports.SpecialOperator||(exports.SpecialOperator={})),exports.RegularOperators=new Set(Object.values(RegularOperator)),exports.SpecialOperators=new Set(Object.values(SpecialOperator2)),exports.Operators=new Set([...exports.RegularOperators,...exports.SpecialOperators]);var SetFunction;(function(SetFunction2){SetFunction2.COUNT="count",SetFunction2.SUM="sum",SetFunction2.MIN="min",SetFunction2.MAX="max",SetFunction2.AVG="avg",SetFunction2.GROUP_CONCAT="group_concat",SetFunction2.SAMPLE="sample"})(SetFunction=exports.SetFunction||(exports.SetFunction={})),exports.SetFunctions=new Set(Object.values(SetFunction)),exports.NamedOperators=new Set([TypeURL.XSD_STRING,TypeURL.XSD_FLOAT,TypeURL.XSD_DOUBLE,TypeURL.XSD_DECIMAL,TypeURL.XSD_INTEGER,TypeURL.XSD_DATE_TIME,TypeURL.XSD_DATE,TypeURL.XSD_BOOLEAN,TypeURL.XSD_TIME,TypeURL.XSD_DURATION,TypeURL.XSD_DAY_TIME_DURATION,TypeURL.XSD_YEAR_MONTH_DURATION])})(Consts);var Errors={};Object.defineProperty(Errors,"__esModule",{value:!0});Errors.NoExistenceHook=Errors.NoAggregator=Errors.ExtensionFunctionError=Errors.UnknownNamedOperator=Errors.UnknownOperator=Errors.InvalidTermType=Errors.InvalidExpressionType=Errors.InvalidExpression=Errors.InvalidArity=Errors.UnexpectedError=Errors.ParseError=Errors.EmptyAggregateError=Errors.IncompatibleLanguageOperation=Errors.InvalidTimezoneCall=Errors.CastError=Errors.InvalidCompareArgumentTypes=Errors.InvalidArgumentTypes=Errors.InError=Errors.CoalesceError=Errors.RDFEqualTypeError=Errors.EBVCoercionError=Errors.UnboundVariableError=Errors.InvalidLexicalForm=Errors.isExpressionError=Errors.ExpressionError=void 0;class ExpressionError extends Error{}__name(ExpressionError,"ExpressionError");Errors.ExpressionError=ExpressionError;function isExpressionError(error){return error instanceof ExpressionError}__name(isExpressionError,"isExpressionError");Errors.isExpressionError=isExpressionError;class InvalidLexicalForm extends ExpressionError{constructor(arg){super(`Invalid lexical form '${pp(arg)}'`),this.arg=arg}}__name(InvalidLexicalForm,"InvalidLexicalForm");Errors.InvalidLexicalForm=InvalidLexicalForm;class UnboundVariableError extends ExpressionError{constructor(variable,bindings){super(`Unbound variable '${pp(variable)}'`),this.variable=variable,this.bindings=bindings}}__name(UnboundVariableError,"UnboundVariableError");Errors.UnboundVariableError=UnboundVariableError;class EBVCoercionError extends ExpressionError{constructor(arg){super(`Cannot coerce term to EBV '${pp(arg)}'`),this.arg=arg}}__name(EBVCoercionError,"EBVCoercionError");Errors.EBVCoercionError=EBVCoercionError;class RDFEqualTypeError extends ExpressionError{constructor(args){super("Equality test for literals with unsupported datatypes"),this.args=args}}__name(RDFEqualTypeError,"RDFEqualTypeError");Errors.RDFEqualTypeError=RDFEqualTypeError;class CoalesceError extends ExpressionError{constructor(errors){super("All COALESCE arguments threw errors"),this.errors=errors}}__name(CoalesceError,"CoalesceError");Errors.CoalesceError=CoalesceError;class InError extends ExpressionError{constructor(errors){super(`Some argument to IN errorred and none where equal. ${errors.map(err=>`(${err.toString()}) `).join("and ")}`),this.errors=errors}}__name(InError,"InError");Errors.InError=InError;class InvalidArgumentTypes extends ExpressionError{constructor(args,op){super(`Argument types not valid for operator: '${pp(op)}' with '${pp(args)}`),this.args=args,this.op=op}}__name(InvalidArgumentTypes,"InvalidArgumentTypes");Errors.InvalidArgumentTypes=InvalidArgumentTypes;class InvalidCompareArgumentTypes extends ExpressionError{constructor(arg0,arg1){super(`Compared argument types are supported: '${arg0.termType}' and '${arg1.termType}'`),this.arg0=arg0,this.arg1=arg1}}__name(InvalidCompareArgumentTypes,"InvalidCompareArgumentTypes");Errors.InvalidCompareArgumentTypes=InvalidCompareArgumentTypes;class CastError extends ExpressionError{constructor(arg,cast){super(`Invalid cast: '${pp(arg)}' to '${pp(cast)}'`),this.arg=arg}}__name(CastError,"CastError");Errors.CastError=CastError;class InvalidTimezoneCall extends ExpressionError{constructor(dateString){super(`TIMEZONE call on ${dateString} which has no timezone`),this.dateString=dateString}}__name(InvalidTimezoneCall,"InvalidTimezoneCall");Errors.InvalidTimezoneCall=InvalidTimezoneCall;class IncompatibleLanguageOperation extends ExpressionError{constructor(arg1,arg2){super(`Operation on incompatible language literals '${pp(arg1)}' and '${pp(arg2)}'`),this.arg1=arg1,this.arg2=arg2}}__name(IncompatibleLanguageOperation,"IncompatibleLanguageOperation");Errors.IncompatibleLanguageOperation=IncompatibleLanguageOperation;class EmptyAggregateError extends ExpressionError{constructor(){super("Empty aggregate expression")}}__name(EmptyAggregateError,"EmptyAggregateError");Errors.EmptyAggregateError=EmptyAggregateError;class ParseError2 extends ExpressionError{constructor(str,type){super(`Failed to parse ${str} as ${type}.`)}}__name(ParseError2,"ParseError");Errors.ParseError=ParseError2;class UnexpectedError extends Error{constructor(message,payload){super(`Programmer Error '${message}'`),this.payload=payload}}__name(UnexpectedError,"UnexpectedError");Errors.UnexpectedError=UnexpectedError;class InvalidArity extends Error{constructor(args,op){super(`The number of args does not match the arity of the operator '${pp(op)}'.`),this.args=args,this.op=op}}__name(InvalidArity,"InvalidArity");Errors.InvalidArity=InvalidArity;class InvalidExpression extends Error{constructor(expr){super(`Invalid SPARQL Expression '${pp(expr)}'`)}}__name(InvalidExpression,"InvalidExpression");Errors.InvalidExpression=InvalidExpression;class InvalidExpressionType extends Error{constructor(expr){super(`Invalid expression type for SPARQL Expression '${pp(expr)}'`),this.expr=expr}}__name(InvalidExpressionType,"InvalidExpressionType");Errors.InvalidExpressionType=InvalidExpressionType;class InvalidTermType extends Error{constructor(term){super(`Invalid term type for term '${pp(term)}'`),this.term=term}}__name(InvalidTermType,"InvalidTermType");Errors.InvalidTermType=InvalidTermType;class UnknownOperator extends Error{constructor(name){super(`Unknown operator: '${pp(name)}`)}}__name(UnknownOperator,"UnknownOperator");Errors.UnknownOperator=UnknownOperator;class UnknownNamedOperator extends Error{constructor(name){super(`Unknown named operator: '${pp(name)}'`)}}__name(UnknownNamedOperator,"UnknownNamedOperator");Errors.UnknownNamedOperator=UnknownNamedOperator;class ExtensionFunctionError extends Error{constructor(name,functionError){functionError instanceof Error?super(`Error thrown in ${name}: ${functionError.message}${functionError.stack?`
${functionError.stack}`:""}`):super(`Error thrown in ${name}`)}}__name(ExtensionFunctionError,"ExtensionFunctionError");Errors.ExtensionFunctionError=ExtensionFunctionError;class NoAggregator extends Error{constructor(name){super(`Aggregate expression ${pp(name)} found, but no aggregate hook provided.`)}}__name(NoAggregator,"NoAggregator");Errors.NoAggregator=NoAggregator;class NoExistenceHook extends Error{constructor(){super("EXISTS found, but no existence hook provided.")}}__name(NoExistenceHook,"NoExistenceHook");Errors.NoExistenceHook=NoExistenceHook;function pp(object2){return JSON.stringify(object2)}__name(pp,"pp");var Parsing={},DateTimeHelpers={};Object.defineProperty(DateTimeHelpers,"__esModule",{value:!0});DateTimeHelpers.extractTimeZone=DateTimeHelpers.extractRawTimeZone=DateTimeHelpers.dayTimeDurationsToSeconds=DateTimeHelpers.yearMonthDurationsToMonths=DateTimeHelpers.trimToDayTimeDuration=DateTimeHelpers.trimToYearMonthDuration=DateTimeHelpers.toUTCDate=DateTimeHelpers.toJSDate=DateTimeHelpers.negateDuration=DateTimeHelpers.toDateTimeRepresentation=DateTimeHelpers.defaultedDateTimeRepresentation=DateTimeHelpers.simplifyDurationRepresentation=DateTimeHelpers.defaultedDurationRepresentation=DateTimeHelpers.defaultedYearMonthDurationRepresentation=DateTimeHelpers.defaultedDayTimeDurationRepresentation=void 0;function defaultedDayTimeDurationRepresentation(rep){return{day:rep.day||0,hours:rep.hours||0,minutes:rep.minutes||0,seconds:rep.seconds||0}}__name(defaultedDayTimeDurationRepresentation,"defaultedDayTimeDurationRepresentation");DateTimeHelpers.defaultedDayTimeDurationRepresentation=defaultedDayTimeDurationRepresentation;function defaultedYearMonthDurationRepresentation(rep){return{year:rep.year||0,month:rep.month||0}}__name(defaultedYearMonthDurationRepresentation,"defaultedYearMonthDurationRepresentation");DateTimeHelpers.defaultedYearMonthDurationRepresentation=defaultedYearMonthDurationRepresentation;function defaultedDurationRepresentation(rep){return Object.assign(Object.assign({},defaultedDayTimeDurationRepresentation(rep)),defaultedYearMonthDurationRepresentation(rep))}__name(defaultedDurationRepresentation,"defaultedDurationRepresentation");DateTimeHelpers.defaultedDurationRepresentation=defaultedDurationRepresentation;function simplifyDurationRepresentation(rep){const temp=defaultedDurationRepresentation(rep),res={},years=temp.year+Math.trunc(temp.month/12);years&&(res.year=years,temp.month%=12),temp.month&&(res.month=temp.month);const days=temp.day+Math.trunc(temp.hours/24)+Math.trunc(temp.minutes/(24*60))+Math.trunc(temp.seconds/(24*60*60));days&&(res.day=days,temp.hours%=24,temp.minutes%=24*60,temp.seconds%=24*60*60);const hours2=temp.hours+Math.trunc(temp.minutes/60)+Math.trunc(temp.seconds/(60*60));hours2&&(res.hours=hours2,temp.minutes%=60,temp.seconds%=60*60);const minutes2=temp.minutes+Math.trunc(temp.seconds/60);return minutes2&&(res.minutes=minutes2,temp.seconds%=60),temp.seconds&&(res.seconds=temp.seconds),res}__name(simplifyDurationRepresentation,"simplifyDurationRepresentation");DateTimeHelpers.simplifyDurationRepresentation=simplifyDurationRepresentation;function defaultedDateTimeRepresentation(rep){return Object.assign(Object.assign({},rep),{day:rep.day||1,hours:rep.hours||0,month:rep.month||1,year:rep.year||0,seconds:rep.seconds||0,minutes:rep.minutes||0})}__name(defaultedDateTimeRepresentation,"defaultedDateTimeRepresentation");DateTimeHelpers.defaultedDateTimeRepresentation=defaultedDateTimeRepresentation;function toDateTimeRepresentation({date,timeZone}){return{year:date.getFullYear(),month:date.getMonth()+1,day:date.getDate(),hours:date.getHours(),minutes:date.getMinutes(),seconds:date.getSeconds(),zoneHours:timeZone.zoneHours,zoneMinutes:timeZone.zoneMinutes}}__name(toDateTimeRepresentation,"toDateTimeRepresentation");DateTimeHelpers.toDateTimeRepresentation=toDateTimeRepresentation;function negateDuration(dur){return{year:dur.year!==void 0?-1*dur.year:void 0,month:dur.month!==void 0?-1*dur.month:void 0,day:dur.day!==void 0?-1*dur.day:void 0,hours:dur.hours!==void 0?-1*dur.hours:void 0,minutes:dur.minutes!==void 0?-1*dur.minutes:void 0,seconds:dur.seconds!==void 0?-1*dur.seconds:void 0}}__name(negateDuration,"negateDuration");DateTimeHelpers.negateDuration=negateDuration;function toJSDate(date){const res=new Date(date.year,date.month-1,date.day,date.hours,date.minutes,Math.trunc(date.seconds),date.seconds%1*1e3);return 0<=date.year&&date.year<100&&res.setFullYear(res.getFullYear()-1900),res}__name(toJSDate,"toJSDate");DateTimeHelpers.toJSDate=toJSDate;function toUTCDate(date,defaultTimezone){const localTime=toJSDate(defaultedDateTimeRepresentation(date)),minutesCorrectionLocal=localTime.getTimezoneOffset(),hourCorrectionUTC=date.zoneHours===void 0?defaultTimezone.zoneHours:date.zoneHours,minutesCorrectionUTC=date.zoneMinutes===void 0?defaultTimezone.zoneMinutes:date.zoneMinutes;return new Date(localTime.getTime()-(minutesCorrectionLocal+hourCorrectionUTC*60+minutesCorrectionUTC)*60*1e3)}__name(toUTCDate,"toUTCDate");DateTimeHelpers.toUTCDate=toUTCDate;function trimToYearMonthDuration(dur){return{year:dur.year,month:dur.month}}__name(trimToYearMonthDuration,"trimToYearMonthDuration");DateTimeHelpers.trimToYearMonthDuration=trimToYearMonthDuration;function trimToDayTimeDuration(dur){return{day:dur.day,hours:dur.hours,minutes:dur.minutes,seconds:dur.seconds}}__name(trimToDayTimeDuration,"trimToDayTimeDuration");DateTimeHelpers.trimToDayTimeDuration=trimToDayTimeDuration;function yearMonthDurationsToMonths(dur){return dur.year*12+dur.month}__name(yearMonthDurationsToMonths,"yearMonthDurationsToMonths");DateTimeHelpers.yearMonthDurationsToMonths=yearMonthDurationsToMonths;function dayTimeDurationsToSeconds(dur){return((dur.day*24+dur.hours)*60+dur.minutes)*60+dur.seconds}__name(dayTimeDurationsToSeconds,"dayTimeDurationsToSeconds");DateTimeHelpers.dayTimeDurationsToSeconds=dayTimeDurationsToSeconds;function extractRawTimeZone(zoneContained){return/(Z|([+-]\d\d:\d\d))?$/u.exec(zoneContained)[0]}__name(extractRawTimeZone,"extractRawTimeZone");DateTimeHelpers.extractRawTimeZone=extractRawTimeZone;function extractTimeZone(date){return{zoneHours:date.getTimezoneOffset()/60,zoneMinutes:date.getTimezoneOffset()%60}}__name(extractTimeZone,"extractTimeZone");DateTimeHelpers.extractTimeZone=extractTimeZone;var SpecAlgos={};Object.defineProperty(SpecAlgos,"__esModule",{value:!0});SpecAlgos.elapsedDuration=SpecAlgos.addDurationToDateTime=SpecAlgos.maximumDayInMonthFor=void 0;const DateTimeHelpers_1$6=DateTimeHelpers;function fDiv(arg,high,low=0){const first3=arg-low,second=high-low,intDiv=Math.floor(first3/second);return{intDiv,remainder:arg-intDiv*second}}__name(fDiv,"fDiv");function maximumDayInMonthFor(yearValue,monthValue){const{intDiv:additionalYears,remainder:month2}=fDiv(monthValue,13,1),year2=yearValue+additionalYears;return[1,3,5,7,8,10,12].includes(month2)?31:[4,6,9,11].includes(month2)?30:month2===2&&(fDiv(year2,400).remainder===0||fDiv(year2,100).remainder!==0&&fDiv(year2,4).remainder===0)?29:28}__name(maximumDayInMonthFor,"maximumDayInMonthFor");SpecAlgos.maximumDayInMonthFor=maximumDayInMonthFor;function addDurationToDateTime(date,duration){const newDate=Object.assign({},date);let tempDiv=fDiv(date.month+duration.month,13,1);for(newDate.month=tempDiv.remainder,newDate.year=date.year+duration.year+tempDiv.intDiv,tempDiv=fDiv(date.seconds+duration.seconds,60),newDate.seconds=tempDiv.remainder,tempDiv=fDiv(date.minutes+duration.minutes+tempDiv.intDiv,60),newDate.minutes=tempDiv.remainder,tempDiv=fDiv(date.hours+duration.hours+tempDiv.intDiv,24),newDate.hours=tempDiv.remainder,newDate.day=date.day+duration.day+tempDiv.intDiv;;){let carry;if(newDate.day<1)newDate.day+=maximumDayInMonthFor(newDate.year,newDate.month-1),carry=-1;else if(newDate.day>maximumDayInMonthFor(newDate.year,newDate.month))newDate.day-=maximumDayInMonthFor(newDate.year,newDate.month),carry=1;else break;tempDiv=fDiv(newDate.month+carry,13,1),newDate.month=tempDiv.remainder,newDate.year+=tempDiv.intDiv}return newDate}__name(addDurationToDateTime,"addDurationToDateTime");SpecAlgos.addDurationToDateTime=addDurationToDateTime;function elapsedDuration(first3,second,defaultTimeZone){const d1=(0,DateTimeHelpers_1$6.toUTCDate)(first3,defaultTimeZone),d2=(0,DateTimeHelpers_1$6.toUTCDate)(second,defaultTimeZone),diff=d1.getTime()-d2.getTime();return{day:Math.floor(diff/(1e3*60*60*24)),hours:Math.floor(diff%(1e3*60*60*24)/(1e3*60*60)),minutes:Math.floor(diff%(1e3*60*60)/(1e3*60)),seconds:diff%(1e3*60)}}__name(elapsedDuration,"elapsedDuration");SpecAlgos.elapsedDuration=elapsedDuration;Object.defineProperty(Parsing,"__esModule",{value:!0});Parsing.parseDayTimeDuration=Parsing.parseYearMonthDuration=Parsing.parseDuration=Parsing.parseTime=Parsing.parseDate=Parsing.parseDateTime=Parsing.parseXSDInteger=Parsing.parseXSDDecimal=Parsing.parseXSDFloat=void 0;const DateTimeHelpers_1$5=DateTimeHelpers,Errors_1$1=Errors,SpecAlgos_1$1=SpecAlgos;function parseXSDFloat(value){const numb=Number(value);return Number.isNaN(numb)?value==="NaN"?Number.NaN:value==="INF"||value==="+INF"?Number.POSITIVE_INFINITY:value==="-INF"?Number.NEGATIVE_INFINITY:void 0:numb}__name(parseXSDFloat,"parseXSDFloat");Parsing.parseXSDFloat=parseXSDFloat;function parseXSDDecimal(value){const numb=Number(value);return Number.isNaN(numb)?void 0:numb}__name(parseXSDDecimal,"parseXSDDecimal");Parsing.parseXSDDecimal=parseXSDDecimal;function parseXSDInteger(value){const numb=Number.parseInt(value,10);return Number.isNaN(numb)?void 0:numb}__name(parseXSDInteger,"parseXSDInteger");Parsing.parseXSDInteger=parseXSDInteger;function parseDateTime(dateTimeStr){const[date,time]=dateTimeStr.split("T");return Object.assign(Object.assign({},parseDate(date)),__parseTime(time))}__name(parseDateTime,"parseDateTime");Parsing.parseDateTime=parseDateTime;function parseTimeZone(timeZoneStr){if(timeZoneStr==="")return{zoneHours:void 0,zoneMinutes:void 0};if(timeZoneStr==="Z")return{zoneHours:0,zoneMinutes:0};const timeZone=timeZoneStr.replace(/^([+|-])(\d\d):(\d\d)$/gu,"$11!$2!$3").split("!").map(str=>Number(str));return{zoneHours:timeZone[0]*timeZone[1],zoneMinutes:timeZone[0]*timeZone[2]}}__name(parseTimeZone,"parseTimeZone");function parseDate(dateStr){const formatted=dateStr.replace(/^(-)?([123456789]*\d{4})-(\d\d)-(\d\d)(Z|([+-]\d\d:\d\d))?$/gu,"$11!$2!$3!$4!$5");if(formatted===dateStr)throw new Errors_1$1.ParseError(dateStr,"date");const dateStrings=formatted.split("!"),date=dateStrings.slice(0,-1).map(str=>Number(str)),res=Object.assign({year:date[0]*date[1],month:date[2],day:date[3]},parseTimeZone(dateStrings[4]));if(!(1<=res.month&&res.month<=12)||!(1<=res.day&&res.day<=(0,SpecAlgos_1$1.maximumDayInMonthFor)(res.year,res.month)))throw new Errors_1$1.ParseError(dateStr,"date");return res}__name(parseDate,"parseDate");Parsing.parseDate=parseDate;function __parseTime(timeStr){const formatted=timeStr.replace(/^(\d\d):(\d\d):(\d\d(\.\d+)?)(Z|([+-]\d\d:\d\d))?$/gu,"$1!$2!$3!$5");if(formatted===timeStr)throw new Errors_1$1.ParseError(timeStr,"time");const timeStrings=formatted.split("!"),time=timeStrings.slice(0,-1).map(str=>Number(str)),res=Object.assign({hours:time[0],minutes:time[1],seconds:time[2]},parseTimeZone(timeStrings[3]));if(res.seconds>=60||res.minutes>=60||res.hours>24||res.hours===24&&(res.minutes!==0||res.seconds!==0))throw new Errors_1$1.ParseError(timeStr,"time");return res}__name(__parseTime,"__parseTime");function parseTime(timeStr){const res=__parseTime(timeStr);return res.hours%=24,res}__name(parseTime,"parseTime");Parsing.parseTime=parseTime;function parseDuration(durationStr){const[dayNotation,timeNotation]=durationStr.split("T"),formattedDayDur=dayNotation.replace(/^(-)?P(\d+Y)?(\d+M)?(\d+D)?$/gu,"$11S!$2!$3!$4");if(formattedDayDur===dayNotation)throw new Errors_1$1.ParseError(durationStr,"duration");const durationStrings=formattedDayDur.split("!");if(timeNotation!==void 0){const formattedTimeDur=timeNotation.replace(/^(\d+H)?(\d+M)?(\d+(\.\d+)?S)?$/gu,"$1!$2!$3");if(timeNotation===""||timeNotation===formattedTimeDur)throw new Errors_1$1.ParseError(durationStr,"duration");durationStrings.push(...formattedTimeDur.split("!"))}const duration=durationStrings.map(str=>str.slice(0,-1));if(!duration.slice(1).some(item=>item))throw new Errors_1$1.ParseError(durationStr,"duration");const sign=Number(duration[0]);return(0,DateTimeHelpers_1$5.simplifyDurationRepresentation)({year:duration[1]?sign*Number(duration[1]):void 0,month:duration[2]?sign*Number(duration[2]):void 0,day:duration[3]?sign*Number(duration[3]):void 0,hours:duration[4]?sign*Number(duration[4]):void 0,minutes:duration[5]?sign*Number(duration[5]):void 0,seconds:duration[6]?sign*Number(duration[6]):void 0})}__name(parseDuration,"parseDuration");Parsing.parseDuration=parseDuration;function parseYearMonthDuration(durationStr){const res=parseDuration(durationStr);if(["hours","minutes","seconds","day"].some(key=>!!res[key]))throw new Errors_1$1.ParseError(durationStr,"yearMonthDuration");return res}__name(parseYearMonthDuration,"parseYearMonthDuration");Parsing.parseYearMonthDuration=parseYearMonthDuration;function parseDayTimeDuration(durationStr){const res=parseDuration(durationStr);if(["year","month"].some(key=>!!res[key]))throw new Errors_1$1.ParseError(durationStr,"dayTimeDuration");return res}__name(parseDayTimeDuration,"parseDayTimeDuration");Parsing.parseDayTimeDuration=parseDayTimeDuration;var TypeHandling={},Helpers={},OverloadTree={},hasRequiredOverloadTree;function requireOverloadTree(){if(hasRequiredOverloadTree)return OverloadTree;hasRequiredOverloadTree=1,Object.defineProperty(OverloadTree,"__esModule",{value:!0}),OverloadTree.OverloadTree=void 0;const expressions_12=requireExpressions(),TypeHandling_12=requireTypeHandling();let OverloadTree$1=__name(class OverloadTree2{constructor(identifier,depth){this.identifier=identifier,this.implementation=void 0,this.generalOverloads=Object.create(null),this.literalOverLoads=[],this.depth=depth||0,this.promotionCount=void 0}getSubtree(overrideType){const generalType=(0,TypeHandling_12.asGeneralType)(overrideType);if(generalType)return this.generalOverloads[generalType];for(const[type,overloadTree]of this.literalOverLoads)if(overrideType===type)return overloadTree}getImplementationExact(args){let node2=this;for(const expression of args)if(node2=node2.getSubtree(expression),!node2)return;return node2.implementation}search(args,superTypeProvider,functionArgumentsCache){let cacheIter=functionArgumentsCache[this.identifier],searchIndex=0;for(;searchIndex<args.length&&(cacheIter!=null&&cacheIter.cache);){const term=args[searchIndex],literalExpression=(0,expressions_12.isLiteralTermExpression)(term);cacheIter=cacheIter.cache[literalExpression?literalExpression.dataType:term.termType],searchIndex++}if(searchIndex===args.length&&(cacheIter!=null&&cacheIter.func))return cacheIter.func;const searchStack=[],startIndex=0;if(args.length===0)return this.implementation;for(searchStack.push(...this.getSubTreeWithArg(args[startIndex],superTypeProvider).map(node2=>({node:node2,index:startIndex+1})));searchStack.length>0;){const{index,node:node2}=searchStack.pop();if(index===args.length&&node2.implementation)return this.addToCache(functionArgumentsCache,args,node2.implementation),node2.implementation;searchStack.push(...node2.getSubTreeWithArg(args[index],superTypeProvider).map(item=>({node:item,index:index+1})))}}addToCache(functionArgumentsCache,args,func){function getDefault(lruCache2,key){return key in lruCache2||(lruCache2[key]={}),lruCache2[key]}__name(getDefault,"getDefault");let cache=getDefault(functionArgumentsCache,this.identifier);for(const term of args){const literalExpression=(0,expressions_12.isLiteralTermExpression)(term),key=literalExpression?literalExpression.dataType:term.termType;cache.cache=cache.cache||{},cache=getDefault(cache.cache,key)}cache.func=func}addOverload(argumentTypes,func){this._addOverload([...argumentTypes],func,0)}_addOverload(argumentTypes,func,promotionCount){var _a2;const[argumentType,..._argumentTypes]=argumentTypes;if(!argumentType){(this.promotionCount===void 0||promotionCount<=this.promotionCount)&&(this.promotionCount=promotionCount,this.implementation=func);return}let nextTree=this.getSubtree(argumentType);if(!nextTree){const newNode=new OverloadTree2(this.identifier,this.depth+1),generalType=(0,TypeHandling_12.asGeneralType)(argumentType);generalType&&(this.generalOverloads[generalType]=newNode);const overrideType=(0,TypeHandling_12.asOverrideType)(argumentType);overrideType&&this.literalOverLoads.push([overrideType,newNode]),nextTree=newNode}nextTree._addOverload(_argumentTypes,func,promotionCount),(_a2=TypeHandling_12.typePromotion[argumentType])===null||_a2===void 0||_a2.forEach(ret=>this.addPromotedOverload(ret.typeToPromote,func,ret.conversionFunction,_argumentTypes,promotionCount))}addPromotedOverload(typeToPromote,func,conversionFunction,argumentTypes,promotionCount){let nextTree=this.getSubtree(typeToPromote);if(!nextTree){const newNode=new OverloadTree2(this.identifier,this.depth+1);this.literalOverLoads.push([typeToPromote,newNode]),nextTree=newNode}nextTree._addOverload(argumentTypes,funcConf=>args=>func(funcConf)([...args.slice(0,this.depth),conversionFunction(args[this.depth]),...args.slice(this.depth+1,args.length)]),promotionCount+1)}getSubTreeWithArg(arg,openWorldType){const res=[],literalExpression=(0,expressions_12.isLiteralTermExpression)(arg);if(this.generalOverloads.term&&res.push(this.generalOverloads.term),this.generalOverloads[arg.termType]&&res.push(this.generalOverloads[arg.termType]),literalExpression){const concreteType=(0,TypeHandling_12.asKnownLiteralType)(literalExpression.dataType);let subExtensionTable;concreteType?subExtensionTable=TypeHandling_12.superTypeDictTable[concreteType]:subExtensionTable=(0,TypeHandling_12.getSuperTypes)(literalExpression.dataType,openWorldType);const matches2=this.literalOverLoads.filter(([matchType,_])=>matchType in subExtensionTable).map(([matchType,tree])=>[subExtensionTable[matchType],tree]);matches2.sort(([prioA,matchTypeA],[prioB,matchTypeB])=>prioA-prioB),res.push(...matches2.map(([_,sortedType])=>sortedType))}return res}},"OverloadTree");return OverloadTree.OverloadTree=OverloadTree$1,OverloadTree}__name(requireOverloadTree,"requireOverloadTree");var hasRequiredHelpers;function requireHelpers(){if(hasRequiredHelpers)return Helpers;hasRequiredHelpers=1,Object.defineProperty(Helpers,"__esModule",{value:!0}),Helpers.expressionToVar=Helpers.dateTime=Helpers.langString=Helpers.string=Helpers.double=Helpers.float=Helpers.decimal=Helpers.integer=Helpers.bool=Helpers.Builder=Helpers.declare=void 0;const rdf_data_factory_12=rdfDataFactory,E2=requireExpressions(),expressions_12=requireExpressions(),C2=Consts,Consts_12=Consts,Err2=Errors,OverloadTree_1=requireOverloadTree(),DF2=new rdf_data_factory_12.DataFactory;function declare(identifier){return new Builder(identifier)}__name(declare,"declare"),Helpers.declare=declare;class Builder{constructor(identifier){this.overloadTree=new OverloadTree_1.OverloadTree(identifier),this.collected=!1}collect(){if(this.collected)throw new Error("Builders can only be collected once!");return this.collected=!0,this.overloadTree}static wrapInvalidLexicalProtected(func){return context2=>args=>(args.forEach((arg,index)=>{if(arg instanceof expressions_12.NonLexicalLiteral)throw new Err2.InvalidLexicalForm(args[index].toRDF())}),func(context2)(args))}set(argTypes,func,addInvalidHandling=!0){return this.overloadTree.addOverload(argTypes,addInvalidHandling?Builder.wrapInvalidLexicalProtected(func):func),this}copy({from,to}){const impl=this.overloadTree.getImplementationExact(from);if(!impl)throw new Err2.UnexpectedError("Tried to copy implementation, but types not found",{from,to});return this.set(to,impl)}onUnary(type,op,addInvalidHandling=!0){return this.set([type],context2=>([val])=>op(context2)(val))}onUnaryTyped(type,op,addInvalidHandling=!0){return this.set([type],context2=>([val])=>op(context2)(val.typedValue),addInvalidHandling)}onBinary(types2,op,addInvalidHandling=!0){return this.set(types2,context2=>([left,right])=>op(context2)(left,right),addInvalidHandling)}onBinaryTyped(types2,op,addInvalidHandling=!0){return this.set(types2,context2=>([left,right])=>op(context2)(left.typedValue,right.typedValue),addInvalidHandling)}onTernaryTyped(types2,op,addInvalidHandling=!0){return this.set(types2,context2=>([a1,a2,a3])=>op(context2)(a1.typedValue,a2.typedValue,a3.typedValue),addInvalidHandling)}onTernary(types2,op,addInvalidHandling=!0){return this.set(types2,context2=>([a1,a2,a3])=>op(context2)(a1,a2,a3),addInvalidHandling)}onQuaternaryTyped(types2,op,addInvalidHandling=!0){return this.set(types2,context2=>([a1,a2,a3,a4])=>op(context2)(a1.typedValue,a2.typedValue,a3.typedValue,a4.typedValue),addInvalidHandling)}onTerm1(op,addInvalidHandling=!1){return this.set(["term"],context2=>([term])=>op(context2)(term),addInvalidHandling)}onTerm3(op){return this.set(["term","term","term"],context2=>([t1,t2,t3])=>op(context2)(t1,t2,t3))}onQuad1(op){return this.set(["quad"],context2=>([term])=>op(context2)(term))}onLiteral1(op,addInvalidHandling=!0){return this.set(["literal"],context2=>([term])=>op(context2)(term),addInvalidHandling)}onBoolean1(op,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_BOOLEAN],context2=>([lit])=>op(context2)(lit),addInvalidHandling)}onBoolean1Typed(op,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_BOOLEAN],context2=>([lit])=>op(context2)(lit.typedValue),addInvalidHandling)}onString1(op,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_STRING],context2=>([lit])=>op(context2)(lit),addInvalidHandling)}onString1Typed(op,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_STRING],context2=>([lit])=>op(context2)(lit.typedValue),addInvalidHandling)}onLangString1(op,addInvalidHandling=!0){return this.set([C2.TypeURL.RDF_LANG_STRING],context2=>([lit])=>op(context2)(lit),addInvalidHandling)}onStringly1(op,addInvalidHandling=!0){return this.set([C2.TypeAlias.SPARQL_STRINGLY],context2=>([lit])=>op(context2)(lit),addInvalidHandling)}onStringly1Typed(op,addInvalidHandling=!0){return this.set([C2.TypeAlias.SPARQL_STRINGLY],context2=>([lit])=>op(context2)(lit.typedValue),addInvalidHandling)}onNumeric1(op,addInvalidHandling=!0){return this.set([C2.TypeAlias.SPARQL_NUMERIC],context2=>([val])=>op(context2)(val),addInvalidHandling)}onDateTime1(op,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_DATE_TIME],context2=>([val])=>op(context2)(val),addInvalidHandling)}numericConverter(op,addInvalidHandling=!0){const evalHelper=__name(context2=>arg=>op(context2)(arg.typedValue),"evalHelper");return this.onBinary([Consts_12.TypeURL.XSD_INTEGER],context2=>arg=>integer(evalHelper(context2)(arg)),addInvalidHandling).onBinary([Consts_12.TypeURL.XSD_DECIMAL],context2=>arg=>decimal(evalHelper(context2)(arg)),addInvalidHandling).onBinary([Consts_12.TypeURL.XSD_FLOAT],context2=>arg=>float(evalHelper(context2)(arg)),addInvalidHandling).onBinary([Consts_12.TypeURL.XSD_DOUBLE],context2=>arg=>double(evalHelper(context2)(arg)),addInvalidHandling)}arithmetic(op,addInvalidHandling=!0){const evalHelper=__name(context2=>(left,right)=>op(context2)(left.typedValue,right.typedValue),"evalHelper");return this.onBinary([Consts_12.TypeURL.XSD_INTEGER,Consts_12.TypeURL.XSD_INTEGER],context2=>(left,right)=>integer(evalHelper(context2)(left,right)),addInvalidHandling).onBinary([Consts_12.TypeURL.XSD_DECIMAL,Consts_12.TypeURL.XSD_DECIMAL],context2=>(left,right)=>decimal(evalHelper(context2)(left,right)),addInvalidHandling).onBinary([Consts_12.TypeURL.XSD_FLOAT,Consts_12.TypeURL.XSD_FLOAT],context2=>(left,right)=>float(evalHelper(context2)(left,right)),addInvalidHandling).onBinary([Consts_12.TypeURL.XSD_DOUBLE,Consts_12.TypeURL.XSD_DOUBLE],context2=>(left,right)=>double(evalHelper(context2)(left,right)),addInvalidHandling)}numberTest(test){return this.numeric(context2=>([left,right])=>{const result=test(context2)(left.typedValue,right.typedValue);return bool(result)})}stringTest(test,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_STRING,C2.TypeURL.XSD_STRING],context2=>([left,right])=>{const result=test(context2)(left.typedValue,right.typedValue);return bool(result)},addInvalidHandling)}booleanTest(test,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_BOOLEAN,C2.TypeURL.XSD_BOOLEAN],context2=>([left,right])=>{const result=test(context2)(left.typedValue,right.typedValue);return bool(result)},addInvalidHandling)}dateTimeTest(test,addInvalidHandling=!0){return this.set([C2.TypeURL.XSD_DATE_TIME,C2.TypeURL.XSD_DATE_TIME],context2=>([left,right])=>{const result=test(context2)(left.typedValue,right.typedValue);return bool(result)})}numeric(op){return this.set([C2.TypeAlias.SPARQL_NUMERIC,C2.TypeAlias.SPARQL_NUMERIC],op)}}__name(Builder,"Builder"),Helpers.Builder=Builder;function bool(val){return new E2.BooleanLiteral(val)}__name(bool,"bool"),Helpers.bool=bool;function integer(num){return new E2.IntegerLiteral(num)}__name(integer,"integer"),Helpers.integer=integer;function decimal(num){return new E2.DecimalLiteral(num)}__name(decimal,"decimal"),Helpers.decimal=decimal;function float(num){return new E2.FloatLiteral(num)}__name(float,"float"),Helpers.float=float;function double(num){return new E2.DoubleLiteral(num)}__name(double,"double"),Helpers.double=double;function string(str){return new E2.StringLiteral(str)}__name(string,"string"),Helpers.string=string;function langString(str,lang2){return new E2.LangStringLiteral(str,lang2)}__name(langString,"langString"),Helpers.langString=langString;function dateTime(date,str){return new E2.DateTimeLiteral(date,str)}__name(dateTime,"dateTime"),Helpers.dateTime=dateTime;function expressionToVar(variableExpression){return DF2.variable(variableExpression.name.slice(1))}return __name(expressionToVar,"expressionToVar"),Helpers.expressionToVar=expressionToVar,Helpers}__name(requireHelpers,"requireHelpers");var hasRequiredTypeHandling;function requireTypeHandling(){return hasRequiredTypeHandling||(hasRequiredTypeHandling=1,function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.typePromotion=exports.isSubTypeOf=exports.getSuperTypeDict=exports.isInternalSubType=exports.asGeneralType=exports.asOverrideType=exports.asKnownLiteralType=exports.asTypeAlias=exports.typeAliasCheck=exports.extensionTableInit=exports.getSuperTypes=exports.superTypeDictTable=exports.extensionTableInput=void 0;const expressions_12=requireExpressions(),Helpers_12=requireHelpers(),Consts_12=Consts;exports.extensionTableInput={[Consts_12.TypeURL.XSD_DATE_TIME_STAMP]:Consts_12.TypeURL.XSD_DATE_TIME,[Consts_12.TypeURL.XSD_DAY_TIME_DURATION]:Consts_12.TypeURL.XSD_DURATION,[Consts_12.TypeURL.XSD_YEAR_MONTH_DURATION]:Consts_12.TypeURL.XSD_DURATION,[Consts_12.TypeURL.RDF_LANG_STRING]:Consts_12.TypeAlias.SPARQL_STRINGLY,[Consts_12.TypeURL.XSD_STRING]:Consts_12.TypeAlias.SPARQL_STRINGLY,[Consts_12.TypeURL.XSD_NORMALIZED_STRING]:Consts_12.TypeURL.XSD_STRING,[Consts_12.TypeURL.XSD_TOKEN]:Consts_12.TypeURL.XSD_NORMALIZED_STRING,[Consts_12.TypeURL.XSD_LANGUAGE]:Consts_12.TypeURL.XSD_TOKEN,[Consts_12.TypeURL.XSD_NM_TOKEN]:Consts_12.TypeURL.XSD_TOKEN,[Consts_12.TypeURL.XSD_NAME]:Consts_12.TypeURL.XSD_TOKEN,[Consts_12.TypeURL.XSD_NC_NAME]:Consts_12.TypeURL.XSD_NAME,[Consts_12.TypeURL.XSD_ENTITY]:Consts_12.TypeURL.XSD_NC_NAME,[Consts_12.TypeURL.XSD_ID]:Consts_12.TypeURL.XSD_NC_NAME,[Consts_12.TypeURL.XSD_ID_REF]:Consts_12.TypeURL.XSD_NC_NAME,[Consts_12.TypeURL.XSD_DOUBLE]:Consts_12.TypeAlias.SPARQL_NUMERIC,[Consts_12.TypeURL.XSD_FLOAT]:Consts_12.TypeAlias.SPARQL_NUMERIC,[Consts_12.TypeURL.XSD_DECIMAL]:Consts_12.TypeAlias.SPARQL_NUMERIC,[Consts_12.TypeURL.XSD_INTEGER]:Consts_12.TypeURL.XSD_DECIMAL,[Consts_12.TypeURL.XSD_NON_POSITIVE_INTEGER]:Consts_12.TypeURL.XSD_INTEGER,[Consts_12.TypeURL.XSD_NEGATIVE_INTEGER]:Consts_12.TypeURL.XSD_NON_POSITIVE_INTEGER,[Consts_12.TypeURL.XSD_LONG]:Consts_12.TypeURL.XSD_INTEGER,[Consts_12.TypeURL.XSD_INT]:Consts_12.TypeURL.XSD_LONG,[Consts_12.TypeURL.XSD_SHORT]:Consts_12.TypeURL.XSD_INT,[Consts_12.TypeURL.XSD_BYTE]:Consts_12.TypeURL.XSD_SHORT,[Consts_12.TypeURL.XSD_NON_NEGATIVE_INTEGER]:Consts_12.TypeURL.XSD_INTEGER,[Consts_12.TypeURL.XSD_NON_NEGATIVE_INTEGER]:Consts_12.TypeURL.XSD_INTEGER,[Consts_12.TypeURL.XSD_POSITIVE_INTEGER]:Consts_12.TypeURL.XSD_NON_NEGATIVE_INTEGER,[Consts_12.TypeURL.XSD_UNSIGNED_LONG]:Consts_12.TypeURL.XSD_NON_NEGATIVE_INTEGER,[Consts_12.TypeURL.XSD_UNSIGNED_INT]:Consts_12.TypeURL.XSD_UNSIGNED_LONG,[Consts_12.TypeURL.XSD_UNSIGNED_SHORT]:Consts_12.TypeURL.XSD_UNSIGNED_INT,[Consts_12.TypeURL.XSD_UNSIGNED_BYTE]:Consts_12.TypeURL.XSD_UNSIGNED_SHORT,[Consts_12.TypeURL.XSD_DATE_TIME]:"term",[Consts_12.TypeURL.XSD_BOOLEAN]:"term",[Consts_12.TypeURL.XSD_DATE]:"term",[Consts_12.TypeURL.XSD_G_MONTH]:"term",[Consts_12.TypeURL.XSD_G_MONTHDAY]:"term",[Consts_12.TypeURL.XSD_G_YEAR]:"term",[Consts_12.TypeURL.XSD_G_YEAR_MONTH]:"term",[Consts_12.TypeURL.XSD_TIME]:"term",[Consts_12.TypeURL.XSD_G_DAY]:"term",[Consts_12.TypeURL.XSD_DURATION]:"term",[Consts_12.TypeAlias.SPARQL_NUMERIC]:"term",[Consts_12.TypeAlias.SPARQL_STRINGLY]:"term",[Consts_12.TypeURL.XSD_ANY_URI]:"term"};function getSuperTypes(type,openWorldType){const cached=openWorldType.cache.get(type);if(cached)return cached;const value=openWorldType.discoverer(type);if(value==="term"){const res=Object.create(null);return res.__depth=0,res[type]=0,openWorldType.cache.set(type,res),res}let subExtension;const knownValue=asKnownLiteralType(value);return knownValue?subExtension=Object.assign({},exports.superTypeDictTable[knownValue]):subExtension=Object.assign({},getSuperTypes(value,openWorldType)),subExtension.__depth++,subExtension[type]=subExtension.__depth,openWorldType.cache.set(type,subExtension),subExtension}__name(getSuperTypes,"getSuperTypes"),exports.getSuperTypes=getSuperTypes;function extensionTableInit(){const res=Object.create(null);for(const[_key,value]of Object.entries(exports.extensionTableInput)){const key=_key;res[key]||extensionTableBuilderInitKey(key,value,res)}exports.superTypeDictTable=res}__name(extensionTableInit,"extensionTableInit"),exports.extensionTableInit=extensionTableInit,extensionTableInit();function extensionTableBuilderInitKey(key,value,res){if(value==="term"||value===void 0){const baseRes=Object.create(null);baseRes.__depth=0,baseRes[key]=0,res[key]=baseRes;return}res[value]||extensionTableBuilderInitKey(value,exports.extensionTableInput[value],res),res[key]=Object.assign(Object.assign({},res[value]),{[key]:res[value].__depth+1,__depth:res[value].__depth+1})}__name(extensionTableBuilderInitKey,"extensionTableBuilderInitKey");function initTypeAliasCheck(){exports.typeAliasCheck=Object.create(null);for(const val of Object.values(Consts_12.TypeAlias))exports.typeAliasCheck[val]=!0}__name(initTypeAliasCheck,"initTypeAliasCheck"),initTypeAliasCheck();function asTypeAlias(type){if(type in exports.typeAliasCheck)return type}__name(asTypeAlias,"asTypeAlias"),exports.asTypeAlias=asTypeAlias;function asKnownLiteralType(type){if(type in exports.superTypeDictTable)return type}__name(asKnownLiteralType,"asKnownLiteralType"),exports.asKnownLiteralType=asKnownLiteralType;function asOverrideType(type){if(asKnownLiteralType(type)||type==="term")return type}__name(asOverrideType,"asOverrideType"),exports.asOverrideType=asOverrideType;function asGeneralType(type){if(type==="term"||(0,expressions_12.asTermType)(type))return type}__name(asGeneralType,"asGeneralType"),exports.asGeneralType=asGeneralType;function isInternalSubType(baseType,argumentType){return baseType!=="term"&&exports.superTypeDictTable[baseType]&&exports.superTypeDictTable[baseType][argumentType]!==void 0}__name(isInternalSubType,"isInternalSubType"),exports.isInternalSubType=isInternalSubType;function getSuperTypeDict(baseType,superTypeProvider){const concreteType=asKnownLiteralType(baseType);return concreteType?exports.superTypeDictTable[concreteType]:getSuperTypes(baseType,superTypeProvider)}__name(getSuperTypeDict,"getSuperTypeDict"),exports.getSuperTypeDict=getSuperTypeDict;function isSubTypeOf(baseType,argumentType,superTypeProvider){return baseType==="term"?!1:getSuperTypeDict(baseType,superTypeProvider)[argumentType]!==void 0}__name(isSubTypeOf,"isSubTypeOf"),exports.isSubTypeOf=isSubTypeOf,exports.typePromotion={[Consts_12.TypeURL.XSD_STRING]:[{typeToPromote:Consts_12.TypeURL.XSD_ANY_URI,conversionFunction:arg=>(0,Helpers_12.string)(arg.str())}],[Consts_12.TypeURL.XSD_DOUBLE]:[{typeToPromote:Consts_12.TypeURL.XSD_FLOAT,conversionFunction:arg=>(0,Helpers_12.double)(arg.typedValue)},{typeToPromote:Consts_12.TypeURL.XSD_DECIMAL,conversionFunction:arg=>(0,Helpers_12.double)(arg.typedValue)}],[Consts_12.TypeURL.XSD_FLOAT]:[{typeToPromote:Consts_12.TypeURL.XSD_DECIMAL,conversionFunction:arg=>(0,Helpers_12.float)(arg.typedValue)}]}}(TypeHandling)),TypeHandling}__name(requireTypeHandling,"requireTypeHandling");var hasRequiredTermTransformer;function requireTermTransformer(){if(hasRequiredTermTransformer)return TermTransformer;hasRequiredTermTransformer=1,Object.defineProperty(TermTransformer,"__esModule",{value:!0}),TermTransformer.TermTransformer=void 0;const RDFString=rdfString,sparqlalgebrajs_12=sparqlalgebrajs,E2=requireExpressions(),Consts_12=Consts,Err2=Errors,Errors_12=Errors,Parsing_12=Parsing,P=Parsing,TypeHandling_12=requireTypeHandling();let TermTransformer$1=__name(class{constructor(superTypeProvider){this.superTypeProvider=superTypeProvider}transformRDFTermUnsafe(term){return this.transformTerm({term,type:sparqlalgebrajs_12.Algebra.types.EXPRESSION,expressionType:sparqlalgebrajs_12.Algebra.expressionTypes.TERM})}transformTerm(term){if(!term.term)throw new Err2.InvalidExpression(term);switch(term.term.termType){case"Variable":return new E2.Variable(RDFString.termToString(term.term));case"Literal":return this.transformLiteral(term.term);case"NamedNode":return new E2.NamedNode(term.term.value);case"BlankNode":return new E2.BlankNode(term.term.value);case"Quad":return new E2.Quad(term.term,this.superTypeProvider);default:throw new Err2.InvalidTermType(term)}}transformLiteral(lit){if(!lit.datatype||[null,void 0,""].includes(lit.datatype.value))return lit.language?new E2.LangStringLiteral(lit.value,lit.language):new E2.StringLiteral(lit.value);const dataType=lit.datatype.value,superTypeDict=(0,TypeHandling_12.getSuperTypeDict)(dataType,this.superTypeProvider);try{if(Consts_12.TypeURL.XSD_STRING in superTypeDict)return new E2.StringLiteral(lit.value,dataType);if(Consts_12.TypeURL.RDF_LANG_STRING in superTypeDict)return new E2.LangStringLiteral(lit.value,lit.language);if(Consts_12.TypeURL.XSD_YEAR_MONTH_DURATION in superTypeDict)return new E2.YearMonthDurationLiteral((0,Parsing_12.parseYearMonthDuration)(lit.value),lit.value,dataType);if(Consts_12.TypeURL.XSD_DAY_TIME_DURATION in superTypeDict)return new E2.DayTimeDurationLiteral((0,Parsing_12.parseDayTimeDuration)(lit.value),lit.value,dataType);if(Consts_12.TypeURL.XSD_DURATION in superTypeDict)return new E2.DurationLiteral((0,Parsing_12.parseDuration)(lit.value),lit.value,dataType);if(Consts_12.TypeURL.XSD_DATE_TIME in superTypeDict){const dateVal=new Date(lit.value);return Number.isNaN(dateVal.getTime())?new E2.NonLexicalLiteral(void 0,dataType,this.superTypeProvider,lit.value):new E2.DateTimeLiteral((0,Parsing_12.parseDateTime)(lit.value),lit.value,dataType)}if(Consts_12.TypeURL.XSD_DATE in superTypeDict)return new E2.DateLiteral((0,Parsing_12.parseDate)(lit.value),lit.value,dataType);if(Consts_12.TypeURL.XSD_TIME in superTypeDict)return new E2.TimeLiteral((0,Parsing_12.parseTime)(lit.value),lit.value,dataType);if(Consts_12.TypeURL.XSD_BOOLEAN in superTypeDict)return lit.value!=="true"&&lit.value!=="false"&&lit.value!=="1"&&lit.value!=="0"?new E2.NonLexicalLiteral(void 0,dataType,this.superTypeProvider,lit.value):new E2.BooleanLiteral(lit.value==="true"||lit.value==="1",lit.value);if(Consts_12.TypeURL.XSD_DECIMAL in superTypeDict){const intVal=P.parseXSDDecimal(lit.value);return intVal===void 0?new E2.NonLexicalLiteral(void 0,dataType,this.superTypeProvider,lit.value):Consts_12.TypeURL.XSD_INTEGER in superTypeDict?new E2.IntegerLiteral(intVal,dataType,lit.value):new E2.DecimalLiteral(intVal,dataType,lit.value)}const isFloat=Consts_12.TypeURL.XSD_FLOAT in superTypeDict,isDouble=Consts_12.TypeURL.XSD_DOUBLE in superTypeDict;if(isFloat||isDouble){const doubleVal=P.parseXSDFloat(lit.value);return doubleVal===void 0?new E2.NonLexicalLiteral(void 0,dataType,this.superTypeProvider,lit.value):isFloat?new E2.FloatLiteral(doubleVal,dataType,lit.value):new E2.DoubleLiteral(doubleVal,dataType,lit.value)}return new E2.Literal(lit.value,dataType,lit.value)}catch(error){if(error instanceof Error&&(0,Errors_12.isExpressionError)(error))return new E2.NonLexicalLiteral(void 0,dataType,this.superTypeProvider,lit.value);throw error}}},"TermTransformer");return TermTransformer.TermTransformer=TermTransformer$1,TermTransformer}__name(requireTermTransformer,"requireTermTransformer");var Serialization={};Object.defineProperty(Serialization,"__esModule",{value:!0});Serialization.serializeDuration=Serialization.serializeTime=Serialization.serializeDate=Serialization.serializeDateTime=void 0;function numSerializer(num,min2=2){return num.toLocaleString(void 0,{minimumIntegerDigits:min2,useGrouping:!1})}__name(numSerializer,"numSerializer");function serializeDateTime(date){return`${serializeDate({year:date.year,month:date.month,day:date.day})}T${serializeTime(date)}`}__name(serializeDateTime,"serializeDateTime");Serialization.serializeDateTime=serializeDateTime;function serializeTimeZone(tz2){return tz2.zoneHours===void 0||tz2.zoneMinutes===void 0?"":tz2.zoneHours===0&&tz2.zoneMinutes===0?"Z":`${tz2.zoneHours>=0?`+${numSerializer(tz2.zoneHours)}`:numSerializer(tz2.zoneHours)}:${numSerializer(Math.abs(tz2.zoneMinutes))}`}__name(serializeTimeZone,"serializeTimeZone");function serializeDate(date){return`${numSerializer(date.year,4)}-${numSerializer(date.month)}-${numSerializer(date.day)}${serializeTimeZone(date)}`}__name(serializeDate,"serializeDate");Serialization.serializeDate=serializeDate;function serializeTime(time){return`${numSerializer(time.hours)}:${numSerializer(time.minutes)}:${numSerializer(time.seconds)}${serializeTimeZone(time)}`}__name(serializeTime,"serializeTime");Serialization.serializeTime=serializeTime;function serializeDuration(dur,zeroString="PT0S"){if(!Object.values(dur).some(val=>(val||0)!==0))return zeroString;const sign=Object.values(dur).some(val=>(val||0)<0)?"-":"",year2=dur.year?`${Math.abs(dur.year)}Y`:"",month2=dur.month?`${Math.abs(dur.month)}M`:"",day2=dur.day?`${Math.abs(dur.day)}D`:"",dayNotation=`${sign}P${year2}${month2}${day2}`;if(!(dur.hours||dur.minutes||dur.seconds))return dayNotation;const hour=dur.hours?`${Math.abs(dur.hours)}H`:"",minute=dur.minutes?`${Math.abs(dur.minutes)}M`:"",second=dur.seconds?`${Math.abs(dur.seconds)}S`:"";return`${dayNotation}T${hour}${minute}${second}`}__name(serializeDuration,"serializeDuration");Serialization.serializeDuration=serializeDuration;var hasRequiredTerm;function requireTerm(){if(hasRequiredTerm)return Term;hasRequiredTerm=1,Object.defineProperty(Term,"__esModule",{value:!0}),Term.isNonLexicalLiteral=Term.NonLexicalLiteral=Term.YearMonthDurationLiteral=Term.DayTimeDurationLiteral=Term.DurationLiteral=Term.DateLiteral=Term.TimeLiteral=Term.DateTimeLiteral=Term.StringLiteral=Term.LangStringLiteral=Term.BooleanLiteral=Term.DoubleLiteral=Term.FloatLiteral=Term.DecimalLiteral=Term.IntegerLiteral=Term.NumericLiteral=Term.Literal=Term.isLiteralTermExpression=Term.Quad=Term.BlankNode=Term.NamedNode=Term.Term=void 0;const rdf_data_factory_12=rdfDataFactory,TermTransformer_12=requireTermTransformer(),C2=Consts,Consts_12=Consts,Err2=Errors,Serialization_1=Serialization,TypeHandling_12=requireTypeHandling(),Expressions_12=Expressions,DF2=new rdf_data_factory_12.DataFactory;let Term$1=__name(class{constructor(){this.expressionType=Expressions_12.ExpressionType.Term}str(){throw new Err2.InvalidArgumentTypes([this],C2.RegularOperator.STR)}coerceEBV(){throw new Err2.EBVCoercionError(this)}},"Term");Term.Term=Term$1;class NamedNode extends Term$1{constructor(value){super(),this.value=value,this.termType="namedNode"}toRDF(){return DF2.namedNode(this.value)}str(){return this.value}}__name(NamedNode,"NamedNode"),Term.NamedNode=NamedNode;class BlankNode extends Term$1{constructor(value){super(),this.termType="blankNode",this.value=typeof value=="string"?DF2.blankNode(value):value}toRDF(){return this.value}}__name(BlankNode,"BlankNode"),Term.BlankNode=BlankNode;class Quad extends Term$1{constructor(input,superTypeProvider){super(),this.termType="quad",this.transformer=new TermTransformer_12.TermTransformer(superTypeProvider),this.valueTerm=input}toRDF(){return this.valueTerm}get subject(){return this.transformer.transformRDFTermUnsafe(this.RDFsubject)}get predicate(){return this.transformer.transformRDFTermUnsafe(this.RDFpredicate)}get object(){return this.transformer.transformRDFTermUnsafe(this.RDFobject)}get RDFsubject(){return this.toRDF().subject}get RDFpredicate(){return this.toRDF().predicate}get RDFobject(){return this.toRDF().object}}__name(Quad,"Quad"),Term.Quad=Quad;function isLiteralTermExpression(expr){if(expr.termType==="literal")return expr}__name(isLiteralTermExpression,"isLiteralTermExpression"),Term.isLiteralTermExpression=isLiteralTermExpression;class Literal extends Term$1{constructor(typedValue,dataType,strValue,language2){super(),this.typedValue=typedValue,this.dataType=dataType,this.strValue=strValue,this.language=language2,this.termType="literal"}toRDF(){return DF2.literal(this.strValue||this.str(),this.language||DF2.namedNode(this.dataType))}str(){return this.strValue||this.typedValue.toString()}}__name(Literal,"Literal"),Term.Literal=Literal;class NumericLiteral extends Literal{constructor(typedValue,dataType,strValue,language2){super(typedValue,dataType,strValue,language2),this.typedValue=typedValue,this.strValue=strValue,this.language=language2}coerceEBV(){return!!this.typedValue}toRDF(){const term=super.toRDF();return Number.isFinite(this.typedValue)||(term.value=term.value.replace("Infinity","INF")),term}str(){return this.strValue||this.specificFormatter(this.typedValue)}}__name(NumericLiteral,"NumericLiteral"),Term.NumericLiteral=NumericLiteral;class IntegerLiteral extends NumericLiteral{constructor(typedValue,dataType,strValue,language2){super(typedValue,dataType||Consts_12.TypeURL.XSD_INTEGER,strValue,language2),this.typedValue=typedValue,this.strValue=strValue,this.language=language2}specificFormatter(val){return val.toFixed(0)}}__name(IntegerLiteral,"IntegerLiteral"),Term.IntegerLiteral=IntegerLiteral;class DecimalLiteral extends NumericLiteral{constructor(typedValue,dataType,strValue,language2){super(typedValue,dataType||Consts_12.TypeURL.XSD_DECIMAL,strValue,language2),this.typedValue=typedValue,this.strValue=strValue,this.language=language2}specificFormatter(val){return val.toString()}}__name(DecimalLiteral,"DecimalLiteral"),Term.DecimalLiteral=DecimalLiteral;class FloatLiteral extends NumericLiteral{constructor(typedValue,dataType,strValue,language2){super(typedValue,dataType||Consts_12.TypeURL.XSD_FLOAT,strValue,language2),this.typedValue=typedValue,this.strValue=strValue,this.language=language2}specificFormatter(val){return val.toString()}}__name(FloatLiteral,"FloatLiteral"),Term.FloatLiteral=FloatLiteral;class DoubleLiteral extends NumericLiteral{constructor(typedValue,dataType,strValue,language2){super(typedValue,dataType||Consts_12.TypeURL.XSD_DOUBLE,strValue,language2),this.typedValue=typedValue,this.strValue=strValue,this.language=language2}specificFormatter(val){if(!Number.isFinite(val))return val>0?"INF":val<0?"-INF":"NaN";const jsExponential=val.toExponential(),[jsMantisse,jsExponent]=jsExponential.split("e"),exponent=jsExponent.replace(/\+/u,"");return`${jsMantisse.includes(".")?jsMantisse:`${jsMantisse}.0`}E${exponent}`}}__name(DoubleLiteral,"DoubleLiteral"),Term.DoubleLiteral=DoubleLiteral;class BooleanLiteral extends Literal{constructor(typedValue,strValue,dataType){super(typedValue,dataType||Consts_12.TypeURL.XSD_BOOLEAN,strValue),this.typedValue=typedValue,this.strValue=strValue}coerceEBV(){return this.typedValue}}__name(BooleanLiteral,"BooleanLiteral"),Term.BooleanLiteral=BooleanLiteral;class LangStringLiteral extends Literal{constructor(typedValue,language2,dataType){super(typedValue,dataType||Consts_12.TypeURL.RDF_LANG_STRING,typedValue,language2),this.typedValue=typedValue,this.language=language2}coerceEBV(){return this.str().length>0}}__name(LangStringLiteral,"LangStringLiteral"),Term.LangStringLiteral=LangStringLiteral;class StringLiteral extends Literal{constructor(typedValue,dataType){super(typedValue,dataType||Consts_12.TypeURL.XSD_STRING,typedValue),this.typedValue=typedValue}coerceEBV(){return this.str().length>0}}__name(StringLiteral,"StringLiteral"),Term.StringLiteral=StringLiteral;class DateTimeLiteral extends Literal{constructor(typedValue,strValue,dataType){super(typedValue,dataType||Consts_12.TypeURL.XSD_DATE_TIME,strValue),this.typedValue=typedValue,this.strValue=strValue}str(){return(0,Serialization_1.serializeDateTime)(this.typedValue)}}__name(DateTimeLiteral,"DateTimeLiteral"),Term.DateTimeLiteral=DateTimeLiteral;class TimeLiteral extends Literal{constructor(typedValue,strValue,dataType){super(typedValue,dataType||Consts_12.TypeURL.XSD_TIME,strValue),this.typedValue=typedValue,this.strValue=strValue}str(){return(0,Serialization_1.serializeTime)(this.typedValue)}}__name(TimeLiteral,"TimeLiteral"),Term.TimeLiteral=TimeLiteral;class DateLiteral extends Literal{constructor(typedValue,strValue,dataType){super(typedValue,dataType||Consts_12.TypeURL.XSD_DATE,strValue),this.typedValue=typedValue,this.strValue=strValue}str(){return(0,Serialization_1.serializeDate)(this.typedValue)}}__name(DateLiteral,"DateLiteral"),Term.DateLiteral=DateLiteral;class DurationLiteral extends Literal{constructor(typedValue,strValue,dataType){super(typedValue,dataType||Consts_12.TypeURL.XSD_DURATION,strValue),this.typedValue=typedValue,this.strValue=strValue}str(){return(0,Serialization_1.serializeDuration)(this.typedValue)}}__name(DurationLiteral,"DurationLiteral"),Term.DurationLiteral=DurationLiteral;class DayTimeDurationLiteral extends DurationLiteral{constructor(typedValue,strValue,dataType){super(typedValue,strValue,dataType||Consts_12.TypeURL.XSD_DAY_TIME_DURATION),this.typedValue=typedValue,this.strValue=strValue}}__name(DayTimeDurationLiteral,"DayTimeDurationLiteral"),Term.DayTimeDurationLiteral=DayTimeDurationLiteral;class YearMonthDurationLiteral extends Literal{constructor(typedValue,strValue,dataType){super(typedValue,dataType||Consts_12.TypeURL.XSD_YEAR_MONTH_DURATION,strValue),this.typedValue=typedValue,this.strValue=strValue}str(){return(0,Serialization_1.serializeDuration)(this.typedValue,"P0M")}}__name(YearMonthDurationLiteral,"YearMonthDurationLiteral"),Term.YearMonthDurationLiteral=YearMonthDurationLiteral;class NonLexicalLiteral extends Literal{constructor(typedValue,dataType,openWorldType,strValue,language2){super({toString:()=>"undefined"},dataType,strValue,language2),this.openWorldType=openWorldType}coerceEBV(){if((0,TypeHandling_12.isSubTypeOf)(this.dataType,Consts_12.TypeURL.XSD_BOOLEAN,this.openWorldType)||(0,TypeHandling_12.isSubTypeOf)(this.dataType,Consts_12.TypeAlias.SPARQL_NUMERIC,this.openWorldType))return!1;throw new Err2.EBVCoercionError(this)}toRDF(){return DF2.literal(this.str(),this.language||DF2.namedNode(this.dataType))}str(){return this.strValue||""}}__name(NonLexicalLiteral,"NonLexicalLiteral"),Term.NonLexicalLiteral=NonLexicalLiteral;function isNonLexicalLiteral(lit){if(lit instanceof NonLexicalLiteral)return lit}return __name(isNonLexicalLiteral,"isNonLexicalLiteral"),Term.isNonLexicalLiteral=isNonLexicalLiteral,Term}__name(requireTerm,"requireTerm");var Operator$1={};Object.defineProperty(Operator$1,"__esModule",{value:!0});Operator$1.Operator=void 0;const Expressions_1$6=Expressions;class Operator{constructor(args,apply){this.args=args,this.apply=apply,this.expressionType=Expressions_1$6.ExpressionType.Operator}}__name(Operator,"Operator");Operator$1.Operator=Operator;var SpecialOperator$1={};Object.defineProperty(SpecialOperator$1,"__esModule",{value:!0});SpecialOperator$1.SpecialOperator=void 0;const Expressions_1$5=Expressions;class SpecialOperator{constructor(args,applyAsync,applySync){this.args=args,this.applyAsync=applyAsync,this.applySync=applySync,this.expressionType=Expressions_1$5.ExpressionType.SpecialOperator}}__name(SpecialOperator,"SpecialOperator");SpecialOperator$1.SpecialOperator=SpecialOperator;var Named$1={};Object.defineProperty(Named$1,"__esModule",{value:!0});Named$1.Named=void 0;const Expressions_1$4=Expressions;class Named{constructor(name,args,apply){this.name=name,this.args=args,this.apply=apply,this.expressionType=Expressions_1$4.ExpressionType.Named}}__name(Named,"Named");Named$1.Named=Named;var Aggregate$1={};Object.defineProperty(Aggregate$1,"__esModule",{value:!0});Aggregate$1.Aggregate=void 0;const Expressions_1$3=Expressions;class Aggregate{constructor(name,expression){this.name=name,this.expression=expression,this.expressionType=Expressions_1$3.ExpressionType.Aggregate}}__name(Aggregate,"Aggregate");Aggregate$1.Aggregate=Aggregate;var Existence$1={};Object.defineProperty(Existence$1,"__esModule",{value:!0});Existence$1.Existence=void 0;const Expressions_1$2=Expressions;class Existence{constructor(expression){this.expression=expression,this.expressionType=Expressions_1$2.ExpressionType.Existence}}__name(Existence,"Existence");Existence$1.Existence=Existence;var AsyncExtension$1={};Object.defineProperty(AsyncExtension$1,"__esModule",{value:!0});AsyncExtension$1.AsyncExtension=void 0;const Expressions_1$1=Expressions;class AsyncExtension{constructor(name,args,apply){this.name=name,this.args=args,this.apply=apply,this.expressionType=Expressions_1$1.ExpressionType.AsyncExtension}}__name(AsyncExtension,"AsyncExtension");AsyncExtension$1.AsyncExtension=AsyncExtension;var SyncExtension$1={};Object.defineProperty(SyncExtension$1,"__esModule",{value:!0});SyncExtension$1.SyncExtension=void 0;const Expressions_1=Expressions;class SyncExtension{constructor(name,args,apply){this.name=name,this.args=args,this.apply=apply,this.expressionType=Expressions_1.ExpressionType.SyncExtension}}__name(SyncExtension,"SyncExtension");SyncExtension$1.SyncExtension=SyncExtension;var hasRequiredExpressions;function requireExpressions(){return hasRequiredExpressions||(hasRequiredExpressions=1,function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(Expressions,exports),__exportStar(Variable$1,exports),__exportStar(requireTerm(),exports),__exportStar(Operator$1,exports),__exportStar(SpecialOperator$1,exports),__exportStar(Named$1,exports),__exportStar(Aggregate$1,exports),__exportStar(Existence$1,exports),__exportStar(AsyncExtension$1,exports),__exportStar(SyncExtension$1,exports)}(expressions)),expressions}__name(requireExpressions,"requireExpressions");var functions={},Core={};Object.defineProperty(Core,"__esModule",{value:!0});Core.SpecialFunction=Core.NamedFunction=Core.RegularFunction=Core.BaseFunction=void 0;const Err$8=Errors;class BaseFunction{constructor(operator,definition){this.operator=operator,this.apply=(args,context2)=>(this.monomorph(args,context2.superTypeProvider,context2.functionArgumentsCache)||this.handleInvalidTypes(args))(context2)(args),this.arity=definition.arity,this.overloads=definition.overloads}monomorph(args,superTypeProvider,functionArgumentsCache){return this.overloads.search(args,superTypeProvider,functionArgumentsCache)}}__name(BaseFunction,"BaseFunction");Core.BaseFunction=BaseFunction;class RegularFunction extends BaseFunction{constructor(op,definition){super(op,definition),this.functionClass="regular"}handleInvalidTypes(args){throw new Err$8.InvalidArgumentTypes(args,this.operator)}}__name(RegularFunction,"RegularFunction");Core.RegularFunction=RegularFunction;class NamedFunction extends BaseFunction{constructor(op,definition){super(op,definition),this.functionClass="named"}handleInvalidTypes(args){throw new Err$8.InvalidArgumentTypes(args,this.operator)}}__name(NamedFunction,"NamedFunction");Core.NamedFunction=NamedFunction;class SpecialFunction{constructor(operator,definition){this.operator=operator,this.functionClass="special",this.arity=definition.arity,this.applySync=definition.applySync,this.applyAsync=definition.applyAsync,this.checkArity=definition.checkArity||defaultArityCheck(this.arity)}}__name(SpecialFunction,"SpecialFunction");Core.SpecialFunction=SpecialFunction;function defaultArityCheck(arity){return args=>arity===Number.POSITIVE_INFINITY?!0:args.length===arity}__name(defaultArityCheck,"defaultArityCheck");var NamedFunctions={};Object.defineProperty(NamedFunctions,"__esModule",{value:!0});NamedFunctions.namedDefinitions=void 0;const E$5=requireExpressions(),expressions_1$1=requireExpressions(),Consts_1$3=Consts,DateTimeHelpers_1$4=DateTimeHelpers,Err$7=Errors,Parsing_1=Parsing,Helpers_1$7=requireHelpers(),xsdToString={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_STRING).onNumeric1(()=>val=>(0,Helpers_1$7.string)((0,Helpers_1$7.float)(val.typedValue).str())).onBoolean1Typed(()=>val=>(0,Helpers_1$7.string)((0,Helpers_1$7.bool)(val).str())).onTerm1(()=>val=>(0,Helpers_1$7.string)(val.str())).collect()},xsdToFloat={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_FLOAT).onNumeric1(()=>val=>(0,Helpers_1$7.float)(val.typedValue)).onBoolean1Typed(()=>val=>(0,Helpers_1$7.float)(val?1:0)).onUnary(Consts_1$3.TypeURL.XSD_STRING,()=>val=>{const result=(0,Parsing_1.parseXSDFloat)(val.str());if(result===void 0)throw new Err$7.CastError(val,Consts_1$3.TypeURL.XSD_FLOAT);return(0,Helpers_1$7.float)(result)},!1).collect()},xsdToDouble={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_DOUBLE).onNumeric1(()=>val=>(0,Helpers_1$7.double)(val.typedValue)).onBoolean1Typed(()=>val=>(0,Helpers_1$7.double)(val?1:0)).onUnary(Consts_1$3.TypeURL.XSD_STRING,()=>val=>{const result=(0,Parsing_1.parseXSDFloat)(val.str());if(result===void 0)throw new Err$7.CastError(val,Consts_1$3.TypeURL.XSD_DOUBLE);return(0,Helpers_1$7.double)(result)},!1).collect()},xsdToDecimal={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_DECIMAL).onNumeric1(()=>val=>{const result=(0,Parsing_1.parseXSDDecimal)(val.str());if(result===void 0)throw new Err$7.CastError(val,Consts_1$3.TypeURL.XSD_DECIMAL);return(0,Helpers_1$7.decimal)(result)}).onString1(()=>val=>{const str=val.str(),result=/^([+-])?(\d+(\.\d+)?)$/u.test(str)?(0,Parsing_1.parseXSDDecimal)(str):void 0;if(result===void 0)throw new Err$7.CastError(val,Consts_1$3.TypeURL.XSD_DECIMAL);return(0,Helpers_1$7.decimal)(result)},!1).onBoolean1Typed(()=>val=>(0,Helpers_1$7.decimal)(val?1:0)).collect()},xsdToInteger={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_INTEGER).onBoolean1Typed(()=>val=>(0,Helpers_1$7.integer)(val?1:0)).onNumeric1(()=>val=>{const result=(0,Parsing_1.parseXSDInteger)(val.str());if(result===void 0)throw new Err$7.CastError(val,Consts_1$3.TypeURL.XSD_INTEGER);return(0,Helpers_1$7.integer)(result)},!1).onString1(()=>val=>{const str=val.str(),result=/^\d+$/u.test(str)?(0,Parsing_1.parseXSDInteger)(str):void 0;if(result===void 0)throw new Err$7.CastError(val,Consts_1$3.TypeURL.XSD_INTEGER);return(0,Helpers_1$7.integer)(result)}).collect()},xsdToDatetime={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_DATE_TIME).onUnary(Consts_1$3.TypeURL.XSD_DATE_TIME,()=>val=>val).onUnary(Consts_1$3.TypeURL.XSD_STRING,()=>val=>(0,Helpers_1$7.dateTime)((0,Parsing_1.parseDateTime)(val.str()),val.str()),!1).onUnary(Consts_1$3.TypeURL.XSD_DATE,()=>val=>new E$5.DateTimeLiteral(Object.assign(Object.assign({},val.typedValue),{hours:0,minutes:0,seconds:0}))).collect()},xsdToBoolean={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_BOOLEAN).onNumeric1(()=>val=>(0,Helpers_1$7.bool)(val.coerceEBV()),!0).onUnary(Consts_1$3.TypeURL.XSD_BOOLEAN,()=>val=>(0,Helpers_1$7.bool)(val.coerceEBV()),!0).onUnary(Consts_1$3.TypeURL.XSD_STRING,()=>val=>{switch(val.str()){case"true":return(0,Helpers_1$7.bool)(!0);case"false":return(0,Helpers_1$7.bool)(!1);case"1":return(0,Helpers_1$7.bool)(!0);case"0":return(0,Helpers_1$7.bool)(!1);default:throw new Err$7.CastError(val,Consts_1$3.TypeURL.XSD_BOOLEAN)}},!1).collect()},xsdToTime={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_TIME).onUnary(Consts_1$3.TypeURL.XSD_TIME,()=>val=>new E$5.TimeLiteral(val.typedValue,val.strValue)).onUnary(Consts_1$3.TypeURL.XSD_DATE_TIME,()=>val=>new E$5.TimeLiteral(val.typedValue)).onStringly1(()=>val=>new E$5.TimeLiteral((0,Parsing_1.parseTime)(val.str()))).collect()},xsdToDate={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_DATE).onUnary(Consts_1$3.TypeURL.XSD_DATE,()=>val=>new E$5.DateLiteral(val.typedValue,val.strValue)).onUnary(Consts_1$3.TypeURL.XSD_DATE_TIME,()=>val=>new E$5.DateLiteral(val.typedValue)).onStringly1(()=>val=>new E$5.DateLiteral((0,Parsing_1.parseDate)(val.str()))).collect()},xsdToDuration={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_DURATION).onUnary(Consts_1$3.TypeURL.XSD_DURATION,()=>val=>new E$5.DurationLiteral(val.typedValue,val.strValue)).onStringly1(()=>val=>new expressions_1$1.DurationLiteral((0,Parsing_1.parseDuration)(val.str()))).collect()},xsdToDayTimeDuration={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_DAY_TIME_DURATION).onUnary(Consts_1$3.TypeURL.XSD_DURATION,()=>val=>new E$5.DayTimeDurationLiteral((0,DateTimeHelpers_1$4.trimToDayTimeDuration)(val.typedValue))).onStringly1(()=>val=>new E$5.DayTimeDurationLiteral((0,Parsing_1.parseDayTimeDuration)(val.str()))).collect()},xsdToYearMonthDuration={arity:1,overloads:(0,Helpers_1$7.declare)(Consts_1$3.TypeURL.XSD_YEAR_MONTH_DURATION).onUnary(Consts_1$3.TypeURL.XSD_DURATION,()=>val=>new E$5.YearMonthDurationLiteral((0,DateTimeHelpers_1$4.trimToYearMonthDuration)(val.typedValue))).onStringly1(()=>val=>new E$5.YearMonthDurationLiteral((0,Parsing_1.parseYearMonthDuration)(val.str()))).collect()};NamedFunctions.namedDefinitions={[Consts_1$3.TypeURL.XSD_STRING]:xsdToString,[Consts_1$3.TypeURL.XSD_FLOAT]:xsdToFloat,[Consts_1$3.TypeURL.XSD_DOUBLE]:xsdToDouble,[Consts_1$3.TypeURL.XSD_DECIMAL]:xsdToDecimal,[Consts_1$3.TypeURL.XSD_INTEGER]:xsdToInteger,[Consts_1$3.TypeURL.XSD_DATE_TIME]:xsdToDatetime,[Consts_1$3.TypeURL.XSD_DATE]:xsdToDate,[Consts_1$3.TypeURL.XSD_BOOLEAN]:xsdToBoolean,[Consts_1$3.TypeURL.XSD_TIME]:xsdToTime,[Consts_1$3.TypeURL.XSD_DURATION]:xsdToDuration,[Consts_1$3.TypeURL.XSD_DAY_TIME_DURATION]:xsdToDayTimeDuration,[Consts_1$3.TypeURL.XSD_YEAR_MONTH_DURATION]:xsdToYearMonthDuration};var RegularFunctions={},bignumber={exports:{}};(function(module){(function(globalObject){var BigNumber,isNumeric2=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,mathceil=Math.ceil,mathfloor=Math.floor,bignumberError="[BigNumber Error] ",tooManyDigits=bignumberError+"Number primitive has more than 15 significant digits: ",BASE=1e14,LOG_BASE=14,MAX_SAFE_INTEGER=9007199254740991,POWS_TEN=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],SQRT_BASE=1e7,MAX2=1e9;function clone(configObject){var div,convertBase,parseNumeric,P=BigNumber2.prototype={constructor:BigNumber2,toString:null,valueOf:null},ONE=new BigNumber2(1),DECIMAL_PLACES=20,ROUNDING_MODE=4,TO_EXP_NEG=-7,TO_EXP_POS=21,MIN_EXP=-1e7,MAX_EXP=1e7,CRYPTO=!1,MODULO_MODE=1,POW_PRECISION=0,FORMAT={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},ALPHABET="0123456789abcdefghijklmnopqrstuvwxyz",alphabetHasNormalDecimalDigits=!0;function BigNumber2(v,b){var alphabet,c,caseChanged,e,i,isNum,len,str,x=this;if(!(x instanceof BigNumber2))return new BigNumber2(v,b);if(b==null){if(v&&v._isBigNumber===!0){x.s=v.s,!v.c||v.e>MAX_EXP?x.c=x.e=null:v.e<MIN_EXP?x.c=[x.e=0]:(x.e=v.e,x.c=v.c.slice());return}if((isNum=typeof v=="number")&&v*0==0){if(x.s=1/v<0?(v=-v,-1):1,v===~~v){for(e=0,i=v;i>=10;i/=10,e++);e>MAX_EXP?x.c=x.e=null:(x.e=e,x.c=[v]);return}str=String(v)}else{if(!isNumeric2.test(str=String(v)))return parseNumeric(x,str,isNum);x.s=str.charCodeAt(0)==45?(str=str.slice(1),-1):1}(e=str.indexOf("."))>-1&&(str=str.replace(".","")),(i=str.search(/e/i))>0?(e<0&&(e=i),e+=+str.slice(i+1),str=str.substring(0,i)):e<0&&(e=str.length)}else{if(intCheck(b,2,ALPHABET.length,"Base"),b==10&&alphabetHasNormalDecimalDigits)return x=new BigNumber2(v),round2(x,DECIMAL_PLACES+x.e+1,ROUNDING_MODE);if(str=String(v),isNum=typeof v=="number"){if(v*0!=0)return parseNumeric(x,str,isNum,b);if(x.s=1/v<0?(str=str.slice(1),-1):1,BigNumber2.DEBUG&&str.replace(/^0\.0*|\./,"").length>15)throw Error(tooManyDigits+v)}else x.s=str.charCodeAt(0)===45?(str=str.slice(1),-1):1;for(alphabet=ALPHABET.slice(0,b),e=i=0,len=str.length;i<len;i++)if(alphabet.indexOf(c=str.charAt(i))<0){if(c=="."){if(i>e){e=len;continue}}else if(!caseChanged&&(str==str.toUpperCase()&&(str=str.toLowerCase())||str==str.toLowerCase()&&(str=str.toUpperCase()))){caseChanged=!0,i=-1,e=0;continue}return parseNumeric(x,String(v),isNum,b)}isNum=!1,str=convertBase(str,b,10,x.s),(e=str.indexOf("."))>-1?str=str.replace(".",""):e=str.length}for(i=0;str.charCodeAt(i)===48;i++);for(len=str.length;str.charCodeAt(--len)===48;);if(str=str.slice(i,++len)){if(len-=i,isNum&&BigNumber2.DEBUG&&len>15&&(v>MAX_SAFE_INTEGER||v!==mathfloor(v)))throw Error(tooManyDigits+x.s*v);if((e=e-i-1)>MAX_EXP)x.c=x.e=null;else if(e<MIN_EXP)x.c=[x.e=0];else{if(x.e=e,x.c=[],i=(e+1)%LOG_BASE,e<0&&(i+=LOG_BASE),i<len){for(i&&x.c.push(+str.slice(0,i)),len-=LOG_BASE;i<len;)x.c.push(+str.slice(i,i+=LOG_BASE));i=LOG_BASE-(str=str.slice(i)).length}else i-=len;for(;i--;str+="0");x.c.push(+str)}}else x.c=[x.e=0]}__name(BigNumber2,"BigNumber"),BigNumber2.clone=clone,BigNumber2.ROUND_UP=0,BigNumber2.ROUND_DOWN=1,BigNumber2.ROUND_CEIL=2,BigNumber2.ROUND_FLOOR=3,BigNumber2.ROUND_HALF_UP=4,BigNumber2.ROUND_HALF_DOWN=5,BigNumber2.ROUND_HALF_EVEN=6,BigNumber2.ROUND_HALF_CEIL=7,BigNumber2.ROUND_HALF_FLOOR=8,BigNumber2.EUCLID=9,BigNumber2.config=BigNumber2.set=function(obj){var p,v;if(obj!=null)if(typeof obj=="object"){if(obj.hasOwnProperty(p="DECIMAL_PLACES")&&(v=obj[p],intCheck(v,0,MAX2,p),DECIMAL_PLACES=v),obj.hasOwnProperty(p="ROUNDING_MODE")&&(v=obj[p],intCheck(v,0,8,p),ROUNDING_MODE=v),obj.hasOwnProperty(p="EXPONENTIAL_AT")&&(v=obj[p],v&&v.pop?(intCheck(v[0],-MAX2,0,p),intCheck(v[1],0,MAX2,p),TO_EXP_NEG=v[0],TO_EXP_POS=v[1]):(intCheck(v,-MAX2,MAX2,p),TO_EXP_NEG=-(TO_EXP_POS=v<0?-v:v))),obj.hasOwnProperty(p="RANGE"))if(v=obj[p],v&&v.pop)intCheck(v[0],-MAX2,-1,p),intCheck(v[1],1,MAX2,p),MIN_EXP=v[0],MAX_EXP=v[1];else if(intCheck(v,-MAX2,MAX2,p),v)MIN_EXP=-(MAX_EXP=v<0?-v:v);else throw Error(bignumberError+p+" cannot be zero: "+v);if(obj.hasOwnProperty(p="CRYPTO"))if(v=obj[p],v===!!v)if(v)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))CRYPTO=v;else throw CRYPTO=!v,Error(bignumberError+"crypto unavailable");else CRYPTO=v;else throw Error(bignumberError+p+" not true or false: "+v);if(obj.hasOwnProperty(p="MODULO_MODE")&&(v=obj[p],intCheck(v,0,9,p),MODULO_MODE=v),obj.hasOwnProperty(p="POW_PRECISION")&&(v=obj[p],intCheck(v,0,MAX2,p),POW_PRECISION=v),obj.hasOwnProperty(p="FORMAT"))if(v=obj[p],typeof v=="object")FORMAT=v;else throw Error(bignumberError+p+" not an object: "+v);if(obj.hasOwnProperty(p="ALPHABET"))if(v=obj[p],typeof v=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(v))alphabetHasNormalDecimalDigits=v.slice(0,10)=="0123456789",ALPHABET=v;else throw Error(bignumberError+p+" invalid: "+v)}else throw Error(bignumberError+"Object expected: "+obj);return{DECIMAL_PLACES,ROUNDING_MODE,EXPONENTIAL_AT:[TO_EXP_NEG,TO_EXP_POS],RANGE:[MIN_EXP,MAX_EXP],CRYPTO,MODULO_MODE,POW_PRECISION,FORMAT,ALPHABET}},BigNumber2.isBigNumber=function(v){if(!v||v._isBigNumber!==!0)return!1;if(!BigNumber2.DEBUG)return!0;var i,n,c=v.c,e=v.e,s2=v.s;out:if({}.toString.call(c)=="[object Array]"){if((s2===1||s2===-1)&&e>=-MAX2&&e<=MAX2&&e===mathfloor(e)){if(c[0]===0){if(e===0&&c.length===1)return!0;break out}if(i=(e+1)%LOG_BASE,i<1&&(i+=LOG_BASE),String(c[0]).length==i){for(i=0;i<c.length;i++)if(n=c[i],n<0||n>=BASE||n!==mathfloor(n))break out;if(n!==0)return!0}}}else if(c===null&&e===null&&(s2===null||s2===1||s2===-1))return!0;throw Error(bignumberError+"Invalid BigNumber: "+v)},BigNumber2.maximum=BigNumber2.max=function(){return maxOrMin(arguments,P.lt)},BigNumber2.minimum=BigNumber2.min=function(){return maxOrMin(arguments,P.gt)},BigNumber2.random=function(){var pow2_53=9007199254740992,random53bitInt=Math.random()*pow2_53&2097151?function(){return mathfloor(Math.random()*pow2_53)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(dp){var a,b,e,k,v,i=0,c=[],rand2=new BigNumber2(ONE);if(dp==null?dp=DECIMAL_PLACES:intCheck(dp,0,MAX2),k=mathceil(dp/LOG_BASE),CRYPTO)if(crypto.getRandomValues){for(a=crypto.getRandomValues(new Uint32Array(k*=2));i<k;)v=a[i]*131072+(a[i+1]>>>11),v>=9e15?(b=crypto.getRandomValues(new Uint32Array(2)),a[i]=b[0],a[i+1]=b[1]):(c.push(v%1e14),i+=2);i=k/2}else if(crypto.randomBytes){for(a=crypto.randomBytes(k*=7);i<k;)v=(a[i]&31)*281474976710656+a[i+1]*1099511627776+a[i+2]*4294967296+a[i+3]*16777216+(a[i+4]<<16)+(a[i+5]<<8)+a[i+6],v>=9e15?crypto.randomBytes(7).copy(a,i):(c.push(v%1e14),i+=7);i=k/7}else throw CRYPTO=!1,Error(bignumberError+"crypto unavailable");if(!CRYPTO)for(;i<k;)v=random53bitInt(),v<9e15&&(c[i++]=v%1e14);for(k=c[--i],dp%=LOG_BASE,k&&dp&&(v=POWS_TEN[LOG_BASE-dp],c[i]=mathfloor(k/v)*v);c[i]===0;c.pop(),i--);if(i<0)c=[e=0];else{for(e=-1;c[0]===0;c.splice(0,1),e-=LOG_BASE);for(i=1,v=c[0];v>=10;v/=10,i++);i<LOG_BASE&&(e-=LOG_BASE-i)}return rand2.e=e,rand2.c=c,rand2}}(),BigNumber2.sum=function(){for(var i=1,args=arguments,sum=new BigNumber2(args[0]);i<args.length;)sum=sum.plus(args[i++]);return sum},convertBase=function(){var decimal="0123456789";function toBaseOut(str,baseIn,baseOut,alphabet){for(var j,arr=[0],arrL,i=0,len=str.length;i<len;){for(arrL=arr.length;arrL--;arr[arrL]*=baseIn);for(arr[0]+=alphabet.indexOf(str.charAt(i++)),j=0;j<arr.length;j++)arr[j]>baseOut-1&&(arr[j+1]==null&&(arr[j+1]=0),arr[j+1]+=arr[j]/baseOut|0,arr[j]%=baseOut)}return arr.reverse()}return __name(toBaseOut,"toBaseOut"),function(str,baseIn,baseOut,sign,callerIsToString){var alphabet,d,e,k,r2,x,xc,y,i=str.indexOf("."),dp=DECIMAL_PLACES,rm=ROUNDING_MODE;for(i>=0&&(k=POW_PRECISION,POW_PRECISION=0,str=str.replace(".",""),y=new BigNumber2(baseIn),x=y.pow(str.length-i),POW_PRECISION=k,y.c=toBaseOut(toFixedPoint(coeffToString(x.c),x.e,"0"),10,baseOut,decimal),y.e=y.c.length),xc=toBaseOut(str,baseIn,baseOut,callerIsToString?(alphabet=ALPHABET,decimal):(alphabet=decimal,ALPHABET)),e=k=xc.length;xc[--k]==0;xc.pop());if(!xc[0])return alphabet.charAt(0);if(i<0?--e:(x.c=xc,x.e=e,x.s=sign,x=div(x,y,dp,rm,baseOut),xc=x.c,r2=x.r,e=x.e),d=e+dp+1,i=xc[d],k=baseOut/2,r2=r2||d<0||xc[d+1]!=null,r2=rm<4?(i!=null||r2)&&(rm==0||rm==(x.s<0?3:2)):i>k||i==k&&(rm==4||r2||rm==6&&xc[d-1]&1||rm==(x.s<0?8:7)),d<1||!xc[0])str=r2?toFixedPoint(alphabet.charAt(1),-dp,alphabet.charAt(0)):alphabet.charAt(0);else{if(xc.length=d,r2)for(--baseOut;++xc[--d]>baseOut;)xc[d]=0,d||(++e,xc=[1].concat(xc));for(k=xc.length;!xc[--k];);for(i=0,str="";i<=k;str+=alphabet.charAt(xc[i++]));str=toFixedPoint(str,e,alphabet.charAt(0))}return str}}(),div=function(){function multiply(x,k,base){var m,temp,xlo,xhi,carry=0,i=x.length,klo=k%SQRT_BASE,khi=k/SQRT_BASE|0;for(x=x.slice();i--;)xlo=x[i]%SQRT_BASE,xhi=x[i]/SQRT_BASE|0,m=khi*xlo+xhi*klo,temp=klo*xlo+m%SQRT_BASE*SQRT_BASE+carry,carry=(temp/base|0)+(m/SQRT_BASE|0)+khi*xhi,x[i]=temp%base;return carry&&(x=[carry].concat(x)),x}__name(multiply,"multiply");function compare2(a,b,aL,bL){var i,cmp;if(aL!=bL)cmp=aL>bL?1:-1;else for(i=cmp=0;i<aL;i++)if(a[i]!=b[i]){cmp=a[i]>b[i]?1:-1;break}return cmp}__name(compare2,"compare");function subtract(a,b,aL,base){for(var i=0;aL--;)a[aL]-=i,i=a[aL]<b[aL]?1:0,a[aL]=i*base+a[aL]-b[aL];for(;!a[0]&&a.length>1;a.splice(0,1));}return __name(subtract,"subtract"),function(x,y,dp,rm,base){var cmp,e,i,more,n,prod,prodL,q,qc,rem,remL,rem0,xi,xL,yc0,yL,yz,s2=x.s==y.s?1:-1,xc=x.c,yc=y.c;if(!xc||!xc[0]||!yc||!yc[0])return new BigNumber2(!x.s||!y.s||(xc?yc&&xc[0]==yc[0]:!yc)?NaN:xc&&xc[0]==0||!yc?s2*0:s2/0);for(q=new BigNumber2(s2),qc=q.c=[],e=x.e-y.e,s2=dp+e+1,base||(base=BASE,e=bitFloor(x.e/LOG_BASE)-bitFloor(y.e/LOG_BASE),s2=s2/LOG_BASE|0),i=0;yc[i]==(xc[i]||0);i++);if(yc[i]>(xc[i]||0)&&e--,s2<0)qc.push(1),more=!0;else{for(xL=xc.length,yL=yc.length,i=0,s2+=2,n=mathfloor(base/(yc[0]+1)),n>1&&(yc=multiply(yc,n,base),xc=multiply(xc,n,base),yL=yc.length,xL=xc.length),xi=yL,rem=xc.slice(0,yL),remL=rem.length;remL<yL;rem[remL++]=0);yz=yc.slice(),yz=[0].concat(yz),yc0=yc[0],yc[1]>=base/2&&yc0++;do{if(n=0,cmp=compare2(yc,rem,yL,remL),cmp<0){if(rem0=rem[0],yL!=remL&&(rem0=rem0*base+(rem[1]||0)),n=mathfloor(rem0/yc0),n>1)for(n>=base&&(n=base-1),prod=multiply(yc,n,base),prodL=prod.length,remL=rem.length;compare2(prod,rem,prodL,remL)==1;)n--,subtract(prod,yL<prodL?yz:yc,prodL,base),prodL=prod.length,cmp=1;else n==0&&(cmp=n=1),prod=yc.slice(),prodL=prod.length;if(prodL<remL&&(prod=[0].concat(prod)),subtract(rem,prod,remL,base),remL=rem.length,cmp==-1)for(;compare2(yc,rem,yL,remL)<1;)n++,subtract(rem,yL<remL?yz:yc,remL,base),remL=rem.length}else cmp===0&&(n++,rem=[0]);qc[i++]=n,rem[0]?rem[remL++]=xc[xi]||0:(rem=[xc[xi]],remL=1)}while((xi++<xL||rem[0]!=null)&&s2--);more=rem[0]!=null,qc[0]||qc.splice(0,1)}if(base==BASE){for(i=1,s2=qc[0];s2>=10;s2/=10,i++);round2(q,dp+(q.e=i+e*LOG_BASE-1)+1,rm,more)}else q.e=e,q.r=+more;return q}}();function format(n,i,rm,id){var c0,e,ne,len,str;if(rm==null?rm=ROUNDING_MODE:intCheck(rm,0,8),!n.c)return n.toString();if(c0=n.c[0],ne=n.e,i==null)str=coeffToString(n.c),str=id==1||id==2&&(ne<=TO_EXP_NEG||ne>=TO_EXP_POS)?toExponential(str,ne):toFixedPoint(str,ne,"0");else if(n=round2(new BigNumber2(n),i,rm),e=n.e,str=coeffToString(n.c),len=str.length,id==1||id==2&&(i<=e||e<=TO_EXP_NEG)){for(;len<i;str+="0",len++);str=toExponential(str,e)}else if(i-=ne,str=toFixedPoint(str,e,"0"),e+1>len){if(--i>0)for(str+=".";i--;str+="0");}else if(i+=e-len,i>0)for(e+1==len&&(str+=".");i--;str+="0");return n.s<0&&c0?"-"+str:str}__name(format,"format");function maxOrMin(args,method){for(var n,i=1,m=new BigNumber2(args[0]);i<args.length;i++)if(n=new BigNumber2(args[i]),n.s)method.call(m,n)&&(m=n);else{m=n;break}return m}__name(maxOrMin,"maxOrMin");function normalise(n,c,e){for(var i=1,j=c.length;!c[--j];c.pop());for(j=c[0];j>=10;j/=10,i++);return(e=i+e*LOG_BASE-1)>MAX_EXP?n.c=n.e=null:e<MIN_EXP?n.c=[n.e=0]:(n.e=e,n.c=c),n}__name(normalise,"normalise"),parseNumeric=function(){var basePrefix=/^(-?)0([xbo])(?=\w[\w.]*$)/i,dotAfter=/^([^.]+)\.$/,dotBefore=/^\.([^.]+)$/,isInfinityOrNaN=/^-?(Infinity|NaN)$/,whitespaceOrPlus=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(x,str,isNum,b){var base,s2=isNum?str:str.replace(whitespaceOrPlus,"");if(isInfinityOrNaN.test(s2))x.s=isNaN(s2)?null:s2<0?-1:1;else{if(!isNum&&(s2=s2.replace(basePrefix,function(m,p1,p2){return base=(p2=p2.toLowerCase())=="x"?16:p2=="b"?2:8,!b||b==base?p1:m}),b&&(base=b,s2=s2.replace(dotAfter,"$1").replace(dotBefore,"0.$1")),str!=s2))return new BigNumber2(s2,base);if(BigNumber2.DEBUG)throw Error(bignumberError+"Not a"+(b?" base "+b:"")+" number: "+str);x.s=null}x.c=x.e=null}}();function round2(x,sd,rm,r2){var d,i,j,k,n,ni,rd,xc=x.c,pows10=POWS_TEN;if(xc){out:{for(d=1,k=xc[0];k>=10;k/=10,d++);if(i=sd-d,i<0)i+=LOG_BASE,j=sd,n=xc[ni=0],rd=n/pows10[d-j-1]%10|0;else if(ni=mathceil((i+1)/LOG_BASE),ni>=xc.length)if(r2){for(;xc.length<=ni;xc.push(0));n=rd=0,d=1,i%=LOG_BASE,j=i-LOG_BASE+1}else break out;else{for(n=k=xc[ni],d=1;k>=10;k/=10,d++);i%=LOG_BASE,j=i-LOG_BASE+d,rd=j<0?0:n/pows10[d-j-1]%10|0}if(r2=r2||sd<0||xc[ni+1]!=null||(j<0?n:n%pows10[d-j-1]),r2=rm<4?(rd||r2)&&(rm==0||rm==(x.s<0?3:2)):rd>5||rd==5&&(rm==4||r2||rm==6&&(i>0?j>0?n/pows10[d-j]:0:xc[ni-1])%10&1||rm==(x.s<0?8:7)),sd<1||!xc[0])return xc.length=0,r2?(sd-=x.e+1,xc[0]=pows10[(LOG_BASE-sd%LOG_BASE)%LOG_BASE],x.e=-sd||0):xc[0]=x.e=0,x;if(i==0?(xc.length=ni,k=1,ni--):(xc.length=ni+1,k=pows10[LOG_BASE-i],xc[ni]=j>0?mathfloor(n/pows10[d-j]%pows10[j])*k:0),r2)for(;;)if(ni==0){for(i=1,j=xc[0];j>=10;j/=10,i++);for(j=xc[0]+=k,k=1;j>=10;j/=10,k++);i!=k&&(x.e++,xc[0]==BASE&&(xc[0]=1));break}else{if(xc[ni]+=k,xc[ni]!=BASE)break;xc[ni--]=0,k=1}for(i=xc.length;xc[--i]===0;xc.pop());}x.e>MAX_EXP?x.c=x.e=null:x.e<MIN_EXP&&(x.c=[x.e=0])}return x}__name(round2,"round");function valueOf2(n){var str,e=n.e;return e===null?n.toString():(str=coeffToString(n.c),str=e<=TO_EXP_NEG||e>=TO_EXP_POS?toExponential(str,e):toFixedPoint(str,e,"0"),n.s<0?"-"+str:str)}return __name(valueOf2,"valueOf"),P.absoluteValue=P.abs=function(){var x=new BigNumber2(this);return x.s<0&&(x.s=1),x},P.comparedTo=function(y,b){return compare(this,new BigNumber2(y,b))},P.decimalPlaces=P.dp=function(dp,rm){var c,n,v,x=this;if(dp!=null)return intCheck(dp,0,MAX2),rm==null?rm=ROUNDING_MODE:intCheck(rm,0,8),round2(new BigNumber2(x),dp+x.e+1,rm);if(!(c=x.c))return null;if(n=((v=c.length-1)-bitFloor(this.e/LOG_BASE))*LOG_BASE,v=c[v])for(;v%10==0;v/=10,n--);return n<0&&(n=0),n},P.dividedBy=P.div=function(y,b){return div(this,new BigNumber2(y,b),DECIMAL_PLACES,ROUNDING_MODE)},P.dividedToIntegerBy=P.idiv=function(y,b){return div(this,new BigNumber2(y,b),0,1)},P.exponentiatedBy=P.pow=function(n,m){var half,isModExp,i,k,more,nIsBig,nIsNeg,nIsOdd,y,x=this;if(n=new BigNumber2(n),n.c&&!n.isInteger())throw Error(bignumberError+"Exponent not an integer: "+valueOf2(n));if(m!=null&&(m=new BigNumber2(m)),nIsBig=n.e>14,!x.c||!x.c[0]||x.c[0]==1&&!x.e&&x.c.length==1||!n.c||!n.c[0])return y=new BigNumber2(Math.pow(+valueOf2(x),nIsBig?n.s*(2-isOdd(n)):+valueOf2(n))),m?y.mod(m):y;if(nIsNeg=n.s<0,m){if(m.c?!m.c[0]:!m.s)return new BigNumber2(NaN);isModExp=!nIsNeg&&x.isInteger()&&m.isInteger(),isModExp&&(x=x.mod(m))}else{if(n.e>9&&(x.e>0||x.e<-1||(x.e==0?x.c[0]>1||nIsBig&&x.c[1]>=24e7:x.c[0]<8e13||nIsBig&&x.c[0]<=9999975e7)))return k=x.s<0&&isOdd(n)?-0:0,x.e>-1&&(k=1/k),new BigNumber2(nIsNeg?1/k:k);POW_PRECISION&&(k=mathceil(POW_PRECISION/LOG_BASE+2))}for(nIsBig?(half=new BigNumber2(.5),nIsNeg&&(n.s=1),nIsOdd=isOdd(n)):(i=Math.abs(+valueOf2(n)),nIsOdd=i%2),y=new BigNumber2(ONE);;){if(nIsOdd){if(y=y.times(x),!y.c)break;k?y.c.length>k&&(y.c.length=k):isModExp&&(y=y.mod(m))}if(i){if(i=mathfloor(i/2),i===0)break;nIsOdd=i%2}else if(n=n.times(half),round2(n,n.e+1,1),n.e>14)nIsOdd=isOdd(n);else{if(i=+valueOf2(n),i===0)break;nIsOdd=i%2}x=x.times(x),k?x.c&&x.c.length>k&&(x.c.length=k):isModExp&&(x=x.mod(m))}return isModExp?y:(nIsNeg&&(y=ONE.div(y)),m?y.mod(m):k?round2(y,POW_PRECISION,ROUNDING_MODE,more):y)},P.integerValue=function(rm){var n=new BigNumber2(this);return rm==null?rm=ROUNDING_MODE:intCheck(rm,0,8),round2(n,n.e+1,rm)},P.isEqualTo=P.eq=function(y,b){return compare(this,new BigNumber2(y,b))===0},P.isFinite=function(){return!!this.c},P.isGreaterThan=P.gt=function(y,b){return compare(this,new BigNumber2(y,b))>0},P.isGreaterThanOrEqualTo=P.gte=function(y,b){return(b=compare(this,new BigNumber2(y,b)))===1||b===0},P.isInteger=function(){return!!this.c&&bitFloor(this.e/LOG_BASE)>this.c.length-2},P.isLessThan=P.lt=function(y,b){return compare(this,new BigNumber2(y,b))<0},P.isLessThanOrEqualTo=P.lte=function(y,b){return(b=compare(this,new BigNumber2(y,b)))===-1||b===0},P.isNaN=function(){return!this.s},P.isNegative=function(){return this.s<0},P.isPositive=function(){return this.s>0},P.isZero=function(){return!!this.c&&this.c[0]==0},P.minus=function(y,b){var i,j,t,xLTy,x=this,a=x.s;if(y=new BigNumber2(y,b),b=y.s,!a||!b)return new BigNumber2(NaN);if(a!=b)return y.s=-b,x.plus(y);var xe=x.e/LOG_BASE,ye=y.e/LOG_BASE,xc=x.c,yc=y.c;if(!xe||!ye){if(!xc||!yc)return xc?(y.s=-b,y):new BigNumber2(yc?x:NaN);if(!xc[0]||!yc[0])return yc[0]?(y.s=-b,y):new BigNumber2(xc[0]?x:ROUNDING_MODE==3?-0:0)}if(xe=bitFloor(xe),ye=bitFloor(ye),xc=xc.slice(),a=xe-ye){for((xLTy=a<0)?(a=-a,t=xc):(ye=xe,t=yc),t.reverse(),b=a;b--;t.push(0));t.reverse()}else for(j=(xLTy=(a=xc.length)<(b=yc.length))?a:b,a=b=0;b<j;b++)if(xc[b]!=yc[b]){xLTy=xc[b]<yc[b];break}if(xLTy&&(t=xc,xc=yc,yc=t,y.s=-y.s),b=(j=yc.length)-(i=xc.length),b>0)for(;b--;xc[i++]=0);for(b=BASE-1;j>a;){if(xc[--j]<yc[j]){for(i=j;i&&!xc[--i];xc[i]=b);--xc[i],xc[j]+=BASE}xc[j]-=yc[j]}for(;xc[0]==0;xc.splice(0,1),--ye);return xc[0]?normalise(y,xc,ye):(y.s=ROUNDING_MODE==3?-1:1,y.c=[y.e=0],y)},P.modulo=P.mod=function(y,b){var q,s2,x=this;return y=new BigNumber2(y,b),!x.c||!y.s||y.c&&!y.c[0]?new BigNumber2(NaN):!y.c||x.c&&!x.c[0]?new BigNumber2(x):(MODULO_MODE==9?(s2=y.s,y.s=1,q=div(x,y,0,3),y.s=s2,q.s*=s2):q=div(x,y,0,MODULO_MODE),y=x.minus(q.times(y)),!y.c[0]&&MODULO_MODE==1&&(y.s=x.s),y)},P.multipliedBy=P.times=function(y,b){var c,e,i,j,k,m,xcL,xlo,xhi,ycL,ylo,yhi,zc,base,sqrtBase,x=this,xc=x.c,yc=(y=new BigNumber2(y,b)).c;if(!xc||!yc||!xc[0]||!yc[0])return!x.s||!y.s||xc&&!xc[0]&&!yc||yc&&!yc[0]&&!xc?y.c=y.e=y.s=null:(y.s*=x.s,!xc||!yc?y.c=y.e=null:(y.c=[0],y.e=0)),y;for(e=bitFloor(x.e/LOG_BASE)+bitFloor(y.e/LOG_BASE),y.s*=x.s,xcL=xc.length,ycL=yc.length,xcL<ycL&&(zc=xc,xc=yc,yc=zc,i=xcL,xcL=ycL,ycL=i),i=xcL+ycL,zc=[];i--;zc.push(0));for(base=BASE,sqrtBase=SQRT_BASE,i=ycL;--i>=0;){for(c=0,ylo=yc[i]%sqrtBase,yhi=yc[i]/sqrtBase|0,k=xcL,j=i+k;j>i;)xlo=xc[--k]%sqrtBase,xhi=xc[k]/sqrtBase|0,m=yhi*xlo+xhi*ylo,xlo=ylo*xlo+m%sqrtBase*sqrtBase+zc[j]+c,c=(xlo/base|0)+(m/sqrtBase|0)+yhi*xhi,zc[j--]=xlo%base;zc[j]=c}return c?++e:zc.splice(0,1),normalise(y,zc,e)},P.negated=function(){var x=new BigNumber2(this);return x.s=-x.s||null,x},P.plus=function(y,b){var t,x=this,a=x.s;if(y=new BigNumber2(y,b),b=y.s,!a||!b)return new BigNumber2(NaN);if(a!=b)return y.s=-b,x.minus(y);var xe=x.e/LOG_BASE,ye=y.e/LOG_BASE,xc=x.c,yc=y.c;if(!xe||!ye){if(!xc||!yc)return new BigNumber2(a/0);if(!xc[0]||!yc[0])return yc[0]?y:new BigNumber2(xc[0]?x:a*0)}if(xe=bitFloor(xe),ye=bitFloor(ye),xc=xc.slice(),a=xe-ye){for(a>0?(ye=xe,t=yc):(a=-a,t=xc),t.reverse();a--;t.push(0));t.reverse()}for(a=xc.length,b=yc.length,a-b<0&&(t=yc,yc=xc,xc=t,b=a),a=0;b;)a=(xc[--b]=xc[b]+yc[b]+a)/BASE|0,xc[b]=BASE===xc[b]?0:xc[b]%BASE;return a&&(xc=[a].concat(xc),++ye),normalise(y,xc,ye)},P.precision=P.sd=function(sd,rm){var c,n,v,x=this;if(sd!=null&&sd!==!!sd)return intCheck(sd,1,MAX2),rm==null?rm=ROUNDING_MODE:intCheck(rm,0,8),round2(new BigNumber2(x),sd,rm);if(!(c=x.c))return null;if(v=c.length-1,n=v*LOG_BASE+1,v=c[v]){for(;v%10==0;v/=10,n--);for(v=c[0];v>=10;v/=10,n++);}return sd&&x.e+1>n&&(n=x.e+1),n},P.shiftedBy=function(k){return intCheck(k,-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER),this.times("1e"+k)},P.squareRoot=P.sqrt=function(){var m,n,r2,rep,t,x=this,c=x.c,s2=x.s,e=x.e,dp=DECIMAL_PLACES+4,half=new BigNumber2("0.5");if(s2!==1||!c||!c[0])return new BigNumber2(!s2||s2<0&&(!c||c[0])?NaN:c?x:1/0);if(s2=Math.sqrt(+valueOf2(x)),s2==0||s2==1/0?(n=coeffToString(c),(n.length+e)%2==0&&(n+="0"),s2=Math.sqrt(+n),e=bitFloor((e+1)/2)-(e<0||e%2),s2==1/0?n="5e"+e:(n=s2.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r2=new BigNumber2(n)):r2=new BigNumber2(s2+""),r2.c[0]){for(e=r2.e,s2=e+dp,s2<3&&(s2=0);;)if(t=r2,r2=half.times(t.plus(div(x,t,dp,1))),coeffToString(t.c).slice(0,s2)===(n=coeffToString(r2.c)).slice(0,s2))if(r2.e<e&&--s2,n=n.slice(s2-3,s2+1),n=="9999"||!rep&&n=="4999"){if(!rep&&(round2(t,t.e+DECIMAL_PLACES+2,0),t.times(t).eq(x))){r2=t;break}dp+=4,s2+=4,rep=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(round2(r2,r2.e+DECIMAL_PLACES+2,1),m=!r2.times(r2).eq(x));break}}return round2(r2,r2.e+DECIMAL_PLACES+1,ROUNDING_MODE,m)},P.toExponential=function(dp,rm){return dp!=null&&(intCheck(dp,0,MAX2),dp++),format(this,dp,rm,1)},P.toFixed=function(dp,rm){return dp!=null&&(intCheck(dp,0,MAX2),dp=dp+this.e+1),format(this,dp,rm)},P.toFormat=function(dp,rm,format2){var str,x=this;if(format2==null)dp!=null&&rm&&typeof rm=="object"?(format2=rm,rm=null):dp&&typeof dp=="object"?(format2=dp,dp=rm=null):format2=FORMAT;else if(typeof format2!="object")throw Error(bignumberError+"Argument not an object: "+format2);if(str=x.toFixed(dp,rm),x.c){var i,arr=str.split("."),g1=+format2.groupSize,g2=+format2.secondaryGroupSize,groupSeparator=format2.groupSeparator||"",intPart=arr[0],fractionPart=arr[1],isNeg2=x.s<0,intDigits=isNeg2?intPart.slice(1):intPart,len=intDigits.length;if(g2&&(i=g1,g1=g2,g2=i,len-=i),g1>0&&len>0){for(i=len%g1||g1,intPart=intDigits.substr(0,i);i<len;i+=g1)intPart+=groupSeparator+intDigits.substr(i,g1);g2>0&&(intPart+=groupSeparator+intDigits.slice(i)),isNeg2&&(intPart="-"+intPart)}str=fractionPart?intPart+(format2.decimalSeparator||"")+((g2=+format2.fractionGroupSize)?fractionPart.replace(new RegExp("\\d{"+g2+"}\\B","g"),"$&"+(format2.fractionGroupSeparator||"")):fractionPart):intPart}return(format2.prefix||"")+str+(format2.suffix||"")},P.toFraction=function(md){var d,d0,d1,d2,e,exp,n,n0,n1,q,r2,s2,x=this,xc=x.c;if(md!=null&&(n=new BigNumber2(md),!n.isInteger()&&(n.c||n.s!==1)||n.lt(ONE)))throw Error(bignumberError+"Argument "+(n.isInteger()?"out of range: ":"not an integer: ")+valueOf2(n));if(!xc)return new BigNumber2(x);for(d=new BigNumber2(ONE),n1=d0=new BigNumber2(ONE),d1=n0=new BigNumber2(ONE),s2=coeffToString(xc),e=d.e=s2.length-x.e-1,d.c[0]=POWS_TEN[(exp=e%LOG_BASE)<0?LOG_BASE+exp:exp],md=!md||n.comparedTo(d)>0?e>0?d:n1:n,exp=MAX_EXP,MAX_EXP=1/0,n=new BigNumber2(s2),n0.c[0]=0;q=div(n,d,0,1),d2=d0.plus(q.times(d1)),d2.comparedTo(md)!=1;)d0=d1,d1=d2,n1=n0.plus(q.times(d2=n1)),n0=d2,d=n.minus(q.times(d2=d)),n=d2;return d2=div(md.minus(d0),d1,0,1),n0=n0.plus(d2.times(n1)),d0=d0.plus(d2.times(d1)),n0.s=n1.s=x.s,e=e*2,r2=div(n1,d1,e,ROUNDING_MODE).minus(x).abs().comparedTo(div(n0,d0,e,ROUNDING_MODE).minus(x).abs())<1?[n1,d1]:[n0,d0],MAX_EXP=exp,r2},P.toNumber=function(){return+valueOf2(this)},P.toPrecision=function(sd,rm){return sd!=null&&intCheck(sd,1,MAX2),format(this,sd,rm,2)},P.toString=function(b){var str,n=this,s2=n.s,e=n.e;return e===null?s2?(str="Infinity",s2<0&&(str="-"+str)):str="NaN":(b==null?str=e<=TO_EXP_NEG||e>=TO_EXP_POS?toExponential(coeffToString(n.c),e):toFixedPoint(coeffToString(n.c),e,"0"):b===10&&alphabetHasNormalDecimalDigits?(n=round2(new BigNumber2(n),DECIMAL_PLACES+e+1,ROUNDING_MODE),str=toFixedPoint(coeffToString(n.c),n.e,"0")):(intCheck(b,2,ALPHABET.length,"Base"),str=convertBase(toFixedPoint(coeffToString(n.c),e,"0"),10,b,s2,!0)),s2<0&&n.c[0]&&(str="-"+str)),str},P.valueOf=P.toJSON=function(){return valueOf2(this)},P._isBigNumber=!0,configObject!=null&&BigNumber2.set(configObject),BigNumber2}__name(clone,"clone");function bitFloor(n){var i=n|0;return n>0||n===i?i:i-1}__name(bitFloor,"bitFloor");function coeffToString(a){for(var s2,z,i=1,j=a.length,r2=a[0]+"";i<j;){for(s2=a[i++]+"",z=LOG_BASE-s2.length;z--;s2="0"+s2);r2+=s2}for(j=r2.length;r2.charCodeAt(--j)===48;);return r2.slice(0,j+1||1)}__name(coeffToString,"coeffToString");function compare(x,y){var a,b,xc=x.c,yc=y.c,i=x.s,j=y.s,k=x.e,l=y.e;if(!i||!j)return null;if(a=xc&&!xc[0],b=yc&&!yc[0],a||b)return a?b?0:-j:i;if(i!=j)return i;if(a=i<0,b=k==l,!xc||!yc)return b?0:!xc^a?1:-1;if(!b)return k>l^a?1:-1;for(j=(k=xc.length)<(l=yc.length)?k:l,i=0;i<j;i++)if(xc[i]!=yc[i])return xc[i]>yc[i]^a?1:-1;return k==l?0:k>l^a?1:-1}__name(compare,"compare");function intCheck(n,min2,max2,name){if(n<min2||n>max2||n!==mathfloor(n))throw Error(bignumberError+(name||"Argument")+(typeof n=="number"?n<min2||n>max2?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}__name(intCheck,"intCheck");function isOdd(n){var k=n.c.length-1;return bitFloor(n.e/LOG_BASE)==k&&n.c[k]%2!=0}__name(isOdd,"isOdd");function toExponential(str,e){return(str.length>1?str.charAt(0)+"."+str.slice(1):str)+(e<0?"e":"e+")+e}__name(toExponential,"toExponential");function toFixedPoint(str,e,z){var len,zs;if(e<0){for(zs=z+".";++e;zs+=z);str=zs+str}else if(len=str.length,++e>len){for(zs=z,e-=len;--e;zs+=z);str+=zs}else e<len&&(str=str.slice(0,e)+"."+str.slice(e));return str}__name(toFixedPoint,"toFixedPoint"),BigNumber=clone(),BigNumber.default=BigNumber.BigNumber=BigNumber,module.exports?module.exports=BigNumber:(globalObject||(globalObject=typeof self<"u"&&self?self:window),globalObject.BigNumber=BigNumber)})(commonjsGlobal)})(bignumber);var bignumberExports=bignumber.exports,sparkMd5={exports:{}};(function(module,exports){(function(factory2){module.exports=factory2()})(function(undefined$1){var hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a+=(b&c|~b&d)+k[0]-680876936|0,a=(a<<7|a>>>25)+b|0,d+=(a&b|~a&c)+k[1]-389564586|0,d=(d<<12|d>>>20)+a|0,c+=(d&a|~d&b)+k[2]+606105819|0,c=(c<<17|c>>>15)+d|0,b+=(c&d|~c&a)+k[3]-1044525330|0,b=(b<<22|b>>>10)+c|0,a+=(b&c|~b&d)+k[4]-176418897|0,a=(a<<7|a>>>25)+b|0,d+=(a&b|~a&c)+k[5]+1200080426|0,d=(d<<12|d>>>20)+a|0,c+=(d&a|~d&b)+k[6]-1473231341|0,c=(c<<17|c>>>15)+d|0,b+=(c&d|~c&a)+k[7]-45705983|0,b=(b<<22|b>>>10)+c|0,a+=(b&c|~b&d)+k[8]+1770035416|0,a=(a<<7|a>>>25)+b|0,d+=(a&b|~a&c)+k[9]-1958414417|0,d=(d<<12|d>>>20)+a|0,c+=(d&a|~d&b)+k[10]-42063|0,c=(c<<17|c>>>15)+d|0,b+=(c&d|~c&a)+k[11]-1990404162|0,b=(b<<22|b>>>10)+c|0,a+=(b&c|~b&d)+k[12]+1804603682|0,a=(a<<7|a>>>25)+b|0,d+=(a&b|~a&c)+k[13]-40341101|0,d=(d<<12|d>>>20)+a|0,c+=(d&a|~d&b)+k[14]-1502002290|0,c=(c<<17|c>>>15)+d|0,b+=(c&d|~c&a)+k[15]+1236535329|0,b=(b<<22|b>>>10)+c|0,a+=(b&d|c&~d)+k[1]-165796510|0,a=(a<<5|a>>>27)+b|0,d+=(a&c|b&~c)+k[6]-1069501632|0,d=(d<<9|d>>>23)+a|0,c+=(d&b|a&~b)+k[11]+643717713|0,c=(c<<14|c>>>18)+d|0,b+=(c&a|d&~a)+k[0]-373897302|0,b=(b<<20|b>>>12)+c|0,a+=(b&d|c&~d)+k[5]-701558691|0,a=(a<<5|a>>>27)+b|0,d+=(a&c|b&~c)+k[10]+38016083|0,d=(d<<9|d>>>23)+a|0,c+=(d&b|a&~b)+k[15]-660478335|0,c=(c<<14|c>>>18)+d|0,b+=(c&a|d&~a)+k[4]-405537848|0,b=(b<<20|b>>>12)+c|0,a+=(b&d|c&~d)+k[9]+568446438|0,a=(a<<5|a>>>27)+b|0,d+=(a&c|b&~c)+k[14]-1019803690|0,d=(d<<9|d>>>23)+a|0,c+=(d&b|a&~b)+k[3]-187363961|0,c=(c<<14|c>>>18)+d|0,b+=(c&a|d&~a)+k[8]+1163531501|0,b=(b<<20|b>>>12)+c|0,a+=(b&d|c&~d)+k[13]-1444681467|0,a=(a<<5|a>>>27)+b|0,d+=(a&c|b&~c)+k[2]-51403784|0,d=(d<<9|d>>>23)+a|0,c+=(d&b|a&~b)+k[7]+1735328473|0,c=(c<<14|c>>>18)+d|0,b+=(c&a|d&~a)+k[12]-1926607734|0,b=(b<<20|b>>>12)+c|0,a+=(b^c^d)+k[5]-378558|0,a=(a<<4|a>>>28)+b|0,d+=(a^b^c)+k[8]-2022574463|0,d=(d<<11|d>>>21)+a|0,c+=(d^a^b)+k[11]+1839030562|0,c=(c<<16|c>>>16)+d|0,b+=(c^d^a)+k[14]-35309556|0,b=(b<<23|b>>>9)+c|0,a+=(b^c^d)+k[1]-1530992060|0,a=(a<<4|a>>>28)+b|0,d+=(a^b^c)+k[4]+1272893353|0,d=(d<<11|d>>>21)+a|0,c+=(d^a^b)+k[7]-155497632|0,c=(c<<16|c>>>16)+d|0,b+=(c^d^a)+k[10]-1094730640|0,b=(b<<23|b>>>9)+c|0,a+=(b^c^d)+k[13]+681279174|0,a=(a<<4|a>>>28)+b|0,d+=(a^b^c)+k[0]-358537222|0,d=(d<<11|d>>>21)+a|0,c+=(d^a^b)+k[3]-722521979|0,c=(c<<16|c>>>16)+d|0,b+=(c^d^a)+k[6]+76029189|0,b=(b<<23|b>>>9)+c|0,a+=(b^c^d)+k[9]-640364487|0,a=(a<<4|a>>>28)+b|0,d+=(a^b^c)+k[12]-421815835|0,d=(d<<11|d>>>21)+a|0,c+=(d^a^b)+k[15]+530742520|0,c=(c<<16|c>>>16)+d|0,b+=(c^d^a)+k[2]-995338651|0,b=(b<<23|b>>>9)+c|0,a+=(c^(b|~d))+k[0]-198630844|0,a=(a<<6|a>>>26)+b|0,d+=(b^(a|~c))+k[7]+1126891415|0,d=(d<<10|d>>>22)+a|0,c+=(a^(d|~b))+k[14]-1416354905|0,c=(c<<15|c>>>17)+d|0,b+=(d^(c|~a))+k[5]-57434055|0,b=(b<<21|b>>>11)+c|0,a+=(c^(b|~d))+k[12]+1700485571|0,a=(a<<6|a>>>26)+b|0,d+=(b^(a|~c))+k[3]-1894986606|0,d=(d<<10|d>>>22)+a|0,c+=(a^(d|~b))+k[10]-1051523|0,c=(c<<15|c>>>17)+d|0,b+=(d^(c|~a))+k[1]-2054922799|0,b=(b<<21|b>>>11)+c|0,a+=(c^(b|~d))+k[8]+1873313359|0,a=(a<<6|a>>>26)+b|0,d+=(b^(a|~c))+k[15]-30611744|0,d=(d<<10|d>>>22)+a|0,c+=(a^(d|~b))+k[6]-1560198380|0,c=(c<<15|c>>>17)+d|0,b+=(d^(c|~a))+k[13]+1309151649|0,b=(b<<21|b>>>11)+c|0,a+=(c^(b|~d))+k[4]-145523070|0,a=(a<<6|a>>>26)+b|0,d+=(b^(a|~c))+k[11]-1120210379|0,d=(d<<10|d>>>22)+a|0,c+=(a^(d|~b))+k[2]+718787259|0,c=(c<<15|c>>>17)+d|0,b+=(d^(c|~a))+k[9]-343485551|0,b=(b<<21|b>>>11)+c|0,x[0]=a+x[0]|0,x[1]=b+x[1]|0,x[2]=c+x[2]|0,x[3]=d+x[3]|0}__name(md5cycle,"md5cycle");function md5blk(s2){var md5blks=[],i;for(i=0;i<64;i+=4)md5blks[i>>2]=s2.charCodeAt(i)+(s2.charCodeAt(i+1)<<8)+(s2.charCodeAt(i+2)<<16)+(s2.charCodeAt(i+3)<<24);return md5blks}__name(md5blk,"md5blk");function md5blk_array(a){var md5blks=[],i;for(i=0;i<64;i+=4)md5blks[i>>2]=a[i]+(a[i+1]<<8)+(a[i+2]<<16)+(a[i+3]<<24);return md5blks}__name(md5blk_array,"md5blk_array");function md51(s2){var n=s2.length,state=[1732584193,-271733879,-1732584194,271733878],i,length,tail,tmp,lo,hi;for(i=64;i<=n;i+=64)md5cycle(state,md5blk(s2.substring(i-64,i)));for(s2=s2.substring(i-64),length=s2.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<length;i+=1)tail[i>>2]|=s2.charCodeAt(i)<<(i%4<<3);if(tail[i>>2]|=128<<(i%4<<3),i>55)for(md5cycle(state,tail),i=0;i<16;i+=1)tail[i]=0;return tmp=n*8,tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(state,tail),state}__name(md51,"md51");function md51_array(a){var n=a.length,state=[1732584193,-271733879,-1732584194,271733878],i,length,tail,tmp,lo,hi;for(i=64;i<=n;i+=64)md5cycle(state,md5blk_array(a.subarray(i-64,i)));for(a=i-64<n?a.subarray(i-64):new Uint8Array(0),length=a.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<length;i+=1)tail[i>>2]|=a[i]<<(i%4<<3);if(tail[i>>2]|=128<<(i%4<<3),i>55)for(md5cycle(state,tail),i=0;i<16;i+=1)tail[i]=0;return tmp=n*8,tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(state,tail),state}__name(md51_array,"md51_array");function rhex(n){var s2="",j;for(j=0;j<4;j+=1)s2+=hex_chr[n>>j*8+4&15]+hex_chr[n>>j*8&15];return s2}__name(rhex,"rhex");function hex(x){var i;for(i=0;i<x.length;i+=1)x[i]=rhex(x[i]);return x.join("")}__name(hex,"hex"),hex(md51("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function clamp(val,length){return val=val|0||0,val<0?Math.max(val+length,0):Math.min(val,length)}__name(clamp,"clamp"),ArrayBuffer.prototype.slice=function(from,to){var length=this.byteLength,begin=clamp(from,length),end=length,num,target,targetArray,sourceArray;return to!==undefined$1&&(end=clamp(to,length)),begin>end?new ArrayBuffer(0):(num=end-begin,target=new ArrayBuffer(num),targetArray=new Uint8Array(target),sourceArray=new Uint8Array(this,begin,num),targetArray.set(sourceArray),target)}}();function toUtf8(str){return/[\u0080-\uFFFF]/.test(str)&&(str=unescape(encodeURIComponent(str))),str}__name(toUtf8,"toUtf8");function utf8Str2ArrayBuffer(str,returnUInt8Array){var length=str.length,buff=new ArrayBuffer(length),arr=new Uint8Array(buff),i;for(i=0;i<length;i+=1)arr[i]=str.charCodeAt(i);return returnUInt8Array?arr:buff}__name(utf8Str2ArrayBuffer,"utf8Str2ArrayBuffer");function arrayBuffer2Utf8Str(buff){return String.fromCharCode.apply(null,new Uint8Array(buff))}__name(arrayBuffer2Utf8Str,"arrayBuffer2Utf8Str");function concatenateArrayBuffers(first3,second,returnUInt8Array){var result=new Uint8Array(first3.byteLength+second.byteLength);return result.set(new Uint8Array(first3)),result.set(new Uint8Array(second),first3.byteLength),returnUInt8Array?result:result.buffer}__name(concatenateArrayBuffers,"concatenateArrayBuffers");function hexToBinaryString(hex2){var bytes=[],length=hex2.length,x;for(x=0;x<length-1;x+=2)bytes.push(parseInt(hex2.substr(x,2),16));return String.fromCharCode.apply(String,bytes)}__name(hexToBinaryString,"hexToBinaryString");function SparkMD5(){this.reset()}return __name(SparkMD5,"SparkMD5"),SparkMD5.prototype.append=function(str){return this.appendBinary(toUtf8(str)),this},SparkMD5.prototype.appendBinary=function(contents){this._buff+=contents,this._length+=contents.length;var length=this._buff.length,i;for(i=64;i<=length;i+=64)md5cycle(this._hash,md5blk(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},SparkMD5.prototype.end=function(raw){var buff=this._buff,length=buff.length,i,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ret;for(i=0;i<length;i+=1)tail[i>>2]|=buff.charCodeAt(i)<<(i%4<<3);return this._finish(tail,length),ret=hex(this._hash),raw&&(ret=hexToBinaryString(ret)),this.reset(),ret},SparkMD5.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},SparkMD5.prototype.setState=function(state){return this._buff=state.buff,this._length=state.length,this._hash=state.hash,this},SparkMD5.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},SparkMD5.prototype._finish=function(tail,length){var i=length,tmp,lo,hi;if(tail[i>>2]|=128<<(i%4<<3),i>55)for(md5cycle(this._hash,tail),i=0;i<16;i+=1)tail[i]=0;tmp=this._length*8,tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(this._hash,tail)},SparkMD5.hash=function(str,raw){return SparkMD5.hashBinary(toUtf8(str),raw)},SparkMD5.hashBinary=function(content,raw){var hash2=md51(content),ret=hex(hash2);return raw?hexToBinaryString(ret):ret},SparkMD5.ArrayBuffer=function(){this.reset()},SparkMD5.ArrayBuffer.prototype.append=function(arr){var buff=concatenateArrayBuffers(this._buff.buffer,arr,!0),length=buff.length,i;for(this._length+=arr.byteLength,i=64;i<=length;i+=64)md5cycle(this._hash,md5blk_array(buff.subarray(i-64,i)));return this._buff=i-64<length?new Uint8Array(buff.buffer.slice(i-64)):new Uint8Array(0),this},SparkMD5.ArrayBuffer.prototype.end=function(raw){var buff=this._buff,length=buff.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i,ret;for(i=0;i<length;i+=1)tail[i>>2]|=buff[i]<<(i%4<<3);return this._finish(tail,length),ret=hex(this._hash),raw&&(ret=hexToBinaryString(ret)),this.reset(),ret},SparkMD5.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.ArrayBuffer.prototype.getState=function(){var state=SparkMD5.prototype.getState.call(this);return state.buff=arrayBuffer2Utf8Str(state.buff),state},SparkMD5.ArrayBuffer.prototype.setState=function(state){return state.buff=utf8Str2ArrayBuffer(state.buff,!0),SparkMD5.prototype.setState.call(this,state)},SparkMD5.ArrayBuffer.prototype.destroy=SparkMD5.prototype.destroy,SparkMD5.ArrayBuffer.prototype._finish=SparkMD5.prototype._finish,SparkMD5.ArrayBuffer.hash=function(arr,raw){var hash2=md51_array(new Uint8Array(arr)),ret=hex(hash2);return raw?hexToBinaryString(ret):ret},SparkMD5})})(sparkMd5);var sparkMd5Exports=sparkMd5.exports,getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}__name(rng,"rng");const REGEX$1=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(uuid2){return typeof uuid2=="string"&&REGEX$1.test(uuid2)}__name(validate,"validate");var byteToHex=[];for(var i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(arr){var offset=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,uuid2=(byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+"-"+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+"-"+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+"-"+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+"-"+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]).toLowerCase();if(!validate(uuid2))throw TypeError("Stringified UUID is invalid");return uuid2}__name(stringify,"stringify");var _nodeId,_clockseq,_lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0,b=buf||new Array(16);options=options||{};var node2=options.node||_nodeId,clockseq=options.clockseq!==void 0?options.clockseq:_clockseq;if(node2==null||clockseq==null){var seedBytes=options.random||(options.rng||rng)();node2==null&&(node2=_nodeId=[seedBytes[0]|1,seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]),clockseq==null&&(clockseq=_clockseq=(seedBytes[6]<<8|seedBytes[7])&16383)}var msecs=options.msecs!==void 0?options.msecs:Date.now(),nsecs=options.nsecs!==void 0?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===void 0&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&options.nsecs===void 0&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=tmh&255,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=clockseq&255;for(var n=0;n<6;++n)b[i+n]=node2[n];return buf||stringify(b)}__name(v1,"v1");function parse2(uuid2){if(!validate(uuid2))throw TypeError("Invalid UUID");var v,arr=new Uint8Array(16);return arr[0]=(v=parseInt(uuid2.slice(0,8),16))>>>24,arr[1]=v>>>16&255,arr[2]=v>>>8&255,arr[3]=v&255,arr[4]=(v=parseInt(uuid2.slice(9,13),16))>>>8,arr[5]=v&255,arr[6]=(v=parseInt(uuid2.slice(14,18),16))>>>8,arr[7]=v&255,arr[8]=(v=parseInt(uuid2.slice(19,23),16))>>>8,arr[9]=v&255,arr[10]=(v=parseInt(uuid2.slice(24,36),16))/1099511627776&255,arr[11]=v/4294967296&255,arr[12]=v>>>24&255,arr[13]=v>>>16&255,arr[14]=v>>>8&255,arr[15]=v&255,arr}__name(parse2,"parse");function stringToBytes(str){str=unescape(encodeURIComponent(str));for(var bytes=[],i=0;i<str.length;++i)bytes.push(str.charCodeAt(i));return bytes}__name(stringToBytes,"stringToBytes");var DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",URL$1="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function v35(name,version2,hashfunc){function generateUUID(value,namespace,buf,offset){if(typeof value=="string"&&(value=stringToBytes(value)),typeof namespace=="string"&&(namespace=parse2(namespace)),namespace.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var bytes=new Uint8Array(16+value.length);if(bytes.set(namespace),bytes.set(value,namespace.length),bytes=hashfunc(bytes),bytes[6]=bytes[6]&15|version2,bytes[8]=bytes[8]&63|128,buf){offset=offset||0;for(var i=0;i<16;++i)buf[offset+i]=bytes[i];return buf}return stringify(bytes)}__name(generateUUID,"generateUUID");try{generateUUID.name=name}catch{}return generateUUID.DNS=DNS,generateUUID.URL=URL$1,generateUUID}__name(v35,"v35");function md5(bytes){if(typeof bytes=="string"){var msg=unescape(encodeURIComponent(bytes));bytes=new Uint8Array(msg.length);for(var i=0;i<msg.length;++i)bytes[i]=msg.charCodeAt(i)}return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes),bytes.length*8))}__name(md5,"md5");function md5ToHexEncodedArray(input){for(var output=[],length32=input.length*32,hexTab="0123456789abcdef",i=0;i<length32;i+=8){var x=input[i>>5]>>>i%32&255,hex=parseInt(hexTab.charAt(x>>>4&15)+hexTab.charAt(x&15),16);output.push(hex)}return output}__name(md5ToHexEncodedArray,"md5ToHexEncodedArray");function getOutputLength(inputLength8){return(inputLength8+64>>>9<<4)+14+1}__name(getOutputLength,"getOutputLength");function wordsToMd5(x,len){x[len>>5]|=128<<len%32,x[getOutputLength(len)-1]=len;for(var a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;a=md5ff(a,b,c,d,x[i],7,-680876936),d=md5ff(d,a,b,c,x[i+1],12,-389564586),c=md5ff(c,d,a,b,x[i+2],17,606105819),b=md5ff(b,c,d,a,x[i+3],22,-1044525330),a=md5ff(a,b,c,d,x[i+4],7,-176418897),d=md5ff(d,a,b,c,x[i+5],12,1200080426),c=md5ff(c,d,a,b,x[i+6],17,-1473231341),b=md5ff(b,c,d,a,x[i+7],22,-45705983),a=md5ff(a,b,c,d,x[i+8],7,1770035416),d=md5ff(d,a,b,c,x[i+9],12,-1958414417),c=md5ff(c,d,a,b,x[i+10],17,-42063),b=md5ff(b,c,d,a,x[i+11],22,-1990404162),a=md5ff(a,b,c,d,x[i+12],7,1804603682),d=md5ff(d,a,b,c,x[i+13],12,-40341101),c=md5ff(c,d,a,b,x[i+14],17,-1502002290),b=md5ff(b,c,d,a,x[i+15],22,1236535329),a=md5gg(a,b,c,d,x[i+1],5,-165796510),d=md5gg(d,a,b,c,x[i+6],9,-1069501632),c=md5gg(c,d,a,b,x[i+11],14,643717713),b=md5gg(b,c,d,a,x[i],20,-373897302),a=md5gg(a,b,c,d,x[i+5],5,-701558691),d=md5gg(d,a,b,c,x[i+10],9,38016083),c=md5gg(c,d,a,b,x[i+15],14,-660478335),b=md5gg(b,c,d,a,x[i+4],20,-405537848),a=md5gg(a,b,c,d,x[i+9],5,568446438),d=md5gg(d,a,b,c,x[i+14],9,-1019803690),c=md5gg(c,d,a,b,x[i+3],14,-187363961),b=md5gg(b,c,d,a,x[i+8],20,1163531501),a=md5gg(a,b,c,d,x[i+13],5,-1444681467),d=md5gg(d,a,b,c,x[i+2],9,-51403784),c=md5gg(c,d,a,b,x[i+7],14,1735328473),b=md5gg(b,c,d,a,x[i+12],20,-1926607734),a=md5hh(a,b,c,d,x[i+5],4,-378558),d=md5hh(d,a,b,c,x[i+8],11,-2022574463),c=md5hh(c,d,a,b,x[i+11],16,1839030562),b=md5hh(b,c,d,a,x[i+14],23,-35309556),a=md5hh(a,b,c,d,x[i+1],4,-1530992060),d=md5hh(d,a,b,c,x[i+4],11,1272893353),c=md5hh(c,d,a,b,x[i+7],16,-155497632),b=md5hh(b,c,d,a,x[i+10],23,-1094730640),a=md5hh(a,b,c,d,x[i+13],4,681279174),d=md5hh(d,a,b,c,x[i],11,-358537222),c=md5hh(c,d,a,b,x[i+3],16,-722521979),b=md5hh(b,c,d,a,x[i+6],23,76029189),a=md5hh(a,b,c,d,x[i+9],4,-640364487),d=md5hh(d,a,b,c,x[i+12],11,-421815835),c=md5hh(c,d,a,b,x[i+15],16,530742520),b=md5hh(b,c,d,a,x[i+2],23,-995338651),a=md5ii(a,b,c,d,x[i],6,-198630844),d=md5ii(d,a,b,c,x[i+7],10,1126891415),c=md5ii(c,d,a,b,x[i+14],15,-1416354905),b=md5ii(b,c,d,a,x[i+5],21,-57434055),a=md5ii(a,b,c,d,x[i+12],6,1700485571),d=md5ii(d,a,b,c,x[i+3],10,-1894986606),c=md5ii(c,d,a,b,x[i+10],15,-1051523),b=md5ii(b,c,d,a,x[i+1],21,-2054922799),a=md5ii(a,b,c,d,x[i+8],6,1873313359),d=md5ii(d,a,b,c,x[i+15],10,-30611744),c=md5ii(c,d,a,b,x[i+6],15,-1560198380),b=md5ii(b,c,d,a,x[i+13],21,1309151649),a=md5ii(a,b,c,d,x[i+4],6,-145523070),d=md5ii(d,a,b,c,x[i+11],10,-1120210379),c=md5ii(c,d,a,b,x[i+2],15,718787259),b=md5ii(b,c,d,a,x[i+9],21,-343485551),a=safeAdd(a,olda),b=safeAdd(b,oldb),c=safeAdd(c,oldc),d=safeAdd(d,oldd)}return[a,b,c,d]}__name(wordsToMd5,"wordsToMd5");function bytesToWords(input){if(input.length===0)return[];for(var length8=input.length*8,output=new Uint32Array(getOutputLength(length8)),i=0;i<length8;i+=8)output[i>>5]|=(input[i/8]&255)<<i%32;return output}__name(bytesToWords,"bytesToWords");function safeAdd(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}__name(safeAdd,"safeAdd");function bitRotateLeft(num,cnt){return num<<cnt|num>>>32-cnt}__name(bitRotateLeft,"bitRotateLeft");function md5cmn(q,a,b,x,s2,t){return safeAdd(bitRotateLeft(safeAdd(safeAdd(a,q),safeAdd(x,t)),s2),b)}__name(md5cmn,"md5cmn");function md5ff(a,b,c,d,x,s2,t){return md5cmn(b&c|~b&d,a,b,x,s2,t)}__name(md5ff,"md5ff");function md5gg(a,b,c,d,x,s2,t){return md5cmn(b&d|c&~d,a,b,x,s2,t)}__name(md5gg,"md5gg");function md5hh(a,b,c,d,x,s2,t){return md5cmn(b^c^d,a,b,x,s2,t)}__name(md5hh,"md5hh");function md5ii(a,b,c,d,x,s2,t){return md5cmn(c^(b|~d),a,b,x,s2,t)}__name(md5ii,"md5ii");var v3=v35("v3",48,md5);const v3$1=v3;function v4(options,buf,offset){options=options||{};var rnds=options.random||(options.rng||rng)();if(rnds[6]=rnds[6]&15|64,rnds[8]=rnds[8]&63|128,buf){offset=offset||0;for(var i=0;i<16;++i)buf[offset+i]=rnds[i];return buf}return stringify(rnds)}__name(v4,"v4");function f(s2,x,y,z){switch(s2){case 0:return x&y^~x&z;case 1:return x^y^z;case 2:return x&y^x&z^y&z;case 3:return x^y^z}}__name(f,"f");function ROTL(x,n){return x<<n|x>>>32-n}__name(ROTL,"ROTL");function sha1(bytes){var K2=[1518500249,1859775393,2400959708,3395469782],H=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof bytes=="string"){var msg=unescape(encodeURIComponent(bytes));bytes=[];for(var i=0;i<msg.length;++i)bytes.push(msg.charCodeAt(i))}else Array.isArray(bytes)||(bytes=Array.prototype.slice.call(bytes));bytes.push(128);for(var l=bytes.length/4+2,N=Math.ceil(l/16),M=new Array(N),_i=0;_i<N;++_i){for(var arr=new Uint32Array(16),j=0;j<16;++j)arr[j]=bytes[_i*64+j*4]<<24|bytes[_i*64+j*4+1]<<16|bytes[_i*64+j*4+2]<<8|bytes[_i*64+j*4+3];M[_i]=arr}M[N-1][14]=(bytes.length-1)*8/Math.pow(2,32),M[N-1][14]=Math.floor(M[N-1][14]),M[N-1][15]=(bytes.length-1)*8&4294967295;for(var _i2=0;_i2<N;++_i2){for(var W=new Uint32Array(80),t=0;t<16;++t)W[t]=M[_i2][t];for(var _t=16;_t<80;++_t)W[_t]=ROTL(W[_t-3]^W[_t-8]^W[_t-14]^W[_t-16],1);for(var a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],_t2=0;_t2<80;++_t2){var s2=Math.floor(_t2/20),T=ROTL(a,5)+f(s2,b,c,d)+e+K2[s2]+W[_t2]>>>0;e=d,d=c,c=ROTL(b,30)>>>0,b=a,a=T}H[0]=H[0]+a>>>0,H[1]=H[1]+b>>>0,H[2]=H[2]+c>>>0,H[3]=H[3]+d>>>0,H[4]=H[4]+e>>>0}return[H[0]>>24&255,H[0]>>16&255,H[0]>>8&255,H[0]&255,H[1]>>24&255,H[1]>>16&255,H[1]>>8&255,H[1]&255,H[2]>>24&255,H[2]>>16&255,H[2]>>8&255,H[2]&255,H[3]>>24&255,H[3]>>16&255,H[3]>>8&255,H[3]&255,H[4]>>24&255,H[4]>>16&255,H[4]>>8&255,H[4]&255]}__name(sha1,"sha1");var v5=v35("v5",80,sha1);const v5$1=v5,nil="00000000-0000-0000-0000-000000000000";function version(uuid2){if(!validate(uuid2))throw TypeError("Invalid UUID");return parseInt(uuid2.substr(14,1),16)}__name(version,"version");const esmBrowser=Object.freeze(Object.defineProperty({__proto__:null,NIL:nil,parse:parse2,stringify,v1,v3:v3$1,v4,v5:v5$1,validate,version},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(esmBrowser);var Ordering={};Object.defineProperty(Ordering,"__esModule",{value:!0});Ordering.orderTypes=void 0;const LRUCache$3=lruCache,expressions_1=requireExpressions(),TermTransformer_1$5=requireTermTransformer(),Consts_1$2=Consts,DateTimeHelpers_1$3=DateTimeHelpers,Err$6=Errors,TypeHandling_1$1=requireTypeHandling();function orderTypes(termA,termB,strict=!1,typeDiscoveryCallback,typeCache,enableExtendedXSDTypes){if(termA===termB)return 0;if(termA===void 0)return-1;if(termB===void 0)return 1;if(termA.termType!==termB.termType)return _TERM_ORDERING_PRIORITY[termA.termType]<_TERM_ORDERING_PRIORITY[termB.termType]?-1:1;if(termA.equals(termB))return 0;if(termA.termType==="Quad"&&termB.termType==="Quad"){const orderSubject=orderTypes(termA.subject,termB.subject,strict,typeDiscoveryCallback,typeCache);if(orderSubject!==0)return orderSubject;const orderPredicate=orderTypes(termA.predicate,termB.predicate,strict,typeDiscoveryCallback,typeCache);if(orderPredicate!==0)return orderPredicate;const orderObject=orderTypes(termA.object,termB.object,strict,typeDiscoveryCallback,typeCache);return orderObject!==0?orderObject:orderTypes(termA.graph,termB.graph,strict,typeDiscoveryCallback,typeCache)}if(termA.termType==="Literal")return orderLiteralTypes(termA,termB,typeDiscoveryCallback,typeCache);if(strict)throw new Err$6.InvalidCompareArgumentTypes(termA,termB);return comparePrimitives(termA.value,termB.value)}__name(orderTypes,"orderTypes");Ordering.orderTypes=orderTypes;function orderLiteralTypes(litA,litB,typeDiscoveryCallback,typeCache){const defaultTimezone={zoneHours:0,zoneMinutes:0},openWorldType={discoverer:typeDiscoveryCallback||(()=>"term"),cache:typeCache||new LRUCache$3},termTransformer=new TermTransformer_1$5.TermTransformer(openWorldType),myLitA=termTransformer.transformLiteral(litA),myLitB=termTransformer.transformLiteral(litB),typeA=myLitA.dataType,typeB=myLitB.dataType,superTypeDictA=(0,TypeHandling_1$1.getSuperTypeDict)(typeA,openWorldType),superTypeDictB=(0,TypeHandling_1$1.getSuperTypeDict)(typeB,openWorldType);if(!(0,expressions_1.isNonLexicalLiteral)(myLitA)&&!(0,expressions_1.isNonLexicalLiteral)(myLitB)){if(Consts_1$2.TypeURL.XSD_BOOLEAN in superTypeDictA&&Consts_1$2.TypeURL.XSD_BOOLEAN in superTypeDictB||Consts_1$2.TypeAlias.SPARQL_NUMERIC in superTypeDictA&&Consts_1$2.TypeAlias.SPARQL_NUMERIC in superTypeDictB||Consts_1$2.TypeURL.XSD_STRING in superTypeDictA&&Consts_1$2.TypeURL.XSD_STRING in superTypeDictB)return comparePrimitives(myLitA.typedValue,myLitB.typedValue);if(Consts_1$2.TypeURL.XSD_DATE_TIME in superTypeDictA&&Consts_1$2.TypeURL.XSD_DATE_TIME in superTypeDictB)return comparePrimitives((0,DateTimeHelpers_1$3.toUTCDate)(myLitA.typedValue,defaultTimezone).getTime(),(0,DateTimeHelpers_1$3.toUTCDate)(myLitB.typedValue,defaultTimezone).getTime());if(Consts_1$2.TypeURL.RDF_LANG_STRING in superTypeDictA&&Consts_1$2.TypeURL.RDF_LANG_STRING in superTypeDictB){const compareType2=comparePrimitives(myLitA.typedValue,myLitB.typedValue);return compareType2!==0?compareType2:comparePrimitives(myLitA.language,myLitB.language)}}const compareType=comparePrimitives(typeA,typeB);return compareType!==0?compareType:comparePrimitives(myLitA.str(),myLitB.str())}__name(orderLiteralTypes,"orderLiteralTypes");function comparePrimitives(valueA,valueB){return valueA===valueB?0:valueA<valueB?-1:1}__name(comparePrimitives,"comparePrimitives");const _TERM_ORDERING_PRIORITY={Variable:0,BlankNode:1,NamedNode:2,Literal:3,Quad:4,DefaultGraph:5};var XPathFunctions={};Object.defineProperty(XPathFunctions,"__esModule",{value:!0});XPathFunctions.langMatches=XPathFunctions.replace=XPathFunctions.matches=void 0;function matches(text,pattern,flags){return new RegExp(pattern,flags).test(text)}__name(matches,"matches");XPathFunctions.matches=matches;function replace(arg,pattern,replacement,flags){let reg=new RegExp(pattern,flags);if(!reg.global){const flags_=flags||"";reg=new RegExp(pattern,`${flags_}g`)}return arg.replace(reg,replacement)}__name(replace,"replace");XPathFunctions.replace=replace;function langMatches(tag,range){const langTags=tag.split("-"),rangeTags=range.split("-");if(!_matchLangTag(rangeTags[0],langTags[0])&&!_isWildCard(langTags[0]))return!1;let lI=1,rI=1;for(;rI<rangeTags.length;){if(_isWildCard(rangeTags[rI])){rI++;continue}if(lI===langTags.length)return!1;if(_matchLangTag(rangeTags[rI],langTags[lI])){lI++,rI++;continue}if(langTags[lI].length===1)return!1;lI++}return!0}__name(langMatches,"langMatches");XPathFunctions.langMatches=langMatches;function _isWildCard(tag){return tag==="*"}__name(_isWildCard,"_isWildCard");function _matchLangTag(left,right){return new RegExp(`/${left}/`,"iu").test(`/${right}/`)}__name(_matchLangTag,"_matchLangTag");Object.defineProperty(RegularFunctions,"__esModule",{value:!0});RegularFunctions.definitions=void 0;const bignumber_js_1=bignumberExports,hash_js_1=hash,rdf_data_factory_1$e=rdfDataFactory,relative_to_absolute_iri_1$2=relativeToAbsoluteIri,spark_md5_1=sparkMd5Exports,uuid=require$$0,E$4=requireExpressions(),TermTransformer_1$4=requireTermTransformer(),C$3=Consts,Consts_1$1=Consts,DateTimeHelpers_1$2=DateTimeHelpers,Err$5=Errors,Ordering_1=Ordering,SpecAlgos_1=SpecAlgos,Core_1=Core,Helpers_1$6=requireHelpers(),X=XPathFunctions,DF$e=new rdf_data_factory_1$e.DataFactory,not={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.NOT).onTerm1(()=>val=>(0,Helpers_1$6.bool)(!val.coerceEBV())).collect()},unaryPlus={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.UPLUS).numericConverter(()=>val=>val).collect()},unaryMinus={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.UMINUS).numericConverter(()=>val=>-val).collect()},multiplication={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.MULTIPLICATION).arithmetic(()=>(left,right)=>new bignumber_js_1.BigNumber(left).times(right).toNumber()).collect()},division={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.DIVISION).arithmetic(()=>(left,right)=>new bignumber_js_1.BigNumber(left).div(right).toNumber()).onBinaryTyped([Consts_1$1.TypeURL.XSD_INTEGER,Consts_1$1.TypeURL.XSD_INTEGER],()=>(left,right)=>{if(right===0)throw new Err$5.ExpressionError("Integer division by 0");return(0,Helpers_1$6.decimal)(new bignumber_js_1.BigNumber(left).div(right).toNumber())}).collect()},addition={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.ADDITION).arithmetic(()=>(left,right)=>new bignumber_js_1.BigNumber(left).plus(right).toNumber()).set([Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([date,dur])=>new E$4.DateTimeLiteral((0,SpecAlgos_1.addDurationToDateTime)(date.typedValue,(0,DateTimeHelpers_1$2.defaultedDurationRepresentation)(dur.typedValue)))).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],to:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION]}).set([Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([date,dur])=>new E$4.DateLiteral((0,SpecAlgos_1.addDurationToDateTime)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(date.typedValue),(0,DateTimeHelpers_1$2.defaultedDurationRepresentation)(dur.typedValue)))).copy({from:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION]}).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([time,dur])=>new E$4.TimeLiteral((0,SpecAlgos_1.addDurationToDateTime)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time.typedValue),(0,DateTimeHelpers_1$2.defaultedDurationRepresentation)(dur.typedValue)))).copy({from:[Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],to:[Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION]}).collect()},subtraction={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SUBTRACTION).arithmetic(()=>(left,right)=>new bignumber_js_1.BigNumber(left).minus(right).toNumber()).set([Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],({defaultTimeZone})=>([date1,date2])=>new E$4.DayTimeDurationLiteral((0,SpecAlgos_1.elapsedDuration)(date1.typedValue,date2.typedValue,defaultTimeZone))).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DATE]}).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_TIME]}).set([Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([date,dur])=>new E$4.DateTimeLiteral((0,SpecAlgos_1.addDurationToDateTime)(date.typedValue,(0,DateTimeHelpers_1$2.defaultedDurationRepresentation)((0,DateTimeHelpers_1$2.negateDuration)(dur.typedValue))))).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],to:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION]}).set([Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([date,dur])=>new E$4.DateLiteral((0,SpecAlgos_1.addDurationToDateTime)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(date.typedValue),(0,DateTimeHelpers_1$2.defaultedDurationRepresentation)((0,DateTimeHelpers_1$2.negateDuration)(dur.typedValue))))).copy({from:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION]}).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([time,dur])=>new E$4.TimeLiteral((0,SpecAlgos_1.addDurationToDateTime)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time.typedValue),(0,DateTimeHelpers_1$2.defaultedDurationRepresentation)((0,DateTimeHelpers_1$2.negateDuration)(dur.typedValue))))).collect()},equality={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.EQUAL).numberTest(()=>(left,right)=>left===right).stringTest(()=>(left,right)=>left.localeCompare(right)===0).set([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.RDF_LANG_STRING],()=>([left,right])=>(0,Helpers_1$6.bool)(left.str()===right.str()&&left.language===right.language)).set([Consts_1$1.TypeAlias.SPARQL_STRINGLY,Consts_1$1.TypeAlias.SPARQL_STRINGLY],()=>()=>(0,Helpers_1$6.bool)(!1)).booleanTest(()=>(left,right)=>left===right).dateTimeTest(({defaultTimeZone})=>(left,right)=>(0,DateTimeHelpers_1$2.toUTCDate)(left,defaultTimeZone).getTime()===(0,DateTimeHelpers_1$2.toUTCDate)(right,defaultTimeZone).getTime()).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DATE]}).set(["quad","quad"],context2=>([left,right])=>{const op=new Core_1.RegularFunction(Consts_1$1.RegularOperator.EQUAL,equality);return(0,Helpers_1$6.bool)(op.apply([left.subject,right.subject],context2).coerceEBV()&&op.apply([left.predicate,right.predicate],context2).coerceEBV()&&op.apply([left.object,right.object],context2).coerceEBV())},!1).set(["term","term"],()=>([left,right])=>(0,Helpers_1$6.bool)(RDFTermEqual(left,right)),!1).set([Consts_1$1.TypeURL.XSD_DURATION,Consts_1$1.TypeURL.XSD_DURATION],()=>([dur1,dur2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur1.typedValue))===(0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur2.typedValue))&&(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur1.typedValue))===(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur2.typedValue)))).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_TIME],({defaultTimeZone})=>([time1,time2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time1.typedValue),defaultTimeZone).getTime()===(0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time2.typedValue),defaultTimeZone).getTime())).collect()};function RDFTermEqual(_left,_right){const left=_left.toRDF(),right=_right.toRDF(),val=left.equals(right);if(!val&&left.termType==="Literal"&&right.termType==="Literal")throw new Err$5.RDFEqualTypeError([_left,_right]);return val}__name(RDFTermEqual,"RDFTermEqual");const inequality={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.NOT_EQUAL).numberTest(()=>(left,right)=>left!==right).stringTest(()=>(left,right)=>left.localeCompare(right)!==0).booleanTest(()=>(left,right)=>left!==right).dateTimeTest(({defaultTimeZone})=>(left,right)=>(0,DateTimeHelpers_1$2.toUTCDate)(left,defaultTimeZone).getTime()!==(0,DateTimeHelpers_1$2.toUTCDate)(right,defaultTimeZone).getTime()).set(["quad","quad"],context2=>([left,right])=>{const op=new Core_1.RegularFunction(Consts_1$1.RegularOperator.NOT_EQUAL,inequality);return(0,Helpers_1$6.bool)(op.apply([left.subject,right.subject],context2).coerceEBV()||op.apply([left.predicate,right.predicate],context2).coerceEBV()||op.apply([left.object,right.object],context2).coerceEBV())},!1).set(["term","term"],()=>([left,right])=>(0,Helpers_1$6.bool)(!RDFTermEqual(left,right))).set([Consts_1$1.TypeURL.XSD_DURATION,Consts_1$1.TypeURL.XSD_DURATION],()=>([dur1,dur2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur1.typedValue))!==(0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur2.typedValue))||(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur1.typedValue))!==(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur2.typedValue)))).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DATE]}).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_TIME],({defaultTimeZone})=>([time1,time2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time1.typedValue),defaultTimeZone).getTime()!==(0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time2.typedValue),defaultTimeZone).getTime())).collect()},lesserThan={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.LT).numberTest(()=>(left,right)=>left<right).stringTest(()=>(left,right)=>left.localeCompare(right)===-1).booleanTest(()=>(left,right)=>left<right).set(["quad","quad"],context2=>([left,right])=>(0,Helpers_1$6.bool)((0,Ordering_1.orderTypes)(left.toRDF(),right.toRDF(),!0)===-1),!1).dateTimeTest(({defaultTimeZone})=>(left,right)=>(0,DateTimeHelpers_1$2.toUTCDate)(left,defaultTimeZone).getTime()<(0,DateTimeHelpers_1$2.toUTCDate)(right,defaultTimeZone).getTime()).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DATE]}).set([Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION],()=>([dur1L,dur2L])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur1L.typedValue))<(0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur2L.typedValue)))).set([Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([dur1,dur2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur1.typedValue))<(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur2.typedValue)))).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_TIME],({defaultTimeZone})=>([time1,time2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time1.typedValue),defaultTimeZone).getTime()<(0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time2.typedValue),defaultTimeZone).getTime())).collect()},greaterThan={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.GT).numberTest(()=>(left,right)=>left>right).stringTest(()=>(left,right)=>left.localeCompare(right)===1).booleanTest(()=>(left,right)=>left>right).set(["quad","quad"],context2=>([left,right])=>(0,Helpers_1$6.bool)((0,Ordering_1.orderTypes)(left.toRDF(),right.toRDF(),!0)===1),!1).dateTimeTest(({defaultTimeZone})=>(left,right)=>(0,DateTimeHelpers_1$2.toUTCDate)(left,defaultTimeZone).getTime()>(0,DateTimeHelpers_1$2.toUTCDate)(right,defaultTimeZone).getTime()).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DATE]}).set([Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION],()=>([dur1,dur2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur1.typedValue))>(0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur2.typedValue)))).set([Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([dur1,dur2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur1.typedValue))>(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur2.typedValue)))).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_TIME],({defaultTimeZone})=>([time1,time2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time1.typedValue),defaultTimeZone).getTime()>(0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time2.typedValue),defaultTimeZone).getTime())).collect()},lesserThanEqual={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.LTE).numberTest(()=>(left,right)=>left<=right).stringTest(()=>(left,right)=>left.localeCompare(right)!==1).booleanTest(()=>(left,right)=>left<=right).set(["quad","quad"],context2=>([left,right])=>{const opEq=new Core_1.RegularFunction(Consts_1$1.RegularOperator.EQUAL,equality),opLt=new Core_1.RegularFunction(Consts_1$1.RegularOperator.LT,lesserThan);return(0,Helpers_1$6.bool)(opEq.apply([left,right],context2).coerceEBV()||opLt.apply([left,right],context2).coerceEBV())},!1).dateTimeTest(({defaultTimeZone})=>(left,right)=>(0,DateTimeHelpers_1$2.toUTCDate)(left,defaultTimeZone).getTime()<=(0,DateTimeHelpers_1$2.toUTCDate)(right,defaultTimeZone).getTime()).set([Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION],()=>([dur1L,dur2L])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur1L.typedValue))<=(0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur2L.typedValue)))).set([Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([dur1,dur2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur1.typedValue))<=(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur2.typedValue)))).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DATE]}).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_TIME],({defaultTimeZone})=>([time1,time2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time1.typedValue),defaultTimeZone).getTime()<=(0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time2.typedValue),defaultTimeZone).getTime())).collect()},greaterThanEqual={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.GTE).numberTest(()=>(left,right)=>left>=right).stringTest(()=>(left,right)=>left.localeCompare(right)!==-1).booleanTest(()=>(left,right)=>left>=right).set(["quad","quad"],context2=>([left,right])=>{const opEq=new Core_1.RegularFunction(Consts_1$1.RegularOperator.EQUAL,equality),opGt=new Core_1.RegularFunction(Consts_1$1.RegularOperator.GT,greaterThan);return(0,Helpers_1$6.bool)(opEq.apply([left,right],context2).coerceEBV()||opGt.apply([left,right],context2).coerceEBV())},!1).dateTimeTest(({defaultTimeZone})=>(left,right)=>(0,DateTimeHelpers_1$2.toUTCDate)(left,defaultTimeZone).getTime()>=(0,DateTimeHelpers_1$2.toUTCDate)(right,defaultTimeZone).getTime()).set([Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION,Consts_1$1.TypeURL.XSD_YEAR_MONTH_DURATION],()=>([dur1L,dur2L])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur1L.typedValue))>=(0,DateTimeHelpers_1$2.yearMonthDurationsToMonths)((0,DateTimeHelpers_1$2.defaultedYearMonthDurationRepresentation)(dur2L.typedValue)))).set([Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION,Consts_1$1.TypeURL.XSD_DAY_TIME_DURATION],()=>([dur1,dur2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur1.typedValue))>=(0,DateTimeHelpers_1$2.dayTimeDurationsToSeconds)((0,DateTimeHelpers_1$2.defaultedDayTimeDurationRepresentation)(dur2.typedValue)))).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME,Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE,Consts_1$1.TypeURL.XSD_DATE]}).set([Consts_1$1.TypeURL.XSD_TIME,Consts_1$1.TypeURL.XSD_TIME],({defaultTimeZone})=>([time1,time2])=>(0,Helpers_1$6.bool)((0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time1.typedValue),defaultTimeZone).getTime()>=(0,DateTimeHelpers_1$2.toUTCDate)((0,DateTimeHelpers_1$2.defaultedDateTimeRepresentation)(time2.typedValue),defaultTimeZone).getTime())).collect()},isIRI={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.IS_IRI).onTerm1(()=>term=>(0,Helpers_1$6.bool)(term.termType==="namedNode")).collect()},isBlank={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.IS_BLANK).onTerm1(()=>term=>(0,Helpers_1$6.bool)(term.termType==="blankNode")).collect()},isLiteral={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.IS_LITERAL).onTerm1(()=>term=>(0,Helpers_1$6.bool)(term.termType==="literal")).collect()},isNumeric={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.IS_NUMERIC).onNumeric1(()=>term=>(0,Helpers_1$6.bool)(!0)).onTerm1(()=>term=>(0,Helpers_1$6.bool)(!1)).collect()},STR={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STR).onTerm1(()=>term=>(0,Helpers_1$6.string)(term.str())).collect()},lang={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.LANG).onLiteral1(()=>lit=>(0,Helpers_1$6.string)(lit.language||"")).collect()},datatype={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.DATATYPE).onLiteral1(()=>lit=>new E$4.NamedNode(lit.dataType)).collect()},IRI={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.IRI).set(["namedNode"],context2=>args=>{const lit=args[0],iri=(0,relative_to_absolute_iri_1$2.resolve)(lit.str(),context2.baseIRI||"");return new E$4.NamedNode(iri)}).onString1(context2=>lit=>{const iri=(0,relative_to_absolute_iri_1$2.resolve)(lit.str(),context2.baseIRI||"");return new E$4.NamedNode(iri)}).collect()},STRDT={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRDT).set([Consts_1$1.TypeURL.XSD_STRING,"namedNode"],({superTypeProvider})=>([str,iri])=>{const lit=DF$e.literal(str.typedValue,DF$e.namedNode(iri.value));return new TermTransformer_1$4.TermTransformer(superTypeProvider).transformLiteral(lit)}).collect()},STRLANG={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRLANG).onBinaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(val,language2)=>new E$4.LangStringLiteral(val,language2.toLowerCase())).collect()},UUID={arity:0,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.UUID).set([],()=>()=>new E$4.NamedNode(`urn:uuid:${uuid.v4()}`)).collect()},STRUUID={arity:0,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRUUID).set([],()=>()=>(0,Helpers_1$6.string)(uuid.v4())).collect()},STRLEN={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRLEN).onStringly1(()=>str=>(0,Helpers_1$6.integer)([...str.typedValue].length)).collect()},SUBSTR={arity:[2,3],overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SUBSTR).onBinaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_INTEGER],()=>(source,startingLoc)=>(0,Helpers_1$6.string)([...source].slice(startingLoc-1).join(""))).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.XSD_INTEGER],()=>(source,startingLoc)=>{const sub=[...source.typedValue].slice(startingLoc.typedValue-1).join("");return(0,Helpers_1$6.langString)(sub,source.language)}).onTernaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_INTEGER,Consts_1$1.TypeURL.XSD_INTEGER],()=>(source,startingLoc,length)=>(0,Helpers_1$6.string)([...source].slice(startingLoc-1,length+startingLoc-1).join(""))).onTernary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.XSD_INTEGER,Consts_1$1.TypeURL.XSD_INTEGER],()=>(source,startingLoc,length)=>{const sub=[...source.typedValue].slice(startingLoc.typedValue-1,length.typedValue+startingLoc.typedValue-1).join("");return(0,Helpers_1$6.langString)(sub,source.language)}).collect()},UCASE={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.UCASE).onString1Typed(()=>lit=>(0,Helpers_1$6.string)(lit.toUpperCase())).onLangString1(()=>lit=>(0,Helpers_1$6.langString)(lit.typedValue.toUpperCase(),lit.language)).collect()},LCASE={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.LCASE).onString1Typed(()=>lit=>(0,Helpers_1$6.string)(lit.toLowerCase())).onLangString1(()=>lit=>(0,Helpers_1$6.langString)(lit.typedValue.toLowerCase(),lit.language)).collect()},STRSTARTS={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRSTARTS).onBinaryTyped([Consts_1$1.TypeAlias.SPARQL_STRINGLY,Consts_1$1.TypeURL.XSD_STRING],()=>(arg1,arg2)=>(0,Helpers_1$6.bool)(arg1.startsWith(arg2))).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.RDF_LANG_STRING],()=>(arg1,arg2)=>{if(arg1.language!==arg2.language)throw new Err$5.IncompatibleLanguageOperation(arg1,arg2);return(0,Helpers_1$6.bool)(arg1.typedValue.startsWith(arg2.typedValue))}).collect()},STRENDS={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRENDS).onBinaryTyped([Consts_1$1.TypeAlias.SPARQL_STRINGLY,Consts_1$1.TypeURL.XSD_STRING],()=>(arg1,arg2)=>(0,Helpers_1$6.bool)(arg1.endsWith(arg2))).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.RDF_LANG_STRING],()=>(arg1,arg2)=>{if(arg1.language!==arg2.language)throw new Err$5.IncompatibleLanguageOperation(arg1,arg2);return(0,Helpers_1$6.bool)(arg1.typedValue.endsWith(arg2.typedValue))}).collect()},CONTAINS={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.CONTAINS).onBinaryTyped([Consts_1$1.TypeAlias.SPARQL_STRINGLY,Consts_1$1.TypeURL.XSD_STRING],()=>(arg1,arg2)=>(0,Helpers_1$6.bool)(arg1.includes(arg2))).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.RDF_LANG_STRING],()=>(arg1,arg2)=>{if(arg1.language!==arg2.language)throw new Err$5.IncompatibleLanguageOperation(arg1,arg2);return(0,Helpers_1$6.bool)(arg1.typedValue.includes(arg2.typedValue))}).collect()},STRBEFORE={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRBEFORE).onBinaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(arg1,arg2)=>(0,Helpers_1$6.string)(arg1.slice(0,Math.max(0,arg1.indexOf(arg2))))).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(arg1,arg2)=>{const[a1,a2]=[arg1.typedValue,arg2.typedValue],sub=arg1.typedValue.slice(0,Math.max(0,a1.indexOf(a2)));return sub||!a2?(0,Helpers_1$6.langString)(sub,arg1.language):(0,Helpers_1$6.string)(sub)}).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.RDF_LANG_STRING],()=>(arg1,arg2)=>{if(arg1.language!==arg2.language)throw new Err$5.IncompatibleLanguageOperation(arg1,arg2);const[a1,a2]=[arg1.typedValue,arg2.typedValue],sub=arg1.typedValue.slice(0,Math.max(0,a1.indexOf(a2)));return sub||!a2?(0,Helpers_1$6.langString)(sub,arg1.language):(0,Helpers_1$6.string)(sub)}).collect()},STRAFTER={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.STRAFTER).onBinaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(arg1,arg2)=>(0,Helpers_1$6.string)(arg1.slice(arg1.indexOf(arg2)).slice(arg2.length))).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(arg1,arg2)=>{const[a1,a2]=[arg1.typedValue,arg2.typedValue],sub=a1.slice(a1.indexOf(a2)).slice(a2.length);return sub||!a2?(0,Helpers_1$6.langString)(sub,arg1.language):(0,Helpers_1$6.string)(sub)}).onBinary([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.RDF_LANG_STRING],()=>(arg1,arg2)=>{if(arg1.language!==arg2.language)throw new Err$5.IncompatibleLanguageOperation(arg1,arg2);const[a1,a2]=[arg1.typedValue,arg2.typedValue],sub=a1.slice(a1.indexOf(a2)).slice(a2.length);return sub||!a2?(0,Helpers_1$6.langString)(sub,arg1.language):(0,Helpers_1$6.string)(sub)}).collect()},ENCODE_FOR_URI={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.ENCODE_FOR_URI).onStringly1Typed(()=>val=>(0,Helpers_1$6.string)(encodeURI(val))).collect()},langmatches={arity:2,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.LANG_MATCHES).onBinaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(tag,range)=>(0,Helpers_1$6.bool)(X.langMatches(tag,range))).collect()},regex2=__name(()=>(text,pattern)=>(0,Helpers_1$6.bool)(X.matches(text,pattern)),"regex2"),regex3=__name(()=>(text,pattern,flags)=>(0,Helpers_1$6.bool)(X.matches(text,pattern,flags)),"regex3"),REGEX={arity:[2,3],overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.REGEX).onBinaryTyped([Consts_1$1.TypeAlias.SPARQL_STRINGLY,Consts_1$1.TypeURL.XSD_STRING],regex2).onTernaryTyped([Consts_1$1.TypeAlias.SPARQL_STRINGLY,Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],regex3).collect()},REPLACE={arity:[3,4],overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.REPLACE).onTernaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(arg,pattern,replacement)=>(0,Helpers_1$6.string)(X.replace(arg,pattern,replacement))).set([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>([arg,pattern,replacement])=>{const result=X.replace(arg.typedValue,pattern.typedValue,replacement.typedValue);return(0,Helpers_1$6.langString)(result,arg.language)}).onQuaternaryTyped([Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>(arg,pattern,replacement,flags)=>(0,Helpers_1$6.string)(X.replace(arg,pattern,replacement,flags))).set([Consts_1$1.TypeURL.RDF_LANG_STRING,Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING,Consts_1$1.TypeURL.XSD_STRING],()=>([arg,pattern,replacement,flags])=>{const result=X.replace(arg.typedValue,pattern.typedValue,replacement.typedValue,flags.typedValue);return(0,Helpers_1$6.langString)(result,arg.language)}).collect()},abs={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.ABS).numericConverter(()=>num=>Math.abs(num)).collect()},round={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.ROUND).numericConverter(()=>num=>Math.round(num)).collect()},ceil={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.CEIL).numericConverter(()=>num=>Math.ceil(num)).collect()},floor={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.FLOOR).numericConverter(()=>num=>Math.floor(num)).collect()},rand={arity:0,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.RAND).set([],()=>()=>(0,Helpers_1$6.double)(Math.random())).collect()},now={arity:0,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.NOW).set([],sharedContext=>()=>new E$4.DateTimeLiteral((0,DateTimeHelpers_1$2.toDateTimeRepresentation)({date:sharedContext.now,timeZone:sharedContext.defaultTimeZone}))).collect()},year={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.YEAR).onDateTime1(()=>date=>(0,Helpers_1$6.integer)(date.typedValue.year)).set([Consts_1$1.TypeURL.XSD_DATE],()=>([date])=>(0,Helpers_1$6.integer)(date.typedValue.year)).collect()},month={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.MONTH).onDateTime1(()=>date=>(0,Helpers_1$6.integer)(date.typedValue.month)).set([Consts_1$1.TypeURL.XSD_DATE],()=>([date])=>(0,Helpers_1$6.integer)(date.typedValue.month)).collect()},day={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.DAY).onDateTime1(()=>date=>(0,Helpers_1$6.integer)(date.typedValue.day)).set([Consts_1$1.TypeURL.XSD_DATE],()=>([date])=>(0,Helpers_1$6.integer)(date.typedValue.day)).collect()},hours={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.HOURS).onDateTime1(()=>date=>(0,Helpers_1$6.integer)(date.typedValue.hours)).set([Consts_1$1.TypeURL.XSD_TIME],()=>([time])=>(0,Helpers_1$6.integer)(time.typedValue.hours)).collect()},minutes={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.MINUTES).onDateTime1(()=>date=>(0,Helpers_1$6.integer)(date.typedValue.minutes)).set([Consts_1$1.TypeURL.XSD_TIME],()=>([time])=>(0,Helpers_1$6.integer)(time.typedValue.minutes)).collect()},seconds={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SECONDS).onDateTime1(()=>date=>(0,Helpers_1$6.decimal)(date.typedValue.seconds)).set([Consts_1$1.TypeURL.XSD_TIME],()=>([time])=>(0,Helpers_1$6.integer)(time.typedValue.seconds)).collect()},timezone={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.TIMEZONE).onDateTime1(()=>date=>{const duration={hours:date.typedValue.zoneHours,minutes:date.typedValue.zoneMinutes};if(duration.hours===void 0&&duration.minutes===void 0)throw new Err$5.InvalidTimezoneCall(date.str());return new E$4.DayTimeDurationLiteral(duration)}).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE]}).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_TIME]}).collect()},tz={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.TZ).onDateTime1(()=>date=>(0,Helpers_1$6.string)((0,DateTimeHelpers_1$2.extractRawTimeZone)(date.str()))).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_DATE]}).copy({from:[Consts_1$1.TypeURL.XSD_DATE_TIME],to:[Consts_1$1.TypeURL.XSD_TIME]}).collect()},MD5={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.MD5).onString1Typed(()=>str=>(0,Helpers_1$6.string)((0,spark_md5_1.hash)(str))).collect()},SHA1={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SHA1).onString1Typed(()=>str=>(0,Helpers_1$6.string)((0,hash_js_1.sha1)().update(str).digest("hex"))).collect()},SHA256={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SHA256).onString1Typed(()=>str=>(0,Helpers_1$6.string)((0,hash_js_1.sha256)().update(str).digest("hex"))).collect()},SHA384={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SHA384).onString1Typed(()=>str=>(0,Helpers_1$6.string)((0,hash_js_1.sha384)().update(str).digest("hex"))).collect()},SHA512={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SHA512).onString1Typed(()=>str=>(0,Helpers_1$6.string)((0,hash_js_1.sha512)().update(str).digest("hex"))).collect()},triple={arity:3,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.TRIPLE).onTerm3(context2=>(...args)=>new E$4.Quad(DF$e.quad(args[0].toRDF(),args[1].toRDF(),args[2].toRDF()),context2.superTypeProvider)).collect()},subject={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.SUBJECT).onQuad1(()=>quad=>quad.subject).collect()},predicate={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.PREDICATE).onQuad1(()=>quad=>quad.predicate).collect()},object={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.OBJECT).onQuad1(()=>quad=>quad.object).collect()},istriple={arity:1,overloads:(0,Helpers_1$6.declare)(C$3.RegularOperator.IS_TRIPLE).onTerm1(()=>term=>(0,Helpers_1$6.bool)(term.termType==="quad")).collect()};RegularFunctions.definitions={"!":not,uplus:unaryPlus,uminus:unaryMinus,"*":multiplication,"/":division,"+":addition,"-":subtraction,"=":equality,"!=":inequality,"<":lesserThan,">":greaterThan,"<=":lesserThanEqual,">=":greaterThanEqual,isiri:isIRI,isuri:isIRI,isblank:isBlank,isliteral:isLiteral,isnumeric:isNumeric,str:STR,lang,datatype,iri:IRI,uri:IRI,strdt:STRDT,strlang:STRLANG,uuid:UUID,struuid:STRUUID,strlen:STRLEN,substr:SUBSTR,ucase:UCASE,lcase:LCASE,strstarts:STRSTARTS,strends:STRENDS,contains:CONTAINS,strbefore:STRBEFORE,strafter:STRAFTER,encode_for_uri:ENCODE_FOR_URI,langmatches,regex:REGEX,replace:REPLACE,abs,round,ceil,floor,rand,now,year,month,day,hours,minutes,seconds,timezone,tz,md5:MD5,sha1:SHA1,sha256:SHA256,sha384:SHA384,sha512:SHA512,triple,subject,predicate,object,istriple};var SpecialFunctions={},hasRequiredSpecialFunctions;function requireSpecialFunctions(){if(hasRequiredSpecialFunctions)return SpecialFunctions;hasRequiredSpecialFunctions=1,Object.defineProperty(SpecialFunctions,"__esModule",{value:!0}),SpecialFunctions.specialDefinitions=void 0;const uuid2=require$$0,E2=requireExpressions(),C2=Consts,Err2=Errors,Helpers_12=requireHelpers(),_12=requireFunctions(),bound={arity:1,async applyAsync({args,mapping}){return bound_({args,mapping})},applySync({args,mapping}){return bound_({args,mapping})}};function bound_({args,mapping}){const variable=args[0];if(variable.expressionType!==E2.ExpressionType.Variable)throw new Err2.InvalidArgumentTypes(args,C2.SpecialOperator.BOUND);const val=mapping.has((0,Helpers_12.expressionToVar)(variable));return(0,Helpers_12.bool)(val)}__name(bound_,"bound_");const ifSPARQL={arity:3,async applyAsync({args,mapping,evaluate}){const ebv=(await evaluate(args[0],mapping)).coerceEBV();return evaluate(ebv?args[1]:args[2],mapping)},applySync({args,mapping,evaluate}){const ebv=evaluate(args[0],mapping).coerceEBV();return evaluate(ebv?args[1]:args[2],mapping)}},coalesce={arity:Number.POSITIVE_INFINITY,async applyAsync({args,mapping,evaluate}){const errors=[];for(const expr of args)try{return await evaluate(expr,mapping)}catch(error){errors.push(error)}throw new Err2.CoalesceError(errors)},applySync({args,mapping,evaluate}){const errors=[];for(const expr of args)try{return evaluate(expr,mapping)}catch(error){errors.push(error)}throw new Err2.CoalesceError(errors)}},logicalOr={arity:2,async applyAsync({args,mapping,evaluate}){const[leftExpr,rightExpr]=args;try{if((await evaluate(leftExpr,mapping)).coerceEBV())return(0,Helpers_12.bool)(!0);const right=(await evaluate(rightExpr,mapping)).coerceEBV();return(0,Helpers_12.bool)(right)}catch(error){if(!(await evaluate(rightExpr,mapping)).coerceEBV())throw error;return(0,Helpers_12.bool)(!0)}},applySync({args,mapping,evaluate}){const[leftExpr,rightExpr]=args;try{if(evaluate(leftExpr,mapping).coerceEBV())return(0,Helpers_12.bool)(!0);const right=evaluate(rightExpr,mapping).coerceEBV();return(0,Helpers_12.bool)(right)}catch(error){if(!evaluate(rightExpr,mapping).coerceEBV())throw error;return(0,Helpers_12.bool)(!0)}}},logicalAnd={arity:2,async applyAsync({args,mapping,evaluate}){const[leftExpr,rightExpr]=args;try{if(!(await evaluate(leftExpr,mapping)).coerceEBV())return(0,Helpers_12.bool)(!1);const right=(await evaluate(rightExpr,mapping)).coerceEBV();return(0,Helpers_12.bool)(right)}catch(error){if((await evaluate(rightExpr,mapping)).coerceEBV())throw error;return(0,Helpers_12.bool)(!1)}},applySync({args,mapping,evaluate}){const[leftExpr,rightExpr]=args;try{if(!evaluate(leftExpr,mapping).coerceEBV())return(0,Helpers_12.bool)(!1);const right=evaluate(rightExpr,mapping).coerceEBV();return(0,Helpers_12.bool)(right)}catch(error){if(evaluate(rightExpr,mapping).coerceEBV())throw error;return(0,Helpers_12.bool)(!1)}}},sameTerm={arity:2,async applyAsync({args,mapping,evaluate}){const[leftExpr,rightExpr]=args.map(arg=>evaluate(arg,mapping)),[left,right]=await Promise.all([leftExpr,rightExpr]);return(0,Helpers_12.bool)(left.toRDF().equals(right.toRDF()))},applySync({args,mapping,evaluate}){const[left,right]=args.map(arg=>evaluate(arg,mapping));return(0,Helpers_12.bool)(left.toRDF().equals(right.toRDF()))}},inSPARQL={arity:Number.POSITIVE_INFINITY,checkArity(args){return args.length>0},async applyAsync(context2){const{args,mapping,evaluate}=context2,[leftExpr,...remaining]=args,left=await evaluate(leftExpr,mapping);return inRecursiveAsync(left,Object.assign(Object.assign({},context2),{args:remaining}),[])},applySync(context2){const{args,mapping,evaluate}=context2,[leftExpr,...remaining]=args,left=evaluate(leftExpr,mapping);return inRecursiveSync(left,Object.assign(Object.assign({},context2),{args:remaining}),[])}};async function inRecursiveAsync(needle,context2,results){const{args,mapping,evaluate}=context2;if(args.length===0)return results.every(val=>!val)?(0,Helpers_12.bool)(!1):Promise.reject(new Err2.InError(results));try{const nextExpression=args.shift(),next=await evaluate(nextExpression,mapping);return _12.regularFunctions[C2.RegularOperator.EQUAL].apply([needle,next],context2).typedValue?(0,Helpers_12.bool)(!0):inRecursiveAsync(needle,context2,[...results,!1])}catch(error){return inRecursiveAsync(needle,context2,[...results,error])}}__name(inRecursiveAsync,"inRecursiveAsync");function inRecursiveSync(needle,context2,results){const{args,mapping,evaluate}=context2;if(args.length===0){if(results.every(val=>!val))return(0,Helpers_12.bool)(!1);throw new Err2.InError(results)}try{const nextExpression=args.shift(),next=evaluate(nextExpression,mapping);return _12.regularFunctions[C2.RegularOperator.EQUAL].apply([needle,next],context2).typedValue?(0,Helpers_12.bool)(!0):inRecursiveSync(needle,context2,[...results,!1])}catch(error){return inRecursiveSync(needle,context2,[...results,error])}}__name(inRecursiveSync,"inRecursiveSync");const notInSPARQL={arity:Number.POSITIVE_INFINITY,checkArity(args){return args.length>0},async applyAsync(context2){const isIn=await _12.specialFunctions[C2.SpecialOperator.IN].applyAsync(context2);return(0,Helpers_12.bool)(!isIn.typedValue)},applySync(context2){const isIn=_12.specialFunctions[C2.SpecialOperator.IN].applySync(context2);return(0,Helpers_12.bool)(!isIn.typedValue)}},concatTree=(0,Helpers_12.declare)(C2.SpecialOperator.CONCAT).onStringly1(()=>expr=>expr).collect(),concat2={arity:Number.POSITIVE_INFINITY,async applyAsync(context2){const{args,mapping,evaluate,functionArgumentsCache,superTypeProvider}=context2,pLits=args.map(async expr=>evaluate(expr,mapping)).map(async pTerm=>{const operation=concatTree.search([await pTerm],superTypeProvider,functionArgumentsCache);if(!operation)throw new Err2.InvalidArgumentTypes(args,C2.SpecialOperator.CONCAT);return operation(context2)([await pTerm])}),lits=await Promise.all(pLits),joined=lits.map(lit=>lit.typedValue).join(""),lang2=langAllEqual(lits)?lits[0].language:void 0;return lang2?(0,Helpers_12.langString)(joined,lang2):(0,Helpers_12.string)(joined)},applySync(context2){const{args,mapping,evaluate,superTypeProvider,functionArgumentsCache}=context2,lits=args.map(expr=>evaluate(expr,mapping)).map(pTerm=>{const operation=concatTree.search([pTerm],superTypeProvider,functionArgumentsCache);if(!operation)throw new Err2.InvalidArgumentTypes(args,C2.SpecialOperator.CONCAT);return operation(context2)([pTerm])}),joined=lits.map(lit=>lit.typedValue).join(""),lang2=langAllEqual(lits)?lits[0].language:void 0;return lang2?(0,Helpers_12.langString)(joined,lang2):(0,Helpers_12.string)(joined)}};function langAllEqual(lits){return lits.length>0&&lits.every(lit=>lit.language===lits[0].language)}__name(langAllEqual,"langAllEqual");const bnodeTree=(0,Helpers_12.declare)(C2.SpecialOperator.BNODE).onString1(()=>arg=>arg).collect(),BNODE={arity:Number.POSITIVE_INFINITY,checkArity(args){return args.length===0||args.length===1},async applyAsync(context2){const{args,mapping,evaluate,superTypeProvider,functionArgumentsCache}=context2,input=args.length===1?await evaluate(args[0],mapping):void 0;let strInput;if(input){const operation=bnodeTree.search([input],superTypeProvider,functionArgumentsCache);if(!operation)throw new Err2.InvalidArgumentTypes(args,C2.SpecialOperator.BNODE);strInput=operation(context2)([input]).str()}if(context2.bnode){const bnode=await context2.bnode(strInput);return new E2.BlankNode(bnode)}return BNODE_(strInput)},applySync(context2){const{args,mapping,evaluate,superTypeProvider,functionArgumentsCache}=context2,input=args.length===1?evaluate(args[0],mapping):void 0;let strInput;if(input){const operation=bnodeTree.search([input],superTypeProvider,functionArgumentsCache);if(!operation)throw new Err2.InvalidArgumentTypes(args,C2.SpecialOperator.BNODE);strInput=operation(context2)([input]).str()}if(context2.bnode){const bnode=context2.bnode(strInput);return new E2.BlankNode(bnode)}return BNODE_(strInput)}};function BNODE_(input){return new E2.BlankNode(input||uuid2.v4())}return __name(BNODE_,"BNODE_"),SpecialFunctions.specialDefinitions={bound,if:ifSPARQL,coalesce,"&&":logicalAnd,"||":logicalOr,sameterm:sameTerm,in:inSPARQL,notin:notInSPARQL,concat:concat2,bnode:BNODE},SpecialFunctions}__name(requireSpecialFunctions,"requireSpecialFunctions");var hasRequiredFunctions;function requireFunctions(){return hasRequiredFunctions||(hasRequiredFunctions=1,function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OverloadTree=exports.namedFunctions=exports.specialFunctions=exports.regularFunctions=void 0;const Core_12=Core,NamedFunctions_1=NamedFunctions,RegularFunctions_1=RegularFunctions,SpecialFunctions_1=requireSpecialFunctions();__exportStar(Core,exports),exports.regularFunctions=Object.fromEntries(Object.entries(RegularFunctions_1.definitions).map(([key,val])=>[key,new Core_12.RegularFunction(key,val)])),exports.specialFunctions=Object.fromEntries(Object.entries(SpecialFunctions_1.specialDefinitions).map(([key,val])=>[key,new Core_12.SpecialFunction(key,val)])),exports.namedFunctions=Object.fromEntries(Object.entries(NamedFunctions_1.namedDefinitions).map(([key,val])=>[key,new Core_12.NamedFunction(key,val)]));var OverloadTree_1=requireOverloadTree();Object.defineProperty(exports,"OverloadTree",{enumerable:!0,get:function(){return OverloadTree_1.OverloadTree}})}(functions)),functions}__name(requireFunctions,"requireFunctions");Object.defineProperty(AlgebraTransformer$1,"__esModule",{value:!0});AlgebraTransformer$1.AlgebraTransformer=void 0;const sparqlalgebrajs_1$o=sparqlalgebrajs,E$3=requireExpressions(),functions_1$2=requireFunctions(),C$2=Consts,Err$4=Errors,Errors_1=Errors,TermTransformer_1$3=requireTermTransformer();class AlgebraTransformer extends TermTransformer_1$3.TermTransformer{constructor(algebraConfig){super(algebraConfig.superTypeProvider),this.algebraConfig=algebraConfig,this.creatorConfig={type:algebraConfig.type,creator:algebraConfig.creator}}transformAlgebra(expr){const types2=sparqlalgebrajs_1$o.Algebra.expressionTypes;switch(expr.expressionType){case types2.TERM:return this.transformTerm(expr);case types2.OPERATOR:return this.transformOperator(expr);case types2.NAMED:return this.transformNamed(expr);case types2.EXISTENCE:return AlgebraTransformer.transformExistence(expr);case types2.AGGREGATE:return AlgebraTransformer.transformAggregate(expr);case types2.WILDCARD:return AlgebraTransformer.transformWildcard(expr)}}static transformWildcard(term){return new E$3.NamedNode(term.wildcard.value)}transformOperator(expr){const operator=expr.operator.toLowerCase();if(C$2.SpecialOperators.has(operator)){const specialOp=operator,specialArgs=expr.args.map(arg=>this.transformAlgebra(arg)),specialFunc=functions_1$2.specialFunctions[specialOp];if(!specialFunc.checkArity(specialArgs))throw new Err$4.InvalidArity(specialArgs,specialOp);return new E$3.SpecialOperator(specialArgs,specialFunc.applyAsync,specialFunc.applySync)}if(!C$2.Operators.has(operator))throw new Err$4.UnknownOperator(expr.operator);const regularOp=operator,regularArgs=expr.args.map(arg=>this.transformAlgebra(arg)),regularFunc=functions_1$2.regularFunctions[regularOp];if(!AlgebraTransformer.hasCorrectArity(regularArgs,regularFunc.arity))throw new Err$4.InvalidArity(regularArgs,regularOp);return new E$3.Operator(regularArgs,args=>regularFunc.apply(args,this.algebraConfig))}wrapSyncFunction(func,name){return args=>{try{const res=func(args.map(arg=>arg.toRDF()));return this.transformRDFTermUnsafe(res)}catch(error){throw new Errors_1.ExtensionFunctionError(name,error)}}}wrapAsyncFunction(func,name){return async args=>{try{const res=await func(args.map(arg=>arg.toRDF()));return this.transformRDFTermUnsafe(res)}catch(error){throw new Errors_1.ExtensionFunctionError(name,error)}}}transformNamed(expr){const funcName=expr.name.value,namedArgs=expr.args.map(arg=>this.transformAlgebra(arg));if(C$2.NamedOperators.has(funcName)){const op=expr.name.value,namedFunc=functions_1$2.namedFunctions[op];return new E$3.Named(expr.name,namedArgs,args=>namedFunc.apply(args,this.algebraConfig))}if(this.creatorConfig.type==="sync"){const syncExtensionFunc=this.creatorConfig.creator(expr.name);if(syncExtensionFunc){const simpleAppl=this.wrapSyncFunction(syncExtensionFunc,expr.name.value);return new E$3.SyncExtension(expr.name,namedArgs,simpleAppl)}}else{const asyncExtensionFunc=this.creatorConfig.creator(expr.name);if(asyncExtensionFunc){const asyncAppl=this.wrapAsyncFunction(asyncExtensionFunc,expr.name.value);return new E$3.AsyncExtension(expr.name,namedArgs,asyncAppl)}}throw new Err$4.UnknownNamedOperator(expr.name.value)}static hasCorrectArity(args,arity){return Array.isArray(arity)?arity.includes(args.length):args.length===arity}static transformAggregate(expr){const name=expr.aggregator;return new E$3.Aggregate(name,expr)}static transformExistence(expr){return new E$3.Existence(expr)}}__name(AlgebraTransformer,"AlgebraTransformer");AlgebraTransformer$1.AlgebraTransformer=AlgebraTransformer;var AsyncRecursiveEvaluator$1={},BaseExpressionEvaluator$1={};Object.defineProperty(BaseExpressionEvaluator$1,"__esModule",{value:!0});BaseExpressionEvaluator$1.BaseExpressionEvaluator=void 0;const Helpers_1$5=requireHelpers(),Err$3=Errors;class BaseExpressionEvaluator{constructor(termTransformer){this.termTransformer=termTransformer}term(expr,mapping){return expr}variable(expr,mapping){const term=mapping.get((0,Helpers_1$5.expressionToVar)(expr));if(!term)throw new Err$3.UnboundVariableError(expr.name,mapping);return this.termTransformer.transformRDFTermUnsafe(term)}}__name(BaseExpressionEvaluator,"BaseExpressionEvaluator");BaseExpressionEvaluator$1.BaseExpressionEvaluator=BaseExpressionEvaluator;Object.defineProperty(AsyncRecursiveEvaluator$1,"__esModule",{value:!0});AsyncRecursiveEvaluator$1.AsyncRecursiveEvaluator=void 0;const E$2=requireExpressions(),TermTransformer_1$2=requireTermTransformer(),Err$2=Errors,BaseExpressionEvaluator_1$1=BaseExpressionEvaluator$1;class AsyncRecursiveEvaluator extends BaseExpressionEvaluator_1$1.BaseExpressionEvaluator{constructor(context2,termTransformer){super(termTransformer||new TermTransformer_1$2.TermTransformer(context2.superTypeProvider)),this.context=context2,this.subEvaluators={[E$2.ExpressionType.Term]:this.term.bind(this),[E$2.ExpressionType.Variable]:this.variable.bind(this),[E$2.ExpressionType.Operator]:this.evalOperator.bind(this),[E$2.ExpressionType.SpecialOperator]:this.evalSpecialOperator.bind(this),[E$2.ExpressionType.Named]:this.evalNamed.bind(this),[E$2.ExpressionType.Existence]:this.evalExistence.bind(this),[E$2.ExpressionType.Aggregate]:this.evalAggregate.bind(this),[E$2.ExpressionType.AsyncExtension]:this.evalAsyncExtension.bind(this)}}async evaluate(expr,mapping){const evaluator=this.subEvaluators[expr.expressionType];if(!evaluator)throw new Err$2.InvalidExpressionType(expr);return evaluator.bind(this)(expr,mapping)}async evalOperator(expr,mapping){const argPromises=expr.args.map(arg=>this.evaluate(arg,mapping)),argResults=await Promise.all(argPromises);return expr.apply(argResults)}async evalSpecialOperator(expr,mapping){const evaluate=this.evaluate.bind(this),context2={args:expr.args,mapping,superTypeProvider:this.context.superTypeProvider,now:this.context.now,baseIRI:this.context.baseIRI,functionArgumentsCache:this.context.functionArgumentsCache,evaluate,bnode:this.context.bnode,defaultTimeZone:this.context.defaultTimeZone};return expr.applyAsync(context2)}async _evalAsyncArgs(args,mapping){const argPromises=args.map(arg=>this.evaluate(arg,mapping));return await Promise.all(argPromises)}async evalNamed(expr,mapping){return expr.apply(await this._evalAsyncArgs(expr.args,mapping))}async evalAsyncExtension(expr,mapping){return await expr.apply(await this._evalAsyncArgs(expr.args,mapping))}async evalExistence(expr,mapping){if(!this.context.exists)throw new Err$2.NoExistenceHook;return new E$2.BooleanLiteral(await this.context.exists(expr.expression,mapping))}async evalAggregate(expr,_mapping){if(!this.context.aggregate)throw new Err$2.NoAggregator;return this.termTransformer.transformRDFTermUnsafe(await this.context.aggregate(expr.expression))}}__name(AsyncRecursiveEvaluator,"AsyncRecursiveEvaluator");AsyncRecursiveEvaluator$1.AsyncRecursiveEvaluator=AsyncRecursiveEvaluator;Object.defineProperty(AsyncEvaluator$1,"__esModule",{value:!0});AsyncEvaluator$1.AsyncEvaluator=void 0;const LRUCache$2=lruCache,AlgebraTransformer_1$1=AlgebraTransformer$1,DateTimeHelpers_1$1=DateTimeHelpers,AsyncRecursiveEvaluator_1=AsyncRecursiveEvaluator$1;class AsyncEvaluator{constructor(algExpr,context2={}){this.algExpr=algExpr;const creator=context2.extensionFunctionCreator||(()=>{}),baseContext=AsyncEvaluator.completeContext(context2),transformer=new AlgebraTransformer_1$1.AlgebraTransformer(Object.assign({type:"async",creator},baseContext));this.expr=transformer.transformAlgebra(algExpr),this.evaluator=new AsyncRecursiveEvaluator_1.AsyncRecursiveEvaluator(baseContext,transformer)}static completeContext(context2){const now2=context2.now||new Date(Date.now());return{now:now2,baseIRI:context2.baseIRI||void 0,functionArgumentsCache:context2.functionArgumentsCache||{},superTypeProvider:{cache:context2.typeCache||new LRUCache$2,discoverer:context2.getSuperType||(()=>"term")},extensionFunctionCreator:context2.extensionFunctionCreator,exists:context2.exists,aggregate:context2.aggregate,bnode:context2.bnode,defaultTimeZone:context2.defaultTimeZone||(0,DateTimeHelpers_1$1.extractTimeZone)(now2)}}async evaluate(mapping){return(await this.evaluator.evaluate(this.expr,mapping)).toRDF()}async evaluateAsEBV(mapping){return(await this.evaluator.evaluate(this.expr,mapping)).coerceEBV()}async evaluateAsInternal(mapping){return await this.evaluator.evaluate(this.expr,mapping)}}__name(AsyncEvaluator,"AsyncEvaluator");AsyncEvaluator$1.AsyncEvaluator=AsyncEvaluator;var SyncEvaluator$1={},SyncRecursiveEvaluator$1={};Object.defineProperty(SyncRecursiveEvaluator$1,"__esModule",{value:!0});SyncRecursiveEvaluator$1.SyncRecursiveEvaluator=void 0;const E$1=requireExpressions(),TermTransformer_1$1=requireTermTransformer(),Err$1=Errors,BaseExpressionEvaluator_1=BaseExpressionEvaluator$1;class SyncRecursiveEvaluator extends BaseExpressionEvaluator_1.BaseExpressionEvaluator{constructor(context2,termTransformer){super(termTransformer||new TermTransformer_1$1.TermTransformer(context2.superTypeProvider)),this.context=context2,this.subEvaluators={[E$1.ExpressionType.Term]:this.term.bind(this),[E$1.ExpressionType.Variable]:this.variable.bind(this),[E$1.ExpressionType.Operator]:this.evalOperator.bind(this),[E$1.ExpressionType.SpecialOperator]:this.evalSpecialOperator.bind(this),[E$1.ExpressionType.Named]:this.evalNamed.bind(this),[E$1.ExpressionType.Existence]:this.evalExistence.bind(this),[E$1.ExpressionType.Aggregate]:this.evalAggregate.bind(this),[E$1.ExpressionType.SyncExtension]:this.evalSyncExtension.bind(this)}}evaluate(expr,mapping){const evaluator=this.subEvaluators[expr.expressionType];if(!evaluator)throw new Err$1.InvalidExpressionType(expr);return evaluator.bind(this)(expr,mapping)}evalOperator(expr,mapping){const args=expr.args.map(arg=>this.evaluate(arg,mapping));return expr.apply(args)}evalSpecialOperator(expr,mapping){const evaluate=this.evaluate.bind(this),context2={args:expr.args,mapping,superTypeProvider:this.context.superTypeProvider,now:this.context.now,baseIRI:this.context.baseIRI,functionArgumentsCache:this.context.functionArgumentsCache,evaluate,bnode:this.context.bnode,defaultTimeZone:this.context.defaultTimeZone};return expr.applySync(context2)}evalNamed(expr,mapping){const args=expr.args.map(arg=>this.evaluate(arg,mapping));return expr.apply(args)}evalSyncExtension(expr,mapping){const args=expr.args.map(arg=>this.evaluate(arg,mapping));return expr.apply(args)}evalExistence(expr,mapping){if(!this.context.exists)throw new Err$1.NoExistenceHook;return new E$1.BooleanLiteral(this.context.exists(expr.expression,mapping))}evalAggregate(expr,mapping){if(!this.context.aggregate)throw new Err$1.NoAggregator;return this.termTransformer.transformRDFTermUnsafe(this.context.aggregate(expr.expression))}}__name(SyncRecursiveEvaluator,"SyncRecursiveEvaluator");SyncRecursiveEvaluator$1.SyncRecursiveEvaluator=SyncRecursiveEvaluator;Object.defineProperty(SyncEvaluator$1,"__esModule",{value:!0});SyncEvaluator$1.SyncEvaluator=void 0;const LRUCache$1=lruCache,AlgebraTransformer_1=AlgebraTransformer$1,DateTimeHelpers_1=DateTimeHelpers,SyncRecursiveEvaluator_1=SyncRecursiveEvaluator$1;class SyncEvaluator{constructor(algExpr,context2={}){this.algExpr=algExpr,this.context=context2;const creator=context2.extensionFunctionCreator||(()=>{}),baseContext=SyncEvaluator.completeContext(context2),transformer=new AlgebraTransformer_1.AlgebraTransformer(Object.assign({type:"sync",creator},baseContext));this.expr=transformer.transformAlgebra(algExpr),this.evaluator=new SyncRecursiveEvaluator_1.SyncRecursiveEvaluator(baseContext,transformer)}static completeContext(context2){const now2=context2.now||new Date(Date.now());return{now:now2,baseIRI:context2.baseIRI||void 0,functionArgumentsCache:context2.functionArgumentsCache||{},superTypeProvider:{cache:context2.typeCache||new LRUCache$1,discoverer:context2.getSuperType||(()=>"term")},extensionFunctionCreator:context2.extensionFunctionCreator,exists:context2.exists,aggregate:context2.aggregate,bnode:context2.bnode,defaultTimeZone:context2.defaultTimeZone||(0,DateTimeHelpers_1.extractTimeZone)(now2)}}evaluate(mapping){return this.evaluator.evaluate(this.expr,mapping).toRDF()}evaluateAsEBV(mapping){return this.evaluator.evaluate(this.expr,mapping).coerceEBV()}evaluateAsInternal(mapping){return this.evaluator.evaluate(this.expr,mapping)}}__name(SyncEvaluator,"SyncEvaluator");SyncEvaluator$1.SyncEvaluator=SyncEvaluator;var AggregateEvaluator$1={},BaseAggregateEvaluator$1={},aggregators={},Average$1={},Aggregator$1={};Object.defineProperty(Aggregator$1,"__esModule",{value:!0});Aggregator$1.Aggregator=Aggregator$1.AggregatorComponent=void 0;const RdfString$1=rdfString,TermTransformer_1=requireTermTransformer(),Consts_1=Consts,TypeHandling_1=requireTypeHandling();class AggregatorComponent{constructor(expr,sharedContext){this.sharedContext=sharedContext,this.separator=expr.separator||" ",this.termTransformer=new TermTransformer_1.TermTransformer(sharedContext.superTypeProvider)}static emptyValue(){}termToNumericOrError(term){if(term.termType!=="Literal")throw new Error(`Term with value ${term.value} has type ${term.termType} and is not a numeric literal`);if(!(0,TypeHandling_1.isSubTypeOf)(term.datatype.value,Consts_1.TypeAlias.SPARQL_NUMERIC,this.sharedContext.superTypeProvider))throw new Error(`Term datatype ${term.datatype.value} with value ${term.value} has type ${term.termType} and is not a numeric literal`);return this.termTransformer.transformLiteral(term)}extractValue(term){if(term.termType!=="Literal")throw new Error(`Term with value ${term.value} has type ${term.termType} and is not a literal`);const transformedLit=this.termTransformer.transformLiteral(term);return{type:transformedLit.dataType,value:transformedLit.typedValue}}}__name(AggregatorComponent,"AggregatorComponent");Aggregator$1.AggregatorComponent=AggregatorComponent;class Aggregator{constructor(expr,aggregatorComponent){this.aggregatorComponent=aggregatorComponent,this.variableValues=new Map,this.distinct=expr.distinct}static emptyValue(component){return component.emptyValue()}result(){return this.aggregatorComponent.result()}put(bindings,variable=""){this.canSkip(bindings,variable)||(this.aggregatorComponent.put(bindings),this.addSeen(bindings,variable))}canSkip(term,variable){const set3=this.variableValues.get(variable);return this.distinct&&!!set3&&set3.has(RdfString$1.termToString(term))}addSeen(term,variable){this.distinct&&(this.variableValues.has(variable)||this.variableValues.set(variable,new Set),this.variableValues.get(variable).add(RdfString$1.termToString(term)))}}__name(Aggregator,"Aggregator");Aggregator$1.Aggregator=Aggregator;Object.defineProperty(Average$1,"__esModule",{value:!0});Average$1.Average=void 0;const E=requireExpressions(),functions_1$1=requireFunctions(),Helpers_1$4=requireHelpers(),C$1=Consts,Aggregator_1$7=Aggregator$1;class Average extends Aggregator_1$7.AggregatorComponent{constructor(){super(...arguments),this.summer=functions_1$1.regularFunctions[C$1.RegularOperator.ADDITION],this.divider=functions_1$1.regularFunctions[C$1.RegularOperator.DIVISION],this.state=void 0}static emptyValue(){return(0,Helpers_1$4.integer)(0).toRDF()}put(term){if(this.state===void 0){const sum=this.termToNumericOrError(term);this.state={sum,count:1}}else{const internalTerm=this.termToNumericOrError(term);this.state.sum=this.summer.apply([this.state.sum,internalTerm],this.sharedContext),this.state.count++}}result(){if(this.state===void 0)return Average.emptyValue();const count2=new E.IntegerLiteral(this.state.count);return this.divider.apply([this.state.sum,count2],this.sharedContext).toRDF()}}__name(Average,"Average");Average$1.Average=Average;var Count$1={};Object.defineProperty(Count$1,"__esModule",{value:!0});Count$1.Count=void 0;const Helpers_1$3=requireHelpers(),Aggregator_1$6=Aggregator$1;class Count extends Aggregator_1$6.AggregatorComponent{constructor(){super(...arguments),this.state=void 0}static emptyValue(){return(0,Helpers_1$3.integer)(0).toRDF()}put(term){this.state===void 0&&(this.state=0),this.state++}result(){return this.state===void 0?Count.emptyValue():(0,Helpers_1$3.integer)(this.state).toRDF()}}__name(Count,"Count");Count$1.Count=Count;var GroupConcat$1={};Object.defineProperty(GroupConcat$1,"__esModule",{value:!0});GroupConcat$1.GroupConcat=void 0;const Helpers_1$2=requireHelpers(),Aggregator_1$5=Aggregator$1;class GroupConcat extends Aggregator_1$5.AggregatorComponent{constructor(){super(...arguments),this.state=void 0}static emptyValue(){return(0,Helpers_1$2.string)("").toRDF()}put(term){this.state===void 0?this.state=term.value:this.state+=this.separator+term.value}result(){return this.state===void 0?GroupConcat.emptyValue():(0,Helpers_1$2.string)(this.state).toRDF()}}__name(GroupConcat,"GroupConcat");GroupConcat$1.GroupConcat=GroupConcat;var Max$1={};Object.defineProperty(Max$1,"__esModule",{value:!0});Max$1.Max=void 0;const Aggregator_1$4=Aggregator$1;class Max extends Aggregator_1$4.AggregatorComponent{constructor(){super(...arguments),this.state=void 0}put(term){if(this.state===void 0){const{value}=this.extractValue(term);this.state={extremeValue:value,term}}else{const extracted=this.extractValue(term);extracted.value>this.state.extremeValue&&(this.state={extremeValue:extracted.value,term})}}result(){return this.state===void 0?Max.emptyValue():this.state.term}}__name(Max,"Max");Max$1.Max=Max;var Min$1={};Object.defineProperty(Min$1,"__esModule",{value:!0});Min$1.Min=void 0;const Aggregator_1$3=Aggregator$1;class Min extends Aggregator_1$3.AggregatorComponent{constructor(){super(...arguments),this.state=void 0}put(term){if(this.state===void 0){const{value}=this.extractValue(term);this.state={extremeValue:value,term}}else{const extracted=this.extractValue(term);extracted.value<this.state.extremeValue&&(this.state={extremeValue:extracted.value,term})}}result(){return this.state===void 0?Min.emptyValue():this.state.term}}__name(Min,"Min");Min$1.Min=Min;var Sample$1={};Object.defineProperty(Sample$1,"__esModule",{value:!0});Sample$1.Sample=void 0;const Aggregator_1$2=Aggregator$1;class Sample extends Aggregator_1$2.AggregatorComponent{constructor(){super(...arguments),this.state=void 0}put(term){this.state===void 0&&(this.state=term)}result(){return this.state===void 0?Sample.emptyValue():this.state}}__name(Sample,"Sample");Sample$1.Sample=Sample;var Sum$1={};Object.defineProperty(Sum$1,"__esModule",{value:!0});Sum$1.Sum=void 0;const functions_1=requireFunctions(),Helpers_1$1=requireHelpers(),C=Consts,Aggregator_1$1=Aggregator$1;class Sum extends Aggregator_1$1.AggregatorComponent{constructor(){super(...arguments),this.state=void 0,this.summer=functions_1.regularFunctions[C.RegularOperator.ADDITION]}static emptyValue(){return(0,Helpers_1$1.integer)(0).toRDF()}put(term){if(this.state===void 0)this.state=this.termToNumericOrError(term);else{const internalTerm=this.termToNumericOrError(term);this.state=this.summer.apply([this.state,internalTerm],this.sharedContext)}}result(){return this.state===void 0?Sum.emptyValue():this.state.toRDF()}}__name(Sum,"Sum");Sum$1.Sum=Sum;Object.defineProperty(aggregators,"__esModule",{value:!0});aggregators.aggregators=void 0;const Average_1=Average$1,Count_1=Count$1,GroupConcat_1=GroupConcat$1,Max_1=Max$1,Min_1=Min$1,Sample_1=Sample$1,Sum_1=Sum$1;aggregators.aggregators={count:Count_1.Count,sum:Sum_1.Sum,min:Min_1.Min,max:Max_1.Max,avg:Average_1.Average,group_concat:GroupConcat_1.GroupConcat,sample:Sample_1.Sample};var WildcardCountAggregator$1={};Object.defineProperty(WildcardCountAggregator$1,"__esModule",{value:!0});WildcardCountAggregator$1.WildcardCountAggregator=void 0;const RdfString=rdfString,Helpers_1=requireHelpers();class WildcardCountAggregator{constructor(expr){this.bindingValues=new Map,this.counter=0,this.distinct=expr.distinct}putBindings(bindings){this.handleDistinct(bindings)||(this.counter+=1)}static emptyValue(){return(0,Helpers_1.integer)(0).toRDF()}result(){return(0,Helpers_1.integer)(this.counter).toRDF()}handleDistinct(bindings){if(this.distinct){const bindingList=[...bindings];bindingList.sort((first3,snd)=>first3[0].value.localeCompare(snd[0].value));const variables2=bindingList.map(([variable])=>variable.value).join(","),terms=bindingList.map(([,term])=>RdfString.termToString(term)).join(","),set3=this.bindingValues.get(variables2),result=!!set3&&set3.has(terms);return set3||this.bindingValues.set(variables2,new Set),this.bindingValues.get(variables2).add(terms),result}return!1}}__name(WildcardCountAggregator,"WildcardCountAggregator");WildcardCountAggregator$1.WildcardCountAggregator=WildcardCountAggregator;Object.defineProperty(BaseAggregateEvaluator$1,"__esModule",{value:!0});BaseAggregateEvaluator$1.BaseAggregateEvaluator=void 0;const sparqlalgebrajs_1$n=sparqlalgebrajs,aggregators_1=aggregators,Aggregator_1=Aggregator$1,WildcardCountAggregator_1=WildcardCountAggregator$1,Err=Errors;class BaseAggregateEvaluator{constructor(expr,sharedContext,throwError){this.throwError=!1,this.isWildcard=!1,this.errorOccurred=!1,this.expression=expr,this.aggregator=new Aggregator_1.Aggregator(expr,new aggregators_1.aggregators[expr.aggregator](expr,sharedContext)),this.throwError=throwError||!1,this.isWildcard=expr.expression.expressionType===sparqlalgebrajs_1$n.Algebra.expressionTypes.WILDCARD,this.isWildcard&&(this.wildcardAggregator=new WildcardCountAggregator_1.WildcardCountAggregator(expr))}static emptyValue(expr,throwError=!1){let val;if(expr.expression.expressionType===sparqlalgebrajs_1$n.Algebra.expressionTypes.WILDCARD?val=WildcardCountAggregator_1.WildcardCountAggregator.emptyValue():val=Aggregator_1.Aggregator.emptyValue(aggregators_1.aggregators[expr.aggregator]),val===void 0&&throwError)throw new Err.EmptyAggregateError;return val}result(){if(!this.errorOccurred)return this.isWildcard?this.wildcardAggregator.result():this.aggregator.result()}}__name(BaseAggregateEvaluator,"BaseAggregateEvaluator");BaseAggregateEvaluator$1.BaseAggregateEvaluator=BaseAggregateEvaluator;Object.defineProperty(AggregateEvaluator$1,"__esModule",{value:!0});AggregateEvaluator$1.AggregateEvaluator=void 0;const BaseAggregateEvaluator_1$1=BaseAggregateEvaluator$1,SyncEvaluator_1=SyncEvaluator$1;class AggregateEvaluator extends BaseAggregateEvaluator_1$1.BaseAggregateEvaluator{constructor(expr,context2,throwError){super(expr,SyncEvaluator_1.SyncEvaluator.completeContext(context2||{}),throwError),this.evaluator=new SyncEvaluator_1.SyncEvaluator(expr.expression,context2)}put(bindings){if(!this.errorOccurred)if(this.isWildcard)this.wildcardAggregator.putBindings(bindings);else try{const startTerm=this.evaluator.evaluate(bindings);this.aggregator.put(startTerm)}catch(error){this.safeThrow(error)}}safeThrow(err){if(this.throwError)throw err;this.errorOccurred=!0}}__name(AggregateEvaluator,"AggregateEvaluator");AggregateEvaluator$1.AggregateEvaluator=AggregateEvaluator;var AsyncAggregateEvaluator$1={};Object.defineProperty(AsyncAggregateEvaluator$1,"__esModule",{value:!0});AsyncAggregateEvaluator$1.AsyncAggregateEvaluator=void 0;const AsyncEvaluator_1=AsyncEvaluator$1,BaseAggregateEvaluator_1=BaseAggregateEvaluator$1;class AsyncAggregateEvaluator extends BaseAggregateEvaluator_1.BaseAggregateEvaluator{constructor(expr,context2,throwError){super(expr,AsyncEvaluator_1.AsyncEvaluator.completeContext(context2||{}),throwError),this.evaluator=new AsyncEvaluator_1.AsyncEvaluator(expr.expression,context2),this.errorOccurred=!1}async put(bindings){if(!this.errorOccurred)if(this.isWildcard)this.wildcardAggregator.putBindings(bindings);else try{const startTerm=await this.evaluator.evaluate(bindings);if(!startTerm||this.errorOccurred)return;this.aggregator.put(startTerm)}catch(error){this.safeThrow(error)}}safeThrow(err){if(this.throwError)throw err;this.errorOccurred=!0}}__name(AsyncAggregateEvaluator,"AsyncAggregateEvaluator");AsyncAggregateEvaluator$1.AsyncAggregateEvaluator=AsyncAggregateEvaluator;(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsyncAggregateEvaluator=exports.orderTypes=exports.isExpressionError=exports.ExpressionError=exports.AggregateEvaluator=exports.SyncEvaluator=exports.AsyncEvaluator=void 0;var AsyncEvaluator_12=AsyncEvaluator$1;Object.defineProperty(exports,"AsyncEvaluator",{enumerable:!0,get:function(){return AsyncEvaluator_12.AsyncEvaluator}});var SyncEvaluator_12=SyncEvaluator$1;Object.defineProperty(exports,"SyncEvaluator",{enumerable:!0,get:function(){return SyncEvaluator_12.SyncEvaluator}});var AggregateEvaluator_1=AggregateEvaluator$1;Object.defineProperty(exports,"AggregateEvaluator",{enumerable:!0,get:function(){return AggregateEvaluator_1.AggregateEvaluator}});var Errors_12=Errors;Object.defineProperty(exports,"ExpressionError",{enumerable:!0,get:function(){return Errors_12.ExpressionError}}),Object.defineProperty(exports,"isExpressionError",{enumerable:!0,get:function(){return Errors_12.isExpressionError}});var Ordering_12=Ordering;Object.defineProperty(exports,"orderTypes",{enumerable:!0,get:function(){return Ordering_12.orderTypes}});var AsyncAggregateEvaluator_1=AsyncAggregateEvaluator$1;Object.defineProperty(exports,"AsyncAggregateEvaluator",{enumerable:!0,get:function(){return AsyncAggregateEvaluator_1.AsyncAggregateEvaluator}})})(dist);Object.defineProperty(ActorQueryOperationExtend$1,"__esModule",{value:!0});ActorQueryOperationExtend$1.ActorQueryOperationExtend=void 0;const bindings_factory_1$d=lib$2v,bus_query_operation_1$E=lib$2y,sparqlee_1$5=dist;class ActorQueryOperationExtend extends bus_query_operation_1$E.ActorQueryOperationTypedMediated{constructor(args){super(args,"extend")}async testOperation(operation,context2){return new sparqlee_1$5.AsyncEvaluator(operation.expression,bus_query_operation_1$E.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation)),!0}async runOperation(operation,context2){const{expression,input,variable}=operation,output=bus_query_operation_1$E.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:input,context:context2})),config={...bus_query_operation_1$E.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation)},evaluator=new sparqlee_1$5.AsyncEvaluator(expression,config),transform=__name(async(bindings,next,push)=>{try{const result=await evaluator.evaluate(bindings),extended=bindings.set(variable,result);push(extended)}catch(error){(0,sparqlee_1$5.isExpressionError)(error)?(push(bindings),this.logWarn(context2,`Expression error for extend operation with bindings '${(0,bindings_factory_1$d.bindingsToString)(bindings)}'`)):bindingsStream.emit("error",error)}next()},"transform"),bindingsStream=output.bindingsStream.transform({autoStart:!1,transform});return{type:"bindings",bindingsStream,async metadata(){const outputMetadata=await output.metadata();return{...outputMetadata,variables:[...outputMetadata.variables,variable]}}}}}__name(ActorQueryOperationExtend,"ActorQueryOperationExtend");ActorQueryOperationExtend$1.ActorQueryOperationExtend=ActorQueryOperationExtend;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationExtend$1,exports)})(lib$12);var lib$11={},ActorQueryOperationFilterSparqlee$1={};Object.defineProperty(ActorQueryOperationFilterSparqlee$1,"__esModule",{value:!0});ActorQueryOperationFilterSparqlee$1.ActorQueryOperationFilterSparqlee=void 0;const bindings_factory_1$c=lib$2v,bus_query_operation_1$D=lib$2y,sparqlee_1$4=dist;class ActorQueryOperationFilterSparqlee extends bus_query_operation_1$D.ActorQueryOperationTypedMediated{constructor(args){super(args,"filter")}async testOperation(operation,context2){const config={...bus_query_operation_1$D.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation)};return new sparqlee_1$4.AsyncEvaluator(operation.expression,config),!0}async runOperation(operation,context2){const outputRaw=await this.mediatorQueryOperation.mediate({operation:operation.input,context:context2}),output=bus_query_operation_1$D.ActorQueryOperation.getSafeBindings(outputRaw);bus_query_operation_1$D.ActorQueryOperation.validateQueryOutput(output,"bindings");const config={...bus_query_operation_1$D.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation)},evaluator=new sparqlee_1$4.AsyncEvaluator(operation.expression,config),transform=__name(async(item,next,push)=>{try{await evaluator.evaluateAsEBV(item)&&push(item)}catch(error){(0,sparqlee_1$4.isExpressionError)(error)?this.logWarn(context2,"Error occurred while filtering.",()=>({error,bindings:(0,bindings_factory_1$c.bindingsToString)(item)})):bindingsStream.emit("error",error)}next()},"transform"),bindingsStream=output.bindingsStream.transform({transform});return{type:"bindings",bindingsStream,metadata:output.metadata}}}__name(ActorQueryOperationFilterSparqlee,"ActorQueryOperationFilterSparqlee");ActorQueryOperationFilterSparqlee$1.ActorQueryOperationFilterSparqlee=ActorQueryOperationFilterSparqlee;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationFilterSparqlee$1,exports)})(lib$11);var lib$10={},ActorQueryOperationDescribeSubject$1={},lib$$={},ActorQueryOperationUnion$1={};Object.defineProperty(ActorQueryOperationUnion$1,"__esModule",{value:!0});ActorQueryOperationUnion$1.ActorQueryOperationUnion=void 0;const bus_query_operation_1$C=lib$2y,metadata_1$9=lib$2h,asynciterator_1$k=asynciterator,rdf_terms_1$4=rdfTerms;class ActorQueryOperationUnion extends bus_query_operation_1$C.ActorQueryOperationTypedMediated{constructor(args){super(args,"union")}static unionVariables(variables2){return(0,rdf_terms_1$4.uniqTerms)(variables2.flat())}static unionMetadata(metadatas,bindings){const cardinality={type:"exact",value:0};for(const metadata of metadatas)if(metadata.cardinality.value&&Number.isFinite(metadata.cardinality.value)||metadata.cardinality.value===0)metadata.cardinality.type==="estimate"&&(cardinality.type="estimate"),cardinality.value+=metadata.cardinality.value;else{cardinality.type="estimate",cardinality.value=Number.POSITIVE_INFINITY;break}const metadataBase={state:new metadata_1$9.MetadataValidationState,cardinality,canContainUndefs:metadatas.some(metadata=>metadata.canContainUndefs)},invalidateListener=__name(()=>metadataBase.state.invalidate(),"invalidateListener");for(const metadata of metadatas)metadata.state.addInvalidateListener(invalidateListener);return bindings&&(metadataBase.variables=ActorQueryOperationUnion.unionVariables(metadatas.map(metadata=>metadata.variables))),metadataBase}async testOperation(operation,context2){return!0}async runOperation(operation,context2){const outputs=(await Promise.all(operation.input.map(subOperation=>this.mediatorQueryOperation.mediate({operation:subOperation,context:context2})))).map(bus_query_operation_1$C.ActorQueryOperation.getSafeBindings);return{type:"bindings",bindingsStream:new asynciterator_1$k.UnionIterator(outputs.map(output=>output.bindingsStream),{autoStart:!1}),metadata:__name(()=>Promise.all(outputs.map(output=>output.metadata())).then(subMeta=>ActorQueryOperationUnion.unionMetadata(subMeta,!0)),"metadata")}}}__name(ActorQueryOperationUnion,"ActorQueryOperationUnion");ActorQueryOperationUnion$1.ActorQueryOperationUnion=ActorQueryOperationUnion;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationUnion$1,exports)})(lib$$);Object.defineProperty(ActorQueryOperationDescribeSubject$1,"__esModule",{value:!0});ActorQueryOperationDescribeSubject$1.ActorQueryOperationDescribeSubject=void 0;const actor_query_operation_union_1$1=lib$$,bus_query_operation_1$B=lib$2y,asynciterator_1$j=asynciterator,rdf_data_factory_1$d=rdfDataFactory,sparqlalgebrajs_1$m=sparqlalgebrajs,DF$d=new rdf_data_factory_1$d.DataFactory;class ActorQueryOperationDescribeSubject extends bus_query_operation_1$B.ActorQueryOperationTypedMediated{constructor(args){super(args,"describe")}async testOperation(operation,context2){return!0}async runOperation(operationOriginal,context2){const operations=operationOriginal.terms.filter(term=>term.termType!=="Variable").map(term=>{const patterns=[DF$d.quad(term,DF$d.variable("__predicate"),DF$d.variable("__object"))];return patterns.forEach(templatePattern=>templatePattern.type="pattern"),{input:{type:sparqlalgebrajs_1$m.Algebra.types.BGP,patterns},template:patterns,type:"construct"}});if(operations.length!==operationOriginal.terms.length){let variablePatterns=[];operationOriginal.terms.filter(term=>term.termType==="Variable").forEach((term,i)=>{const patterns=[DF$d.quad(term,DF$d.variable(`__predicate${i}`),DF$d.variable(`__object${i}`))];patterns.forEach(templatePattern=>templatePattern.type="pattern"),variablePatterns=[...variablePatterns,...patterns]}),operations.push({input:{type:sparqlalgebrajs_1$m.Algebra.types.JOIN,input:[operationOriginal.input,{type:sparqlalgebrajs_1$m.Algebra.types.BGP,patterns:variablePatterns}]},template:variablePatterns,type:sparqlalgebrajs_1$m.Algebra.types.CONSTRUCT})}const outputs=(await Promise.all(operations.map(operation=>this.mediatorQueryOperation.mediate({operation,context:context2})))).map(bus_query_operation_1$B.ActorQueryOperation.getSafeQuads);return{type:"quads",quadStream:new asynciterator_1$j.UnionIterator(outputs.map(output=>output.quadStream),{autoStart:!1}),metadata:__name(()=>Promise.all(outputs.map(x=>x.metadata())).then(metadatas=>actor_query_operation_union_1$1.ActorQueryOperationUnion.unionMetadata(metadatas,!1)),"metadata")}}}__name(ActorQueryOperationDescribeSubject,"ActorQueryOperationDescribeSubject");ActorQueryOperationDescribeSubject$1.ActorQueryOperationDescribeSubject=ActorQueryOperationDescribeSubject;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationDescribeSubject$1,exports)})(lib$10);var lib$_={},ActorQueryOperationGroup$1={},GroupsState$1={};Object.defineProperty(GroupsState$1,"__esModule",{value:!0});GroupsState$1.GroupsState=void 0;const bindings_factory_1$b=lib$2v,rdf_data_factory_1$c=rdfDataFactory,sparqlee_1$3=dist,DF$c=new rdf_data_factory_1$c.DataFactory,BF$b=new bindings_factory_1$b.BindingsFactory;class GroupsState{constructor(hashFunction,pattern,sparqleeConfig){this.hashFunction=hashFunction,this.pattern=pattern,this.sparqleeConfig=sparqleeConfig,this.groups=new Map,this.groupsInitializer=new Map,this.groupVariables=new Set(this.pattern.variables.map(x=>x.value)),this.distinctHashes=pattern.aggregates.some(({distinct})=>distinct)?new Map:null,this.waitCounter=1,this.resultHasBeenCalled=!1}consumeBindings(bindings){const check=this.resultCheck();if(check)return check;this.waitCounter++;const grouper=bindings.filter((_,variable)=>this.groupVariables.has(variable.value)),groupHash=this.hashBindings(grouper);let groupInitializer=this.groupsInitializer.get(groupHash),res;if(!groupInitializer)groupInitializer=(async()=>{const aggregators2={};if(await Promise.all(this.pattern.aggregates.map(async aggregate=>{const key=aggregate.variable.value;aggregators2[key]=new sparqlee_1$3.AsyncAggregateEvaluator(aggregate,this.sparqleeConfig),await aggregators2[key].put(bindings)})),this.distinctHashes){const bindingsHash=this.hashBindings(bindings);this.distinctHashes.set(groupHash,new Set([bindingsHash]))}const group={aggregators:aggregators2,bindings:grouper};return this.groups.set(groupHash,group),this.subtractWaitCounterAndCollect(),group})(),this.groupsInitializer.set(groupHash,groupInitializer),res=groupInitializer;else{const groupInitializerDefined=groupInitializer;res=(async()=>{const group=await groupInitializerDefined;await Promise.all(this.pattern.aggregates.map(async aggregate=>{if(aggregate.distinct){const hash2=this.hashBindings(bindings);if(this.distinctHashes.get(groupHash).has(hash2))return;this.distinctHashes.get(groupHash).add(hash2)}const variable=aggregate.variable.value;await group.aggregators[variable].put(bindings)}))})().then(()=>{this.subtractWaitCounterAndCollect()})}return res}subtractWaitCounterAndCollect(){--this.waitCounter===0&&this.handleResultCollection()}handleResultCollection(){let rows=[...this.groups].map(([_,group])=>{const{bindings:groupBindings,aggregators:aggregators2}=group;let returnBindings=groupBindings;for(const variable in aggregators2){const value=aggregators2[variable].result();value&&(returnBindings=returnBindings.set(DF$c.variable(variable),value))}return returnBindings});if(rows.length===0&&this.groupVariables.size===0){const single=[];for(const aggregate of this.pattern.aggregates){const key=aggregate.variable,value=sparqlee_1$3.AsyncAggregateEvaluator.emptyValue(aggregate);value!==void 0&&single.push([key,value])}rows=[BF$b.bindings(single)]}this.waitResolver(rows)}resultCheck(){if(this.resultHasBeenCalled)return Promise.reject(new Error("Calling any function after calling collectResult is invalid."))}collectResults(){const check=this.resultCheck();if(check)return check;this.resultHasBeenCalled=!0;const res=new Promise(resolve2=>{this.waitResolver=resolve2});return this.subtractWaitCounterAndCollect(),res}hashBindings(bindings){return this.hashFunction(bindings)}}__name(GroupsState,"GroupsState");GroupsState$1.GroupsState=GroupsState;Object.defineProperty(ActorQueryOperationGroup$1,"__esModule",{value:!0});ActorQueryOperationGroup$1.ActorQueryOperationGroup=void 0;const bus_query_operation_1$A=lib$2y,asynciterator_1$i=asynciterator,sparqlee_1$2=dist,GroupsState_1=GroupsState$1;class ActorQueryOperationGroup extends bus_query_operation_1$A.ActorQueryOperationTypedMediated{constructor(args){super(args,"group")}async testOperation(operation,context2){for(const aggregate of operation.aggregates)new sparqlee_1$2.AsyncEvaluator(aggregate.expression,bus_query_operation_1$A.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation));return!0}async runOperation(operation,context2){const{hashFunction}=await this.mediatorHashBindings.mediate({allowHashCollisions:!0,context:context2}),{input,aggregates}=operation,outputRaw=await this.mediatorQueryOperation.mediate({operation:input,context:context2}),output=bus_query_operation_1$A.ActorQueryOperation.getSafeBindings(outputRaw),variables2=[...operation.variables,...aggregates.map(agg=>agg.variable)],sparqleeConfig=bus_query_operation_1$A.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation);return{type:"bindings",bindingsStream:new asynciterator_1$i.TransformIterator(()=>new Promise((resolve2,reject)=>{const groups=new GroupsState_1.GroupsState(hashFunction,operation,sparqleeConfig);output.bindingsStream.on("end",async()=>{try{const bindingsStreamInner=new asynciterator_1$i.ArrayIterator(await groups.collectResults(),{autoStart:!1});resolve2(bindingsStreamInner)}catch(error){reject(error)}}),output.bindingsStream.on("error",reject),output.bindingsStream.on("data",bindings=>{groups.consumeBindings(bindings).catch(reject)})}),{autoStart:!1}),metadata:async()=>({...await output.metadata(),variables:variables2})}}}__name(ActorQueryOperationGroup,"ActorQueryOperationGroup");ActorQueryOperationGroup$1.ActorQueryOperationGroup=ActorQueryOperationGroup;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationGroup$1,exports)})(lib$_);var lib$Z={},ActorQueryOperationFromQuad$1={};Object.defineProperty(ActorQueryOperationFromQuad$1,"__esModule",{value:!0});ActorQueryOperationFromQuad$1.ActorQueryOperationFromQuad=void 0;const bus_query_operation_1$z=lib$2y,sparqlalgebrajs_1$l=sparqlalgebrajs;class ActorQueryOperationFromQuad extends bus_query_operation_1$z.ActorQueryOperationTypedMediated{constructor(args){super(args,"from")}static copyOperation(operation,recursiveCb){const copiedOperation={};for(const key of Object.keys(operation))Array.isArray(operation[key])&&key!=="template"?key==="variables"?copiedOperation[key]=operation[key]:copiedOperation[key]=operation[key].map(recursiveCb):ActorQueryOperationFromQuad.ALGEBRA_TYPES.includes(operation[key].type)?copiedOperation[key]=recursiveCb(operation[key]):copiedOperation[key]=operation[key];return copiedOperation}static applyOperationDefaultGraph(operation,defaultGraphs){if(operation.type==="bgp"&&operation.patterns.length>0||operation.type==="path"||operation.type==="pattern"){if(operation.type==="bgp")return ActorQueryOperationFromQuad.joinOperations(operation.patterns.map(pattern=>{if(pattern.graph.termType!=="DefaultGraph")return ActorQueryOperationFromQuad.FACTORY.createBgp([pattern]);const bgps=defaultGraphs.map(graph=>ActorQueryOperationFromQuad.FACTORY.createBgp([ActorQueryOperationFromQuad.FACTORY.createPattern(pattern.subject,pattern.predicate,pattern.object,graph)]));return ActorQueryOperationFromQuad.unionOperations(bgps)}));if(operation.graph.termType!=="DefaultGraph")return operation;const paths=defaultGraphs.map(graph=>operation.type==="path"?ActorQueryOperationFromQuad.FACTORY.createPath(operation.subject,operation.predicate,operation.object,graph):ActorQueryOperationFromQuad.FACTORY.createPattern(operation.subject,operation.predicate,operation.object,graph));return ActorQueryOperationFromQuad.unionOperations(paths)}return ActorQueryOperationFromQuad.copyOperation(operation,subOperation=>this.applyOperationDefaultGraph(subOperation,defaultGraphs))}static applyOperationNamedGraph(operation,namedGraphs,defaultGraphs){if(operation.type==="bgp"&&operation.patterns.length>0||operation.type==="path"||operation.type==="pattern"){const patternGraph=operation.type==="bgp"?operation.patterns[0].graph:operation.graph;if(patternGraph.termType==="DefaultGraph")return{type:sparqlalgebrajs_1$l.Algebra.types.BGP,patterns:[]};if(patternGraph.termType==="Variable"){if(namedGraphs.length===1){const graph=namedGraphs[0],bindings={};bindings[`?${patternGraph.value}`]=graph;const values2=ActorQueryOperationFromQuad.FACTORY.createValues([patternGraph],[bindings]);let pattern;return operation.type==="bgp"?pattern=ActorQueryOperationFromQuad.FACTORY.createBgp(operation.patterns.map(pat=>ActorQueryOperationFromQuad.FACTORY.createPattern(pat.subject,pat.predicate,pat.object,graph))):operation.type==="path"?pattern=ActorQueryOperationFromQuad.FACTORY.createPath(operation.subject,operation.predicate,operation.object,graph):pattern=ActorQueryOperationFromQuad.FACTORY.createPattern(operation.subject,operation.predicate,operation.object,graph),ActorQueryOperationFromQuad.FACTORY.createJoin([values2,pattern])}return ActorQueryOperationFromQuad.unionOperations(namedGraphs.map(graph=>ActorQueryOperationFromQuad.applyOperationNamedGraph(operation,[graph],defaultGraphs)))}return[...namedGraphs,...defaultGraphs].some(namedGraph=>namedGraph.equals(patternGraph))?operation:{type:sparqlalgebrajs_1$l.Algebra.types.BGP,patterns:[]}}return ActorQueryOperationFromQuad.copyOperation(operation,subOperation=>this.applyOperationNamedGraph(subOperation,namedGraphs,defaultGraphs))}static joinOperations(operations){if(operations.length===1)return operations[0];if(operations.length>1)return ActorQueryOperationFromQuad.FACTORY.createJoin(operations);throw new Error("A join can only be applied on at least one operation")}static unionOperations(operations){if(operations.length===1)return operations[0];if(operations.length>1)return ActorQueryOperationFromQuad.FACTORY.createUnion(operations);throw new Error("A union can only be applied on at least one operation")}static createOperation(pattern){let operation=pattern.input;return pattern.default.length>0&&(operation=ActorQueryOperationFromQuad.applyOperationDefaultGraph(operation,pattern.default)),(pattern.named.length>0||pattern.default.length>0)&&(operation=ActorQueryOperationFromQuad.applyOperationNamedGraph(operation,pattern.named,pattern.default)),operation}async testOperation(operation,context2){return!0}async runOperation(operationOriginal,context2){const operation=ActorQueryOperationFromQuad.createOperation(operationOriginal);return this.mediatorQueryOperation.mediate({operation,context:context2})}}__name(ActorQueryOperationFromQuad,"ActorQueryOperationFromQuad");ActorQueryOperationFromQuad$1.ActorQueryOperationFromQuad=ActorQueryOperationFromQuad;ActorQueryOperationFromQuad.FACTORY=new sparqlalgebrajs_1$l.Factory;ActorQueryOperationFromQuad.ALGEBRA_TYPES=Object.keys(sparqlalgebrajs_1$l.Algebra.types).map(key=>sparqlalgebrajs_1$l.Algebra.types[key]);(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationFromQuad$1,exports)})(lib$Z);var lib$Y={},ActorQueryOperationOrderBySparqlee$1={},SortIterator$1={};Object.defineProperty(SortIterator$1,"__esModule",{value:!0});SortIterator$1.SortIterator=void 0;const asynciterator_1$h=asynciterator;class SortIterator extends asynciterator_1$h.TransformIterator{constructor(source,sort2,options){super(source,options);const window2=options&&options.window;this.windowLength=Number.isFinite(window2)&&window2>0?window2:Number.POSITIVE_INFINITY,this.sort=sort2,this.sorted=[]}_read(count2,done){let item,{length}=this.sorted;for(;length!==this.windowLength&&(item=this.source.read(),item!==null);){let left=0,right=length-1,mid,order;for(;left<=right;)mid=Math.trunc((left+right)/2),order=this.sort(item,this.sorted[mid]),order<0?left=mid+1:order>0?right=mid-1:(left=mid,right=-1);this.sorted.splice(left,0,item),length++}length===this.windowLength&&this._push(this.sorted.pop()),done()}_flush(done){let{length}=this.sorted;for(;length--;)this._push(this.sorted.pop());done()}}__name(SortIterator,"SortIterator");SortIterator$1.SortIterator=SortIterator;Object.defineProperty(ActorQueryOperationOrderBySparqlee$1,"__esModule",{value:!0});ActorQueryOperationOrderBySparqlee$1.ActorQueryOperationOrderBySparqlee=void 0;const bus_query_operation_1$y=lib$2y,sparqlalgebrajs_1$k=sparqlalgebrajs,sparqlee_1$1=dist,SortIterator_1=SortIterator$1;class ActorQueryOperationOrderBySparqlee extends bus_query_operation_1$y.ActorQueryOperationTypedMediated{constructor(args){super(args,"orderby"),this.window=args.window??Number.POSITIVE_INFINITY}async testOperation(operation,context2){for(let expr of operation.expressions)expr=this.extractSortExpression(expr),new sparqlee_1$1.AsyncEvaluator(expr,bus_query_operation_1$y.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation));return!0}async runOperation(operation,context2){const outputRaw=await this.mediatorQueryOperation.mediate({operation:operation.input,context:context2}),output=bus_query_operation_1$y.ActorQueryOperation.getSafeBindings(outputRaw),options={window:this.window},sparqleeConfig={...bus_query_operation_1$y.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation)};let{bindingsStream}=output;for(let i=operation.expressions.length-1;i>=0;i--){let expr=operation.expressions[i];const isAscending=this.isAscending(expr);expr=this.extractSortExpression(expr);const evaluator=new sparqlee_1$1.AsyncEvaluator(expr,sparqleeConfig),transform=__name(async(bindings,next,push)=>{try{const result=await evaluator.evaluate(bindings);push({bindings,result})}catch(error){(0,sparqlee_1$1.isExpressionError)(error)||bindingsStream.emit("error",error),push({bindings,result:void 0})}next()},"transform"),transformedStream=bindingsStream.transform({transform});bindingsStream=new SortIterator_1.SortIterator(transformedStream,(left,right)=>{let compare=(0,sparqlee_1$1.orderTypes)(left.result,right.result);return isAscending||(compare*=-1),compare},options).map(({bindings,result})=>bindings)}return{type:"bindings",bindingsStream,metadata:output.metadata}}extractSortExpression(expr){const{expressionType,operator}=expr;return expressionType!==sparqlalgebrajs_1$k.Algebra.expressionTypes.OPERATOR?expr:operator==="desc"?expr.args[0]:expr}isAscending(expr){const{expressionType,operator}=expr;return expressionType!==sparqlalgebrajs_1$k.Algebra.expressionTypes.OPERATOR?!0:operator!=="desc"}}__name(ActorQueryOperationOrderBySparqlee,"ActorQueryOperationOrderBySparqlee");ActorQueryOperationOrderBySparqlee$1.ActorQueryOperationOrderBySparqlee=ActorQueryOperationOrderBySparqlee;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationOrderBySparqlee$1,exports)})(lib$Y);var lib$X={},ActorQueryOperationNop$1={};Object.defineProperty(ActorQueryOperationNop$1,"__esModule",{value:!0});ActorQueryOperationNop$1.ActorQueryOperationNop=void 0;const bindings_factory_1$a=lib$2v,bus_query_operation_1$x=lib$2y,metadata_1$8=lib$2h,asynciterator_1$g=asynciterator,BF$a=new bindings_factory_1$a.BindingsFactory;class ActorQueryOperationNop extends bus_query_operation_1$x.ActorQueryOperationTypedMediated{constructor(args){super(args,"nop")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){return{bindingsStream:new asynciterator_1$g.SingletonIterator(BF$a.bindings()),metadata:()=>Promise.resolve({state:new metadata_1$8.MetadataValidationState,cardinality:{type:"exact",value:1},canContainUndefs:!1,variables:[]}),type:"bindings"}}}__name(ActorQueryOperationNop,"ActorQueryOperationNop");ActorQueryOperationNop$1.ActorQueryOperationNop=ActorQueryOperationNop;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationNop$1,exports)})(lib$X);var lib$W={},ActorQueryOperationProject$1={};Object.defineProperty(ActorQueryOperationProject$1,"__esModule",{value:!0});ActorQueryOperationProject$1.ActorQueryOperationProject=void 0;const bus_query_operation_1$w=lib$2y,data_factory_1=lib$2w,rdf_data_factory_1$b=rdfDataFactory,DF$b=new rdf_data_factory_1$b.DataFactory;class ActorQueryOperationProject extends bus_query_operation_1$w.ActorQueryOperationTypedMediated{constructor(args){super(args,"project")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){const output=bus_query_operation_1$w.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:operation.input,context:context2})),outputMetadata=await output.metadata(),variables2=operation.variables,deleteVariables=outputMetadata.variables.filter(variable=>!variables2.some(subVariable=>variable.value===subVariable.value)),missingVariables=variables2.filter(variable=>!outputMetadata.variables.some(subVariable=>variable.value===subVariable.value));if(missingVariables.length>0)throw new Error(`Variables '${missingVariables.map(variable=>`?${variable.value}`)}' are used in the projection result, but are not assigned.`);let bindingsStream=deleteVariables.length===0?output.bindingsStream:output.bindingsStream.transform({map(bindings){for(const deleteVariable of deleteVariables)bindings=bindings.delete(deleteVariable);return bindings},autoStart:!1}),blankNodeCounter=0;return bindingsStream=bindingsStream.transform({map(bindings){blankNodeCounter++;const scopedBlankNodesCache=new Map;return bindings.map(term=>{if(term instanceof data_factory_1.BlankNodeBindingsScoped){let scopedBlankNode=scopedBlankNodesCache.get(term.value);return scopedBlankNode||(scopedBlankNode=DF$b.blankNode(`${term.value}${blankNodeCounter}`),scopedBlankNodesCache.set(term.value,scopedBlankNode)),scopedBlankNode}return term})},autoStart:!1}),{type:"bindings",bindingsStream,metadata:async()=>({...outputMetadata,variables:variables2})}}}__name(ActorQueryOperationProject,"ActorQueryOperationProject");ActorQueryOperationProject$1.ActorQueryOperationProject=ActorQueryOperationProject;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationProject$1,exports)})(lib$W);var lib$V={},ActorQueryOperationService$1={};Object.defineProperty(ActorQueryOperationService$1,"__esModule",{value:!0});ActorQueryOperationService$1.ActorQueryOperationService=void 0;const bindings_factory_1$9=lib$2v,bus_query_operation_1$v=lib$2y,context_entries_1$e=lib$2x,metadata_1$7=lib$2h,asynciterator_1$f=asynciterator,BF$9=new bindings_factory_1$9.BindingsFactory;class ActorQueryOperationService extends bus_query_operation_1$v.ActorQueryOperationTypedMediated{constructor(args){super(args,"service")}async testOperation(operation,context2){if(operation.name.termType!=="NamedNode")throw new Error(`${this.name} can only query services by IRI, while a ${operation.name.termType} was given.`);return!0}async runOperation(operation,context2){const endpoint=operation.name.value;let subContext=context2.delete(context_entries_1$e.KeysRdfResolveQuadPattern.source).delete(context_entries_1$e.KeysRdfResolveQuadPattern.sources).delete(context_entries_1$e.KeysInitQuery.queryString);const sourceType=this.forceSparqlEndpoint?"sparql":void 0;subContext=subContext.set(context_entries_1$e.KeysRdfResolveQuadPattern.sources,[{type:sourceType,value:endpoint}]);let output;try{output=bus_query_operation_1$v.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:operation.input,context:subContext}))}catch(error){if(operation.silent)output={bindingsStream:new asynciterator_1$f.SingletonIterator(BF$9.bindings()),type:"bindings",metadata:async()=>({state:new metadata_1$7.MetadataValidationState,cardinality:{type:"exact",value:1},canContainUndefs:!1,variables:[]})};else throw error}return output}}__name(ActorQueryOperationService,"ActorQueryOperationService");ActorQueryOperationService$1.ActorQueryOperationService=ActorQueryOperationService;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationService$1,exports)})(lib$V);var lib$U={},ActorQueryOperationReducedHash$1={},cjs={};Object.defineProperty(cjs,"__esModule",{value:!0});cjs.LRUCache=void 0;const perf=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,warned=new Set,PROCESS=typeof process=="object"&&process?process:{},emitWarning=__name((msg,type,code,fn)=>{typeof PROCESS.emitWarning=="function"?PROCESS.emitWarning(msg,type,code,fn):console.error(`[${code}] ${type}: ${msg}`)},"emitWarning");let AC=globalThis.AbortController,AS=globalThis.AbortSignal;var _a;if(typeof AC>"u"){AS=__name(class{constructor(){__publicField(this,"onabort");__publicField(this,"_onabort",[]);__publicField(this,"reason");__publicField(this,"aborted",!1)}addEventListener(_,fn){this._onabort.push(fn)}},"AbortSignal"),AC=__name(class{constructor(){__publicField(this,"signal",new AS);warnACPolyfill()}abort(reason){var _a2,_b;if(!this.signal.aborted){this.signal.reason=reason,this.signal.aborted=!0;for(const fn of this.signal._onabort)fn(reason);(_b=(_a2=this.signal).onabort)==null||_b.call(_a2,reason)}}},"AbortController");let printACPolyfillWarning=((_a=PROCESS.env)==null?void 0:_a.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const warnACPolyfill=__name(()=>{printACPolyfillWarning&&(printACPolyfillWarning=!1,emitWarning("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",warnACPolyfill))},"warnACPolyfill")}const shouldWarn=__name(code=>!warned.has(code),"shouldWarn"),isPosInt=__name(n=>n&&n===Math.floor(n)&&n>0&&isFinite(n),"isPosInt"),getUintArray=__name(max2=>isPosInt(max2)?max2<=Math.pow(2,8)?Uint8Array:max2<=Math.pow(2,16)?Uint16Array:max2<=Math.pow(2,32)?Uint32Array:max2<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null,"getUintArray");class ZeroArray extends Array{constructor(size){super(size),this.fill(0)}}__name(ZeroArray,"ZeroArray");var _constructing;const _Stack=class{constructor(max2,HeapCls){__publicField(this,"heap");__publicField(this,"length");if(!__privateGet(_Stack,_constructing))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new HeapCls(max2),this.length=0}static create(max2){const HeapCls=getUintArray(max2);if(!HeapCls)return[];__privateSet(_Stack,_constructing,!0);const s2=new _Stack(max2,HeapCls);return __privateSet(_Stack,_constructing,!1),s2}push(n){this.heap[this.length++]=n}pop(){return this.heap[--this.length]}};let Stack=_Stack;__name(Stack,"Stack"),_constructing=new WeakMap,__privateAdd(Stack,_constructing,!1);var _max,_maxSize,_dispose,_disposeAfter,_fetchMethod,_size,_calculatedSize,_keyMap,_keyList,_valList,_next,_prev,_head,_tail,_free,_disposed,_sizes,_starts,_ttls,_hasDispose,_hasFetchMethod,_hasDisposeAfter,_initializeTTLTracking,initializeTTLTracking_fn,_updateItemAge,_statusTTL,_setItemTTL,_isStale,_initializeSizeTracking,initializeSizeTracking_fn,_removeItemSize,_addItemSize,_requireSize,_indexes,indexes_fn,_rindexes,rindexes_fn,_isValidIndex,isValidIndex_fn,_evict,evict_fn,_backgroundFetch,backgroundFetch_fn,_isBackgroundFetch,isBackgroundFetch_fn,_connect,connect_fn,_moveToTail,moveToTail_fn;const _LRUCache=class{constructor(options){__privateAdd(this,_initializeTTLTracking);__privateAdd(this,_initializeSizeTracking);__privateAdd(this,_indexes);__privateAdd(this,_rindexes);__privateAdd(this,_isValidIndex);__privateAdd(this,_evict);__privateAdd(this,_backgroundFetch);__privateAdd(this,_isBackgroundFetch);__privateAdd(this,_connect);__privateAdd(this,_moveToTail);__privateAdd(this,_max,void 0);__privateAdd(this,_maxSize,void 0);__privateAdd(this,_dispose,void 0);__privateAdd(this,_disposeAfter,void 0);__privateAdd(this,_fetchMethod,void 0);__publicField(this,"ttl");__publicField(this,"ttlResolution");__publicField(this,"ttlAutopurge");__publicField(this,"updateAgeOnGet");__publicField(this,"updateAgeOnHas");__publicField(this,"allowStale");__publicField(this,"noDisposeOnSet");__publicField(this,"noUpdateTTL");__publicField(this,"maxEntrySize");__publicField(this,"sizeCalculation");__publicField(this,"noDeleteOnFetchRejection");__publicField(this,"noDeleteOnStaleGet");__publicField(this,"allowStaleOnFetchAbort");__publicField(this,"allowStaleOnFetchRejection");__publicField(this,"ignoreFetchAbort");__privateAdd(this,_size,void 0);__privateAdd(this,_calculatedSize,void 0);__privateAdd(this,_keyMap,void 0);__privateAdd(this,_keyList,void 0);__privateAdd(this,_valList,void 0);__privateAdd(this,_next,void 0);__privateAdd(this,_prev,void 0);__privateAdd(this,_head,void 0);__privateAdd(this,_tail,void 0);__privateAdd(this,_free,void 0);__privateAdd(this,_disposed,void 0);__privateAdd(this,_sizes,void 0);__privateAdd(this,_starts,void 0);__privateAdd(this,_ttls,void 0);__privateAdd(this,_hasDispose,void 0);__privateAdd(this,_hasFetchMethod,void 0);__privateAdd(this,_hasDisposeAfter,void 0);__privateAdd(this,_updateItemAge,__name(()=>{},"#updateItemAge"));__privateAdd(this,_statusTTL,__name(()=>{},"#statusTTL"));__privateAdd(this,_setItemTTL,__name(()=>{},"#setItemTTL"));__privateAdd(this,_isStale,__name(()=>!1,"#isStale"));__privateAdd(this,_removeItemSize,__name(_i=>{},"#removeItemSize"));__privateAdd(this,_addItemSize,__name((_i,_s,_st)=>{},"#addItemSize"));__privateAdd(this,_requireSize,__name((_k,_v,size,sizeCalculation)=>{if(size||sizeCalculation)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0},"#requireSize"));const{max:max2=0,ttl,ttlResolution=1,ttlAutopurge,updateAgeOnGet,updateAgeOnHas,allowStale,dispose,disposeAfter,noDisposeOnSet,noUpdateTTL,maxSize=0,maxEntrySize=0,sizeCalculation,fetchMethod,noDeleteOnFetchRejection,noDeleteOnStaleGet,allowStaleOnFetchRejection,allowStaleOnFetchAbort,ignoreFetchAbort}=options;if(max2!==0&&!isPosInt(max2))throw new TypeError("max option must be a nonnegative integer");const UintArray=max2?getUintArray(max2):Array;if(!UintArray)throw new Error("invalid max value: "+max2);if(__privateSet(this,_max,max2),__privateSet(this,_maxSize,maxSize),this.maxEntrySize=maxEntrySize||__privateGet(this,_maxSize),this.sizeCalculation=sizeCalculation,this.sizeCalculation){if(!__privateGet(this,_maxSize)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(fetchMethod!==void 0&&typeof fetchMethod!="function")throw new TypeError("fetchMethod must be a function if specified");if(__privateSet(this,_fetchMethod,fetchMethod),__privateSet(this,_hasFetchMethod,!!fetchMethod),__privateSet(this,_keyMap,new Map),__privateSet(this,_keyList,new Array(max2).fill(void 0)),__privateSet(this,_valList,new Array(max2).fill(void 0)),__privateSet(this,_next,new UintArray(max2)),__privateSet(this,_prev,new UintArray(max2)),__privateSet(this,_head,0),__privateSet(this,_tail,0),__privateSet(this,_free,Stack.create(max2)),__privateSet(this,_size,0),__privateSet(this,_calculatedSize,0),typeof dispose=="function"&&__privateSet(this,_dispose,dispose),typeof disposeAfter=="function"?(__privateSet(this,_disposeAfter,disposeAfter),__privateSet(this,_disposed,[])):(__privateSet(this,_disposeAfter,void 0),__privateSet(this,_disposed,void 0)),__privateSet(this,_hasDispose,!!__privateGet(this,_dispose)),__privateSet(this,_hasDisposeAfter,!!__privateGet(this,_disposeAfter)),this.noDisposeOnSet=!!noDisposeOnSet,this.noUpdateTTL=!!noUpdateTTL,this.noDeleteOnFetchRejection=!!noDeleteOnFetchRejection,this.allowStaleOnFetchRejection=!!allowStaleOnFetchRejection,this.allowStaleOnFetchAbort=!!allowStaleOnFetchAbort,this.ignoreFetchAbort=!!ignoreFetchAbort,this.maxEntrySize!==0){if(__privateGet(this,_maxSize)!==0&&!isPosInt(__privateGet(this,_maxSize)))throw new TypeError("maxSize must be a positive integer if specified");if(!isPosInt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");__privateMethod(this,_initializeSizeTracking,initializeSizeTracking_fn).call(this)}if(this.allowStale=!!allowStale,this.noDeleteOnStaleGet=!!noDeleteOnStaleGet,this.updateAgeOnGet=!!updateAgeOnGet,this.updateAgeOnHas=!!updateAgeOnHas,this.ttlResolution=isPosInt(ttlResolution)||ttlResolution===0?ttlResolution:1,this.ttlAutopurge=!!ttlAutopurge,this.ttl=ttl||0,this.ttl){if(!isPosInt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");__privateMethod(this,_initializeTTLTracking,initializeTTLTracking_fn).call(this)}if(__privateGet(this,_max)===0&&this.ttl===0&&__privateGet(this,_maxSize)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!__privateGet(this,_max)&&!__privateGet(this,_maxSize)){const code="LRU_CACHE_UNBOUNDED";shouldWarn(code)&&(warned.add(code),emitWarning("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",code,_LRUCache))}}static unsafeExposeInternals(c){return{starts:__privateGet(c,_starts),ttls:__privateGet(c,_ttls),sizes:__privateGet(c,_sizes),keyMap:__privateGet(c,_keyMap),keyList:__privateGet(c,_keyList),valList:__privateGet(c,_valList),next:__privateGet(c,_next),prev:__privateGet(c,_prev),get head(){return __privateGet(c,_head)},get tail(){return __privateGet(c,_tail)},free:__privateGet(c,_free),isBackgroundFetch:p=>{var _a2;return __privateMethod(_a2=c,_isBackgroundFetch,isBackgroundFetch_fn).call(_a2,p)},backgroundFetch:(k,index,options,context2)=>{var _a2;return __privateMethod(_a2=c,_backgroundFetch,backgroundFetch_fn).call(_a2,k,index,options,context2)},moveToTail:index=>{var _a2;return __privateMethod(_a2=c,_moveToTail,moveToTail_fn).call(_a2,index)},indexes:options=>{var _a2;return __privateMethod(_a2=c,_indexes,indexes_fn).call(_a2,options)},rindexes:options=>{var _a2;return __privateMethod(_a2=c,_rindexes,rindexes_fn).call(_a2,options)},isStale:index=>{var _a2;return __privateGet(_a2=c,_isStale).call(_a2,index)}}}get max(){return __privateGet(this,_max)}get maxSize(){return __privateGet(this,_maxSize)}get calculatedSize(){return __privateGet(this,_calculatedSize)}get size(){return __privateGet(this,_size)}get fetchMethod(){return __privateGet(this,_fetchMethod)}get dispose(){return __privateGet(this,_dispose)}get disposeAfter(){return __privateGet(this,_disposeAfter)}getRemainingTTL(key){return __privateGet(this,_keyMap).has(key)?1/0:0}*entries(){for(const i of __privateMethod(this,_indexes,indexes_fn).call(this))__privateGet(this,_valList)[i]!==void 0&&__privateGet(this,_keyList)[i]!==void 0&&!__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,__privateGet(this,_valList)[i])&&(yield[__privateGet(this,_keyList)[i],__privateGet(this,_valList)[i]])}*rentries(){for(const i of __privateMethod(this,_rindexes,rindexes_fn).call(this))__privateGet(this,_valList)[i]!==void 0&&__privateGet(this,_keyList)[i]!==void 0&&!__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,__privateGet(this,_valList)[i])&&(yield[__privateGet(this,_keyList)[i],__privateGet(this,_valList)[i]])}*keys(){for(const i of __privateMethod(this,_indexes,indexes_fn).call(this)){const k=__privateGet(this,_keyList)[i];k!==void 0&&!__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,__privateGet(this,_valList)[i])&&(yield k)}}*rkeys(){for(const i of __privateMethod(this,_rindexes,rindexes_fn).call(this)){const k=__privateGet(this,_keyList)[i];k!==void 0&&!__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,__privateGet(this,_valList)[i])&&(yield k)}}*values(){for(const i of __privateMethod(this,_indexes,indexes_fn).call(this))__privateGet(this,_valList)[i]!==void 0&&!__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,__privateGet(this,_valList)[i])&&(yield __privateGet(this,_valList)[i])}*rvalues(){for(const i of __privateMethod(this,_rindexes,rindexes_fn).call(this))__privateGet(this,_valList)[i]!==void 0&&!__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,__privateGet(this,_valList)[i])&&(yield __privateGet(this,_valList)[i])}[Symbol.iterator](){return this.entries()}find(fn,getOptions={}){for(const i of __privateMethod(this,_indexes,indexes_fn).call(this)){const v=__privateGet(this,_valList)[i],value=__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)?v.__staleWhileFetching:v;if(value!==void 0&&fn(value,__privateGet(this,_keyList)[i],this))return this.get(__privateGet(this,_keyList)[i],getOptions)}}forEach(fn,thisp=this){for(const i of __privateMethod(this,_indexes,indexes_fn).call(this)){const v=__privateGet(this,_valList)[i],value=__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)?v.__staleWhileFetching:v;value!==void 0&&fn.call(thisp,value,__privateGet(this,_keyList)[i],this)}}rforEach(fn,thisp=this){for(const i of __privateMethod(this,_rindexes,rindexes_fn).call(this)){const v=__privateGet(this,_valList)[i],value=__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)?v.__staleWhileFetching:v;value!==void 0&&fn.call(thisp,value,__privateGet(this,_keyList)[i],this)}}purgeStale(){let deleted=!1;for(const i of __privateMethod(this,_rindexes,rindexes_fn).call(this,{allowStale:!0}))__privateGet(this,_isStale).call(this,i)&&(this.delete(__privateGet(this,_keyList)[i]),deleted=!0);return deleted}dump(){const arr=[];for(const i of __privateMethod(this,_indexes,indexes_fn).call(this,{allowStale:!0})){const key=__privateGet(this,_keyList)[i],v=__privateGet(this,_valList)[i],value=__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)?v.__staleWhileFetching:v;if(value===void 0||key===void 0)continue;const entry={value};if(__privateGet(this,_ttls)&&__privateGet(this,_starts)){entry.ttl=__privateGet(this,_ttls)[i];const age=perf.now()-__privateGet(this,_starts)[i];entry.start=Math.floor(Date.now()-age)}__privateGet(this,_sizes)&&(entry.size=__privateGet(this,_sizes)[i]),arr.unshift([key,entry])}return arr}load(arr){this.clear();for(const[key,entry]of arr){if(entry.start){const age=Date.now()-entry.start;entry.start=perf.now()-age}this.set(key,entry.value,entry)}}set(k,v,setOptions={}){var _a2,_b,_c;if(v===void 0)return this.delete(k),this;const{ttl=this.ttl,start,noDisposeOnSet=this.noDisposeOnSet,sizeCalculation=this.sizeCalculation,status}=setOptions;let{noUpdateTTL=this.noUpdateTTL}=setOptions;const size=__privateGet(this,_requireSize).call(this,k,v,setOptions.size||0,sizeCalculation);if(this.maxEntrySize&&size>this.maxEntrySize)return status&&(status.set="miss",status.maxEntrySizeExceeded=!0),this.delete(k),this;let index=__privateGet(this,_size)===0?void 0:__privateGet(this,_keyMap).get(k);if(index===void 0)index=__privateGet(this,_size)===0?__privateGet(this,_tail):__privateGet(this,_free).length!==0?__privateGet(this,_free).pop():__privateGet(this,_size)===__privateGet(this,_max)?__privateMethod(this,_evict,evict_fn).call(this,!1):__privateGet(this,_size),__privateGet(this,_keyList)[index]=k,__privateGet(this,_valList)[index]=v,__privateGet(this,_keyMap).set(k,index),__privateGet(this,_next)[__privateGet(this,_tail)]=index,__privateGet(this,_prev)[index]=__privateGet(this,_tail),__privateSet(this,_tail,index),__privateWrapper(this,_size)._++,__privateGet(this,_addItemSize).call(this,index,size,status),status&&(status.set="add"),noUpdateTTL=!1;else{__privateMethod(this,_moveToTail,moveToTail_fn).call(this,index);const oldVal=__privateGet(this,_valList)[index];if(v!==oldVal){if(__privateGet(this,_hasFetchMethod)&&__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,oldVal)?oldVal.__abortController.abort(new Error("replaced")):noDisposeOnSet||(__privateGet(this,_hasDispose)&&((_a2=__privateGet(this,_dispose))==null||_a2.call(this,oldVal,k,"set")),__privateGet(this,_hasDisposeAfter)&&((_b=__privateGet(this,_disposed))==null||_b.push([oldVal,k,"set"]))),__privateGet(this,_removeItemSize).call(this,index),__privateGet(this,_addItemSize).call(this,index,size,status),__privateGet(this,_valList)[index]=v,status){status.set="replace";const oldValue=oldVal&&__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,oldVal)?oldVal.__staleWhileFetching:oldVal;oldValue!==void 0&&(status.oldValue=oldValue)}}else status&&(status.set="update")}if(ttl!==0&&!__privateGet(this,_ttls)&&__privateMethod(this,_initializeTTLTracking,initializeTTLTracking_fn).call(this),__privateGet(this,_ttls)&&(noUpdateTTL||__privateGet(this,_setItemTTL).call(this,index,ttl,start),status&&__privateGet(this,_statusTTL).call(this,status,index)),!noDisposeOnSet&&__privateGet(this,_hasDisposeAfter)&&__privateGet(this,_disposed)){const dt=__privateGet(this,_disposed);let task;for(;task=dt==null?void 0:dt.shift();)(_c=__privateGet(this,_disposeAfter))==null||_c.call(this,...task)}return this}pop(){var _a2;try{for(;__privateGet(this,_size);){const val=__privateGet(this,_valList)[__privateGet(this,_head)];if(__privateMethod(this,_evict,evict_fn).call(this,!0),__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,val)){if(val.__staleWhileFetching)return val.__staleWhileFetching}else if(val!==void 0)return val}}finally{if(__privateGet(this,_hasDisposeAfter)&&__privateGet(this,_disposed)){const dt=__privateGet(this,_disposed);let task;for(;task=dt==null?void 0:dt.shift();)(_a2=__privateGet(this,_disposeAfter))==null||_a2.call(this,...task)}}}has(k,hasOptions={}){const{updateAgeOnHas=this.updateAgeOnHas,status}=hasOptions,index=__privateGet(this,_keyMap).get(k);if(index!==void 0){const v=__privateGet(this,_valList)[index];if(__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)&&v.__staleWhileFetching===void 0)return!1;if(__privateGet(this,_isStale).call(this,index))status&&(status.has="stale",__privateGet(this,_statusTTL).call(this,status,index));else return updateAgeOnHas&&__privateGet(this,_updateItemAge).call(this,index),status&&(status.has="hit",__privateGet(this,_statusTTL).call(this,status,index)),!0}else status&&(status.has="miss");return!1}peek(k,peekOptions={}){const{allowStale=this.allowStale}=peekOptions,index=__privateGet(this,_keyMap).get(k);if(index!==void 0&&(allowStale||!__privateGet(this,_isStale).call(this,index))){const v=__privateGet(this,_valList)[index];return __privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)?v.__staleWhileFetching:v}}async fetch(k,fetchOptions={}){const{allowStale=this.allowStale,updateAgeOnGet=this.updateAgeOnGet,noDeleteOnStaleGet=this.noDeleteOnStaleGet,ttl=this.ttl,noDisposeOnSet=this.noDisposeOnSet,size=0,sizeCalculation=this.sizeCalculation,noUpdateTTL=this.noUpdateTTL,noDeleteOnFetchRejection=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection=this.allowStaleOnFetchRejection,ignoreFetchAbort=this.ignoreFetchAbort,allowStaleOnFetchAbort=this.allowStaleOnFetchAbort,context:context2,forceRefresh=!1,status,signal}=fetchOptions;if(!__privateGet(this,_hasFetchMethod))return status&&(status.fetch="get"),this.get(k,{allowStale,updateAgeOnGet,noDeleteOnStaleGet,status});const options={allowStale,updateAgeOnGet,noDeleteOnStaleGet,ttl,noDisposeOnSet,size,sizeCalculation,noUpdateTTL,noDeleteOnFetchRejection,allowStaleOnFetchRejection,allowStaleOnFetchAbort,ignoreFetchAbort,status,signal};let index=__privateGet(this,_keyMap).get(k);if(index===void 0){status&&(status.fetch="miss");const p=__privateMethod(this,_backgroundFetch,backgroundFetch_fn).call(this,k,index,options,context2);return p.__returned=p}else{const v=__privateGet(this,_valList)[index];if(__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)){const stale=allowStale&&v.__staleWhileFetching!==void 0;return status&&(status.fetch="inflight",stale&&(status.returnedStale=!0)),stale?v.__staleWhileFetching:v.__returned=v}const isStale2=__privateGet(this,_isStale).call(this,index);if(!forceRefresh&&!isStale2)return status&&(status.fetch="hit"),__privateMethod(this,_moveToTail,moveToTail_fn).call(this,index),updateAgeOnGet&&__privateGet(this,_updateItemAge).call(this,index),status&&__privateGet(this,_statusTTL).call(this,status,index),v;const p=__privateMethod(this,_backgroundFetch,backgroundFetch_fn).call(this,k,index,options,context2),staleVal=p.__staleWhileFetching!==void 0&&allowStale;return status&&(status.fetch=isStale2?"stale":"refresh",staleVal&&isStale2&&(status.returnedStale=!0)),staleVal?p.__staleWhileFetching:p.__returned=p}}get(k,getOptions={}){const{allowStale=this.allowStale,updateAgeOnGet=this.updateAgeOnGet,noDeleteOnStaleGet=this.noDeleteOnStaleGet,status}=getOptions,index=__privateGet(this,_keyMap).get(k);if(index!==void 0){const value=__privateGet(this,_valList)[index],fetching=__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,value);return status&&__privateGet(this,_statusTTL).call(this,status,index),__privateGet(this,_isStale).call(this,index)?(status&&(status.get="stale"),fetching?(status&&allowStale&&value.__staleWhileFetching!==void 0&&(status.returnedStale=!0),allowStale?value.__staleWhileFetching:void 0):(noDeleteOnStaleGet||this.delete(k),status&&allowStale&&(status.returnedStale=!0),allowStale?value:void 0)):(status&&(status.get="hit"),fetching?value.__staleWhileFetching:(__privateMethod(this,_moveToTail,moveToTail_fn).call(this,index),updateAgeOnGet&&__privateGet(this,_updateItemAge).call(this,index),value))}else status&&(status.get="miss")}delete(k){var _a2,_b,_c,_d;let deleted=!1;if(__privateGet(this,_size)!==0){const index=__privateGet(this,_keyMap).get(k);if(index!==void 0)if(deleted=!0,__privateGet(this,_size)===1)this.clear();else{__privateGet(this,_removeItemSize).call(this,index);const v=__privateGet(this,_valList)[index];__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)?v.__abortController.abort(new Error("deleted")):(__privateGet(this,_hasDispose)||__privateGet(this,_hasDisposeAfter))&&(__privateGet(this,_hasDispose)&&((_a2=__privateGet(this,_dispose))==null||_a2.call(this,v,k,"delete")),__privateGet(this,_hasDisposeAfter)&&((_b=__privateGet(this,_disposed))==null||_b.push([v,k,"delete"]))),__privateGet(this,_keyMap).delete(k),__privateGet(this,_keyList)[index]=void 0,__privateGet(this,_valList)[index]=void 0,index===__privateGet(this,_tail)?__privateSet(this,_tail,__privateGet(this,_prev)[index]):index===__privateGet(this,_head)?__privateSet(this,_head,__privateGet(this,_next)[index]):(__privateGet(this,_next)[__privateGet(this,_prev)[index]]=__privateGet(this,_next)[index],__privateGet(this,_prev)[__privateGet(this,_next)[index]]=__privateGet(this,_prev)[index]),__privateWrapper(this,_size)._--,__privateGet(this,_free).push(index)}}if(__privateGet(this,_hasDisposeAfter)&&((_c=__privateGet(this,_disposed))!=null&&_c.length)){const dt=__privateGet(this,_disposed);let task;for(;task=dt==null?void 0:dt.shift();)(_d=__privateGet(this,_disposeAfter))==null||_d.call(this,...task)}return deleted}clear(){var _a2,_b,_c;for(const index of __privateMethod(this,_rindexes,rindexes_fn).call(this,{allowStale:!0})){const v=__privateGet(this,_valList)[index];if(__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v))v.__abortController.abort(new Error("deleted"));else{const k=__privateGet(this,_keyList)[index];__privateGet(this,_hasDispose)&&((_a2=__privateGet(this,_dispose))==null||_a2.call(this,v,k,"delete")),__privateGet(this,_hasDisposeAfter)&&((_b=__privateGet(this,_disposed))==null||_b.push([v,k,"delete"]))}}if(__privateGet(this,_keyMap).clear(),__privateGet(this,_valList).fill(void 0),__privateGet(this,_keyList).fill(void 0),__privateGet(this,_ttls)&&__privateGet(this,_starts)&&(__privateGet(this,_ttls).fill(0),__privateGet(this,_starts).fill(0)),__privateGet(this,_sizes)&&__privateGet(this,_sizes).fill(0),__privateSet(this,_head,0),__privateSet(this,_tail,0),__privateGet(this,_free).length=0,__privateSet(this,_calculatedSize,0),__privateSet(this,_size,0),__privateGet(this,_hasDisposeAfter)&&__privateGet(this,_disposed)){const dt=__privateGet(this,_disposed);let task;for(;task=dt==null?void 0:dt.shift();)(_c=__privateGet(this,_disposeAfter))==null||_c.call(this,...task)}}};let LRUCache2=_LRUCache;__name(LRUCache2,"LRUCache"),_max=new WeakMap,_maxSize=new WeakMap,_dispose=new WeakMap,_disposeAfter=new WeakMap,_fetchMethod=new WeakMap,_size=new WeakMap,_calculatedSize=new WeakMap,_keyMap=new WeakMap,_keyList=new WeakMap,_valList=new WeakMap,_next=new WeakMap,_prev=new WeakMap,_head=new WeakMap,_tail=new WeakMap,_free=new WeakMap,_disposed=new WeakMap,_sizes=new WeakMap,_starts=new WeakMap,_ttls=new WeakMap,_hasDispose=new WeakMap,_hasFetchMethod=new WeakMap,_hasDisposeAfter=new WeakMap,_initializeTTLTracking=new WeakSet,initializeTTLTracking_fn=__name(function(){const ttls=new ZeroArray(__privateGet(this,_max)),starts=new ZeroArray(__privateGet(this,_max));__privateSet(this,_ttls,ttls),__privateSet(this,_starts,starts),__privateSet(this,_setItemTTL,(index,ttl,start=perf.now())=>{if(starts[index]=ttl!==0?start:0,ttls[index]=ttl,ttl!==0&&this.ttlAutopurge){const t=setTimeout(()=>{__privateGet(this,_isStale).call(this,index)&&this.delete(__privateGet(this,_keyList)[index])},ttl+1);t.unref&&t.unref()}}),__privateSet(this,_updateItemAge,index=>{starts[index]=ttls[index]!==0?perf.now():0}),__privateSet(this,_statusTTL,(status,index)=>{if(ttls[index]){const ttl=ttls[index],start=starts[index];status.ttl=ttl,status.start=start,status.now=cachedNow||getNow();const age=status.now-start;status.remainingTTL=ttl-age}});let cachedNow=0;const getNow=__name(()=>{const n=perf.now();if(this.ttlResolution>0){cachedNow=n;const t=setTimeout(()=>cachedNow=0,this.ttlResolution);t.unref&&t.unref()}return n},"getNow");this.getRemainingTTL=key=>{const index=__privateGet(this,_keyMap).get(key);if(index===void 0)return 0;const ttl=ttls[index],start=starts[index];if(ttl===0||start===0)return 1/0;const age=(cachedNow||getNow())-start;return ttl-age},__privateSet(this,_isStale,index=>ttls[index]!==0&&starts[index]!==0&&(cachedNow||getNow())-starts[index]>ttls[index])},"#initializeTTLTracking"),_updateItemAge=new WeakMap,_statusTTL=new WeakMap,_setItemTTL=new WeakMap,_isStale=new WeakMap,_initializeSizeTracking=new WeakSet,initializeSizeTracking_fn=__name(function(){const sizes=new ZeroArray(__privateGet(this,_max));__privateSet(this,_calculatedSize,0),__privateSet(this,_sizes,sizes),__privateSet(this,_removeItemSize,index=>{__privateSet(this,_calculatedSize,__privateGet(this,_calculatedSize)-sizes[index]),sizes[index]=0}),__privateSet(this,_requireSize,(k,v,size,sizeCalculation)=>{if(__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v))return 0;if(!isPosInt(size))if(sizeCalculation){if(typeof sizeCalculation!="function")throw new TypeError("sizeCalculation must be a function");if(size=sizeCalculation(v,k),!isPosInt(size))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return size}),__privateSet(this,_addItemSize,(index,size,status)=>{if(sizes[index]=size,__privateGet(this,_maxSize)){const maxSize=__privateGet(this,_maxSize)-sizes[index];for(;__privateGet(this,_calculatedSize)>maxSize;)__privateMethod(this,_evict,evict_fn).call(this,!0)}__privateSet(this,_calculatedSize,__privateGet(this,_calculatedSize)+sizes[index]),status&&(status.entrySize=size,status.totalCalculatedSize=__privateGet(this,_calculatedSize))})},"#initializeSizeTracking"),_removeItemSize=new WeakMap,_addItemSize=new WeakMap,_requireSize=new WeakMap,_indexes=new WeakSet,indexes_fn=__name(function*({allowStale=this.allowStale}={}){if(__privateGet(this,_size))for(let i=__privateGet(this,_tail);!(!__privateMethod(this,_isValidIndex,isValidIndex_fn).call(this,i)||((allowStale||!__privateGet(this,_isStale).call(this,i))&&(yield i),i===__privateGet(this,_head)));)i=__privateGet(this,_prev)[i]},"#indexes"),_rindexes=new WeakSet,rindexes_fn=__name(function*({allowStale=this.allowStale}={}){if(__privateGet(this,_size))for(let i=__privateGet(this,_head);!(!__privateMethod(this,_isValidIndex,isValidIndex_fn).call(this,i)||((allowStale||!__privateGet(this,_isStale).call(this,i))&&(yield i),i===__privateGet(this,_tail)));)i=__privateGet(this,_next)[i]},"#rindexes"),_isValidIndex=new WeakSet,isValidIndex_fn=__name(function(index){return index!==void 0&&__privateGet(this,_keyMap).get(__privateGet(this,_keyList)[index])===index},"#isValidIndex"),_evict=new WeakSet,evict_fn=__name(function(free){var _a2,_b;const head2=__privateGet(this,_head),k=__privateGet(this,_keyList)[head2],v=__privateGet(this,_valList)[head2];return __privateGet(this,_hasFetchMethod)&&__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v)?v.__abortController.abort(new Error("evicted")):(__privateGet(this,_hasDispose)||__privateGet(this,_hasDisposeAfter))&&(__privateGet(this,_hasDispose)&&((_a2=__privateGet(this,_dispose))==null||_a2.call(this,v,k,"evict")),__privateGet(this,_hasDisposeAfter)&&((_b=__privateGet(this,_disposed))==null||_b.push([v,k,"evict"]))),__privateGet(this,_removeItemSize).call(this,head2),free&&(__privateGet(this,_keyList)[head2]=void 0,__privateGet(this,_valList)[head2]=void 0,__privateGet(this,_free).push(head2)),__privateGet(this,_size)===1?(__privateSet(this,_head,__privateSet(this,_tail,0)),__privateGet(this,_free).length=0):__privateSet(this,_head,__privateGet(this,_next)[head2]),__privateGet(this,_keyMap).delete(k),__privateWrapper(this,_size)._--,head2},"#evict"),_backgroundFetch=new WeakSet,backgroundFetch_fn=__name(function(k,index,options,context2){const v=index===void 0?void 0:__privateGet(this,_valList)[index];if(__privateMethod(this,_isBackgroundFetch,isBackgroundFetch_fn).call(this,v))return v;const ac=new AC,{signal}=options;signal==null||signal.addEventListener("abort",()=>ac.abort(signal.reason),{signal:ac.signal});const fetchOpts={signal:ac.signal,options,context:context2},cb=__name((v2,updateCache=!1)=>{const{aborted}=ac.signal,ignoreAbort=options.ignoreFetchAbort&&v2!==void 0;if(options.status&&(aborted&&!updateCache?(options.status.fetchAborted=!0,options.status.fetchError=ac.signal.reason,ignoreAbort&&(options.status.fetchAbortIgnored=!0)):options.status.fetchResolved=!0),aborted&&!ignoreAbort&&!updateCache)return fetchFail(ac.signal.reason);const bf2=p;return __privateGet(this,_valList)[index]===p&&(v2===void 0?bf2.__staleWhileFetching?__privateGet(this,_valList)[index]=bf2.__staleWhileFetching:this.delete(k):(options.status&&(options.status.fetchUpdated=!0),this.set(k,v2,fetchOpts.options))),v2},"cb"),eb=__name(er=>(options.status&&(options.status.fetchRejected=!0,options.status.fetchError=er),fetchFail(er)),"eb"),fetchFail=__name(er=>{const{aborted}=ac.signal,allowStaleAborted=aborted&&options.allowStaleOnFetchAbort,allowStale=allowStaleAborted||options.allowStaleOnFetchRejection,noDelete=allowStale||options.noDeleteOnFetchRejection,bf2=p;if(__privateGet(this,_valList)[index]===p&&(!noDelete||bf2.__staleWhileFetching===void 0?this.delete(k):allowStaleAborted||(__privateGet(this,_valList)[index]=bf2.__staleWhileFetching)),allowStale)return options.status&&bf2.__staleWhileFetching!==void 0&&(options.status.returnedStale=!0),bf2.__staleWhileFetching;if(bf2.__returned===bf2)throw er},"fetchFail"),pcall=__name((res,rej)=>{var _a2;const fmp=(_a2=__privateGet(this,_fetchMethod))==null?void 0:_a2.call(this,k,v,fetchOpts);fmp&&fmp instanceof Promise&&fmp.then(v2=>res(v2===void 0?void 0:v2),rej),ac.signal.addEventListener("abort",()=>{(!options.ignoreFetchAbort||options.allowStaleOnFetchAbort)&&(res(void 0),options.allowStaleOnFetchAbort&&(res=__name(v2=>cb(v2,!0),"res")))})},"pcall");options.status&&(options.status.fetchDispatched=!0);const p=new Promise(pcall).then(cb,eb),bf=Object.assign(p,{__abortController:ac,__staleWhileFetching:v,__returned:void 0});return index===void 0?(this.set(k,bf,{...fetchOpts.options,status:void 0}),index=__privateGet(this,_keyMap).get(k)):__privateGet(this,_valList)[index]=bf,bf},"#backgroundFetch"),_isBackgroundFetch=new WeakSet,isBackgroundFetch_fn=__name(function(p){if(!__privateGet(this,_hasFetchMethod))return!1;const b=p;return!!b&&b instanceof Promise&&b.hasOwnProperty("__staleWhileFetching")&&b.__abortController instanceof AC},"#isBackgroundFetch"),_connect=new WeakSet,connect_fn=__name(function(p,n){__privateGet(this,_prev)[n]=p,__privateGet(this,_next)[p]=n},"#connect"),_moveToTail=new WeakSet,moveToTail_fn=__name(function(index){index!==__privateGet(this,_tail)&&(index===__privateGet(this,_head)?__privateSet(this,_head,__privateGet(this,_next)[index]):__privateMethod(this,_connect,connect_fn).call(this,__privateGet(this,_prev)[index],__privateGet(this,_next)[index]),__privateMethod(this,_connect,connect_fn).call(this,__privateGet(this,_tail),index),__privateSet(this,_tail,index))},"#moveToTail");cjs.LRUCache=LRUCache2;Object.defineProperty(ActorQueryOperationReducedHash$1,"__esModule",{value:!0});ActorQueryOperationReducedHash$1.ActorQueryOperationReducedHash=void 0;const bus_query_operation_1$u=lib$2y,lru_cache_1$5=cjs;class ActorQueryOperationReducedHash extends bus_query_operation_1$u.ActorQueryOperationTypedMediated{constructor(args){super(args,"reduced")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){const output=bus_query_operation_1$u.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:operation.input,context:context2}));return{type:"bindings",bindingsStream:output.bindingsStream.filter(await this.newHashFilter(context2)),metadata:output.metadata}}async newHashFilter(context2){const{hashFunction}=await this.mediatorHashBindings.mediate({allowHashCollisions:!0,context:context2}),hashes=new lru_cache_1$5.LRUCache({max:this.cacheSize});return bindings=>{const hash2=hashFunction(bindings);return hashes.has(hash2)?!1:(hashes.set(hash2,!0),!0)}}}__name(ActorQueryOperationReducedHash,"ActorQueryOperationReducedHash");ActorQueryOperationReducedHash$1.ActorQueryOperationReducedHash=ActorQueryOperationReducedHash;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationReducedHash$1,exports)})(lib$U);var lib$T={},ActorQueryOperationSlice$1={};Object.defineProperty(ActorQueryOperationSlice$1,"__esModule",{value:!0});ActorQueryOperationSlice$1.ActorQueryOperationSlice=void 0;const bus_query_operation_1$t=lib$2y,context_entries_1$d=lib$2x;class ActorQueryOperationSlice extends bus_query_operation_1$t.ActorQueryOperationTypedMediated{constructor(args){super(args,"slice")}async testOperation(operation,context2){return!0}async runOperation(operation,context2){operation.length&&(context2=context2.set(context_entries_1$d.KeysQueryOperation.limitIndicator,operation.length));const output=await this.mediatorQueryOperation.mediate({operation:operation.input,context:context2});if(output.type==="bindings")return{type:"bindings",bindingsStream:this.sliceStream(output.bindingsStream,operation),metadata:this.sliceMetadata(output,operation)};if(output.type==="quads")return{type:"quads",quadStream:this.sliceStream(output.quadStream,operation),metadata:this.sliceMetadata(output,operation)};throw new Error(`Invalid query output type: Expected 'bindings' or 'quads' but got '${output.type}'`)}sliceStream(stream,pattern){const hasLength=!!pattern.length||pattern.length===0,{start}=pattern,end=hasLength?pattern.start+pattern.length-1:Number.POSITIVE_INFINITY;return stream.transform({offset:start,limit:Math.max(end-start+1,0),autoStart:!1})}sliceMetadata(output,pattern){const hasLength=!!pattern.length||pattern.length===0;return()=>output.metadata().then(subMetadata=>{const cardinality={...subMetadata.cardinality};return Number.isFinite(cardinality.value)&&(cardinality.value=Math.max(0,cardinality.value-pattern.start),hasLength&&(cardinality.value=Math.min(cardinality.value,pattern.length))),{...subMetadata,cardinality}})}}__name(ActorQueryOperationSlice,"ActorQueryOperationSlice");ActorQueryOperationSlice$1.ActorQueryOperationSlice=ActorQueryOperationSlice;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationSlice$1,exports)})(lib$T);var lib$S={},ActorQueryOperationPathAlt$1={},lib$R={},ActorAbstractPath$1={},PathVariableObjectIterator$1={};Object.defineProperty(PathVariableObjectIterator$1,"__esModule",{value:!0});PathVariableObjectIterator$1.PathVariableObjectIterator=void 0;const bus_query_operation_1$s=lib$2y,asynciterator_1$e=asynciterator,rdf_data_factory_1$a=rdfDataFactory,rdf_string_1$7=rdfString,sparqlalgebrajs_1$j=sparqlalgebrajs,DF$a=new rdf_data_factory_1$a.DataFactory,FACTORY=new sparqlalgebrajs_1$j.Factory;class PathVariableObjectIterator extends asynciterator_1$e.BufferedIterator{constructor(subject2,predicate2,graph,context2,mediatorQueryOperation,emitFirstSubject,maxRunningOperations=16){super({autoStart:!0}),this.subject=subject2,this.predicate=predicate2,this.graph=graph,this.context=context2,this.mediatorQueryOperation=mediatorQueryOperation,this.maxRunningOperations=maxRunningOperations,this.termHashes=new Map,this.runningOperations=[],this.pendingOperations=[],this._push(this.subject,emitFirstSubject)}_end(destroy){for(const it of this.runningOperations)it.destroy();super._end(destroy)}_push(item,pushAsResult=!0){let termString;if(pushAsResult&&(termString=(0,rdf_string_1$7.termToString)(item),this.termHashes.has(termString)))return;const variable=DF$a.variable("b");this.pendingOperations.push({variable,operation:FACTORY.createPath(item,this.predicate,variable,this.graph)}),termString&&(this.termHashes.set(termString,item),super._push(item))}_read(count2,done){const self2=this;(async function(){for(;self2.runningOperations.length<self2.maxRunningOperations&&self2.pendingOperations.length!==0;){const pendingOperation=self2.pendingOperations.pop(),results=bus_query_operation_1$s.ActorQueryOperation.getSafeBindings(await self2.mediatorQueryOperation.mediate({operation:pendingOperation.operation,context:self2.context})),runningOperation=results.bindingsStream.transform({autoStart:!1,transform(bindings,next,push){const newTerm=bindings.get(pendingOperation.variable);push(newTerm),next()}});runningOperation.done||(self2.runningOperations.push(runningOperation),runningOperation.on("error",error=>self2.destroy(error)),runningOperation.on("readable",()=>{self2.readable=!0,self2._fillBufferAsync()}),runningOperation.on("end",()=>{self2.runningOperations.splice(self2.runningOperations.indexOf(runningOperation),1),self2.readable=!0,self2._fillBufferAsync()})),self2.setProperty("metadata",results.metadata)}let lastCount=0,item;for(;lastCount!==(lastCount=count2);)for(let i=0;i<self2.runningOperations.length&&count2>0;i++)(item=self2.runningOperations[i].read())!==null&&(count2--,self2._push(item));self2.runningOperations.length===0&&self2.pendingOperations.length===0&&self2.close()})().then(()=>{done()},error=>this.destroy(error))}}__name(PathVariableObjectIterator,"PathVariableObjectIterator");PathVariableObjectIterator$1.PathVariableObjectIterator=PathVariableObjectIterator;Object.defineProperty(ActorAbstractPath$1,"__esModule",{value:!0});ActorAbstractPath$1.ActorAbstractPath=void 0;const bindings_factory_1$8=lib$2v,bus_query_operation_1$r=lib$2y,context_entries_1$c=lib$2x,asynciterator_1$d=asynciterator,rdf_data_factory_1$9=rdfDataFactory,rdf_string_1$6=rdfString,sparqlalgebrajs_1$i=sparqlalgebrajs,PathVariableObjectIterator_1=PathVariableObjectIterator$1,DF$9=new rdf_data_factory_1$9.DataFactory,BF$8=new bindings_factory_1$8.BindingsFactory;class ActorAbstractPath extends bus_query_operation_1$r.ActorQueryOperationTypedMediated{constructor(args,predicateType){super(args,"path"),this.predicateType=predicateType}async testOperation(operation,context2){if(operation.predicate.type!==this.predicateType)throw new Error(`This Actor only supports ${this.predicateType} Path operations.`);return!0}generateVariable(path,name){return name?path&&(path.subject.value===name||path.object.value===name)?this.generateVariable(path,`${name}b`):DF$9.variable(name):this.generateVariable(path,"b")}async isPathArbitraryLengthDistinct(context2,path){return context2.get(context_entries_1$c.KeysQueryOperation.isPathArbitraryLengthDistinctKey)?(context2=context2.set(context_entries_1$c.KeysQueryOperation.isPathArbitraryLengthDistinctKey,!1),{context:context2,operation:void 0}):(context2=context2.set(context_entries_1$c.KeysQueryOperation.isPathArbitraryLengthDistinctKey,!0),{context:context2,operation:bus_query_operation_1$r.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:ActorAbstractPath.FACTORY.createDistinct(path),context:context2}))})}async predicateStarGraphVariable(subject2,object2,predicate2,graph,context2){const predVar=this.generateVariable(ActorAbstractPath.FACTORY.createPath(subject2,predicate2,object2,graph)),findGraphs=ActorAbstractPath.FACTORY.createUnion([ActorAbstractPath.FACTORY.createPattern(subject2,predVar,object2,graph),ActorAbstractPath.FACTORY.createPattern(object2,predVar,subject2,graph)]),results=bus_query_operation_1$r.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({context:context2,operation:findGraphs})),passedGraphs=new Set;return{bindingsStream:new asynciterator_1$d.MultiTransformIterator(results.bindingsStream,{multiTransform:bindings=>{const graphValue=bindings.get(graph);return passedGraphs.has(graphValue.value)?new asynciterator_1$d.EmptyIterator:(passedGraphs.add(graphValue.value),new asynciterator_1$d.TransformIterator(async()=>{const it=new asynciterator_1$d.BufferedIterator;return await this.getObjectsPredicateStar(subject2,predicate2,graphValue,context2,{},it,{count:0}),it.transform({transform(item,next,push){push(BF$8.bindings([[object2,item],[graph,graphValue]])),next()}})},{maxBufferSize:128}))},autoStart:!1}),metadata:results.metadata}}async getObjectsPredicateStarEval(subject2,predicate2,object2,graph,context2,emitFirstSubject){if(graph.termType==="Variable")return this.predicateStarGraphVariable(subject2,object2,predicate2,graph,context2);const it=new PathVariableObjectIterator_1.PathVariableObjectIterator(subject2,predicate2,graph,context2,this.mediatorQueryOperation,emitFirstSubject);return{bindingsStream:it.transform({autoStart:!1,transform(item,next,push){push(BF$8.bindings([[object2,item]])),next()}}),metadata:()=>new Promise(resolve2=>it.getProperty("metadata",metadata=>resolve2(metadata())))}}async getObjectsPredicateStar(object2,predicate2,graph,context2,termHashes,it,counter){const termString=(0,rdf_string_1$6.termToString)(object2);if(termHashes[termString])return;it._push(object2),termHashes[termString]=object2,counter.count++;const thisVariable=this.generateVariable(),path=ActorAbstractPath.FACTORY.createPath(object2,predicate2,thisVariable,graph),results=bus_query_operation_1$r.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:path,context:context2}));return results.bindingsStream.on("data",async bindings=>{const result=bindings.get(thisVariable);await this.getObjectsPredicateStar(result,predicate2,graph,context2,termHashes,it,counter)}),results.bindingsStream.on("end",()=>{--counter.count===0&&it.close()}),results.metadata}async getSubjectAndObjectBindingsPredicateStar(subjectVar,objectVar,subjectVal,objectVal,predicate2,graph,context2,termHashesGlobal,termHashesCurrentSubject,it,counter){const termString=(0,rdf_string_1$6.termToString)(objectVal)+(0,rdf_string_1$6.termToString)(graph);if(termHashesCurrentSubject[termString])return;if(counter.count++,termHashesCurrentSubject[termString]=!0,it._push(BF$8.bindings([[subjectVar,subjectVal],[objectVar,objectVal]])),termString in termHashesGlobal){const objects=await termHashesGlobal[termString];for(const object2 of objects)await this.getSubjectAndObjectBindingsPredicateStar(subjectVar,objectVar,subjectVal,object2,predicate2,graph,context2,termHashesGlobal,termHashesCurrentSubject,it,counter);--counter.count===0&&it.close();return}const promise=new Promise(async(resolve2,reject)=>{const objectsArray=[],thisVariable=this.generateVariable(),path=ActorAbstractPath.FACTORY.createPath(objectVal,predicate2,thisVariable,graph),results=bus_query_operation_1$r.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:path,context:context2}));results.bindingsStream.on("data",async bindings=>{const result=bindings.get(thisVariable);objectsArray.push(result),await this.getSubjectAndObjectBindingsPredicateStar(subjectVar,objectVar,subjectVal,result,predicate2,graph,context2,termHashesGlobal,termHashesCurrentSubject,it,counter)}),results.bindingsStream.on("error",reject),results.bindingsStream.on("end",()=>{--counter.count===0&&it.close(),resolve2(objectsArray)})});termHashesGlobal[termString]=promise}}__name(ActorAbstractPath,"ActorAbstractPath");ActorAbstractPath$1.ActorAbstractPath=ActorAbstractPath;ActorAbstractPath.FACTORY=new sparqlalgebrajs_1$i.Factory;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorAbstractPath$1,exports),__exportStar(PathVariableObjectIterator$1,exports)})(lib$R);Object.defineProperty(ActorQueryOperationPathAlt$1,"__esModule",{value:!0});ActorQueryOperationPathAlt$1.ActorQueryOperationPathAlt=void 0;const actor_abstract_path_1$7=lib$R,actor_query_operation_union_1=lib$$,bus_query_operation_1$q=lib$2y,asynciterator_1$c=asynciterator,sparqlalgebrajs_1$h=sparqlalgebrajs;class ActorQueryOperationPathAlt extends actor_abstract_path_1$7.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$h.Algebra.types.ALT)}async runOperation(operation,context2){const predicate2=operation.predicate,subOperations=(await Promise.all(predicate2.input.map(subPredicate=>this.mediatorQueryOperation.mediate({context:context2,operation:actor_abstract_path_1$7.ActorAbstractPath.FACTORY.createPath(operation.subject,subPredicate,operation.object,operation.graph)})))).map(bus_query_operation_1$q.ActorQueryOperation.getSafeBindings);return{type:"bindings",bindingsStream:new asynciterator_1$c.UnionIterator(subOperations.map(op=>op.bindingsStream),{autoStart:!1}),metadata:__name(()=>Promise.all(subOperations.map(output=>output.metadata())).then(subMeta=>actor_query_operation_union_1.ActorQueryOperationUnion.unionMetadata(subMeta,!0)),"metadata")}}}__name(ActorQueryOperationPathAlt,"ActorQueryOperationPathAlt");ActorQueryOperationPathAlt$1.ActorQueryOperationPathAlt=ActorQueryOperationPathAlt;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathAlt$1,exports)})(lib$S);var lib$Q={},ActorQueryOperationPathLink$1={};Object.defineProperty(ActorQueryOperationPathLink$1,"__esModule",{value:!0});ActorQueryOperationPathLink$1.ActorQueryOperationPathLink=void 0;const actor_abstract_path_1$6=lib$R,sparqlalgebrajs_1$g=sparqlalgebrajs;class ActorQueryOperationPathLink extends actor_abstract_path_1$6.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$g.Algebra.types.LINK)}async runOperation(operationOriginal,context2){const predicate2=operationOriginal.predicate,operation=actor_abstract_path_1$6.ActorAbstractPath.FACTORY.createPattern(operationOriginal.subject,predicate2.iri,operationOriginal.object,operationOriginal.graph);return this.mediatorQueryOperation.mediate({operation,context:context2})}}__name(ActorQueryOperationPathLink,"ActorQueryOperationPathLink");ActorQueryOperationPathLink$1.ActorQueryOperationPathLink=ActorQueryOperationPathLink;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathLink$1,exports)})(lib$Q);var lib$P={},ActorQueryOperationPathInv$1={};Object.defineProperty(ActorQueryOperationPathInv$1,"__esModule",{value:!0});ActorQueryOperationPathInv$1.ActorQueryOperationPathInv=void 0;const actor_abstract_path_1$5=lib$R,sparqlalgebrajs_1$f=sparqlalgebrajs;class ActorQueryOperationPathInv extends actor_abstract_path_1$5.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$f.Algebra.types.INV)}async runOperation(operation,context2){const predicate2=operation.predicate,invPath=actor_abstract_path_1$5.ActorAbstractPath.FACTORY.createPath(operation.object,predicate2.path,operation.subject,operation.graph);return this.mediatorQueryOperation.mediate({operation:invPath,context:context2})}}__name(ActorQueryOperationPathInv,"ActorQueryOperationPathInv");ActorQueryOperationPathInv$1.ActorQueryOperationPathInv=ActorQueryOperationPathInv;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathInv$1,exports)})(lib$P);var lib$O={},ActorQueryOperationPathNps$1={};Object.defineProperty(ActorQueryOperationPathNps$1,"__esModule",{value:!0});ActorQueryOperationPathNps$1.ActorQueryOperationPathNps=void 0;const actor_abstract_path_1$4=lib$R,bus_query_operation_1$p=lib$2y,sparqlalgebrajs_1$e=sparqlalgebrajs;class ActorQueryOperationPathNps extends actor_abstract_path_1$4.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$e.Algebra.types.NPS)}async runOperation(operation,context2){const predicate2=operation.predicate,blank=this.generateVariable(operation),pattern=actor_abstract_path_1$4.ActorAbstractPath.FACTORY.createPattern(operation.subject,blank,operation.object,operation.graph),output=bus_query_operation_1$p.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:pattern,context:context2}));return{type:"bindings",bindingsStream:output.bindingsStream.transform({filter(bindings){return!predicate2.iris.some(iri=>iri.equals(bindings.get(blank)))},transform(item,next,push){push(item.delete(blank)),next()}}),metadata:output.metadata}}}__name(ActorQueryOperationPathNps,"ActorQueryOperationPathNps");ActorQueryOperationPathNps$1.ActorQueryOperationPathNps=ActorQueryOperationPathNps;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathNps$1,exports)})(lib$O);var lib$N={},ActorQueryOperationPathOneOrMore$1={};Object.defineProperty(ActorQueryOperationPathOneOrMore$1,"__esModule",{value:!0});ActorQueryOperationPathOneOrMore$1.ActorQueryOperationPathOneOrMore=void 0;const actor_abstract_path_1$3=lib$R,bindings_factory_1$7=lib$2v,bus_query_operation_1$o=lib$2y,asynciterator_1$b=asynciterator,sparqlalgebrajs_1$d=sparqlalgebrajs,BF$7=new bindings_factory_1$7.BindingsFactory;class ActorQueryOperationPathOneOrMore extends actor_abstract_path_1$3.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$d.Algebra.types.ONE_OR_MORE_PATH)}async runOperation(operation,context2){const distinct=await this.isPathArbitraryLengthDistinct(context2,operation);if(distinct.operation)return distinct.operation;context2=distinct.context;const predicate2=operation.predicate;if(operation.subject.termType!=="Variable"&&operation.object.termType==="Variable"){const objectVar=operation.object,starEval=await this.getObjectsPredicateStarEval(operation.subject,predicate2.path,objectVar,operation.graph,context2,!1),variables2=operation.graph.termType==="Variable"?[objectVar,operation.graph]:[objectVar];return{type:"bindings",bindingsStream:starEval.bindingsStream,metadata:async()=>({...await starEval.metadata(),variables:variables2})}}if(operation.subject.termType==="Variable"&&operation.object.termType==="Variable"){const single=actor_abstract_path_1$3.ActorAbstractPath.FACTORY.createDistinct(actor_abstract_path_1$3.ActorAbstractPath.FACTORY.createPath(operation.subject,operation.predicate.path,operation.object,operation.graph)),results2=bus_query_operation_1$o.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({context:context2,operation:single})),subjectVar=operation.subject,objectVar=operation.object,termHashes={},bindingsStream2=new asynciterator_1$b.MultiTransformIterator(results2.bindingsStream,{multiTransform:bindings=>{const subject2=bindings.get(subjectVar),object2=bindings.get(objectVar),graph=operation.graph.termType==="Variable"?bindings.get(operation.graph):operation.graph;return new asynciterator_1$b.TransformIterator(async()=>{const it=new asynciterator_1$b.BufferedIterator;return await this.getSubjectAndObjectBindingsPredicateStar(subjectVar,objectVar,subject2,object2,predicate2.path,graph,context2,termHashes,{},it,{count:0}),it.transform({transform(item,next,push){operation.graph.termType==="Variable"&&(item=item.set(operation.graph,graph)),push(item),next()}})},{maxBufferSize:128})},autoStart:!1}),variables2=operation.graph.termType==="Variable"?[subjectVar,objectVar,operation.graph]:[subjectVar,objectVar];return{type:"bindings",bindingsStream:bindingsStream2,metadata:async()=>({...await results2.metadata(),variables:variables2})}}if(operation.subject.termType==="Variable"&&operation.object.termType!=="Variable")return this.mediatorQueryOperation.mediate({context:context2,operation:actor_abstract_path_1$3.ActorAbstractPath.FACTORY.createPath(operation.object,actor_abstract_path_1$3.ActorAbstractPath.FACTORY.createOneOrMorePath(actor_abstract_path_1$3.ActorAbstractPath.FACTORY.createInv(predicate2.path)),operation.subject,operation.graph)});const variable=this.generateVariable(),results=bus_query_operation_1$o.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({context:context2,operation:actor_abstract_path_1$3.ActorAbstractPath.FACTORY.createPath(operation.subject,predicate2,variable,operation.graph)}));return{type:"bindings",bindingsStream:results.bindingsStream.transform({filter:item=>operation.object.equals(item.get(variable)),transform(item,next,push){const binding=operation.graph.termType==="Variable"?BF$7.bindings([[operation.graph,item.get(operation.graph)]]):BF$7.bindings();push(binding),next()}}),metadata:async()=>({...await results.metadata(),variables:operation.graph.termType==="Variable"?[operation.graph]:[]})}}}__name(ActorQueryOperationPathOneOrMore,"ActorQueryOperationPathOneOrMore");ActorQueryOperationPathOneOrMore$1.ActorQueryOperationPathOneOrMore=ActorQueryOperationPathOneOrMore;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathOneOrMore$1,exports)})(lib$N);var lib$M={},ActorQueryOperationPathZeroOrMore$1={};Object.defineProperty(ActorQueryOperationPathZeroOrMore$1,"__esModule",{value:!0});ActorQueryOperationPathZeroOrMore$1.ActorQueryOperationPathZeroOrMore=void 0;const actor_abstract_path_1$2=lib$R,bindings_factory_1$6=lib$2v,bus_query_operation_1$n=lib$2y,asynciterator_1$a=asynciterator,rdf_string_1$5=rdfString,sparqlalgebrajs_1$c=sparqlalgebrajs,BF$6=new bindings_factory_1$6.BindingsFactory;class ActorQueryOperationPathZeroOrMore extends actor_abstract_path_1$2.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$c.Algebra.types.ZERO_OR_MORE_PATH)}async runOperation(operation,context2){const distinct=await this.isPathArbitraryLengthDistinct(context2,operation);if(distinct.operation)return distinct.operation;context2=distinct.context;const predicate2=operation.predicate,sVar=operation.subject.termType==="Variable",oVar=operation.object.termType==="Variable";if(operation.subject.termType==="Variable"&&operation.object.termType==="Variable"){const predVar=this.generateVariable(operation),single=actor_abstract_path_1$2.ActorAbstractPath.FACTORY.createPattern(operation.subject,predVar,operation.object,operation.graph),results=bus_query_operation_1$n.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({context:context2,operation:single})),subjectVar=operation.subject,objectVar=operation.object,entities=new Set,termHashes={},bindingsStream=new asynciterator_1$a.MultiTransformIterator(results.bindingsStream,{multiTransform:bindings=>{const subject3=bindings.get(subjectVar),object2=bindings.get(objectVar),graph=operation.graph.termType==="Variable"?bindings.get(operation.graph):operation.graph,subjectGraphHash=(0,rdf_string_1$5.termToString)(subject3)+(0,rdf_string_1$5.termToString)(graph),objectGraphHash=(0,rdf_string_1$5.termToString)(object2)+(0,rdf_string_1$5.termToString)(graph);return new asynciterator_1$a.TransformIterator(async()=>{if(entities.has(subjectGraphHash)&&entities.has(objectGraphHash))return new asynciterator_1$a.EmptyIterator;const it=new asynciterator_1$a.BufferedIterator,counter={count:0};return entities.has(subjectGraphHash)||(entities.add(subjectGraphHash),await this.getSubjectAndObjectBindingsPredicateStar(subjectVar,objectVar,subject3,subject3,predicate2.path,graph,context2,termHashes,{},it,counter)),entities.has(objectGraphHash)||(entities.add(objectGraphHash),await this.getSubjectAndObjectBindingsPredicateStar(subjectVar,objectVar,object2,object2,predicate2.path,graph,context2,termHashes,{},it,counter)),it.transform({transform(item,next,push){operation.graph.termType==="Variable"&&(item=item.set(operation.graph,graph)),push(item),next()}})})}}),variables3=operation.graph.termType==="Variable"?[subjectVar,operation.object,operation.graph]:[subjectVar,operation.object];return{type:"bindings",bindingsStream,metadata:async()=>({...await results.metadata(),variables:variables3})}}if(!sVar&&!oVar){const variable=this.generateVariable(),starEval2=await this.getObjectsPredicateStarEval(operation.subject,predicate2.path,variable,operation.graph,context2,!0);return{type:"bindings",bindingsStream:starEval2.bindingsStream.transform({filter:item=>operation.object.equals(item.get(variable)),transform(item,next,push){const binding=operation.graph.termType==="Variable"?BF$6.bindings([[operation.graph,item.get(operation.graph)]]):BF$6.bindings();push(binding),next()}}),metadata:async()=>({...await starEval2.metadata(),variables:operation.graph.termType==="Variable"?[operation.graph]:[]})}}const subject2=sVar?operation.object:operation.subject,value=sVar?operation.subject:operation.object,pred=sVar?actor_abstract_path_1$2.ActorAbstractPath.FACTORY.createInv(predicate2.path):predicate2.path,starEval=await this.getObjectsPredicateStarEval(subject2,pred,value,operation.graph,context2,!0),variables2=operation.graph.termType==="Variable"?[value,operation.graph]:[value];return{type:"bindings",bindingsStream:starEval.bindingsStream,metadata:async()=>({...await starEval.metadata(),variables:variables2})}}}__name(ActorQueryOperationPathZeroOrMore,"ActorQueryOperationPathZeroOrMore");ActorQueryOperationPathZeroOrMore$1.ActorQueryOperationPathZeroOrMore=ActorQueryOperationPathZeroOrMore;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathZeroOrMore$1,exports)})(lib$M);var lib$L={},ActorQueryOperationPathZeroOrOne$1={};Object.defineProperty(ActorQueryOperationPathZeroOrOne$1,"__esModule",{value:!0});ActorQueryOperationPathZeroOrOne$1.ActorQueryOperationPathZeroOrOne=void 0;const actor_abstract_path_1$1=lib$R,bindings_factory_1$5=lib$2v,bus_query_operation_1$m=lib$2y,metadata_1$6=lib$2h,asynciterator_1$9=asynciterator,sparqlalgebrajs_1$b=sparqlalgebrajs,BF$5=new bindings_factory_1$5.BindingsFactory;class ActorQueryOperationPathZeroOrOne extends actor_abstract_path_1$1.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$b.Algebra.types.ZERO_OR_ONE_PATH)}async runOperation(operation,context2){const predicate2=operation.predicate,extra=[];if(operation.subject.termType!=="Variable"&&operation.object.termType!=="Variable"&&operation.subject.equals(operation.object))return{type:"bindings",bindingsStream:new asynciterator_1$9.SingletonIterator(BF$5.bindings()),metadata:()=>Promise.resolve({state:new metadata_1$6.MetadataValidationState,cardinality:{type:"exact",value:1},canContainUndefs:!1,variables:[]})};const distinct=await this.isPathArbitraryLengthDistinct(context2,operation);if(distinct.operation)return distinct.operation;context2=distinct.context;const bindingsOne=bus_query_operation_1$m.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({context:context2,operation:actor_abstract_path_1$1.ActorAbstractPath.FACTORY.createPath(operation.subject,predicate2.path,operation.object,operation.graph)}));let bindingsStream;if(operation.subject.termType==="Variable"&&operation.object.termType==="Variable"){const varP=this.generateVariable(operation),bindingsZero=bus_query_operation_1$m.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({context:context2,operation:actor_abstract_path_1$1.ActorAbstractPath.FACTORY.createFilter(actor_abstract_path_1$1.ActorAbstractPath.FACTORY.createPattern(operation.subject,varP,operation.object,operation.graph),actor_abstract_path_1$1.ActorAbstractPath.FACTORY.createOperatorExpression("=",[actor_abstract_path_1$1.ActorAbstractPath.FACTORY.createTermExpression(operation.subject),actor_abstract_path_1$1.ActorAbstractPath.FACTORY.createTermExpression(operation.object)]))})).bindingsStream.transform({map(bindings){return bindings.delete(varP)},autoStart:!1});bindingsStream=new asynciterator_1$9.UnionIterator([bindingsZero,bindingsOne.bindingsStream],{autoStart:!1})}else operation.subject.termType==="Variable"&&extra.push(BF$5.bindings([[operation.subject,operation.object]])),operation.object.termType==="Variable"&&extra.push(BF$5.bindings([[operation.object,operation.subject]])),bindingsStream=bindingsOne.bindingsStream.prepend(extra);return{type:"bindings",bindingsStream,metadata:bindingsOne.metadata}}}__name(ActorQueryOperationPathZeroOrOne,"ActorQueryOperationPathZeroOrOne");ActorQueryOperationPathZeroOrOne$1.ActorQueryOperationPathZeroOrOne=ActorQueryOperationPathZeroOrOne;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathZeroOrOne$1,exports)})(lib$L);var lib$K={},ActorQueryOperationAddRewrite$1={};Object.defineProperty(ActorQueryOperationAddRewrite$1,"__esModule",{value:!0});ActorQueryOperationAddRewrite$1.ActorQueryOperationAddRewrite=void 0;const bus_query_operation_1$l=lib$2y,rdf_data_factory_1$8=rdfDataFactory,sparqlalgebrajs_1$a=sparqlalgebrajs,DF$8=new rdf_data_factory_1$8.DataFactory;class ActorQueryOperationAddRewrite extends bus_query_operation_1$l.ActorQueryOperationTypedMediated{constructor(args){super(args,"add"),this.factory=new sparqlalgebrajs_1$a.Factory}async testOperation(operation,context2){return bus_query_operation_1$l.ActorQueryOperation.throwOnReadOnly(context2),!0}runOperation(operationOriginal,context2){const destination=operationOriginal.destination==="DEFAULT"?DF$8.defaultGraph():operationOriginal.destination,source=operationOriginal.source==="DEFAULT"?DF$8.defaultGraph():operationOriginal.source,operation=this.factory.createDeleteInsert(void 0,[this.factory.createPattern(DF$8.variable("s"),DF$8.variable("p"),DF$8.variable("o"),destination)],this.factory.createPattern(DF$8.variable("s"),DF$8.variable("p"),DF$8.variable("o"),source));return this.mediatorQueryOperation.mediate({operation,context:context2})}}__name(ActorQueryOperationAddRewrite,"ActorQueryOperationAddRewrite");ActorQueryOperationAddRewrite$1.ActorQueryOperationAddRewrite=ActorQueryOperationAddRewrite;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationAddRewrite$1,exports)})(lib$K);var lib$J={},ActorQueryOperationUpdateCompositeUpdate$1={};Object.defineProperty(ActorQueryOperationUpdateCompositeUpdate$1,"__esModule",{value:!0});ActorQueryOperationUpdateCompositeUpdate$1.ActorQueryOperationUpdateCompositeUpdate=void 0;const bus_query_operation_1$k=lib$2y;class ActorQueryOperationUpdateCompositeUpdate extends bus_query_operation_1$k.ActorQueryOperationTypedMediated{constructor(args){super(args,"compositeupdate")}async testOperation(operation,context2){return bus_query_operation_1$k.ActorQueryOperation.throwOnReadOnly(context2),!0}async runOperation(operationOriginal,context2){return{type:"void",execute:__name(()=>(async()=>{for(const operation of operationOriginal.updates)await bus_query_operation_1$k.ActorQueryOperation.getSafeVoid(await this.mediatorQueryOperation.mediate({operation,context:context2})).execute()})(),"execute")}}}__name(ActorQueryOperationUpdateCompositeUpdate,"ActorQueryOperationUpdateCompositeUpdate");ActorQueryOperationUpdateCompositeUpdate$1.ActorQueryOperationUpdateCompositeUpdate=ActorQueryOperationUpdateCompositeUpdate;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationUpdateCompositeUpdate$1,exports)})(lib$J);var lib$I={},ActorQueryOperationCopyRewrite$1={};Object.defineProperty(ActorQueryOperationCopyRewrite$1,"__esModule",{value:!0});ActorQueryOperationCopyRewrite$1.ActorQueryOperationCopyRewrite=void 0;const bus_query_operation_1$j=lib$2y,sparqlalgebrajs_1$9=sparqlalgebrajs;class ActorQueryOperationCopyRewrite extends bus_query_operation_1$j.ActorQueryOperationTypedMediated{constructor(args){super(args,"copy"),this.factory=new sparqlalgebrajs_1$9.Factory}async testOperation(operation,context2){return bus_query_operation_1$j.ActorQueryOperation.throwOnReadOnly(context2),!0}runOperation(operationOriginal,context2){if(typeof operationOriginal.destination=="string"&&typeof operationOriginal.source=="string"&&operationOriginal.destination===operationOriginal.source||typeof operationOriginal.destination!="string"&&typeof operationOriginal.source!="string"&&operationOriginal.destination.equals(operationOriginal.source))return Promise.resolve({type:"void",execute:()=>Promise.resolve()});const operation=this.factory.createCompositeUpdate([this.factory.createDrop(operationOriginal.destination,!0),this.factory.createAdd(operationOriginal.source,operationOriginal.destination,operationOriginal.silent)]);return this.mediatorQueryOperation.mediate({operation,context:context2})}}__name(ActorQueryOperationCopyRewrite,"ActorQueryOperationCopyRewrite");ActorQueryOperationCopyRewrite$1.ActorQueryOperationCopyRewrite=ActorQueryOperationCopyRewrite;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationCopyRewrite$1,exports)})(lib$I);var lib$H={},ActorQueryOperationMoveRewrite$1={};Object.defineProperty(ActorQueryOperationMoveRewrite$1,"__esModule",{value:!0});ActorQueryOperationMoveRewrite$1.ActorQueryOperationMoveRewrite=void 0;const bus_query_operation_1$i=lib$2y,sparqlalgebrajs_1$8=sparqlalgebrajs;class ActorQueryOperationMoveRewrite extends bus_query_operation_1$i.ActorQueryOperationTypedMediated{constructor(args){super(args,"move"),this.factory=new sparqlalgebrajs_1$8.Factory}async testOperation(operation,context2){return bus_query_operation_1$i.ActorQueryOperation.throwOnReadOnly(context2),!0}runOperation(operationOriginal,context2){if(typeof operationOriginal.destination=="string"&&typeof operationOriginal.source=="string"&&operationOriginal.destination===operationOriginal.source||typeof operationOriginal.destination!="string"&&typeof operationOriginal.source!="string"&&operationOriginal.destination.equals(operationOriginal.source))return Promise.resolve({type:"void",execute:()=>Promise.resolve()});const updates=[this.factory.createDrop(operationOriginal.destination,!0),this.factory.createAdd(operationOriginal.source,operationOriginal.destination,operationOriginal.silent),this.factory.createDrop(operationOriginal.source)],operation=this.factory.createCompositeUpdate(updates);return this.mediatorQueryOperation.mediate({operation,context:context2})}}__name(ActorQueryOperationMoveRewrite,"ActorQueryOperationMoveRewrite");ActorQueryOperationMoveRewrite$1.ActorQueryOperationMoveRewrite=ActorQueryOperationMoveRewrite;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationMoveRewrite$1,exports)})(lib$H);var lib$G={},ActionObserverHttp$3={};Object.defineProperty(ActionObserverHttp$3,"__esModule",{value:!0});ActionObserverHttp$3.ActionObserverHttp=void 0;const core_1$3=lib$2A;let ActionObserverHttp$2=__name(class extends core_1$3.ActionObserver{constructor(args){super(args),this.requests=0,this.bus.subscribeObserver(this),this.httpInvalidator.addInvalidateListener(()=>{this.requests=0})}onRun(actor,action,output){this.requests++}},"ActionObserverHttp");ActionObserverHttp$3.ActionObserverHttp=ActionObserverHttp$2;var ActorQueryResultSerializeSparqlJson$1={};Object.defineProperty(ActorQueryResultSerializeSparqlJson$1,"__esModule",{value:!0});ActorQueryResultSerializeSparqlJson$1.ActorQueryResultSerializeSparqlJson=void 0;const bus_query_result_serialize_1$2=lib$2b,readable_stream_1$6=browserExports$1;class ActorQueryResultSerializeSparqlJson extends bus_query_result_serialize_1$2.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}static bindingToJsonBindings(value){if(value.termType==="Literal"){const literal=value,jsonValue={value:literal.value,type:"literal"},{language:language2}=literal,{datatype:datatype2}=literal;return language2?jsonValue["xml:lang"]=language2:datatype2&&datatype2.value!=="http://www.w3.org/2001/XMLSchema#string"&&(jsonValue.datatype=datatype2.value),jsonValue}return value.termType==="BlankNode"?{value:value.value,type:"bnode"}:value.termType==="Quad"?{value:{subject:ActorQueryResultSerializeSparqlJson.bindingToJsonBindings(value.subject),predicate:ActorQueryResultSerializeSparqlJson.bindingToJsonBindings(value.predicate),object:ActorQueryResultSerializeSparqlJson.bindingToJsonBindings(value.object)},type:"triple"}:{value:value.value,type:"uri"}}async testHandleChecked(action,context2){if(!["bindings","boolean"].includes(action.type))throw new Error("This actor can only handle bindings streams or booleans.");return!0}async runHandle(action,mediaType,context2){const data=new readable_stream_1$6.Readable;data._read=()=>{};const head2={};if(action.type==="bindings"){const metadata=await action.metadata();metadata.variables.length>0&&(head2.vars=metadata.variables.map(variable=>variable.value))}data.push(`{"head": ${JSON.stringify(head2)},
`);let empty=!0;if(action.type==="bindings"){const resultStream=action.bindingsStream;resultStream.on("error",error=>{data.emit("error",error)}),resultStream.on("data",bindings=>{empty?data.push(`"results": { "bindings": [
`):data.push(`,
`);const bindingsJson=Object.fromEntries([...bindings].map(([key,value])=>[key.value,ActorQueryResultSerializeSparqlJson.bindingToJsonBindings(value)]));data.push(JSON.stringify(bindingsJson)),empty=!1}),resultStream.on("end",()=>{empty&&data.push(`"results": { "bindings": [
`),data.push(`
]}`),this.emitMetadata&&data.push(`,
"metadata": { "httpRequests": ${this.httpObserver.requests} }`),data.push(`}
`),data.push(null)})}else try{data.push(`"boolean":${await action.execute()}
}
`),data.push(null)}catch(error){data.once("newListener",()=>data.emit("error",error))}return{data}}}__name(ActorQueryResultSerializeSparqlJson,"ActorQueryResultSerializeSparqlJson");ActorQueryResultSerializeSparqlJson$1.ActorQueryResultSerializeSparqlJson=ActorQueryResultSerializeSparqlJson;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActionObserverHttp$3,exports),__exportStar(ActorQueryResultSerializeSparqlJson$1,exports)})(lib$G);var lib$F={},ActionObserverHttp$1={};Object.defineProperty(ActionObserverHttp$1,"__esModule",{value:!0});ActionObserverHttp$1.ActionObserverHttp=void 0;const core_1$2=lib$2A;class ActionObserverHttp2 extends core_1$2.ActionObserver{constructor(args){super(args),this.requests=0,this.bus.subscribeObserver(this),this.httpInvalidator.addInvalidateListener(()=>{this.requests=0})}onRun(actor,action,output){this.requests++}}__name(ActionObserverHttp2,"ActionObserverHttp");ActionObserverHttp$1.ActionObserverHttp=ActionObserverHttp2;var ActorQueryResultSerializeStats$1={};Object.defineProperty(ActorQueryResultSerializeStats$1,"__esModule",{value:!0});ActorQueryResultSerializeStats$1.ActorQueryResultSerializeStats=void 0;const bus_query_result_serialize_1$1=lib$2b,readable_stream_1$5=browserExports$1,process$1=browserExports;class ActorQueryResultSerializeStats extends bus_query_result_serialize_1$1.ActorQueryResultSerializeFixedMediaTypes{constructor(args){super(args)}async testHandleChecked(action,context2){if(!["bindings","quads"].includes(action.type))throw new Error("This actor can only handle bindings streams or quad streams.");return!0}pushHeader(data){const header=["Result","Delay (ms)","HTTP requests"].join(",");data.push(`${header}
`)}pushStat(data,startTime,result){const row=[result,this.delay(startTime),this.httpObserver.requests].join(",");data.push(`${row}
`)}pushFooter(data,startTime){const footer=["TOTAL",this.delay(startTime),this.httpObserver.requests].join(",");data.push(`${footer}
`),data.push(null)}async runHandle(action,mediaType,context2){const data=new readable_stream_1$5.Readable;data._read=()=>{};const resultStream=action.type==="bindings"?action.bindingsStream:action.quadStream,startTime=this.now();let result=1;return this.pushHeader(data),resultStream.on("error",error=>data.emit("error",error)),resultStream.on("data",()=>this.pushStat(data,startTime,result++)),resultStream.on("end",()=>this.pushFooter(data,startTime)),{data}}now(){if(typeof performance>"u"){const time=process$1.hrtime();return time[0]*1e3+time[1]/1e6}return performance.now()}delay(startTime){return this.now()-startTime}}__name(ActorQueryResultSerializeStats,"ActorQueryResultSerializeStats");ActorQueryResultSerializeStats$1.ActorQueryResultSerializeStats=ActorQueryResultSerializeStats;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActionObserverHttp$1,exports),__exportStar(ActorQueryResultSerializeStats$1,exports)})(lib$F);var lib$E={},ActorQueryResultSerializeRdf$1={};Object.defineProperty(ActorQueryResultSerializeRdf$1,"__esModule",{value:!0});ActorQueryResultSerializeRdf$1.ActorQueryResultSerializeRdf=void 0;const bus_query_result_serialize_1=lib$2b;class ActorQueryResultSerializeRdf extends bus_query_result_serialize_1.ActorQueryResultSerialize{constructor(args){super(args)}async testHandle(action,mediaType,context2){if(action.type!=="quads")throw new Error(`Actor ${this.name} can only handle quad streams`);const{mediaTypes}=await this.mediatorMediaTypeCombiner.mediate({context:context2,mediaTypes:!0});if(!(mediaType in mediaTypes))throw new Error(`Actor ${this.name} can not handle media type ${mediaType}. All available types: ${Object.keys(mediaTypes)}`);return!0}async runHandle(action,mediaType,context2){return(await this.mediatorRdfSerialize.mediate({context:context2,handle:{context:context2,quadStream:action.quadStream},handleMediaType:mediaType})).handle}async testMediaType(context2){return!0}async getMediaTypes(context2){return(await this.mediatorMediaTypeCombiner.mediate({context:context2,mediaTypes:!0})).mediaTypes}async testMediaTypeFormats(context2){return!0}async getMediaTypeFormats(context2){return(await this.mediatorMediaTypeFormatCombiner.mediate({context:context2,mediaTypeFormats:!0})).mediaTypeFormats}}__name(ActorQueryResultSerializeRdf,"ActorQueryResultSerializeRdf");ActorQueryResultSerializeRdf$1.ActorQueryResultSerializeRdf=ActorQueryResultSerializeRdf;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryResultSerializeRdf$1,exports)})(lib$E);var lib$D={},ActorHttpWayback$1={};Object.defineProperty(ActorHttpWayback$1,"__esModule",{value:!0});ActorHttpWayback$1.ActorHttpWayback=void 0;const bus_http_1$5=lib$1Y,context_entries_1$b=lib$2x,stringifyStream$6=streamToString$1,WAYBACK_URL="http://wayback.archive-it.org/";function addWayback(action){const request=new Request(action.input,action.init);return{input:new Request(new URL(`/${request.url}`,WAYBACK_URL),request)}}__name(addWayback,"addWayback");function getProxyHandler(context2){const handler2=context2.get(context_entries_1$b.KeysHttpProxy.httpProxyHandler);return handler2?action=>handler2.getProxy(addWayback(action)):action=>Promise.resolve(addWayback(action))}__name(getProxyHandler,"getProxyHandler");class ActorHttpWayback extends bus_http_1$5.ActorHttp{constructor(args){super(args)}async test(action){return!0}async run(action){let result=await this.mediatorHttp.mediate(action);if(result.status===404&&action.context.get(context_entries_1$b.KeysHttpWayback.recoverBrokenLinks)){let fallbackResult=await this.mediatorHttp.mediate({...action,context:action.context.set(context_entries_1$b.KeysHttpWayback.recoverBrokenLinks,!1).set(context_entries_1$b.KeysHttpProxy.httpProxyHandler,{getProxy:getProxyHandler(action.context)})});fallbackResult.status===200&&([result,fallbackResult]=[fallbackResult,result]);const{body}=fallbackResult;body&&("destroy"in body&&typeof body.destroy=="function"?body.destroy():await stringifyStream$6(bus_http_1$5.ActorHttp.toNodeReadable(fallbackResult.body)))}return result}}__name(ActorHttpWayback,"ActorHttpWayback");ActorHttpWayback$1.ActorHttpWayback=ActorHttpWayback;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorHttpWayback$1,exports)})(lib$D);var lib$C={},ActorRdfParseJsonLd$1={},jsonldStreamingParser={},JsonLdParser={},EntryHandlerArrayValue$1={},Util7={},EntryHandlerContainer={},ContainerHandlerIdentifier$1={};Object.defineProperty(ContainerHandlerIdentifier$1,"__esModule",{value:!0});ContainerHandlerIdentifier$1.ContainerHandlerIdentifier=void 0;class ContainerHandlerIdentifier{canCombineWithGraph(){return!0}async handle(containers,parsingContext,util2,keys2,value,depth){let id;if(parsingContext.emittedStack[depth+1]&&parsingContext.idStack[depth+1])id=parsingContext.idStack[depth+1][0];else{const maybeId=await util2.getContainerKey(keys2[depth],keys2,depth)!==null?await util2.resourceToTerm(await parsingContext.getContext(keys2),keys2[depth]):util2.dataFactory.blankNode();if(!maybeId){parsingContext.emittedStack[depth]=!1;return}id=maybeId,parsingContext.idStack[depth+1]=[id]}let ids=parsingContext.idStack[depth];ids||(ids=parsingContext.idStack[depth]=[]),ids.some(term=>term.equals(id))||ids.push(id),await parsingContext.handlePendingContainerFlushBuffers()||(parsingContext.emittedStack[depth]=!1)}}__name(ContainerHandlerIdentifier,"ContainerHandlerIdentifier");ContainerHandlerIdentifier$1.ContainerHandlerIdentifier=ContainerHandlerIdentifier;var ContainerHandlerIndex={},EntryHandlerPredicate={},hasRequiredEntryHandlerPredicate;function requireEntryHandlerPredicate(){if(hasRequiredEntryHandlerPredicate)return EntryHandlerPredicate;hasRequiredEntryHandlerPredicate=1,Object.defineProperty(EntryHandlerPredicate,"__esModule",{value:!0}),EntryHandlerPredicate.EntryHandlerPredicate=void 0;const jsonld_context_parser_12=jsonldContextParser,Util_12=requireUtil();let EntryHandlerPredicate$1=__name(class EntryHandlerPredicate2{static async handlePredicateObject(parsingContext,util2,keys2,depth,predicate2,object2,reverse3,isEmbedded,isAnnotation){const depthProperties=await util2.getPropertiesDepth(keys2,depth),depthOffsetGraph=await util2.getDepthOffsetGraph(depth,keys2),depthPropertiesGraph=depth-depthOffsetGraph,subjects=parsingContext.idStack[depthProperties];if(subjects&&!isAnnotation)for(const subject2 of subjects)if(depthOffsetGraph>=0){const graphs=parsingContext.idStack[depthPropertiesGraph-1];if(graphs)for(const graph of graphs)util2.emitQuadChecked(depth,subject2,predicate2,object2,graph,reverse3,isEmbedded);else reverse3?(util2.validateReverseSubject(object2),parsingContext.getUnidentifiedGraphBufferSafe(depthPropertiesGraph-1).push({subject:object2,predicate:predicate2,object:subject2,isEmbedded})):parsingContext.getUnidentifiedGraphBufferSafe(depthPropertiesGraph-1).push({subject:subject2,predicate:predicate2,object:object2,isEmbedded})}else{const graph=await util2.getGraphContainerValue(keys2,depthProperties);util2.emitQuadChecked(depth,subject2,predicate2,object2,graph,reverse3,isEmbedded)}else if(reverse3&&util2.validateReverseSubject(object2),isAnnotation){if(parsingContext.rdfstar){parsingContext.idStack[depth]&&parsingContext.emitError(new jsonld_context_parser_12.ErrorCoded(`Found an illegal @id inside an annotation: ${parsingContext.idStack[depth][0].value}`,jsonld_context_parser_12.ERROR_CODES.INVALID_ANNOTATION));for(let i=0;i<depth;i++)await util2.unaliasKeyword(keys2[i],keys2,i)==="@id"&&parsingContext.emitError(new jsonld_context_parser_12.ErrorCoded("Found an illegal annotation inside an embedded node",jsonld_context_parser_12.ERROR_CODES.INVALID_ANNOTATION));const annotationsBuffer=parsingContext.getAnnotationsBufferSafe(depthProperties),newAnnotation={predicate:predicate2,object:object2,reverse:reverse3,nestedAnnotations:[],depth:depthProperties};annotationsBuffer.push(newAnnotation);for(let i=annotationsBuffer.length-2;i>=0;i--){const existingAnnotation=annotationsBuffer[i];existingAnnotation.depth>depthProperties&&(newAnnotation.nestedAnnotations.push(existingAnnotation),annotationsBuffer.splice(i,1))}}}else parsingContext.getUnidentifiedValueBufferSafe(depthProperties).push({predicate:predicate2,object:object2,reverse:reverse3,isEmbedded})}isPropertyHandler(){return!0}isStackProcessor(){return!0}async validate(parsingContext,util2,keys2,depth,inProperty){const key=keys2[depth];if(key){const context2=await parsingContext.getContext(keys2);if(!parsingContext.jsonLiteralStack[depth]&&await util2.predicateToTerm(context2,keys2[depth]))return Util_12.Util.getContextValueType(context2,key)==="@json"&&(parsingContext.jsonLiteralStack[depth+1]=!0),!0}return!1}async test(parsingContext,util2,key,keys2,depth){return keys2[depth]}async handle(parsingContext,util2,key,keys2,value,depth,testResult){const keyOriginal=keys2[depth],context2=await parsingContext.getContext(keys2),predicate2=await util2.predicateToTerm(context2,key);if(predicate2){const objects=await util2.valueToTerm(context2,key,value,depth,keys2);if(objects.length)for(let object2 of objects){let parentKey=await util2.unaliasKeywordParent(keys2,depth);const reverse3=Util_12.Util.isPropertyReverse(context2,keyOriginal,parentKey);let parentDepthOffset=0;for(;parentKey==="@reverse"||typeof parentKey=="number";)typeof parentKey=="number"?parentDepthOffset++:depth--,parentKey=await util2.unaliasKeywordParent(keys2,depth-parentDepthOffset);const isEmbedded=Util_12.Util.isPropertyInEmbeddedNode(parentKey);util2.validateReverseInEmbeddedNode(key,reverse3,isEmbedded);const isAnnotation=Util_12.Util.isPropertyInAnnotationObject(parentKey);if(value){const listValueContainer="@list"in Util_12.Util.getContextValueContainer(context2,key);if(listValueContainer||value["@list"]){if((listValueContainer&&!Array.isArray(value)&&!value["@list"]||value["@list"]&&!Array.isArray(value["@list"]))&&object2!==util2.rdfNil){const listPointer=util2.dataFactory.blankNode();parsingContext.emitQuad(depth,util2.dataFactory.quad(listPointer,util2.rdfRest,util2.rdfNil,util2.getDefaultGraph())),parsingContext.emitQuad(depth,util2.dataFactory.quad(listPointer,util2.rdfFirst,object2,util2.getDefaultGraph())),object2=listPointer}if(reverse3&&!parsingContext.allowSubjectList)throw new jsonld_context_parser_12.ErrorCoded(`Found illegal list value in subject position at ${key}`,jsonld_context_parser_12.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}}await EntryHandlerPredicate2.handlePredicateObject(parsingContext,util2,keys2,depth,predicate2,object2,reverse3,isEmbedded,isAnnotation)}}}},"EntryHandlerPredicate");return EntryHandlerPredicate.EntryHandlerPredicate=EntryHandlerPredicate$1,EntryHandlerPredicate}__name(requireEntryHandlerPredicate,"requireEntryHandlerPredicate");var hasRequiredContainerHandlerIndex;function requireContainerHandlerIndex(){if(hasRequiredContainerHandlerIndex)return ContainerHandlerIndex;hasRequiredContainerHandlerIndex=1,Object.defineProperty(ContainerHandlerIndex,"__esModule",{value:!0}),ContainerHandlerIndex.ContainerHandlerIndex=void 0;const jsonld_context_parser_12=jsonldContextParser,EntryHandlerPredicate_12=requireEntryHandlerPredicate(),Util_12=requireUtil();let ContainerHandlerIndex$1=__name(class{canCombineWithGraph(){return!0}async handle(containers,parsingContext,util2,keys2,value,depth){if(!Array.isArray(value)){const graphContainer="@graph"in containers,context2=await parsingContext.getContext(keys2),indexKey=keys2[depth-1],indexPropertyRaw=Util_12.Util.getContextValueIndex(context2,indexKey);if(indexPropertyRaw){if(jsonld_context_parser_12.Util.isPotentialKeyword(indexPropertyRaw))throw new jsonld_context_parser_12.ErrorCoded(`Keywords can not be used as @index value, got: ${indexPropertyRaw}`,jsonld_context_parser_12.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof indexPropertyRaw!="string")throw new jsonld_context_parser_12.ErrorCoded(`@index values must be strings, got: ${indexPropertyRaw}`,jsonld_context_parser_12.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof value!="object"){if(Util_12.Util.getContextValueType(context2,indexKey)!=="@id")throw new jsonld_context_parser_12.ErrorCoded(`Property-based index containers require nodes as values or strings with @type: @id, but got: ${value}`,jsonld_context_parser_12.ERROR_CODES.INVALID_VALUE_OBJECT);const id=util2.resourceToTerm(context2,value);id&&(parsingContext.idStack[depth+1]=[id])}const indexProperty=util2.createVocabOrBaseTerm(context2,indexPropertyRaw);if(indexProperty){const indexValues=await util2.valueToTerm(context2,indexPropertyRaw,await util2.getContainerKey(keys2[depth],keys2,depth),depth,keys2);if(graphContainer){const graphId=await util2.getGraphContainerValue(keys2,depth+1);for(const indexValue of indexValues)parsingContext.emitQuad(depth,util2.dataFactory.quad(graphId,indexProperty,indexValue,util2.getDefaultGraph()))}else for(const indexValue of indexValues)await EntryHandlerPredicate_12.EntryHandlerPredicate.handlePredicateObject(parsingContext,util2,keys2,depth+1,indexProperty,indexValue,!1,!1,!1)}}const depthOffset=graphContainer?2:1;await parsingContext.newOnValueJob(keys2.slice(0,keys2.length-depthOffset),value,depth-depthOffset,!0),await parsingContext.handlePendingContainerFlushBuffers()}parsingContext.emittedStack[depth]=!1}},"ContainerHandlerIndex");return ContainerHandlerIndex.ContainerHandlerIndex=ContainerHandlerIndex$1,ContainerHandlerIndex}__name(requireContainerHandlerIndex,"requireContainerHandlerIndex");var ContainerHandlerLanguage$1={};Object.defineProperty(ContainerHandlerLanguage$1,"__esModule",{value:!0});ContainerHandlerLanguage$1.ContainerHandlerLanguage=void 0;const jsonld_context_parser_1$9=jsonldContextParser;class ContainerHandlerLanguage{canCombineWithGraph(){return!1}async handle(containers,parsingContext,util2,keys2,value,depth){const language2=await util2.getContainerKey(keys2[depth],keys2,depth);if(Array.isArray(value))value=value.map(subValue=>({"@value":subValue,"@language":language2}));else{if(typeof value!="string")throw new jsonld_context_parser_1$9.ErrorCoded(`Got invalid language map value, got '${JSON.stringify(value)}', but expected string`,jsonld_context_parser_1$9.ERROR_CODES.INVALID_LANGUAGE_MAP_VALUE);value={"@value":value,"@language":language2}}await parsingContext.newOnValueJob(keys2.slice(0,keys2.length-1),value,depth-1,!0),parsingContext.emittedStack[depth]=!1}}__name(ContainerHandlerLanguage,"ContainerHandlerLanguage");ContainerHandlerLanguage$1.ContainerHandlerLanguage=ContainerHandlerLanguage;var ContainerHandlerType={},hasRequiredContainerHandlerType;function requireContainerHandlerType(){if(hasRequiredContainerHandlerType)return ContainerHandlerType;hasRequiredContainerHandlerType=1,Object.defineProperty(ContainerHandlerType,"__esModule",{value:!0}),ContainerHandlerType.ContainerHandlerType=void 0;const EntryHandlerPredicate_12=requireEntryHandlerPredicate(),Util_12=requireUtil();let ContainerHandlerType$1=__name(class{canCombineWithGraph(){return!1}async handle(containers,parsingContext,util2,keys2,value,depth){if(!Array.isArray(value)){if(typeof value=="string"){const context2=await parsingContext.getContext(keys2),id=Util_12.Util.getContextValueType(context2,keys2[depth-1])==="@vocab"?await util2.createVocabOrBaseTerm(context2,value):await util2.resourceToTerm(context2,value);if(id){const subValue={"@id":id.termType==="NamedNode"?id.value:value};await parsingContext.newOnValueJob(keys2.slice(0,keys2.length-1),subValue,depth-1,!0),parsingContext.idStack[depth+1]=[id]}}else{const entryHasIdentifier=!!parsingContext.idStack[depth+1];entryHasIdentifier||delete parsingContext.idStack[depth],await parsingContext.newOnValueJob(keys2.slice(0,keys2.length-1),value,depth-1,!0),entryHasIdentifier||(parsingContext.idStack[depth+1]=parsingContext.idStack[depth])}const keyOriginal=await util2.getContainerKey(keys2[depth],keys2,depth),type=keyOriginal!==null?util2.createVocabOrBaseTerm(await parsingContext.getContext(keys2),keyOriginal):null;type&&await EntryHandlerPredicate_12.EntryHandlerPredicate.handlePredicateObject(parsingContext,util2,keys2,depth+1,util2.rdfType,type,!1,!1,!1),await parsingContext.handlePendingContainerFlushBuffers()}parsingContext.emittedStack[depth]=!1}},"ContainerHandlerType");return ContainerHandlerType.ContainerHandlerType=ContainerHandlerType$1,ContainerHandlerType}__name(requireContainerHandlerType,"requireContainerHandlerType");var hasRequiredEntryHandlerContainer;function requireEntryHandlerContainer(){if(hasRequiredEntryHandlerContainer)return EntryHandlerContainer;hasRequiredEntryHandlerContainer=1,Object.defineProperty(EntryHandlerContainer,"__esModule",{value:!0}),EntryHandlerContainer.EntryHandlerContainer=void 0;const ContainerHandlerIdentifier_1=ContainerHandlerIdentifier$1,ContainerHandlerIndex_1=requireContainerHandlerIndex(),ContainerHandlerLanguage_1=ContainerHandlerLanguage$1,ContainerHandlerType_1=requireContainerHandlerType(),Util_12=requireUtil();let EntryHandlerContainer$1=__name(class EntryHandlerContainer2{static isSimpleGraphContainer(containers){return"@graph"in containers&&("@set"in containers&&Object.keys(containers).length===2||Object.keys(containers).length===1)}static isComplexGraphContainer(containers){return"@graph"in containers&&("@set"in containers&&Object.keys(containers).length>2||!("@set"in containers)&&Object.keys(containers).length>1)}static getContainerGraphIndex(containers,depth,keys2){let isSimpleGraphContainer=EntryHandlerContainer2.isSimpleGraphContainer(containers),index="";for(let i=depth;i<keys2.length;i++)(!isSimpleGraphContainer||typeof keys2[i]=="number")&&(index+=":"+keys2[i]),!isSimpleGraphContainer&&typeof keys2[i]!="number"&&(isSimpleGraphContainer=!0);return index}static async getContainerHandler(parsingContext,keys2,depth){const fallback={containers:{"@set":!0},depth,fallback:!0};let checkGraphContainer=!1;const context2=await parsingContext.getContext(keys2,2);for(let i=depth-1;i>=0;i--)if(typeof keys2[i]!="number"){const containersSelf=Util_12.Util.getContextValue(context2,"@container",keys2[i],!1);if(containersSelf&&EntryHandlerContainer2.isSimpleGraphContainer(containersSelf))return{containers:containersSelf,depth:i+1,fallback:!1};const containersParent=Util_12.Util.getContextValue(context2,"@container",keys2[i-1],!1);if(containersParent){const graphContainer="@graph"in containersParent;for(const containerHandleName in EntryHandlerContainer2.CONTAINER_HANDLERS)if(containersParent[containerHandleName])return graphContainer?EntryHandlerContainer2.CONTAINER_HANDLERS[containerHandleName].canCombineWithGraph()?{containers:containersParent,depth:i,fallback:!1}:fallback:checkGraphContainer?fallback:{containers:containersParent,depth:i,fallback:!1};return fallback}else{if(checkGraphContainer)return fallback;checkGraphContainer=!0}}return fallback}static async isBufferableContainerHandler(parsingContext,keys2,depth){const handler2=await EntryHandlerContainer2.getContainerHandler(parsingContext,keys2,depth);return!handler2.fallback&&!("@graph"in handler2.containers)}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(parsingContext,util2,keys2,depth,inProperty){return!!await this.test(parsingContext,util2,null,keys2,depth)}async test(parsingContext,util2,key,keys2,depth){const containers=Util_12.Util.getContextValueContainer(await parsingContext.getContext(keys2,2),keys2[depth-1]);for(const containerName in EntryHandlerContainer2.CONTAINER_HANDLERS)if(containers[containerName])return{containers,handler:EntryHandlerContainer2.CONTAINER_HANDLERS[containerName]};return null}async handle(parsingContext,util2,key,keys2,value,depth,testResult){return testResult.handler.handle(testResult.containers,parsingContext,util2,keys2,value,depth)}},"EntryHandlerContainer");return EntryHandlerContainer.EntryHandlerContainer=EntryHandlerContainer$1,EntryHandlerContainer$1.CONTAINER_HANDLERS={"@id":new ContainerHandlerIdentifier_1.ContainerHandlerIdentifier,"@index":new ContainerHandlerIndex_1.ContainerHandlerIndex,"@language":new ContainerHandlerLanguage_1.ContainerHandlerLanguage,"@type":new ContainerHandlerType_1.ContainerHandlerType},EntryHandlerContainer}__name(requireEntryHandlerContainer,"requireEntryHandlerContainer");var canonicalize=__name(function serialize3(object2){return object2===null||typeof object2!="object"||object2.toJSON!=null?JSON.stringify(object2):Array.isArray(object2)?"["+object2.reduce((t,cv,ci)=>{const comma=ci===0?"":",",value=cv===void 0||typeof cv=="symbol"?null:cv;return t+comma+serialize3(value)},"")+"]":"{"+Object.keys(object2).sort().reduce((t,cv,ci)=>{if(object2[cv]===void 0||typeof object2[cv]=="symbol")return t;const comma=t.length===0?"":",";return t+comma+serialize3(cv)+":"+serialize3(object2[cv])},"")+"}"},"serialize"),hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return Util7;hasRequiredUtil=1,Object.defineProperty(Util7,"__esModule",{value:!0}),Util7.Util=void 0;const jsonld_context_parser_12=jsonldContextParser,rdf_data_factory_12=rdfDataFactory,EntryHandlerContainer_1=requireEntryHandlerContainer(),canonicalizeJson=canonicalize;let Util$12=__name(class Util8{constructor(options){this.parsingContext=options.parsingContext,this.dataFactory=options.dataFactory||new rdf_data_factory_12.DataFactory,this.rdfFirst=this.dataFactory.namedNode(Util8.RDF+"first"),this.rdfRest=this.dataFactory.namedNode(Util8.RDF+"rest"),this.rdfNil=this.dataFactory.namedNode(Util8.RDF+"nil"),this.rdfType=this.dataFactory.namedNode(Util8.RDF+"type"),this.rdfJson=this.dataFactory.namedNode(Util8.RDF+"JSON")}static getContextValue(context2,contextKey,key,fallback){const entry=context2.getContextRaw()[key];if(!entry)return fallback;const type=entry[contextKey];return type===void 0?fallback:type}static getContextValueContainer(context2,key){return Util8.getContextValue(context2,"@container",key,{"@set":!0})}static getContextValueType(context2,key){const valueType=Util8.getContextValue(context2,"@type",key,null);return valueType==="@none"?null:valueType}static getContextValueLanguage(context2,key){return Util8.getContextValue(context2,"@language",key,context2.getContextRaw()["@language"]||null)}static getContextValueDirection(context2,key){return Util8.getContextValue(context2,"@direction",key,context2.getContextRaw()["@direction"]||null)}static isContextValueReverse(context2,key){return!!Util8.getContextValue(context2,"@reverse",key,null)}static getContextValueIndex(context2,key){return Util8.getContextValue(context2,"@index",key,context2.getContextRaw()["@index"]||null)}static isPropertyReverse(context2,key,parentKey){return parentKey==="@reverse"!==Util8.isContextValueReverse(context2,key)}static isPropertyInEmbeddedNode(parentKey){return parentKey==="@id"}static isPropertyInAnnotationObject(parentKey){return parentKey==="@annotation"}static isValidIri(iri){return iri!==null&&jsonld_context_parser_12.Util.isValidIri(iri)}static isPrefixArray(needle,haystack){if(needle.length>haystack.length)return!1;for(let i=0;i<needle.length;i++)if(needle[i]!==haystack[i])return!1;return!0}async validateValueIndexes(value){if(this.parsingContext.validateValueIndexes){const indexHashes={};for(const entry of value)if(entry&&typeof entry=="object"){const id=entry["@id"],index=entry["@index"];if(id&&index){const existingIndexValue=indexHashes[id];if(existingIndexValue&&existingIndexValue!==index)throw new jsonld_context_parser_12.ErrorCoded(`Conflicting @index value for ${id}`,jsonld_context_parser_12.ERROR_CODES.CONFLICTING_INDEXES);indexHashes[id]=index}}}}async valueToTerm(context2,key,value,depth,keys2){if(Util8.getContextValueType(context2,key)==="@json")return[this.dataFactory.literal(this.valueToJsonString(value),this.rdfJson)];const type=typeof value;switch(type){case"object":if(value==null)return[];if(Array.isArray(value))return"@list"in Util8.getContextValueContainer(context2,key)?value.length===0?[this.rdfNil]:this.parsingContext.idStack[depth+1]||[]:(await this.validateValueIndexes(value),[]);if(context2=await this.getContextSelfOrPropertyScoped(context2,key),"@context"in value&&(context2=await this.parsingContext.parseContext(value["@context"],(await this.parsingContext.getContext(keys2,0)).getContextRaw())),value=await this.unaliasKeywords(value,keys2,depth,context2),"@value"in value){let val,valueLanguage,valueDirection,valueType,valueIndex;for(key in value){const subValue=value[key];switch(key){case"@value":val=subValue;break;case"@language":valueLanguage=subValue;break;case"@direction":valueDirection=subValue;break;case"@type":valueType=subValue;break;case"@index":valueIndex=subValue;break;case"@annotation":break;default:throw new jsonld_context_parser_12.ErrorCoded(`Unknown value entry '${key}' in @value: ${JSON.stringify(value)}`,jsonld_context_parser_12.ERROR_CODES.INVALID_VALUE_OBJECT)}}if(await this.unaliasKeyword(valueType,keys2,depth,!0,context2)==="@json")return[this.dataFactory.literal(this.valueToJsonString(val),this.rdfJson)];if(val===null)return[];if(typeof val=="object")throw new jsonld_context_parser_12.ErrorCoded(`The value of an '@value' can not be an object, got '${JSON.stringify(val)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_VALUE_OBJECT_VALUE);if(this.parsingContext.validateValueIndexes&&valueIndex&&typeof valueIndex!="string")throw new jsonld_context_parser_12.ErrorCoded(`The value of an '@index' must be a string, got '${JSON.stringify(valueIndex)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_INDEX_VALUE);if(valueLanguage){if(typeof val!="string")throw new jsonld_context_parser_12.ErrorCoded(`When an '@language' is set, the value of '@value' must be a string, got '${JSON.stringify(val)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_LANGUAGE_TAGGED_VALUE);if(!jsonld_context_parser_12.ContextParser.validateLanguage(valueLanguage,this.parsingContext.strictValues,jsonld_context_parser_12.ERROR_CODES.INVALID_LANGUAGE_TAGGED_STRING))return[];(this.parsingContext.normalizeLanguageTags||this.parsingContext.activeProcessingMode===1)&&(valueLanguage=valueLanguage.toLowerCase())}if(valueDirection){if(typeof val!="string")throw new Error(`When an '@direction' is set, the value of '@value' must be a string, got '${JSON.stringify(val)}'`);if(!jsonld_context_parser_12.ContextParser.validateDirection(valueDirection,this.parsingContext.strictValues))return[]}if(valueLanguage&&valueDirection&&this.parsingContext.rdfDirection){if(valueType)throw new jsonld_context_parser_12.ErrorCoded(`Can not have '@language', '@direction' and '@type' in a value: '${JSON.stringify(value)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(depth,val,valueLanguage,valueDirection))}else if(valueLanguage){if(valueType)throw new jsonld_context_parser_12.ErrorCoded(`Can not have both '@language' and '@type' in a value: '${JSON.stringify(value)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_VALUE_OBJECT);return[this.dataFactory.literal(val,valueLanguage)]}else if(valueDirection&&this.parsingContext.rdfDirection){if(valueType)throw new jsonld_context_parser_12.ErrorCoded(`Can not have both '@direction' and '@type' in a value: '${JSON.stringify(value)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(depth,val,valueLanguage,valueDirection))}else if(valueType){if(typeof valueType!="string")throw new jsonld_context_parser_12.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(valueType)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_TYPED_VALUE);const typeTerm=this.createVocabOrBaseTerm(context2,valueType);if(!typeTerm)throw new jsonld_context_parser_12.ErrorCoded(`Invalid '@type' value, got '${JSON.stringify(valueType)}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_TYPED_VALUE);if(typeTerm.termType!=="NamedNode")throw new jsonld_context_parser_12.ErrorCoded(`Illegal value type (${typeTerm.termType}): ${valueType}`,jsonld_context_parser_12.ERROR_CODES.INVALID_TYPED_VALUE);return[this.dataFactory.literal(val,typeTerm)]}return await this.valueToTerm(new jsonld_context_parser_12.JsonLdContextNormalized({}),key,val,depth,keys2)}else if("@set"in value){if(Object.keys(value).length>1)throw new jsonld_context_parser_12.ErrorCoded(`Found illegal neighbouring entries next to @set for key: '${key}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);return[]}else if("@list"in value){if(Object.keys(value).length>1)throw new jsonld_context_parser_12.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${key}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);const listValue=value["@list"];return Array.isArray(listValue)?listValue.length===0?[this.rdfNil]:this.parsingContext.idStack[depth+1]||[]:await this.valueToTerm(await this.parsingContext.getContext(keys2),key,listValue,depth-1,keys2.slice(0,-1))}else{if("@reverse"in value&&typeof value["@reverse"]=="boolean")return[];if("@graph"in Util8.getContextValueContainer(await this.parsingContext.getContext(keys2),key)){const graphContainerEntries=this.parsingContext.graphContainerTermStack[depth+1];return graphContainerEntries?Object.values(graphContainerEntries):[this.dataFactory.blankNode()]}else if("@id"in value){if(Object.keys(value).length>1&&(context2=await this.parsingContext.getContext(keys2,0)),"@context"in value&&(context2=await this.parsingContext.parseContext(value["@context"],context2.getContextRaw())),value["@type"]==="@vocab")return this.nullableTermToArray(this.createVocabOrBaseTerm(context2,value["@id"]));{const valueId=value["@id"];let valueTerm;if(typeof valueId=="object")if(this.parsingContext.rdfstar)valueTerm=this.parsingContext.idStack[depth+1][0];else throw new jsonld_context_parser_12.ErrorCoded(`Found illegal @id '${value}'`,jsonld_context_parser_12.ERROR_CODES.INVALID_ID_VALUE);else valueTerm=this.resourceToTerm(context2,valueId);return this.nullableTermToArray(valueTerm)}}else return this.parsingContext.emittedStack[depth+1]||value&&typeof value=="object"&&Object.keys(value).length===0?this.parsingContext.idStack[depth+1]||(this.parsingContext.idStack[depth+1]=[this.dataFactory.blankNode()]):[]}case"string":return this.nullableTermToArray(this.stringValueToTerm(depth,await this.getContextSelfOrPropertyScoped(context2,key),key,value,null));case"boolean":return this.nullableTermToArray(this.stringValueToTerm(depth,await this.getContextSelfOrPropertyScoped(context2,key),key,(!!value).toString(),this.dataFactory.namedNode(Util8.XSD_BOOLEAN)));case"number":return this.nullableTermToArray(this.stringValueToTerm(depth,await this.getContextSelfOrPropertyScoped(context2,key),key,value,this.dataFactory.namedNode(value%1===0&&value<1e21?Util8.XSD_INTEGER:Util8.XSD_DOUBLE)));default:return this.parsingContext.emitError(new Error(`Could not determine the RDF type of a ${type}`)),[]}}async getContextSelfOrPropertyScoped(context2,key){const contextKeyEntry=context2.getContextRaw()[key];return contextKeyEntry&&typeof contextKeyEntry=="object"&&"@context"in contextKeyEntry&&(context2=await this.parsingContext.parseContext(contextKeyEntry,context2.getContextRaw(),!0)),context2}nullableTermToArray(term){return term?[term]:[]}predicateToTerm(context2,key){const expanded=context2.expandTerm(key,!0,this.parsingContext.getExpandOptions());if(!expanded)return null;if(expanded[0]==="_"&&expanded[1]===":")return this.parsingContext.produceGeneralizedRdf?this.dataFactory.blankNode(expanded.substr(2)):null;if(Util8.isValidIri(expanded))return this.dataFactory.namedNode(expanded);if(expanded&&this.parsingContext.strictValues)this.parsingContext.emitError(new jsonld_context_parser_12.ErrorCoded(`Invalid predicate IRI: ${expanded}`,jsonld_context_parser_12.ERROR_CODES.INVALID_IRI_MAPPING));else return null;return null}resourceToTerm(context2,key){if(key.startsWith("_:"))return this.dataFactory.blankNode(key.substr(2));const iri=context2.expandTerm(key,!1,this.parsingContext.getExpandOptions());if(!Util8.isValidIri(iri))if(iri&&this.parsingContext.strictValues)this.parsingContext.emitError(new Error(`Invalid resource IRI: ${iri}`));else return null;return this.dataFactory.namedNode(iri)}createVocabOrBaseTerm(context2,key){if(key.startsWith("_:"))return this.dataFactory.blankNode(key.substr(2));const expandOptions=this.parsingContext.getExpandOptions();let expanded=context2.expandTerm(key,!0,expandOptions);if(expanded===key&&(expanded=context2.expandTerm(key,!1,expandOptions)),!Util8.isValidIri(expanded))if(expanded&&this.parsingContext.strictValues&&!expanded.startsWith("@"))this.parsingContext.emitError(new Error(`Invalid term IRI: ${expanded}`));else return null;return this.dataFactory.namedNode(expanded)}intToString(value,datatype2){return typeof value=="number"?Number.isFinite(value)?value%1===0&&(!datatype2||datatype2.value!==Util8.XSD_DOUBLE)?Number(value).toString():value.toExponential(15).replace(/(\d)0*e\+?/,"$1E"):value>0?"INF":"-INF":value}stringValueToTerm(depth,context2,key,value,defaultDatatype){const contextType=Util8.getContextValueType(context2,key);if(contextType)if(contextType==="@id"){if(!defaultDatatype)return this.resourceToTerm(context2,this.intToString(value,defaultDatatype))}else if(contextType==="@vocab"){if(!defaultDatatype)return this.createVocabOrBaseTerm(context2,this.intToString(value,defaultDatatype))}else defaultDatatype=this.dataFactory.namedNode(contextType);if(!defaultDatatype){const contextLanguage=Util8.getContextValueLanguage(context2,key),contextDirection=Util8.getContextValueDirection(context2,key);return contextDirection&&this.parsingContext.rdfDirection?this.createLanguageDirectionLiteral(depth,this.intToString(value,defaultDatatype),contextLanguage,contextDirection):this.dataFactory.literal(this.intToString(value,defaultDatatype),contextLanguage)}return this.dataFactory.literal(this.intToString(value,defaultDatatype),defaultDatatype)}createLanguageDirectionLiteral(depth,value,language2,direction){if(this.parsingContext.rdfDirection==="i18n-datatype")return language2||(language2=""),this.dataFactory.literal(value,this.dataFactory.namedNode(`https://www.w3.org/ns/i18n#${language2}_${direction}`));{const valueNode=this.dataFactory.blankNode(),graph=this.getDefaultGraph();return this.parsingContext.emitQuad(depth,this.dataFactory.quad(valueNode,this.dataFactory.namedNode(Util8.RDF+"value"),this.dataFactory.literal(value),graph)),language2&&this.parsingContext.emitQuad(depth,this.dataFactory.quad(valueNode,this.dataFactory.namedNode(Util8.RDF+"language"),this.dataFactory.literal(language2),graph)),this.parsingContext.emitQuad(depth,this.dataFactory.quad(valueNode,this.dataFactory.namedNode(Util8.RDF+"direction"),this.dataFactory.literal(direction),graph)),valueNode}}valueToJsonString(value){return canonicalizeJson(value)}async unaliasKeyword(key,keys2,depth,disableCache,context2){if(Number.isInteger(key))return key;if(!disableCache){const cachedUnaliasedKeyword=this.parsingContext.unaliasedKeywordCacheStack[depth];if(cachedUnaliasedKeyword)return cachedUnaliasedKeyword}if(!jsonld_context_parser_12.Util.isPotentialKeyword(key)){context2=context2||await this.parsingContext.getContext(keys2);let unliased=context2.getContextRaw()[key];unliased&&typeof unliased=="object"&&(unliased=unliased["@id"]),jsonld_context_parser_12.Util.isValidKeyword(unliased)&&(key=unliased)}return disableCache?key:this.parsingContext.unaliasedKeywordCacheStack[depth]=key}async unaliasKeywordParent(keys2,depth){return await this.unaliasKeyword(depth>0&&keys2[depth-1],keys2,depth-1)}async unaliasKeywords(hash2,keys2,depth,context2){const newHash={};for(const key in hash2)newHash[await this.unaliasKeyword(key,keys2,depth+1,!0,context2)]=hash2[key];return newHash}async isLiteral(keys2,depth){for(let i=depth;i>=0;i--){if(await this.unaliasKeyword(keys2[i],keys2,i)==="@annotation")return!1;if(this.parsingContext.literalStack[i]||this.parsingContext.jsonLiteralStack[i])return!0}return!1}async getDepthOffsetGraph(depth,keys2){for(let i=depth-1;i>0;i--)if(await this.unaliasKeyword(keys2[i],keys2,i)==="@graph"){const containers=(await EntryHandlerContainer_1.EntryHandlerContainer.getContainerHandler(this.parsingContext,keys2,i)).containers;return EntryHandlerContainer_1.EntryHandlerContainer.isComplexGraphContainer(containers)?-1:depth-i-1}return-1}validateReverseSubject(subject2){if(subject2.termType==="Literal")throw new jsonld_context_parser_12.ErrorCoded(`Found illegal literal in subject position: ${subject2.value}`,jsonld_context_parser_12.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}getDefaultGraph(){return this.parsingContext.defaultGraph||this.dataFactory.defaultGraph()}async getGraphContainerValue(keys2,depth){let graph=this.getDefaultGraph();const{containers,depth:depthContainer}=await EntryHandlerContainer_1.EntryHandlerContainer.getContainerHandler(this.parsingContext,keys2,depth);if("@graph"in containers){const graphContainerIndex=EntryHandlerContainer_1.EntryHandlerContainer.getContainerGraphIndex(containers,depthContainer,keys2),entry=this.parsingContext.graphContainerTermStack[depthContainer];if(graph=entry?entry[graphContainerIndex]:null,!graph){let graphId=null;if("@id"in containers){const keyUnaliased=await this.getContainerKey(keys2[depthContainer],keys2,depthContainer);keyUnaliased!==null&&(graphId=await this.resourceToTerm(await this.parsingContext.getContext(keys2),keyUnaliased))}graphId||(graphId=this.dataFactory.blankNode()),this.parsingContext.graphContainerTermStack[depthContainer]||(this.parsingContext.graphContainerTermStack[depthContainer]={}),graph=this.parsingContext.graphContainerTermStack[depthContainer][graphContainerIndex]=graphId}}return graph}async getPropertiesDepth(keys2,depth){let lastValidDepth=depth;for(let i=depth-1;i>0;i--)if(typeof keys2[i]!="number"){const parentKey=await this.unaliasKeyword(keys2[i],keys2,i);if(parentKey==="@reverse")return i;if(parentKey==="@nest")lastValidDepth=i;else return lastValidDepth}return lastValidDepth}async getContainerKey(key,keys2,depth){const keyUnaliased=await this.unaliasKeyword(key,keys2,depth);return keyUnaliased==="@none"?null:keyUnaliased}validateReverseInEmbeddedNode(key,reverse3,isEmbedded){if(isEmbedded&&reverse3&&!this.parsingContext.rdfstarReverseInEmbedded)throw new jsonld_context_parser_12.ErrorCoded(`Illegal reverse property in embedded node in ${key}`,jsonld_context_parser_12.ERROR_CODES.INVALID_EMBEDDED_NODE)}emitQuadChecked(depth,subject2,predicate2,object2,graph,reverse3,isEmbedded){let quad;if(reverse3?(this.validateReverseSubject(object2),quad=this.dataFactory.quad(object2,predicate2,subject2,graph)):quad=this.dataFactory.quad(subject2,predicate2,object2,graph),isEmbedded){if(quad.graph.termType!=="DefaultGraph"&&(quad=this.dataFactory.quad(quad.subject,quad.predicate,quad.object)),this.parsingContext.idStack[depth-1])throw new jsonld_context_parser_12.ErrorCoded("Illegal multiple properties in an embedded node",jsonld_context_parser_12.ERROR_CODES.INVALID_EMBEDDED_NODE);this.parsingContext.idStack[depth-1]=[quad]}else this.parsingContext.emitQuad(depth,quad);const annotationsBuffer=this.parsingContext.annotationsBuffer[depth];if(annotationsBuffer){for(const annotation of annotationsBuffer)this.emitAnnotation(depth,quad,annotation);delete this.parsingContext.annotationsBuffer[depth]}}emitAnnotation(depth,quad,annotation){let annotationQuad;annotation.reverse?(this.validateReverseSubject(annotation.object),annotationQuad=this.dataFactory.quad(annotation.object,annotation.predicate,quad)):annotationQuad=this.dataFactory.quad(quad,annotation.predicate,annotation.object),this.parsingContext.emitQuad(depth,annotationQuad);for(const nestedAnnotation of annotation.nestedAnnotations)this.emitAnnotation(depth,annotationQuad,nestedAnnotation)}},"Util");return Util7.Util=Util$12,Util$12.XSD="http://www.w3.org/2001/XMLSchema#",Util$12.XSD_BOOLEAN=Util$12.XSD+"boolean",Util$12.XSD_INTEGER=Util$12.XSD+"integer",Util$12.XSD_DOUBLE=Util$12.XSD+"double",Util$12.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#",Util7}__name(requireUtil,"requireUtil");Object.defineProperty(EntryHandlerArrayValue$1,"__esModule",{value:!0});EntryHandlerArrayValue$1.EntryHandlerArrayValue=void 0;const Util_1$1=requireUtil(),jsonld_context_parser_1$8=jsonldContextParser;class EntryHandlerArrayValue{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(parsingContext,util2,keys2,depth,inProperty){return this.test(parsingContext,util2,null,keys2,depth)}async test(parsingContext,util2,key,keys2,depth){return typeof keys2[depth]=="number"}async handle(parsingContext,util2,key,keys2,value,depth){let parentKey=await util2.unaliasKeywordParent(keys2,depth);if(parentKey==="@list"){let listRootKey=null,listRootDepth=0;for(let i=depth-2;i>0;i--){const keyOption=keys2[i];if(typeof keyOption=="string"||typeof keyOption=="number"){listRootDepth=i,listRootKey=keyOption;break}}if(listRootKey!==null){const values2=await util2.valueToTerm(await parsingContext.getContext(keys2),listRootKey,value,depth,keys2);for(const object2 of values2)await this.handleListElement(parsingContext,util2,object2,value,depth,keys2.slice(0,listRootDepth),listRootDepth);values2.length===0&&await this.handleListElement(parsingContext,util2,null,value,depth,keys2.slice(0,listRootDepth),listRootDepth)}}else if(parentKey==="@set")await parsingContext.newOnValueJob(keys2.slice(0,-2),value,depth-2,!1);else if(parentKey!==void 0&&parentKey!=="@type"){for(let i=depth-1;i>0;i--)if(typeof keys2[i]!="number"){parentKey=await util2.unaliasKeyword(keys2[i],keys2,i);break}const parentContext=await parsingContext.getContext(keys2.slice(0,-1));if("@list"in Util_1$1.Util.getContextValueContainer(parentContext,parentKey)){parsingContext.emittedStack[depth+1]=!0;const values2=await util2.valueToTerm(await parsingContext.getContext(keys2),parentKey,value,depth,keys2);for(const object2 of values2)await this.handleListElement(parsingContext,util2,object2,value,depth,keys2.slice(0,-1),depth-1);values2.length===0&&await this.handleListElement(parsingContext,util2,null,value,depth,keys2.slice(0,-1),depth-1)}else parsingContext.shiftStack(depth,1),await parsingContext.newOnValueJob(keys2.slice(0,-1),value,depth-1,!1),parsingContext.contextTree.removeContext(keys2.slice(0,-1))}}async handleListElement(parsingContext,util2,value,valueOriginal,depth,listRootKeys,listRootDepth){let listPointer=parsingContext.listPointerStack[depth];if(valueOriginal!==null&&(await util2.unaliasKeywords(valueOriginal,listRootKeys,depth))["@value"]!==null){if(!listPointer||!listPointer.value){const linkTerm=util2.dataFactory.blankNode();listPointer={value:linkTerm,listRootDepth,listId:linkTerm}}else{const newLinkTerm=util2.dataFactory.blankNode();parsingContext.emitQuad(depth,util2.dataFactory.quad(listPointer.value,util2.rdfRest,newLinkTerm,util2.getDefaultGraph())),listPointer.value=newLinkTerm}value&&parsingContext.emitQuad(depth,util2.dataFactory.quad(listPointer.value,util2.rdfFirst,value,util2.getDefaultGraph()))}else listPointer||(listPointer={listRootDepth,listId:util2.rdfNil});parsingContext.listPointerStack[depth]=listPointer,parsingContext.rdfstar&&parsingContext.annotationsBuffer[depth]&&parsingContext.emitError(new jsonld_context_parser_1$8.ErrorCoded("Found an illegal annotation inside a list",jsonld_context_parser_1$8.ERROR_CODES.INVALID_ANNOTATION))}}__name(EntryHandlerArrayValue,"EntryHandlerArrayValue");EntryHandlerArrayValue$1.EntryHandlerArrayValue=EntryHandlerArrayValue;var EntryHandlerInvalidFallback$1={};Object.defineProperty(EntryHandlerInvalidFallback$1,"__esModule",{value:!0});EntryHandlerInvalidFallback$1.EntryHandlerInvalidFallback=void 0;class EntryHandlerInvalidFallback{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(parsingContext,util2,keys2,depth,inProperty){return!1}async test(parsingContext,util2,key,keys2,depth){return!0}async handle(parsingContext,util2,key,keys2,value,depth){parsingContext.emittedStack[depth]=!1}}__name(EntryHandlerInvalidFallback,"EntryHandlerInvalidFallback");EntryHandlerInvalidFallback$1.EntryHandlerInvalidFallback=EntryHandlerInvalidFallback;var EntryHandlerKeywordContext$1={},EntryHandlerKeyword$1={};Object.defineProperty(EntryHandlerKeyword$1,"__esModule",{value:!0});EntryHandlerKeyword$1.EntryHandlerKeyword=void 0;class EntryHandlerKeyword{constructor(keyword){this.keyword=keyword}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(parsingContext,util2,keys2,depth,inProperty){return!1}async test(parsingContext,util2,key,keys2,depth){return key===this.keyword}}__name(EntryHandlerKeyword,"EntryHandlerKeyword");EntryHandlerKeyword$1.EntryHandlerKeyword=EntryHandlerKeyword;Object.defineProperty(EntryHandlerKeywordContext$1,"__esModule",{value:!0});EntryHandlerKeywordContext$1.EntryHandlerKeywordContext=void 0;const jsonld_context_parser_1$7=jsonldContextParser,EntryHandlerKeyword_1$7=EntryHandlerKeyword$1;class EntryHandlerKeywordContext extends EntryHandlerKeyword_1$7.EntryHandlerKeyword{constructor(){super("@context")}isStackProcessor(){return!1}async handle(parsingContext,util2,key,keys2,value,depth){parsingContext.streamingProfile&&(parsingContext.processingStack[depth]||parsingContext.processingType[depth]||parsingContext.idStack[depth]!==void 0)&&parsingContext.emitError(new jsonld_context_parser_1$7.ErrorCoded("Found an out-of-order context, while streaming is enabled.(disable `streamingProfile`)",jsonld_context_parser_1$7.ERROR_CODES.INVALID_STREAMING_KEY_ORDER));const parentContext=parsingContext.getContext(keys2),context2=parsingContext.parseContext(value,(await parentContext).getContextRaw());parsingContext.contextTree.setContext(keys2.slice(0,-1),context2),parsingContext.emitContext(value),await parsingContext.validateContext(await context2)}}__name(EntryHandlerKeywordContext,"EntryHandlerKeywordContext");EntryHandlerKeywordContext$1.EntryHandlerKeywordContext=EntryHandlerKeywordContext;var EntryHandlerKeywordGraph$1={};Object.defineProperty(EntryHandlerKeywordGraph$1,"__esModule",{value:!0});EntryHandlerKeywordGraph$1.EntryHandlerKeywordGraph=void 0;const EntryHandlerKeyword_1$6=EntryHandlerKeyword$1;class EntryHandlerKeywordGraph extends EntryHandlerKeyword_1$6.EntryHandlerKeyword{constructor(){super("@graph")}async handle(parsingContext,util2,key,keys2,value,depth){parsingContext.graphStack[depth+1]=!0}}__name(EntryHandlerKeywordGraph,"EntryHandlerKeywordGraph");EntryHandlerKeywordGraph$1.EntryHandlerKeywordGraph=EntryHandlerKeywordGraph;var EntryHandlerKeywordId$1={};Object.defineProperty(EntryHandlerKeywordId$1,"__esModule",{value:!0});EntryHandlerKeywordId$1.EntryHandlerKeywordId=void 0;const jsonld_context_parser_1$6=jsonldContextParser,EntryHandlerKeyword_1$5=EntryHandlerKeyword$1;class EntryHandlerKeywordId extends EntryHandlerKeyword_1$5.EntryHandlerKeyword{constructor(){super("@id")}isStackProcessor(){return!1}async handle(parsingContext,util2,key,keys2,value,depth){if(typeof value!="string"){if(parsingContext.rdfstar&&typeof value=="object"){const valueKeys=Object.keys(value);valueKeys.length===1&&valueKeys[0]==="@id"&&parsingContext.emitError(new jsonld_context_parser_1$6.ErrorCoded(`Invalid embedded node without property with @id ${value["@id"]}`,jsonld_context_parser_1$6.ERROR_CODES.INVALID_EMBEDDED_NODE))}else parsingContext.emitError(new jsonld_context_parser_1$6.ErrorCoded(`Found illegal @id '${value}'`,jsonld_context_parser_1$6.ERROR_CODES.INVALID_ID_VALUE));return}const depthProperties=await util2.getPropertiesDepth(keys2,depth);if(parsingContext.idStack[depthProperties]!==void 0&&(parsingContext.idStack[depthProperties][0].listHead?parsingContext.emitError(new jsonld_context_parser_1$6.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${keys2[depth-1]}'`,jsonld_context_parser_1$6.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT)):parsingContext.emitError(new jsonld_context_parser_1$6.ErrorCoded(`Found duplicate @ids '${parsingContext.idStack[depthProperties][0].value}' and '${value}'`,jsonld_context_parser_1$6.ERROR_CODES.COLLIDING_KEYWORDS))),parsingContext.rdfstar&&parsingContext.annotationsBuffer[depth])for(const annotation of parsingContext.annotationsBuffer[depth])annotation.depth===depth&&parsingContext.emitError(new jsonld_context_parser_1$6.ErrorCoded(`Found an illegal @id inside an annotation: ${value}`,jsonld_context_parser_1$6.ERROR_CODES.INVALID_ANNOTATION));parsingContext.idStack[depthProperties]=util2.nullableTermToArray(await util2.resourceToTerm(await parsingContext.getContext(keys2),value))}}__name(EntryHandlerKeywordId,"EntryHandlerKeywordId");EntryHandlerKeywordId$1.EntryHandlerKeywordId=EntryHandlerKeywordId;var EntryHandlerKeywordIncluded$1={};Object.defineProperty(EntryHandlerKeywordIncluded$1,"__esModule",{value:!0});EntryHandlerKeywordIncluded$1.EntryHandlerKeywordIncluded=void 0;const jsonld_context_parser_1$5=jsonldContextParser,EntryHandlerKeyword_1$4=EntryHandlerKeyword$1;class EntryHandlerKeywordIncluded extends EntryHandlerKeyword_1$4.EntryHandlerKeyword{constructor(){super("@included")}async handle(parsingContext,util2,key,keys2,value,depth){typeof value!="object"&&parsingContext.emitError(new jsonld_context_parser_1$5.ErrorCoded(`Found illegal @included '${value}'`,jsonld_context_parser_1$5.ERROR_CODES.INVALID_INCLUDED_VALUE));const valueUnliased=await util2.unaliasKeywords(value,keys2,depth,await parsingContext.getContext(keys2));"@value"in valueUnliased&&parsingContext.emitError(new jsonld_context_parser_1$5.ErrorCoded(`Found an illegal @included @value node '${JSON.stringify(value)}'`,jsonld_context_parser_1$5.ERROR_CODES.INVALID_INCLUDED_VALUE)),"@list"in valueUnliased&&parsingContext.emitError(new jsonld_context_parser_1$5.ErrorCoded(`Found an illegal @included @list node '${JSON.stringify(value)}'`,jsonld_context_parser_1$5.ERROR_CODES.INVALID_INCLUDED_VALUE)),parsingContext.emittedStack[depth]=!1}}__name(EntryHandlerKeywordIncluded,"EntryHandlerKeywordIncluded");EntryHandlerKeywordIncluded$1.EntryHandlerKeywordIncluded=EntryHandlerKeywordIncluded;var EntryHandlerKeywordNest$1={};Object.defineProperty(EntryHandlerKeywordNest$1,"__esModule",{value:!0});EntryHandlerKeywordNest$1.EntryHandlerKeywordNest=void 0;const jsonld_context_parser_1$4=jsonldContextParser,EntryHandlerKeyword_1$3=EntryHandlerKeyword$1;class EntryHandlerKeywordNest extends EntryHandlerKeyword_1$3.EntryHandlerKeyword{constructor(){super("@nest")}async handle(parsingContext,util2,key,keys2,value,depth){typeof value!="object"&&parsingContext.emitError(new jsonld_context_parser_1$4.ErrorCoded(`Found invalid @nest entry for '${key}': '${value}'`,jsonld_context_parser_1$4.ERROR_CODES.INVALID_NEST_VALUE)),"@value"in await util2.unaliasKeywords(value,keys2,depth,await parsingContext.getContext(keys2))&&parsingContext.emitError(new jsonld_context_parser_1$4.ErrorCoded(`Found an invalid @value node for '${key}'`,jsonld_context_parser_1$4.ERROR_CODES.INVALID_NEST_VALUE)),parsingContext.emittedStack[depth]=!1}}__name(EntryHandlerKeywordNest,"EntryHandlerKeywordNest");EntryHandlerKeywordNest$1.EntryHandlerKeywordNest=EntryHandlerKeywordNest;var EntryHandlerKeywordType$1={};Object.defineProperty(EntryHandlerKeywordType$1,"__esModule",{value:!0});EntryHandlerKeywordType$1.EntryHandlerKeywordType=void 0;const jsonld_context_parser_1$3=jsonldContextParser,Util_1=requireUtil(),EntryHandlerPredicate_1=requireEntryHandlerPredicate(),EntryHandlerKeyword_1$2=EntryHandlerKeyword$1;class EntryHandlerKeywordType extends EntryHandlerKeyword_1$2.EntryHandlerKeyword{constructor(){super("@type")}isStackProcessor(){return!1}async handle(parsingContext,util2,key,keys2,value,depth){const keyOriginal=keys2[depth],context2=await parsingContext.getContext(keys2),predicate2=util2.rdfType,parentKey=await util2.unaliasKeywordParent(keys2,depth),reverse3=Util_1.Util.isPropertyReverse(context2,keyOriginal,parentKey),isEmbedded=Util_1.Util.isPropertyInEmbeddedNode(parentKey);util2.validateReverseInEmbeddedNode(key,reverse3,isEmbedded);const isAnnotation=Util_1.Util.isPropertyInAnnotationObject(parentKey),elements=Array.isArray(value)?value:[value];for(const element of elements){typeof element!="string"&&parsingContext.emitError(new jsonld_context_parser_1$3.ErrorCoded(`Found illegal @type '${element}'`,jsonld_context_parser_1$3.ERROR_CODES.INVALID_TYPE_VALUE));const type=util2.createVocabOrBaseTerm(context2,element);type&&await EntryHandlerPredicate_1.EntryHandlerPredicate.handlePredicateObject(parsingContext,util2,keys2,depth,predicate2,type,reverse3,isEmbedded,isAnnotation)}let scopedContext=Promise.resolve(context2),hasTypedScopedContext=!1;for(const element of elements.sort()){const typeContext=Util_1.Util.getContextValue(context2,"@context",element,null);typeContext&&(hasTypedScopedContext=!0,scopedContext=scopedContext.then(c=>parsingContext.parseContext(typeContext,c.getContextRaw())))}parsingContext.streamingProfile&&(hasTypedScopedContext||!parsingContext.streamingProfileAllowOutOfOrderPlainType)&&(parsingContext.processingStack[depth]||parsingContext.idStack[depth])&&parsingContext.emitError(new jsonld_context_parser_1$3.ErrorCoded("Found an out-of-order type-scoped context, while streaming is enabled.(disable `streamingProfile`)",jsonld_context_parser_1$3.ERROR_CODES.INVALID_STREAMING_KEY_ORDER)),hasTypedScopedContext&&(scopedContext=scopedContext.then(c=>("@propagate"in c.getContextRaw()||(c.getContextRaw()["@propagate"]=!1),c.getContextRaw()["@propagate"]===!1&&(c.getContextRaw()["@__propagateFallback"]=context2.getContextRaw()),c)),parsingContext.contextTree.setContext(keys2.slice(0,keys2.length-1),scopedContext)),parsingContext.processingType[depth]=!0}}__name(EntryHandlerKeywordType,"EntryHandlerKeywordType");EntryHandlerKeywordType$1.EntryHandlerKeywordType=EntryHandlerKeywordType;var EntryHandlerKeywordUnknownFallback$1={};Object.defineProperty(EntryHandlerKeywordUnknownFallback$1,"__esModule",{value:!0});EntryHandlerKeywordUnknownFallback$1.EntryHandlerKeywordUnknownFallback=void 0;const jsonld_context_parser_1$2=jsonldContextParser;class EntryHandlerKeywordUnknownFallback{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(parsingContext,util2,keys2,depth,inProperty){const key=await util2.unaliasKeyword(keys2[depth],keys2,depth);return jsonld_context_parser_1$2.Util.isPotentialKeyword(key)?!(!inProperty&&key==="@list"):!1}async test(parsingContext,util2,key,keys2,depth){return jsonld_context_parser_1$2.Util.isPotentialKeyword(key)}async handle(parsingContext,util2,key,keys2,value,depth){const keywordType=EntryHandlerKeywordUnknownFallback.VALID_KEYWORDS_TYPES[key];keywordType!==void 0?keywordType&&typeof value!==keywordType.type&&parsingContext.emitError(new jsonld_context_parser_1$2.ErrorCoded(`Invalid value type for '${key}' with value '${value}'`,keywordType.errorCode)):parsingContext.strictValues&&parsingContext.emitError(new Error(`Unknown keyword '${key}' with value '${value}'`)),parsingContext.emittedStack[depth]=!1}}__name(EntryHandlerKeywordUnknownFallback,"EntryHandlerKeywordUnknownFallback");EntryHandlerKeywordUnknownFallback$1.EntryHandlerKeywordUnknownFallback=EntryHandlerKeywordUnknownFallback;EntryHandlerKeywordUnknownFallback.VALID_KEYWORDS_TYPES={"@index":{type:"string",errorCode:jsonld_context_parser_1$2.ERROR_CODES.INVALID_INDEX_VALUE},"@list":null,"@reverse":{type:"object",errorCode:jsonld_context_parser_1$2.ERROR_CODES.INVALID_REVERSE_VALUE},"@set":null,"@value":null};var EntryHandlerKeywordValue$1={};Object.defineProperty(EntryHandlerKeywordValue$1,"__esModule",{value:!0});EntryHandlerKeywordValue$1.EntryHandlerKeywordValue=void 0;const EntryHandlerKeyword_1$1=EntryHandlerKeyword$1;class EntryHandlerKeywordValue extends EntryHandlerKeyword_1$1.EntryHandlerKeyword{constructor(){super("@value")}async validate(parsingContext,util2,keys2,depth,inProperty){const key=keys2[depth];return key&&!parsingContext.literalStack[depth]&&await this.test(parsingContext,util2,key,keys2,depth)&&(parsingContext.literalStack[depth]=!0),super.validate(parsingContext,util2,keys2,depth,inProperty)}async test(parsingContext,util2,key,keys2,depth){return await util2.unaliasKeyword(keys2[depth],keys2.slice(0,keys2.length-1),depth-1,!0)==="@value"}async handle(parsingContext,util2,key,keys2,value,depth){parsingContext.literalStack[depth]=!0,delete parsingContext.unidentifiedValuesBuffer[depth],delete parsingContext.unidentifiedGraphsBuffer[depth],parsingContext.emittedStack[depth]=!1}}__name(EntryHandlerKeywordValue,"EntryHandlerKeywordValue");EntryHandlerKeywordValue$1.EntryHandlerKeywordValue=EntryHandlerKeywordValue;var ParsingContext={},ContextTree$1={};Object.defineProperty(ContextTree$1,"__esModule",{value:!0});ContextTree$1.ContextTree=void 0;class ContextTree{constructor(){this.subTrees={}}getContext(keys2){if(keys2.length>0){const[head2,...tail]=keys2,subTree=this.subTrees[head2];if(subTree){const subContext=subTree.getContext(tail);if(subContext)return subContext.then(({context:context2,depth})=>({context:context2,depth:depth+1}))}}return this.context?this.context.then(context2=>({context:context2,depth:0})):null}setContext(keys2,context2){if(keys2.length===0)this.context=context2;else{const[head2,...tail]=keys2;let subTree=this.subTrees[head2];subTree||(subTree=this.subTrees[head2]=new ContextTree),subTree.setContext(tail,context2)}}removeContext(path){this.setContext(path,null)}}__name(ContextTree,"ContextTree");ContextTree$1.ContextTree=ContextTree;var hasRequiredParsingContext;function requireParsingContext(){if(hasRequiredParsingContext)return ParsingContext;hasRequiredParsingContext=1,Object.defineProperty(ParsingContext,"__esModule",{value:!0}),ParsingContext.ParsingContext=void 0;const jsonld_context_parser_12=jsonldContextParser,ErrorCoded_12=ErrorCoded,ContextTree_1=ContextTree$1,JsonLdParser_1=requireJsonLdParser();let ParsingContext$1=__name(class ParsingContext2{constructor(options){this.contextParser=new jsonld_context_parser_12.ContextParser({documentLoader:options.documentLoader,skipValidation:options.skipContextValidation}),this.streamingProfile=!!options.streamingProfile,this.baseIRI=options.baseIRI,this.produceGeneralizedRdf=!!options.produceGeneralizedRdf,this.allowSubjectList=!!options.allowSubjectList,this.processingMode=options.processingMode||JsonLdParser_1.JsonLdParser.DEFAULT_PROCESSING_MODE,this.strictValues=!!options.strictValues,this.validateValueIndexes=!!options.validateValueIndexes,this.defaultGraph=options.defaultGraph,this.rdfDirection=options.rdfDirection,this.normalizeLanguageTags=options.normalizeLanguageTags,this.streamingProfileAllowOutOfOrderPlainType=options.streamingProfileAllowOutOfOrderPlainType,this.rdfstar=options.rdfstar!==!1,this.rdfstarReverseInEmbedded=options.rdfstarReverseInEmbedded,this.topLevelProperties=!1,this.activeProcessingMode=parseFloat(this.processingMode),this.processingStack=[],this.processingType=[],this.emittedStack=[],this.idStack=[],this.graphStack=[],this.graphContainerTermStack=[],this.listPointerStack=[],this.contextTree=new ContextTree_1.ContextTree,this.literalStack=[],this.validationStack=[],this.unaliasedKeywordCacheStack=[],this.jsonLiteralStack=[],this.unidentifiedValuesBuffer=[],this.unidentifiedGraphsBuffer=[],this.annotationsBuffer=[],this.pendingContainerFlushBuffers=[],this.parser=options.parser,options.context?(this.rootContext=this.parseContext(options.context),this.rootContext.then(context2=>this.validateContext(context2))):this.rootContext=Promise.resolve(new jsonld_context_parser_12.JsonLdContextNormalized(this.baseIRI?{"@base":this.baseIRI,"@__baseDocument":!0}:{}))}async parseContext(context2,parentContext,ignoreProtection){return this.contextParser.parse(context2,{baseIRI:this.baseIRI,ignoreProtection,normalizeLanguageTags:this.normalizeLanguageTags,parentContext,processingMode:this.activeProcessingMode})}validateContext(context2){const activeVersion=context2.getContextRaw()["@version"];if(activeVersion){if(this.activeProcessingMode&&activeVersion>this.activeProcessingMode)throw new ErrorCoded_12.ErrorCoded(`Unsupported JSON-LD version '${activeVersion}' under active processing mode ${this.activeProcessingMode}.`,ErrorCoded_12.ERROR_CODES.PROCESSING_MODE_CONFLICT);if(this.activeProcessingMode&&activeVersion<this.activeProcessingMode)throw new ErrorCoded_12.ErrorCoded(`Invalid JSON-LD version ${activeVersion} under active processing mode ${this.activeProcessingMode}.`,ErrorCoded_12.ERROR_CODES.INVALID_VERSION_VALUE);this.activeProcessingMode=activeVersion}}async getContext(keys2,offset=1){const keysOriginal=keys2;for(;typeof keys2[keys2.length-1]=="number";)keys2=keys2.slice(0,keys2.length-1);offset&&(keys2=keys2.slice(0,-offset));const contextData=await this.getContextPropagationAware(keys2);let contextRaw=contextData.context.getContextRaw();for(let i=contextData.depth;i<keysOriginal.length-offset;i++){const key=keysOriginal[i],contextKeyEntry=contextRaw[key];if(contextKeyEntry&&typeof contextKeyEntry=="object"&&"@context"in contextKeyEntry){const scopedContext=(await this.parseContext(contextKeyEntry,contextRaw,!0)).getContextRaw(),propagate=!(key in scopedContext)||scopedContext[key]["@context"]["@propagate"];(propagate!==!1||i===keysOriginal.length-1-offset)&&(contextRaw=scopedContext,delete contextRaw["@propagate"],contextRaw[key]=Object.assign({},contextRaw[key]),"@id"in contextKeyEntry&&(contextRaw[key]["@id"]=contextKeyEntry["@id"]),delete contextRaw[key]["@context"],propagate!==!1&&this.contextTree.setContext(keysOriginal.slice(0,i+offset),Promise.resolve(new jsonld_context_parser_12.JsonLdContextNormalized(contextRaw))))}}return new jsonld_context_parser_12.JsonLdContextNormalized(contextRaw)}async getContextPropagationAware(keys2){const originalDepth=keys2.length;let contextData=null,hasApplicablePropertyScopedContext;do{hasApplicablePropertyScopedContext=!1,contextData&&"@__propagateFallback"in contextData.context.getContextRaw()?contextData.context=new jsonld_context_parser_12.JsonLdContextNormalized(contextData.context.getContextRaw()["@__propagateFallback"]):(contextData&&(keys2=keys2.slice(0,contextData.depth-1)),contextData=await this.contextTree.getContext(keys2)||{context:await this.rootContext,depth:0});const lastKey=keys2[keys2.length-1];if(lastKey in contextData.context.getContextRaw()){const lastKeyValue=contextData.context.getContextRaw()[lastKey];lastKeyValue&&typeof lastKeyValue=="object"&&"@context"in lastKeyValue&&(hasApplicablePropertyScopedContext=!0)}}while(contextData.depth>0&&contextData.context.getContextRaw()["@propagate"]===!1&&contextData.depth!==originalDepth&&!hasApplicablePropertyScopedContext);return contextData.depth===0&&contextData.context.getContextRaw()["@propagate"]===!1&&contextData.depth!==originalDepth&&(contextData.context=new jsonld_context_parser_12.JsonLdContextNormalized({})),contextData}async newOnValueJob(keys2,value,depth,lastDepthCheck){await this.parser.newOnValueJob(keys2,value,depth,lastDepthCheck)}async handlePendingContainerFlushBuffers(){if(this.pendingContainerFlushBuffers.length>0){for(const pendingFlushBuffer of this.pendingContainerFlushBuffers)await this.parser.flushBuffer(pendingFlushBuffer.depth,pendingFlushBuffer.keys),this.parser.flushStacks(pendingFlushBuffer.depth);return this.pendingContainerFlushBuffers.splice(0,this.pendingContainerFlushBuffers.length),!0}else return!1}emitQuad(depth,quad){depth===1&&(this.topLevelProperties=!0),this.parser.push(quad)}emitError(error){this.parser.emit("error",error)}emitContext(context2){this.parser.emit("context",context2)}getUnidentifiedValueBufferSafe(depth){let buffer=this.unidentifiedValuesBuffer[depth];return buffer||(buffer=[],this.unidentifiedValuesBuffer[depth]=buffer),buffer}getUnidentifiedGraphBufferSafe(depth){let buffer=this.unidentifiedGraphsBuffer[depth];return buffer||(buffer=[],this.unidentifiedGraphsBuffer[depth]=buffer),buffer}getAnnotationsBufferSafe(depth){let buffer=this.annotationsBuffer[depth];return buffer||(buffer=[],this.annotationsBuffer[depth]=buffer),buffer}getExpandOptions(){return ParsingContext2.EXPAND_OPTIONS[this.activeProcessingMode]}shiftStack(depth,depthOffset){const deeperIdStack=this.idStack[depth+depthOffset];if(deeperIdStack&&(this.idStack[depth]=deeperIdStack,this.emittedStack[depth]=!0,delete this.idStack[depth+depthOffset]),this.pendingContainerFlushBuffers.length)for(const buffer of this.pendingContainerFlushBuffers)buffer.depth>=depth+depthOffset&&(buffer.depth-=depthOffset,buffer.keys.splice(depth,depthOffset));this.unidentifiedValuesBuffer[depth+depthOffset]&&(this.unidentifiedValuesBuffer[depth]=this.unidentifiedValuesBuffer[depth+depthOffset],delete this.unidentifiedValuesBuffer[depth+depthOffset]),this.annotationsBuffer[depth+depthOffset-1]&&(this.annotationsBuffer[depth-1]||(this.annotationsBuffer[depth-1]=[]),this.annotationsBuffer[depth-1]=[...this.annotationsBuffer[depth-1],...this.annotationsBuffer[depth+depthOffset-1]],delete this.annotationsBuffer[depth+depthOffset-1])}},"ParsingContext");return ParsingContext.ParsingContext=ParsingContext$1,ParsingContext$1.EXPAND_OPTIONS={1:{allowPrefixForcing:!1,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!1},1.1:{allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}},ParsingContext}__name(requireParsingContext,"requireParsingContext");var EntryHandlerKeywordAnnotation$1={};Object.defineProperty(EntryHandlerKeywordAnnotation$1,"__esModule",{value:!0});EntryHandlerKeywordAnnotation$1.EntryHandlerKeywordAnnotation=void 0;const EntryHandlerKeyword_1=EntryHandlerKeyword$1,jsonld_context_parser_1$1=jsonldContextParser;class EntryHandlerKeywordAnnotation extends EntryHandlerKeyword_1.EntryHandlerKeyword{constructor(){super("@annotation")}async handle(parsingContext,util2,key,keys2,value,depth){(typeof value=="string"||typeof value=="object"&&value["@value"])&&parsingContext.emitError(new jsonld_context_parser_1$1.ErrorCoded(`Found illegal annotation value: ${JSON.stringify(value)}`,jsonld_context_parser_1$1.ERROR_CODES.INVALID_ANNOTATION))}}__name(EntryHandlerKeywordAnnotation,"EntryHandlerKeywordAnnotation");EntryHandlerKeywordAnnotation$1.EntryHandlerKeywordAnnotation=EntryHandlerKeywordAnnotation;var hasRequiredJsonLdParser;function requireJsonLdParser(){if(hasRequiredJsonLdParser)return JsonLdParser;hasRequiredJsonLdParser=1,Object.defineProperty(JsonLdParser,"__esModule",{value:!0}),JsonLdParser.JsonLdParser=void 0;const Parser3=jsonparse,jsonld_context_parser_12=jsonldContextParser,readable_stream_12=browserExports$1,EntryHandlerArrayValue_1=EntryHandlerArrayValue$1,EntryHandlerContainer_1=requireEntryHandlerContainer(),EntryHandlerInvalidFallback_1=EntryHandlerInvalidFallback$1,EntryHandlerPredicate_12=requireEntryHandlerPredicate(),EntryHandlerKeywordContext_1=EntryHandlerKeywordContext$1,EntryHandlerKeywordGraph_1=EntryHandlerKeywordGraph$1,EntryHandlerKeywordId_1=EntryHandlerKeywordId$1,EntryHandlerKeywordIncluded_1=EntryHandlerKeywordIncluded$1,EntryHandlerKeywordNest_1=EntryHandlerKeywordNest$1,EntryHandlerKeywordType_1=EntryHandlerKeywordType$1,EntryHandlerKeywordUnknownFallback_1=EntryHandlerKeywordUnknownFallback$1,EntryHandlerKeywordValue_1=EntryHandlerKeywordValue$1,ParsingContext_1=requireParsingContext(),Util_12=requireUtil(),http_link_header_12=link,EntryHandlerKeywordAnnotation_1=EntryHandlerKeywordAnnotation$1;let JsonLdParser$1=__name(class JsonLdParser2 extends readable_stream_12.Transform{constructor(options){super({readableObjectMode:!0}),options=options||{},this.options=options,this.parsingContext=new ParsingContext_1.ParsingContext(Object.assign({parser:this},options)),this.util=new Util_12.Util({dataFactory:options.dataFactory,parsingContext:this.parsingContext}),this.jsonParser=new Parser3,this.contextJobs=[],this.typeJobs=[],this.contextAwaitingJobs=[],this.lastDepth=0,this.lastKeys=[],this.lastOnValueJob=Promise.resolve(),this.attachJsonParserListeners(),this.on("end",()=>{typeof this.jsonParser.mode<"u"&&this.emit("error",new Error("Unclosed document"))})}static fromHttpResponse(baseIRI,mediaType,headers,options){let context2;if(mediaType!=="application/ld+json"){if(mediaType!=="application/json"&&!mediaType.endsWith("+json"))throw new jsonld_context_parser_12.ErrorCoded(`Unsupported JSON-LD media type ${mediaType}`,jsonld_context_parser_12.ERROR_CODES.LOADING_DOCUMENT_FAILED);if(headers&&headers.has("Link")&&headers.forEach((value,key)=>{if(key==="link"){const linkHeader=(0,http_link_header_12.parse)(value);for(const link2 of linkHeader.get("rel","http://www.w3.org/ns/json-ld#context")){if(context2)throw new jsonld_context_parser_12.ErrorCoded("Multiple JSON-LD context link headers were found on "+baseIRI,jsonld_context_parser_12.ERROR_CODES.MULTIPLE_CONTEXT_LINK_HEADERS);context2=link2.uri}}}),!context2&&!(options!=null&&options.ignoreMissingContextLinkHeader))throw new jsonld_context_parser_12.ErrorCoded(`Missing context link header for media type ${mediaType} on ${baseIRI}`,jsonld_context_parser_12.ERROR_CODES.LOADING_DOCUMENT_FAILED)}let streamingProfile;if(headers&&headers.has("Content-Type")){const contentType=headers.get("Content-Type"),match=/; *profile=([^"]*)/.exec(contentType);match&&match[1]==="http://www.w3.org/ns/json-ld#streaming"&&(streamingProfile=!0)}return new JsonLdParser2(Object.assign({baseIRI,context:context2,streamingProfile},options||{}))}import(stream){if("pipe"in stream){stream.on("error",error=>parsed.emit("error",error));const parsed=stream.pipe(new JsonLdParser2(this.options));return parsed}else{const output=new readable_stream_12.PassThrough({readableObjectMode:!0});stream.on("error",error=>parsed.emit("error",error)),stream.on("data",data=>output.push(data)),stream.on("end",()=>output.push(null));const parsed=output.pipe(new JsonLdParser2(this.options));return parsed}}_transform(chunk,encoding,callback){this.jsonParser.write(chunk),this.lastOnValueJob.then(()=>callback(),error=>callback(error))}async newOnValueJob(keys2,value,depth,lastDepthCheck){let flushStacks=!0;if(lastDepthCheck&&depth<this.lastDepth){const listPointer=this.parsingContext.listPointerStack[this.lastDepth];listPointer&&(listPointer.value&&this.push(this.util.dataFactory.quad(listPointer.value,this.util.rdfRest,this.util.rdfNil,this.util.getDefaultGraph())),listPointer.listId.listHead=!0,this.parsingContext.idStack[listPointer.listRootDepth+1]=[listPointer.listId],this.parsingContext.listPointerStack.splice(this.lastDepth,1)),await EntryHandlerContainer_1.EntryHandlerContainer.isBufferableContainerHandler(this.parsingContext,this.lastKeys,this.lastDepth)?(this.parsingContext.pendingContainerFlushBuffers.push({depth:this.lastDepth,keys:this.lastKeys.slice(0,this.lastKeys.length)}),flushStacks=!1):await this.flushBuffer(this.lastDepth,this.lastKeys)}const key=await this.util.unaliasKeyword(keys2[depth],keys2,depth),parentKey=await this.util.unaliasKeywordParent(keys2,depth);this.parsingContext.emittedStack[depth]=!0;let handleKey=!0;jsonld_context_parser_12.Util.isValidKeyword(key)&&parentKey==="@reverse"&&key!=="@context"&&this.emit("error",new jsonld_context_parser_12.ErrorCoded(`Found the @id '${value}' inside an @reverse property`,jsonld_context_parser_12.ERROR_CODES.INVALID_REVERSE_PROPERTY_MAP));let inProperty=!1;this.parsingContext.validationStack.length>1&&(inProperty=this.parsingContext.validationStack[this.parsingContext.validationStack.length-1].property);for(let i=Math.max(1,this.parsingContext.validationStack.length-1);i<keys2.length-1;i++){const validationResult=this.parsingContext.validationStack[i]||(this.parsingContext.validationStack[i]=await this.validateKey(keys2.slice(0,i+1),i,inProperty));if(validationResult.valid)!inProperty&&validationResult.property&&(inProperty=!0);else{this.parsingContext.emittedStack[depth]=!1,handleKey=!1;break}}if(await this.util.isLiteral(keys2,depth)&&(handleKey=!1),handleKey)for(const entryHandler of JsonLdParser2.ENTRY_HANDLERS){const testResult=await entryHandler.test(this.parsingContext,this.util,key,keys2,depth);if(testResult){await entryHandler.handle(this.parsingContext,this.util,key,keys2,value,depth,testResult),entryHandler.isStackProcessor()&&(this.parsingContext.processingStack[depth]=!0);break}}depth===0&&Array.isArray(value)&&await this.util.validateValueIndexes(value),flushStacks&&depth<this.lastDepth&&this.flushStacks(this.lastDepth),this.lastDepth=depth,this.lastKeys=keys2,this.parsingContext.unaliasedKeywordCacheStack.splice(depth-1)}flushStacks(depth){this.parsingContext.processingStack.splice(depth,1),this.parsingContext.processingType.splice(depth,1),this.parsingContext.emittedStack.splice(depth,1),this.parsingContext.idStack.splice(depth,1),this.parsingContext.graphStack.splice(depth+1,1),this.parsingContext.graphContainerTermStack.splice(depth,1),this.parsingContext.jsonLiteralStack.splice(depth,1),this.parsingContext.validationStack.splice(depth-1,2),this.parsingContext.literalStack.splice(depth,this.parsingContext.literalStack.length-depth),this.parsingContext.annotationsBuffer.splice(depth,1)}async flushBuffer(depth,keys2){let subjects=this.parsingContext.idStack[depth];!!subjects||(subjects=this.parsingContext.idStack[depth]=[this.util.dataFactory.blankNode()]);const valueBuffer=this.parsingContext.unidentifiedValuesBuffer[depth];if(valueBuffer){for(const subject2 of subjects){const depthOffsetGraph=await this.util.getDepthOffsetGraph(depth,keys2),graphs=this.parsingContext.graphStack[depth]||depthOffsetGraph>=0?this.parsingContext.idStack[depth-depthOffsetGraph-1]:[await this.util.getGraphContainerValue(keys2,depth)];if(graphs)for(const graph of graphs){this.parsingContext.emittedStack[depth]=!0;for(const bufferedValue of valueBuffer)this.util.emitQuadChecked(depth,subject2,bufferedValue.predicate,bufferedValue.object,graph,bufferedValue.reverse,bufferedValue.isEmbedded)}else{const subGraphBuffer=this.parsingContext.getUnidentifiedGraphBufferSafe(depth-await this.util.getDepthOffsetGraph(depth,keys2)-1);for(const bufferedValue of valueBuffer)bufferedValue.reverse?subGraphBuffer.push({object:subject2,predicate:bufferedValue.predicate,subject:bufferedValue.object,isEmbedded:bufferedValue.isEmbedded}):subGraphBuffer.push({object:bufferedValue.object,predicate:bufferedValue.predicate,subject:subject2,isEmbedded:bufferedValue.isEmbedded})}}this.parsingContext.unidentifiedValuesBuffer.splice(depth,1),this.parsingContext.literalStack.splice(depth,1),this.parsingContext.jsonLiteralStack.splice(depth,1)}const graphBuffer=this.parsingContext.unidentifiedGraphsBuffer[depth];if(graphBuffer){for(const subject2 of subjects){const graph=depth===1&&subject2.termType==="BlankNode"&&!this.parsingContext.topLevelProperties?this.util.getDefaultGraph():subject2;this.parsingContext.emittedStack[depth]=!0;for(const bufferedValue of graphBuffer)this.parsingContext.emitQuad(depth,this.util.dataFactory.quad(bufferedValue.subject,bufferedValue.predicate,bufferedValue.object,graph))}this.parsingContext.unidentifiedGraphsBuffer.splice(depth,1)}const annotationsBuffer=this.parsingContext.annotationsBuffer[depth];if(annotationsBuffer){annotationsBuffer.length>0&&depth===1&&this.parsingContext.emitError(new jsonld_context_parser_12.ErrorCoded("Annotations can not be made on top-level nodes",jsonld_context_parser_12.ERROR_CODES.INVALID_ANNOTATION));const annotationsBufferParent=this.parsingContext.getAnnotationsBufferSafe(depth-1);for(const annotation of annotationsBuffer)annotationsBufferParent.push(annotation);delete this.parsingContext.annotationsBuffer[depth]}}async validateKey(keys2,depth,inProperty){for(const entryHandler of JsonLdParser2.ENTRY_HANDLERS)if(await entryHandler.validate(this.parsingContext,this.util,keys2,depth,inProperty))return{valid:!0,property:inProperty||entryHandler.isPropertyHandler()};return{valid:!1,property:!1}}attachJsonParserListeners(){this.jsonParser.onValue=value=>{const depth=this.jsonParser.stack.length,keys2=new Array(depth+1).fill(0).map((v,i)=>i===depth?this.jsonParser.key:this.jsonParser.stack[i].key);if(!this.isParsingContextInner(depth)){const valueJobCb=__name(()=>this.newOnValueJob(keys2,value,depth,!0),"valueJobCb");if(!this.parsingContext.streamingProfile&&!this.parsingContext.contextTree.getContext(keys2.slice(0,-1)))if(keys2[depth]==="@context"){let jobs=this.contextJobs[depth];jobs||(jobs=this.contextJobs[depth]=[]),jobs.push(valueJobCb)}else keys2[depth]==="@type"||typeof keys2[depth]=="number"&&keys2[depth-1]==="@type"?this.typeJobs.push({job:valueJobCb,keys:keys2.slice(0,keys2.length-1)}):this.contextAwaitingJobs.push({job:valueJobCb,keys:keys2});else this.lastOnValueJob=this.lastOnValueJob.then(valueJobCb);!this.parsingContext.streamingProfile&&depth===0&&(this.lastOnValueJob=this.lastOnValueJob.then(()=>this.executeBufferedJobs()))}},this.jsonParser.onError=error=>{this.emit("error",error)}}isParsingContextInner(depth){for(let i=depth;i>0;i--)if(this.jsonParser.stack[i-1].key==="@context")return!0;return!1}async executeBufferedJobs(){for(const jobs of this.contextJobs)if(jobs)for(const job of jobs)await job();this.parsingContext.unaliasedKeywordCacheStack.splice(0);for(const job of this.contextAwaitingJobs){if(this.typeJobs.length>0){const applicableTypeJobs=[],applicableTypeJobIds=[];for(let i=0;i<this.typeJobs.length;i++){const typeJob=this.typeJobs[i];Util_12.Util.isPrefixArray(typeJob.keys,job.keys)&&(applicableTypeJobs.push(typeJob),applicableTypeJobIds.push(i))}const sortedTypeJobs=applicableTypeJobs.sort((job1,job2)=>job1.keys.length-job2.keys.length);for(const typeJob of sortedTypeJobs)await typeJob.job();const sortedApplicableTypeJobIds=applicableTypeJobIds.sort().reverse();for(const jobId of sortedApplicableTypeJobIds)this.typeJobs.splice(jobId,1)}await job.job()}}},"JsonLdParser");return JsonLdParser.JsonLdParser=JsonLdParser$1,JsonLdParser$1.DEFAULT_PROCESSING_MODE="1.1",JsonLdParser$1.ENTRY_HANDLERS=[new EntryHandlerArrayValue_1.EntryHandlerArrayValue,new EntryHandlerKeywordContext_1.EntryHandlerKeywordContext,new EntryHandlerKeywordId_1.EntryHandlerKeywordId,new EntryHandlerKeywordIncluded_1.EntryHandlerKeywordIncluded,new EntryHandlerKeywordGraph_1.EntryHandlerKeywordGraph,new EntryHandlerKeywordNest_1.EntryHandlerKeywordNest,new EntryHandlerKeywordType_1.EntryHandlerKeywordType,new EntryHandlerKeywordValue_1.EntryHandlerKeywordValue,new EntryHandlerKeywordAnnotation_1.EntryHandlerKeywordAnnotation,new EntryHandlerContainer_1.EntryHandlerContainer,new EntryHandlerKeywordUnknownFallback_1.EntryHandlerKeywordUnknownFallback,new EntryHandlerPredicate_12.EntryHandlerPredicate,new EntryHandlerInvalidFallback_1.EntryHandlerInvalidFallback],JsonLdParser}__name(requireJsonLdParser,"requireJsonLdParser");(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(requireJsonLdParser(),exports)})(jsonldStreamingParser);var DocumentLoaderMediated$1={};Object.defineProperty(DocumentLoaderMediated$1,"__esModule",{value:!0});DocumentLoaderMediated$1.DocumentLoaderMediated=void 0;const bus_http_1$4=lib$1Y,jsonld_context_parser_1=jsonldContextParser,stringifyStream$5=streamToString$1;class DocumentLoaderMediated extends jsonld_context_parser_1.FetchDocumentLoader{constructor(mediatorHttp,context2){super(DocumentLoaderMediated.createFetcher(mediatorHttp,context2)),this.mediatorHttp=mediatorHttp,this.context=context2}static createFetcher(mediatorHttp,context2){return async(url,init2)=>{const response=await mediatorHttp.mediate({input:url,init:init2,context:context2});return response.json=async()=>JSON.parse(await stringifyStream$5(bus_http_1$4.ActorHttp.toNodeReadable(response.body))),response}}}__name(DocumentLoaderMediated,"DocumentLoaderMediated");DocumentLoaderMediated$1.DocumentLoaderMediated=DocumentLoaderMediated;Object.defineProperty(ActorRdfParseJsonLd$1,"__esModule",{value:!0});ActorRdfParseJsonLd$1.ActorRdfParseJsonLd=void 0;const bus_rdf_parse_1=lib$1U,context_entries_1$a=lib$2x,jsonld_streaming_parser_1=jsonldStreamingParser,DocumentLoaderMediated_1=DocumentLoaderMediated$1;class ActorRdfParseJsonLd extends bus_rdf_parse_1.ActorRdfParseFixedMediaTypes{constructor(args){super(args)}async testHandle(action,mediaType,context2){if(context2.has(context_entries_1$a.KeysRdfParseHtmlScript.processingHtmlScript)&&mediaType!=="application/ld+json")throw new Error("JSON-LD in script tags can only have media type 'application/ld+json'");if(!(mediaType in this.mediaTypePriorities)&&!mediaType.endsWith("+json"))throw new Error(`Unrecognized media type: ${mediaType}`);return await this.testHandleChecked(action)}async runHandle(action,mediaType,actionContext){var _a2;return{data:jsonld_streaming_parser_1.JsonLdParser.fromHttpResponse(((_a2=action.metadata)==null?void 0:_a2.baseIRI)??"",mediaType,action.headers,{documentLoader:actionContext.get(context_entries_1$a.KeysRdfParseJsonLd.documentLoader)||new DocumentLoaderMediated_1.DocumentLoaderMediated(this.mediatorHttp,actionContext),strictValues:actionContext.get(context_entries_1$a.KeysRdfParseJsonLd.strictValues),...actionContext.get(context_entries_1$a.KeysRdfParseJsonLd.parserOptions)}).import(action.data)}}}__name(ActorRdfParseJsonLd,"ActorRdfParseJsonLd");ActorRdfParseJsonLd$1.ActorRdfParseJsonLd=ActorRdfParseJsonLd;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseJsonLd$1,exports),__exportStar(DocumentLoaderMediated$1,exports)})(lib$C);var lib$B={},ActorRdfResolveHypermediaSparql$1={},RdfSourceSparql$1={},fetchSparqlEndpoint$2={},SparqlEndpointFetcher$5={};Object.defineProperty(SparqlEndpointFetcher$5,"__esModule",{value:!0});SparqlEndpointFetcher$5.SparqlEndpointFetcher=void 0;const abort_controller_1$2=browserExports$2,sparqljs_1$2=sparql$1,sparqljson_parse_1$2=sparqljsonParse,sparqlxml_parse_1$2=sparqlxmlParse,stringifyStream$4=streamToString$1,readable_web_to_node_stream_1$2=lib$2C,n3$2=require$$0$3,isStream$2=isStream_1;let SparqlEndpointFetcher$4=__name(class SparqlEndpointFetcher{constructor(args){args=args||{},this.method=args.method||"POST",this.additionalUrlParams=args.additionalUrlParams||new URLSearchParams,this.defaultHeaders=args.defaultHeaders||new Headers,this.fetchCb=args.fetch,this.sparqlJsonParser=new sparqljson_parse_1$2.SparqlJsonParser(args),this.sparqlXmlParser=new sparqlxml_parse_1$2.SparqlXmlParser(args),this.sparqlParsers={[SparqlEndpointFetcher.CONTENTTYPE_SPARQL_JSON]:{parseBooleanStream:sparqlResponseStream=>this.sparqlJsonParser.parseJsonBooleanStream(sparqlResponseStream),parseResultsStream:sparqlResponseStream=>this.sparqlJsonParser.parseJsonResultsStream(sparqlResponseStream)},[SparqlEndpointFetcher.CONTENTTYPE_SPARQL_XML]:{parseBooleanStream:sparqlResponseStream=>this.sparqlXmlParser.parseXmlBooleanStream(sparqlResponseStream),parseResultsStream:sparqlResponseStream=>this.sparqlXmlParser.parseXmlResultsStream(sparqlResponseStream)}},this.timeout=args.timeout}getQueryType(query){const parsedQuery=new sparqljs_1$2.Parser().parse(query);return parsedQuery.type==="query"?parsedQuery.queryType==="DESCRIBE"?"CONSTRUCT":parsedQuery.queryType:"UNKNOWN"}getUpdateTypes(query){const parsedQuery=new sparqljs_1$2.Parser().parse(query);if(parsedQuery.type==="update"){const operations={};for(const update11 of parsedQuery.updates)"type"in update11?operations[update11.type]=!0:operations[update11.updateType]=!0;return operations}else return"UNKNOWN"}async fetchBindings(endpoint,query){const[contentType,responseStream]=await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher.CONTENTTYPE_SPARQL),parser=this.sparqlParsers[contentType];if(!parser)throw new Error("Unknown SPARQL results content type: "+contentType);return parser.parseResultsStream(responseStream)}async fetchAsk(endpoint,query){const[contentType,responseStream]=await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher.CONTENTTYPE_SPARQL),parser=this.sparqlParsers[contentType];if(!parser)throw new Error("Unknown SPARQL results content type: "+contentType);return parser.parseBooleanStream(responseStream)}async fetchTriples(endpoint,query){return(await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher.CONTENTTYPE_TURTLE))[1].pipe(new n3$2.StreamParser({format:SparqlEndpointFetcher.CONTENTTYPE_TURTLE}))}async fetchUpdate(endpoint,query){const abortController=new abort_controller_1$2.default,defaultHeadersRaw={};this.defaultHeaders.forEach((value,key)=>{defaultHeadersRaw[key]=value});const init2={method:"POST",headers:Object.assign(Object.assign({},defaultHeadersRaw),{"content-type":"application/sparql-update"}),body:query,signal:abortController.signal};await this.handleFetchCall(endpoint,init2,{ignoreBody:!0}),abortController.abort()}async fetchRawStream(endpoint,query,acceptHeader){let url=this.method==="POST"?endpoint:endpoint+"?query="+encodeURIComponent(query);const headers=new Headers(this.defaultHeaders);let body;return headers.append("Accept",acceptHeader),this.method==="POST"?(headers.append("Content-Type","application/x-www-form-urlencoded"),body=new URLSearchParams,body.set("query",query),this.additionalUrlParams.forEach((value,key)=>{body.set(key,value)}),headers.append("Content-Length",body.toString().length.toString())):this.additionalUrlParams.toString()!==""&&(url+=`&${this.additionalUrlParams.toString()}`),this.handleFetchCall(url,{headers,method:this.method,body})}async handleFetchCall(url,init2,options={}){let timeoutId;if(this.timeout){const controller=new abort_controller_1$2.default;init2.signal=controller.signal,timeoutId=setTimeout(()=>controller.abort(),this.timeout)}const httpResponse=await(this.fetchCb||fetch)(url,init2);clearTimeout(timeoutId);let responseStream;options.ignoreBody||(responseStream=isStream$2(httpResponse.body)?httpResponse.body:new readable_web_to_node_stream_1$2.ReadableWebToNodeStream(httpResponse.body));let contentType=httpResponse.headers.get("Content-Type")||"";if(contentType.indexOf(";")>0&&(contentType=contentType.substr(0,contentType.indexOf(";"))),!httpResponse.ok){const simpleUrl=/^[^?]*/u.exec(url)[0];let bodyString="empty response";throw responseStream&&(bodyString=await stringifyStream$4(responseStream)),new Error(`Invalid SPARQL endpoint response from ${simpleUrl} (HTTP status ${httpResponse.status}):
${bodyString}`)}return[contentType,responseStream]}},"SparqlEndpointFetcher");SparqlEndpointFetcher$4.CONTENTTYPE_SPARQL_JSON="application/sparql-results+json";SparqlEndpointFetcher$4.CONTENTTYPE_SPARQL_XML="application/sparql-results+xml";SparqlEndpointFetcher$4.CONTENTTYPE_SPARQL=`${SparqlEndpointFetcher$4.CONTENTTYPE_SPARQL_JSON};q=1.0,${SparqlEndpointFetcher$4.CONTENTTYPE_SPARQL_XML};q=0.7`;SparqlEndpointFetcher$4.CONTENTTYPE_TURTLE="text/turtle";SparqlEndpointFetcher$5.SparqlEndpointFetcher=SparqlEndpointFetcher$4;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(SparqlEndpointFetcher$5,exports)})(fetchSparqlEndpoint$2);Object.defineProperty(RdfSourceSparql$1,"__esModule",{value:!0});RdfSourceSparql$1.RdfSourceSparql=void 0;const bindings_factory_1$4=lib$2v,asynciterator_1$8=asynciterator,fetch_sparql_endpoint_1$2=fetchSparqlEndpoint$2,lru_cache_1$4=cjs,rdf_data_factory_1$7=rdfDataFactory,rdf_terms_1$3=rdfTerms,sparqlalgebrajs_1$7=sparqlalgebrajs,DF$7=new rdf_data_factory_1$7.DataFactory,BF$4=new bindings_factory_1$4.BindingsFactory,VAR_COUNT=DF$7.variable("count");class RdfSourceSparql{constructor(url,context2,mediatorHttp,forceHttpGet,cacheSize){this.url=url,this.context=context2,this.mediatorHttp=mediatorHttp,this.endpointFetcher=new fetch_sparql_endpoint_1$2.SparqlEndpointFetcher({method:forceHttpGet?"GET":"POST",fetch:(input,init2)=>this.mediatorHttp.mediate({input,init:init2,context:this.context}),prefixVariableQuestionMark:!0}),this.cache=cacheSize>0?new lru_cache_1$4.LRUCache({max:cacheSize}):void 0}static replaceBlankNodes(pattern){const variableNames=(0,rdf_terms_1$3.getVariables)((0,rdf_terms_1$3.getTerms)(pattern)).map(variableTerm=>variableTerm.value),blankMap={};let changed=!1;const result=(0,rdf_terms_1$3.mapTermsNested)(pattern,term=>{if(term.termType==="BlankNode"){let name=term.value;if(blankMap[name])name=blankMap[name];else{if(variableNames.includes(name)){let idx=0;for(;variableNames.includes(`${name}${idx}`);)++idx;name+=idx}blankMap[term.value]=name,variableNames.push(name)}return changed=!0,DF$7.variable(name)}return term});return changed?result:pattern}static patternToBgp(pattern){return RdfSourceSparql.FACTORY.createBgp([RdfSourceSparql.FACTORY.createPattern(pattern.subject,pattern.predicate,pattern.object,pattern.graph)])}static patternToSelectQuery(pattern){const variables2=(0,rdf_terms_1$3.getVariables)((0,rdf_terms_1$3.getTerms)(pattern));return(0,sparqlalgebrajs_1$7.toSparql)(RdfSourceSparql.FACTORY.createProject(RdfSourceSparql.patternToBgp(pattern),variables2),{sparqlStar:!0})}static patternToCountQuery(pattern){return(0,sparqlalgebrajs_1$7.toSparql)(RdfSourceSparql.FACTORY.createProject(RdfSourceSparql.FACTORY.createExtend(RdfSourceSparql.FACTORY.createGroup(RdfSourceSparql.patternToBgp(pattern),[],[RdfSourceSparql.FACTORY.createBoundAggregate(DF$7.variable("var0"),"count",RdfSourceSparql.FACTORY.createWildcardExpression(),!1)]),DF$7.variable("count"),RdfSourceSparql.FACTORY.createTermExpression(DF$7.variable("var0"))),[DF$7.variable("count")]),{sparqlStar:!0})}queryBindings(endpoint,query){const rawStream=this.endpointFetcher.fetchBindings(endpoint,query);return(0,asynciterator_1$8.wrap)(rawStream,{autoStart:!1,maxBufferSize:Number.POSITIVE_INFINITY}).map(rawData=>BF$4.bindings(Object.entries(rawData).map(([key,value])=>[DF$7.variable(key.slice(1)),value])))}match(subject2,predicate2,object2,graph){const pattern=RdfSourceSparql.replaceBlankNodes(RdfSourceSparql.FACTORY.createPattern(subject2,predicate2,object2,graph)),countQuery=RdfSourceSparql.patternToCountQuery(pattern),selectQuery=RdfSourceSparql.patternToSelectQuery(pattern);new Promise(resolve2=>{var _a2;const cachedCardinality=(_a2=this.cache)==null?void 0:_a2.get(countQuery);if(cachedCardinality!==void 0)return resolve2(cachedCardinality);const bindingsStream=this.queryBindings(this.url,countQuery);bindingsStream.on("data",bindings=>{var _a3;const count2=bindings.get(VAR_COUNT),cardinality={type:"estimate",value:Number.POSITIVE_INFINITY};if(count2){const cardinalityValue=Number.parseInt(count2.value,10);Number.isNaN(cardinalityValue)||(cardinality.type="exact",cardinality.value=cardinalityValue,(_a3=this.cache)==null||_a3.set(countQuery,cardinality))}return resolve2(cardinality)}),bindingsStream.on("error",()=>resolve2({type:"estimate",value:Number.POSITIVE_INFINITY})),bindingsStream.on("end",()=>resolve2({type:"estimate",value:Number.POSITIVE_INFINITY}))}).then(cardinality=>quads.setProperty("metadata",{cardinality,canContainUndefs:!1}));const quads=new asynciterator_1$8.TransformIterator(async()=>this.queryBindings(this.url,selectQuery),{autoStart:!1}).transform({map:bindings=>(0,rdf_terms_1$3.mapTermsNested)(pattern,value=>{if(value.termType==="Variable"){const boundValue=bindings.get(value);return boundValue||quads.destroy(new Error(`The endpoint ${this.url} failed to provide a binding for ${value.value}.`)),boundValue}return value}),autoStart:!1});return quads}}__name(RdfSourceSparql,"RdfSourceSparql");RdfSourceSparql$1.RdfSourceSparql=RdfSourceSparql;RdfSourceSparql.FACTORY=new sparqlalgebrajs_1$7.Factory;Object.defineProperty(ActorRdfResolveHypermediaSparql$1,"__esModule",{value:!0});ActorRdfResolveHypermediaSparql$1.ActorRdfResolveHypermediaSparql=void 0;const bus_rdf_resolve_hypermedia_1$1=lib$1f,RdfSourceSparql_1=RdfSourceSparql$1;class ActorRdfResolveHypermediaSparql extends bus_rdf_resolve_hypermedia_1$1.ActorRdfResolveHypermedia{constructor(args){super(args,"sparql")}async testMetadata(action){if(!action.forceSourceType&&!action.metadata.sparqlService&&!(this.checkUrlSuffix&&action.url.endsWith("/sparql")))throw new Error(`Actor ${this.name} could not detect a SPARQL service description or URL ending on /sparql.`);return{filterFactor:1}}async run(action){return this.logInfo(action.context,`Identified as sparql source: ${action.url}`),{source:new RdfSourceSparql_1.RdfSourceSparql(action.metadata.sparqlService||action.url,action.context,this.mediatorHttp,this.forceHttpGet,this.cacheSize)}}}__name(ActorRdfResolveHypermediaSparql,"ActorRdfResolveHypermediaSparql");ActorRdfResolveHypermediaSparql$1.ActorRdfResolveHypermediaSparql=ActorRdfResolveHypermediaSparql;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermediaSparql$1,exports)})(lib$B);var lib$A={},ActorRdfUpdateHypermediaPatchSparqlUpdate$1={},lib$z={},ActorRdfUpdateHypermedia$1={};Object.defineProperty(ActorRdfUpdateHypermedia$1,"__esModule",{value:!0});ActorRdfUpdateHypermedia$1.ActorRdfUpdateHypermedia=void 0;const core_1$1=lib$2A;class ActorRdfUpdateHypermedia extends core_1$1.Actor{constructor(args,destinationType){super(args),this.destinationType=destinationType}async test(action){if(action.forceDestinationType&&this.destinationType!==action.forceDestinationType)throw new Error(`Actor ${this.name} is not able to handle destination type ${action.forceDestinationType}.`);return this.testMetadata(action)}}__name(ActorRdfUpdateHypermedia,"ActorRdfUpdateHypermedia");ActorRdfUpdateHypermedia$1.ActorRdfUpdateHypermedia=ActorRdfUpdateHypermedia;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfUpdateHypermedia$1,exports)})(lib$z);var QuadDestinationPatchSparqlUpdate$1={};Object.defineProperty(QuadDestinationPatchSparqlUpdate$1,"__esModule",{value:!0});QuadDestinationPatchSparqlUpdate$1.QuadDestinationPatchSparqlUpdate=void 0;const bus_http_1$3=lib$1Y,bus_rdf_update_quads_1$3=lib$19,cross_fetch_1$2=browserPonyfillExports,rdf_string_ttl_1$1=rdfStringTtl,readable_stream_1$4=browserExports$1;class QuadDestinationPatchSparqlUpdate{constructor(url,context2,mediatorHttp){this.url=url,this.context=context2,this.mediatorHttp=mediatorHttp}insert(quads){return this.wrapSparqlUpdateRequest("INSERT",quads)}async delete(quads){return this.wrapSparqlUpdateRequest("DELETE",quads)}async wrapSparqlUpdateRequest(type,quads){const dataWrapped=quads.map(quad=>{let stringQuad=`${(0,rdf_string_ttl_1$1.termToString)(quad.subject)} ${(0,rdf_string_ttl_1$1.termToString)(quad.predicate)} ${(0,rdf_string_ttl_1$1.termToString)(quad.object)} .`;return quad.graph.termType!=="DefaultGraph"?stringQuad=`  GRAPH ${(0,rdf_string_ttl_1$1.termToString)(quad.graph)} { ${stringQuad} }
`:stringQuad=`  ${stringQuad}
`,stringQuad}).prepend([`${type} DATA {
`]).append(["}"]),readable=new readable_stream_1$4.Readable;readable._read=()=>!0,dataWrapped.on("data",quad=>readable.push(quad)),dataWrapped.on("end",()=>readable.push(null));const headers=new cross_fetch_1$2.Headers({"content-type":"application/sparql-update"}),httpResponse=await this.mediatorHttp.mediate({context:this.context,init:{headers,method:"PATCH",body:bus_http_1$3.ActorHttp.toWebReadableStream(readable)},input:this.url});await(0,bus_rdf_update_quads_1$3.validateHttpResponse)(this.url,httpResponse)}async deleteGraphs(graphs,requireExistence,dropGraphs){throw new Error("Patch-based SPARQL Update destinations don't support named graphs")}async createGraphs(graphs,requireNonExistence){throw new Error("Patch-based SPARQL Update destinations don't support named graphs")}}__name(QuadDestinationPatchSparqlUpdate,"QuadDestinationPatchSparqlUpdate");QuadDestinationPatchSparqlUpdate$1.QuadDestinationPatchSparqlUpdate=QuadDestinationPatchSparqlUpdate;Object.defineProperty(ActorRdfUpdateHypermediaPatchSparqlUpdate$1,"__esModule",{value:!0});ActorRdfUpdateHypermediaPatchSparqlUpdate$1.ActorRdfUpdateHypermediaPatchSparqlUpdate=void 0;const bus_rdf_update_hypermedia_1$2=lib$z,QuadDestinationPatchSparqlUpdate_1=QuadDestinationPatchSparqlUpdate$1;class ActorRdfUpdateHypermediaPatchSparqlUpdate extends bus_rdf_update_hypermedia_1$2.ActorRdfUpdateHypermedia{constructor(args){super(args,"patchSparqlUpdate")}async testMetadata(action){if(!action.forceDestinationType&&!action.metadata.patchSparqlUpdate)throw new Error(`Actor ${this.name} could not detect a destination with 'application/sparql-update' as 'Accept-Patch' header.`);if(!action.forceDestinationType&&!action.exists)throw new Error(`Actor ${this.name} can only patch a destination that already exists.`);return!0}async run(action){return this.logInfo(action.context,`Identified as patchSparqlUpdate destination: ${action.url}`),{destination:new QuadDestinationPatchSparqlUpdate_1.QuadDestinationPatchSparqlUpdate(action.url,action.context,this.mediatorHttp)}}}__name(ActorRdfUpdateHypermediaPatchSparqlUpdate,"ActorRdfUpdateHypermediaPatchSparqlUpdate");ActorRdfUpdateHypermediaPatchSparqlUpdate$1.ActorRdfUpdateHypermediaPatchSparqlUpdate=ActorRdfUpdateHypermediaPatchSparqlUpdate;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfUpdateHypermediaPatchSparqlUpdate$1,exports),__exportStar(QuadDestinationPatchSparqlUpdate$1,exports)})(lib$A);var lib$y={},ActorRdfUpdateHypermediaPutLdp$1={},QuadDestinationPutLdp$1={};Object.defineProperty(QuadDestinationPutLdp$1,"__esModule",{value:!0});QuadDestinationPutLdp$1.QuadDestinationPutLdp=void 0;const bus_http_1$2=lib$1Y,bus_rdf_update_quads_1$2=lib$19,cross_fetch_1$1=browserPonyfillExports;class QuadDestinationPutLdp{constructor(url,context2,mediaTypes,mediatorHttp,mediatorRdfSerializeMediatypes,mediatorRdfSerialize){this.url=url,this.context=context2,this.mediaTypes=mediaTypes,this.mediatorHttp=mediatorHttp,this.mediatorRdfSerializeMediatypes=mediatorRdfSerializeMediatypes,this.mediatorRdfSerialize=mediatorRdfSerialize}insert(quads){return this.wrapRdfUpdateRequest("INSERT",quads)}async delete(quads){throw new Error("Put-based LDP destinations don't support deletions")}async wrapRdfUpdateRequest(type,quads){const{mediaTypes}=await this.mediatorRdfSerializeMediatypes.mediate({context:this.context,mediaTypes:!0}),availableMediaTypes=this.mediaTypes.filter(mediaType2=>mediaType2 in mediaTypes),mediaType=availableMediaTypes.length>0?availableMediaTypes[0]:Object.keys(mediaTypes).sort((typeA,typeB)=>mediaTypes[typeB]-mediaTypes[typeA])[0],{handle:{data}}=await this.mediatorRdfSerialize.mediate({context:this.context,handle:{quadStream:quads,context:this.context},handleMediaType:mediaType}),headers=new cross_fetch_1$1.Headers({"content-type":mediaType}),httpResponse=await this.mediatorHttp.mediate({context:this.context,init:{headers,method:"PUT",body:bus_http_1$2.ActorHttp.toWebReadableStream(data)},input:this.url});await(0,bus_rdf_update_quads_1$2.validateHttpResponse)(this.url,httpResponse)}async deleteGraphs(graphs,requireExistence,dropGraphs){throw new Error("Put-based LDP destinations don't support named graphs")}async createGraphs(graphs,requireNonExistence){throw new Error("Put-based LDP destinations don't support named graphs")}}__name(QuadDestinationPutLdp,"QuadDestinationPutLdp");QuadDestinationPutLdp$1.QuadDestinationPutLdp=QuadDestinationPutLdp;Object.defineProperty(ActorRdfUpdateHypermediaPutLdp$1,"__esModule",{value:!0});ActorRdfUpdateHypermediaPutLdp$1.ActorRdfUpdateHypermediaPutLdp=void 0;const bus_rdf_update_hypermedia_1$1=lib$z,QuadDestinationPutLdp_1=QuadDestinationPutLdp$1;class ActorRdfUpdateHypermediaPutLdp extends bus_rdf_update_hypermedia_1$1.ActorRdfUpdateHypermedia{constructor(args){super(args,"putLdp")}async testMetadata(action){if(!action.forceDestinationType){if(!action.metadata.allowHttpMethods||!action.metadata.allowHttpMethods.includes("PUT"))throw new Error(`Actor ${this.name} could not detect a destination with 'Allow: PUT' header.`);if(action.exists)throw new Error(`Actor ${this.name} can only put on a destination that does not already exists.`)}return!0}async run(action){return this.logInfo(action.context,`Identified as putLdp destination: ${action.url}`),{destination:new QuadDestinationPutLdp_1.QuadDestinationPutLdp(action.url,action.context,action.metadata.putAccepted||[],this.mediatorHttp,this.mediatorRdfSerializeMediatypes,this.mediatorRdfSerialize)}}}__name(ActorRdfUpdateHypermediaPutLdp,"ActorRdfUpdateHypermediaPutLdp");ActorRdfUpdateHypermediaPutLdp$1.ActorRdfUpdateHypermediaPutLdp=ActorRdfUpdateHypermediaPutLdp;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfUpdateHypermediaPutLdp$1,exports),__exportStar(QuadDestinationPutLdp$1,exports)})(lib$y);var lib$x={},ActorRdfUpdateHypermediaSparql$1={},QuadDestinationSparql$1={},fetchSparqlEndpoint$1={},SparqlEndpointFetcher$3={};Object.defineProperty(SparqlEndpointFetcher$3,"__esModule",{value:!0});SparqlEndpointFetcher$3.SparqlEndpointFetcher=void 0;const abort_controller_1$1=browserExports$2,sparqljs_1$1=sparql$1,sparqljson_parse_1$1=sparqljsonParse,sparqlxml_parse_1$1=sparqlxmlParse,stringifyStream$3=streamToString$1,readable_web_to_node_stream_1$1=lib$2C,n3$1=require$$0$3,isStream$1=isStream_1;let SparqlEndpointFetcher$2=__name(class SparqlEndpointFetcher2{constructor(args){args=args||{},this.method=args.method||"POST",this.additionalUrlParams=args.additionalUrlParams||new URLSearchParams,this.defaultHeaders=args.defaultHeaders||new Headers,this.fetchCb=args.fetch,this.sparqlJsonParser=new sparqljson_parse_1$1.SparqlJsonParser(args),this.sparqlXmlParser=new sparqlxml_parse_1$1.SparqlXmlParser(args),this.sparqlParsers={[SparqlEndpointFetcher2.CONTENTTYPE_SPARQL_JSON]:{parseBooleanStream:sparqlResponseStream=>this.sparqlJsonParser.parseJsonBooleanStream(sparqlResponseStream),parseResultsStream:sparqlResponseStream=>this.sparqlJsonParser.parseJsonResultsStream(sparqlResponseStream)},[SparqlEndpointFetcher2.CONTENTTYPE_SPARQL_XML]:{parseBooleanStream:sparqlResponseStream=>this.sparqlXmlParser.parseXmlBooleanStream(sparqlResponseStream),parseResultsStream:sparqlResponseStream=>this.sparqlXmlParser.parseXmlResultsStream(sparqlResponseStream)}},this.timeout=args.timeout}getQueryType(query){const parsedQuery=new sparqljs_1$1.Parser().parse(query);return parsedQuery.type==="query"?parsedQuery.queryType==="DESCRIBE"?"CONSTRUCT":parsedQuery.queryType:"UNKNOWN"}getUpdateTypes(query){const parsedQuery=new sparqljs_1$1.Parser().parse(query);if(parsedQuery.type==="update"){const operations={};for(const update11 of parsedQuery.updates)"type"in update11?operations[update11.type]=!0:operations[update11.updateType]=!0;return operations}else return"UNKNOWN"}async fetchBindings(endpoint,query){const[contentType,responseStream]=await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher2.CONTENTTYPE_SPARQL),parser=this.sparqlParsers[contentType];if(!parser)throw new Error("Unknown SPARQL results content type: "+contentType);return parser.parseResultsStream(responseStream)}async fetchAsk(endpoint,query){const[contentType,responseStream]=await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher2.CONTENTTYPE_SPARQL),parser=this.sparqlParsers[contentType];if(!parser)throw new Error("Unknown SPARQL results content type: "+contentType);return parser.parseBooleanStream(responseStream)}async fetchTriples(endpoint,query){return(await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher2.CONTENTTYPE_TURTLE))[1].pipe(new n3$1.StreamParser({format:SparqlEndpointFetcher2.CONTENTTYPE_TURTLE}))}async fetchUpdate(endpoint,query){const abortController=new abort_controller_1$1.default,defaultHeadersRaw={};this.defaultHeaders.forEach((value,key)=>{defaultHeadersRaw[key]=value});const init2={method:"POST",headers:Object.assign(Object.assign({},defaultHeadersRaw),{"content-type":"application/sparql-update"}),body:query,signal:abortController.signal};await this.handleFetchCall(endpoint,init2,{ignoreBody:!0}),abortController.abort()}async fetchRawStream(endpoint,query,acceptHeader){let url=this.method==="POST"?endpoint:endpoint+"?query="+encodeURIComponent(query);const headers=new Headers(this.defaultHeaders);let body;return headers.append("Accept",acceptHeader),this.method==="POST"?(headers.append("Content-Type","application/x-www-form-urlencoded"),body=new URLSearchParams,body.set("query",query),this.additionalUrlParams.forEach((value,key)=>{body.set(key,value)}),headers.append("Content-Length",body.toString().length.toString())):this.additionalUrlParams.toString()!==""&&(url+=`&${this.additionalUrlParams.toString()}`),this.handleFetchCall(url,{headers,method:this.method,body})}async handleFetchCall(url,init2,options={}){let timeoutId;if(this.timeout){const controller=new abort_controller_1$1.default;init2.signal=controller.signal,timeoutId=setTimeout(()=>controller.abort(),this.timeout)}const httpResponse=await(this.fetchCb||fetch)(url,init2);clearTimeout(timeoutId);let responseStream;options.ignoreBody||(responseStream=isStream$1(httpResponse.body)?httpResponse.body:new readable_web_to_node_stream_1$1.ReadableWebToNodeStream(httpResponse.body));let contentType=httpResponse.headers.get("Content-Type")||"";if(contentType.indexOf(";")>0&&(contentType=contentType.substr(0,contentType.indexOf(";"))),!httpResponse.ok){const simpleUrl=/^[^?]*/u.exec(url)[0];let bodyString="empty response";throw responseStream&&(bodyString=await stringifyStream$3(responseStream)),new Error(`Invalid SPARQL endpoint response from ${simpleUrl} (HTTP status ${httpResponse.status}):
${bodyString}`)}return[contentType,responseStream]}},"SparqlEndpointFetcher");SparqlEndpointFetcher$2.CONTENTTYPE_SPARQL_JSON="application/sparql-results+json";SparqlEndpointFetcher$2.CONTENTTYPE_SPARQL_XML="application/sparql-results+xml";SparqlEndpointFetcher$2.CONTENTTYPE_SPARQL=`${SparqlEndpointFetcher$2.CONTENTTYPE_SPARQL_JSON};q=1.0,${SparqlEndpointFetcher$2.CONTENTTYPE_SPARQL_XML};q=0.7`;SparqlEndpointFetcher$2.CONTENTTYPE_TURTLE="text/turtle";SparqlEndpointFetcher$3.SparqlEndpointFetcher=SparqlEndpointFetcher$2;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(SparqlEndpointFetcher$3,exports)})(fetchSparqlEndpoint$1);Object.defineProperty(QuadDestinationSparql$1,"__esModule",{value:!0});QuadDestinationSparql$1.QuadDestinationSparql=void 0;const fetch_sparql_endpoint_1$1=fetchSparqlEndpoint$1,rdf_string_ttl_1=rdfStringTtl,stringifyStream$2=streamToString$1;class QuadDestinationSparql{constructor(url,context2,mediatorHttp){this.url=url,this.context=context2,this.mediatorHttp=mediatorHttp,this.endpointFetcher=new fetch_sparql_endpoint_1$1.SparqlEndpointFetcher({fetch:(input,init2)=>this.mediatorHttp.mediate({input,init:init2,context:this.context}),prefixVariableQuestionMark:!0})}insert(quads){return this.wrapSparqlUpdateRequest("INSERT",quads)}async delete(quads){return this.wrapSparqlUpdateRequest("DELETE",quads)}async wrapSparqlUpdateRequest(type,quads){const dataWrapped=quads.map(quad=>{let stringQuad=`${(0,rdf_string_ttl_1.termToString)(quad.subject)} ${(0,rdf_string_ttl_1.termToString)(quad.predicate)} ${(0,rdf_string_ttl_1.termToString)(quad.object)} .`;return quad.graph.termType!=="DefaultGraph"?stringQuad=`  GRAPH ${(0,rdf_string_ttl_1.termToString)(quad.graph)} { ${stringQuad} }
`:stringQuad=`  ${stringQuad}
`,stringQuad}).prepend([`${type} DATA {
`]).append(["}"]),query=await stringifyStream$2(dataWrapped);await this.endpointFetcher.fetchUpdate(this.url,query)}async deleteGraphs(graphsIn,requireExistence,dropGraphs){const graphs=Array.isArray(graphsIn)?graphsIn:[graphsIn],queries=[];for(const graph of graphs){let graphValue;typeof graph=="string"?graphValue=graph:graph.termType==="DefaultGraph"?graphValue="DEFAULT":graphValue=`GRAPH <${graph.value}>`,queries.push(`${dropGraphs?"DROP":"CLEAR"} ${requireExistence?"":"SILENT "}${graphValue}`)}await this.endpointFetcher.fetchUpdate(this.url,queries.join("; "))}async createGraphs(graphs,requireNonExistence){const queries=[];for(const graph of graphs)queries.push(`CREATE${requireNonExistence?"":" SILENT"} GRAPH <${graph.value}>`);await this.endpointFetcher.fetchUpdate(this.url,queries.join("; "))}}__name(QuadDestinationSparql,"QuadDestinationSparql");QuadDestinationSparql$1.QuadDestinationSparql=QuadDestinationSparql;Object.defineProperty(ActorRdfUpdateHypermediaSparql$1,"__esModule",{value:!0});ActorRdfUpdateHypermediaSparql$1.ActorRdfUpdateHypermediaSparql=void 0;const bus_rdf_update_hypermedia_1=lib$z,QuadDestinationSparql_1=QuadDestinationSparql$1;class ActorRdfUpdateHypermediaSparql extends bus_rdf_update_hypermedia_1.ActorRdfUpdateHypermedia{constructor(args){super(args,"sparql")}async testMetadata(action){if(!action.forceDestinationType&&!action.metadata.sparqlService&&!(this.checkUrlSuffixSparql&&action.url.endsWith("/sparql"))&&!(this.checkUrlSuffixUpdate&&action.url.endsWith("/update")))throw new Error(`Actor ${this.name} could not detect a SPARQL service description or URL ending on /sparql or /update.`);return!0}async run(action){return this.logInfo(action.context,`Identified as sparql destination: ${action.url}`),{destination:new QuadDestinationSparql_1.QuadDestinationSparql(action.metadata.sparqlService||action.url,action.context,this.mediatorHttp)}}}__name(ActorRdfUpdateHypermediaSparql,"ActorRdfUpdateHypermediaSparql");ActorRdfUpdateHypermediaSparql$1.ActorRdfUpdateHypermediaSparql=ActorRdfUpdateHypermediaSparql;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfUpdateHypermediaSparql$1,exports),__exportStar(QuadDestinationSparql$1,exports)})(lib$x);var lib$w={},ActorQueryOperationSparqlEndpoint$1={},fetchSparqlEndpoint={},SparqlEndpointFetcher$1={};Object.defineProperty(SparqlEndpointFetcher$1,"__esModule",{value:!0});SparqlEndpointFetcher$1.SparqlEndpointFetcher=void 0;const abort_controller_1=browserExports$2,sparqljs_1=sparql$1,sparqljson_parse_1=sparqljsonParse,sparqlxml_parse_1=sparqlxmlParse,stringifyStream$1=streamToString$1,readable_web_to_node_stream_1=lib$2C,n3=require$$0$3,isStream=isStream_1;class SparqlEndpointFetcher3{constructor(args){args=args||{},this.method=args.method||"POST",this.additionalUrlParams=args.additionalUrlParams||new URLSearchParams,this.defaultHeaders=args.defaultHeaders||new Headers,this.fetchCb=args.fetch,this.sparqlJsonParser=new sparqljson_parse_1.SparqlJsonParser(args),this.sparqlXmlParser=new sparqlxml_parse_1.SparqlXmlParser(args),this.sparqlParsers={[SparqlEndpointFetcher3.CONTENTTYPE_SPARQL_JSON]:{parseBooleanStream:sparqlResponseStream=>this.sparqlJsonParser.parseJsonBooleanStream(sparqlResponseStream),parseResultsStream:sparqlResponseStream=>this.sparqlJsonParser.parseJsonResultsStream(sparqlResponseStream)},[SparqlEndpointFetcher3.CONTENTTYPE_SPARQL_XML]:{parseBooleanStream:sparqlResponseStream=>this.sparqlXmlParser.parseXmlBooleanStream(sparqlResponseStream),parseResultsStream:sparqlResponseStream=>this.sparqlXmlParser.parseXmlResultsStream(sparqlResponseStream)}},this.timeout=args.timeout}getQueryType(query){const parsedQuery=new sparqljs_1.Parser().parse(query);return parsedQuery.type==="query"?parsedQuery.queryType==="DESCRIBE"?"CONSTRUCT":parsedQuery.queryType:"UNKNOWN"}getUpdateTypes(query){const parsedQuery=new sparqljs_1.Parser().parse(query);if(parsedQuery.type==="update"){const operations={};for(const update11 of parsedQuery.updates)"type"in update11?operations[update11.type]=!0:operations[update11.updateType]=!0;return operations}else return"UNKNOWN"}async fetchBindings(endpoint,query){const[contentType,responseStream]=await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher3.CONTENTTYPE_SPARQL),parser=this.sparqlParsers[contentType];if(!parser)throw new Error("Unknown SPARQL results content type: "+contentType);return parser.parseResultsStream(responseStream)}async fetchAsk(endpoint,query){const[contentType,responseStream]=await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher3.CONTENTTYPE_SPARQL),parser=this.sparqlParsers[contentType];if(!parser)throw new Error("Unknown SPARQL results content type: "+contentType);return parser.parseBooleanStream(responseStream)}async fetchTriples(endpoint,query){return(await this.fetchRawStream(endpoint,query,SparqlEndpointFetcher3.CONTENTTYPE_TURTLE))[1].pipe(new n3.StreamParser({format:SparqlEndpointFetcher3.CONTENTTYPE_TURTLE}))}async fetchUpdate(endpoint,query){const abortController=new abort_controller_1.default,defaultHeadersRaw={};this.defaultHeaders.forEach((value,key)=>{defaultHeadersRaw[key]=value});const init2={method:"POST",headers:Object.assign(Object.assign({},defaultHeadersRaw),{"content-type":"application/sparql-update"}),body:query,signal:abortController.signal};await this.handleFetchCall(endpoint,init2,{ignoreBody:!0}),abortController.abort()}async fetchRawStream(endpoint,query,acceptHeader){let url=this.method==="POST"?endpoint:endpoint+"?query="+encodeURIComponent(query);const headers=new Headers(this.defaultHeaders);let body;return headers.append("Accept",acceptHeader),this.method==="POST"?(headers.append("Content-Type","application/x-www-form-urlencoded"),body=new URLSearchParams,body.set("query",query),this.additionalUrlParams.forEach((value,key)=>{body.set(key,value)}),headers.append("Content-Length",body.toString().length.toString())):this.additionalUrlParams.toString()!==""&&(url+=`&${this.additionalUrlParams.toString()}`),this.handleFetchCall(url,{headers,method:this.method,body})}async handleFetchCall(url,init2,options={}){let timeoutId;if(this.timeout){const controller=new abort_controller_1.default;init2.signal=controller.signal,timeoutId=setTimeout(()=>controller.abort(),this.timeout)}const httpResponse=await(this.fetchCb||fetch)(url,init2);clearTimeout(timeoutId);let responseStream;options.ignoreBody||(responseStream=isStream(httpResponse.body)?httpResponse.body:new readable_web_to_node_stream_1.ReadableWebToNodeStream(httpResponse.body));let contentType=httpResponse.headers.get("Content-Type")||"";if(contentType.indexOf(";")>0&&(contentType=contentType.substr(0,contentType.indexOf(";"))),!httpResponse.ok){const simpleUrl=/^[^?]*/u.exec(url)[0];let bodyString="empty response";throw responseStream&&(bodyString=await stringifyStream$1(responseStream)),new Error(`Invalid SPARQL endpoint response from ${simpleUrl} (HTTP status ${httpResponse.status}):
${bodyString}`)}return[contentType,responseStream]}}__name(SparqlEndpointFetcher3,"SparqlEndpointFetcher");SparqlEndpointFetcher3.CONTENTTYPE_SPARQL_JSON="application/sparql-results+json";SparqlEndpointFetcher3.CONTENTTYPE_SPARQL_XML="application/sparql-results+xml";SparqlEndpointFetcher3.CONTENTTYPE_SPARQL=`${SparqlEndpointFetcher3.CONTENTTYPE_SPARQL_JSON};q=1.0,${SparqlEndpointFetcher3.CONTENTTYPE_SPARQL_XML};q=0.7`;SparqlEndpointFetcher3.CONTENTTYPE_TURTLE="text/turtle";SparqlEndpointFetcher$1.SparqlEndpointFetcher=SparqlEndpointFetcher3;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(SparqlEndpointFetcher$1,exports)})(fetchSparqlEndpoint);var LazyCardinalityIterator$1={};Object.defineProperty(LazyCardinalityIterator$1,"__esModule",{value:!0});LazyCardinalityIterator$1.LazyCardinalityIterator=void 0;const asynciterator_1$7=asynciterator;class LazyCardinalityIterator extends asynciterator_1$7.AsyncIterator{constructor(_source){super(),this._source=_source,this._count=0,this._buffering=!0,_source[asynciterator_1$7.DESTINATION]=this,_source.on("readable",destinationSetReadable),_source.on("end",destinationSetReadable),_source.on("error",destinationEmitError),this.readable=_source.readable}read(){if(this._buffer)return this._buffer.empty?(this._buffering||this.close(),this.readable=!1,null):this._buffer.shift();let item=null;return this._source.readable&&(item=this._source.read())!==null?this._count+=1:(this.readable=!1,this._source.done&&this.close()),item}getCardinality(){return this._cardinality?this._cardinality:this._error?Promise.reject(this._error):(this._source.done&&this.close(),this.done?this._cardinality=Promise.resolve(this._count):(this._buffer=new asynciterator_1$7.LinkedList,this._cardinality=new Promise((resolve2,reject)=>{this._source.removeListener("readable",destinationSetReadable),this._source.removeListener("end",destinationSetReadable);const clean=__name(()=>{this._source.removeListener("data",onData),this._source.removeListener("end",onEnd),this._source.removeListener("error",onError)},"clean"),onData=__name(data=>{this._buffer.push(data),this._count+=1,this.readable=!0},"onData"),onEnd=__name(()=>{this._buffering=!1,clean(),resolve2(this._count)},"onEnd"),onError=__name(err=>{this._buffering=!1,clean(),reject(err)},"onError");this._source.on("data",onData),this._source.on("end",onEnd),this._source.on("error",onError)})),this._cardinality)}close(){this._source.removeListener("readable",destinationSetReadable),this._source.removeListener("end",destinationSetReadable),this._source.removeListener("error",destinationEmitError),delete this._source[asynciterator_1$7.DESTINATION],this._source.destroy(),super.close()}}__name(LazyCardinalityIterator,"LazyCardinalityIterator");LazyCardinalityIterator$1.LazyCardinalityIterator=LazyCardinalityIterator;function destinationSetReadable(){this[asynciterator_1$7.DESTINATION].readable=!0}__name(destinationSetReadable,"destinationSetReadable");function destinationEmitError(error){this[asynciterator_1$7.DESTINATION]._error=error,this[asynciterator_1$7.DESTINATION].emit("error",error)}__name(destinationEmitError,"destinationEmitError");Object.defineProperty(ActorQueryOperationSparqlEndpoint$1,"__esModule",{value:!0});ActorQueryOperationSparqlEndpoint$1.ActorQueryOperationSparqlEndpoint=void 0;const bindings_factory_1$3=lib$2v,bus_query_operation_1$h=lib$2y,bus_rdf_resolve_quad_pattern_1$2=lib$1g,bus_rdf_update_quads_1$1=lib$19,context_entries_1$9=lib$2x,metadata_1$5=lib$2h,asynciterator_1$6=asynciterator,fetch_sparql_endpoint_1=fetchSparqlEndpoint,rdf_data_factory_1$6=rdfDataFactory,sparqlalgebrajs_1$6=sparqlalgebrajs,LazyCardinalityIterator_1=LazyCardinalityIterator$1,BF$3=new bindings_factory_1$3.BindingsFactory,DF$6=new rdf_data_factory_1$6.DataFactory;class ActorQueryOperationSparqlEndpoint extends bus_query_operation_1$h.ActorQueryOperation{constructor(args){super(args),this.endpointFetcher=new fetch_sparql_endpoint_1.SparqlEndpointFetcher({method:args.forceHttpGet?"GET":"POST",fetch:(input,init2)=>this.mediatorHttp.mediate({input,init:init2,context:this.lastContext}),prefixVariableQuestionMark:!0})}async test(action){if(!action.operation)throw new Error("Missing field 'operation' in a query operation action.");const source=(0,bus_rdf_resolve_quad_pattern_1$2.getContextSourceFirst)(action.context),destination=(0,bus_rdf_update_quads_1$1.getContextDestinationFirst)(action.context),sourceType=source?(0,bus_rdf_resolve_quad_pattern_1$2.getDataSourceType)(source):void 0,destinationType=destination?(0,bus_rdf_update_quads_1$1.getDataDestinationType)(destination):void 0,sourceValue=source?(0,bus_rdf_resolve_quad_pattern_1$2.getDataSourceValue)(source):void 0,destinationValue=destination?(0,bus_rdf_update_quads_1$1.getDataDestinationValue)(destination):void 0;if(source&&sourceType==="sparql"&&(!destination||destinationType==="sparql"&&destinationValue===sourceValue)||source&&!sourceType&&(!destination||!destinationType&&destinationValue===sourceValue)&&typeof sourceValue=="string"&&(this.checkUrlSuffixSparql&&sourceValue.endsWith("/sparql")||this.checkUrlSuffixUpdate&&sourceValue.endsWith("/update")))return{httpRequests:1};throw new Error(`${this.name} requires a single source with a 'sparql' endpoint to be present in the context or URL ending on /sparql or /update.`)}async run(action){const source=(0,bus_rdf_resolve_quad_pattern_1$2.getContextSourceFirst)(action.context);if(!source)throw new Error("Illegal state: undefined sparql endpoint source.");const endpoint=(0,bus_rdf_resolve_quad_pattern_1$2.getDataSourceValue)(source);this.lastContext=action.context;let query,type,variables2;try{query=action.context.get(context_entries_1$9.KeysInitQuery.queryString)??(0,sparqlalgebrajs_1$6.toSparql)(action.operation),type=this.endpointFetcher.getQueryType(query),type==="UNKNOWN"&&(type=this.endpointFetcher.getUpdateTypes(query))}catch{}(!type||type==="UNKNOWN")&&(variables2=sparqlalgebrajs_1$6.Util.inScopeVariables(action.operation),query=(0,sparqlalgebrajs_1$6.toSparql)(ActorQueryOperationSparqlEndpoint.FACTORY.createProject(action.operation,variables2)),type="SELECT");const canContainUndefs=this.canOperationContainUndefs(action.operation);switch(type){case"SELECT":return variables2||(variables2=sparqlalgebrajs_1$6.Util.inScopeVariables(action.operation)),this.executeQuery(endpoint,query,!1,variables2,canContainUndefs);case"CONSTRUCT":return this.executeQuery(endpoint,query,!0,void 0,!1);case"ASK":return{type:"boolean",execute:()=>this.endpointFetcher.fetchAsk(endpoint,query)};default:return{type:"void",execute:()=>this.endpointFetcher.fetchUpdate(endpoint,query)}}}executeQuery(endpoint,query,quads,variables2,canContainUndefs){const inputStream=quads?this.endpointFetcher.fetchTriples(endpoint,query):this.endpointFetcher.fetchBindings(endpoint,query),stream=(0,asynciterator_1$6.wrap)(inputStream,{autoStart:!1}).map(rawData=>quads?rawData:BF$3.bindings(Object.entries(rawData).map(([key,value])=>[DF$6.variable(key.slice(1)),value]))),resultStream=new LazyCardinalityIterator_1.LazyCardinalityIterator(stream),metadata=ActorQueryOperationSparqlEndpoint.cachifyMetadata(async()=>({state:new metadata_1$5.MetadataValidationState,cardinality:{type:"exact",value:await resultStream.getCardinality()},canContainUndefs,variables:variables2}));return quads?{type:"quads",quadStream:resultStream,metadata}:{type:"bindings",bindingsStream:resultStream,metadata}}canOperationContainUndefs(operation){let canContainUndefs=!1;return sparqlalgebrajs_1$6.Util.recurseOperation(operation,{[sparqlalgebrajs_1$6.Algebra.types.LEFT_JOIN](){return canContainUndefs=!0,!1},[sparqlalgebrajs_1$6.Algebra.types.VALUES](op){for(const bindings of op.bindings){const bindingsKeys=Object.keys(bindings);op.variables.every(variable=>bindingsKeys.includes(`?${variable.value}`))||(canContainUndefs=!0)}return!1}}),canContainUndefs}}__name(ActorQueryOperationSparqlEndpoint,"ActorQueryOperationSparqlEndpoint");ActorQueryOperationSparqlEndpoint$1.ActorQueryOperationSparqlEndpoint=ActorQueryOperationSparqlEndpoint;ActorQueryOperationSparqlEndpoint.FACTORY=new sparqlalgebrajs_1$6.Factory;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationSparqlEndpoint$1,exports)})(lib$w);var lib$v={},ActorDereferenceRdfParse$1={},lib$u={},ActorDereferenceRdf$1={};Object.defineProperty(ActorDereferenceRdf$1,"__esModule",{value:!0});ActorDereferenceRdf$1.ActorDereferenceRdf=void 0;const bus_dereference_1$1=lib$1W;class ActorDereferenceRdf extends bus_dereference_1$1.ActorDereferenceParse{constructor(args){super(args)}}__name(ActorDereferenceRdf,"ActorDereferenceRdf");ActorDereferenceRdf$1.ActorDereferenceRdf=ActorDereferenceRdf;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorDereferenceRdf$1,exports)})(lib$u);Object.defineProperty(ActorDereferenceRdfParse$1,"__esModule",{value:!0});ActorDereferenceRdfParse$1.ActorDereferenceRdfParse=void 0;const bus_dereference_rdf_1=lib$u;class ActorDereferenceRdfParse extends bus_dereference_rdf_1.ActorDereferenceRdf{constructor(args){super(args)}async getMetadata(dereference){return{baseIRI:dereference.url}}}__name(ActorDereferenceRdfParse,"ActorDereferenceRdfParse");ActorDereferenceRdfParse$1.ActorDereferenceRdfParse=ActorDereferenceRdfParse;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorDereferenceRdfParse$1,exports)})(lib$v);var lib$t={},ActorRdfParseHtmlScript$1={},HtmlScriptListener$1={};Object.defineProperty(HtmlScriptListener$1,"__esModule",{value:!0});HtmlScriptListener$1.HtmlScriptListener=void 0;const context_entries_1$8=lib$2x,readable_stream_1$3=browserExports$1,relative_to_absolute_iri_1$1=relativeToAbsoluteIri;class HtmlScriptListener{constructor(mediatorRdfParseHandle,cbQuad,cbError,cbEnd,supportedTypes,context2,baseIRI,headers){this.textChunksJsonLd=[],this.endBarrier=1,this.passedScripts=0,this.isFinalJsonLdProcessing=!1,this.mediatorRdfParseHandle=mediatorRdfParseHandle,this.cbQuad=cbQuad,this.cbError=cbError,this.cbEnd=cbEnd,this.supportedTypes=supportedTypes,this.context=context2.set(context_entries_1$8.KeysRdfParseHtmlScript.processingHtmlScript,!0),this.baseIRI=baseIRI,this.headers=headers,this.onlyFirstScript=context2.get(context_entries_1$8.KeysRdfParseHtmlScript.extractAllScripts)===!1;const fragmentPos=this.baseIRI.indexOf("#");this.targetScriptId=fragmentPos>0?this.baseIRI.slice(fragmentPos+1,this.baseIRI.length):null}static newErrorCoded(message,code){const error=new Error(message);return error.code=code,error}onEnd(){--this.endBarrier===0&&(this.textChunksJsonLd.length>0?(this.handleMediaType="application/ld+json",this.textChunks=this.textChunksJsonLd,this.textChunks.push("]"),this.textChunksJsonLd=[],this.isFinalJsonLdProcessing=!0,this.endBarrier++,this.onTagClose()):(this.passedScripts===0&&this.targetScriptId&&this.cbError(HtmlScriptListener.newErrorCoded(`Failed to find targeted script id "${this.targetScriptId}"`,"loading document failed")),this.cbEnd()),this.isFinalJsonLdProcessing=!1)}onTagClose(){if(this.handleMediaType)if(this.requiresCustomJsonLdHandling(this.handleMediaType)&&!this.isFinalJsonLdProcessing)this.handleMediaType=void 0,this.textChunks=void 0,this.onEnd();else{const textStream=new readable_stream_1$3.Readable({objectMode:!0});textStream._read=()=>{};const textChunksLocal=this.textChunks,parseAction={context:this.context,handle:{metadata:{baseIRI:this.baseIRI},data:textStream,headers:this.headers,context:this.context},handleMediaType:this.handleMediaType};this.mediatorRdfParseHandle.mediate(parseAction).then(({handle})=>{handle.data.on("error",error=>this.cbError(HtmlScriptListener.newErrorCoded(error.message,"invalid script element"))).on("data",this.cbQuad).on("end",()=>this.onEnd());for(const textChunk of textChunksLocal)textStream.push(textChunk);textStream.push(null)}).catch(error=>{this.targetScriptId?this.cbError(HtmlScriptListener.newErrorCoded(error.message,"loading document failed")):this.onEnd()}),this.handleMediaType=void 0,this.textChunks=void 0}}onTagOpen(name,attributes){name==="base"&&attributes.href&&(this.baseIRI=(0,relative_to_absolute_iri_1$1.resolve)(attributes.href,this.baseIRI)),name==="script"&&(!this.targetScriptId||attributes.id===this.targetScriptId)?this.supportedTypes[attributes.type]?this.onlyFirstScript&&this.passedScripts>0?this.handleMediaType=void 0:(this.passedScripts++,this.handleMediaType=attributes.type,this.endBarrier++,this.requiresCustomJsonLdHandling(this.handleMediaType)?(this.textChunks=this.textChunksJsonLd,this.textChunks.push(this.textChunks.length===0?"[":",")):this.textChunks=[]):this.targetScriptId&&this.cbError(HtmlScriptListener.newErrorCoded(`Targeted script "${this.targetScriptId}" does not have a supported type`,"loading document failed")):this.handleMediaType=void 0}onText(data){this.handleMediaType&&this.textChunks.push(data)}requiresCustomJsonLdHandling(mediaType){return!this.onlyFirstScript&&!this.targetScriptId&&mediaType==="application/ld+json"}}__name(HtmlScriptListener,"HtmlScriptListener");HtmlScriptListener$1.HtmlScriptListener=HtmlScriptListener;Object.defineProperty(ActorRdfParseHtmlScript$1,"__esModule",{value:!0});ActorRdfParseHtmlScript$1.ActorRdfParseHtmlScript=void 0;const bus_rdf_parse_html_1=lib$1l,HtmlScriptListener_1=HtmlScriptListener$1;class ActorRdfParseHtmlScript extends bus_rdf_parse_html_1.ActorRdfParseHtml{constructor(args){super(args)}async test(action){return!0}async run(action){const supportedTypes=(await this.mediatorRdfParseMediatypes.mediate({context:action.context,mediaTypes:!0})).mediaTypes;return{htmlParseListener:new HtmlScriptListener_1.HtmlScriptListener(this.mediatorRdfParseHandle,action.emit,action.error,action.end,supportedTypes,action.context,action.baseIRI,action.headers)}}}__name(ActorRdfParseHtmlScript,"ActorRdfParseHtmlScript");ActorRdfParseHtmlScript$1.ActorRdfParseHtmlScript=ActorRdfParseHtmlScript;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfParseHtmlScript$1,exports)})(lib$t);var lib$s={},ActorRdfJoinMinusHash$1={},lib$r={},ActorRdfJoin$1={};Object.defineProperty(ActorRdfJoin$1,"__esModule",{value:!0});ActorRdfJoin$1.ActorRdfJoin=void 0;const bus_query_operation_1$g=lib$2y,context_entries_1$7=lib$2x,core_1=lib$2A,metadata_1$4=lib$2h,rdf_data_factory_1$5=rdfDataFactory,rdf_string_1$4=rdfString,DF$5=new rdf_data_factory_1$5.DataFactory;class ActorRdfJoin extends core_1.Actor{constructor(args,options){super(args),this.includeInLogs=!0,this.logicalType=options.logicalType,this.physicalName=options.physicalName,this.limitEntries=options.limitEntries??Number.POSITIVE_INFINITY,this.limitEntriesMin=options.limitEntriesMin??!1,this.canHandleUndefs=options.canHandleUndefs??!1}static hash(bindings,variables2){return variables2.filter(variable=>bindings.has(variable)).map(variable=>(0,rdf_string_1$4.termToString)(bindings.get(variable))).join("")}static overlappingVariables(metadatas){const variables2=metadatas.map(metadata=>metadata.variables);let baseArray=variables2[0];for(const array of variables2.slice(1))baseArray=baseArray.filter(el=>array.some(value=>value.value===el.value));return baseArray}static joinVariables(metadatas){return[...new Set(metadatas.flatMap(metadata=>metadata.variables.map(variable=>variable.value)))].map(variable=>DF$5.variable(variable))}static joinBindings(...bindings){if(bindings.length===0)return null;if(bindings.length===1)return bindings[0];let acc=bindings[0];for(const binding of bindings.slice(1)){const merged=acc.merge(binding);if(!merged)return null;acc=merged}return acc}static getCardinality(metadata){return metadata.cardinality}static async getMetadatas(entries3){return await Promise.all(entries3.map(entry=>entry.output.metadata()))}static async getEntriesWithMetadatas(entries3){const metadatas=await ActorRdfJoin.getMetadatas(entries3);return entries3.map((entry,i)=>({...entry,metadata:metadatas[i]}))}static getRequestInitialTimes(metadatas){return metadatas.map(metadata=>metadata.pageSize?0:metadata.requestTime||0)}static getRequestItemTimes(metadatas){return metadatas.map(metadata=>metadata.pageSize?(metadata.requestTime||0)/metadata.pageSize:0)}async constructResultMetadata(entries3,metadatas,context2,partialMetadata={}){let cardinalityJoined;partialMetadata.cardinality?cardinalityJoined=partialMetadata.cardinality:(cardinalityJoined=metadatas.reduce((acc,metadata)=>{const cardinalityThis=ActorRdfJoin.getCardinality(metadata);return{type:cardinalityThis.type==="estimate"?"estimate":acc.type,value:acc.value*cardinalityThis.value}},{type:"exact",value:1}),cardinalityJoined.value*=(await this.mediatorJoinSelectivity.mediate({entries:entries3,context:context2})).selectivity);const state=new metadata_1$4.MetadataValidationState,invalidateListener=__name(()=>state.invalidate(),"invalidateListener");for(const metadata of metadatas)metadata.state.addInvalidateListener(invalidateListener);return{state,...partialMetadata,cardinality:{type:cardinalityJoined.type,value:cardinalityJoined.value},canContainUndefs:partialMetadata.canContainUndefs??metadatas.some(metadata=>metadata.canContainUndefs),variables:ActorRdfJoin.joinVariables(metadatas)}}async test(action){if(action.type!==this.logicalType)throw new Error(`${this.name} can only handle logical joins of type '${this.logicalType}', while '${action.type}' was given.`);if(action.entries.length<=1)throw new Error(`${this.name} requires at least two join entries.`);if(this.limitEntriesMin?action.entries.length<this.limitEntries:action.entries.length>this.limitEntries)throw new Error(`${this.name} requires ${this.limitEntries} join entries at ${this.limitEntriesMin?"least":"most"}. The input contained ${action.entries.length}.`);for(const entry of action.entries)if(entry.output.type!=="bindings")throw new Error(`Invalid type of a join entry: Expected 'bindings' but got '${entry.output.type}'`);const metadatas=await ActorRdfJoin.getMetadatas(action.entries);if(!this.canHandleUndefs){for(const metadata of metadatas)if(metadata.canContainUndefs)throw new Error(`Actor ${this.name} can not join streams containing undefs`)}return await this.getJoinCoefficients(action,metadatas)}async run(action){let parentPhysicalQueryPlanNode;action.context.has(context_entries_1$7.KeysInitQuery.physicalQueryPlanLogger)&&(parentPhysicalQueryPlanNode=action.context.get(context_entries_1$7.KeysInitQuery.physicalQueryPlanNode),action.context=action.context.set(context_entries_1$7.KeysInitQuery.physicalQueryPlanNode,action));const physicalQueryPlanLogger=action.context.get(context_entries_1$7.KeysInitQuery.physicalQueryPlanLogger);let planMetadata;this.includeInLogs&&physicalQueryPlanLogger&&(planMetadata={},physicalQueryPlanLogger.logOperation(`join-${this.logicalType}`,this.physicalName,action,parentPhysicalQueryPlanNode,this.name,planMetadata));const{result,physicalPlanMetadata}=await this.getOutput(action),metadatas=await ActorRdfJoin.getMetadatas(action.entries);return planMetadata&&(Object.assign(planMetadata,physicalPlanMetadata),planMetadata.cardinalities=metadatas.map(ActorRdfJoin.getCardinality),planMetadata.joinCoefficients=await this.getJoinCoefficients(action,metadatas)),result.metadata=bus_query_operation_1$g.ActorQueryOperation.cachifyMetadata(result.metadata),result}}__name(ActorRdfJoin,"ActorRdfJoin");ActorRdfJoin$1.ActorRdfJoin=ActorRdfJoin;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoin$1,exports)})(lib$r);Object.defineProperty(ActorRdfJoinMinusHash$1,"__esModule",{value:!0});ActorRdfJoinMinusHash$1.ActorRdfJoinMinusHash=void 0;const bus_query_operation_1$f=lib$2y,bus_rdf_join_1$b=lib$r;class ActorRdfJoinMinusHash extends bus_rdf_join_1$b.ActorRdfJoin{constructor(args){super(args,{logicalType:"minus",physicalName:"hash",limitEntries:2})}async getOutput(action){const buffer=action.entries[1].output,output=action.entries[0].output,metadatas=await bus_rdf_join_1$b.ActorRdfJoin.getMetadatas(action.entries),commonVariables=bus_rdf_join_1$b.ActorRdfJoin.overlappingVariables(metadatas);if(commonVariables.length>0){const index={};return{result:{type:"bindings",bindingsStream:new bus_query_operation_1$f.ClosableTransformIterator(async()=>(await new Promise(resolve2=>{buffer.bindingsStream.on("data",data=>{index[bus_rdf_join_1$b.ActorRdfJoin.hash(data,commonVariables)]=!0}),buffer.bindingsStream.on("end",resolve2)}),output.bindingsStream.filter(data=>!index[bus_rdf_join_1$b.ActorRdfJoin.hash(data,commonVariables)])),{autoStart:!1,onClose(){buffer.bindingsStream.destroy(),output.bindingsStream.destroy()}}),metadata:output.metadata}}}return buffer.bindingsStream.destroy(),{result:output}}async getJoinCoefficients(action,metadatas){const requestInitialTimes=bus_rdf_join_1$b.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$b.ActorRdfJoin.getRequestItemTimes(metadatas);return{iterations:metadatas[0].cardinality.value+metadatas[1].cardinality.value,persistedItems:metadatas[0].cardinality.value,blockingItems:metadatas[0].cardinality.value,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1]}}}__name(ActorRdfJoinMinusHash,"ActorRdfJoinMinusHash");ActorRdfJoinMinusHash$1.ActorRdfJoinMinusHash=ActorRdfJoinMinusHash;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinMinusHash$1,exports)})(lib$s);var lib$q={},ActorRdfJoinMinusHashUndef$1={},BindingsIndex$1={};Object.defineProperty(BindingsIndex$1,"__esModule",{value:!0});BindingsIndex$1.BindingsIndex=void 0;const rdf_string_1$3=rdfString;class BindingsIndex{constructor(keys2){this.data={},this.keys=keys2}static hashTerm(term){return term&&term.termType!=="Variable"?(0,rdf_string_1$3.termToString)(term):""}add(bindings){if(this.isBindingsValid(bindings)){let dataIt=this.data;for(const key of this.keys){const dataKey=BindingsIndex.hashTerm(bindings.get(key));let subDataIt=dataIt[dataKey];subDataIt||(subDataIt=dataIt[dataKey]={}),dataIt=subDataIt}}}contains(bindings){return this.isBindingsValid(bindings)?this.containsRecursive(bindings,this.keys,[this.data]):!1}isBindingsValid(bindings){let validKeys=!1;for(const key of this.keys)if(bindings.get(key)){validKeys=!0;break}return validKeys}containsRecursive(bindings,keys2,dataIndexes){if(keys2.length===0)return!0;let key;[key,...keys2]=keys2;for(const data of dataIndexes){const dataKey=BindingsIndex.hashTerm(bindings.get(key));if(dataKey){const subDatas=[data[dataKey],data[""]].filter(Boolean);if(subDatas.length===0)continue;if(this.containsRecursive(bindings,keys2,subDatas))return!0}else{let subDatas=Object.keys(data).map(subKey=>data[subKey]);if(subDatas.length===0&&(subDatas=[{}]),this.containsRecursive(bindings,keys2,subDatas))return!0}}return!1}}__name(BindingsIndex,"BindingsIndex");BindingsIndex$1.BindingsIndex=BindingsIndex;Object.defineProperty(ActorRdfJoinMinusHashUndef$1,"__esModule",{value:!0});ActorRdfJoinMinusHashUndef$1.ActorRdfJoinMinusHashUndef=void 0;const bus_query_operation_1$e=lib$2y,bus_rdf_join_1$a=lib$r,BindingsIndex_1=BindingsIndex$1;class ActorRdfJoinMinusHashUndef extends bus_rdf_join_1$a.ActorRdfJoin{constructor(args){super(args,{logicalType:"minus",physicalName:"hash-undef",limitEntries:2,canHandleUndefs:!0})}async getOutput(action){const buffer=action.entries[1].output,output=action.entries[0].output,metadatas=await bus_rdf_join_1$a.ActorRdfJoin.getMetadatas(action.entries),commonVariables=bus_rdf_join_1$a.ActorRdfJoin.overlappingVariables(metadatas);if(commonVariables.length>0){const index=new BindingsIndex_1.BindingsIndex(commonVariables);return{result:{type:"bindings",bindingsStream:new bus_query_operation_1$e.ClosableTransformIterator(async()=>(await new Promise(resolve2=>{buffer.bindingsStream.on("data",data=>index.add(data)),buffer.bindingsStream.on("end",resolve2)}),output.bindingsStream.filter(data=>!index.contains(data))),{autoStart:!1,onClose(){buffer.bindingsStream.destroy(),output.bindingsStream.destroy()}}),async metadata(){const bufferMetadata=await output.metadata(),outputMetadata=await output.metadata();return{...outputMetadata,canContainUndefs:bufferMetadata.canContainUndefs||outputMetadata.canContainUndefs}}}}}return buffer.bindingsStream.destroy(),{result:output}}async getJoinCoefficients(action,metadatas){const requestInitialTimes=bus_rdf_join_1$a.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$a.ActorRdfJoin.getRequestItemTimes(metadatas);return{iterations:(metadatas[0].cardinality.value+metadatas[1].cardinality.value)*1.01,persistedItems:metadatas[0].cardinality.value,blockingItems:metadatas[0].cardinality.value,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1]}}}__name(ActorRdfJoinMinusHashUndef,"ActorRdfJoinMinusHashUndef");ActorRdfJoinMinusHashUndef$1.ActorRdfJoinMinusHashUndef=ActorRdfJoinMinusHashUndef;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinMinusHashUndef$1,exports)})(lib$q);var lib$p={},ActorRdfJoinNone$1={};Object.defineProperty(ActorRdfJoinNone$1,"__esModule",{value:!0});ActorRdfJoinNone$1.ActorRdfJoinNone=void 0;const bindings_factory_1$2=lib$2v,bus_rdf_join_1$9=lib$r,metadata_1$3=lib$2h,asynciterator_1$5=asynciterator,BF$2=new bindings_factory_1$2.BindingsFactory;class ActorRdfJoinNone extends bus_rdf_join_1$9.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"none",limitEntries:0})}async test(action){if(action.entries.length>0)throw new Error(`Actor ${this.name} can only join zero entries`);return await this.getJoinCoefficients()}async getOutput(action){return{result:{bindingsStream:new asynciterator_1$5.ArrayIterator([BF$2.bindings()],{autoStart:!1}),metadata:()=>Promise.resolve({state:new metadata_1$3.MetadataValidationState,cardinality:{type:"exact",value:1},canContainUndefs:!1,variables:[]}),type:"bindings"}}}async getJoinCoefficients(){return{iterations:0,persistedItems:0,blockingItems:0,requestTime:0}}}__name(ActorRdfJoinNone,"ActorRdfJoinNone");ActorRdfJoinNone$1.ActorRdfJoinNone=ActorRdfJoinNone;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinNone$1,exports)})(lib$p);var lib$o={},ActorRdfJoinSingle$1={};Object.defineProperty(ActorRdfJoinSingle$1,"__esModule",{value:!0});ActorRdfJoinSingle$1.ActorRdfJoinSingle=void 0;const bus_rdf_join_1$8=lib$r;class ActorRdfJoinSingle extends bus_rdf_join_1$8.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"single",limitEntries:1}),this.includeInLogs=!1}async test(action){if(action.entries.length!==1)throw new Error(`Actor ${this.name} can only join a single entry`);return await this.getJoinCoefficients()}async getOutput(action){return{result:action.entries[0].output}}async getJoinCoefficients(){return{iterations:0,persistedItems:0,blockingItems:0,requestTime:0}}}__name(ActorRdfJoinSingle,"ActorRdfJoinSingle");ActorRdfJoinSingle$1.ActorRdfJoinSingle=ActorRdfJoinSingle;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinSingle$1,exports)})(lib$o);var lib$n={},ActorRdfJoinMultiEmpty$1={};Object.defineProperty(ActorRdfJoinMultiEmpty$1,"__esModule",{value:!0});ActorRdfJoinMultiEmpty$1.ActorRdfJoinMultiEmpty=void 0;const bus_rdf_join_1$7=lib$r,metadata_1$2=lib$2h,asynciterator_1$4=asynciterator;class ActorRdfJoinMultiEmpty extends bus_rdf_join_1$7.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"multi-empty"})}async test(action){if((await bus_rdf_join_1$7.ActorRdfJoin.getMetadatas(action.entries)).every(metadata=>bus_rdf_join_1$7.ActorRdfJoin.getCardinality(metadata).value>0))throw new Error(`Actor ${this.name} can only join entries where at least one is empty`);return super.test(action)}async getOutput(action){for(const entry of action.entries)entry.output.bindingsStream.close();return{result:{bindingsStream:new asynciterator_1$4.ArrayIterator([],{autoStart:!1}),metadata:async()=>({state:new metadata_1$2.MetadataValidationState,cardinality:{type:"exact",value:0},canContainUndefs:!1,variables:bus_rdf_join_1$7.ActorRdfJoin.joinVariables(await bus_rdf_join_1$7.ActorRdfJoin.getMetadatas(action.entries))}),type:"bindings"}}}async getJoinCoefficients(action,metadatas){return{iterations:0,persistedItems:0,blockingItems:0,requestTime:0}}}__name(ActorRdfJoinMultiEmpty,"ActorRdfJoinMultiEmpty");ActorRdfJoinMultiEmpty$1.ActorRdfJoinMultiEmpty=ActorRdfJoinMultiEmpty;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinMultiEmpty$1,exports)})(lib$n);var lib$m={},ActorRdfJoinHash$1={};let AsyncIterator$3=asynciterator,MultiTransformIterator$1=AsyncIterator$3.MultiTransformIterator,SimpleTransformIterator$1=AsyncIterator$3.SimpleTransformIterator,DynamicNestedLoopJoin$1=__name(class extends MultiTransformIterator$1{constructor(left,funRight,funJoin,options){super(left,options),this.funRight=funRight,this.funJoin=funJoin}_createTransformer(leftItem){return new SimpleTransformIterator$1(this.funRight(leftItem),{transform:(rightItem,done,push)=>{let result=this.funJoin(leftItem,rightItem);result!==null&&push(result),done()}})}},"DynamicNestedLoopJoin");var DynamicNestedLoopJoin_1=DynamicNestedLoopJoin$1;let AsyncIterator$2=asynciterator.AsyncIterator,HashJoin$1=__name(class extends AsyncIterator$2{constructor(left,right,funHash,funJoin){super(),this.addedDataListener=!1,this.left=left,this.right=right,this.funHash=funHash,this.funJoin=funJoin,this.leftMap=new Map,this.match=null,this.matches=[],this.matchIdx=0,this.left.on("error",error=>this.destroy(error)),this.right.on("error",error=>this.destroy(error)),this.readable=!1,this.left.on("end",allowJoining.bind(this));function allowJoining(){if(this.leftMap.size<=0)return this.close();this.readable=!0,this.right.on("readable",()=>this.readable=!0),this.right.on("end",()=>{this.hasResults()||this._end()})}__name(allowJoining,"allowJoining"),this.on("newListener",eventName=>{eventName==="data"&&!this.addedDataListener&&(this.addedDataListener=!0,this._addDataListener())})}hasResults(){return!this.right.ended||this.matchIdx<this.matches.length}_end(){super._end(),this.left.destroy(),this.right.destroy()}read(){for(this.addedDataListener||(this.addedDataListener=!0,this._addDataListener());;){if(this.ended||!this.readable)return null;for(;this.matchIdx<this.matches.length;){let item=this.matches[this.matchIdx++],result=this.funJoin(item,this.match);if(result!==null)return result}if(this.hasResults()||this._end(),this.match=this.right.read(),this.match===null)return this.readable=!1,null;let hash2=this.funHash(this.match);this.matches=this.leftMap.get(hash2)||[],this.matchIdx=0}}_addDataListener(){this.left.on("data",addItem.bind(this));function addItem(item){let hash2=this.funHash(item);this.leftMap.has(hash2)||this.leftMap.set(hash2,[]),this.leftMap.get(hash2).push(item)}__name(addItem,"addItem")}},"HashJoin");var HashJoin_1=HashJoin$1;const{MultiTransformIterator,SimpleTransformIterator,scheduleTask}=asynciterator;let NestedLoopJoin$1=__name(class extends MultiTransformIterator{constructor(left,right,funJoin,options){super(left,options),this.right=right,this.funJoin=funJoin,this.on("end",()=>this.right.close())}_end(){super._end(),scheduleTask(()=>this.right.destroy())}_createTransformer(leftItem){return new SimpleTransformIterator(this.right.clone(),{transform:(rightItem,done,push)=>{let result=this.funJoin(leftItem,rightItem);result!==null&&push(result),done()}})}},"NestedLoopJoin");var NestedLoopJoin_1=NestedLoopJoin$1;let AsyncIterator$1=asynciterator.AsyncIterator,SymmetricHashJoin$1=__name(class extends AsyncIterator$1{constructor(left,right,funHash,funJoin){super(),this.left=left,this.right=right,this.funHash=funHash,this.funJoin=funJoin,this.usedLeft=!1,this.leftMap=new Map,this.rightMap=new Map,this.on("end",()=>this._cleanup()),this.match=null,this.matches=[],this.matchIdx=0,(this.left.readable||this.right.readable)&&(this.readable=!0),this.left.on("error",error=>this.destroy(error)),this.right.on("error",error=>this.destroy(error)),this.left.on("readable",()=>this.readable=!0),this.right.on("readable",()=>this.readable=!0),this.left.on("end",()=>{this.hasResults()||this._end()}),this.right.on("end",()=>{this.hasResults()||this._end()})}hasResults(){return!this.left.ended||!this.right.ended||!!this.matches&&this.matchIdx<this.matches.length}_cleanup(){this.leftMap=null,this.rightMap=null,this.matches=null}_end(){super._end(),this.left.destroy(),this.right.destroy()}read(){for(;;){if(this.ended)return null;for(;this.matchIdx<this.matches.length;){let item2=this.matches[this.matchIdx++],result=this.usedLeft?this.funJoin(this.match,item2):this.funJoin(item2,this.match);if(result!==null)return result}this.hasResults()||this._end();let item=null;for(let i=0;i<2&&(item=this.usedLeft?this.right.read():this.left.read(),this.usedLeft=!this.usedLeft,item===null);++i);if(this.done||item===null)return this.readable=!1,null;let hash2=this.funHash(item),map2=this.usedLeft?this.leftMap:this.rightMap;map2.has(hash2)||map2.set(hash2,[]),map2.get(hash2).push(item),this.match=item,this.matches=(this.usedLeft?this.rightMap:this.leftMap).get(hash2)||[],this.matchIdx=0}}},"SymmetricHashJoin");var SymmetricHashJoin_1=SymmetricHashJoin$1;let AsyncIterator=asynciterator.AsyncIterator;class MergeIterator extends AsyncIterator{constructor(streams){super(),Array.isArray(streams)||(streams=Array.prototype.slice.call(arguments)),this.streams=streams;for(let stream of streams)stream.on("readable",()=>this.emit("readable")),stream.on("end",()=>this._removeStream(stream));this.streams.length===0&&this.close(),this.idx=this.streams.length-1}_removeStream(stream){let idx=this.streams.indexOf(stream);idx<0||(this.streams.splice(idx,1),this.idx>=this.streams.length&&--this.idx,this.streams.length===0&&this._end())}close(){super.close();for(let stream of this.streams)stream.close()}read(){for(let attempts=0;attempts<this.streams.length;++attempts){this.idx=(this.idx+1)%this.streams.length;let item=this.streams[this.idx].read();if(item!==null)return item}return null}}__name(MergeIterator,"MergeIterator");var MergeIterator_1=MergeIterator;const DynamicNestedLoopJoin2=DynamicNestedLoopJoin_1,HashJoin2=HashJoin_1,NestedLoopJoin2=NestedLoopJoin_1,SymmetricHashJoin2=SymmetricHashJoin_1,MergeStream=MergeIterator_1;var asyncjoin={DynamicNestedLoopJoin:DynamicNestedLoopJoin2,HashJoin:HashJoin2,NestedLoopJoin:NestedLoopJoin2,SymmetricHashJoin:SymmetricHashJoin2,MergeStream};Object.defineProperty(ActorRdfJoinHash$1,"__esModule",{value:!0});ActorRdfJoinHash$1.ActorRdfJoinHash=void 0;const bus_rdf_join_1$6=lib$r,asyncjoin_1$3=asyncjoin;class ActorRdfJoinHash extends bus_rdf_join_1$6.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"hash",limitEntries:2})}async getOutput(action){const metadatas=await bus_rdf_join_1$6.ActorRdfJoin.getMetadatas(action.entries),variables2=bus_rdf_join_1$6.ActorRdfJoin.overlappingVariables(metadatas);return{result:{type:"bindings",bindingsStream:new asyncjoin_1$3.HashJoin(action.entries[0].output.bindingsStream,action.entries[1].output.bindingsStream,entry=>bus_rdf_join_1$6.ActorRdfJoin.hash(entry,variables2),bus_rdf_join_1$6.ActorRdfJoin.joinBindings),metadata:async()=>await this.constructResultMetadata(action.entries,metadatas,action.context)}}}async getJoinCoefficients(action,metadatas){const requestInitialTimes=bus_rdf_join_1$6.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$6.ActorRdfJoin.getRequestItemTimes(metadatas);return{iterations:metadatas[0].cardinality.value+metadatas[1].cardinality.value,persistedItems:metadatas[0].cardinality.value,blockingItems:metadatas[0].cardinality.value,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1]}}}__name(ActorRdfJoinHash,"ActorRdfJoinHash");ActorRdfJoinHash$1.ActorRdfJoinHash=ActorRdfJoinHash;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinHash$1,exports)})(lib$m);var lib$l={},ActorRdfJoinSymmetricHash$1={};Object.defineProperty(ActorRdfJoinSymmetricHash$1,"__esModule",{value:!0});ActorRdfJoinSymmetricHash$1.ActorRdfJoinSymmetricHash=void 0;const bus_rdf_join_1$5=lib$r,asyncjoin_1$2=asyncjoin;class ActorRdfJoinSymmetricHash extends bus_rdf_join_1$5.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"symmetric-hash",limitEntries:2})}async getOutput(action){const metadatas=await bus_rdf_join_1$5.ActorRdfJoin.getMetadatas(action.entries),variables2=bus_rdf_join_1$5.ActorRdfJoin.overlappingVariables(metadatas);return{result:{type:"bindings",bindingsStream:new asyncjoin_1$2.SymmetricHashJoin(action.entries[0].output.bindingsStream,action.entries[1].output.bindingsStream,entry=>ActorRdfJoinSymmetricHash.hash(entry,variables2),bus_rdf_join_1$5.ActorRdfJoin.joinBindings),metadata:async()=>await this.constructResultMetadata(action.entries,metadatas,action.context)}}}async getJoinCoefficients(action,metadatas){const requestInitialTimes=bus_rdf_join_1$5.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$5.ActorRdfJoin.getRequestItemTimes(metadatas);return{iterations:metadatas[0].cardinality.value+metadatas[1].cardinality.value,persistedItems:metadatas[0].cardinality.value+metadatas[1].cardinality.value,blockingItems:0,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1]}}}__name(ActorRdfJoinSymmetricHash,"ActorRdfJoinSymmetricHash");ActorRdfJoinSymmetricHash$1.ActorRdfJoinSymmetricHash=ActorRdfJoinSymmetricHash;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinSymmetricHash$1,exports)})(lib$l);var lib$k={},ActorRdfJoinNestedLoop$1={};Object.defineProperty(ActorRdfJoinNestedLoop$1,"__esModule",{value:!0});ActorRdfJoinNestedLoop$1.ActorRdfJoinNestedLoop=void 0;const bus_rdf_join_1$4=lib$r,asyncjoin_1$1=asyncjoin;class ActorRdfJoinNestedLoop extends bus_rdf_join_1$4.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"nested-loop",limitEntries:2,canHandleUndefs:!0})}async getOutput(action){return{result:{type:"bindings",bindingsStream:new asyncjoin_1$1.NestedLoopJoin(action.entries[0].output.bindingsStream,action.entries[1].output.bindingsStream,bus_rdf_join_1$4.ActorRdfJoin.joinBindings,{autoStart:!1}),metadata:async()=>await this.constructResultMetadata(action.entries,await bus_rdf_join_1$4.ActorRdfJoin.getMetadatas(action.entries),action.context)}}}async getJoinCoefficients(action,metadatas){const requestInitialTimes=bus_rdf_join_1$4.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$4.ActorRdfJoin.getRequestItemTimes(metadatas);return{iterations:metadatas[0].cardinality.value*metadatas[1].cardinality.value,persistedItems:0,blockingItems:0,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1]}}}__name(ActorRdfJoinNestedLoop,"ActorRdfJoinNestedLoop");ActorRdfJoinNestedLoop$1.ActorRdfJoinNestedLoop=ActorRdfJoinNestedLoop;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinNestedLoop$1,exports)})(lib$k);var lib$j={},ActorRdfJoinOptionalBind$1={},lib$i={},ActorRdfJoinMultiBind$1={};Object.defineProperty(ActorRdfJoinMultiBind$1,"__esModule",{value:!0});ActorRdfJoinMultiBind$1.ActorRdfJoinMultiBind=void 0;const bus_query_operation_1$d=lib$2y,bus_rdf_join_1$3=lib$r,context_entries_1$6=lib$2x,asynciterator_1$3=asynciterator,sparqlalgebrajs_1$5=sparqlalgebrajs;class ActorRdfJoinMultiBind extends bus_rdf_join_1$3.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"bind",canHandleUndefs:!0})}static createBindStream(bindOrder,baseStream,operations,operationBinder,optional){const binder=__name(bindings=>{const subOperations=operations.map(operation=>(0,bus_query_operation_1$d.materializeOperation)(operation,bindings,{bindFilter:!1})),bindingsMerger=__name(subBindings=>subBindings.merge(bindings),"bindingsMerger");return new asynciterator_1$3.TransformIterator(async()=>(await operationBinder(subOperations,bindings)).transform({map:bindingsMerger}),{maxBufferSize:128,autoStart:!1})},"binder");switch(bindOrder){case"depth-first":return new asynciterator_1$3.MultiTransformIterator(baseStream,{autoStart:!1,multiTransform:binder,optional});case"breadth-first":return new asynciterator_1$3.UnionIterator(baseStream.transform({map:binder,optional}),{autoStart:!1});default:throw new Error(`Received request for unknown bind order: ${bindOrder}`)}}async sortJoinEntries(entries3,context2){if(entries3.some(entry=>entry.metadata.canContainUndefs))return entries3;const variableOccurrences={};for(const entry of entries3)for(const variable of entry.metadata.variables){let counter=variableOccurrences[variable.value];counter||(counter=0),variableOccurrences[variable.value]=++counter}const multiOccurrenceVariables=[];for(const[variable,count2]of Object.entries(variableOccurrences))count2>=2&&multiOccurrenceVariables.push(variable);if(multiOccurrenceVariables.length===0)throw new Error("Bind join can only join entries with at least one common variable");const entriesWithoutCommonVariables=[];for(const entry of entries3){let hasCommon=!1;for(const variable of entry.metadata.variables)if(multiOccurrenceVariables.includes(variable.value)){hasCommon=!0;break}hasCommon||entriesWithoutCommonVariables.push(entry)}return(await this.mediatorJoinEntriesSort.mediate({entries:entries3,context:context2})).entries.sort((entryLeft,entryRight)=>{const leftWithoutCommonVariables=entriesWithoutCommonVariables.includes(entryLeft),rightWithoutCommonVariables=entriesWithoutCommonVariables.includes(entryRight);return leftWithoutCommonVariables===rightWithoutCommonVariables?0:leftWithoutCommonVariables?1:-1})}async getOutput(action){const entriesUnsorted=await bus_rdf_join_1$3.ActorRdfJoin.getEntriesWithMetadatas(action.entries),entries3=await this.sortJoinEntries(entriesUnsorted,action.context);this.logDebug(action.context,"First entry for Bind Join: ",()=>({entry:entries3[0].operation,metadata:entries3[0].metadata}));for(const[i,element]of entries3.entries())i!==0&&element.output.bindingsStream.close();const smallestStream=entries3[0].output,remainingEntries=[...entries3];remainingEntries.splice(0,1);const subContext=action.context.set(context_entries_1$6.KeysQueryOperation.joinLeftMetadata,entries3[0].metadata).set(context_entries_1$6.KeysQueryOperation.joinRightMetadatas,remainingEntries.map(entry=>entry.metadata));return{result:{type:"bindings",bindingsStream:ActorRdfJoinMultiBind.createBindStream(this.bindOrder,smallestStream.bindingsStream,remainingEntries.map(entry=>entry.operation),async(operations,operationBindings)=>{const operation=operations.length===1?operations[0]:ActorRdfJoinMultiBind.FACTORY.createJoin(operations);return bus_query_operation_1$d.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation,context:subContext==null?void 0:subContext.set(context_entries_1$6.KeysQueryOperation.joinBindings,operationBindings)})).bindingsStream},!1),metadata:()=>this.constructResultMetadata(entries3,entries3.map(entry=>entry.metadata),action.context)},physicalPlanMetadata:{bindIndex:entriesUnsorted.indexOf(entries3[0]),bindOrder:this.bindOrder}}}canBindWithOperation(operation){let valid=!0;return sparqlalgebrajs_1$5.Util.recurseOperation(operation,{[sparqlalgebrajs_1$5.Algebra.types.EXTEND](){return valid=!1,!1},[sparqlalgebrajs_1$5.Algebra.types.GROUP](){return valid=!1,!1},[sparqlalgebrajs_1$5.Algebra.types.FILTER](){return valid=!1,!1}}),valid}async getJoinCoefficients(action,metadatas){const entries3=await this.sortJoinEntries(action.entries.map((entry,i)=>({...entry,metadata:metadatas[i]})),action.context);metadatas=entries3.map(entry=>entry.metadata);const requestInitialTimes=bus_rdf_join_1$3.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$3.ActorRdfJoin.getRequestItemTimes(metadatas),remainingEntries=[...entries3],remainingRequestInitialTimes=[...requestInitialTimes],remainingRequestItemTimes=[...requestItemTimes];if(remainingEntries.splice(0,1),remainingRequestInitialTimes.splice(0,1),remainingRequestItemTimes.splice(0,1),remainingEntries.some(entry=>!this.canBindWithOperation(entry.operation)))throw new Error(`Actor ${this.name} can not bind on Extend, Group, and Filter operations`);const selectivities=await Promise.all(remainingEntries.map(async entry=>(await this.mediatorJoinSelectivity.mediate({entries:[entries3[0],entry],context:action.context})).selectivity*this.selectivityModifier)),cardinalityRemaining=remainingEntries.map((entry,i)=>entry.metadata.cardinality.value*selectivities[i]).reduce((sum,element)=>sum+element,0),receiveInitialCostRemaining=remainingRequestInitialTimes.reduce((sum,element,i)=>sum+element*selectivities[i],0),receiveItemCostRemaining=remainingRequestItemTimes.reduce((sum,element,i)=>sum+element*selectivities[i],0);return{iterations:metadatas[0].cardinality.value*cardinalityRemaining,persistedItems:0,blockingItems:0,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*(requestItemTimes[0]+receiveInitialCostRemaining+cardinalityRemaining*receiveItemCostRemaining)}}}__name(ActorRdfJoinMultiBind,"ActorRdfJoinMultiBind");ActorRdfJoinMultiBind$1.ActorRdfJoinMultiBind=ActorRdfJoinMultiBind;ActorRdfJoinMultiBind.FACTORY=new sparqlalgebrajs_1$5.Factory;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinMultiBind$1,exports)})(lib$i);Object.defineProperty(ActorRdfJoinOptionalBind$1,"__esModule",{value:!0});ActorRdfJoinOptionalBind$1.ActorRdfJoinOptionalBind=void 0;const actor_rdf_join_inner_multi_bind_1=lib$i,bus_query_operation_1$c=lib$2y,bus_rdf_join_1$2=lib$r,context_entries_1$5=lib$2x,sparqlalgebrajs_1$4=sparqlalgebrajs;class ActorRdfJoinOptionalBind extends bus_rdf_join_1$2.ActorRdfJoin{constructor(args){super(args,{logicalType:"optional",physicalName:"bind",limitEntries:2,canHandleUndefs:!0})}async getOutput(action){action.entries[1].output.bindingsStream.close();const subContext=action.context.set(context_entries_1$5.KeysQueryOperation.joinLeftMetadata,await action.entries[0].output.metadata()).set(context_entries_1$5.KeysQueryOperation.joinRightMetadatas,[await action.entries[1].output.metadata()]);return{result:{type:"bindings",bindingsStream:actor_rdf_join_inner_multi_bind_1.ActorRdfJoinMultiBind.createBindStream(this.bindOrder,action.entries[0].output.bindingsStream,[action.entries[1].operation],async(operations,operationBindings)=>{const operation=operations[0];return bus_query_operation_1$c.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation,context:subContext==null?void 0:subContext.set(context_entries_1$5.KeysQueryOperation.joinBindings,operationBindings)})).bindingsStream},!0),metadata:async()=>await this.constructResultMetadata(action.entries,await bus_rdf_join_1$2.ActorRdfJoin.getMetadatas(action.entries),action.context,{canContainUndefs:!0})}}}async getJoinCoefficients(action,metadatas){const requestInitialTimes=bus_rdf_join_1$2.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$2.ActorRdfJoin.getRequestItemTimes(metadatas);if(action.entries[1].operation.type===sparqlalgebrajs_1$4.Algebra.types.EXTEND||action.entries[1].operation.type===sparqlalgebrajs_1$4.Algebra.types.GROUP)throw new Error(`Actor ${this.name} can not bind on Extend and Group operations`);const selectivity=(await this.mediatorJoinSelectivity.mediate({entries:action.entries,context:action.context})).selectivity*this.selectivityModifier;return{iterations:metadatas[0].cardinality.value*metadatas[1].cardinality.value*selectivity,persistedItems:0,blockingItems:0,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*selectivity*(requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1])}}}__name(ActorRdfJoinOptionalBind,"ActorRdfJoinOptionalBind");ActorRdfJoinOptionalBind$1.ActorRdfJoinOptionalBind=ActorRdfJoinOptionalBind;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinOptionalBind$1,exports)})(lib$j);var lib$h={},ActorRdfJoinOptionalNestedLoop$1={};Object.defineProperty(ActorRdfJoinOptionalNestedLoop$1,"__esModule",{value:!0});ActorRdfJoinOptionalNestedLoop$1.ActorRdfJoinOptionalNestedLoop=void 0;const bus_rdf_join_1$1=lib$r,asyncjoin_1=asyncjoin;class ActorRdfJoinOptionalNestedLoop extends bus_rdf_join_1$1.ActorRdfJoin{constructor(args){super(args,{logicalType:"optional",physicalName:"nested-loop",limitEntries:2,canHandleUndefs:!0})}async getOutput(action){return{result:{type:"bindings",bindingsStream:new asyncjoin_1.NestedLoopJoin(action.entries[0].output.bindingsStream,action.entries[1].output.bindingsStream,bus_rdf_join_1$1.ActorRdfJoin.joinBindings,{optional:!0,autoStart:!1}),metadata:async()=>await this.constructResultMetadata(action.entries,await bus_rdf_join_1$1.ActorRdfJoin.getMetadatas(action.entries),action.context,{canContainUndefs:!0})}}}async getJoinCoefficients(action,metadatas){const requestInitialTimes=bus_rdf_join_1$1.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1$1.ActorRdfJoin.getRequestItemTimes(metadatas);return{iterations:metadatas[0].cardinality.value*metadatas[1].cardinality.value,persistedItems:0,blockingItems:0,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1]}}}__name(ActorRdfJoinOptionalNestedLoop,"ActorRdfJoinOptionalNestedLoop");ActorRdfJoinOptionalNestedLoop$1.ActorRdfJoinOptionalNestedLoop=ActorRdfJoinOptionalNestedLoop;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinOptionalNestedLoop$1,exports)})(lib$h);var lib$g={},ActorRdfResolveHypermediaQpf$1={},RdfSourceQpf$1={};Object.defineProperty(RdfSourceQpf$1,"__esModule",{value:!0});RdfSourceQpf$1.RdfSourceQpf=void 0;const asynciterator_1$2=asynciterator,rdf_data_factory_1$4=rdfDataFactory,rdf_string_1$2=rdfString,rdf_terms_1$2=rdfTerms,DF$4=new rdf_data_factory_1$4.DataFactory;class RdfSourceQpf{constructor(mediatorMetadata,mediatorMetadataExtract,mediatorDereferenceRdf,subjectUri,predicateUri,objectUri,graphUri,url,metadata,context2,initialQuads){this.mediatorMetadata=mediatorMetadata,this.mediatorMetadataExtract=mediatorMetadataExtract,this.mediatorDereferenceRdf=mediatorDereferenceRdf,this.subjectUri=subjectUri,this.predicateUri=predicateUri,this.objectUri=objectUri,this.graphUri=graphUri,this.url=url,this.context=context2,this.cachedQuads={};const searchForm=this.getSearchForm(metadata);if(!searchForm)throw new Error("Illegal state: found no TPF/QPF search form anymore in metadata.");if(this.searchForm=searchForm,this.defaultGraph=metadata.defaultGraph?DF$4.namedNode(metadata.defaultGraph):void 0,initialQuads){let wrappedQuads=(0,asynciterator_1$2.wrap)(initialQuads);this.defaultGraph&&(wrappedQuads=this.reverseMapQuadsToDefaultGraph(wrappedQuads)),wrappedQuads.setProperty("metadata",metadata),this.cacheQuads(wrappedQuads,DF$4.variable(""),DF$4.variable(""),DF$4.variable(""),DF$4.variable(""))}}getSearchForm(metadata){if(!metadata.searchForms||!metadata.searchForms.values)return;const{searchForms}=metadata;for(const searchForm of searchForms.values)if(this.graphUri&&this.subjectUri in searchForm.mappings&&this.predicateUri in searchForm.mappings&&this.objectUri in searchForm.mappings&&this.graphUri in searchForm.mappings&&Object.keys(searchForm.mappings).length===4||this.subjectUri in searchForm.mappings&&this.predicateUri in searchForm.mappings&&this.objectUri in searchForm.mappings&&Object.keys(searchForm.mappings).length===3)return searchForm}createFragmentUri(searchForm,subject2,predicate2,object2,graph){const entries3={},input=[{uri:this.subjectUri,term:subject2},{uri:this.predicateUri,term:predicate2},{uri:this.objectUri,term:object2},{uri:this.graphUri,term:graph}];for(const entry of input)entry.uri&&entry.term.termType!=="Variable"&&(entry.term.termType!=="Quad"||(0,rdf_terms_1$2.everyTermsNested)(entry.term,value=>value.termType!=="Variable"))&&(entries3[entry.uri]=(0,rdf_string_1$2.termToString)(entry.term));return searchForm.getUri(entries3)}match(subject2,predicate2,object2,graph){let modifiedGraph=!1;if(graph.termType==="DefaultGraph"){if(this.defaultGraph)modifiedGraph=!0,graph=this.defaultGraph;else if(Object.keys(this.searchForm.mappings).length===4&&!this.defaultGraph){const quads2=new asynciterator_1$2.ArrayIterator([],{autoStart:!1});return quads2.setProperty("metadata",{requestTime:0,cardinality:{type:"exact",value:0},first:null,next:null,last:null,canContainUndefs:!1}),quads2}}const cached=this.getCachedQuads(subject2,predicate2,object2,graph);if(cached)return cached;const quads=new asynciterator_1$2.TransformIterator(async()=>{var _a2;let url=this.createFragmentUri(this.searchForm,subject2,predicate2,object2,graph);const dereferenceRdfOutput=await this.mediatorDereferenceRdf.mediate({context:this.context,url});url=dereferenceRdfOutput.url;const rdfMetadataOuput=await this.mediatorMetadata.mediate({context:this.context,url,quads:dereferenceRdfOutput.data,triples:(_a2=dereferenceRdfOutput.metadata)==null?void 0:_a2.triples}),metadataExtractPromise=this.mediatorMetadataExtract.mediate({context:this.context,url,metadata:rdfMetadataOuput.metadata,requestTime:dereferenceRdfOutput.requestTime}).then(({metadata})=>quads.setProperty("metadata",{...metadata,canContainUndefs:!1,subsetOf:this.url})),actualDefaultGraph=DF$4.defaultGraph();let filteredOutput=(0,asynciterator_1$2.wrap)(rdfMetadataOuput.data).transform({filter(quad){return(0,rdf_terms_1$2.matchPattern)(quad,subject2,predicate2,object2,graph)?!0:modifiedGraph&&(0,rdf_terms_1$2.matchPattern)(quad,subject2,predicate2,object2,actualDefaultGraph)}});return(modifiedGraph||graph.termType==="Variable")&&(filteredOutput=this.reverseMapQuadsToDefaultGraph(filteredOutput)),filteredOutput.on("error",()=>{}),await metadataExtractPromise,filteredOutput},{autoStart:!1});return this.cacheQuads(quads,subject2,predicate2,object2,graph),this.getCachedQuads(subject2,predicate2,object2,graph)}reverseMapQuadsToDefaultGraph(quads){const actualDefaultGraph=DF$4.defaultGraph();return quads.map(quad=>(0,rdf_terms_1$2.mapTerms)(quad,(term,key)=>key==="graph"&&term.equals(this.defaultGraph)?actualDefaultGraph:term))}getPatternId(subject2,predicate2,object2,graph){return JSON.stringify({s:subject2.termType==="Variable"?"":_termToString(subject2),p:predicate2.termType==="Variable"?"":_termToString(predicate2),o:object2.termType==="Variable"?"":_termToString(object2),g:graph.termType==="Variable"?"":_termToString(graph)})}cacheQuads(quads,subject2,predicate2,object2,graph){const patternId=this.getPatternId(subject2,predicate2,object2,graph);this.cachedQuads[patternId]=quads.clone()}getCachedQuads(subject2,predicate2,object2,graph){const patternId=this.getPatternId(subject2,predicate2,object2,graph),quads=this.cachedQuads[patternId];if(quads)return quads.clone()}}__name(RdfSourceQpf,"RdfSourceQpf");RdfSourceQpf$1.RdfSourceQpf=RdfSourceQpf;function _termToString(term){return term.termType==="DefaultGraph"?"|":(0,rdf_string_1$2.termToString)(term)}__name(_termToString,"_termToString");Object.defineProperty(ActorRdfResolveHypermediaQpf$1,"__esModule",{value:!0});ActorRdfResolveHypermediaQpf$1.ActorRdfResolveHypermediaQpf=void 0;const bus_rdf_resolve_hypermedia_1=lib$1f,RdfSourceQpf_1=RdfSourceQpf$1;class ActorRdfResolveHypermediaQpf extends bus_rdf_resolve_hypermedia_1.ActorRdfResolveHypermedia{constructor(args){super(args,"qpf")}async testMetadata(action){const{searchForm}=this.createSource(action.url,action.metadata,action.context);if(action.handledDatasets&&action.handledDatasets[searchForm.dataset])throw new Error(`Actor ${this.name} can only be applied for the first page of a QPF dataset.`);return{filterFactor:1}}async run(action){this.logInfo(action.context,`Identified as qpf source: ${action.url}`);const source=this.createSource(action.url,action.metadata,action.context,action.quads);return{source,dataset:source.searchForm.dataset}}createSource(url,metadata,context2,quads){return new RdfSourceQpf_1.RdfSourceQpf(this.mediatorMetadata,this.mediatorMetadataExtract,this.mediatorDereferenceRdf,this.subjectUri,this.predicateUri,this.objectUri,this.graphUri,url,metadata,context2,quads)}}__name(ActorRdfResolveHypermediaQpf,"ActorRdfResolveHypermediaQpf");ActorRdfResolveHypermediaQpf$1.ActorRdfResolveHypermediaQpf=ActorRdfResolveHypermediaQpf;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveHypermediaQpf$1,exports)})(lib$g);var lib$f={},ActorRdfResolveQuadPatternHypermedia$1={},MediatedQuadSource$1={},MediatedLinkedRdfSourcesAsyncRdfIterator$1={},LinkedRdfSourcesAsyncRdfIterator$1={};Object.defineProperty(LinkedRdfSourcesAsyncRdfIterator$1,"__esModule",{value:!0});LinkedRdfSourcesAsyncRdfIterator$1.LinkedRdfSourcesAsyncRdfIterator=void 0;const metadata_1$1=lib$2h,asynciterator_1$1=asynciterator,lru_cache_1$3=cjs;class LinkedRdfSourcesAsyncRdfIterator extends asynciterator_1$1.BufferedIterator{constructor(cacheSize,subject2,predicate2,object2,graph,firstUrl,maxIterators,options){if(super({autoStart:!0,...options}),this.started=!1,this.cacheSize=cacheSize,this.subject=subject2,this.predicate=predicate2,this.object=object2,this.graph=graph,this.firstUrl=firstUrl,this.maxIterators=maxIterators,this.maxIterators<=0)throw new Error(`LinkedRdfSourcesAsyncRdfIterator.maxIterators must be larger than zero, but got ${this.maxIterators}`);this.currentIterators=[],this.iteratorsPendingCreation=0,this.accumulatedMetadata=Promise.resolve(void 0)}_end(destroy){for(const it of this.currentIterators)it.destroy();super._end(destroy)}setSourcesState(sourcesState){sourcesState?this.sourcesState=sourcesState:(this.sourcesState={sources:new lru_cache_1$3.LRUCache({max:this.cacheSize})},this.getSourceCached({url:this.firstUrl},{}).catch(error=>this.destroy(error)))}getSourceCached(link2,handledDatasets){let source=this.sourcesState.sources.get(link2.url);return source||(source=this.getSource(link2,handledDatasets),(link2.url===this.firstUrl||this.shouldStoreSourcesStates())&&this.sourcesState.sources.set(link2.url,source),source)}shouldStoreSourcesStates(){return!0}_read(count2,done){if(!this.started)this.started=!0,this.sourcesState||this.setSourcesState(),this.getSourceCached({url:this.firstUrl},{}).then(sourceState=>{this.startIterator(sourceState,!0),done()}).catch(error=>{done()});else{for(const iterator of this.currentIterators){for(;count2>0;){const read=iterator.read();if(read!==null)count2--,this._push(read);else break}if(count2<=0)break}count2>=0&&this.canStartNewIterator()?this.getSourceCached({url:this.firstUrl},{}).then(sourceState=>{this.startIteratorsForNextUrls(sourceState.handledDatasets,!1),done()}).catch(error=>this.destroy(error)):done()}}canStartNewIterator(){return this.currentIterators.length+this.iteratorsPendingCreation<this.maxIterators&&!this.readable}areIteratorsRunning(){return this.currentIterators.length+this.iteratorsPendingCreation>0}startIterator(startSource,firstPage){const iterator=startSource.source.match(this.subject,this.predicate,this.object,this.graph);this.currentIterators.push(iterator);let receivedMetadata=!1;iterator._destination=this,iterator.on("error",error=>this.destroy(error)),iterator.on("readable",()=>this._fillBuffer()),iterator.on("end",()=>{this.currentIterators.splice(this.currentIterators.indexOf(iterator),1),receivedMetadata&&this.startIteratorsForNextUrls(startSource.handledDatasets,!0)}),iterator.getProperty("metadata",metadata=>{this.accumulatedMetadata=this.accumulatedMetadata.then(previousMetadata=>(async()=>(previousMetadata||(previousMetadata=startSource.metadata),this.accumulateMetadata(previousMetadata,metadata)))().then(accumulatedMetadata=>{const returnMetadata={...startSource.metadata,...metadata,...accumulatedMetadata};return returnMetadata.state=new metadata_1$1.MetadataValidationState,this.updateMetadata(returnMetadata),this.getSourceLinks(returnMetadata).then(nextUrls=>Promise.all(nextUrls)).then(async nextUrls=>{const linkQueue=await this.getLinkQueue();for(const nextUrl of nextUrls)linkQueue.push(nextUrl,startSource.link);receivedMetadata=!0,this.startIteratorsForNextUrls(startSource.handledDatasets,!0)}).catch(error=>this.destroy(error)),returnMetadata})).catch(error=>(this.destroy(error),{}))})}updateMetadata(metadataNew){const metadataToInvalidate=this.getProperty("metadata");this.setProperty("metadata",metadataNew),metadataToInvalidate==null||metadataToInvalidate.state.invalidate()}isRunning(){return!this.done}startIteratorsForNextUrls(handledDatasets,canClose){this.getLinkQueue().then(linkQueue=>{for(;this.canStartNewIterator()&&this.isRunning();){const nextLink=linkQueue.pop();if(nextLink)this.iteratorsPendingCreation++,this.getSourceCached(nextLink,handledDatasets).then(nextSourceState=>{this.iteratorsPendingCreation--,this.startIterator(nextSourceState,!1)}).catch(error=>this.destroy(error));else break}canClose&&this.isCloseable(linkQueue)&&this.close()}).catch(error=>this.destroy(error))}isCloseable(linkQueue){return linkQueue.isEmpty()&&!this.areIteratorsRunning()}}__name(LinkedRdfSourcesAsyncRdfIterator,"LinkedRdfSourcesAsyncRdfIterator");LinkedRdfSourcesAsyncRdfIterator$1.LinkedRdfSourcesAsyncRdfIterator=LinkedRdfSourcesAsyncRdfIterator;Object.defineProperty(MediatedLinkedRdfSourcesAsyncRdfIterator$1,"__esModule",{value:!0});MediatedLinkedRdfSourcesAsyncRdfIterator$1.MediatedLinkedRdfSourcesAsyncRdfIterator=void 0;const readable_stream_1$2=browserExports$1,LinkedRdfSourcesAsyncRdfIterator_1=LinkedRdfSourcesAsyncRdfIterator$1;class MediatedLinkedRdfSourcesAsyncRdfIterator extends LinkedRdfSourcesAsyncRdfIterator_1.LinkedRdfSourcesAsyncRdfIterator{constructor(cacheSize,context2,forceSourceType,subject2,predicate2,object2,graph,firstUrl,maxIterators,aggregatedStore,mediators){super(cacheSize,subject2,predicate2,object2,graph,firstUrl,maxIterators,aggregatedStore?{maxBufferSize:Number.POSITIVE_INFINITY}:void 0),this.wasForcefullyClosed=!1,this.context=context2,this.forceSourceType=forceSourceType,this.mediatorDereferenceRdf=mediators.mediatorDereferenceRdf,this.mediatorMetadata=mediators.mediatorMetadata,this.mediatorMetadataExtract=mediators.mediatorMetadataExtract,this.mediatorMetadataAccumulate=mediators.mediatorMetadataAccumulate,this.mediatorRdfResolveHypermedia=mediators.mediatorRdfResolveHypermedia,this.mediatorRdfResolveHypermediaLinks=mediators.mediatorRdfResolveHypermediaLinks,this.mediatorRdfResolveHypermediaLinksQueue=mediators.mediatorRdfResolveHypermediaLinksQueue,this.handledUrls={[firstUrl]:!0},this.aggregatedStore=aggregatedStore}close(){this.getLinkQueue().then(linkQueue=>{var _a2;this.isCloseable(linkQueue)?((_a2=this.aggregatedStore)==null||_a2.end(),super.close()):this.wasForcefullyClosed=!0}).catch(error=>super.destroy(error))}destroy(cause){this.getLinkQueue().then(linkQueue=>{var _a2;this.isCloseable(linkQueue)?((_a2=this.aggregatedStore)==null||_a2.end(),super.destroy(cause)):this.wasForcefullyClosed=!0}).catch(error=>super.destroy(error))}isCloseable(linkQueue){return(this.wasForcefullyClosed||linkQueue.isEmpty())&&!this.areIteratorsRunning()}canStartNewIterator(){return!this.wasForcefullyClosed&&this.aggregatedStore&&this.aggregatedStore.hasRunningIterators()||super.canStartNewIterator()}isRunning(){return this.aggregatedStore&&this.aggregatedStore.hasRunningIterators()||!this.done}shouldStoreSourcesStates(){return this.aggregatedStore===void 0}getLinkQueue(){return this.linkQueue||(this.linkQueue=this.mediatorRdfResolveHypermediaLinksQueue.mediate({firstUrl:this.firstUrl,context:this.context}).then(result=>result.linkQueue)),this.linkQueue}async getSourceLinks(metadata){try{const{links}=await this.mediatorRdfResolveHypermediaLinks.mediate({context:this.context,metadata});return links.filter(link2=>this.handledUrls[link2.url]?!1:(this.handledUrls[link2.url]=!0,!0))}catch{return[]}}async getSource(link2,handledDatasets){var _a2,_b,_c;let context2=this.context;link2.context&&(context2=context2.merge(link2.context));let url=link2.url,quads,metadata;try{const dereferenceRdfOutput=await this.mediatorDereferenceRdf.mediate({context:context2,url});url=dereferenceRdfOutput.url;const rdfMetadataOutput=await this.mediatorMetadata.mediate({context:context2,url,quads:dereferenceRdfOutput.data,triples:(_a2=dereferenceRdfOutput.metadata)==null?void 0:_a2.triples});rdfMetadataOutput.data.on("error",()=>{}),metadata=(await this.mediatorMetadataExtract.mediate({context:context2,url,metadata:rdfMetadataOutput.metadata,headers:dereferenceRdfOutput.headers,requestTime:dereferenceRdfOutput.requestTime})).metadata,quads=rdfMetadataOutput.data,link2.transform&&(quads=await link2.transform(quads))}catch(error){quads=new readable_stream_1$2.Readable,quads.read=()=>(setTimeout(()=>quads.emit("error",error)),null),metadata={}}(_b=this.aggregatedStore)==null||_b.setBaseMetadata(metadata,!1),(_c=this.aggregatedStore)==null||_c.import(quads);const{source,dataset}=await this.mediatorRdfResolveHypermedia.mediate({context:context2,forceSourceType:this.forceSourceType,handledDatasets,metadata,quads,url});return dataset&&(handledDatasets[dataset]=!0),{link:link2,source,metadata,handledDatasets}}async accumulateMetadata(accumulatedMetadata,appendingMetadata){return(await this.mediatorMetadataAccumulate.mediate({mode:"append",accumulatedMetadata,appendingMetadata,context:this.context})).metadata}updateMetadata(metadataNew){var _a2;super.updateMetadata(metadataNew),(_a2=this.aggregatedStore)==null||_a2.setBaseMetadata(metadataNew,!0)}}__name(MediatedLinkedRdfSourcesAsyncRdfIterator,"MediatedLinkedRdfSourcesAsyncRdfIterator");MediatedLinkedRdfSourcesAsyncRdfIterator$1.MediatedLinkedRdfSourcesAsyncRdfIterator=MediatedLinkedRdfSourcesAsyncRdfIterator;var StreamingStoreMetadata$1={},rdfStreamingStore={},PendingStreamsIndex$1={};Object.defineProperty(PendingStreamsIndex$1,"__esModule",{value:!0});PendingStreamsIndex$1.PendingStreamsIndex=void 0;const rdf_string_1$1=rdfString,rdf_terms_1$1=rdfTerms;class PendingStreamsIndex{constructor(){this.indexedStreams=new Map,this.allStreams=[]}termToString(term){return term&&term.termType!=="Variable"?(0,rdf_string_1$1.termToString)(term):PendingStreamsIndex.ID_VARIABLE}addPatternListener(pendingStream,subject2,predicate2,object2,graph){this.allStreams.push(pendingStream);const key=`${this.termToString(subject2)}${PendingStreamsIndex.ID_SEPARATOR}${this.termToString(predicate2)}${PendingStreamsIndex.ID_SEPARATOR}${this.termToString(object2)}${PendingStreamsIndex.ID_SEPARATOR}${this.termToString(graph)}`;let existingListeners=this.indexedStreams.get(key);existingListeners||(existingListeners=[],this.indexedStreams.set(key,existingListeners)),existingListeners.push(pendingStream)}getPendingStreamsForQuad(quad){let keys2=[(0,rdf_terms_1$1.getTerms)(quad).map(term=>(0,rdf_string_1$1.termToString)(term))];for(let i=0;i<rdf_terms_1$1.QUAD_TERM_NAMES.length;i++){const keysOld=keys2;keys2=[];for(const key of keysOld){keys2.push(key);const keyModified=[...key];keyModified[i]=PendingStreamsIndex.ID_VARIABLE,keys2.push(keyModified)}}const pendingStreams=[];for(const key of keys2){const found=this.indexedStreams.get(key.join(PendingStreamsIndex.ID_SEPARATOR));found&&pendingStreams.push(...found)}return pendingStreams}}__name(PendingStreamsIndex,"PendingStreamsIndex");PendingStreamsIndex$1.PendingStreamsIndex=PendingStreamsIndex;PendingStreamsIndex.ID_VARIABLE="?";PendingStreamsIndex.ID_SEPARATOR=":";var StreamingStore$1={};Object.defineProperty(StreamingStore$1,"__esModule",{value:!0});StreamingStore$1.StreamingStore=void 0;const n3_1=require$$0$3,readable_stream_1$1=browserExports$1,PendingStreamsIndex_1=PendingStreamsIndex$1;class StreamingStore{constructor(store=new n3_1.Store){this.pendingStreams=new PendingStreamsIndex_1.PendingStreamsIndex,this.ended=!1,this.store=store}end(){this.ended=!0;for(const pendingStream of this.pendingStreams.allStreams)pendingStream.push(null),pendingStream._pipeSource.unpipe()}importToListeners(stream){stream.on("data",quad=>{for(const pendingStream of this.pendingStreams.getPendingStreamsForQuad(quad))this.ended||(pendingStream.push(quad),pendingStream.emit("quad",quad))})}import(stream){if(this.ended)throw new Error("Attempted to import into an ended StreamingStore");return this.importToListeners(stream),this.store.import(stream)}match(subject2,predicate2,object2,graph){const storeResult=this.store.match(subject2,predicate2,object2,graph);let stream=storeResult;if(!this.ended){const pendingStream=new readable_stream_1$1.PassThrough({objectMode:!0});this.pendingStreams.addPatternListener(pendingStream,subject2,predicate2,object2,graph),stream=storeResult.pipe(pendingStream,{end:!1}),stream._pipeSource=storeResult}return stream}getStore(){return this.store}}__name(StreamingStore,"StreamingStore");StreamingStore$1.StreamingStore=StreamingStore;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(PendingStreamsIndex$1,exports),__exportStar(StreamingStore$1,exports)})(rdfStreamingStore);Object.defineProperty(StreamingStoreMetadata$1,"__esModule",{value:!0});StreamingStoreMetadata$1.StreamingStoreMetadata=void 0;const bus_query_operation_1$b=lib$2y,metadata_1=lib$2h,rdf_streaming_store_1=rdfStreamingStore;class StreamingStoreMetadata extends rdf_streaming_store_1.StreamingStore{constructor(store,metadataAccumulator){super(store),this.started=!1,this.runningIterators=new Set,this.baseMetadata={state:new metadata_1.MetadataValidationState,cardinality:{type:"exact",value:0},canContainUndefs:!1},this.metadataAccumulator=metadataAccumulator}import(stream){return this.ended||super.import(stream),stream}hasRunningIterators(){return this.runningIterators.size>0}match(subject2,predicate2,object2,graph){const rawStream=super.match(subject2,predicate2,object2,graph),iterator=new bus_query_operation_1$b.ClosableTransformIterator(rawStream,{autoStart:!1,onClose:()=>{this.runningIterators.delete(iterator)}});let count2=this.getStore().countQuads(subject2,predicate2,object2,graph);const metadata={state:new metadata_1.MetadataValidationState,cardinality:{type:"estimate",value:count2},canContainUndefs:!1};return iterator.setProperty("metadata",metadata),iterator.setProperty("lastCount",count2),rawStream.on("quad",()=>{iterator.setProperty("lastCount",++count2),this.updateMetadataState(iterator,count2)}),this.runningIterators.add(iterator),iterator}setBaseMetadata(metadata,updateStates){if(this.baseMetadata={...metadata},this.baseMetadata.cardinality={type:"exact",value:0},updateStates)for(const iterator of this.runningIterators){const count2=iterator.getProperty("lastCount");this.updateMetadataState(iterator,count2)}}updateMetadataState(iterator,count2){const metadataNew={state:new metadata_1.MetadataValidationState,cardinality:{type:"estimate",value:count2},canContainUndefs:!1};this.metadataAccumulator(this.baseMetadata,metadataNew).then(accumulatedMetadata=>{accumulatedMetadata.state=new metadata_1.MetadataValidationState;const metadataToInvalidate=iterator.getProperty("metadata");iterator.setProperty("metadata",accumulatedMetadata),metadataToInvalidate==null||metadataToInvalidate.state.invalidate()}).catch(()=>{})}}__name(StreamingStoreMetadata,"StreamingStoreMetadata");StreamingStoreMetadata$1.StreamingStoreMetadata=StreamingStoreMetadata;Object.defineProperty(MediatedQuadSource$1,"__esModule",{value:!0});MediatedQuadSource$1.MediatedQuadSource=void 0;const context_entries_1$4=lib$2x,MediatedLinkedRdfSourcesAsyncRdfIterator_1=MediatedLinkedRdfSourcesAsyncRdfIterator$1,StreamingStoreMetadata_1=StreamingStoreMetadata$1;class MediatedQuadSource{constructor(cacheSize,firstUrl,forceSourceType,maxIterators,aggregateStore,mediators){this.cacheSize=cacheSize,this.firstUrl=firstUrl,this.forceSourceType=forceSourceType,this.maxIterators=maxIterators,this.aggregateStore=aggregateStore,this.mediators=mediators}static nullifyVariables(term){return!term||term.termType==="Variable"?void 0:term}match(subject2,predicate2,object2,graph,context2){let aggregatedStore;if(this.aggregateStore){const aggregatedStores=context2.get(context_entries_1$4.KeysRdfResolveQuadPattern.hypermediaSourcesAggregatedStores);if(aggregatedStores&&(aggregatedStore=aggregatedStores.get(this.firstUrl),aggregatedStore||(aggregatedStore=new StreamingStoreMetadata_1.StreamingStoreMetadata(void 0,(acc,app)=>it.accumulateMetadata(acc,app)),aggregatedStores.set(this.firstUrl,aggregatedStore)),aggregatedStore.started))return aggregatedStore.match(MediatedQuadSource.nullifyVariables(subject2),MediatedQuadSource.nullifyVariables(predicate2),MediatedQuadSource.nullifyVariables(object2),MediatedQuadSource.nullifyVariables(graph))}const it=new MediatedLinkedRdfSourcesAsyncRdfIterator_1.MediatedLinkedRdfSourcesAsyncRdfIterator(this.cacheSize,context2,this.forceSourceType,subject2,predicate2,object2,graph,this.firstUrl,this.maxIterators,aggregatedStore,this.mediators);return this.sourcesState?it.setSourcesState(this.sourcesState):(it.setSourcesState(),this.sourcesState=it.sourcesState),aggregatedStore&&(aggregatedStore.started=!0),it}}__name(MediatedQuadSource,"MediatedQuadSource");MediatedQuadSource$1.MediatedQuadSource=MediatedQuadSource;Object.defineProperty(ActorRdfResolveQuadPatternHypermedia$1,"__esModule",{value:!0});ActorRdfResolveQuadPatternHypermedia$1.ActorRdfResolveQuadPatternHypermedia=void 0;const bus_rdf_resolve_quad_pattern_1$1=lib$1g,lru_cache_1$2=cjs,MediatedQuadSource_1=MediatedQuadSource$1;class ActorRdfResolveQuadPatternHypermedia extends bus_rdf_resolve_quad_pattern_1$1.ActorRdfResolveQuadPatternSource{constructor(args){super(args),this.cache=this.cacheSize?new lru_cache_1$2.LRUCache({max:this.cacheSize}):void 0;const cache=this.cache;cache&&this.httpInvalidator.addInvalidateListener(({url})=>url?cache.delete(url):cache.clear()),args.mediatorMetadataAccumulate||(this.mediatorMetadataAccumulate={async mediate(action){return{metadata:{...action.accumulatedMetadata,...action.appendingMetadata}}}})}async test(action){if(!(0,bus_rdf_resolve_quad_pattern_1$1.hasContextSingleSource)(action.context))throw new Error(`Actor ${this.name} can only resolve quad pattern queries against a single source.`);return!0}getSource(context2,operation){const contextSource=(0,bus_rdf_resolve_quad_pattern_1$1.getContextSource)(context2),url=(0,bus_rdf_resolve_quad_pattern_1$1.getContextSourceUrl)(contextSource);let source;return this.cache&&this.cache.has(url)?source=this.cache.get(url):(source=new MediatedQuadSource_1.MediatedQuadSource(this.cacheSize,url,(0,bus_rdf_resolve_quad_pattern_1$1.getDataSourceType)(contextSource),this.maxIterators,this.aggregateStore,{mediatorMetadata:this.mediatorMetadata,mediatorMetadataExtract:this.mediatorMetadataExtract,mediatorMetadataAccumulate:this.mediatorMetadataAccumulate,mediatorDereferenceRdf:this.mediatorDereferenceRdf,mediatorRdfResolveHypermedia:this.mediatorRdfResolveHypermedia,mediatorRdfResolveHypermediaLinks:this.mediatorRdfResolveHypermediaLinks,mediatorRdfResolveHypermediaLinksQueue:this.mediatorRdfResolveHypermediaLinksQueue}),this.cache&&this.cache.set(url,source)),Promise.resolve(source)}}__name(ActorRdfResolveQuadPatternHypermedia,"ActorRdfResolveQuadPatternHypermedia");ActorRdfResolveQuadPatternHypermedia$1.ActorRdfResolveQuadPatternHypermedia=ActorRdfResolveQuadPatternHypermedia;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveQuadPatternHypermedia$1,exports),__exportStar(MediatedQuadSource$1,exports)})(lib$f);var lib$e={},ActorRdfUpdateQuadsHypermedia$1={};Object.defineProperty(ActorRdfUpdateQuadsHypermedia$1,"__esModule",{value:!0});ActorRdfUpdateQuadsHypermedia$1.ActorRdfUpdateQuadsHypermedia=void 0;const bus_rdf_update_quads_1=lib$19,lru_cache_1$1=cjs;class ActorRdfUpdateQuadsHypermedia extends bus_rdf_update_quads_1.ActorRdfUpdateQuadsDestination{constructor(args){super(args),this.cache=this.cacheSize?new lru_cache_1$1.LRUCache({max:this.cacheSize}):void 0;const cache=this.cache;cache&&this.httpInvalidator.addInvalidateListener(({url})=>url?cache.delete(url):cache.clear())}async test(action){if(!(0,bus_rdf_update_quads_1.getContextDestinationUrl)((0,bus_rdf_update_quads_1.getContextDestination)(action.context)))throw new Error(`Actor ${this.name} can only update quads against a single destination URL.`);return!0}getDestination(context2){const dataDestination=(0,bus_rdf_update_quads_1.getContextDestination)(context2);let url=(0,bus_rdf_update_quads_1.getContextDestinationUrl)(dataDestination);if(this.cache&&this.cache.has(url))return this.cache.get(url);const ret=(async()=>{var _a2;let metadata,exists;try{const dereferenceRdfOutput=await this.mediatorDereferenceRdf.mediate({context:context2,url,acceptErrors:!0});exists=dereferenceRdfOutput.exists,url=dereferenceRdfOutput.url;const rdfMetadataOuput=await this.mediatorMetadata.mediate({context:context2,url,quads:dereferenceRdfOutput.data,triples:(_a2=dereferenceRdfOutput.metadata)==null?void 0:_a2.triples});metadata=(await this.mediatorMetadataExtract.mediate({context:context2,url,metadata:rdfMetadataOuput.metadata,headers:dereferenceRdfOutput.headers,requestTime:dereferenceRdfOutput.requestTime})).metadata}catch{metadata={},exists=!1}const{destination}=await this.mediatorRdfUpdateHypermedia.mediate({context:context2,url,metadata,exists,forceDestinationType:(0,bus_rdf_update_quads_1.getDataDestinationType)(dataDestination)});return destination})();return this.cache&&this.cache.set(url,ret),ret}}__name(ActorRdfUpdateQuadsHypermedia,"ActorRdfUpdateQuadsHypermedia");ActorRdfUpdateQuadsHypermedia$1.ActorRdfUpdateQuadsHypermedia=ActorRdfUpdateQuadsHypermedia;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfUpdateQuadsHypermedia$1,exports)})(lib$e);var lib$d={},ActorQueryOperationClear$1={};Object.defineProperty(ActorQueryOperationClear$1,"__esModule",{value:!0});ActorQueryOperationClear$1.ActorQueryOperationClear=void 0;const bus_query_operation_1$a=lib$2y,rdf_data_factory_1$3=rdfDataFactory,DF$3=new rdf_data_factory_1$3.DataFactory;class ActorQueryOperationClear extends bus_query_operation_1$a.ActorQueryOperationTypedMediated{constructor(args){super(args,"clear")}async testOperation(operation,context2){return bus_query_operation_1$a.ActorQueryOperation.throwOnReadOnly(context2),!0}async runOperation(operation,context2){let graphs;operation.source==="DEFAULT"?graphs=DF$3.defaultGraph():typeof operation.source=="string"?graphs=operation.source:graphs=[operation.source];const{execute}=await this.mediatorUpdateQuads.mediate({deleteGraphs:{graphs,requireExistence:!operation.silent,dropGraphs:!1},context:context2});return{type:"void",execute}}}__name(ActorQueryOperationClear,"ActorQueryOperationClear");ActorQueryOperationClear$1.ActorQueryOperationClear=ActorQueryOperationClear;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationClear$1,exports)})(lib$d);var lib$c={},ActorQueryOperationCreate$1={};Object.defineProperty(ActorQueryOperationCreate$1,"__esModule",{value:!0});ActorQueryOperationCreate$1.ActorQueryOperationCreate=void 0;const bus_query_operation_1$9=lib$2y;class ActorQueryOperationCreate extends bus_query_operation_1$9.ActorQueryOperationTypedMediated{constructor(args){super(args,"create")}async testOperation(operation,context2){return bus_query_operation_1$9.ActorQueryOperation.throwOnReadOnly(context2),!0}async runOperation(operation,context2){const{execute}=await this.mediatorUpdateQuads.mediate({createGraphs:{graphs:[operation.source],requireNonExistence:!operation.silent},context:context2});return{type:"void",execute}}}__name(ActorQueryOperationCreate,"ActorQueryOperationCreate");ActorQueryOperationCreate$1.ActorQueryOperationCreate=ActorQueryOperationCreate;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationCreate$1,exports)})(lib$c);var lib$b={},ActorQueryOperationUpdateDeleteInsert$1={};Object.defineProperty(ActorQueryOperationUpdateDeleteInsert$1,"__esModule",{value:!0});ActorQueryOperationUpdateDeleteInsert$1.ActorQueryOperationUpdateDeleteInsert=void 0;const actor_query_operation_construct_1=lib$15,bindings_factory_1$1=lib$2v,bus_query_operation_1$8=lib$2y,asynciterator_1=asynciterator,BF$1=new bindings_factory_1$1.BindingsFactory;class ActorQueryOperationUpdateDeleteInsert extends bus_query_operation_1$8.ActorQueryOperationTypedMediated{constructor(args){super(args,"deleteinsert"),this.blankNodeCounter=0}async testOperation(operation,context2){return bus_query_operation_1$8.ActorQueryOperation.throwOnReadOnly(context2),!0}async runOperation(operation,context2){const whereBindings=operation.where?bus_query_operation_1$8.ActorQueryOperation.getSafeBindings(await this.mediatorQueryOperation.mediate({operation:operation.where,context:context2})).bindingsStream:new asynciterator_1.ArrayIterator([BF$1.bindings()],{autoStart:!1});let quadStreamInsert,quadStreamDelete;operation.insert&&(quadStreamInsert=new actor_query_operation_construct_1.BindingsToQuadsIterator(operation.insert.map(actor_query_operation_construct_1.BindingsToQuadsIterator.localizeQuad.bind(null,this.blankNodeCounter)),whereBindings.clone()),this.blankNodeCounter++),operation.delete&&(quadStreamDelete=new actor_query_operation_construct_1.BindingsToQuadsIterator(operation.delete.map(actor_query_operation_construct_1.BindingsToQuadsIterator.localizeQuad.bind(null,this.blankNodeCounter)),whereBindings.clone()),this.blankNodeCounter++);const{execute}=await this.mediatorUpdateQuads.mediate({quadStreamInsert,quadStreamDelete,context:context2});return{type:"void",execute}}}__name(ActorQueryOperationUpdateDeleteInsert,"ActorQueryOperationUpdateDeleteInsert");ActorQueryOperationUpdateDeleteInsert$1.ActorQueryOperationUpdateDeleteInsert=ActorQueryOperationUpdateDeleteInsert;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationUpdateDeleteInsert$1,exports)})(lib$b);var lib$a={},ActorQueryOperationDrop$1={};Object.defineProperty(ActorQueryOperationDrop$1,"__esModule",{value:!0});ActorQueryOperationDrop$1.ActorQueryOperationDrop=void 0;const bus_query_operation_1$7=lib$2y,rdf_data_factory_1$2=rdfDataFactory,DF$2=new rdf_data_factory_1$2.DataFactory;class ActorQueryOperationDrop extends bus_query_operation_1$7.ActorQueryOperationTypedMediated{constructor(args){super(args,"drop")}async testOperation(operation,context2){return bus_query_operation_1$7.ActorQueryOperation.throwOnReadOnly(context2),!0}async runOperation(operation,context2){let graphs;operation.source==="DEFAULT"?graphs=DF$2.defaultGraph():typeof operation.source=="string"?graphs=operation.source:graphs=[operation.source];const{execute}=await this.mediatorUpdateQuads.mediate({deleteGraphs:{graphs,requireExistence:!operation.silent,dropGraphs:!0},context:context2});return{type:"void",execute}}}__name(ActorQueryOperationDrop,"ActorQueryOperationDrop");ActorQueryOperationDrop$1.ActorQueryOperationDrop=ActorQueryOperationDrop;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationDrop$1,exports)})(lib$a);var lib$9={},ActorQueryOperationLoad$1={};Object.defineProperty(ActorQueryOperationLoad$1,"__esModule",{value:!0});ActorQueryOperationLoad$1.ActorQueryOperationLoad=void 0;const bus_query_operation_1$6=lib$2y,context_entries_1$3=lib$2x,rdf_data_factory_1$1=rdfDataFactory,sparqlalgebrajs_1$3=sparqlalgebrajs,DF$1=new rdf_data_factory_1$1.DataFactory;class ActorQueryOperationLoad extends bus_query_operation_1$6.ActorQueryOperationTypedMediated{constructor(args){super(args,"load"),this.factory=new sparqlalgebrajs_1$3.Factory,this.constructOperation=this.factory.createConstruct(this.factory.createPattern(DF$1.variable("s"),DF$1.variable("p"),DF$1.variable("o")),[this.factory.createPattern(DF$1.variable("s"),DF$1.variable("p"),DF$1.variable("o"))])}async testOperation(operation,context2){return bus_query_operation_1$6.ActorQueryOperation.throwOnReadOnly(context2),!0}async runOperation(operation,context2){let subContext=context2.set(context_entries_1$3.KeysRdfResolveQuadPattern.sources,[operation.source.value]);operation.silent&&(subContext=subContext.set(context_entries_1$3.KeysInitQuery.lenient,!0));let quadStream=ActorQueryOperationLoad.getSafeQuads(await this.mediatorQueryOperation.mediate({operation:this.constructOperation,context:subContext})).quadStream;operation.destination&&(quadStream=quadStream.map(quad=>DF$1.quad(quad.subject,quad.predicate,quad.object,operation.destination)));const{execute}=await this.mediatorUpdateQuads.mediate({quadStreamInsert:quadStream,context:context2});return{type:"void",execute}}}__name(ActorQueryOperationLoad,"ActorQueryOperationLoad");ActorQueryOperationLoad$1.ActorQueryOperationLoad=ActorQueryOperationLoad;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationLoad$1,exports)})(lib$9);var lib$8={},ActorQueryOperationJoin$1={};Object.defineProperty(ActorQueryOperationJoin$1,"__esModule",{value:!0});ActorQueryOperationJoin$1.ActorQueryOperationJoin=void 0;const bus_query_operation_1$5=lib$2y;class ActorQueryOperationJoin extends bus_query_operation_1$5.ActorQueryOperationTypedMediated{constructor(args){super(args,"join")}async testOperation(operation,context2){return!0}async runOperation(operationOriginal,context2){const entries3=(await Promise.all(operationOriginal.input.map(async subOperation=>({output:await this.mediatorQueryOperation.mediate({operation:subOperation,context:context2}),operation:subOperation})))).map(({output,operation})=>({output:bus_query_operation_1$5.ActorQueryOperation.getSafeBindings(output),operation}));return this.mediatorJoin.mediate({type:"inner",entries:entries3,context:context2})}}__name(ActorQueryOperationJoin,"ActorQueryOperationJoin");ActorQueryOperationJoin$1.ActorQueryOperationJoin=ActorQueryOperationJoin;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationJoin$1,exports)})(lib$8);var lib$7={},ActorQueryOperationMinus$1={};Object.defineProperty(ActorQueryOperationMinus$1,"__esModule",{value:!0});ActorQueryOperationMinus$1.ActorQueryOperationMinus=void 0;const bus_query_operation_1$4=lib$2y;class ActorQueryOperationMinus extends bus_query_operation_1$4.ActorQueryOperationTypedMediated{constructor(args){super(args,"minus")}async testOperation(operation,context2){return!0}async runOperation(operationOriginal,context2){const entries3=(await Promise.all(operationOriginal.input.map(async subOperation=>({output:await this.mediatorQueryOperation.mediate({operation:subOperation,context:context2}),operation:subOperation})))).map(({output,operation})=>({output:bus_query_operation_1$4.ActorQueryOperation.getSafeBindings(output),operation}));return this.mediatorJoin.mediate({type:"minus",entries:entries3,context:context2})}}__name(ActorQueryOperationMinus,"ActorQueryOperationMinus");ActorQueryOperationMinus$1.ActorQueryOperationMinus=ActorQueryOperationMinus;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationMinus$1,exports)})(lib$7);var lib$6={},ActorQueryOperationLeftJoin$1={};Object.defineProperty(ActorQueryOperationLeftJoin$1,"__esModule",{value:!0});ActorQueryOperationLeftJoin$1.ActorQueryOperationLeftJoin=void 0;const bus_query_operation_1$3=lib$2y,sparqlee_1=dist;class ActorQueryOperationLeftJoin extends bus_query_operation_1$3.ActorQueryOperationTypedMediated{constructor(args){super(args,"leftjoin")}async testOperation(operation,context2){return!0}async runOperation(operationOriginal,context2){const entries3=(await Promise.all(operationOriginal.input.map(async subOperation=>({output:await this.mediatorQueryOperation.mediate({operation:subOperation,context:context2}),operation:subOperation})))).map(({output,operation})=>({output:bus_query_operation_1$3.ActorQueryOperation.getSafeBindings(output),operation})),joined=await this.mediatorJoin.mediate({type:"optional",entries:entries3,context:context2});if(operationOriginal.expression){const expressionVariables=(await entries3[1].output.metadata()).variables,config={...bus_query_operation_1$3.ActorQueryOperation.getAsyncExpressionContext(context2,this.mediatorQueryOperation)},evaluator=new sparqlee_1.AsyncEvaluator(operationOriginal.expression,config),bindingsStream=joined.bindingsStream.transform({autoStart:!1,transform:async(bindings,done,push)=>{if(!expressionVariables.every(variable=>bindings.has(variable.value)))return push(bindings),done();try{await evaluator.evaluateAsEBV(bindings)&&push(bindings)}catch(error){(0,sparqlee_1.isExpressionError)(error)?this.logWarn(context2,"Error occurred while filtering.",()=>({error,bindings})):bindingsStream.emit("error",error)}done()}});joined.bindingsStream=bindingsStream}return joined}}__name(ActorQueryOperationLeftJoin,"ActorQueryOperationLeftJoin");ActorQueryOperationLeftJoin$1.ActorQueryOperationLeftJoin=ActorQueryOperationLeftJoin;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationLeftJoin$1,exports)})(lib$6);var lib$5={},ActorQueryOperationPathSeq$1={};Object.defineProperty(ActorQueryOperationPathSeq$1,"__esModule",{value:!0});ActorQueryOperationPathSeq$1.ActorQueryOperationPathSeq=void 0;const actor_abstract_path_1=lib$R,bus_query_operation_1$2=lib$2y,sparqlalgebrajs_1$2=sparqlalgebrajs;class ActorQueryOperationPathSeq extends actor_abstract_path_1.ActorAbstractPath{constructor(args){super(args,sparqlalgebrajs_1$2.Algebra.types.SEQ)}async runOperation(operationOriginal,context2){const predicate2=operationOriginal.predicate;let joiner=operationOriginal.subject;const generatedVariableNames=[],entries3=await Promise.all(predicate2.input.map((subPredicate,i)=>{const nextJoiner=i===predicate2.input.length-1?operationOriginal.object:this.generateVariable(operationOriginal,`b${i}`),operation=actor_abstract_path_1.ActorAbstractPath.FACTORY.createPath(joiner,subPredicate,nextJoiner,operationOriginal.graph),output=this.mediatorQueryOperation.mediate({context:context2,operation});return joiner=nextJoiner,i<predicate2.input.length-1&&generatedVariableNames.push(nextJoiner),{output,operation}}).map(async({output,operation})=>({output:bus_query_operation_1$2.ActorQueryOperation.getSafeBindings(await output),operation}))),join3=bus_query_operation_1$2.ActorQueryOperation.getSafeBindings(await this.mediatorJoin.mediate({type:"inner",entries:entries3,context:context2}));return{type:"bindings",bindingsStream:join3.bindingsStream.transform({transform(item,next,push){for(const generatedVariableName of generatedVariableNames)item=item.delete(generatedVariableName);push(item),next()}}),async metadata(){const joinMetadata=await join3.metadata(),variables2=joinMetadata.variables.filter(variable=>!generatedVariableNames.some(generatedVariableName=>generatedVariableName.value===variable.value));return{...joinMetadata,variables:variables2}}}}}__name(ActorQueryOperationPathSeq,"ActorQueryOperationPathSeq");ActorQueryOperationPathSeq$1.ActorQueryOperationPathSeq=ActorQueryOperationPathSeq;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationPathSeq$1,exports)})(lib$5);var lib$4={},ActorRdfJoinMultiSmallest$1={};Object.defineProperty(ActorRdfJoinMultiSmallest$1,"__esModule",{value:!0});ActorRdfJoinMultiSmallest$1.ActorRdfJoinMultiSmallest=void 0;const bus_query_operation_1$1=lib$2y,bus_rdf_join_1=lib$r,sparqlalgebrajs_1$1=sparqlalgebrajs;class ActorRdfJoinMultiSmallest extends bus_rdf_join_1.ActorRdfJoin{constructor(args){super(args,{logicalType:"inner",physicalName:"multi-smallest",limitEntries:3,limitEntriesMin:!0})}async sortJoinEntries(entries3,context2){return(await this.mediatorJoinEntriesSort.mediate({entries:entries3,context:context2})).entries}async getOutput(action){const entries3=await this.sortJoinEntries(await bus_rdf_join_1.ActorRdfJoin.getEntriesWithMetadatas([...action.entries]),action.context),smallestEntry1=entries3[0],smallestEntry2=entries3[1];entries3.splice(0,2);const firstEntry={output:bus_query_operation_1$1.ActorQueryOperation.getSafeBindings(await this.mediatorJoin.mediate({type:action.type,entries:[smallestEntry1,smallestEntry2],context:action.context})),operation:ActorRdfJoinMultiSmallest.FACTORY.createJoin([smallestEntry1.operation,smallestEntry2.operation],!1)};return entries3.push(firstEntry),{result:await this.mediatorJoin.mediate({type:action.type,entries:entries3,context:action.context})}}async getJoinCoefficients(action,metadatas){metadatas=[...metadatas],metadatas=(await this.sortJoinEntries(action.entries.map((entry,i)=>({...entry,metadata:metadatas[i]})),action.context)).map(entry=>entry.metadata);const requestInitialTimes=bus_rdf_join_1.ActorRdfJoin.getRequestInitialTimes(metadatas),requestItemTimes=bus_rdf_join_1.ActorRdfJoin.getRequestItemTimes(metadatas);return{iterations:metadatas[0].cardinality.value*metadatas[1].cardinality.value*metadatas.slice(2).reduce((acc,metadata)=>acc*metadata.cardinality.value,1),persistedItems:0,blockingItems:0,requestTime:requestInitialTimes[0]+metadatas[0].cardinality.value*requestItemTimes[0]+requestInitialTimes[1]+metadatas[1].cardinality.value*requestItemTimes[1]+metadatas.slice(2).reduce((sum,metadata,i)=>sum+requestInitialTimes.slice(2)[i]+metadata.cardinality.value*requestItemTimes.slice(2)[i],0)}}}__name(ActorRdfJoinMultiSmallest,"ActorRdfJoinMultiSmallest");ActorRdfJoinMultiSmallest$1.ActorRdfJoinMultiSmallest=ActorRdfJoinMultiSmallest;ActorRdfJoinMultiSmallest.FACTORY=new sparqlalgebrajs_1$1.Factory;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfJoinMultiSmallest$1,exports)})(lib$4);var lib$3={},ActorQueryOperationQuadpattern$1={};Object.defineProperty(ActorQueryOperationQuadpattern$1,"__esModule",{value:!0});ActorQueryOperationQuadpattern$1.ActorQueryOperationQuadpattern=void 0;const bindings_factory_1=lib$2v,bus_query_operation_1=lib$2y,context_entries_1$2=lib$2x,rdf_data_factory_1=rdfDataFactory,rdf_string_1=rdfString,rdf_terms_1=rdfTerms,sparqlalgebrajs_1=sparqlalgebrajs,BF=new bindings_factory_1.BindingsFactory,DF=new rdf_data_factory_1.DataFactory,AF=new sparqlalgebrajs_1.Factory;class ActorQueryOperationQuadpattern extends bus_query_operation_1.ActorQueryOperationTyped{constructor(args){super(args,"pattern")}static isTermVariable(term){return term.termType==="Variable"}static getVariables(pattern){return(0,rdf_terms_1.uniqTerms)((0,rdf_terms_1.getTermsNested)(pattern).filter(ActorQueryOperationQuadpattern.isTermVariable))}static getDuplicateElementLinks(pattern){const variableElements={};let duplicateVariables=!1;if((0,rdf_terms_1.forEachTermsNested)(pattern,(value,keys2)=>{if(value.termType==="Variable"){const val=(0,rdf_string_1.termToString)(value),length=(variableElements[val]||(variableElements[val]=[])).push(keys2);duplicateVariables=duplicateVariables||length>1}}),!duplicateVariables)return;const duplicateElementLinks={};for(const variable in variableElements){const elements=variableElements[variable],remainingElements=elements.slice(1);remainingElements.length>0&&(duplicateElementLinks[elements[0].join("_")]=remainingElements)}return duplicateElementLinks}static validateMetadata(metadataRaw){for(const key of["cardinality","canContainUndefs"])if(!(key in metadataRaw))throw new Error(`Invalid metadata: missing ${key} in ${JSON.stringify(metadataRaw)}`);return metadataRaw}static getMetadata(data,elementVariables,variables2){return()=>new Promise((resolve2,reject)=>{data.getProperty("metadata",metadata=>resolve2(metadata)),data.on("error",reject)}).then(metadataRaw=>("canContainUndefs"in metadataRaw||(metadataRaw.canContainUndefs=!1),ActorQueryOperationQuadpattern.quadsMetadataToBindingsMetadata(ActorQueryOperationQuadpattern.validateMetadata(metadataRaw),elementVariables,variables2)))}static quadsMetadataToBindingsMetadata(metadataQuads,elementVariables,variables2){return{...metadataQuads,order:metadataQuads.order?ActorQueryOperationQuadpattern.quadsOrderToBindingsOrder(metadataQuads.order,elementVariables):void 0,availableOrders:metadataQuads.availableOrders?metadataQuads.availableOrders.map(orderDef=>({cost:orderDef.cost,terms:ActorQueryOperationQuadpattern.quadsOrderToBindingsOrder(orderDef.terms,elementVariables)})):void 0,variables:variables2}}static quadsOrderToBindingsOrder(quadsOrder,elementVariables){const mappedVariables={};return quadsOrder.map(entry=>{const variableName=elementVariables[entry.term];if(variableName&&!mappedVariables[variableName])return mappedVariables[variableName]=!0,{term:DF.variable(variableName),direction:entry.direction}}).filter(entry=>!!entry)}async testOperation(operation,context2){return!0}async runOperation(pattern,context2){pattern.context&&(context2=context2.merge(pattern.context));let patternInner=pattern;const unionDefaultGraph=this.unionDefaultGraph||context2.get(context_entries_1$2.KeysQueryOperation.unionDefaultGraph);pattern.graph.termType==="DefaultGraph"&&unionDefaultGraph&&(patternInner=AF.createPattern(pattern.subject,pattern.predicate,pattern.object,DF.variable("__comunica:defaultGraph")));const result=await this.mediatorResolveQuadPattern.mediate({pattern:patternInner,context:context2}),variables2=ActorQueryOperationQuadpattern.getVariables(pattern),elementVariables=(0,rdf_terms_1.reduceTermsNested)(pattern,(acc,term,keys2)=>(term.termType==="Variable"&&(acc[keys2.join("_")]=term.value),acc),{}),metadata=ActorQueryOperationQuadpattern.getMetadata(result.data,elementVariables,variables2);return{type:"bindings",bindingsStream:new bus_query_operation_1.ClosableTransformIterator(async()=>{let filteredOutput=result.data;const duplicateElementLinks=ActorQueryOperationQuadpattern.getDuplicateElementLinks(pattern);return pattern.graph.termType==="Variable"&&!unionDefaultGraph&&(filteredOutput=filteredOutput.filter(quad=>quad.graph.termType!=="DefaultGraph")),duplicateElementLinks&&(filteredOutput=filteredOutput.filter(quad=>{for(const keyLeft in duplicateElementLinks){const keysLeft=keyLeft.split("_"),valueLeft=(0,rdf_terms_1.getValueNestedPath)(quad,keysLeft);for(const keysRight of duplicateElementLinks[keyLeft])if(!valueLeft.equals((0,rdf_terms_1.getValueNestedPath)(quad,keysRight)))return!1}return!0})),filteredOutput.map(quad=>BF.bindings(Object.keys(elementVariables).map(key=>{const keys2=key.split("_"),variable=elementVariables[key],term=(0,rdf_terms_1.getValueNestedPath)(quad,keys2);return[DF.variable(variable),term]})))},{autoStart:!1,onClose:()=>result.data.destroy()}),metadata}}}__name(ActorQueryOperationQuadpattern,"ActorQueryOperationQuadpattern");ActorQueryOperationQuadpattern$1.ActorQueryOperationQuadpattern=ActorQueryOperationQuadpattern;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorQueryOperationQuadpattern$1,exports)})(lib$3);var lib$2={},ActorHttpProxy$1={};Object.defineProperty(ActorHttpProxy$1,"__esModule",{value:!0});ActorHttpProxy$1.ActorHttpProxy=void 0;const bus_http_1$1=lib$1Y,context_entries_1$1=lib$2x;class ActorHttpProxy extends bus_http_1$1.ActorHttp{constructor(args){super(args)}async test(action){const proxyHandler=action.context.get(context_entries_1$1.KeysHttpProxy.httpProxyHandler);if(!proxyHandler)throw new Error(`Actor ${this.name} could not find a proxy handler in the context.`);if(!await proxyHandler.getProxy(action))throw new Error(`Actor ${this.name} could not determine a proxy for the given request.`);return{time:Number.POSITIVE_INFINITY}}async run(action){const requestedUrl=typeof action.input=="string"?action.input:action.input.url,proxyHandler=action.context.get(context_entries_1$1.KeysHttpProxy.httpProxyHandler),output=await this.mediatorHttp.mediate({...await proxyHandler.getProxy(action),context:action.context.delete(context_entries_1$1.KeysHttpProxy.httpProxyHandler)});return Object.defineProperty(output,"url",{configurable:!0,enumerable:!0,get:()=>output.headers.get("x-final-url")??requestedUrl}),output}}__name(ActorHttpProxy,"ActorHttpProxy");ActorHttpProxy$1.ActorHttpProxy=ActorHttpProxy;var ProxyHandlerStatic$1={};Object.defineProperty(ProxyHandlerStatic$1,"__esModule",{value:!0});ProxyHandlerStatic$1.ProxyHandlerStatic=void 0;class ProxyHandlerStatic{constructor(prefixUrl){this.prefixUrl=prefixUrl}async getProxy(request){return{init:request.init,input:this.modifyInput(request.input)}}modifyInput(input){return typeof input=="string"?this.prefixUrl+input:new Request(this.prefixUrl+input.url,input)}}__name(ProxyHandlerStatic,"ProxyHandlerStatic");ProxyHandlerStatic$1.ProxyHandlerStatic=ProxyHandlerStatic;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorHttpProxy$1,exports),__exportStar(ProxyHandlerStatic$1,exports)})(lib$2);var lib$1={},ActorDereferenceHttpBrowser={},ActorDereferenceHttpBase$1={};Object.defineProperty(ActorDereferenceHttpBase$1,"__esModule",{value:!0});ActorDereferenceHttpBase$1.ActorDereferenceHttpBase=ActorDereferenceHttpBase$1.mediaTypesToAcceptString=void 0;const bus_dereference_1=lib$1W,bus_http_1=lib$1Y,cross_fetch_1=browserPonyfillExports,relative_to_absolute_iri_1=relativeToAbsoluteIri,stringifyStream=streamToString$1,REGEX_MEDIATYPE=/^[^ ;]*/u;function mediaTypesToAcceptString(mediaTypes,maxLength){const wildcard="*/*;q=0.1",parts=[],sortedMediaTypes=Object.entries(mediaTypes).map(([mediaType,priority])=>({mediaType,priority})).sort((left,right)=>right.priority===left.priority?left.mediaType.localeCompare(right.mediaType):right.priority-left.priority);let partsLength=sortedMediaTypes.length-1;for(const{mediaType,priority}of sortedMediaTypes){const part=mediaType+(priority!==1?`;q=${priority.toFixed(3).replace(/0*$/u,"")}`:"");if(partsLength+part.length>maxLength){for(;partsLength+wildcard.length>maxLength;){const last3=parts.pop()||"";partsLength-=last3.length+1}parts.push(wildcard);break}parts.push(part),partsLength+=part.length}return parts.length===0?"*/*":parts.join(",")}__name(mediaTypesToAcceptString,"mediaTypesToAcceptString");ActorDereferenceHttpBase$1.mediaTypesToAcceptString=mediaTypesToAcceptString;class ActorDereferenceHttpBase extends bus_dereference_1.ActorDereference{constructor(args){super(args)}async test({url}){if(!/^https?:/u.test(url))throw new Error(`Cannot retrieve ${url} because it is not an HTTP(S) URL.`);return!0}async run(action){var _a2,_b;let exists=!0;const headers=new cross_fetch_1.Headers(action.headers);headers.append("Accept",mediaTypesToAcceptString(await((_a2=action.mediaTypes)==null?void 0:_a2.call(action))??{},this.getMaxAcceptHeaderLength()));let httpResponse;const requestTimeStart=Date.now();try{httpResponse=await this.mediatorHttp.mediate({context:action.context,init:{headers,method:action.method},input:action.url})}catch(error){return this.handleDereferenceErrors(action,error)}const url=(0,relative_to_absolute_iri_1.resolve)(httpResponse.url,action.url),requestTime=Date.now()-requestTimeStart;if(httpResponse.status!==200){exists=!1;const bodyString=httpResponse.body?await stringifyStream(bus_http_1.ActorHttp.toNodeReadable(httpResponse.body)):"empty response";if(!action.acceptErrors){const error=new Error(`Could not retrieve ${action.url} (HTTP status ${httpResponse.status}):
${bodyString}`);return this.handleDereferenceErrors(action,error,httpResponse.headers,requestTime)}}const mediaType=(_b=REGEX_MEDIATYPE.exec(httpResponse.headers.get("content-type")??""))==null?void 0:_b[0];return{url,data:exists?bus_http_1.ActorHttp.toNodeReadable(httpResponse.body):(0,bus_dereference_1.emptyReadable)(),exists,requestTime,headers:httpResponse.headers,mediaType:mediaType!=="text/plain"?mediaType:void 0}}}__name(ActorDereferenceHttpBase,"ActorDereferenceHttpBase");ActorDereferenceHttpBase$1.ActorDereferenceHttpBase=ActorDereferenceHttpBase;Object.defineProperty(ActorDereferenceHttpBrowser,"__esModule",{value:!0});ActorDereferenceHttpBrowser.ActorDereferenceHttp=void 0;const ActorDereferenceHttpBase_1=ActorDereferenceHttpBase$1;class ActorDereferenceHttp extends ActorDereferenceHttpBase_1.ActorDereferenceHttpBase{getMaxAcceptHeaderLength(){return this.maxAcceptHeaderLengthBrowser}}__name(ActorDereferenceHttp,"ActorDereferenceHttp");ActorDereferenceHttpBrowser.ActorDereferenceHttp=ActorDereferenceHttp;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorDereferenceHttpBrowser,exports),__exportStar(ActorDereferenceHttpBase$1,exports)})(lib$1);var lib={},ActorRdfResolveQuadPatternStringSource$1={};Object.defineProperty(ActorRdfResolveQuadPatternStringSource$1,"__esModule",{value:!0});ActorRdfResolveQuadPatternStringSource$1.ActorRdfResolveQuadPatternStringSource=void 0;const bus_rdf_resolve_quad_pattern_1=lib$1g,context_entries_1=lib$2x,lru_cache_1=cjs,rdf_store_stream_1=rdfStoreStream,readable_stream_1=browserExports$1;class ActorRdfResolveQuadPatternStringSource extends bus_rdf_resolve_quad_pattern_1.ActorRdfResolveQuadPattern{constructor(args){super(args),this.cache=this.cacheSize?new lru_cache_1.LRUCache({max:this.cacheSize}):void 0}async test(action){const source=(0,bus_rdf_resolve_quad_pattern_1.getContextSource)(action.context);if(!source)throw new Error(`Actor ${this.name} can only resolve quad pattern queries against a source.`);if(!this.isStringSource(source.valueOf()))throw new Error(`Actor ${this.name} can only resolve stringSource quad pattern`);return!0}run(action){var _a2;const source=(0,bus_rdf_resolve_quad_pattern_1.getContextSource)(action.context);let rdfSourcePromise=(_a2=this.cache)==null?void 0:_a2.get(source);return rdfSourcePromise||(rdfSourcePromise=this.getRdfSource(action.context,source),this.cache&&this.cache.set(source,rdfSourcePromise)),rdfSourcePromise.then(rdfSource=>this.mediatorRdfResolveQuadPattern.mediate({pattern:action.pattern,context:action.context.set(context_entries_1.KeysRdfResolveQuadPattern.source,{value:rdfSource,type:"rdfjsSource"})}))}async getRdfSource(context2,source){const textStream=new readable_stream_1.Readable({objectMode:!0});textStream._read=()=>{},textStream.push(source.value),textStream.push(null);const parseAction={context:context2,handle:{metadata:{baseIRI:source.baseIRI},data:textStream,context:context2},handleMediaType:source.mediaType},parseResult=await this.mediatorRdfParse.mediate(parseAction);return await(0,rdf_store_stream_1.storeStream)(parseResult.handle.data)}isStringSource(datasource){return"type"in datasource?datasource.type===ActorRdfResolveQuadPatternStringSource.sourceType:typeof datasource.value!="string"?!1:"mediaType"in datasource}}__name(ActorRdfResolveQuadPatternStringSource,"ActorRdfResolveQuadPatternStringSource");ActorRdfResolveQuadPatternStringSource$1.ActorRdfResolveQuadPatternStringSource=ActorRdfResolveQuadPatternStringSource;ActorRdfResolveQuadPatternStringSource.sourceType="stringSource";(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(ActorRdfResolveQuadPatternStringSource$1,exports)})(lib);const df_383_2=new lib$2u.LoggerVoid,https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_init__2_0_0_components_ActorInit_jsonld_ActorInit_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-init/^2.0.0/components/ActorInit.jsonld#ActorInit_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_context_preprocess__2_0_0_components_ActorContextPreprocess_jsonld_ActorContextPreprocess_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-context-preprocess/^2.0.0/components/ActorContextPreprocess.jsonld#ActorContextPreprocess_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_hash_bindings__2_0_0_components_ActorHashBindings_jsonld_ActorHashBindings_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-hash-bindings/^2.0.0/components/ActorHashBindings.jsonld#ActorHashBindings_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_optimize_query_operation__2_0_0_components_ActorOptimizeQueryOperation_jsonld_ActorOptimizeQueryOperation_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-optimize-query-operation/^2.0.0/components/ActorOptimizeQueryOperation.jsonld#ActorOptimizeQueryOperation_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus=new lib$2y.BusQueryOperation({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-query-operation/^2.0.0/components/ActorQueryOperation.jsonld#ActorQueryOperation_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_parse__2_0_0_components_ActorQueryParse_jsonld_ActorQueryParse_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-query-parse/^2.0.0/components/ActorQueryParse.jsonld#ActorQueryParse_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-query-result-serialize/^2.0.0/components/ActorQueryResultSerialize.jsonld#ActorQueryResultSerialize_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http_invalidate__2_0_0_components_ActorHttpInvalidate_jsonld_ActorHttpInvalidate_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-http-invalidate/^2.0.0/components/ActorHttpInvalidate.jsonld#ActorHttpInvalidate_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_serialize__2_0_0_components_ActorRdfSerialize_jsonld_ActorRdfSerialize_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-serialize/^2.0.0/components/ActorRdfSerialize.jsonld#ActorRdfSerialize_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-http/^2.0.0/components/ActorHttp.jsonld#ActorHttp_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_fallback_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-http/^2.0.0/components/ActorHttp.jsonld#ActorHttp_fallback_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_dereference__2_0_0_components_ActorDereference_jsonld_ActorDereference_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-dereference/^2.0.0/components/ActorDereference.jsonld#ActorDereference_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-parse/^2.0.0/components/ActorRdfParse.jsonld#ActorRdfParse_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_dereference_rdf__2_0_0_components_ActorDereferenceRdf_jsonld_ActorDereferenceRdf_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-dereference-rdf/^2.0.0/components/ActorDereferenceRdf.jsonld#ActorDereferenceRdf_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join_selectivity__2_0_0_components_ActorRdfJoinSelectivity_jsonld_ActorRdfJoinSelectivity_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-join-selectivity/^2.0.0/components/ActorRdfJoinSelectivity.jsonld#ActorRdfJoinSelectivity_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join_entries_sort__2_0_0_components_ActorRdfJoinEntriesSort_jsonld_ActorRdfJoinEntriesSort_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-join-entries-sort/^2.0.0/components/ActorRdfJoinEntriesSort.jsonld#ActorRdfJoinEntriesSort_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata__2_0_0_components_ActorRdfMetadata_jsonld_ActorRdfMetadata_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-metadata/^2.0.0/components/ActorRdfMetadata.jsonld#ActorRdfMetadata_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_accumulate__2_0_0_components_ActorRdfMetadataAccumulate_jsonld_ActorRdfMetadataAccumulate_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-metadata-accumulate/^2.0.0/components/ActorRdfMetadataAccumulate.jsonld#ActorRdfMetadataAccumulate_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-metadata-extract/^2.0.0/components/ActorRdfMetadataExtract.jsonld#ActorRdfMetadataExtract_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse_html__2_0_0_components_ActorRdfParseHtml_jsonld_ActorRdfParseHtml_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-parse-html/^2.0.0/components/ActorRdfParseHtml.jsonld#ActorRdfParseHtml_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia__2_0_0_components_ActorRdfResolveHypermedia_jsonld_ActorRdfResolveHypermedia_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-resolve-hypermedia/^2.0.0/components/ActorRdfResolveHypermedia.jsonld#ActorRdfResolveHypermedia_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia_links__2_0_0_components_ActorRdfResolveHypermediaLinks_jsonld_ActorRdfResolveHypermediaLinks_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-resolve-hypermedia-links/^2.0.0/components/ActorRdfResolveHypermediaLinks.jsonld#ActorRdfResolveHypermediaLinks_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia_links_queue__2_0_0_components_ActorRdfResolveHypermediaLinksQueue_jsonld_ActorRdfResolveHypermediaLinksQueue_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-resolve-hypermedia-links-queue/^2.0.0/components/ActorRdfResolveHypermediaLinksQueue.jsonld#ActorRdfResolveHypermediaLinksQueue_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_hypermedia__2_0_0_components_ActorRdfUpdateHypermedia_jsonld_ActorRdfUpdateHypermedia_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-update-hypermedia/^2.0.0/components/ActorRdfUpdateHypermedia.jsonld#ActorRdfUpdateHypermedia_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_quads__2_0_0_components_ActorRdfUpdateQuads_jsonld_ActorRdfUpdateQuads_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-update-quads/^2.0.0/components/ActorRdfUpdateQuads.jsonld#ActorRdfUpdateQuads_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-join/^2.0.0/components/ActorRdfJoin.jsonld#ActorRdfJoin_default_bus"}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_quad_pattern__2_0_0_components_ActorRdfResolveQuadPattern_jsonld_ActorRdfResolveQuadPattern_default_bus=new lib$2A.Bus({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/bus-rdf-resolve-quad-pattern/^2.0.0/components/ActorRdfResolveQuadPattern.jsonld#ActorRdfResolveQuadPattern_default_bus"});new lib$2t.ActorContextPreprocessSourceToDestination({name:"urn:comunica:default:context-preprocess/actors#source-to-destination",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_context_preprocess__2_0_0_components_ActorContextPreprocess_jsonld_ActorContextPreprocess_default_bus});const urn_comunica_default_context_preprocess_mediators_main=new lib$2r.MediatorCombinePipeline({name:"urn:comunica:default:context-preprocess/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_context_preprocess__2_0_0_components_ActorContextPreprocess_jsonld_ActorContextPreprocess_default_bus});new lib$2q.ActorHashBindingsSha1({name:"urn:comunica:default:hash-bindings/actors#sha1",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_hash_bindings__2_0_0_components_ActorHashBindings_jsonld_ActorHashBindings_default_bus});const urn_comunica_default_hash_bindings_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:hash-bindings/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_hash_bindings__2_0_0_components_ActorHashBindings_jsonld_ActorHashBindings_default_bus}),urn_comunica_default_optimize_query_operation_mediators_main=new lib$2r.MediatorCombinePipeline({name:"urn:comunica:default:optimize-query-operation/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_optimize_query_operation__2_0_0_components_ActorOptimizeQueryOperation_jsonld_ActorOptimizeQueryOperation_default_bus});new lib$2n.ActorOptimizeQueryOperationJoinBgp({name:"urn:comunica:default:optimize-query-operation/actors#join-bgp",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_optimize_query_operation__2_0_0_components_ActorOptimizeQueryOperation_jsonld_ActorOptimizeQueryOperation_default_bus});new lib$2l.ActorOptimizeQueryOperationBgpToJoin({name:"urn:comunica:default:optimize-query-operation/actors#bgp-to-join",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_optimize_query_operation__2_0_0_components_ActorOptimizeQueryOperation_jsonld_ActorOptimizeQueryOperation_default_bus});new lib$2k.ActorOptimizeQueryOperationJoinConnected({name:"urn:comunica:default:optimize-query-operation/actors#join-connected",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_optimize_query_operation__2_0_0_components_ActorOptimizeQueryOperation_jsonld_ActorOptimizeQueryOperation_default_bus});const urn_comunica_default_query_operation_mediators_main=new lib$2j.MediatorNumber({field:"httpRequests",type:"min",ignoreErrors:!0,name:"urn:comunica:default:query-operation/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$2i.ActorQueryOperationValues({name:"urn:comunica:default:query-operation/actors#values",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});const urn_comunica_default_query_parse_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:query-parse/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_parse__2_0_0_components_ActorQueryParse_jsonld_ActorQueryParse_default_bus});new lib$2g.ActorQueryParseSparql({prefixes:{dbpedia:"http://dbpedia.org/resource/","dbpedia-owl":"http://dbpedia.org/ontology/",dbpprop:"http://dbpedia.org/property/",dc:"http://purl.org/dc/terms/",dc11:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",owl:"http://www.w3.org/2002/07/owl#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",schema:"http://schema.org/",skos:"http://www.w3.org/2008/05/skos#",xsd:"http://www.w3.org/2001/XMLSchema#"},name:"urn:comunica:default:query-parse/actors#sparql",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_parse__2_0_0_components_ActorQueryParse_jsonld_ActorQueryParse_default_bus});new lib$2e.ActorQueryParseGraphql({name:"urn:comunica:default:query-parse/actors#graphql",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_parse__2_0_0_components_ActorQueryParse_jsonld_ActorQueryParse_default_bus});const urn_comunica_default_query_result_serialize_mediators_serialize=new lib$2o.MediatorRace({name:"urn:comunica:default:query-result-serialize/mediators#serialize",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus}),urn_comunica_default_query_result_serialize_mediators_mediaType=new lib$2d.MediatorCombineUnion({field:"mediaTypes",name:"urn:comunica:default:query-result-serialize/mediators#mediaType",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus}),urn_comunica_default_query_result_serialize_mediators_mediaTypeFormat=new lib$2d.MediatorCombineUnion({field:"mediaTypeFormats",name:"urn:comunica:default:query-result-serialize/mediators#mediaTypeFormat",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$2c.ActorQueryResultSerializeJson({mediaTypePriorities:{"application/json":1},mediaTypeFormats:{"application/json":"https://comunica.linkeddatafragments.org/#results_JSON"},name:"urn:comunica:default:query-result-serialize/actors#json",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$29.ActorQueryResultSerializeSimple({mediaTypePriorities:{simple:.9},mediaTypeFormats:{simple:"https://comunica.linkeddatafragments.org/#results_simple"},name:"urn:comunica:default:query-result-serialize/actors#simple",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$28.ActorQueryResultSerializeSparqlCsv({mediaTypePriorities:{"text/csv":.75},mediaTypeFormats:{"text/csv":"http://www.w3.org/ns/formats/SPARQL_Results_CSV"},name:"urn:comunica:default:query-result-serialize/actors#csv",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$27.ActorQueryResultSerializeSparqlTsv({mediaTypePriorities:{"text/tab-separated-values":.75},mediaTypeFormats:{"text/tab-separated-values":"http://www.w3.org/ns/formats/SPARQL_Results_TSV"},name:"urn:comunica:default:query-result-serialize/actors#sparql-tsv",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$26.ActorQueryResultSerializeSparqlXml({mediaTypePriorities:{"application/sparql-results+xml":.8},mediaTypeFormats:{"application/sparql-results+xml":"http://www.w3.org/ns/formats/SPARQL_Results_XML"},name:"urn:comunica:default:query-result-serialize/actors#sparql-xml",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$25.ActorQueryResultSerializeTable({columnWidth:50,mediaTypePriorities:{table:.6},mediaTypeFormats:{table:"https://comunica.linkeddatafragments.org/#results_table"},name:"urn:comunica:default:query-result-serialize/actors#table",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$24.ActorQueryResultSerializeTree({mediaTypePriorities:{tree:.5},mediaTypeFormats:{tree:"https://comunica.linkeddatafragments.org/#results_tree"},name:"urn:comunica:default:query-result-serialize/actors#tree",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});const urn_comunica_default_http_invalidate_mediators_main=new lib$23.MediatorAll({name:"urn:comunica:default:http-invalidate/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http_invalidate__2_0_0_components_ActorHttpInvalidate_jsonld_ActorHttpInvalidate_default_bus}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_sparql_json__2_0_0_components_ActionObserverHttp_jsonld_IActionObserverHttpArgs_default_invalidator=new lib$22.ActorHttpInvalidateListenable({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/actor-query-result-serialize-sparql-json/^2.0.0/components/ActionObserverHttp.jsonld#IActionObserverHttpArgs_default_invalidator",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http_invalidate__2_0_0_components_ActorHttpInvalidate_jsonld_ActorHttpInvalidate_default_bus}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_stats__2_0_0_components_ActionObserverHttp_jsonld_IActionObserverHttpArgs_default_invalidator=new lib$22.ActorHttpInvalidateListenable({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/actor-query-result-serialize-stats/^2.0.0/components/ActionObserverHttp.jsonld#IActionObserverHttpArgs_default_invalidator",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http_invalidate__2_0_0_components_ActorHttpInvalidate_jsonld_ActorHttpInvalidate_default_bus}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_rdf_update_quads_hypermedia__2_0_0_components_ActorRdfUpdateQuadsHypermedia_jsonld_IActorRdfUpdateQuadsHypermediaArgs_default_invalidator=new lib$22.ActorHttpInvalidateListenable({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/actor-rdf-update-quads-hypermedia/^2.0.0/components/ActorRdfUpdateQuadsHypermedia.jsonld#IActorRdfUpdateQuadsHypermediaArgs_default_invalidator",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http_invalidate__2_0_0_components_ActorHttpInvalidate_jsonld_ActorHttpInvalidate_default_bus}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_rdf_resolve_quad_pattern_hypermedia__2_0_0_components_ActorRdfResolveQuadPatternHypermedia_jsonld_IActorRdfResolveQuadPatternHypermediaArgs_default_invalidator=new lib$22.ActorHttpInvalidateListenable({name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/actor-rdf-resolve-quad-pattern-hypermedia/^2.0.0/components/ActorRdfResolveQuadPatternHypermedia.jsonld#IActorRdfResolveQuadPatternHypermediaArgs_default_invalidator",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http_invalidate__2_0_0_components_ActorHttpInvalidate_jsonld_ActorHttpInvalidate_default_bus}),urn_comunica_default_rdf_serialize_mediators_serialize=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-serialize/mediators#serialize",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_serialize__2_0_0_components_ActorRdfSerialize_jsonld_ActorRdfSerialize_default_bus}),urn_comunica_default_rdf_serialize_mediators_mediaType=new lib$2d.MediatorCombineUnion({field:"mediaTypes",name:"urn:comunica:default:rdf-serialize/mediators#mediaType",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_serialize__2_0_0_components_ActorRdfSerialize_jsonld_ActorRdfSerialize_default_bus}),urn_comunica_default_rdf_serialize_mediators_mediaTypeFormat=new lib$2d.MediatorCombineUnion({field:"mediaTypeFormats",name:"urn:comunica:default:rdf-serialize/mediators#mediaTypeFormat",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_serialize__2_0_0_components_ActorRdfSerialize_jsonld_ActorRdfSerialize_default_bus});new lib$21.ActorRdfSerializeN3({mediaTypePriorities:{"application/n-quads":1,"application/n-triples":.8,"application/trig":.95,"text/n3":.35,"text/turtle":.6},mediaTypeFormats:{"application/n-quads":"http://www.w3.org/ns/formats/N-Quads","application/n-triples":"http://www.w3.org/ns/formats/N-Triples","application/trig":"http://www.w3.org/ns/formats/TriG","text/n3":"http://www.w3.org/ns/formats/N3","text/turtle":"http://www.w3.org/ns/formats/Turtle"},name:"urn:comunica:default:rdf-serialize/actors#n3",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_serialize__2_0_0_components_ActorRdfSerialize_jsonld_ActorRdfSerialize_default_bus});new lib$1$.ActorRdfSerializeJsonLd({jsonStringifyIndentSpaces:2,mediaTypePriorities:{"application/ld+json":1},mediaTypeFormats:{"application/ld+json":"http://www.w3.org/ns/formats/JSON-LD"},priorityScale:.9,name:"urn:comunica:default:rdf-serialize/actors#jsonld",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_serialize__2_0_0_components_ActorRdfSerialize_jsonld_ActorRdfSerialize_default_bus});new lib$1_.ActorRdfSerializeShaclc({mediaTypePriorities:{"text/shaclc":1,"text/shaclc-ext":.5},mediaTypeFormats:{"text/shaclc":"http://www.w3.org/ns/formats/Shaclc","text/shaclc-ext":"http://www.w3.org/ns/formats/ShaclcExtended"},priorityScale:.1,name:"urn:comunica:default:rdf-serialize/actors#shaclc",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_serialize__2_0_0_components_ActorRdfSerialize_jsonld_ActorRdfSerialize_default_bus});const urn_comunica_default_http_actors_fetch=new lib$1Z.ActorHttpFetch({agentOptions:{keepAlive:!0,maxSockets:5},name:"urn:comunica:default:http/actors#fetch",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_default_bus}),urn_comunica_default_http_mediators_no_fallback=new lib$2j.MediatorNumber({field:"time",type:"min",ignoreErrors:!0,name:"urn:comunica:default:http/mediators#no-fallback",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_default_bus}),urn_comunica_default_http_mediators_main=new lib$2j.MediatorNumber({field:"time",type:"min",ignoreErrors:!0,name:"urn:comunica:default:http/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_fallback_bus}),urn_comunica_default_dereference_actors_fallback=new lib$1X.ActorDereferenceFallback({name:"urn:comunica:default:dereference/actors#fallback",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_dereference__2_0_0_components_ActorDereference_jsonld_ActorDereference_default_bus}),urn_comunica_default_dereference_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:dereference/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_dereference__2_0_0_components_ActorDereference_jsonld_ActorDereference_default_bus}),urn_comunica_default_rdf_parse_mediators_parse=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-parse/mediators#parse",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus}),urn_comunica_default_rdf_parse_mediators_mediaType=new lib$2d.MediatorCombineUnion({field:"mediaTypes",name:"urn:comunica:default:rdf-parse/mediators#mediaType",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus});new lib$1V.ActorRdfParseN3({mediaTypePriorities:{"application/n-quads":1,"application/n-triples":.8,"application/trig":.95,"text/n3":.35,"text/turtle":.6},mediaTypeFormats:{"application/n-quads":"http://www.w3.org/ns/formats/N-Quads","application/n-triples":"http://www.w3.org/ns/formats/N-Triples","application/trig":"http://www.w3.org/ns/formats/TriG","text/n3":"http://www.w3.org/ns/formats/N3","text/turtle":"http://www.w3.org/ns/formats/Turtle"},priorityScale:1,name:"urn:comunica:default:rdf-parse/actors#n3",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus});new lib$1T.ActorRdfParseRdfXml({mediaTypePriorities:{"application/rdf+xml":1},mediaTypeFormats:{"application/rdf+xml":"http://www.w3.org/ns/formats/RDF_XML"},priorityScale:.5,name:"urn:comunica:default:rdf-parse/actors#rdfxml",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus});new lib$1S.ActorRdfParseXmlRdfa({mediaTypePriorities:{"application/xml":1,"image/svg+xml":1,"text/xml":1},mediaTypeFormats:{"application/xml":"http://www.w3.org/ns/formats/RDFa","image/svg+xml":"http://www.w3.org/ns/formats/RDFa","text/xml":"http://www.w3.org/ns/formats/RDFa"},priorityScale:.3,name:"urn:comunica:default:rdf-parse/actors#xmlrdfa",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus});new lib$1L.ActorRdfParseShaclc({mediaTypePriorities:{"text/shaclc":1,"text/shaclc-ext":.5},mediaTypeFormats:{"text/shaclc":"http://www.w3.org/ns/formats/Shaclc","text/shaclc-ext":"http://www.w3.org/ns/formats/ShaclcExtended"},priorityScale:.1,name:"urn:comunica:default:rdf-parse/actors#shaclc",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus});const urn_comunica_default_dereference_rdf_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:dereference-rdf/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_dereference_rdf__2_0_0_components_ActorDereferenceRdf_jsonld_ActorDereferenceRdf_default_bus});new lib$1J.ActorRdfJoinSelectivityVariableCounting({name:"urn:comunica:default:rdf-join-selectivity/actors#variable-counting",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join_selectivity__2_0_0_components_ActorRdfJoinSelectivity_jsonld_ActorRdfJoinSelectivity_default_bus});const urn_comunica_default_rdf_join_selectivity_mediators_main=new lib$2j.MediatorNumber({field:"accuracy",type:"max",ignoreErrors:!0,name:"urn:comunica:default:rdf-join-selectivity/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join_selectivity__2_0_0_components_ActorRdfJoinSelectivity_jsonld_ActorRdfJoinSelectivity_default_bus});new lib$1H.ActorRdfJoinEntriesSortCardinality({name:"urn:comunica:default:rdf-join-entries-sort/actors#cardinality",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join_entries_sort__2_0_0_components_ActorRdfJoinEntriesSort_jsonld_ActorRdfJoinEntriesSort_default_bus});const urn_comunica_default_rdf_join_entries_sort_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-join-entries-sort/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join_entries_sort__2_0_0_components_ActorRdfJoinEntriesSort_jsonld_ActorRdfJoinEntriesSort_default_bus});new lib$1F.ActorRdfMetadataPrimaryTopic({metadataToData:!1,dataToMetadataOnInvalidMetadataGraph:!0,name:"urn:comunica:default:rdf-metadata/actors#primary-topic",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata__2_0_0_components_ActorRdfMetadata_jsonld_ActorRdfMetadata_default_bus});new lib$1D.ActorRdfMetadataAll({name:"urn:comunica:default:rdf-metadata/actors#all",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata__2_0_0_components_ActorRdfMetadata_jsonld_ActorRdfMetadata_default_bus});const urn_comunica_default_rdf_metadata_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-metadata/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata__2_0_0_components_ActorRdfMetadata_jsonld_ActorRdfMetadata_default_bus});new lib$1C.ActorRdfMetadataAccumulateCanContainUndefs({name:"urn:comunica:default:rdf-metadata-accumulate/actors#cancontainundefs",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_accumulate__2_0_0_components_ActorRdfMetadataAccumulate_jsonld_ActorRdfMetadataAccumulate_default_bus});new lib$1A.ActorRdfMetadataAccumulateCardinality({name:"urn:comunica:default:rdf-metadata-accumulate/actors#cardinality",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_accumulate__2_0_0_components_ActorRdfMetadataAccumulate_jsonld_ActorRdfMetadataAccumulate_default_bus});new lib$1z.ActorRdfMetadataAccumulatePageSize({name:"urn:comunica:default:rdf-metadata-accumulate/actors#pagesize",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_accumulate__2_0_0_components_ActorRdfMetadataAccumulate_jsonld_ActorRdfMetadataAccumulate_default_bus});new lib$1y.ActorRdfMetadataAccumulateRequestTime({name:"urn:comunica:default:rdf-metadata-accumulate/actors#requesttime",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_accumulate__2_0_0_components_ActorRdfMetadataAccumulate_jsonld_ActorRdfMetadataAccumulate_default_bus});const urn_comunica_default_rdf_metadata_accumulate_mediators_main=new lib$2d.MediatorCombineUnion({field:"metadata",name:"urn:comunica:default:rdf-metadata-accumulate/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_accumulate__2_0_0_components_ActorRdfMetadataAccumulate_jsonld_ActorRdfMetadataAccumulate_default_bus});new lib$1x.ActorRdfMetadataExtractHydraControls({name:"urn:comunica:default:rdf-metadata-extract/actors#hydra-controls",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1v.ActorRdfMetadataExtractHydraCount({predicates:["http://www.w3.org/ns/hydra/core#totalItems","http://rdfs.org/ns/void#triples"],name:"urn:comunica:default:rdf-metadata-extract/actors#hydra-count",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1u.ActorRdfMetadataExtractHydraPagesize({predicates:["http://www.w3.org/ns/hydra/core#itemsPerPage"],name:"urn:comunica:default:rdf-metadata-extract/actors#hydra-pagesize",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1t.ActorRdfMetadataExtractRequestTime({name:"urn:comunica:default:rdf-metadata-extract/actors#request-time",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1s.ActorRdfMetadataExtractAllowHttpMethods({name:"urn:comunica:default:rdf-metadata-extract/actors#allow-http-methods",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1r.ActorRdfMetadataExtractPutAccepted({name:"urn:comunica:default:rdf-metadata-extract/actors#put-accepted",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1q.ActorRdfMetadataExtractPatchSparqlUpdate({name:"urn:comunica:default:rdf-metadata-extract/actors#patch-sparql-update",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1p.ActorRdfMetadataExtractSparqlService({inferHttpsEndpoint:!0,name:"urn:comunica:default:rdf-metadata-extract/actors#sparql-service",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});const urn_comunica_default_rdf_metadata_extract_mediators_main=new lib$2d.MediatorCombineUnion({field:"metadata",name:"urn:comunica:default:rdf-metadata-extract/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_metadata_extract__2_0_0_components_ActorRdfMetadataExtract_jsonld_ActorRdfMetadataExtract_default_bus});new lib$1o.ActorRdfParseHtml({busRdfParseHtml:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse_html__2_0_0_components_ActorRdfParseHtml_jsonld_ActorRdfParseHtml_default_bus,mediaTypePriorities:{"application/xhtml+xml":.9,"text/html":1},mediaTypeFormats:{"application/xhtml+xml":"http://www.w3.org/ns/formats/HTML","text/html":"http://www.w3.org/ns/formats/HTML"},priorityScale:.2,name:"urn:comunica:default:rdf-parse/actors#html",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus});new lib$1m.ActorRdfParseHtmlMicrodata({name:"urn:comunica:default:rdf-parse-html/actors#microdata",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse_html__2_0_0_components_ActorRdfParseHtml_jsonld_ActorRdfParseHtml_default_bus});new lib$1j.ActorRdfParseHtmlRdfa({name:"urn:comunica:default:rdf-parse-html/actors#rdfa",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse_html__2_0_0_components_ActorRdfParseHtml_jsonld_ActorRdfParseHtml_default_bus});new lib$1i.ActorRdfResolveHypermediaNone({name:"urn:comunica:default:rdf-resolve-hypermedia/actors#none",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia__2_0_0_components_ActorRdfResolveHypermedia_jsonld_ActorRdfResolveHypermedia_default_bus});const urn_comunica_default_rdf_resolve_hypermedia_mediators_main=new lib$2j.MediatorNumber({field:"filterFactor",type:"max",ignoreErrors:!0,name:"urn:comunica:default:rdf-resolve-hypermedia/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia__2_0_0_components_ActorRdfResolveHypermedia_jsonld_ActorRdfResolveHypermedia_default_bus});new lib$1e.ActorRdfResolveHypermediaLinksNext({name:"urn:comunica:default:rdf-resolve-hypermedia-links/actors#next",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia_links__2_0_0_components_ActorRdfResolveHypermediaLinks_jsonld_ActorRdfResolveHypermediaLinks_default_bus});const urn_comunica_default_rdf_resolve_hypermedia_links_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-resolve-hypermedia-links/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia_links__2_0_0_components_ActorRdfResolveHypermediaLinks_jsonld_ActorRdfResolveHypermediaLinks_default_bus});new lib$1c.ActorRdfResolveHypermediaLinksQueueFifo({name:"urn:comunica:default:rdf-resolve-hypermedia-links-queue/actors#fifo",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia_links_queue__2_0_0_components_ActorRdfResolveHypermediaLinksQueue_jsonld_ActorRdfResolveHypermediaLinksQueue_default_bus});const urn_comunica_default_rdf_resolve_hypermedia_links_queue_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-resolve-hypermedia-links-queue/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia_links_queue__2_0_0_components_ActorRdfResolveHypermediaLinksQueue_jsonld_ActorRdfResolveHypermediaLinksQueue_default_bus}),urn_comunica_default_rdf_update_hypermedia_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-update-hypermedia/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_hypermedia__2_0_0_components_ActorRdfUpdateHypermedia_jsonld_ActorRdfUpdateHypermedia_default_bus});new lib$1a.ActorRdfUpdateQuadsRdfJsStore({name:"urn:comunica:default:rdf-update-quads/actors#rdfjs-store",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_quads__2_0_0_components_ActorRdfUpdateQuads_jsonld_ActorRdfUpdateQuads_default_bus});const urn_comunica_default_rdf_update_quads_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-update-quads/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_quads__2_0_0_components_ActorRdfUpdateQuads_jsonld_ActorRdfUpdateQuads_default_bus}),urn_comunica_default_rdf_join_mediators_main=new lib$17.MediatorJoinCoefficientsFixed({cpuWeight:1,memoryWeight:1,timeWeight:10,ioWeight:100,name:"urn:comunica:default:rdf-join/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus}),urn_comunica_default_rdf_resolve_quad_pattern_mediators_main=new lib$2o.MediatorRace({name:"urn:comunica:default:rdf-resolve-quad-pattern/mediators#main",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_quad_pattern__2_0_0_components_ActorRdfResolveQuadPattern_jsonld_ActorRdfResolveQuadPattern_default_bus});new lib$16.ActorQueryOperationAsk({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#ask",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$15.ActorQueryOperationConstruct({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#construct",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$14.ActorQueryOperationBgpJoin({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#bgp",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$13.ActorQueryOperationDistinctHash({mediatorHashBindings:urn_comunica_default_hash_bindings_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#distinct",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$12.ActorQueryOperationExtend({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#extend",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$11.ActorQueryOperationFilterSparqlee({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#filter",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$10.ActorQueryOperationDescribeSubject({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#describe",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$_.ActorQueryOperationGroup({mediatorHashBindings:urn_comunica_default_hash_bindings_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#group",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$Z.ActorQueryOperationFromQuad({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#from",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$Y.ActorQueryOperationOrderBySparqlee({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#orderby",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$X.ActorQueryOperationNop({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#nop",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$W.ActorQueryOperationProject({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#project",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$V.ActorQueryOperationService({forceSparqlEndpoint:!1,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#service",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$U.ActorQueryOperationReducedHash({mediatorHashBindings:urn_comunica_default_hash_bindings_mediators_main,cacheSize:100,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#reduced",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$T.ActorQueryOperationSlice({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#slice",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$$.ActorQueryOperationUnion({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#union",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$S.ActorQueryOperationPathAlt({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-alt",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$Q.ActorQueryOperationPathLink({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-link",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$P.ActorQueryOperationPathInv({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-inv",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$O.ActorQueryOperationPathNps({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-nps",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$N.ActorQueryOperationPathOneOrMore({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-one-or-more",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$M.ActorQueryOperationPathZeroOrMore({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-zero-or-more",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$L.ActorQueryOperationPathZeroOrOne({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-zero-or-one",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$K.ActorQueryOperationAddRewrite({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-add",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$J.ActorQueryOperationUpdateCompositeUpdate({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-composite",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$I.ActorQueryOperationCopyRewrite({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-copy",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$H.ActorQueryOperationMoveRewrite({mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-move",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});const urn_comunica_default_init_actors_query=new indexBrowser.ActorInitQuery({mediatorOptimizeQueryOperation:urn_comunica_default_optimize_query_operation_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,mediatorQueryParse:urn_comunica_default_query_parse_mediators_main,mediatorQueryResultSerialize:urn_comunica_default_query_result_serialize_mediators_serialize,mediatorQueryResultSerializeMediaTypeCombiner:urn_comunica_default_query_result_serialize_mediators_mediaType,mediatorQueryResultSerializeMediaTypeFormatCombiner:urn_comunica_default_query_result_serialize_mediators_mediaTypeFormat,mediatorContextPreprocess:urn_comunica_default_context_preprocess_mediators_main,mediatorHttpInvalidate:urn_comunica_default_http_invalidate_mediators_main,logger:df_383_2,defaultQueryInputFormat:"sparql",allowNoSources:!1,contextKeyShortcuts:{baseIRI:"@comunica/actor-init-query:baseIRI",datetime:"@comunica/actor-http-memento:datetime",destination:"@comunica/bus-rdf-update-quads:destination",explain:"@comunica/actor-init-query:explain",extensionFunctionCreator:"@comunica/actor-init-query:extensionFunctionCreator",extensionFunctions:"@comunica/actor-init-query:extensionFunctions",fetch:"@comunica/bus-http:fetch",functionArgumentsCache:"@comunica/actor-init-query:functionArgumentsCache",httpAuth:"@comunica/bus-http:auth",httpBodyTimeout:"@comunica/bus-http:http-body-timeout",httpIncludeCredentials:"@comunica/bus-http:include-credentials",httpProxyHandler:"@comunica/actor-http-proxy:httpProxyHandler",httpRetryCount:"@comunica/bus-http:http-retry-count",httpRetryDelay:"@comunica/bus-http:http-retry-delay",httpRetryOnServerError:"@comunica/bus-http:http-retry-on-server-error",httpTimeout:"@comunica/bus-http:http-timeout",initialBindings:"@comunica/actor-init-query:initialBindings",lenient:"@comunica/actor-init-query:lenient",log:"@comunica/core:log",queryFormat:"@comunica/actor-init-query:queryFormat",queryTimestamp:"@comunica/actor-init-query:queryTimestamp",readOnly:"@comunica/bus-query-operation:readOnly",recoverBrokenLinks:"@comunica/bus-http-wayback:recover-broken-links",source:"@comunica/bus-rdf-resolve-quad-pattern:source",sources:"@comunica/bus-rdf-resolve-quad-pattern:sources",unionDefaultGraph:"@comunica/bus-query-operation:unionDefaultGraph"},name:"urn:comunica:default:init/actors#query",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_init__2_0_0_components_ActorInit_jsonld_ActorInit_default_bus}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_sparql_json__2_0_0_components_ActorQueryResultSerializeSparqlJson_jsonld_ActorQueryResultSerializeSparqlJson_default_observer=new lib$G.ActionObserverHttp({httpInvalidator:https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_sparql_json__2_0_0_components_ActionObserverHttp_jsonld_IActionObserverHttpArgs_default_invalidator,name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/actor-query-result-serialize-sparql-json/^2.0.0/components/ActorQueryResultSerializeSparqlJson.jsonld#ActorQueryResultSerializeSparqlJson_default_observer",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_default_bus}),https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_stats__2_0_0_components_ActorQueryResultSerializeStats_jsonld_ActorQueryResultSerializeStats_default_observer=new lib$F.ActionObserverHttp({httpInvalidator:https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_stats__2_0_0_components_ActionObserverHttp_jsonld_IActionObserverHttpArgs_default_invalidator,name:"https://linkedsoftwaredependencies.org/bundles/npm/@comunica/actor-query-result-serialize-stats/^2.0.0/components/ActorQueryResultSerializeStats.jsonld#ActorQueryResultSerializeStats_default_observer",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_default_bus});new lib$E.ActorQueryResultSerializeRdf({mediatorRdfSerialize:urn_comunica_default_rdf_serialize_mediators_serialize,mediatorMediaTypeCombiner:urn_comunica_default_rdf_serialize_mediators_mediaType,mediatorMediaTypeFormatCombiner:urn_comunica_default_rdf_serialize_mediators_mediaTypeFormat,name:"urn:comunica:default:query-result-serialize/actors#rdf",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$D.ActorHttpWayback({mediatorHttp:urn_comunica_default_http_mediators_no_fallback,name:"urn:comunica:default:http/actors#wayback",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_fallback_bus});new lib$C.ActorRdfParseJsonLd({mediatorHttp:urn_comunica_default_http_mediators_main,mediaTypePriorities:{"application/json":.5,"application/ld+json":1},mediaTypeFormats:{"application/json":"http://www.w3.org/ns/formats/JSON-LD","application/ld+json":"http://www.w3.org/ns/formats/JSON-LD"},priorityScale:.9,name:"urn:comunica:default:rdf-parse/actors#jsonld",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse__2_0_0_components_ActorRdfParse_jsonld_ActorRdfParse_default_bus});new lib$B.ActorRdfResolveHypermediaSparql({mediatorHttp:urn_comunica_default_http_mediators_main,checkUrlSuffix:!0,forceHttpGet:!1,cacheSize:1024,name:"urn:comunica:default:rdf-resolve-quad-pattern/actors#sparql",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia__2_0_0_components_ActorRdfResolveHypermedia_jsonld_ActorRdfResolveHypermedia_default_bus});new lib$A.ActorRdfUpdateHypermediaPatchSparqlUpdate({mediatorHttp:urn_comunica_default_http_mediators_main,name:"urn:comunica:default:rdf-update-hypermedia/actors#patch-sparql-update",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_hypermedia__2_0_0_components_ActorRdfUpdateHypermedia_jsonld_ActorRdfUpdateHypermedia_default_bus});new lib$y.ActorRdfUpdateHypermediaPutLdp({mediatorHttp:urn_comunica_default_http_mediators_main,mediatorRdfSerializeMediatypes:urn_comunica_default_rdf_serialize_mediators_mediaType,mediatorRdfSerialize:urn_comunica_default_rdf_serialize_mediators_serialize,name:"urn:comunica:default:rdf-update-hypermedia/actors#put-ldp",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_hypermedia__2_0_0_components_ActorRdfUpdateHypermedia_jsonld_ActorRdfUpdateHypermedia_default_bus});new lib$x.ActorRdfUpdateHypermediaSparql({mediatorHttp:urn_comunica_default_http_mediators_main,checkUrlSuffixSparql:!0,checkUrlSuffixUpdate:!0,name:"urn:comunica:default:rdf-update-hypermedia/actors#sparql",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_hypermedia__2_0_0_components_ActorRdfUpdateHypermedia_jsonld_ActorRdfUpdateHypermedia_default_bus});new lib$w.ActorQueryOperationSparqlEndpoint({mediatorHttp:urn_comunica_default_http_mediators_main,checkUrlSuffixSparql:!0,checkUrlSuffixUpdate:!0,forceHttpGet:!1,name:"urn:comunica:default:query-operation/actors#sparql-endpoint",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$v.ActorDereferenceRdfParse({mediatorDereference:urn_comunica_default_dereference_mediators_main,mediatorParse:urn_comunica_default_rdf_parse_mediators_parse,mediatorParseMediatypes:urn_comunica_default_rdf_parse_mediators_mediaType,mediaMappings:{htm:"text/html",html:"text/html",json:"application/json",jsonld:"application/ld+json",n3:"text/n3",nq:"application/n-quads",nquads:"application/n-quads",nt:"application/n-triples",ntriples:"application/n-triples",owl:"application/rdf+xml",rdf:"application/rdf+xml",rdfxml:"application/rdf+xml",shaclc:"text/shaclc",shaclce:"text/shaclc-ext",shc:"text/shaclc",shce:"text/shaclc-ext",svg:"image/svg+xml",svgz:"image/svg+xml",trig:"application/trig",ttl:"text/turtle",turtle:"text/turtle",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xml:"application/xml"},name:"urn:comunica:default:dereference-rdf/actors#parse",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_dereference_rdf__2_0_0_components_ActorDereferenceRdf_jsonld_ActorDereferenceRdf_default_bus});new lib$t.ActorRdfParseHtmlScript({mediatorRdfParseMediatypes:urn_comunica_default_rdf_parse_mediators_mediaType,mediatorRdfParseHandle:urn_comunica_default_rdf_parse_mediators_parse,name:"urn:comunica:default:rdf-parse-html/actors#script",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_parse_html__2_0_0_components_ActorRdfParseHtml_jsonld_ActorRdfParseHtml_default_bus});new lib$s.ActorRdfJoinMinusHash({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#minus-hash",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$q.ActorRdfJoinMinusHashUndef({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#minus-hash-undef",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$p.ActorRdfJoinNone({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-none",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$o.ActorRdfJoinSingle({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-single",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$n.ActorRdfJoinMultiEmpty({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-multi-empty",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$m.ActorRdfJoinHash({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-hash",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$l.ActorRdfJoinSymmetricHash({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-symmetric-hash",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$k.ActorRdfJoinNestedLoop({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-nested-loop",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$j.ActorRdfJoinOptionalBind({bindOrder:"depth-first",selectivityModifier:1e-4,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#optional-bind",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$h.ActorRdfJoinOptionalNestedLoop({mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#optional-nested-loop",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$i.ActorRdfJoinMultiBind({bindOrder:"depth-first",selectivityModifier:1e-4,mediatorJoinEntriesSort:urn_comunica_default_rdf_join_entries_sort_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-multi-bind",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$g.ActorRdfResolveHypermediaQpf({mediatorMetadata:urn_comunica_default_rdf_metadata_mediators_main,mediatorMetadataExtract:urn_comunica_default_rdf_metadata_extract_mediators_main,mediatorDereferenceRdf:urn_comunica_default_dereference_rdf_mediators_main,subjectUri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#subject",predicateUri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#predicate",objectUri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#object",graphUri:"http://www.w3.org/ns/sparql-service-description#graph",name:"urn:comunica:default:rdf-resolve-hypermedia/actors#qpf",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_hypermedia__2_0_0_components_ActorRdfResolveHypermedia_jsonld_ActorRdfResolveHypermedia_default_bus});const urn_comunica_default_rdf_resolve_quad_pattern_actors_hypermedia=new lib$f.ActorRdfResolveQuadPatternHypermedia({cacheSize:100,httpInvalidator:https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_rdf_resolve_quad_pattern_hypermedia__2_0_0_components_ActorRdfResolveQuadPatternHypermedia_jsonld_IActorRdfResolveQuadPatternHypermediaArgs_default_invalidator,maxIterators:64,aggregateStore:!1,mediatorDereferenceRdf:urn_comunica_default_dereference_rdf_mediators_main,mediatorMetadata:urn_comunica_default_rdf_metadata_mediators_main,mediatorMetadataExtract:urn_comunica_default_rdf_metadata_extract_mediators_main,mediatorMetadataAccumulate:urn_comunica_default_rdf_metadata_accumulate_mediators_main,mediatorRdfResolveHypermedia:urn_comunica_default_rdf_resolve_hypermedia_mediators_main,mediatorRdfResolveHypermediaLinks:urn_comunica_default_rdf_resolve_hypermedia_links_mediators_main,mediatorRdfResolveHypermediaLinksQueue:urn_comunica_default_rdf_resolve_hypermedia_links_queue_mediators_main,name:"urn:comunica:default:rdf-resolve-quad-pattern/actors#hypermedia",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_quad_pattern__2_0_0_components_ActorRdfResolveQuadPattern_jsonld_ActorRdfResolveQuadPattern_default_bus});new lib$e.ActorRdfUpdateQuadsHypermedia({cacheSize:100,httpInvalidator:https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_rdf_update_quads_hypermedia__2_0_0_components_ActorRdfUpdateQuadsHypermedia_jsonld_IActorRdfUpdateQuadsHypermediaArgs_default_invalidator,mediatorDereferenceRdf:urn_comunica_default_dereference_rdf_mediators_main,mediatorMetadata:urn_comunica_default_rdf_metadata_mediators_main,mediatorMetadataExtract:urn_comunica_default_rdf_metadata_extract_mediators_main,mediatorRdfUpdateHypermedia:urn_comunica_default_rdf_update_hypermedia_mediators_main,name:"urn:comunica:default:rdf-update-quads/actors#hypermedia",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_update_quads__2_0_0_components_ActorRdfUpdateQuads_jsonld_ActorRdfUpdateQuads_default_bus});new lib$d.ActorQueryOperationClear({mediatorUpdateQuads:urn_comunica_default_rdf_update_quads_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-clear",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$c.ActorQueryOperationCreate({mediatorUpdateQuads:urn_comunica_default_rdf_update_quads_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-create",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$b.ActorQueryOperationUpdateDeleteInsert({mediatorUpdateQuads:urn_comunica_default_rdf_update_quads_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-delete-insert",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$a.ActorQueryOperationDrop({mediatorUpdateQuads:urn_comunica_default_rdf_update_quads_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-drop",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$9.ActorQueryOperationLoad({mediatorUpdateQuads:urn_comunica_default_rdf_update_quads_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#update-load",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$8.ActorQueryOperationJoin({mediatorJoin:urn_comunica_default_rdf_join_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#join",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$7.ActorQueryOperationMinus({mediatorJoin:urn_comunica_default_rdf_join_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#minus",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$6.ActorQueryOperationLeftJoin({mediatorJoin:urn_comunica_default_rdf_join_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#leftjoin",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$5.ActorQueryOperationPathSeq({mediatorJoin:urn_comunica_default_rdf_join_mediators_main,mediatorQueryOperation:urn_comunica_default_query_operation_mediators_main,name:"urn:comunica:default:query-operation/actors#path-seq",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$4.ActorRdfJoinMultiSmallest({mediatorJoinEntriesSort:urn_comunica_default_rdf_join_entries_sort_mediators_main,mediatorJoin:urn_comunica_default_rdf_join_mediators_main,mediatorJoinSelectivity:urn_comunica_default_rdf_join_selectivity_mediators_main,name:"urn:comunica:default:rdf-join/actors#inner-multi-smallest",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_join__2_0_0_components_ActorRdfJoin_jsonld_ActorRdfJoin_default_bus});new lib$3.ActorQueryOperationQuadpattern({mediatorResolveQuadPattern:urn_comunica_default_rdf_resolve_quad_pattern_mediators_main,unionDefaultGraph:!1,name:"urn:comunica:default:query-operation/actors#quadpattern",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_operation__2_0_0_components_ActorQueryOperation_jsonld_ActorQueryOperation_default_bus});new lib$18.ActorRdfResolveQuadPatternFederated({mediatorResolveQuadPattern:urn_comunica_default_rdf_resolve_quad_pattern_mediators_main,mediatorRdfMetadataAccumulate:urn_comunica_default_rdf_metadata_accumulate_mediators_main,skipEmptyPatterns:!1,name:"urn:comunica:default:rdf-resolve-quad-pattern/actors#federated",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_quad_pattern__2_0_0_components_ActorRdfResolveQuadPattern_jsonld_ActorRdfResolveQuadPattern_default_bus});new lib$2.ActorHttpProxy({mediatorHttp:urn_comunica_default_http_mediators_main,name:"urn:comunica:default:http/actors#proxy",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_http__2_0_0_components_ActorHttp_jsonld_ActorHttp_default_bus,beforeActors:[urn_comunica_default_http_actors_fetch]});new lib$1.ActorDereferenceHttp({mediatorHttp:urn_comunica_default_http_mediators_main,maxAcceptHeaderLength:1024,maxAcceptHeaderLengthBrowser:128,name:"urn:comunica:default:dereference/actors#http",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_dereference__2_0_0_components_ActorDereference_jsonld_ActorDereference_default_bus,beforeActors:[urn_comunica_default_dereference_actors_fallback]});new lib$G.ActorQueryResultSerializeSparqlJson({emitMetadata:!0,httpObserver:https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_sparql_json__2_0_0_components_ActorQueryResultSerializeSparqlJson_jsonld_ActorQueryResultSerializeSparqlJson_default_observer,mediaTypePriorities:{"application/sparql-results+json":.8},mediaTypeFormats:{"application/sparql-results+json":"http://www.w3.org/ns/formats/SPARQL_Results_JSON"},name:"urn:comunica:default:query-result-serialize/actors#sparql-json",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib$F.ActorQueryResultSerializeStats({httpObserver:https___linkedsoftwaredependencies_org_bundles_npm__comunica_actor_query_result_serialize_stats__2_0_0_components_ActorQueryResultSerializeStats_jsonld_ActorQueryResultSerializeStats_default_observer,mediaTypePriorities:{stats:.5},mediaTypeFormats:{stats:"https://comunica.linkeddatafragments.org/#results_stats"},name:"urn:comunica:default:query-result-serialize/actors#stats",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_query_result_serialize__2_0_0_components_ActorQueryResultSerialize_jsonld_ActorQueryResultSerialize_default_bus});new lib.ActorRdfResolveQuadPatternStringSource({cacheSize:100,mediatorRdfParse:urn_comunica_default_rdf_parse_mediators_parse,mediatorRdfResolveQuadPattern:urn_comunica_default_rdf_resolve_quad_pattern_mediators_main,name:"urn:comunica:default:rdf-resolve-quad-pattern/actors#string-source",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_quad_pattern__2_0_0_components_ActorRdfResolveQuadPattern_jsonld_ActorRdfResolveQuadPattern_default_bus,beforeActors:[urn_comunica_default_rdf_resolve_quad_pattern_actors_hypermedia]});new lib$1h.ActorRdfResolveQuadPatternRdfJsSource({name:"urn:comunica:default:rdf-resolve-quad-pattern/actors#rdfjs-source",bus:https___linkedsoftwaredependencies_org_bundles_npm__comunica_bus_rdf_resolve_quad_pattern__2_0_0_components_ActorRdfResolveQuadPattern_jsonld_ActorRdfResolveQuadPattern_default_bus,beforeActors:[urn_comunica_default_rdf_resolve_quad_pattern_actors_hypermedia]});var engineDefault$1=urn_comunica_default_init_actors_query;Object.defineProperty(QueryEngine$1,"__esModule",{value:!0});QueryEngine$1.QueryEngine=void 0;const actor_init_query_1=indexBrowser,engineDefault=engineDefault$1;class QueryEngine extends actor_init_query_1.QueryEngineBase{constructor(engine=engineDefault){super(engine)}}__name(QueryEngine,"QueryEngine");QueryEngine$1.QueryEngine=QueryEngine;(function(exports){var __createBinding2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(o,m,k,k2){k2===void 0&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))&&(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]}),__exportStar=commonjsGlobal&&commonjsGlobal.__exportStar||function(m,exports2){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(exports2,p)&&__createBinding2(exports2,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(QueryEngine$1,exports)})(indexBrowser$1);var __defProp2=Object.defineProperty,__name2=__name((target,value)=>__defProp2(target,"name",{value,configurable:!0}),"__name"),_engine;class Enhancer{constructor(){__privateAdd(this,_engine,void 0);__privateSet(this,_engine,new indexBrowser$1.QueryEngine)}async execute(dataset){const shaclProperties=grapoi({dataset,factory:defaultEnv}).hasOut([rdf("type")],[sh$1("NodeShape")]).trim().hasOut([sh$1("property")]),promises=[];for(const shaclProperty of shaclProperties.out([sh$1("property")]))shaclProperty.out([sh$1("name"),rdfs("label")]).terms.length||promises.push(this.getLabelAndDescription(shaclProperty).then(quads=>{for(const quad of quads)dataset.add(quad)}));await Promise.all(promises)}async getLabelAndDescription(shaclProperty){const predicates=parsePath(shaclProperty.out([sh$1("path")])).pop().predicates,labelQuads=[];for(const predicate2 of predicates){const quads=(await(await __privateGet(this,_engine).queryQuads(`
        CONSTRUCT {
          ?s <${sh$1("name").value}> ?o1 .
          ?s <${sh$1("description").value}> ?o2 .
        } WHERE {
          VALUES ?s { <${predicate2.value}> }
          VALUES ?p1 { ${[rdfs("label")].map(predicate22=>`<${predicate22.value}>`).join(" ")} }
          ?s ?p1 ?o1 .

          VALUES ?p2 { ${[rdfs("comment")].map(predicate22=>`<${predicate22.value}>`).join(" ")} }
          ?s ?p2 ?o2 .
        }
      `,{sources:[predicate2.value]})).toArray()).map(quad=>defaultEnv.quad(shaclProperty.term,quad.predicate,quad.object));labelQuads.push(...quads)}return labelQuads}}__name(Enhancer,"Enhancer"),_engine=new WeakMap;__name2(Enhancer,"Enhancer");export{Enhancer as default};
